!function(e,t){function r(e,t,i,r,a,n){var o=a.realSize?a.realSize:a;t=t||"",t=String(t),e.font=i,e.fillStyle=r,e.strokeStyle="gray",e.textBaseline="middle",e.textAlign="center";for(var s=t.split("\n"),l=s.length,h=o.height/l,c=(a.height-o.height)/2,u=0;u<l;u++){var f=ge.getTextSize(i,s[u]).width,p=(a.height,f/2);"right"==n?(p=a.width-f/2,e.textAlign="center"):"left"==n?(p=f/2,e.textAlign="center",e.textBaseline="middle"):"center"==n&&(p=a.width/2),e.strokeText(s[u],p,h/2+u*h+c),e.fillText(s[u],p,h/2+u*h+c)}}function n(e,t){var i=0;if(e.shadowMatrix)for(var r=0,a=t.size();r<a;r++)t.get(r).refreshShadowUniforms(e,i)&&i++}function o(e,t){var i=0;if(e.pShadowMap)for(var r=0,a=t.size();r<a;r++)t.get(r).refreshUniformsPointShadow(e,i)&&i++}function l(e,t,i,r){if(t._modelViewMatrix||(t._modelViewMatrix=new ue),i.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&i.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements),e.modelViewProjectionMatrix){t._modelViewProjectionMatrix=new ue;var a=r._currentCamera.projectionMatrix;t._modelViewProjectionMatrix.multiply(a,t._modelViewMatrix),i.uniformMatrix4fv(e.modelViewProjectionMatrix,!1,t._modelViewProjectionMatrix.elements)}}function h(e,t,i){var r;return"fragment"===e?r=i.createShader(i.FRAGMENT_SHADER):"vertex"===e&&(r=i.createShader(i.VERTEX_SHADER)),i.shaderSource(r,t),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||i.isContextLost()?r:(console.log(i.getShaderInfoLog(r)),console.error(t),null)}function f(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function p(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function d(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function m(t){var i=t,r=i._canvas;Ee.isNaN(i._renderInterval)&&(i._renderInterval=10),i.__timeOutFunc||(i.__timeOutFunc=function(){var t=i._vrDisplay;if(i._animateId=(t&&t.isPresenting?t:e).requestAnimationFrame(i.__timeOutFunc),i._isPresenting){var a=i._camera;a.updateProjectionMatrix(),a.worldMatrix=a.leftVm,a.worldMatrixInverse=a.leftVmInverse,a.projectionMatrix=a.leftPm,i._gl.viewport(0,0,.5*r.width,r.height),i._dirty=!0,Le.clear(!0,i.autoClearDepth,i.autoClearStencil,i),i.render(),a.worldMatrix=a.rightVm,a.worldMatrixInverse=a.rightVmInverse,a.projectionMatrix=a.rightPm,i._gl.viewport(.5*r.width,0,.5*r.width,r.height),Le.clear(!1,i.autoClearDepth,i.autoClearStencil,i),i.innerRender(a,!0),i.extendRender(a),t.submitFrame()}else i.render()}),setTimeout(i.__timeOutFunc,i._renderInterval)}function g(e,t,i){null!=e&&("number"==typeof e?this.fromNumber(e,t,i):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function y(){return new g(null)}function v(e){return Ue.charAt(e)}function x(e,t){var i=ke[e.charCodeAt(t)];return null==i?-1:i}function A(e){var t=y();return t.fromInt(e),t}function _(e){var t,i=1;return 0!=(t=e>>>16)&&(e=t,i+=16),0!=(t=e>>8)&&(e=t,i+=8),0!=(t=e>>4)&&(e=t,i+=4),0!=(t=e>>2)&&(e=t,i+=2),0!=(t=e>>1)&&(e=t,i+=1),i}function w(e){this.m=e}function M(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function S(e,t){return e&t}function P(e,t){return e|t}function C(e,t){return e^t}function T(e,t){return e&~t}function E(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function z(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function D(){}function L(e){return e}function R(e){this.r2=y(),this.q3=y(),g.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function N(){this.i=0,this.j=0,this.S=new Array}function B(){return new N}function I(e){Ye[We++]^=255&e,Ye[We++]^=e>>8&255,Ye[We++]^=e>>16&255,Ye[We++]^=e>>24&255,We>=je&&(We-=je)}function F(){I((new Date).getTime())}function V(){if(null==Ge){for(F(),(Ge=B()).init(Ye),We=0;We<Ye.length;++We)Ye[We]=0;We=0}return Ge.next()}function U(){}function k(e,t){return new g(e,t)}function O(e,t){if(t<e.length+11)return null;for(var i=new Array,r=e.length-1;r>=0&&t>0;){var a=e.charCodeAt(r--);a<128?i[--t]=a:a>127&&a<2048?(i[--t]=63&a|128,i[--t]=a>>6|192):(i[--t]=63&a|128,i[--t]=a>>6&63|128,i[--t]=a>>12|224)}i[--t]=0;for(var n=new U,o=new Array;t>2;){for(o[0]=0;0==o[0];)n.nextBytes(o);i[--t]=o[0]}return i[--t]=2,i[--t]=0,new g(i)}function X(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function G(e,t){for(var i=e.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=t-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var a="";++r<i.length;){var n=255&i[r];n<128?a+=String.fromCharCode(n):n>191&&n<224?(a+=String.fromCharCode((31&n)<<6|63&i[r+1]),++r):(a+=String.fromCharCode((15&n)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return a}function Y(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.skyY.value=t.skyY,e.horizonY.value=t.horizonY,e.earthY.value=t.earthY,e.skyColor.value=t.skyColor,e.horizonColor.value=t.horizonColor,e.earthColor.value=t.earthColor}function W(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function H(e,t){e&&e.skyY&&(e.skyY.value=t.skyY,e.horizonY.value=t.horizonY,e.earthY.value=t.earthY,e.skyColor.value=t.skyColor,e.horizonColor.value=t.horizonColor,e.earthColor.value=t.earthColor)}function q(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=t.scale||1,e.map.value=t.map}function Z(e,t){return e.distance-t.distance}function Q(e,t,i,r,a){(e instanceof se.Node||e instanceof se.Billboard)&&J(e,t,i,r,a)}function K(e,i,r,a,n){if(e!==t)for(var o=e.getDescendants(),s=0,l=o.length;s<l;s++)Q(o[s],i,r,a,n)}function J(e,i,r,a,n){if(a||0!=n.isVisible(e)){if(e instanceof se.Billboard){var o=i.matrixPosition;o.setFromMatrixPosition(e.worldMatrix);var s=i.ray.distanceToPoint(o),l=e.material.alignment,h=new se.Plane(1,1);(l.x||l.y)&&(h.setPosition(l.x,l.y,0),h=se.Utils.transformElement(h,!0)),h.setPosition(o);var c=(new he).getScaleFromMatrix(e.worldMatrix);h.setScale(c.x,c.y,1);var u=i.direction.clone(),f=h.getPosition().clone(),p=e.material;p&&p.vertical&&(u.y=0),f.sub(u),h.lookAt(f),h.updateWorldMatrix(!0);var d=[];return J(h,i,d,!0,n),0===d.length?r:(r.push({distance:d[0].distance,point:e._position,face:null,object:e,element:e}),r)}if(e instanceof se.Line){var m=1;m-=1;var g=(D=Math.sqrt(i.linePrecision+m))*D;if(null==(P=e).boundingSphere&&P.computeBoundingSphere(),ut.copy(P.boundingSphere),ut.applyMatrix4(e.worldMatrix),!1===i.ray.isIntersectionSphere(ut))return r;lt.getInverse(e.worldMatrix),st.copy(i.ray).transform(lt);for(var y=(C=P.vertices).length,v=new he,x=new he,A=e.type===se.LineStrip?1:2,_=0;_<y-1;_+=A)st.distanceSqToSegment(C[_],C[_+1],x,v)>g||(s=st.origin.distanceTo(x))<i.near||s>i.far||r.push({distance:s,point:v.clone().applyMatrix4(e.worldMatrix),face:null,faceIndex:null,element:e,object:e});return r}if(null===e.boundingSphere&&e.computeBoundingSphere(),ut.set(e.worldMatrix.getPosition(),e.boundingSphere.radius*e.worldMatrix.getMaxScaleOnAxis()),!i.ray.isIntersectionSphere(ut))return r;var w,b,M,S,P=e,C=P.vertices,T=e.material instanceof se.ArrayMaterial,E=!0===T?e.material.materials:null,z=e.material.side,D=i.precision;e.rotationWorldMatrix.extractRotation(e.worldMatrix),lt.getInverse(e.worldMatrix),st.copy(i.ray).transform(lt);for(var L=0,R=P.faces.length;L<R;L++){var N=P.faces[L],B=!0===T?E[N.materialIndex]:e.material,I=n.getOverLoadMaterial(e,B);if(I&&(B=I),B!==t&&!1!==B.visible&&(!1!==P.visible||a)&&(!B.transparent||0!=B.opacity)){ht.setFromNormalAndCoplanarPoint(N.normal,C[N.a]);var F=st.distanceToPlane(ht);if(!(Math.abs(F)<D||F<0)){z=B.side;var V=st.direction.dot(ht.normal);if((z===se.DoubleSide||(z===se.FrontSide?V<0:V>0))&&!(F<i.near||F>i.far)){ct=st.at(F,ct);var U,k=new he,O=(N.materialIndex,!1);if(n&&n._selectTransparencyThreshold>0&&(O=1==B.transparent||B.alphaTest>0),N instanceof se.Face3){if(w=C[N.a],b=C[N.b],M=C[N.c],!se.Triangle.containsPoint(ct,w,b,M))continue;k=se.Triangle.barycoordFromPoint(ct,w,b,M)}else{if(!(N instanceof se.Face4))throw Error("face type not supported");w=C[N.a],b=C[N.b],M=C[N.c],S=C[N.d];var X=se.Triangle.containsPoint(ct,w,b,S),G=se.Triangle.containsPoint(ct,b,M,S);if(!X&&!G)continue;X?k=se.Triangle.barycoordFromPoint(ct,w,b,S):(k=se.Triangle.barycoordFromPoint(ct,b,M,S),U=!0)}var Y=new le,W=k.z,j=k.x,H=k.y;if(P.uvs&&P.uvs[L]){var q=P.uvs[L];N instanceof se.Face3?(Y.x=q[0].x*j+q[1].x*H+q[2].x*W,Y.y=q[0].y*j+q[1].y*H+q[2].y*W):U?(Y.x=q[1].x*j+q[2].x*H+q[3].x*W,Y.y=q[1].y*j+q[2].y*H+q[3].y*W):(Y.x=q[0].x*j+q[1].x*H+q[3].x*W,Y.y=q[0].y*j+q[1].y*H+q[3].y*W)}var Z,Q=1;if(Y=n.debugUV||Y,O){if(B.opacity<n._selectTransparencyThreshold)continue;null==B.map?Q=B.opacity:n._pickingTexturePixel&&(Z=B.map._image,Q=Ee.getPixelFromImage(Z,Y.x,Y.y)[3]/255*(null==B.opacity?1:B.opacity)),Q<B.alphaTest?Q=0:0==B.transparent&&(Q=1)}Q<n._selectTransparencyThreshold||r.push({distance:F,point:i.ray.at(F),face:N,uv:Y,faceIndex:L,element:e,object:e,side:V>0?1:-1})}}}}}}function $(e){if(!yt[e.id]){if(xt=!0,yt[e.id]=e,e.finish=null==e.finish?e.delay+e.dur+e.interval:e.finish,null==e.from&&e.attr&&e.source){var t;(t=e.attr.match(/^S[:@](.*)/i))?e.from=e.source.getStyle(t[1]):(t=e.attr.match(/^C[:@](.*)/i))?e.from=e.source.getClient(t[1]):e.from=mono.getValue(e.source,e.attr)}ee(e),te(e)}return e}function ee(e){var t=e.type,i=e.from,r=e.to;"number"===t?(e.from=i||0,e.to=r||0):"point"===t?(i?i.length&&(e.from={x:i[0],y:i[1]}):e.from="scale"===e.attr?{x:1,y:1}:{x:0,y:0},r?r.length&&(e.to={x:r[0],y:r[1]}):e.to="scale"===e.attr?{x:1,y:1}:{x:0,y:0}):"rect"===t?(i?i.length&&(e.from={x:i[0],y:i[1],w:i[2],h:i[3]}):e.from={x:0,y:0,w:0,h:0},r?r.length&&(e.to={x:r[0],y:r[1],w:r[2],h:r[3]}):e.to={x:0,y:0,w:0,h:0}):"color"===t&&(e.from=getColorValue(i),e.to=getColorValue(r)),e.current=e.from}function te(e){var t=e.type,i=e.from,r=e.to;"number"===t?e.delta=r-i:"point"===t?e.delta={x:r.x-i.x,y:r.y-i.y}:"rect"===t?e.delta={x:r.x-i.x,y:r.y-i.y,w:r.w-i.w,h:r.h-i.h}:"color"===t&&(e.delta={r:r.r-i.r,g:r.g-i.g,b:r.b-i.b,a:r.a-i.a})}function ie(e,t){return yt[e.id]&&(null==t&&(t=!0),t&&oe(e,e.to),e.onStop&&e.onStop(),e.time=0,e.total=0,e.start=null,e.count=0,e.started=!1,e.stopped=!1,delete yt[e.id]),e}function re(e){null==e&&(e=!0),Object.keys(yt).forEach(function(t){var i=yt[t];e&&oe(i,i.to),i.onStop&&i.onStop()}),yt={}}function ae(e){Object.keys(yt).forEach(function(t){var i=yt[t];if(i){if(null==i.start&&(i.start=e),i.total=e-i.start,i.total>i.delay){i.time=i.total-i.delay;var r=!1;if(i.time>=i.dur&&(i.time=i.dur,r=!0),!i.stopped&&oe(i,ne(i)),i.stopped=r,i.total>=i.finish)if(++i.count>=i.repeat)ie(i,!1),i.onDone&&i.onDone();else if(i.time=0,i.total=0,i.start=null,i.stopped=!1,i.reverse){var a=i.from;i.from=i.to,i.to=a,te(i)}}!xt&&(xt=!0)}})}function ne(e,t){var i=e.type,r=e.delta,a=e.from,n=e.time,o=e.dur,s=Ae[e.easing||"easeNone"];return s||(s=Ae.easeNone),"number"===i?t=s(n,a,r,o):"point"===i?t={x:s(n,a.x,r.x,o),y:s(n,a.y,r.y,o)}:"rect"===i?t={x:s(n,a.x,r.x,o),y:s(n,a.y,r.y,o),w:s(n,a.w,r.w,o),h:s(n,a.h,r.h,o)}:"color"===i?t="rgba("+Math.floor(s(n,a.r,r.r,o))+","+Math.floor(s(n,a.g,r.g,o))+","+Math.floor(s(n,a.b,r.b,o))+","+Math.floor(s(n,a.a,r.a,o))+")":"set"===i?e.time&&(t=e.to):"group_set"===i&&(t=e.to[e.groupIndex]),e.current=t,t}function oe(e,t){if(e.started||(e.started=!0,e.onPlay&&e.onPlay()),e.filter&&(t=e.filter(t)),e.attr&&e.source){var i;(i=e.attr.match(/^S[:@](.*)/i))?e.source.setStyle(i[1],t):(i=e.attr.match(/^C[:@](.*)/i))?e.source.setClient(i[1],t):mono.setValue(e.source,e.attr,t)}e.onUpdate&&e.onUpdate(t)}self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,Number.isNaN||(Number.isNaN=function(e){return"number"==typeof e&&isNaN(e)}),Object.create=Object.create||function(e){var t=function(){};return t.prototype=e,new t};var se={version:"2.6.2",_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(e){e=null==e?"":e;for(var t=[],i=0;i<32;i++)t[i]=this._id[Math.floor(16*Math.random())];return t[12]="4",t[16]=this._id[3&t[16]|8],e+t.join("")},ip:function(e,t,i,r){var a=i+t;e[se.getter(t,r)]=function(){return this[a]},e[se.setter(t)]=function(e){var i=this[a];i!==e&&(this.setPropertyValue?this.setPropertyValue(a,e)&&(this.onPropertyChange(t,i,e),this.firePropertyChange(t,i,e)):(this[a]=e,this.onPropertyChange(t,i,e),this.firePropertyChange(t,i,e)))}},getter:function(e,t){var i=e.charAt(0).toUpperCase()+e.slice(1),r=/ble$/.test(e)||/ed$/.test(e)?"is":"get";return t&&-1!=t.indexOf(e)&&(r="is"),r+i},setter:function(e){return"set"+(e.charAt(0).toUpperCase()+e.slice(1))},getValue:function(e,t,i){var r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r,n="is"+r;return i?"boolean"===i?e[n]():(null==e[a]&&console.log("get Function "+a+" not exist"),e[a]()):e[a]?e[a]():e[n]?e[n]():e[t]},setValue:function(e,t,i){e["set"+t.charAt(0).toUpperCase()+t.slice(1)](i)},clone:function(e){if(!e)return null;var t={};for(var i in e)t[i]=e[i];return t},addMethod:function(e,t){var i=e.prototype;for(var r in t)i[r]=t[r]},classCache:{},getClass:function(t){var i=se.classCache[t];if(!i){var r=t.split("."),a=r.length;i=e;for(var n=0;n<a;n++)i=i[r[n]];se.classCache[t]=i}return i},newInstance:function(e){"string"==typeof e&&(e=(e=se.getClass(e)).prototype);var t=e.constructor;if(!t)return null;var i=arguments.length,r=arguments;if(1===i)return new t;if(2===i)return new t(r[1]);if(3===i)return new t(r[1],r[2]);if(4===i)return new t(r[1],r[2],r[3]);if(5===i)return new t(r[1],r[2],r[3],r[4]);if(6===i)return new t(r[1],r[2],r[3],r[4],r[5]);if(7===i)return new t(r[1],r[2],r[3],r[4],r[5],r[6]);if(8===i)return new t(r[1],r[2],r[3],r[4],r[5],r[6],r[7]);throw"don't support args more than 7"},xml:function(t){if(e.DOMParser)return(new DOMParser).parseFromString(t,"text/xml");var i=new ActiveXObject("Microsoft.XmlDOM");return i.async=!1,i.loadXml(t),i}};"function"==typeof define?define(function(){return se}):"object"==typeof exports&&(module.exports=se),e&&(e.TGL=e.mono=se);se.extend=function(e,t,i){if(t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superClass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}var a=e.prototype;if(i){a.getClassName=function(){return i.className};for(var n in i){if("__accessor"===n)for(var o=i.__accessor,s=i.__bool,l=0;l<o.length;l++){h=o[l];se.ip(a,h,"",s)}else if("___accessor"===n)for(var o=i.___accessor,l=0;l<o.length;l++){var h=o[l];se.ip(a,h,"_",s)}a[n]=i[n]}i.constructor&&(a.newInstance=function(){return se.newInstance(this)})}},se.defaultEulerOrder="XYZ",String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=String.prototype.endsWith||function(e){var t=String(e),i=this.lastIndexOf(t);return(-1<i&&i)===this.length-t.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var i=0,r=["ms","moz","webkit","o"],a=0;a<r.length&&!e.requestAnimationFrame;++a)e.requestAnimationFrame=e[r[a]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[r[a]+"CancelAnimationFrame"]||e[r[a]+"CancelRequestAnimationFrame"];e.requestAnimationFrame===t&&(e.requestAnimationFrame=function(t,r){var a=Date.now(),n=Math.max(0,16-(a-i)),o=e.setTimeout(function(){t(a+n)},n);return i=a+n,o}),e.cancelAnimationFrame=e.cancelAnimationFrame||function(t){e.clearTimeout(t)}}(),se.CullFaceNone=0,se.CullFaceBack=1,se.CullFaceFront=2,se.CullFaceFrontBack=3,se.FrontFaceDirectionCW=0,se.FrontFaceDirectionCCW=1,se.BasicShadowMap=0,se.PCFShadowMap=1,se.PCFSoftShadowMap=2,se.FrontSide="front",se.BackSide="back",se.DoubleSide="both",se.BothSide="both",se.NoShading=0,se.FlatShading=1,se.SmoothShading=2,se.NormalTypeFlat="flat",se.NormalTypeSmooth="smooth",se.NoColors=0,se.FaceColors=1,se.VertexColors=2,se.GradientColors=3,se.NoBlending=0,se.NormalBlending=1,se.AdditiveBlending=2,se.SubtractiveBlending=3,se.MultiplyBlending=4,se.CustomBlending=5,se.AddEquation=100,se.SubtractEquation=101,se.ReverseSubtractEquation=102,se.ZeroFactor=200,se.OneFactor=201,se.SrcColorFactor=202,se.OneMinusSrcColorFactor=203,se.SrcAlphaFactor=204,se.OneMinusSrcAlphaFactor=205,se.DstAlphaFactor=206,se.OneMinusDstAlphaFactor=207,se.DstColorFactor=208,se.OneMinusDstColorFactor=209,se.SrcAlphaSaturateFactor=210,se.MultiplyOperation=0,se.MixOperation=1,se.AddOperation=2,se.UVMapping=function(){},se.CubeReflectionMapping=function(){},se.CubeRefractionMapping=function(){},se.SphericalReflectionMapping=function(){},se.SphericalRefractionMapping=function(){},se.RepeatWrapping="repeat",se.ClampToEdgeWrapping="clamp",se.MirroredRepeatWrapping="mirrored",se.NearestFilter=1003,se.NearestMipMapNearestFilter=1004,se.NearestMipMapLinearFilter=1005,se.LinearFilter=1006,se.LinearMipMapNearestFilter=1007,se.LinearMipMapLinearFilter=1008,se.UnsignedByteType=1009,se.ByteType=1010,se.ShortType=1011,se.UnsignedShortType=1012,se.IntType=1013,se.UnsignedIntType=1014,se.FloatType=1015,se.UnsignedShort4444Type=1016,se.UnsignedShort5551Type=1017,se.UnsignedShort565Type=1018,se.AlphaFormat=1019,se.RGBFormat=1020,se.RGBAFormat=1021,se.LuminanceFormat=1022,se.LuminanceAlphaFormat=1023,se.RGB_S3TC_DXT1_Format=2001,se.RGBA_S3TC_DXT1_Format=2002,se.RGBA_S3TC_DXT3_Format=2003,se.RGBA_S3TC_DXT5_Format=2004,se.Gradient_Linear_U=1,se.Gradient_Linear_V=2,se.Gradient_Linear_UV=3,se.Gradient_Linear_NUV=4,se.Gradient_Radial=5,se.Gradient_Sweep=6,se.Math={clamp:function(e,t,i){return e<t?t:e>i?i:e},isConcave:function(e,t,i){var r=i?1:-1;return(e.x*t.y-t.x*e.y)*r<0},area:function(e,i,r,a){var n=a?1:-1;return e&&i&&r?(-e.x*i.y-i.x*r.y-r.x*e.y+r.x*i.y+i.x*e.y+e.x*r.y)*n:t},isClockwise:function(e,t,i){t=t||"x",i=i||"y";for(var r=0,a=e.length,n=0;n<a;n++){var o=e[n],s=e[n+1===a?0:n+1];r+=(s[t]-o[t])*(s[i]+o[i])}return r<0},isClockwise3:function(e,t,i){(new mono.Vec3).crossVectors(e,t),(new mono.Vec3).subVectors(t,e),(new mono.Vec3).subVectors(t,e)},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,a){return r+(e-t)*(a-r)/(i-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(e){return e*se.Math.__d2r},radToDeg:function(e){return e*se.Math.__r2d},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},PI2:2*Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var a=0;a<36;a++)8==a||13==a||18==a||23==a?i[a]="-":14==a?i[a]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[a]=t[19==a?3&e|8:e]);return i.join("")}}()},se.Math.__d2r=Math.PI/180,se.Math.__r2d=180/Math.PI,se.Quat=function(e,i,r,a){this.x=e||0,this.y=i||0,this.z=r||0,this.w=a!==t?a:1},se.Quat.prototype={constructor:se.Quat,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,i){var r=Math.cos(e.x/2),a=Math.cos(e.y/2),n=Math.cos(e.z/2),o=Math.sin(e.x/2),s=Math.sin(e.y/2),l=Math.sin(e.z/2);return i===t||"XYZ"===i?(this.x=o*a*n+r*s*l,this.y=r*s*n-o*a*l,this.z=r*a*l+o*s*n,this.w=r*a*n-o*s*l):"YXZ"===i?(this.x=o*a*n+r*s*l,this.y=r*s*n-o*a*l,this.z=r*a*l-o*s*n,this.w=r*a*n+o*s*l):"ZXY"===i?(this.x=o*a*n-r*s*l,this.y=r*s*n+o*a*l,this.z=r*a*l+o*s*n,this.w=r*a*n-o*s*l):"ZYX"===i?(this.x=o*a*n-r*s*l,this.y=r*s*n+o*a*l,this.z=r*a*l-o*s*n,this.w=r*a*n+o*s*l):"YZX"===i?(this.x=o*a*n+r*s*l,this.y=r*s*n+o*a*l,this.z=r*a*l-o*s*n,this.w=r*a*n-o*s*l):"XZY"===i&&(this.x=o*a*n-r*s*l,this.y=r*s*n-o*a*l,this.z=r*a*l+o*s*n,this.w=r*a*n+o*s*l),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],a=i[4],n=i[8],o=i[1],s=i[5],l=i[9],h=i[2],c=i[6],u=i[10],f=r+s+u;return f>0?(t=.5/Math.sqrt(f+1),this.w=.25/t,this.x=(c-l)*t,this.y=(n-h)*t,this.z=(o-a)*t):r>s&&r>u?(t=2*Math.sqrt(1+r-s-u),this.w=(c-l)/t,this.x=.25*t,this.y=(a+o)/t,this.z=(n+h)/t):s>u?(t=2*Math.sqrt(1+s-r-u),this.w=(n-h)/t,this.x=(a+o)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*Math.sqrt(1+u-r-s),this.w=(o-a)/t,this.x=(n+h)/t,this.y=(l+c)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,a=e.z,n=e.w,o=t.x,s=t.y,l=t.z,h=t.w;return this.x=i*h+n*o+r*l-a*s,this.y=r*h+n*s+a*o-i*l,this.z=a*h+n*l+i*s-r*o,this.w=n*h-i*o-r*s-a*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quat's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( Quat ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,r=this.y,a=this.z,n=this.w,o=n*e.w+i*e.x+r*e.y+a*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=n,this.x=i,this.y=r,this.z=a,this;var s=Math.acos(o),l=Math.sqrt(1-o*o);if(Math.abs(l)<.001)return this.w=.5*(n+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(a+this.z),this;var h=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this.w=n*h+this.w*c,this.x=i*h+this.x*c,this.y=r*h+this.y*c,this.z=a*h+this.z*c,this},toEuler:function(){var e=this.w*this.w,t=this.x*this.x,i=this.y*this.y,r=this.z*this.z;return[180/Math.PI*Math.atan2(2*(this.y*this.z+this.x*this.w),-t-i+r+e),180/Math.PI*Math.asin(-2*(this.x*this.z-this.y*this.w)),180/Math.PI*Math.atan2(2*(this.x*this.y+this.z*this.w),t-i-r+e)]},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new se.Quat(this.x,this.y,this.z,this.w)}},se.Quat.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)};var le=function(e,t){this.x=e||0,this.y=t||0};le.prototype={constructor:le,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return null!=e&&(e.x===this.x&&e.y===this.y)},clone:function(){return new le(this.x,this.y)}},se.Vec2=le;var he=function(e,t,i){this.x=parseFloat(e)||0,this.y=parseFloat(t)||0,this.z=parseFloat(i)||0};se.Vec3=he,he.prototype={set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},center:function(e,t){return this.x=(e.x+t.x)/2,this.y=(e.y+t.y)/2,this.z=(e.z+t.z)/2,this},copy:function(e){return null!=this&&null!=e||console.log("TGL.Vec3.copy this : "+this+" v : "+e),this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6]*r,this.y=a[1]*t+a[4]*i+a[7]*r,this.z=a[2]*t+a[5]*i+a[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements,n=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*n,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*n,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*n,this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements,n=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*n,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*n,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*n,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,a=e.x,n=e.y,o=e.z,s=e.w,l=s*t+n*r-o*i,h=s*i+o*t-a*r,c=s*r+a*i-n*t,u=-a*t-n*i-o*r;return this.x=l*s+u*-a+h*-o-c*-n,this.y=h*s+u*-n+c*-a-l*-o,this.z=c*s+u*-o+l*-n-h*-a,this},applyEuler:function(e,t){var i=he.__q1.setFromEuler(e,t);return this.applyQuaternion(i),this},applyAxisAngle:function(e,t){var i=he.__q1.setFromAxisAngle(e,t);return this.applyQuaternion(i),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this},cross:function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){return Math.acos(this.dot(e)/this.length()/e.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,i){function r(e){return Math.min(Math.max(e,-1),1)}var a=e.elements,n=a[0],o=a[4],s=a[8],l=a[1],h=a[5],c=a[9],u=a[2],f=a[6],p=a[10];return i===t||"XYZ"===i?(this.y=Math.asin(r(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-c,p),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(f,h),this.z=0)):"YXZ"===i?(this.x=Math.asin(-r(c)),Math.abs(c)<.99999?(this.y=Math.atan2(s,p),this.z=Math.atan2(l,h)):(this.y=Math.atan2(-u,n),this.z=0)):"ZXY"===i?(this.x=Math.asin(r(f)),Math.abs(f)<.99999?(this.y=Math.atan2(-u,p),this.z=Math.atan2(-o,h)):(this.y=0,this.z=Math.atan2(l,n))):"ZYX"===i?(this.y=Math.asin(-r(u)),Math.abs(u)<.99999?(this.x=Math.atan2(f,p),this.z=Math.atan2(l,n)):(this.x=0,this.z=Math.atan2(-o,h))):"YZX"===i?(this.z=Math.asin(r(l)),Math.abs(l)<.99999?(this.x=Math.atan2(-c,h),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(s,p))):"XZY"===i&&(this.z=Math.asin(-r(o)),Math.abs(o)<.99999?(this.x=Math.atan2(f,h),this.y=Math.atan2(s,n)):(this.x=Math.atan2(-c,p),this.y=0)),this},setEulerFromQuaternion:function(e,i){function r(e){return Math.min(Math.max(e,-1),1)}var a=e.x*e.x,n=e.y*e.y,o=e.z*e.z,s=e.w*e.w;return i===t||"XYZ"===i?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-a-n+o),this.y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+a-n-o)):"YXZ"===i?(this.x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-a-n+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-a+n-o)):"ZXY"===i?(this.x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-a-n+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-a+n-o)):"ZYX"===i?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-a-n+o),this.y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+a-n-o)):"YZX"===i?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-a+n-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+a-n-o),this.z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===i&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-a+n-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+a-n-o),this.z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},toString:function(){return this.x+"_"+this.y+"_"+this.z},equals:function(e){return null!=e&&(e.x===this.x&&e.y===this.y&&e.z===this.z)},clone:function(){return new he(this.x,this.y,this.z)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},rotateFromAxisAndCenter:function(e,t,i){var r=(new se.Mat4).makeRotationAxisAndCenter(e,t,i);return this.applyMatrix4(r),this},rotationTowards:function(e,t){var i=(new se.Mat4).rotationTowards(e,t);return this.setEulerFromRotationMatrix(i),this},constructor:se.Vec3},he.__q1=new se.Quat,se.Vec4=function(e,i,r,a){this.x=e||0,this.y=i||0,this.z=r||0,this.w=a!==t?a:1},se.Vec4.prototype={constructor:se.Vec4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==t?e.w:1,this},add:function(e,i){return i!==t?(console.warn("DEPRECATED: Vec4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,i)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,i){return i!==t?(console.warn("DEPRECATED: Vec4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,i)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=this.w,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12]*a,this.y=n[1]*t+n[5]*i+n[9]*r+n[13]*a,this.z=n[2]*t+n[6]*i+n[10]*r+n[14]*a,this.w=n[3]*t+n[7]*i+n[11]*r+n[15]*a,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new se.Vec4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,a,n=e.elements,o=n[0],s=n[4],l=n[8],h=n[1],c=n[5],u=n[9],f=n[2],p=n[6],d=n[10];if(Math.abs(s-h)<.01&&Math.abs(l-f)<.01&&Math.abs(u-p)<.01){if(Math.abs(s+h)<.1&&Math.abs(l+f)<.1&&Math.abs(u+p)<.1&&Math.abs(o+c+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,g=(c+1)/2,y=(d+1)/2,v=(s+h)/4,x=(l+f)/4,A=(u+p)/4;return m>g&&m>y?m<.01?(i=0,r=.707106781,a=.707106781):(r=v/(i=Math.sqrt(m)),a=x/i):g>y?g<.01?(i=.707106781,r=0,a=.707106781):(i=v/(r=Math.sqrt(g)),a=A/r):y<.01?(i=.707106781,r=.707106781,a=0):(i=x/(a=Math.sqrt(y)),r=A/a),this.set(i,r,a,t),this}var _=Math.sqrt((p-u)*(p-u)+(l-f)*(l-f)+(h-s)*(h-s));return Math.abs(_)<.001&&(_=1),this.x=(p-u)/_,this.y=(l-f)/_,this.z=(h-s)/_,this.w=Math.acos((o+c+d-1)/2),this}};var ce=function(e,i,r,a,n,o,s,l,h){this.elements=new Float32Array(9),this.set(e!==t?e:1,i||0,r||0,a||0,n!==t?n:1,o||0,s||0,l||0,h!==t?h:1)};ce.prototype={constructor:ce,set:function(e,t,i,r,a,n,o,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=r,h[4]=a,h[7]=n,h[2]=o,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Mat3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new he;return function(t){for(var i=0,r=t.length;i<r;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyMatrix3(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],n=e[4],o=e[5],s=e[6],l=e[7],h=e[8];return t*n*h-t*o*l-i*a*h+i*o*s+r*a*l-r*n*s},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var a=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===a){var n="Mat3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(n);return console.warn(n),this.identity(),this}return this.multiplyScalar(1/a),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new ce(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},se.Mat3=ce;var ue=function(e,i,r,a,n,o,s,l,h,c,u,f,p,d,m,g){this.elements=new Float32Array(16),this.set(e!==t?e:1,i||0,r||0,a||0,n||0,o!==t?o:1,s||0,l||0,h||0,c||0,u!==t?u:1,f||0,p||0,d||0,m||0,g!==t?g:1)};ue.prototype={constructor:ue,set:function(e,t,i,r,a,n,o,s,l,h,c,u,f,p,d,m){var g=this.elements;if(e.length)for(var y=0;y<e.length;y++)g[y]=e[y];else g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=a,g[5]=n,g[9]=o,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=f,g[7]=p,g[11]=d,g[15]=m;return this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setRotationFromEuler:function(e,i){var r=this.elements,a=e.x,n=e.y,o=e.z,s=Math.cos(a),l=Math.sin(a),h=Math.cos(n),c=Math.sin(n),u=Math.cos(o),f=Math.sin(o);if(i===t||"XYZ"===i){var p=s*u,d=s*f,m=l*u,g=l*f;r[0]=h*u,r[4]=-h*f,r[8]=c,r[1]=d+m*c,r[5]=p-g*c,r[9]=-l*h,r[2]=g-p*c,r[6]=m+d*c,r[10]=s*h}else if("YXZ"===i){var y=h*u,v=h*f,x=c*u,A=c*f;r[0]=y+A*l,r[4]=x*l-v,r[8]=s*c,r[1]=s*f,r[5]=s*u,r[9]=-l,r[2]=v*l-x,r[6]=A+y*l,r[10]=s*h}else if("ZXY"===i){var y=h*u,v=h*f,x=c*u,A=c*f;r[0]=y-A*l,r[4]=-s*f,r[8]=x+v*l,r[1]=v+x*l,r[5]=s*u,r[9]=A-y*l,r[2]=-s*c,r[6]=l,r[10]=s*h}else if("ZYX"===i){var p=s*u,d=s*f,m=l*u,g=l*f;r[0]=h*u,r[4]=m*c-d,r[8]=p*c+g,r[1]=h*f,r[5]=g*c+p,r[9]=d*c-m,r[2]=-c,r[6]=l*h,r[10]=s*h}else if("YZX"===i){var _=s*h,w=s*c,b=l*h,M=l*c;r[0]=h*u,r[4]=M-_*f,r[8]=b*f+w,r[1]=f,r[5]=s*u,r[9]=-l*u,r[2]=-c*u,r[6]=w*f+b,r[10]=_-M*f}else if("XZY"===i){var _=s*h,w=s*c,b=l*h,M=l*c;r[0]=h*u,r[4]=-f,r[8]=c*u,r[1]=_*f+M,r[5]=s*u,r[9]=w*f-b,r[2]=b*f-w,r[6]=l*u,r[10]=M*f+_}return this},setRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z,n=e.w,o=i+i,s=r+r,l=a+a,h=i*o,c=i*s,u=i*l,f=r*s,p=r*l,d=a*l,m=n*o,g=n*s,y=n*l;return t[0]=1-(f+d),t[4]=c-y,t[8]=u+g,t[1]=c+y,t[5]=1-(h+d),t[9]=p-m,t[2]=u-g,t[6]=p+m,t[10]=1-(h+f),this},lookAt:function(e,t,i){var r=this.elements,a=ue.__v1,n=ue.__v2,o=ue.__v3;return o.subVectors(e,t).normalize(),0===o.length()&&(o.z=1),a.crossVectors(i,o).normalize(),0===a.length()&&(o.x+=1e-4,a.crossVectors(i,o).normalize()),n.crossVectors(o,a),r[0]=a.x,r[1]=a.y,r[2]=a.z,r[4]=n.x,r[5]=n.y,r[6]=n.z,r[8]=o.x,r[9]=o.y,r[10]=o.z,this},multiply:function(e,i){return i!==t?this.multiplyMatrices(e,i):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,a=this.elements,n=i[0],o=i[4],s=i[8],l=i[12],h=i[1],c=i[5],u=i[9],f=i[13],p=i[2],d=i[6],m=i[10],g=i[14],y=i[3],v=i[7],x=i[11],A=i[15],_=r[0],w=r[4],b=r[8],M=r[12],S=r[1],P=r[5],C=r[9],T=r[13],E=r[2],z=r[6],D=r[10],L=r[14],R=r[3],N=r[7],B=r[11],I=r[15];return a[0]=n*_+o*S+s*E+l*R,a[4]=n*w+o*P+s*z+l*N,a[8]=n*b+o*C+s*D+l*B,a[12]=n*M+o*T+s*L+l*I,a[1]=h*_+c*S+u*E+f*R,a[5]=h*w+c*P+u*z+f*N,a[9]=h*b+c*C+u*D+f*B,a[13]=h*M+c*T+u*L+f*I,a[2]=p*_+d*S+m*E+g*R,a[6]=p*w+d*P+m*z+g*N,a[10]=p*b+d*C+m*D+g*B,a[14]=p*M+d*T+m*L+g*I,a[3]=y*_+v*S+x*E+A*R,a[7]=y*w+v*P+x*z+A*N,a[11]=y*b+v*C+x*D+A*B,a[15]=y*M+v*T+x*L+A*I,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return e.applyProjection(this)},multiplyVector4:function(e){return e.applyMatrix4(this)},multiplyVector3Array:function(e){for(var t=ue.__v1,i=0,r=e.length;i<r;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyProjection(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z;return e.x=i*t[0]+r*t[4]+a*t[8],e.y=i*t[1]+r*t[5]+a*t[9],e.z=i*t[2]+r*t[6]+a*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,i=new se.Vector4;return i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,i},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],a=e[12],n=e[1],o=e[5],s=e[9],l=e[13],h=e[2],c=e[6],u=e[10],f=e[14];return e[3]*(+a*s*c-r*l*c-a*o*u+i*l*u+r*o*f-i*s*f)+e[7]*(+t*s*f-t*l*u+a*n*u-r*n*f+r*l*h-a*s*h)+e[11]*(+t*l*c-t*o*f-a*n*c+i*n*f+a*o*h-i*l*h)+e[15]*(-r*o*h-t*s*c+t*o*u+r*n*c-i*n*u+i*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=this.elements;return(new he).set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return ue.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return ue.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return ue.__v1.set(e[8],e[9],e[10])},getInverse:function(e,t){var i=this.elements,r=e.elements,a=r[0],n=r[4],o=r[8],s=r[12],l=r[1],h=r[5],c=r[9],u=r[13],f=r[2],p=r[6],d=r[10],m=r[14],g=r[3],y=r[7],v=r[11],x=r[15];i[0]=c*m*y-u*d*y+u*p*v-h*m*v-c*p*x+h*d*x,i[4]=s*d*y-o*m*y-s*p*v+n*m*v+o*p*x-n*d*x,i[8]=o*u*y-s*c*y+s*h*v-n*u*v-o*h*x+n*c*x,i[12]=s*c*p-o*u*p-s*h*d+n*u*d+o*h*m-n*c*m,i[1]=u*d*g-c*m*g-u*f*v+l*m*v+c*f*x-l*d*x,i[5]=o*m*g-s*d*g+s*f*v-a*m*v-o*f*x+a*d*x,i[9]=s*c*g-o*u*g-s*l*v+a*u*v+o*l*x-a*c*x,i[13]=o*u*f-s*c*f+s*l*d-a*u*d-o*l*m+a*c*m,i[2]=h*m*g-u*p*g+u*f*y-l*m*y-h*f*x+l*p*x,i[6]=s*p*g-n*m*g-s*f*y+a*m*y+n*f*x-a*p*x,i[10]=n*u*g-s*h*g+s*l*y-a*u*y-n*l*x+a*h*x,i[14]=s*h*f-n*u*f-s*l*p+a*u*p+n*l*m-a*h*m,i[3]=c*p*g-h*d*g-c*f*y+l*d*y+h*f*v-l*p*v,i[7]=n*d*g-o*p*g+o*f*y-a*d*y-n*f*v+a*p*v,i[11]=o*h*g-n*c*g-o*l*y+a*c*y+n*l*v-a*h*v,i[15]=n*c*f-o*h*f+o*l*p-a*c*p-n*l*d+a*h*d;var A=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12];if(0==A){var _="Mat4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return console.warn(_),this.identity(),this}return this.multiplyScalar(1/A),this},compose:function(e,t,i){var r=this.elements,a=ue.__m1,n=ue.__m2;return a.identity(),a.setRotationFromQuaternion(t),n.makeScale(i.x,i.y,i.z),this.multiplyMatrices(a,n),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,i){var r=this.elements,a=ue.__v1,n=ue.__v2,o=ue.__v3;a.set(r[0],r[1],r[2]),n.set(r[4],r[5],r[6]),o.set(r[8],r[9],r[10]),e=e instanceof he?e:new he,t=t instanceof se.Quat?t:new se.Quat,(i=i instanceof he?i:new he).x=a.length(),i.y=n.length(),i.z=o.length(),e.x=r[12],e.y=r[13],e.z=r[14];var s=ue.__m1;return s.copy(this),s.elements[0]/=i.x,s.elements[1]/=i.x,s.elements[2]/=i.x,s.elements[4]/=i.y,s.elements[5]/=i.y,s.elements[6]/=i.y,s.elements[8]/=i.z,s.elements[9]/=i.z,s.elements[10]/=i.z,t.setFromRotationMatrix(s),[e,t,i]},extractPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(e){var t=this.elements,i=e.elements,r=ue.__v1,a=1/r.set(i[0],i[1],i[2]).length(),n=1/r.set(i[4],i[5],i[6]).length(),o=1/r.set(i[8],i[9],i[10]).length();return t[0]=i[0]*a,t[1]=i[1]*a,t[2]=i[2]*a,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,this},translate:function(e){var t,i,r,a=this.elements;return e.length?(t=e[0],i=e[1],r=e[2]):(t=e.x,i=e.y,r=e.z),a[12]=a[0]*t+a[4]*i+a[8]*r+a[12],a[13]=a[1]*t+a[5]*i+a[9]*r+a[13],a[14]=a[2]*t+a[6]*i+a[10]*r+a[14],a[15]=a[3]*t+a[7]*i+a[11]*r+a[15],this},rotateX:function(e){var t=this.elements,i=t[4],r=t[5],a=t[6],n=t[7],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[4]=c*i+u*o,t[5]=c*r+u*s,t[6]=c*a+u*l,t[7]=c*n+u*h,t[8]=c*o-u*i,t[9]=c*s-u*r,t[10]=c*l-u*a,t[11]=c*h-u*n,this},rotateY:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],n=t[3],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i-u*o,t[1]=c*r-u*s,t[2]=c*a-u*l,t[3]=c*n-u*h,t[8]=c*o+u*i,t[9]=c*s+u*r,t[10]=c*l+u*a,t[11]=c*h+u*n,this},rotateZ:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],n=t[3],o=t[4],s=t[5],l=t[6],h=t[7],c=Math.cos(e),u=Math.sin(e);return t[0]=c*i+u*o,t[1]=c*r+u*s,t[2]=c*a+u*l,t[3]=c*n+u*h,t[4]=c*o-u*i,t[5]=c*s-u*r,t[6]=c*l-u*a,t[7]=c*h-u*n,this},rotateByAxis:function(e,t){var i=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,a=e.y,n=e.z,o=Math.sqrt(r*r+a*a+n*n),s=(r/=o)*r,l=(a/=o)*a,h=(n/=o)*n,c=Math.cos(t),u=Math.sin(t),f=1-c,p=r*a*f,d=r*n*f,m=a*n*f,g=r*u,y=a*u,v=n*u,x=s+(1-s)*c,A=p+v,_=d-y,w=p-v,b=l+(1-l)*c,M=m+g,S=d+y,P=m-g,C=h+(1-h)*c,T=i[0],E=i[1],z=i[2],D=i[3],L=i[4],R=i[5],N=i[6],B=i[7],I=i[8],F=i[9],V=i[10],U=i[11];i[12],i[13],i[14],i[15];return i[0]=x*T+A*L+_*I,i[1]=x*E+A*R+_*F,i[2]=x*z+A*N+_*V,i[3]=x*D+A*B+_*U,i[4]=w*T+b*L+M*I,i[5]=w*E+b*R+M*F,i[6]=w*z+b*N+M*V,i[7]=w*D+b*B+M*U,i[8]=S*T+P*L+C*I,i[9]=S*E+P*R+C*F,i[10]=S*z+P*N+C*V,i[11]=S*D+P*B+C*U,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z;return t[0]*=i,t[4]*=r,t[8]*=a,t[1]*=i,t[5]*=r,t[9]*=a,t[2]*=i,t[6]*=r,t[10]*=a,t[3]*=i,t[7]*=r,t[11]*=a,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),a=1-i,n=e.x,o=e.y,s=e.z,l=a*n,h=a*o;return this.set(l*n+i,l*o-r*s,l*s+r*o,0,l*o+r*s,h*o+i,h*s-r*n,0,l*s-r*o,h*s+r*n,a*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(e,t,i,r,a,n){var o=this.elements,s=2*a/(t-e),l=2*a/(r-i),h=(t+e)/(t-e),c=(r+i)/(r-i),u=-(n+a)/(n-a),f=-2*n*a/(n-a);return o[0]=s,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,i,r){var a=i*Math.tan(se.Math.degToRad(.5*e)),n=-a,o=n*t,s=a*t;return this.makeFrustum(o,s,n,a,i,r)},perspectiveFromFieldOfView:function(e,t,i){var r=this,a=r.elements,n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),l=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+l),c=2/(n+o);return a[0]=h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=c,a[6]=0,a[7]=0,a[8]=-(s-l)*h*.5,a[9]=(n-o)*c*.5,a[10]=i/(t-i),a[11]=-1,a[12]=0,a[13]=0,a[14]=i*t/(t-i),a[15]=0,r},makeOrthographic:function(e,t,i,r,a,n){var o=this.elements,s=t-e,l=i-r,h=n-a,c=(t+e)/s,u=(i+r)/l,f=(n+a)/h;return o[0]=2/s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2/l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2/h,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new ue(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z,n=e.w,o=i+i,s=r+r,l=a+a,h=i*o,c=i*s,u=i*l,f=r*s,p=r*l,d=a*l,m=n*o,g=n*s,y=n*l;return t[0]=1-(f+d),t[4]=c-y,t[8]=u+g,t[1]=c+y,t[5]=1-(h+d),t[9]=p-m,t[2]=u-g,t[6]=p+m,t[10]=1-(h+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},getEulerAngles:function(){var e=(new ue).extractRotation(this).elements,t=e[0],i=e[1],r=e[2],a=e[5],n=e[6],o=e[10],s=Math.atan2(n,o),l=Math.atan2(-r,Math.sqrt(t*t+i*i)),h=Math.sin(s),c=Math.cos(s),u=Math.atan2(h*e[8]-c*e[4],c*a-h*e[9]);return new he(s,l,u)},makeRotationAxisAndCenter:function(e,t,i){var r=Math.cos(t),a=Math.sin(t),n=1-r,o=e.x,s=e.y,l=e.z,h=n*o,c=n*s,u=i.x,f=i.y,p=i.z,d=this,m=new Float32Array(16);return m[0]=h*o+r,m[4]=h*s-a*l,m[8]=h*l+a*s,m[12]=u-u*(h*o+r)-f*(h*s-a*l)-p*(h*l+a*s),m[1]=h*s+a*l,m[5]=c*s+r,m[9]=c*l-a*o,m[13]=f-u*(h*s+a*l)-f*(c*s+r)-p*(c*l-a*o),m[2]=h*l-a*s,m[6]=c*l+a*o,m[10]=n*l*l+r,m[14]=p-u*(h*l-a*s)-f*(c*l+a*o)-p*(n*l*l+r),m[3]=0,m[7]=0,m[11]=0,m[15]=1,d.elements=m,d},rotationTowards:function(e,t){var i=Math.acos(t.dot(e)/t.length()/e.length()),r=(new se.Vec3).crossVectors(t,e).normalize();return this.makeRotationAxis(r,-i),this},equals:function(e){if(e instanceof ue){for(var t=0;t<this.elements.length;t++)if(Math.abs(this.elements[t]-e.elements[t])>1e-4)return!1;return!0}},fromRotationTranslation:function(e,t){var i=this,r=i.elements,a=e[0],n=e[1],o=e[2],s=e[3],l=a+a,h=n+n,c=o+o,u=a*l,f=a*h,p=a*c,d=n*h,m=n*c,g=o*c,y=s*l,v=s*h,x=s*c;return r[0]=1-(d+g),r[1]=f+x,r[2]=p-v,r[3]=0,r[4]=f-x,r[5]=1-(u+g),r[6]=m+y,r[7]=0,r[8]=p+v,r[9]=m-y,r[10]=1-(u+d),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,i}},ue.__v1=new he,ue.__v2=new he,ue.__v3=new he,ue.__m1=new ue,ue.__m2=new ue,se.Mat4=ue,se.Euler=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||se.Euler.DefaultOrder},se.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],se.Euler.DefaultOrder="XYZ",se.Euler.prototype={constructor:se.Euler,_x:0,_y:0,_z:0,_order:se.Euler.DefaultOrder,_quaternion:t,_updateQuaternion:function(){this._quaternion!==t&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,a=r[0],n=r[4],o=r[8],s=r[1],l=r[5],h=r[9],c=r[2],u=r[6],f=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(o)),Math.abs(o)<.99999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(h)),Math.abs(h)<.99999?(this._y=Math.atan2(o,f),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-n,l)):(this._y=0,this._z=Math.atan2(s,a))):"ZYX"===t?(this._y=Math.asin(-i(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,f),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-n,l))):"YZX"===t?(this._z=Math.asin(i(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,a)):(this._x=0,this._y=Math.atan2(o,f))):"XZY"===t?(this._z=Math.asin(-i(n)),Math.abs(n)<.99999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-h,f),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,i){function r(e){return Math.min(Math.max(e,-1),1)}var a=e.x*e.x,n=e.y*e.y,o=e.z*e.z,s=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),s-a-n+o),this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s+a-n-o)):"YXZ"===t?(this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s-a-n+o),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s-a+n-o)):"ZXY"===t?(this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),s-a-n+o),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),s-a+n-o)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),s-a-n+o),this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),s+a-n-o)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),s-a+n-o),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),s+a-n-o),this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),s-a+n-o),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),s+a-n-o),this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==i&&this._updateQuaternion(),this},reorder:function(){var e=new se.Quat;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==t&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new se.Euler(this._x,this._y,this._z,this._order)}},se.math={},se.math.Plane=function(e,i){this.normal=e!==t?e:new he(1,0,0),this.constant=i!==t?i:0},se.math.Plane.prototype={constructor:se.math.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){var r=se.math.Plane.__v1.subVectors(i,t).cross(se.math.Plane.__v2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new he).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e,t){var i=this.distanceToPoint(e),r=this.distanceToPoint(t);return i<0&&r>0||r<0&&i>0},isIntersectionFace:function(e,t){var i=[];i.push(t[e.a]),i.push(t[e.b]),i.push(t[e.c]),null!=e.d&&i.push(t[e.d]);var r,a,n,o=[];for(r=0;r<i.length;r++)o.push(this.distanceToPoint(i[r]));for(r=0;r<o.length;r++)if(0==r)a=n=o[r];else{if(n=o[r],a<0&&n>0||n<0&&a>0)return"intersect";a=n}return n>0?"in":"out"},intersectLine:function(e,i,r){var a=r||new he,n=se.math.Plane.__v1.subVectors(i,e),o=this.normal.dot(n);if(0==o)return 0==this.distanceToPoint(e)?a.copy(e):t;var s=-(e.dot(this.normal)+this.constant)/o;return s<0||s>1?t:a.copy(n).multiplyScalar(s).add(e)},coplanarPoint:function(e){return(e||new he).copy(this.normal).multiplyScalar(-this.constant)},transform:function(e,t){t=t||(new se.Mat3).getInverse(e).transpose();var i=se.math.Plane.__v1.copy(this.normal).applyMatrix3(t),r=this.coplanarPoint(se.math.Plane.__v2);return r.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(i,r),this},translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new se.math.Plane).copy(this)}},se.math.Plane.__vZero=new he(0,0,0),se.math.Plane.__v1=new he,se.math.Plane.__v2=new he,se.Frustum=function(e,i,r,a,n,o){this.planes=[e!==t?e:new se.math.Plane,i!==t?i:new se.math.Plane,r!==t?r:new se.math.Plane,a!==t?a:new se.math.Plane,n!==t?n:new se.math.Plane,o!==t?o:new se.math.Plane]},se.Frustum.prototype={set:function(e,t,i,r,a,n){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(a),o[5].copy(n),this},setPoints:function(e){this.points=e},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],a=i[1],n=i[2],o=i[3],s=i[4],l=i[5],h=i[6],c=i[7],u=i[8],f=i[9],p=i[10],d=i[11],m=i[12],g=i[13],y=i[14],v=i[15];return t[0].setComponents(o-r,c-s,d-u,v-m).normalize(),t[1].setComponents(o+r,c+s,d+u,v+m).normalize(),t[2].setComponents(o+a,c+l,d+f,v+g).normalize(),t[3].setComponents(o-a,c-l,d-f,v-g).normalize(),t[4].setComponents(o-n,c-h,d-p,v-y).normalize(),t[5].setComponents(o+n,c+h,d+p,v+y).normalize(),this},intersectsObjectAccurate:function(e,t){if(0==t)return this.intersectsObject(e);var i,r,a=e.worldMatrix,n=(this.planes,e.vertices),o=[],s=n.length;for(r=0;r<s;r++)if((i=n[r].clone()).applyMatrix4(a),o.push(i),this.containsPoint(i))return!0;if(2==t)if(e instanceof se.Line)for(r=0,s=o.length;r<s-1;r++){var l=o[r],h=o[r+1];if(this.containsLine(l,h))return!0}else{var c,u=e.faces;for(r=0,s=u.length;r<s;r++){if(c=u[r],this.containsLine(o[c.a],o[c.b]))return!0;if(this.containsLine(o[c.b],o[c.c]))return!0;if(null!=c.d){if(this.containsLine(o[c.c],o[c.d]))return!0;if(this.containsLine(o[c.d],o[c.a]))return!0}else if(this.containsLine(o[c.a],o[c.c]))return!0}}return!1},intersectsObject:function(e){var t=e.worldMatrix,i=this.planes,r=t.getPosition();if(!e.computeBoundingSphere)return!1;e.boundingSphere||e.computeBoundingSphere();for(var a=-e.boundingSphere.radius*t.getMaxScaleOnAxis(),n=0;n<6;n++)if(i[n].distanceToPoint(r)<a)return!1;return!0},intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,a=0;a<6;a++)if(t[a].distanceToPoint(i)<r)return!1;return!0},intersectsBox:function(e){for(var t=new he,i=new he,r=this.planes,a=0;a<6;a++){var n=r[a];t.x=n.normal.x>0?e.min.x:e.max.x,i.x=n.normal.x>0?e.max.x:e.min.x,t.y=n.normal.y>0?e.min.y:e.max.y,i.y=n.normal.y>0?e.max.y:e.min.y,t.z=n.normal.z>0?e.min.z:e.max.z,i.z=n.normal.z>0?e.max.z:e.min.z;var o=n.distanceToPoint(t),s=n.distanceToPoint(i);if(o<0&&s<0)return!1}return!0},containsLine:function(e,t){for(var i=this.planes,r=new he,a=0;a<6;a++)if((r=i[a].intersectLine(e,t,r))&&this.containsPoint(r))return!0;return!1},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new se.Frustum).copy(this)}},se.Ray=function(e,i){this.origin=e!==t?e:new he,this.direction=i!==t?i:new he},se.Ray.prototype={constructor:se.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new he).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(e){return this.origin.copy(this.at(e,se.Ray.__v1)),this},closestPointToPoint:function(e,t){var i=t||new he;i.subVectors(e,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){var t=se.Ray.__v1.subVectors(e,this.origin).dot(this.direction);return se.Ray.__v1.copy(this.direction).multiplyScalar(t).add(this.origin),se.Ray.__v1.distanceTo(e)},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){return 0!=e.normal.dot(this.direction)||0==e.distanceToPoint(this.origin)},distanceToPlane:function(e){var i=e.normal.dot(this.direction);return 0==i?0==e.distanceToPoint(this.origin)?0:t:-(this.origin.dot(e.normal)+e.constant)/i},intersectPlane:function(e,i){var r=this.distanceToPlane(e);return r===t?t:this.at(r,i)},transform:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},distanceSqToSegment:function(e,t,i,r){var a,n,o,s,l=e.clone().add(t).multiplyScalar(.5),h=t.clone().sub(e).normalize(),c=.5*e.distanceTo(t),u=this.origin.clone().sub(l),f=-this.direction.dot(h),p=u.dot(this.direction),d=-u.dot(h),m=u.lengthSq(),g=Math.abs(1-f*f);if(g>=0)if(a=f*d-p,n=f*p-d,s=c*g,a>=0)if(n>=-s)if(n<=s){var y=1/g;o=(a*=y)*(a+f*(n*=y)+2*p)+n*(f*a+n+2*d)+m}else n=c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;else n=-c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;else n<=-s?o=-(a=Math.max(0,-(-f*c+p)))*a+(n=a>0?-c:Math.min(Math.max(-c,-d),c))*(n+2*d)+m:n<=s?(a=0,o=(n=Math.min(Math.max(-c,-d),c))*(n+2*d)+m):o=-(a=Math.max(0,-(f*c+p)))*a+(n=a>0?c:Math.min(Math.max(-c,-d),c))*(n+2*d)+m;else n=f>0?-c:c,o=-(a=Math.max(0,-(f*n+p)))*a+n*(n+2*d)+m;return i&&i.copy(this.direction.clone().multiplyScalar(a).add(this.origin)),r&&r.copy(h.clone().multiplyScalar(n).add(l)),o},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new se.Ray).copy(this)}},se.Ray.__v1=new he,se.Ray.__v2=new he,se.Triangle=function(e,i,r){this.a=e!==t?e:new he,this.b=i!==t?i:new he,this.c=r!==t?r:new he},se.Triangle.normal=function(e,t,i,r){var a=r||new he;a.subVectors(i,t),se.Triangle.__v0.subVectors(e,t),a.cross(se.Triangle.__v0);var n=a.lengthSq();return n>0?a.multiplyScalar(1/Math.sqrt(n)):a.set(0,0,0)},se.Triangle.barycoordFromPoint=function(e,t,i,r,a){se.Triangle.__v0.subVectors(r,t),se.Triangle.__v1.subVectors(i,t),se.Triangle.__v2.subVectors(e,t);var n=se.Triangle.__v0.dot(se.Triangle.__v0),o=se.Triangle.__v0.dot(se.Triangle.__v1),s=se.Triangle.__v0.dot(se.Triangle.__v2),l=se.Triangle.__v1.dot(se.Triangle.__v1),h=se.Triangle.__v1.dot(se.Triangle.__v2),c=n*l-o*o,u=a||new he;if(0==c)return u.set(-2,-1,-1);var f=1/c,p=(l*s-o*h)*f,d=(n*h-o*s)*f;return u.set(1-p-d,d,p)},se.Triangle.containsPoint=function(e,t,i,r){var a=se.Triangle.barycoordFromPoint(e,t,i,r,se.Triangle.__v3);return a.x>=0&&a.y>=0&&a.x+a.y<=1},se.Triangle.prototype={constructor:se.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){return se.Triangle.__v0.subVectors(this.c,this.b),se.Triangle.__v1.subVectors(this.a,this.b),.5*se.Triangle.__v0.cross(se.Triangle.__v1).length()},midpoint:function(e){return(e||new he).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return se.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new se.math.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return se.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return se.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new se.Triangle).copy(this)},intersectLine:function(e,t){var i=this.plane().intersectLine(e,t);return null!=i&&this.containsPoint(i)}},se.Triangle.__v0=new he,se.Triangle.__v1=new he,se.Triangle.__v2=new he,se.Triangle.__v3=new he,se.Box2=function(e,i){this.min=e!==t?e:new le(1/0,1/0),this.max=i!==t?i:new le(-1/0,-1/0)},se.Box2.prototype={constructor:se.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new le;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){var t=e||new le;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new le;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new le).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new le).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new le;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};var fe={getLogicalPoint:function(e,t){var i,r=e.getBoundingClientRect();if(pe.isTouchable&&t.changedTouches&&t.changedTouches.length>0){var a=t.changedTouches[0],n=pe.isAndroid?0:$touch.scrollLeft(),o=pe.isAndroid?0:$touch.scrollTop();i={x:a.clientX+e.scrollLeft-r.left-n,y:a.clientY+e.scrollTop-r.top-o}}else{if(!fe.isValidEvent(e,t))return null;i={x:t.clientX-r.left+e.scrollLeft,y:t.clientY-r.top+e.scrollTop}}return i},isValidEvent:function(e,t){if(!t)return!1;if(t.target===e)if(pe.isFirefox){if(e.clientHeight<e.scrollHeight&&t.layerX<25)return!1;if(e.clientWidth<e.scrollWidth&&t.layerY<25)return!1}else if(t.offsetX>e.clientWidth||t.offsetY>e.clientHeight)return!1;return!0},isImage:function(e){return e&&e.nodeName&&"img"===e.nodeName.toLowerCase()},isCanvas:function(e){return e&&e.nodeName&&"canvas"===e.nodeName.toLowerCase()},createView:function(e,t){var i=document.createElement("div");return i.style.position=Te.VIEW_POSITION,i.style.fontSize=Te.VIEW_FONT_SIZE,i.style.fontFamily=Te.VIEW_FONT_FAMILY,i.style.cursor="default",i.style.outline="none",i.style.textAlign="left",i.style.msTouchAction="none",i.tabIndex=0,t||(i.onmousedown=fe.preventDefault),i.style.setProperty&&(i.style.setProperty("-khtml-user-select","none",null),i.style.setProperty("-webkit-user-select","none",null),i.style.setProperty("-moz-user-select","none",null),i.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),e&&(i.style.overflow=e),i},preventDefault:function(e){Te.KEEP_DEFAULT_FUNCTION(e)||(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)},createCanvas:function(e){var t=document.createElement("canvas"),i=e.getView();return t.width=i.width,t.height=i.height,t.style.msTouchAction="none",t.style.position="absolute",t},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},getScrollTop:function(e){if(!e)return 0;var t=e.scrollTop,i=e.parentElement;return t+this.getScrollTop(i)},getScrollLeft:function(e){if(!e)return 0;var t=e.scrollLeft,i=e.parentElement;return t+this.getScrollLeft(i)},debug:function(e,t){try{e.call(t)}catch(e){alert(e)}},setFocus:function(e){if(document.activeElement!==e){var t,i,r,a=document.documentElement;document.body;a&&(pe.isIE||pe.isOpera||a.scrollLeft||a.scrollTop)&&(t=a.scrollLeft,i=a.scrollTop,r=a),e.focus(),r&&(r.scrollLeft=t,r.scrollTop=i)}},isRightClick:function(t){var i;if(!t)var t=e.event;return t.which?i=3==t.which:t.button&&(i=2==t.button),i}};se.html=fe;var pe=function(){var e={},t=navigator.userAgent.toLowerCase();return e.isOpera=/opera/.test(t),e.isIE=/msie/.test(t)||/trident/.test(t),e.isFirefox=/firefox/i.test(t),e.isChrome=/chrome/i.test(t),e.isSafari=!e.isChrome&&/safari/i.test(t),e.isIPhone=/iphone/.test(t),e.isIPod=/ipod/.test(t),e.isIPad=/ipad/.test(t),e.isAndroid=/android/i.test(t),e.isWebOS=/webos/i.test(t),e.isMSToucheable=navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,e.isTouchable="ontouchend"in document||e.isMSToucheable,e.isIOS=e.isIPhone||e.isIPod||e.isIPad,e}();se.ua=pe,function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);e.btoa||(e.btoa=function(e){var i,r,a,n,o,s;for(a=e.length,r=0,i="";r<a;){if(n=255&e.charCodeAt(r++),r==a){i+=t.charAt(n>>2),i+=t.charAt((3&n)<<4),i+="==";break}if(o=e.charCodeAt(r++),r==a){i+=t.charAt(n>>2),i+=t.charAt((3&n)<<4|(240&o)>>4),i+=t.charAt((15&o)<<2),i+="=";break}s=e.charCodeAt(r++),i+=t.charAt(n>>2),i+=t.charAt((3&n)<<4|(240&o)>>4),i+=t.charAt((15&o)<<2|(192&s)>>6),i+=t.charAt(63&s)}return i}),e.atob||(e.atob=function(e){var t,r,a,n,o,s,l;for(s=e.length,o=0,l="";o<s;){do{t=i[255&e.charCodeAt(o++)]}while(o<s&&-1==t);if(-1==t)break;do{r=i[255&e.charCodeAt(o++)]}while(o<s&&-1==r);if(-1==r)break;l+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(a=255&e.charCodeAt(o++)))return l;a=i[a]}while(o<s&&-1==a);if(-1==a)break;l+=String.fromCharCode((15&r)<<4|(60&a)>>2);do{if(61==(n=255&e.charCodeAt(o++)))return l;n=i[n]}while(o<s&&-1==n);if(-1==n)break;l+=String.fromCharCode((3&a)<<6|n)}return l})}();var de=function(){var t=!1,i=document.createElement("canvas");if(i.getContext("2d")&&(t=!0),!t)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var r=!!i.getContext("2d").getImageData,a=!!i.toDataURL,n=!!e.btoa,o=function(e){var t=parseInt(e.width),i=parseInt(e.height);return e.getContext("2d").getImageData(0,0,t,i)},s=function(e){var t="";if("string"==typeof e)t=e;else for(var i=e,r=0;r<i.length;r++)t+=String.fromCharCode(i[r]);return btoa(t)},l=function(e){var t=[],i=e.width,r=e.height;t.push(66),t.push(77);var a=i*r*3+54;t.push(a%256),a=Math.floor(a/256),t.push(a%256),a=Math.floor(a/256),t.push(a%256),a=Math.floor(a/256),t.push(a%256),t.push(0),t.push(0),t.push(0),t.push(0),t.push(54),t.push(0),t.push(0),t.push(0);var n=[];n.push(40),n.push(0),n.push(0),n.push(0);var o=i;n.push(o%256),o=Math.floor(o/256),n.push(o%256),o=Math.floor(o/256),n.push(o%256),o=Math.floor(o/256),n.push(o%256);var l=r;n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256),l=Math.floor(l/256),n.push(l%256),n.push(1),n.push(0),n.push(24),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0);var h=i*r*3;n.push(h%256),h=Math.floor(h/256),n.push(h%256),h=Math.floor(h/256),n.push(h%256),h=Math.floor(h/256),n.push(h%256);for(var c=0;c<16;c++)n.push(0);var u=(4-3*i%4)%4,f=e.data,p="",d=r;do{for(var m=i*(d-1)*4,g="",y=0;y<i;y++){var v=4*y;g+=String.fromCharCode(f[m+v+2]),g+=String.fromCharCode(f[m+v+1]),g+=String.fromCharCode(f[m+v])}for(var x=0;x<u;x++)g+=String.fromCharCode(0);p+=g}while(--d);return s(t.concat(n))+s(p)},h=function(e,t){return"data:"+t+";base64,"+e},c=function(e){var t=document.createElement("img");return t.src=e,t},u=function(e,t,i,r,a){i=i||(t?t.w:e.width),r=r||(t?t.h:e.height);var n=document.createElement("canvas");n.width=i,n.height=r,n.style.width=i+"px",n.style.height=r+"px";var o=n.getContext("2d"),o=n.getContext("2d"),s=e.style.backgroundColor;return s||(s="PNG"===a?"rgba(255,255,255,0.0)":"BMP"===a?"rgba(255,255,255,0.01)":"#FFFFFF"),o.fillStyle=s,o.fillRect(0,0,i,r),t=t||{x:0,y:0,w:e.width,h:e.height},o.drawImage(e,t.x,t.y,t.w,t.h,0,0,i,r),n};return{saveAsPNG:function(e,t,i,r,n){if(!a)return!1;var o=u(e,t,r,n,"PNG").toDataURL("image/png");return i?c(o):o},saveAsJPEG:function(e,t,i,r,n){if(!a)return!1;var o=u(e,t,r,n,"JPEG").toDataURL("image/jpeg");return 5==o.indexOf("image/jpeg")&&(i?c(o):o)},saveAsBMP:function(e,t,i,a,s){if(!r||!n)return!1;var f=u(e,t,a,s,"BMP"),p=o(f),d=l(p);return i?c(h(d,"image/bmp")):h(d,"image/bmp")}}}(),me={},ge={cache:{},g:document.createElement("canvas").getContext("2d"),getTextSize:function(e,t){ge.g.font=e||Te.FONT;var i=ge.cache[ge.g.font];return i||(i=2*ge.g.measureText("e").width+4,ge.cache[ge.g.font]=i),{width:ge.g.measureText(t).width+4,height:i}}};me.g=ge,se.g=ge;var ye={};setTimeout;ye.bcld=function(e,t,i,r,a,n,o,s,l){var h,c,u=e/2,f=[],p=[],d={vertices:[],faces:[],uvs:[],uv2s:[]};for(c=0;c<=t;c++){var m=[],g=[],y=c/t,v=y*(i-r)+r;for(h=0;h<=a;h++){var x=h/a,A=new he;A.x=v*Math.sin(x*s+l),A.y=-y*e+u,A.z=v*Math.cos(x*s+l),d.vertices.push(A),m.push(d.vertices.length-1),g.push(new le(x,1-y))}f.push(m),p.push(g)}var _,w,b=(i-r)/e;for(h=0;h<a;h++)for(0!==r?(_=d.vertices[f[0][h]].clone(),w=d.vertices[f[0][h+1]].clone()):(_=d.vertices[f[1][h]].clone(),w=d.vertices[f[1][h+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),c=0;c<t;c++){var M=f[c][h],S=f[c+1][h],P=f[c+1][h+1],C=f[c][h+1],T=_.clone(),E=_.clone(),z=w.clone(),D=w.clone(),L=p[c][h].clone(),R=p[c+1][h].clone(),N=p[c+1][h+1].clone(),B=p[c][h+1].clone();d.faces.push(new Se(M,S,C,[T,E,D],null,0)),d.uvs.push([L,R,B]),d.uv2s.push([L.clone(),R.clone(),B.clone()]),d.faces.push(new Se(S,P,C,[E,z,D],null,0)),d.uvs.push([R,N,B]),d.uv2s.push([R.clone(),N.clone(),B.clone()])}var I=!1;if(!1===n&&r>0)for(d.vertices.push(new he(0,u,0)),I=!0,h=0;h<a;h++){var M=f[0][h],S=f[0][h+1],P=d.vertices.length-1,T=new he(0,1,0),E=new he(0,1,0),z=new he(0,1,0),F=d.vertices[M],V=d.vertices[S],L=new le((F.x/r+1)/2,1-(F.z/r+1)/2),R=new le((V.x/r+1)/2,1-(V.z/r+1)/2),N=new le(.5,.5);d.faces.push(new Se(M,S,P,[T,E,z],null,1)),d.uvs.push([L,R,N]),d.uv2s.push([L.clone(),R.clone(),N.clone()])}var U=!1;if(!1===o&&i>0)for(d.vertices.push(new he(0,-u,0)),U=!0,h=0;h<a;h++){var M=f[c][h+1],S=f[c][h],P=d.vertices.length-1,T=new he(0,-1,0),E=new he(0,-1,0),z=new he(0,-1,0),F=d.vertices[M],V=d.vertices[S],L=new le((F.x/i+1)/2,(F.z/i+1)/2),R=new le((V.x/i+1)/2,(V.z/i+1)/2),N=new le(.5,.5);d.faces.push(new Se(M,S,P,[T,E,z],null,2)),d.uvs.push([L,R,N]),d.uv2s.push([L.clone(),R.clone(),N.clone()])}if(s!==2*Math.PI){!I&&d.vertices.push(new he(0,u,0)),!U&&d.vertices.push(new he(0,-u,0));var M=f[0][0],S=f[t][0],P=d.vertices.length-1,C=d.vertices.length-2,L=new le(0,0),R=new le(0,1),N=new le(1,1),B=new le(1,0);d.faces.push(new Se(M,P,S)),d.uvs.push([L,N,R]),d.uv2s.push([L.clone(),N.clone(),R.clone()]),d.faces.push(new Se(C,P,M)),d.uvs.push([B,N,L]),d.uv2s.push([B.clone(),N.clone(),L.clone()]),M=f[0][a],S=f[t][a];var L=new le(0,0),R=new le(0,1),N=new le(1,1),B=new le(1,0);d.faces.push(new Se(M,S,C)),d.uvs.push([L,R,B]),d.uv2s.push([L.clone(),R.clone(),B.clone()]),d.faces.push(new Se(S,P,C)),d.uvs.push([R,N,B]),d.uv2s.push([R.clone(),N.clone(),B.clone()])}return d},ye.buildCubeData=function(e,t,i,r,a,n,o,s){function l(l){var d,m,g,y,v,x,A,_,w,b;h=c.length;var M,S="six-each"==o||"front-other"==o||"back-other"==o||"left-other"==o||"right-other"==o||"top-other"==o||"bottom-other"==o,P=new le(0,0),C=S?new le(1/3,.5):new le(1,1),T=o.split("-")[0];"six"==T?T=null:C=new le(.5,1),"right"==l?(d="z",m="y",g="x",y=-1,v=-1,x=e/2,A=i,_=t,w=n,b=a,M=0,P=new le(2/3,0)):"left"==l?(d="z",m="y",g="x",y=1,v=-1,x=-e/2,A=i,_=t,w=n,b=a,M=1):"top"==l?(d="x",m="z",g="y",y=1,v=1,x=t/2,A=e,_=i,w=r,b=n,M=2,P=new le(1/3,.5)):"bottom"==l?(d="x",m="z",g="y",y=1,v=-1,x=-t/2,A=e,_=i,w=r,b=n,M=3,P=new le(0,.5)):"front"==l?(d="x",m="y",g="z",y=1,v=-1,x=i/2,A=e,_=t,w=r,b=a,M=4,P=new le(1/3,0)):"back"==l&&(d="x",m="y",g="z",y=-1,v=-1,x=-i/2,A=e,_=t,w=r,b=a,M=5,P=new le(2/3,.5)),T&&(P=T==l?new le(0,0):new le(.5,0));var E,z,D=w+1,L=b+1;for(z=0;z<L;z++)for(E=0;E<D;E++){var R=new he;R[d]=(E/w*A-A/2)*y+s[d],R[m]=(z/b*_-_/2)*v+s[m],R[g]=x+s[g],c.push(R)}S&&(M=0);var N=new he;for(N[g]=x>0?1:-1,z=0;z<b;z++)for(E=0;E<w;E++){var B=E+D*z,I=E+D*(z+1),F=E+1+D*(z+1),V=E+1+D*z,U=[new le(E/w,1-z/b),new le(E/w,1-(z+1)/b),new le((E+1)/w,1-(z+1)/b),new le((E+1)/w,1-z/b)];if(S)for(var k=0;k<U.length;k++)U[k].multiply(C).add(P);var O=new Pe(B+h,I+h,F+h,V+h);O.normal.copy(N),O.vertexNormals.push(N.clone(),N.clone(),N.clone(),N.clone()),O.materialIndex=M,u.push(O),f.push([U[0],U[1],U[2],U[3]]),p.push([U[0].clone(),U[1].clone(),U[2].clone(),U[3].clone()])}}var h,c=[],u=[],f=[],p=[];return l("right"),l("left"),l("top"),l("bottom"),l("front"),l("back"),{vertices:c,faces:u,uvs:f,uv2s:p}},ye.bsd=function(e,t,i,r,a,n,o){var s,l,h=[],c=[],u=[],f=[],p=[],d=[];for(l=0;l<=i;l++){var m=[],g=[];for(s=0;s<=t;s++){var y=s/t,v=l/i,x=new he;x.x=-e*Math.cos(r+y*a)*Math.sin(n+v*o),x.y=e*Math.cos(n+v*o),x.z=e*Math.sin(r+y*a)*Math.sin(n+v*o),h.push(x),m.push(h.length-1),g.push(new le(y,1-v))}p.push(m),d.push(g)}for(l=0;l<i;l++)for(s=0;s<t;s++){var A=p[l][s+1],_=p[l][s],w=p[l+1][s],b=p[l+1][s+1],M=h[A].clone().normalize(),S=h[_].clone().normalize(),P=h[w].clone().normalize(),C=h[b].clone().normalize(),T=d[l][s+1].clone(),E=d[l][s].clone(),z=d[l+1][s].clone(),D=d[l+1][s+1].clone();Math.abs(h[A].y)===e?(u.push(new Se(A,w,b,[M,P,C])),c.push([T,z,D]),f.push([T.clone(),z.clone(),D.clone()])):Math.abs(h[w].y)===e?(u.push(new Se(A,_,w,[M,S,P])),c.push([T,E,z]),f.push([T.clone(),E.clone(),z.clone()])):(u.push(new Se(A,_,b,[M,S,C])),c.push([T,E,D]),f.push([T.clone(),E.clone(),D.clone()]),u.push(new Se(_,w,b,[S.clone(),P,C.clone()])),c.push([E.clone(),z,D.clone()]),f.push([E.clone(),z.clone(),D.clone()]))}return{vertices:h,faces:u,uvs:c,uv2s:f}};var ve=function(e){var i,r,a,n,o,s,l,h={},c=e.primitive;if(c.groups)return e.groups=c.groups,void(e.groupList=c.groupList);c.groups={};var u=e.material,f=e.getMaterialMapping();for(i=0,r=c.faces.length;i<r;i++)a=c.faces[i],h[s=(n=f[n=u instanceof se.ArrayMaterial?a.materialIndex:0])!==t?n:-1]===t&&(h[s]={hash:s,counter:0}),l=h[s].hash+"_"+h[s].counter,c.groups[l]===t&&(c.groups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0}),o=a instanceof Se?3:4,c.groups[l].vertices+o>65535&&(h[s].counter+=1,l=h[s].hash+"_"+h[s].counter,c.groups[l]===t&&(c.groups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0})),a instanceof Se?c.groups[l].faces3.push(i):c.groups[l].faces4.push(i),c.groups[l].vertices+=o;c.groupsList=[];for(var p in e.groups)c.groupsList.push(e.groups[p]);e.groups=c.groups,e.groupList=c.groupsList},xe=function(e,i,r,a){var n,o,s,l,h,c,u,f,p,d,m,g,y,v,x=e,A=x,_=A.vertices,w=_.length,b=A.colors,M=b.length,S=A.sizes,P=S.length,C=a.__vertexArray,T=a.__colorArray,E=a.__normalArray,z=a.__sortArray,D=A.verticesNeedUpdate,L=(A.elementsNeedUpdate,A.normalsNeedUpdate),R=A.colorsNeedUpdate,N=A.__webglCustomAttributesList;if(P<w&&(P=w),x.sortParticles){for(_projScreenMatrixPS.copy(_projScreenMatrix),_projScreenMatrixPS.multiply(x.matrixWorld),n=0;n<w;n++)l=_[n],_vector3.copy(l),_vector3.applyProjection(_projScreenMatrixPS),z[n]=[_vector3.z,n];for(z.sort(numericalSort),n=0;n<w;n++)l=_[z[n][1]],C[h=3*n]=l.x,C[h+1]=l.y,C[h+2]=l.z;for(o=0;o<M;o++)h=3*o,u=b[z[o][1]],T[h]=u.r,T[h+1]=u.g,T[h+2]=u.b;for(s=0;s<P;s++)h=3*s,f=null==(f=S[z[s][1]])?1:f,E[h]=null==f.x?f||1:f.x,E[h+1]=0,E[h+2]=0;if(N)for(p=0,d=N.length;p<d;p++)if((v=N[p]).boundTo===t||"vertices"===v.boundTo)if(h=0,g=v.value.length,1===v.size)for(m=0;m<g;m++)c=z[m][1],v.array[m]=v.value[c];else if(2===v.size)for(m=0;m<g;m++)c=z[m][1],y=v.value[c],v.array[h]=y.x,v.array[h+1]=y.y,h+=2;else if(3===v.size)if("c"===v.type)for(m=0;m<g;m++)c=z[m][1],y=v.value[c],v.array[h]=y.r,v.array[h+1]=y.g,v.array[h+2]=y.b,h+=3;else for(m=0;m<g;m++)c=z[m][1],y=v.value[c],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,h+=3;else if(4===v.size)for(m=0;m<g;m++)c=z[m][1],y=v.value[c],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,v.array[h+3]=y.w,h+=4}else{if(D)for(n=0;n<w;n++)l=_[n],C[h=3*n]=l.x,C[h+1]=l.y,C[h+2]=l.z;if(R)for(o=0;o<M;o++)u=b[o],T[h=3*o]=u.r,T[h+1]=u.g,T[h+2]=u.b;if(L)for(s=0;s<P;s++)f=null==S[s]?1:S[s],E[h=3*s]=null==f.x?f||1:f.x,E[h+1]=0,E[h+2]=0;if(N)for(p=0,d=N.length;p<d;p++)if((v=N[p]).needsUpdate&&(v.boundTo===t||"vertices"===v.boundTo))if(g=v.value.length,h=0,1===v.size)for(m=0;m<g;m++)v.array[m]=v.value[m];else if(2===v.size)for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.x,v.array[h+1]=y.y,h+=2;else if(3===v.size)if("c"===v.type)for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.r,v.array[h+1]=y.g,v.array[h+2]=y.b,h+=3;else for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,h+=3;else if(4===v.size)for(m=0;m<g;m++)y=v.value[m],v.array[h]=y.x,v.array[h+1]=y.y,v.array[h+2]=y.z,v.array[h+3]=y.w,h+=4}if((D||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,C,i)),(R||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,T,i)),(L||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,a.__webglNormalBuffer),r.bufferData(r.ARRAY_BUFFER,E,i)),N)for(p=0,d=N.length;p<d;p++)((v=N[p]).needsUpdate||x.sortParticles)&&(r.bindBuffer(r.ARRAY_BUFFER,v.buffer),r.bufferData(r.ARRAY_BUFFER,v.array,i))};ye.buildGroupBufferData=function(e,i,r,a,n,o,s,l){n._type;var h=n.isVertexColor(),c=n.needUV();var u,f,p,d,m,g,y,v,x,A,_,w,b,M,S,P,C,T,E,z,D,L,R,N,B,I=l.needSmoothNormal(i,n),F=0,V=0,U=0,k=0,O=0,X=0,G=0,Y=0,W=0,j=s.__vertexArray,H=s.__uvArray,q=s.__uv2Array,Z=s.__normalArray,Q=s.__colorArray,K=s.__webglCustomAttributesList,J=s.__faceArray,$=s.__lineArray,ee=i,te=ee.verticesNeedUpdate,ie=ee.elementsNeedUpdate,re=ee.uvsNeedUpdate,ae=ee.normalsNeedUpdate,ne=ee.colorsNeedUpdate,oe=ee.vertices,le=e.faces3,he=e.faces4,ce=ee.faces,ue=ee.colors,fe=ee.uvs,pe=ee.uv2s;ee.colors;if(te){for(u=0,f=le.length;u<f;u++)_=oe[(d=ce[le[u]]).a],w=oe[d.b],b=oe[d.c],j[V]=_.x,j[V+1]=_.y,j[V+2]=_.z,j[V+3]=w.x,j[V+4]=w.y,j[V+5]=w.z,j[V+6]=b.x,j[V+7]=b.y,j[V+8]=b.z,V+=9;for(u=0,f=he.length;u<f;u++)_=oe[(d=ce[he[u]]).a],w=oe[d.b],b=oe[d.c],M=oe[d.d],j[V]=_.x,j[V+1]=_.y,j[V+2]=_.z,j[V+3]=w.x,j[V+4]=w.y,j[V+5]=w.z,j[V+6]=b.x,j[V+7]=b.y,j[V+8]=b.z,j[V+9]=M.x,j[V+10]=M.y,j[V+11]=M.z,V+=12;o.bindBuffer(o.ARRAY_BUFFER,s.__webglVertexBuffer),o.bufferData(o.ARRAY_BUFFER,j,r),s.__vertexArray=j}if(ne&&h){for(u=0,f=le.length;u<f;u++)y=(d=ce[le[u]]).vertexColors,ue&&ue.length>0&&(y[0]=ue[d.a],y[1]=ue[d.b],y[2]=ue[d.c]),v=d.color,3===y.length&&h===se.VertexColors?(S=y[0],P=y[1],C=y[2]):(S=v,P=v,C=v),Q[Y]=S.r,Q[Y+1]=S.g,Q[Y+2]=S.b,Q[Y+3]=P.r,Q[Y+4]=P.g,Q[Y+5]=P.b,Q[Y+6]=C.r,Q[Y+7]=C.g,Q[Y+8]=C.b,Y+=9;for(u=0,f=he.length;u<f;u++)y=(d=ce[he[u]]).vertexColors,v=d.color,4===y.length&&h===se.VertexColors?(S=y[0],P=y[1],C=y[2],T=y[3]):(S=v,P=v,C=v,T=v),Q[Y]=S.r,Q[Y+1]=S.g,Q[Y+2]=S.b,Q[Y+3]=P.r,Q[Y+4]=P.g,Q[Y+5]=P.b,Q[Y+6]=C.r,Q[Y+7]=C.g,Q[Y+8]=C.b,Q[Y+9]=T.r,Q[Y+10]=T.g,Q[Y+11]=T.b,Y+=12;Y>0&&(o.bindBuffer(o.ARRAY_BUFFER,s.__webglColorBuffer),o.bufferData(o.ARRAY_BUFFER,Q,r))}if(ae){for(u=0,f=le.length;u<f;u++)if(d=ce[le[u]],m=d.vertexNormals,g=d.normal,3===m.length&&I)for(E=0;E<3;E++)D=m[E],Z[X]=D.x,Z[X+1]=D.y,Z[X+2]=D.z,X+=3;else for(E=0;E<3;E++)Z[X]=g.x,Z[X+1]=g.y,Z[X+2]=g.z,X+=3;for(u=0,f=he.length;u<f;u++)if(d=ce[he[u]],m=d.vertexNormals,g=d.normal,4===m.length&&I)for(E=0;E<4;E++)D=m[E],null==Z&&console.log("normal array is null"),Z[X]=D.x,Z[X+1]=D.y,Z[X+2]=D.z,X+=3;else for(E=0;E<4;E++)Z[X]=g.x,Z[X+1]=g.y,Z[X+2]=g.z,X+=3;o.bindBuffer(o.ARRAY_BUFFER,s.__webglNormalBuffer),o.bufferData(o.ARRAY_BUFFER,Z,r),s.__normalArray=Z}if(re&&fe&&c){for(u=0,f=le.length;u<f;u++)if(p=le[u],(x=fe[p])!==t)for(E=0;E<3;E++)L=x[E],H[U]=L.x,H[U+1]=L.y,U+=2;for(u=0,f=he.length;u<f;u++)if(p=he[u],(x=fe[p])!==t)for(E=0;E<4;E++)L=x[E],H[U]=L.x,H[U+1]=L.y,U+=2;U>0&&(o.bindBuffer(o.ARRAY_BUFFER,s.__webglUVBuffer),o.bufferData(o.ARRAY_BUFFER,H,r),s.uvArray=H)}if(re&&pe&&c){for(u=0,f=le.length;u<f;u++)if(p=le[u],(A=pe[p])!==t)for(E=0;E<3;E++)R=A[E],q[k]=R.x,q[k+1]=R.y,k+=2;for(u=0,f=he.length;u<f;u++)if(p=he[u],(A=pe[p])!==t)for(E=0;E<4;E++)R=A[E],q[k]=R.x,q[k+1]=R.y,k+=2;k>0&&(o.bindBuffer(o.ARRAY_BUFFER,s.__webglUV2Buffer),o.bufferData(o.ARRAY_BUFFER,q,r))}if(ie){for(u=0,f=le.length;u<f;u++)J[O]=F,J[O+1]=F+1,J[O+2]=F+2,O+=3,$[G]=F,$[G+1]=F+1,$[G+2]=F,$[G+3]=F+2,$[G+4]=F+1,$[G+5]=F+2,G+=6,F+=3;for(u=0,f=he.length;u<f;u++)J[O]=F,J[O+1]=F+1,J[O+2]=F+3,J[O+3]=F+1,J[O+4]=F+2,J[O+5]=F+3,O+=6,$[G]=F,$[G+1]=F+1,$[G+2]=F,$[G+3]=F+3,$[G+4]=F+1,$[G+5]=F+2,$[G+6]=F+2,$[G+7]=F+3,G+=8,F+=4;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,J,r),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,$,r),s.__lineArray=$}if(K)for(E=0,z=K.length;E<z;E++)if((B=K[E]).__original.needsUpdate){if(W=0,0,1===B.size){if(B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],B.array[W]=B.value[d.a],B.array[W+1]=B.value[d.b],B.array[W+2]=B.value[d.c],W+=3;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],B.array[W]=B.value[d.a],B.array[W+1]=B.value[d.b],B.array[W+2]=B.value[d.c],B.array[W+3]=B.value[d.d],W+=4}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)N=B.value[le[u]],B.array[W]=N,B.array[W+1]=N,B.array[W+2]=N,W+=3;for(u=0,f=he.length;u<f;u++)N=B.value[he[u]],B.array[W]=N,B.array[W+1]=N,B.array[W+2]=N,B.array[W+3]=N,W+=4}}else if(2===B.size){if(B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=w.x,B.array[W+3]=w.y,B.array[W+4]=b.x,B.array[W+5]=b.y,W+=6;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],M=B.value[d.d],B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=w.x,B.array[W+3]=w.y,B.array[W+4]=b.x,B.array[W+5]=b.y,B.array[W+6]=M.x,B.array[W+7]=M.y,W+=8}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=N=B.value[le[u]],w=N,b=N,B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=w.x,B.array[W+3]=w.y,B.array[W+4]=b.x,B.array[W+5]=b.y,W+=6;for(u=0,f=he.length;u<f;u++)_=N=B.value[he[u]],w=N,b=N,M=N,B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=w.x,B.array[W+3]=w.y,B.array[W+4]=b.x,B.array[W+5]=b.y,B.array[W+6]=M.x,B.array[W+7]=M.y,W+=8}}else if(3===B.size){var de;if(de="c"===B.type?["r","g","b"]:["x","y","z"],B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],B.array[W]=_[de[0]],B.array[W+1]=_[de[1]],B.array[W+2]=_[de[2]],B.array[W+3]=w[de[0]],B.array[W+4]=w[de[1]],B.array[W+5]=w[de[2]],B.array[W+6]=b[de[0]],B.array[W+7]=b[de[1]],B.array[W+8]=b[de[2]],W+=9;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],M=B.value[d.d],B.array[W]=_[de[0]],B.array[W+1]=_[de[1]],B.array[W+2]=_[de[2]],B.array[W+3]=w[de[0]],B.array[W+4]=w[de[1]],B.array[W+5]=w[de[2]],B.array[W+6]=b[de[0]],B.array[W+7]=b[de[1]],B.array[W+8]=b[de[2]],B.array[W+9]=M[de[0]],B.array[W+10]=M[de[1]],B.array[W+11]=M[de[2]],W+=12}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=N=B.value[le[u]],w=N,b=N,B.array[W]=_[de[0]],B.array[W+1]=_[de[1]],B.array[W+2]=_[de[2]],B.array[W+3]=w[de[0]],B.array[W+4]=w[de[1]],B.array[W+5]=w[de[2]],B.array[W+6]=b[de[0]],B.array[W+7]=b[de[1]],B.array[W+8]=b[de[2]],W+=9;for(u=0,f=he.length;u<f;u++)_=N=B.value[he[u]],w=N,b=N,M=N,B.array[W]=_[de[0]],B.array[W+1]=_[de[1]],B.array[W+2]=_[de[2]],B.array[W+3]=w[de[0]],B.array[W+4]=w[de[1]],B.array[W+5]=w[de[2]],B.array[W+6]=b[de[0]],B.array[W+7]=b[de[1]],B.array[W+8]=b[de[2]],B.array[W+9]=M[de[0]],B.array[W+10]=M[de[1]],B.array[W+11]=M[de[2]],W+=12}else if("faceVertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=(N=B.value[le[u]])[0],w=N[1],b=N[2],B.array[W]=_[de[0]],B.array[W+1]=_[de[1]],B.array[W+2]=_[de[2]],B.array[W+3]=w[de[0]],B.array[W+4]=w[de[1]],B.array[W+5]=w[de[2]],B.array[W+6]=b[de[0]],B.array[W+7]=b[de[1]],B.array[W+8]=b[de[2]],W+=9;for(u=0,f=he.length;u<f;u++)_=(N=B.value[he[u]])[0],w=N[1],b=N[2],M=N[3],B.array[W]=_[de[0]],B.array[W+1]=_[de[1]],B.array[W+2]=_[de[2]],B.array[W+3]=w[de[0]],B.array[W+4]=w[de[1]],B.array[W+5]=w[de[2]],B.array[W+6]=b[de[0]],B.array[W+7]=b[de[1]],B.array[W+8]=b[de[2]],B.array[W+9]=M[de[0]],B.array[W+10]=M[de[1]],B.array[W+11]=M[de[2]],W+=12}}else if(4===B.size)if(B.boundTo===t||"vertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)d=ce[le[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=_.z,B.array[W+3]=_.w,B.array[W+4]=w.x,B.array[W+5]=w.y,B.array[W+6]=w.z,B.array[W+7]=w.w,B.array[W+8]=b.x,B.array[W+9]=b.y,B.array[W+10]=b.z,B.array[W+11]=b.w,W+=12;for(u=0,f=he.length;u<f;u++)d=ce[he[u]],_=B.value[d.a],w=B.value[d.b],b=B.value[d.c],M=B.value[d.d],B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=_.z,B.array[W+3]=_.w,B.array[W+4]=w.x,B.array[W+5]=w.y,B.array[W+6]=w.z,B.array[W+7]=w.w,B.array[W+8]=b.x,B.array[W+9]=b.y,B.array[W+10]=b.z,B.array[W+11]=b.w,B.array[W+12]=M.x,B.array[W+13]=M.y,B.array[W+14]=M.z,B.array[W+15]=M.w,W+=16}else if("faces"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=N=B.value[le[u]],w=N,b=N,B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=_.z,B.array[W+3]=_.w,B.array[W+4]=w.x,B.array[W+5]=w.y,B.array[W+6]=w.z,B.array[W+7]=w.w,B.array[W+8]=b.x,B.array[W+9]=b.y,B.array[W+10]=b.z,B.array[W+11]=b.w,W+=12;for(u=0,f=he.length;u<f;u++)_=N=B.value[he[u]],w=N,b=N,M=N,B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=_.z,B.array[W+3]=_.w,B.array[W+4]=w.x,B.array[W+5]=w.y,B.array[W+6]=w.z,B.array[W+7]=w.w,B.array[W+8]=b.x,B.array[W+9]=b.y,B.array[W+10]=b.z,B.array[W+11]=b.w,B.array[W+12]=M.x,B.array[W+13]=M.y,B.array[W+14]=M.z,B.array[W+15]=M.w,W+=16}else if("faceVertices"===B.boundTo){for(u=0,f=le.length;u<f;u++)_=(N=B.value[le[u]])[0],w=N[1],b=N[2],B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=_.z,B.array[W+3]=_.w,B.array[W+4]=w.x,B.array[W+5]=w.y,B.array[W+6]=w.z,B.array[W+7]=w.w,B.array[W+8]=b.x,B.array[W+9]=b.y,B.array[W+10]=b.z,B.array[W+11]=b.w,W+=12;for(u=0,f=he.length;u<f;u++)_=(N=B.value[he[u]])[0],w=N[1],b=N[2],M=N[3],B.array[W]=_.x,B.array[W+1]=_.y,B.array[W+2]=_.z,B.array[W+3]=_.w,B.array[W+4]=w.x,B.array[W+5]=w.y,B.array[W+6]=w.z,B.array[W+7]=w.w,B.array[W+8]=b.x,B.array[W+9]=b.y,B.array[W+10]=b.z,B.array[W+11]=b.w,B.array[W+12]=M.x,B.array[W+13]=M.y,B.array[W+14]=M.z,B.array[W+15]=M.w,W+=16}o.bindBuffer(o.ARRAY_BUFFER,B.buffer),o.bufferData(o.ARRAY_BUFFER,B.array,r)}a&&ye.deleteGroupBufferData(e)},ye.buildLineBufferData=function(e,i,r,a){var n,o,s,l,h,c,u,f,p,d,m,g,y=e,v=y.vertices,x=y.colors,A=y.lineDistances,_=v.length,w=x.length,b=A.length,M=a.__vertexArray,S=a.__colorArray,P=a.__lineDistanceArray,C=y.verticesNeedUpdate,T=y.colorsNeedUpdate,E=y.lineDistancesNeedUpdate,z=y.__webglCustomAttributesList;if(C){for(n=0;n<_;n++)l=v[n],M[h=3*n]=l.x,M[h+1]=l.y,M[h+2]=l.z;r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,M,i)}if(T){for(o=0;o<w;o++)c=x[o],S[h=3*o]=c.r,S[h+1]=c.g,S[h+2]=c.b;r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,S,i)}if(E){for(s=0;s<b;s++)P[s]=A[s];r.bindBuffer(r.ARRAY_BUFFER,a.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,P,i)}if(z)for(u=0,f=z.length;u<f;u++)if((g=z[u]).needsUpdate&&(g.boundTo===t||"vertices"===g.boundTo)){if(h=0,d=g.value.length,1===g.size)for(p=0;p<d;p++)g.array[p]=g.value[p];else if(2===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,h+=2;else if(3===g.size)if("c"===g.type)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.r,g.array[h+1]=m.g,g.array[h+2]=m.b,h+=3;else for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,h+=3;else if(4===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,g.array[h+3]=m.w,h+=4;r.bindBuffer(r.ARRAY_BUFFER,g.buffer),r.bufferData(r.ARRAY_BUFFER,g.array,i)}},ye.buildLineBufferData=function(e,i,r,a){var n,o,s,l,h,c,u,f,p,d,m,g,y=e,v=y.vertices,x=y.colors,A=y.lineDistances,_=v.length,w=x.length,b=A.length,M=a.__vertexArray,S=a.__colorArray,P=a.__lineDistanceArray,C=y.verticesNeedUpdate,T=y.colorsNeedUpdate,E=y.lineDistancesNeedUpdate,z=y.__webglCustomAttributesList;if(C){for(n=0;n<_;n++)l=v[n],M[h=3*n]=l.x,M[h+1]=l.y,M[h+2]=l.z;r.bindBuffer(r.ARRAY_BUFFER,a.__webglVertexBuffer),r.bufferData(r.ARRAY_BUFFER,M,i)}if(T){for(o=0;o<w;o++)c=x[o],S[h=3*o]=c.r,S[h+1]=c.g,S[h+2]=c.b;r.bindBuffer(r.ARRAY_BUFFER,a.__webglColorBuffer),r.bufferData(r.ARRAY_BUFFER,S,i)}if(E){for(s=0;s<b;s++)P[s]=A[s];r.bindBuffer(r.ARRAY_BUFFER,a.__webglLineDistanceBuffer),r.bufferData(r.ARRAY_BUFFER,P,i)}if(z)for(u=0,f=z.length;u<f;u++)if((g=z[u]).needsUpdate&&(g.boundTo===t||"vertices"===g.boundTo)){if(h=0,d=g.value.length,1===g.size)for(p=0;p<d;p++)g.array[p]=g.value[p];else if(2===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,h+=2;else if(3===g.size)if("c"===g.type)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.r,g.array[h+1]=m.g,g.array[h+2]=m.b,h+=3;else for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,h+=3;else if(4===g.size)for(p=0;p<d;p++)m=g.value[p],g.array[h]=m.x,g.array[h+1]=m.y,g.array[h+2]=m.z,g.array[h+3]=m.w,h+=4;r.bindBuffer(r.ARRAY_BUFFER,g.buffer),r.bufferData(r.ARRAY_BUFFER,g.array,i)}},ye.deleteGroupBufferData=function(e){delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray},ye.getMaterial=function(e,t){var i=e.material;return i instanceof se.ArrayMaterial?(t>i.materials.length-1&&(t=i.materials.length-1),i.materials[t]):i},se.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,a=0,n=String(e).split(""),o=n.length,s=[];for(t=0;t<o;t++){var l=new se.Path,h=this.extractGlyphPoints(n[t],i,r,a,l);a+=h.offset,s.push(h.path)}var c,u,f=a/2;for(t=0;t<o;t++){l=s[t];for(u=0;u<l.actions.length;u++){var p=l.actions[u].args;for(c=0;c<p.length;c++)c%3==0&&(p[c]-=f)}}return{paths:s,offset:f}},extractGlyphPoints:function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M=[],S=t.glyphs[e]||t.glyphs["?"];if(S){if(S.o)for(c=(h=S._cachedOutline||(S._cachedOutline=S.o.split(" "))).length,u=i,f=i,o=0;o<c;)switch(h[o++]){case"m":p=h[o++]*u+r,d=h[o++]*f-0,a.moveTo(p,d,0);break;case"l":p=h[o++]*u+r,d=h[o++]*f-0,a.lineTo(p,d,0);break;case"q":if(m=h[o++]*u+r,g=h[o++]*f-0,x=h[o++]*u+r,A=h[o++]*f-0,a.quadraticCurveTo(x,A,0,m,g,0),b=M[M.length-1])for(y=b.x,v=b.y,s=1,l=this.divisions;s<=l;s++)P=s/l,se.Shape.Utils.b2(P,y,x,m),se.Shape.Utils.b2(P,v,A,g);break;case"b":if(m=h[o++]*u+r,g=h[o++]*f-0,x=h[o++]*u+r,A=h[o++]*-f-0,_=h[o++]*u+r,w=h[o++]*-f-0,a.bezierCurveTo(m,g,0,x,A,0,_,w,0),b=M[M.length-1])for(y=b.x,v=b.y,s=1,l=this.divisions;s<=l;s++){var P=s/l;se.Shape.Utils.b3(P,y,x,_,m),se.Shape.Utils.b3(P,v,A,w,g)}}return{offset:S.ha*i,path:a}}}},se.FontUtils.generateShapes=function(e,i){var r=(i=i||{}).size!==t?i.size:100,a=i.curveSegments!==t?i.curveSegments:4,n=i.font!==t?i.font:"helvetiker",o=i.weight!==t?i.weight:"normal",s=i.style!==t?i.style:"normal";se.FontUtils.size=r,se.FontUtils.divisions=a,se.FontUtils.face=n,se.FontUtils.weight=o,se.FontUtils.style=s;for(var l=se.FontUtils.drawText(e).paths,h=[],c=0,u=l.length;c<u;c++)Array.prototype.push.apply(h,l[c].toShapes());return h},function(e){var t=function(e){for(var t=e.length,i=0,r=t-1,a=0;a<t;r=a++)i+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*i},i=function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d;if(s=e[n[t]].x,l=e[n[t]].y,h=e[n[i]].x,c=e[n[i]].y,u=e[n[r]].x,f=e[n[r]].y,1e-10>(h-s)*(f-l)-(c-l)*(u-s))return!1;var m,g,y,v,x,A,_,w,b,M,S,P,C,T,E;for(m=u-h,g=f-c,y=s-u,v=l-f,x=h-s,A=c-l,o=0;o<a;o++)if(o!==t&&o!==i&&o!==r&&(p=e[n[o]].x,d=e[n[o]].y,_=p-s,w=d-l,b=p-h,M=d-c,S=p-u,P=d-f,E=m*M-g*b,C=x*w-A*_,T=y*P-v*S,E>=-1e-10&&T>=-1e-10&&C>=-1e-10))return!1;return!0};e.Triangulate=function(e,r){var a=e.length;if(a<3)return null;var n,o,s,l=[],h=[],c=[];if(t(e)>0)for(o=0;o<a;o++)h[o]=o;else for(o=0;o<a;o++)h[o]=a-1-o;var u=a,f=2*u;for(o=u-1;u>2;){if(f--<=0)return console.log("Warning, unable to triangulate polygon!"),r?c:l;if(n=o,u<=n&&(n=0),o=n+1,u<=o&&(o=0),s=o+1,u<=s&&(s=0),i(e,n,o,s,u,h)){var p,d,m,g,y;for(p=h[n],d=h[o],m=h[s],l.push([e[p],e[d],e[m]]),c.push([h[n],h[o],h[s]]),g=o,y=o+1;y<u;g++,y++)h[g]=h[y];f=2*--u}}return r?c:l},e.Triangulate.area=t}(se.FontUtils),self._typeface_js={faces:se.FontUtils.faces,loadFace:se.FontUtils.loadFace},se.typeface_js=self._typeface_js;var Ae={easeNone:function(e,t,i,r){return i*e/r+t},easeIn:function(e,t,i,r){return i*(e/=r)*e+t},easeOut:function(e,t,i,r){return-i*(e/=r)*(e-2)+t},easeBoth:function(e,t,i,r){return(e/=r/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},easeInStrong:function(e,t,i,r){return i*(e/=r)*e*e*e+t},easeOutStrong:function(e,t,i,r){return-i*((e=e/r-1)*e*e*e-1)+t},easeBothStrong:function(e,t,i,r){return(e/=r/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},elasticIn:function(e,t,i,r,a,n){var o;return 0===e?t:1==(e/=r)?t+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),-a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)+t)},elasticOut:function(e,t,i,r,a,n){var o;return 0===e?t:1==(e/=r)?t+i:(n||(n=.3*r),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),a*Math.pow(2,-10*e)*Math.sin((e*r-o)*(2*Math.PI)/n)+i+t)},elasticBoth:function(e,t,i,r,a,n){var o;return 0===e?t:2==(e/=r/2)?t+i:(n||(n=r*(.3*1.5)),!a||a<Math.abs(i)?(a=i,o=n/4):o=n/(2*Math.PI)*Math.asin(i/a),e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)*-.5+t:a*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*(2*Math.PI)/n)*.5+i+t)},backIn:function(e,i,r,a,n){return n===t&&(n=1.70158),e===a&&(e-=.001),r*(e/=a)*e*((n+1)*e-n)+i},backOut:function(e,t,i,r,a){return void 0===a&&(a=1.70158),i*((e=e/r-1)*e*((a+1)*e+a)+1)+t},backBoth:function(e,t,i,r,a){return void 0===a&&(a=5.70158),(e/=r/2)<1?i/2*(e*e*((1+(a*=1.525))*e-a))+t:i/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t},bounceIn:function(e,t,i,r){return i-Ae.bounceOut(r-e,0,i,r)+t},bounceOut:function(e,t,i,r){return(e/=r)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t},bounceBoth:function(e,t,i,r){return e<r/2?.5*Ae.bounceIn(2*e,0,i,r)+t:.5*Ae.bounceOut(2*e-r,0,i,r)+.5*i+t}},_e=function(){if(this._as=[],1===arguments.length){var e=arguments[0];if(e instanceof _e&&(e=e._as),e instanceof Array)for(var t=e.length,i=0;i<t;i++)this._as.push(e[i]);else null!=e&&this._as.push(e)}else if(arguments.length>1)for(t=arguments.length,i=0;i<t;i++)this._as.push(arguments[i])};se.List=_e,se.extend(se.List,Object,{size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(e,i){return i===t?this._as.push(e):this._as.splice(i,0,e)},addAll:function(e){if(e instanceof _e&&(e=e._as),e instanceof Array)for(var t=e.length,i=0;i<t;i++)this._as.push(e[i]);else this._as.push(e)},get:function(e){return this._as[e]},remove:function(e){var t=this._as.indexOf(e);return t>=0&&t<this._as.length&&this.removeAt(t),t},removeAt:function(e){return this._as.splice(e,1)[0]},set:function(e,t){return this._as[e]=t},clear:function(){return this._as.splice(0,this._as.length)},contains:function(e){return this.indexOf(e)>=0},indexOf:function(e){return this._as.indexOf(e)},forEach:function(e,t){for(var i=this._as.length,r=0;r<i;r++){var a=this._as[r];t?e.call(t,a):e(a)}},forEachReverse:function(e,t){for(var i=this._as.length-1;i>=0;i--){var r=this._as[i];t?e.call(t,r):e(r)}},toArray:function(e,t){if(e){for(var i=[],r=this._as.length,a=0;a<r;a++){var n=this._as[a];t?e.call(t,n)&&i.push(n):e(n)&&i.push(n)}return i}return this._as.concat()},toList:function(e,t){if(e){for(var i=new _e,r=this._as.length,a=0;a<r;a++){var n=this._as[a];t?e.call(t,n)&&i.add(n):e(n)&&i.add(n)}return i}return new _e(this)},sort:function(e){return e?this._as.sort(e):this._as.sort(),this},toString:function(){return this._as.toString()}}),se.ImageCache=function(){};var we=se.ImageCache;we.AlarmBillboardImage=new Image,we.AlarmBillboardImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE0AAABrCAYAAAAy/A+bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAABoKSURBVHja3F17jFxXff7O4z7n6fXa3uw6TuI81KiYFhRIpKA2iVBBaUNRvQlxSloQpNSiKaUgolR1wBRKCrRNWilIkIQKFSIcLw0EQitEmgImJXJL3ZgQk7h1nX16Z3fnPfd9+8fec3PmzJ31PmY3gSNdzezOzH189/f4fo9zLonjGFljYmICWzhyAC4GcAkAC8A2ACYAB4ALoA1gHsAUgDMA/M0+of379/f9jGPrRw7ArwG4lhDyRsbYaxljuwghIIQAAOI47novXpMtiKLohSiKfhzH8b8D+FcAJ7fyArYKtBKAmwkhN2uadh1jTBegyMD0AalrI4RwSumVjLEroyi6LfnuZBiGXwdwBMD3ft5Bu4YQ8j5N025hjNmU0hQQSmkqTYQQRFGEKIq6fkwI6ZI68XcYhoiiCGEYin3tZoy9H8D7oyh6Po7jhwE8BGDx5wm06wkhh0zTvF6AE8cxGGMpaEEQdF14lrTJ4KnvCSHQdR2UUvi+jyAIEAQBOOe/RCn9dBzHh4IgeIAx9jcAzr2aQXsNIeTvDcO4jnOeXhylFHEcpxcXRVGXyp1v9ANRSCYhBJxz6LqOMAzhui4AFDjndwG4MwzDexljnwXQeTWBVgDwSV3XD+q6zgGk6hcEAVzXTSVKVUEB4GqHAEzcCPE/oeKEENi2jTAM0el0AMDmnH88iqJ3x3H8x4yxb74aQLuGMfaPhmFcyhhLL0BIlbA/MmDiYsMwhOd56XdkAMV3BfhCYiml0DQNmqZ1qaqwl7IdzOVyCMMQzWYTjLFLOOePB0HwBUrpBymlrVcCNALgz3Rd/5iu61zYLN/34XleFwiyOnqeB9/34fs+wjBEu92G4zjodDpwXTcFOgxDiJvAGIOmaTBNE5ZlIZfLwTAMUErBOYdhGOCcd0mhDF6xWITrunAcB5zzOwgh14dh+DuMsWe3EjSLEPJF0zTfwRhL77LjOPB9vwcsoaK+78N1XSwtLaFWq6FaraYqtZYRxzEsy0KhUMD27dtRKBRS6TNNMwVLgEcpha7r0DQN9XodYRhepmnaD+M4fifn/OtbAdp2Qsi3Lct6gzDAQrqCIOgBSwBZq9UwNzeHpaWlLvskHIaQkH5DtYVCcs6dOwfTNDE0NISRkRG4rgvDMGAYRuqxwzBMASyXy2g0Guh0Onld178WRdGHOOf3rXTsjYK2kzH2HcMwXitUw3XdVB0FhwrDEI7jwPM8LC4uYnp6Gq1Wq8f+yHYoCzj5uzJosucVdnFmZgazs7MYHh7G2NgYLMuCYRgwTbPH9uXzeTiOg1arRXVd/9s4ji1N0z61WuDWAtoOxthTpmleCQCMsVSKZGPvui5c10Wr1cKZM2dQq9Ugvi+DJNsfSmn6uaxWqtqqNEXcIHmbn59HpVLB6OgoRkdHEYYhTNMEYwyMsdQcmKYJSilqtRp0Xf/LKIqoruufFFxyEKDZhJDHDcO4EgA45+h0OinnEiTVcRy4rovJyUlMTU11gSVAEJsw7uJi5O/JxlzlairHE8cWDkRI/fT0NBYWFnDppZeiVCrBNE3oup4eGwB0XUe5XMbS0hJ0Xf8LAGd0Xf/y+YDjq/SSj5imebU4oAyYuMOdTgftdhunT59GrVbrAUtIFOc8BYxznv5fBanfkFVIlbg4jmEYRuqdfd/Hc889h4suuggjIyOIogimaaY2TtCXUqmExcVFYhjGw4SQGULIkxsF7S7Lst4mAHMcpwsw3/fhOA7q9TpOnToFz/NSwGTQdF1PWbsArh9QWWqZ9ZmQNrE/8Z5zDk3TUm89NTWFVquFvXv3IooiWJbVdRMMw0CxWES9XtcBHKGUvg7AS32l6Dz5tGt1XX+KL4+UNqiALS0t4YUXXkAURV1gCbXTNA26rkPX9S7bNoihZkWECotz9DwPnufBdV3k83ns3bsXtm3DsqwuDSCEoFarodVqwTTNH9i2fd2tt94aZkr7SqERY+zLjDEuB8WyDXFdF7VaDadOneoCTBh2TdNgWVZ6kpqm9TiDQW1ZN0vXdZimCdu2Ydt2aj4EmVaJd6lUAmMMruu+qdPp/HlfE7ECaPdqmnaRYNYi3BGe0nVdNBoNnDp1qsvgC8AMw4BlWbAsK81GqJ5zEEPen0poBQ8UpNe2bbiuizNnzsDzPDiO0+ORh4eHhYTe/aUvfemKVYM2MTFxlaZp7xN3TQ6LAMDzPHQ6HTz//POIoqgLMPkEZekaNFj9wOsneSLcsiwLnU4H09PTKSmX01OMMZTLZXieZ3Q6nc995StfIatyBISQT1NKGaW0Z6eCzJ4+fRpBEKSAiRPTdR22bXep4lYPOXUkczP55lWrVeTzeQwNDUGmGIL8tlot+L5/g+M4NwH4xoqOYGJi4npd15+UvaVKLaampnD27NkULBUwwYfOFxpt5pAzKmoEIRKWnufhiiuugGVZKQEW5+z7PqampmAYxolCofC622+/Pe6rnoSQjwsbJTylOAHf99Fut3sAE0ZXACar6ys1ZPuqkmpBSzjnmJ6eRhRFaWQjhqZpsG0bvu//SqfT2d/Xpk1MTLyBc/4mORcv7pYgi2fOnOmxF8JLCcBebUMGTgZU0zR0Oh00m82uJKnQvm3btiGKInie96GVHMFBWTzlnFgQBKhWq2g0Gl0H5Zz3ALYR6lAqlbBnzx5ceOGF2L17N3bs2NGToV3rJgOXxSFnZ2cBIM3SiONJ0nbN5z//+Tf2OIKJiYltjLFb5dBELoKEYYjp6en0wEIFTdOEYRjQdT2Tza9lvP71r8cNN9zQ8//Z2Vk8+OCDXdRlvRIn1xVkLarX6yiVSl0ZZkopisUims0mHMd5L4BnVEm7iRBiUUoRBEHXwUTKuNlspictuJhhGGnqeaOUQgCvjpGREdRqNfi+v2E6ooZ3wsYtLCyAEJKqqQDUNE1omoYgCMYfeughXQXt7XLSTq0vzs3NZTLuraIWjuN0Ger1gieDJoMnQsKsEC2fzyOKom2O41yXgjYxMWFRSt+qxnBCz4MgwNLSUpdqilhSzrxu5lhtuW+14Mk2TrwXuT+VsuRyOXHjbpRt2huTvH9PyjqKIlSr1bQqLrPrQdix9ajYIGmJuC5KKer1Oi644II0jpbpB6UUURT9egpaFEXXCjslOwDxWqvV0rsjFyk240KyRlK/HMix5DYHkU4SAIokhG3bXRGFKAfW6/V9DzzwQIkmP3iduhPhAKIoQrPZ7EkkipLZVkiZINODOJYa4MsOgnOOdrsNtYNJVL/iOGau6+4T6vnLWXYjiqK0QCLXIIXr34yMRb//iyzvII4npE2oplxGbLfbmclPTdOEIL2GT0xMaAAul7mZbAQdx+kymrLHlKtFmwVaHMeIJHs6qOMJ4i6He+J6ZUlMCW2iWVEUXUkBjArbltW5kzSTdEUBagluUKNer2cABkQD8por9YXI/SBqjVWk0ZPPL+EAdvcryIpUkMxx1DhukOrZaDRetqdRjBgxwihCpPSoDcpzCrVU9+15XpczEF5W13UEQbCbh2E4KnQ2K9/u+35XzkwlhpvBx5alaxmsKIoRhvGmSVlWaVEVHllF4zge5QCKAvGsL8uxmuBoqrQN8kIiLAMWRomURTGiONqUVLmQNpmzqbREjV3jOLY5AFvOImSxbtklZ2UQBogaoihCECagxUmrQ3IRm+GtVTWV+9yEd1VAK/A4jnP9xFG1IZvOyeIYYRQjSKQrSqRtcWFxyzihKtFZNVcex7HfL6ZTg1o1QzBwzJKTDKNw2REkUlZdWtwUG6p2VQqpW4kVxHEccACLsi5nGT/VLW+m5C3bsmUJEyBCCuG2oqKVlYSQ8mxVDmBGTm2rOxFMuB/NGOhFEJI4AQkwAHSFTqKNeOl+Q9hu9TtJsXyBEkLOytGA6oblvgfZMG6Gii4tLCzTDInyUEJAN0G6Vjp30ZraowVhCELIS1wGTS2KiOysfAAR+W+GpAVBAIKXpZkRAkYp2IBvVD+GIAhsFtEX0VEcx/9Hb7nlliaAKVnSZAoimHG/A8kh1kY3xhhAlqWLUwqNM+icgTM6sGOoM2XU+Nm27S7PKYPn+z4IIado8uNn5bqAfEc557Btu6tRRAVskIOCQGMMutg4AyUDPoYUoKvA5HK5noq7ACwhvc+KszkRBEEPAKJmUCqVBp5y7us9Qx8aY9D48sYpxdLS1vE0y7JSCiJfq+hnoZT+F0+k5piwKUKEhboyxlAsFjE3N5emwlcKNTY6Jo4cwa5du8AZBxDjxRdfxOTkJMrl8qbm7kQXpWEYmUyi0+kgiqL/PXTo0CxPgPkhpTT2fZ8YhtGz43w+D8MweoxjVnf2RofrODj1/PPp1CBCCIaGhmBZVtcEi0EVaWRpKpVK4Jx3CYcY7XYbQRAcWzYhAA4cOLBAKT3heV6PXQvDEJxzbN++fTkuTBr7sjzMIJrzbNvG5Zdfjje/+c24+uqrsXfv3vSmZTU8r7XSroIhA1gqlVIvqqb9XdcFpfRJuRoFAP/suu6vFgqFTCB27tyJSqWSdt2o9m8QEpDP57F///6eovFTTz2FkydPdnUjbTRrqzq0crks8mU9oCU115hS+i+ppCUq+oTwEqpXDIIAmqZh586d8DyvR7RVr7rebd++fZlV9muuuQaNRiNV1/VIWD/wRGF8+/btXekheSQNMicOHTo03QUa5/wYY2xWlMtU0iekTQCrTjnsV+VZyzY0NJR5caZpCpuyLsD61R7Eq5hnIGiFanZarRbCMDz6Mi1KxoEDByJK6dfk0rxM/nzfh67rGB0dTZuW1QNs1KOuRGdkW7rRcEkuHBFCsGvXrq76gHweSUckGGOP9oCWSNsjoiKT5R2jKMLw8DA0TeuaoykXIzbC4+QawSDT52onpDyHa2RkBJqmpWZHvTGNRgNBEPzHPffc87N+oB1jjJ2SVVQWcVFkufjii9MmP9V9q0Z0LaokOsXV8cwzz/SdLrRaT6m2vwNAoVDA0NBQpoQJr5mo5he7oxZp3HbbbTHn/B8ER1LzaAI40zQxNjbWI21ZgK1lzM3N4ciRI3j66adx+vRpnDx5Eo899hieeOKJlKdtRO3lsIkxhrGxMRBCuqRMlrRmswnP8zqMsUe6hEs9gK7rDzqO87FOp2Pk8/keiRFzCMrlMlzXRb1eT4mvHNOtJ+fGOcfS0hImJyfT6USCu6kN0Ku1jTJQYiOE4MILL0wnxsmeVN7/0tISfN8/cvjw4cW+kgYAt99+e4Vz/lXZvqiiLybEjo6Oolgspmoqt873Y93nm3Wi6zpKpRK2b9+OHTt2YMeOHdi2bRts2+5pOs6iFVlSpS5lsWfPHti2nU6+kCVM3Ph2uy3M0d/1JhWyk3D3iR/KO5JVVXiVsbGxdIK9fHKquq7WQYhSoZgoIToRV5NNUac3qk4qiiLs2bMHuVwubfWXz1mVsiAIvn/48OH/XBVo73rXu37MGPvOStJGCEGj0YDv+9izZw8KhUIKnDx5X7V3a11SYlXFZWX//baLL74YhUIhXWBABkwWDjHJNwzDT2enr/oMXdf/SsxB7ydtwHL/heu62L17N3bu3Nklaf1WTMhS4fVSiCyw5MmzwuhfdtllyOfz6HQ6qTmRuZ8sZYuLi/B9/yTn/FuZtneFPPl3Hcf5Qa1We5Npmn1L+XEcixUIMDw8jHw+j7Nnz2YmLbNWRlALGCux95UyFbIEy9PDi8Uidu/enXpDWSVlwIRQeJ4nQrZPHD58OF4TaLquwzCMj7bb7e86jpPO+RazcuUeL5k5Dw0N4YorrsDs7Gy6MoL4br95Bv0AXIk6ZPFCGSxKKXbv3i0mh6HdbnfNiRCACecixsLCAnzfPylHAKsGLTHGTzqO82S1Wr1hZGRkRWkTd6lSqaBQKGBsbAzDw8OYmppKvZR8V+OMVoOVwrCVkgQqOR0eHsYFF1yQMno5ppQlTJ4LJWxZImWHDh8+HK0ZNFHKMk3zrlar9Uyr1SK5XK5L2rIuRnSCdzodbNu2DZdffjlarRZmZ2dTbywvNqKmaFYLWtYiTzt27MDw8HDKv4SHlCeSyUZflfRKpQLf948xxh5bkU+u9CFjDKZpHncc56u1Wu1W0RouGprlBhKVUDqOg7m5OViWhXK5jMsuuwy+72NhYUGQxq5UjwpYv/U4VLUUoZBIIDqOg0aj0QWWLGFyw7V8nFarhWazGYdh+BG51rtm0IRtsyzrrnq9/rZqtWqXy+W+FEQFTsRurutC0zQUCgWMjIxgbGwsnchVr9fTpSlk0PpNtBDTuwuFAgqFQnoDm81mV8pKBUtufZd70cSYn5+H7/uPcM5/KMqW6wYtsW1nNU37bL1evyefz6dNw+JEVKcgv5fnVonlczRNQy6Xw9DQEIaHh1NplVe4EqCJY4m1hGSD32q1ulafkT8TPDGLZ6pEOTEn7SiK7hYh24ZAE9KWy+Xurdfrty8sLFyya9euTKcgN8mpwKmTVD3PS+cnyLNgxMw+UeARFy9LkqquMjeUDf1KgAkp830flUoFnud9Qtf1syIK2TBoibR1NE27s9PpfLPdbsO27R6nIDfDrURM5eBYrnyLwk5WIbqfbZPVL6uYLXvsfsbf87yfMsb+2jRN5HK5vhPb1gSaUJN8Pv+tIAgerVQqN4+NjXVxnCzbtloAs/bRrzaZRTlW4nb9EgOC7Nbr9TgMw4OGYXi5XK5rWnb/LoBVDhFEm6b5R3EcVwRxzZrRpq5MtdrQSF7zo98mx7T9wrB+M1LkcwvDEOfOnYPrul/gnP+bWMxuNTOj19QkQSmFbdvndF3/k2azmeaiZPc9yOa/9cSoq1XLc+fOwXGcaQAfMU0ThUIBhmFsDmi6riOfz3+ZUvr4wsJCl+FXJW6remT7AdZPyoRa+r7/Xl3Xa2INkdVmhtfcjpMQXti2/YdBECwtLi72MOysVaq2EkDVwcjaEASBUMuHOOfftiwL+Xw+pTObApoALpfLTRuG8b5Go5Guwpdl37YKuJVqrrLKzc3NwXGc/wHwQdM005aHtazysC7QhJrmcrlHKaUPz8/Pp/PeVfu2FRLXz46px65Wq2g2m6Hv++/Udb2Zy+XSNPqarn+9J8oYQyLaHwDws3Pnzp23DrCVdkz15K7rYn5+Ho7jfFTTtKdt20Y+n1/XCgwbajFkjMG27aZpmr/ruq6n2rfNlrbzSZhML6anp+F53pOMsXuFt1wNJxs4aJI3Pc4Yu6tarXYVYzbK3zYiYTIYCb2YDcPwnbquh/l8HrZtr7uOuuFmVuFNi8XifYSQR0XH5GbytyzG30+ql5aWUK/XQ8/z3qFp2kw+n4dIOqxbWAahJpxzscLxewA8Pzc315NOHqSqrlYt2+22sGN3c86/J1JKa/WWmwIakK7L0zBNc7/ruq1KpdIljYOiImqisp/h930fs7Oz8Dzvnxhjn7UsC8Vicd12bFNAE6t4FgqF5zjnv99sNuNqtdpXjdYDXJYdW8nwdzqdn0RR9G5d1+NisZguhrfhax2k+xc0pFQqTRBCPr64uJjpGNYD3PlUUjX87XZ7MQzDt+u6XisUCgMDbOCgycAVi8XDhJCJubm5NE+metTVzqpbC2CVSkUY/ps55y/KdmxQE0U2ZWWlJPcW27b9e3Ec//f09HRP65bczKJSkX7Sl2UXVca/uLgIx3Hu5Jw/ads2SqUSLMsa6GJ4mwKamLpdKBTalmX9ZhiGkzMzMz2dOVn2aCXwZA6m/q7VaglPeT9j7HOJmVhXmPSKgCYnLQuFwqRpmm9xXXd+bm4u06Oeb2GUfk5EfnjE7OwsXNf9BoAPiWWlB2nHtgQ02b4lHvWmZrPZXg1wWYvE9eNivu9jZmYGjuP8KIqiA4ZhhMViEblcblMA23TQpPgU5XL5R5qmHWg2m2E/DrcSQFkqGYYhpqam0Ol0XgzD8CZd19vFYhGFQmHDSyG+oqAJx5AY5W9QSu+s1WpYWFjoAk5dAlb9W62Mh2GIyclJtNvtSd/3b9A0bb5QKKBYLG6Y8b8qQBMRQy6XQ7FY/Bwh5N5qtYpqtdqlhur63/IyPbK3jaIIMzMzaLfbC77v36hp2kvJvgfC+M8rBFuZw0+oCOI4vrter+cWFxfvpJR2TUtU29nV/4unWjQajZrneW/VNO3ZXC6Hcrm8KZ7yFQdNtBckPbofaDab9vz8/HuA5YV4zxcVCBvWaDRanufdqGna8cRebhlgWwba+Pg4wfJjR1hiEigAcu211/7pjTfemJ+fn39HHMcYGhrKJLaiH2Rqagr1er1dr9dv+cxnPnMCgA0sL08ktqNHj0Y/t6CNj4/zZP9MASsF7dixY+Sll1768B133JGbm5v7Ld/30/4yWR07nY6wYU6lUvmD+++//8dYfv5enIAlXqPx8fEQQAggABAePXo0HPS1kUE/fnd8fJwB0AFoCVg8AalLyqRXPjw8nDt48OCnDMN4S0KIoet6Clij0YDnec7Zs2c//PDDDz+F5acnxlmgJYBFCWgBAO/o0aPeWq9jpcfvDhS08fFxCsBIANMUSWMKYHkAwwCKAHKGYVgHDx787XK5/BuUUiZLmuM4lRMnTjz0xBNP/AzLzzFuAahi+bmdvgRcKAEXJp/56wFuK59ZLIPSo47KZ6VkKwDIua5r3Hfffd+/6qqrfrJv377XmKa5PY5jv1KpnH388cd/6i5PHylKEhwlEieSdpFEoWLpbwqAjo+Pk6NHj8avRpumqkokgUWkzwCglgAQJ2pkAtCOHz/eOn78+HTyfUiSE+Dlp2U3k9/XpeOox40VBxFvuk1ba+pZjpxWadNkqbOx/ChxI/ktVUALAHh4+fHizlpsWrL1jPVeOxnElJs+4J3Xe2Zs6S7V68t4lQFTQQsl0KJBgTVQ0FYJYj9pywKt34gl4LIAizYDpC0B7Rd9/P8A12VCYmM3Gg8AAAAASUVORK5CYII=",we.Logo=new Image,we.Logo.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAIACAYAAAAczR65AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAF+CSURBVHja7N13nCT3ed/5pzpMT+40s5M6zGycXSxyIhY5ESQCqURR1FnW2Zb0kixLtuTzvex72eezzz6dJcq0jmfLd7Ysn2wSFCiSEgkQAEEiExkL7GLDbN6ZDhM6T0/q6VD3B0SQABbY2d3f02k+77+ADc+v6vlV9XZ9p6p+1tv7H7UFAGDErIMeAIApVRmlCQBgEF9VAQAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAABAA0AIAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACgVbloQfPyxo/J+KP/kEa0sdi9/0qy266iEWg5ll2Tu//074hrLaU2xul9vyPHr7qbZl/w3Nhy15/9XXEvx4zXfvkLfyIF/xBN3oBb/+J/k56FN1Rq19y98oO//d+l6uRrHKDlypf+m4Te/pJa/VP7/qVMXfUgjUbdcQcAAOCC2ZZDsuO3q44RjL1Noy+CNzuncvEvIjKQOE6DN8CztqJ28S8ikovcwcU/oMhZLcvw1J+rjjF25Jti2TbNBgEAAKA1pKJXqdbvTzwv7nKJRl+gwfiUWu2BmQM0eCN9mjutWj8duZImA4pGZw6Iay2pOkZn/m0ZmD9Fs0EAAABoDQtjO1TrW7WqBOfO0ugLvficflOttjf+rDirZZp8HoHElGr91NhOmgwoCk19ry7jhI89TbNBAAAAaA2lzh4pjtysezGbOEqjL0BHaVX6E8/rfWmorElwfoZGny8AiOnd/r/mm5Sl/iBNBpR0L+ckcPYbdRlr6PjD4i6v0XQQAAAAWkN6/HrdC6np12jyBRicPSWWXVMdY0D5p9utf/FQkK7sIbX6mfF9NBlQFD75kkidns13lAsyduZNmg4CAABAa1gI79a9mMoclO7lAo3e6MX5zDvqYwSm+bL6cYLKz/+nwpfRZECJZdsydvibdR0zdPS7NB4EAACA1pAPjkq5e1T3ojbJS5I2+sV14Mzz6uP0LrwmnatLNPyjAoC43mMrtsMl6eFxmgxo/Xszf0q68m/VdUxv4nHpL8zTfBAAAACan21Zktl6p+4XsvghGr2RL5GKy/99aE5mCWU+SmDmFbXahdCdUnF7aDKgpFEv5Qsff4HmgwAAANAaUpHLVev7p19kreQN0Fz+70MBQPwIDT+H3sWMdBT1HgFIR6+myYASd3lNho4/3JCxR49+XRy1KpMAAgAAQAsEACPbxLb0/jlxryTFm+P2yPNelNfx2fzAGX5adc45SJ7UPddY/g9QM3bmTXGUG/POmY6lEzKUZNUbEAAAAFrAuqdLFkN36F5YJY7T6I/78qi8/N+Hxluekf7cAo3/gIDispXrPREpBIZpMqCk0S/jC039gEkAAQAAoDWko9eo1g/GDtDkj1GP5f8+aCB5gsb/BMu2JTDzolr9zMStNBlQ0l+YF2/i8cZ+jp/8qnjWeMEqCAAAAC1AezlAb+xZcVbLNPqjLsbrsPzfh8cklHnfBURuXlyrc2r10+G9NBlQ0gwv4bNqZQmffo3JAAEAAKD5FfxDUurbpvePVbUkwfkZGn2uL411Wv7vg3yxZ8VZrTABf21gVvH5f8uS1Oh2mgxo/PtSq8ro0a83xbaMHfkrJgQEAACA1pDZqnuL8kBiiiafQz2X/3vfF4jKigQWCGV+JKC4XGVxeJ+se7poMqBgKHlUOpaa45Gm3oUXxJ+JMSkgAAAANL9U+DLdC6w6vuW+ldRz+b8PGkgcYwJExFGriS+mdwtxevw6mgwoCU19v6m2J3z8OSYFBAAAgBYIAEa2ie10q9XvXXhNPGvLNPqDF+ENDEaC028wASLiyyTEua63fFgqNEmTAQWetSUZPPlwU23TyNGv8XgVCAAAAM2v4u6QfPgu1TEGlddZbzX1Xv7vg3rnXxXP2sqmn4eg4nFZ6RyU3MAYBzugIHzqVbFqzfWCWddaUkZiB5kcEAAAAJpfavxa3Qut+FGa/BMasfzfBw3Mntr08xCI631Zz0ZvF9vi6xqgYezot5tyu0JHn2RyoMZFC5rX4ugOOfS3v9HS+9BVmJdt3/i7KrWP/tJXpOrubOn+1FycgmizAGBsl+zUDACmXxKRX6DRP7r4bsDyfx/ahthhSUxcvmnnwFktizeudxdGOnIFBzqgwJ+JSe/CC025bcGzfyHdy78hKz0+JgoEAJuJ7XBItcPT0vtQdeltf9Xd2fL9AdpN0RuUNd9u6czr/KS+o3ha+vMpWfQNbvpeN2r5vw99Ud3koUwgFRdHtaRWn+X/AB2RY8828UWALeGTL8mxK+9nomAc95QBAIxKb71Ftf5A8gRNlsYt//dBPwplNqug4koIy4PXympPPwc7YJizWpHhqT83Vm9uz69JZqvZIHTsyDdFxGayQAAAAGhuC8rLAQYV11tvJY1c/u+DNnMoE4gdUKudid7AgQ4oGJk5IK61pLF6iwNbpbBll9Ft7Mrtl8F53rECAgAAQJPLDI9LzdWtVt83/Yw4atVN3+dGLv/3QcFN+sZqd7kkfbM/VKufCu/mAwVQEJ4y+5K9oj8kiwPjxrcz1MyPKYAAAAAAEZGq0yW58XvU6jvLRQmk4pu6x41e/u+D/DPPbspQJjh3Vm0Vhpq7V7JbInygAIZ1L+ckcNbsS7YXfaOSD4SMb+vwsa+Iu1xi0kAAAABobqnIlboXXorPXbeCZlj+731fJspLEliIbbp5CMweV6udi9whVSfvagZMC598WcQ292z9es82WenxyXJvQCqeYcOfrQUZPbufSQMBAACguS2EdqnWD868tan72wzL/31omxJTm24egjN6j2GklUM0YHOyZeyw4Z/+j9z41/9lSXHoRuNbHD76XaYNBAAAgOa20uuTlYGr1er3zf5QOtbXNmVvm2X5vw9dDE9vrp9SedZWpGfhDbX6qbGdfJAAhg3OnZKuvNkAOT/043d1FAfNh9/e+GPSt7jA5IEAAADQ3NITn1C8CK5JcO70puxrsyz/90F98y+Lp7SyaeZhQPH4W/NNylJ/kA8RwLDw8WeM18wO//iiP79lu852n3iRyQMBAACguWkvBzgQO7op+2pq+b817y5J7fwZcxtm2zKQ3DxLVgUUH3nIjO/jAwQwzF0uydCxrxqtWXP1SPYn3v6f2bJNZdvHDn+9qd77AgIAAAA+JLslLNUOv94F2Myrm7Kvppb/W+8dlvVun9FtCyY2TygTiCne/q8cngGb0djZN8VRLhitmQ996n0v61zp8cua7yrj296xdEyGklNMIggAAADNq+ZwSnbiLrX6Xbkj0rOU21Q9Nbn8X6l3QMqdvWYDgLMvb4p56F4uSFf2kEpt2+GS9PA4HyCAYaEjjxmvOb/1lg/9Wjp6h8r2h6e+zySCAAAA0Ny0lwMcSJzcVP00ufxfqdsnZU+30e3zLJ6QvkK67edB8/0ThdCdUnF7+PAADOorLIg38bjZopYlyeiHX3Y7P36dzuf/yYfFU1pmMkEAAABoXgsh3TeZD8QPbap+mlz+r9Tjl1JXn/ltTJ5o/wAgrveoQzp6tQAwK3LiBeM1c+HPylpX/4f/3RvZKZXOMePjWdWShE6/xmSCAAAA0LzWunplaUhvNQD/9Ati2fam6KXp5f9W+gdkrdtrPgCIvdP2cxGYeUWtNsv/AaY/O2syeuQR43WTu+4556/XHC6Zm/ycyr6EDn+bCQUBAACguaUmblCr7VpbEF8muSn6aHr5vyXvoKz0mX9Jo2/6GXHUqm07D72LGeko6jwCsN4TkUJgmA8NwKDhxBHpWDJ7Z1LN2SWJ6DUf+fvxHbfpfP4sPCe+bJxJBQEAAKCJA4DwbtX6A4njm6KPppb/+5HlPr+sdveJ7XAaressFyWQat8vqANJvfdOZCZu5QMDMCw09QPjNdPbf0HKHZ0ffS4PRmXVf43K/oSPP8+kggAAANC8cgMhKXeNqNUPxg5sij6aWv5PRKTUv10qrg6xLYeU+neYn5PEsbadh4DiUofp8F4+MACDPGtLMnjyq8brJnbecZ4/YUly90+p7NPokYfFUaswuSAAAAA0J9uyJDtxu1p9b+I5cVXW27qHJpf/ExFZGph8779XAtvMBwAz+9tyHizblsDMi0rFLUmNbucDAzAofPo1sWplozXLXWGZGzv/nW3xbTrvv3GtJWR05iCTCwIAAEDzSkWu0Lsoq5YlOHe2rftncvk/EZHFoR9faBYHxo1vb//sD6WjtNp289CfmxfX6pxK7eLwPln3dPFhARg0duSvjNec3/WzUnO4zvvnlvoGpBC6X2W/QlNPMbkgAAAANK+FsR0ilqVWf6CNbzkXMbv8n4hIYTDy4zAgGDK/wbYtA3On228eZvWe/08rrR0ObFb+TEx6F8wv/xffsfF3dSR23aeyb8Ezj0jXSoFJBgEAAKA5rXu6ZHH0NrX6gZnX27Z3ppf/ExHJDfx4jeqiX+et8wOxI203F4H4IbXaqdAkHxSAQeHjzxmvueq7WjKD4xsPAMavFdvpMb9zti3hky8xySAAAAA0r5TiTzh7Uvulc7XYln0zvfzfmm9SSp09Pw4AvEGpuXvNXyxPv9xeX5hqNfHFXlCpXekcfF8oA+DSOKsVGTn6NeN1Zyc/IyIbv5tt3dMtqW2fV9nH0JFviYjNZIMAAADQpAGA8nKAg4rLszWS6eX/spEb3vf/tuWQfOgW49vdWTguvYuZtpkHXyYhznWdW25z0dvEtvhKBpgyMnNAXGtJ43Xj22+64L+T2Hmnyj52Zd+QgYUzTDYIAAAAzSkfGJb13qha/WD8SFv2zeTyfyIimXO8vTo/ohPOtFMoE1TcF82XZAKbUXjqSeM1F0c/KcX+LRf89+ZCl0mlU+cOn/CxZ5hsEAAAAJpXZkLvPQDBsy+2Xb9ML/8nIpIe2fqhX8uO6Cw/F4y90zZzEYjrLbuVGt3BhwNgSPdyTgJnv2G8bvIiX+hXc7hkbvJzKvs6NPVVcZVLTDoIAAAAzWkherlabfdyTPpzC23VL9PL/y1tueF9z///SG5gTGquTuPb759+Thy1WsvPg7NaFm/8eZXay4PXyGpPPx8OgCHhky+L2Gafjbcth8Qnrr/ovx/foRN+O8s5GZvez6SDAAAA0JzSw9vE3sD6yRd9wZw83lb9Mr38XyZ67hcxVp0uKYTuMP/ldD0n/nS85echkIqLo6rzU7ZM9EY+GABzl+oydtj8T/8zW39eSp0X/7LUzGBUVv3XqOxx6OgTTDsIAAAAzanc4ZF8+E61+sGZg23TK43l/1LhPR/5e+noVSr7MZA41vJzEVTchzTL/wHGDM6dkq78W8brJnfedamf6JLc/VMq++yLfUd6i2kmHwQAAIDmlI5eo1bbF3tWnNVKW/TJ9PJ/VXefZLeEPzocGNupc/HcBrenBmIHVOrWXN2SGYryoQAYEjr+rPGa1Y6gzIYv/UWd8W2fUNvvyPEXmXwQAAAAmlNK8SeejsqK+FOxtuiT6eX/cuN3S83h/MjfX/RtkfW+rcb3o2/2h+JeX2vZeXCXS9I3+0OV2rnoXVJ1uvhQAAydq8PHvmK87vzOz0vF1XHJdZb6BqQQul9l30ePfN3o+2JAAAAAgDGLvkFZ8+5Uq2/6wrlRTC//l97AUnOZ8VuM74dl12RgrnXXqg7OnVX7Yp2OXMkHAmDI2Nk3xVEuGK+b2HGruVoXuZLA+XiKR2VL8hgHAQgAAADNKb31VrXagZm3Wr4/Gsv/beQW/1T4MpX9GYgdadm5CMzqvVhS67ELYDMKHf2u8ZrrvbskNWxumc7E+LViOz0q+x8+9gMOAhAAAACaNABQutAUEembf1k8pZWW7o/p5f9WA5fLcq/v/PMyslVsy/xXg+D0Ky07F8GZN1XqrvkmZak/yIcBYOJzf3FBvHHzAcDs5M8Y/Uxc93RLatvndf7dOPGweErLHAwgAAAANJ/UyITKuvMiImLbMjB7uqX7Y3r5v/TETRv8ctolxVHzjwF05o9KTzHbcvPgWVuRnoU3VGpnxvfxQQAYEjn+gkrd+A7z52lyp85KOI7qqoydfp2DAQQAAIDmU3W6JR+5W61+MN66t5yrLP8X2rPxC9OIzioNg8mTLTcXA3N6QVI6vIcPAsDIZ2ZNRo88Yrzu8uDNkvePGa87G7pMKp2jKr0IHfkOBwQIAAAAzSmltO68iEighW85N738X83VKZnhjS81p7VKQzB2qOXmIpDQeaGk7XBJaniCDwHAgKHEUelYOmG8bnLyQZXtrTlcMrfr51Vq980/I75cgoMCBAAAgOazoLgcYGfhuPQuZlqyL6ZXMciH75Kq073hP58bGJNK5xbj++Wffr7llqkKxHRu/y+E7pCK28OHAGCAysvvLEviW29Q2+b4jlv0+qH0OAQIAAAAuCTLfX5ZCV6hVr8VbzkXUVj+7wLvtLAtS7LjtxnfL1cpLf506/xkqnu5IF1ZnbsW0tGr+QAADPCUlmXwxFeM182FPysrPX617c5smZBVn87nwMiRr4mjVuHgAAEAAKD5bPTldBcjGHun5frRqOX/PjQvEZ1gZiBxvGXmIqj4/H9qbBcnP2BA+NSrYtXKxusmd92jvOWWzO7+rEpl9+qMjLTgI1cgAAAAbAIpxeUA/TOtd8u56eX/1rw7pegduPB5Gd2uc1E981brBADxoyp1yz1hKQSGOfkBA8aOfNt4zZqzSxLRa9S3PbZdbyWQ0NT3ODhAAAAAaD6ZoahU3X0qtZ2lrARS8Zbqh+nl/zLjN1/U31vt7pflwWuN719/4nlxr5daYi4CMzovkkxP3MaJDxjgz8Sld+F543VTO74g5Y5O9e1f6huQwtinVGoHTz8iXauLHCQgAAAANJeawynZcb1bLYPJEy3TC43l/y5lqblM9AaFfaypLq1nSu9iRjqKOtuZCV3GiQ8YED7+nErdxI7b67YPiUmdAMCyaxI++RIHCQgAAADNJx29Ui8AaKFbzk0v/2c7XJIa2XrRfz8V3q0zJ0pL65k0oPUCScuS1Nh2TnrgEjmrFRk5+rDxuuWusMyP7a7bfiTHrxXb4VapPXb4WyJic7CAAAAA0FwWQjvVavcnXxB3uTVuOTe9/N+lLjWX3RKRmqvbfABw9pWmn4tAQuf5/+LwPil5ujnpgUs0EjsorrWk8brzu35Oag5X3faj5OmR9LYvqNTuzr4uwdRZDhYQAAAAmstqd78sbdFZb9mqVWVg7kxL9MH88n+X9hKrqtMluchdxvezK3dYepbyTTsPlm1LYOZFldrp8es44QEDQkefVKkb33Fr3fclsfMOtdrhY89ysIAAAADQfNITN6jVboVbzptl+b8Phwg6j2cMNPG7Gfpz8+JandM5zln+D7hk3ct5CZ79C+N1V31XS2YwWvf9mQ3vlUrnqErt4amviauyzkEDAgAAQHNJXcLL6s4bAJx9ten33/Tyf+u9USNLzaVHdR7PGGjiNaoHZnWe/690Dkp2MMTJDlyi8MmXRGzzz7bP7v6siFh135+awyVzu35epbZzPSWj029x0IAAAADQXLKDIal0DqrU7sq+I93Lhabef/PL/91ipE7RG5Q1r/kQwD/9vFh2c76cKhDXCSdy0dvEtvjaBVwaW8aOfFOlcnzbTQ3bq/iOW9Rqh44+wWEDAgAAQJN9pbMckpm4S62+2lvdDVBZ/i9yucEwYZ/xfXatpcSXSTbdXDhqNfHFXlCpnYpcwYkOXKLB+VPSldtvvO7i6Cel2D/YsP3KbJmQVd/VKrX9M38lvcU0Bw8IAAAAzcXkReuHAoD44abdb9PL/4llSWpkm7l5CeusWz+QON50c+HLJMS5rnO3SGp0Byc5cIlCSi+1S+76VIP3zPrrRxB0hE/8kIMHBAAAgOayMLZDxNJ5/tJ/9oWmveXc9PJ/i6O3yrqny1wAMLxVbIfT+H4HZ95uurkIKt0psjx4jaz29HOSA5fAXS7J8LGvGK9rO1wSn2j8Ch2x7fvUao8d+Yum/TcQBAAAgE2q1NkjxWGdL0Du1Vnx5uabcr/NL/93rdF65Q6PLI7dbny/vYlnxVUuNdVcBOIHVepmojdyggOXehF79k1xlM3foZOZ+DkpdfY2fP+W+gakMKZzJ4Jn8bBsmT3GQQQCAABAc0kpLgc4kGi+Lz8qy/+FJo1vZzpi/tlUq1aVgbmzTTMXzmpZvPHnVWqnFeYE2GxCR7+rUjex8+6m2cfEpN6jCKFjT3MQgQAAANBkAUBot1rtYOxg0+2v6eX/Kl3Dkg+OKsyLzgXsQOJo08xFIBUXR9X8HQk1V7dkhqKc3MAl6FtcEG/cfABQ7QjKXPjyptnP5Pi1YjvcKrW3HP+KdKyvcDCBAAAA0DzywREp94RVantjz4qzWm6q/TW//N/tYiu8R6EQGJZyt/lgIXj21aaZi6DSHSK56F1Sdbo4uYFLEDmuszrH/M7PS8XV0TT7WfL0SHrbF3Qu+qqrEjr9BgcTCAAAAM3DtixJT9ym9OWnJMH5mabZV8u2ZeD0c0ZrpiN71eYlO25+Xrqy70j3cqEp5iMQO6BSNx25khMbuKTPypqMHnlEpXZix61Nt7+JnXeo1Q4d+Q4HFAgAAADNRXc5wKmm2U9fZlbcK3GjNTWXmkuHdcKFAaU3718Id7kkfbM6y2SlxnZyUgOXYCg5JR1LJ4zXXe/dJanh5luecy60VyqeYZXafXM/EG9uloOKAAAAgOaxMLpdbEvnn6fAzJtNs5+DcbPPvy8NfULWuvTeZJ0a3a4TAMQONXwugnNnjb6L4UfWfJOy1B/kpAYuQXjq+yp1Zyd/Ru3fmktRdbpkbvLzavUjx5/joCIAAACgeZQ7OqUQulOldu/Ca+JZW26K/TS+/N+47jrWa129sjRkfjm7wPQLDV+fOjB7XKVuZnwfJzRwCTylZRk8+bBK7fiO5j0/E9tvUas9cvQRcdSqHFwEAAAANI/0+LVqtQeb4JbzjtKq9CfNvtQqrbiCwo/n5XrjNV2rc+LLNvaW1KDSnSHp8B5OZuAShE69KpbC6hzLg7dI3j/WvP8GDm2VNd9VKrXdK2dlOH6Ig4sAAACA5pEK7dK72Isfafj+bUmcEDH4U+9qh1+ygyH9L6VjSssBxo81bC48ayvSs2D+zdi2wyWp4QlOZuBSAgCll9YlJx9o8j23JDn5WbXqWo9VgAAAAICLUvAPSalf55nz4PTLDd8/08+9Z8fvlJrDqb7d2S1hqbr7zM+J0hv4NzQXc6d1juHQHVJxeziZgYvkz8Sld0HheXXLkvjWG5t+/+Pb9R5RCJ56WDpXixxkBAAAADSP9ITOM5AdxdPSn081bL8s25bgmWfN9ip8eV22veZwSm78LuN1vYnnxFVZb8h8BBI6K0Oko1dzEgOXIHxC52V1uchPyUqPr+n3v9g/KIuj9yn9O1ST8MmXOcgIAAAAaB4pzeUAkycatl/vLv+XNNurUP2WmkuHrzD/ZbRaluDc2cYEALE3dI7fsV2cxMBFclYrMnLkayq1kzvvbpk+JCY/pVY7dOQvOdAIAAAAaB7p4QmpOXVuoQ7G3mnYfple/m9l4CpZ6fHWbfu11rUfUPpJ/MfpXi5IV9b8y7DKPWEpBIY5iYGLNBI7KK61hPG6NWeXJMavaZ0AYOI6sR1unc+/zCsSTJ3lYCMAAACgOVTcHZKP6CwH6Jt5tmHLIJlf/q++z7Iu9/ll1W/+7fbB6dfqPhfBuTMqddMTt3ECA5cgdPR7KnVTO74gZXdny/Sh5OmR9LbPq9UPH3+Wg40AAACA5pGO6vykxlkuSiAVr/v+6Cz/V/+l5jIT5l9O1Z1+W7qWF+sbACitCJEJXcbJC1zsZ8FyXoJnv65SO7Hj9pbrR2LnXWq1h48+3LD3r4AAAACAD1nQXA4wUf+l50wv/1dzdUtmKFr3/dAKHQZnT9Z1P/wzr5ovalmSGtvOyQtcpPDJl4x+Tv5IuSss82N7Wq4fc6G9UvHoPFLkXE/J6MwBDjoCAAAAmsNSf1DldnMRkeDM/rrvj+nl/3KRu6TqdNU/ABgaF9tp/rnUYOxw3fahdzEjnuIp43WLw/uk5Onm5AUuii1jR76lcyE9+bm6LJdqWtXpkrlJvccAQkef4LAjAAAAoHmkt+osB9g3+5J0rK/VbT9Ulv+LXtmQOam4OyQfusN43cD0C2Ip/OTvXAZmT+kcr+PXcdICF3tezp+WrtybKrUT229p2b5obrt/+lvSs5Th4CMAAACgOaTCOncAWHZNgnOn67YfKsv/je1s2LxkIubXuXevJMWbm6/L9gcSOs//p1n+D7ho4WPPqNRd9V8jmcFoy/YlPbRV1nxXqdWPnPghBx8BAAAAzSEzNC41d69K7YHY0brth+nl/9Z8k7LUH2zYvKSU3s8wUId3M1i2LYHpF43XrXQOSnYwxEkLXAR3uSRDxx5WqT07+RkRsVq4O5YkJz+rVn30yDfqdvcVCAAAAPhYVadLstG7VWoHp1+p234YX/5v4uaGzkvBPyTrPRHzc1KHF1L15xfEtTpnvG4uepvYFl+tgIu6CD27X5zlnErt+LabWr4/8e371Gp3Ft6RwbnjHIQEAAAANAetZ90780elZymnvv3tsvzfB2UmbjVe0xd/RpyVsup2DyRPqNRNRa7gZAUuUvjod1XqLo7eJ8X+wZbvT7F/UBZH79Pr/9TTHIQEAAAANAfN5QAHEvpLz5le/s92uiU9PNHweUmH9xqvaVXLMjB/VnW7A3Gd1QZSozs4WYGL0Le4IN74Yyq1k7vua5s+JSY/pffv1ImviruOL8YFAQAAAB9ppccry4PX6gQA8UPq2296+b986A6puDsaHwCMbhOxzD9XG1R8D4Bl18QXe9543eXBa2S1p5+TFbgI4RMvqtS1HS6JT7TPyhyJievEdrhVajsqyxI68zoHIwEAAADNIT1+o0pd//Tzqi8/0ln+75qmmJOSp1uKw+afrQ1O630J9acT4lwvGK+bid7ISQpc1GdkTcYOf12ldmbic1Lq7G2bXpU8PZLe9nm1+qEjj3JAEgAAANAcUhGdZ95daynxZZJq262x/F+6gcv/fWhbxq83XrMn9aZ0rhZVtjeY1HnkIx2a5CQFLsJQcko6lnTu+knsvKvt+pXYcada7f7Zp6Q/P8dBSQAAAEDjZQcjUvUEVGoPJPTefmx6+b/1vq1S8A81TwCgtO79oNKFeiB+0HjNmqtbMkNRTlLgIoSnvq9St9oRlNk2fDHnXHivVDzDavUjx1/goCQAAACg8WoOh2TGdX6aE4zpLT1nevm/zPgtTTUv2cGQSjATjB0xXtNZLYs3Yf7LbS56l1SdLk5S4AJ5SssyePJhldrzOz8vVae77XpWdbplftfn1OqPHvmaOGpVDk4CAAAAGi+ltBygN/6suCrrxutqLP+XCl/WVHNiWw7Jjpu/JTV49gXj72YIpOLiqJh/y3U6ciUnJ3ARQqdeFataUqmd2HFr2/YtvuM2tdrulTMyrLRSCggAAAC4sIvfMZ1l1qxaRYJzZ43XNb78n+V49837TSYdvlzhS2hc+vMLZkMFpUc9Uk30TgagpQKAI99RqVvqm5TUcPsuy5nZslXWvHqPN4SOfZ+DkwAAAIDGW+vqleLwPpXaAwpLz5le/m9x7DZZ7+hsunnRCmZMv5shEDf/qMeab1KW+oOcnMAF8mfi0rvwnErt2cmfFttq38sc27Ikufun1OoPnPqadK4VOUjbFA+sAQBaSnrieumbe8l43cDM6yI3PmSsnsbyf5kmWf7vg1Z6vLISvFK6M2YvsAdmDsipvWZu43WXS9KXNL/WeGZ8HyclcBHCJ55Tqz3++u/J+Ou/R5Mv9t+vWkVCp16Vk5fdQzPaEHcAAABaykJYZznAntR+6Vox9xMPjeX/UmPNu9RcZvwTxmt648+Ks1o2Uis4Py2WXTO+jWml4xFoZ85qRUaOfI1GNLHQ4b+kCQQAAAA0Xj44KuWuEZXaA7Pmlp4zvfxfuXtU8sGRpp2XVGi3+S8plTUJzs8YqRVImn/Ew3a4JDU8wUkJXKCR2EFxrSVoRBPrSb8kgfQ0jSAAAACgsWzLkszWO1Rqm1x6zvTyf9nx28S2rKadl8xwVGou8+8nGIhPmZnbmf3Gt60QukMqbg8nJXCBQlNP0YQWED72HE0gAAAAoPE03jovIhKcNvOMuMryf5HLm3pOqk635MN3mJ+TmTcuuYantCI9C6+bPw6jV3MyAheoa6UgwTOP0IgWMDL1VWOPYYEAAACAi7YwtkPlDc/u5Zh4c/OXXMf08n8iIqnR7U0/L+mI+QvinoXXpXN16ZJqDMyeVtnf1NguTkbgAoVPvmT88xE6nKUFGZ1+m0YQAAAA0Fjrni5ZHLtNpfZA8sSl1zC8/F9xeJ+UOnuaPwAY26kzJ7OnLunvBxSWeCz3hKUQGOZkBC6ILaHD36QNLSQ09SRNIAAAAKAJLjbHr1OpG5y5tKXsdJb/u7Yl5mTRNyilfvN3KgzEL+3dDIGYwu3/E7dxEgIXei7Pn5au3Js0ooUEpr8lPUtZGkEAAABAYy2EdJbE88WeE2e1cvF/X2P5v/DulpmXzPg+819Az1z8+xS6lwvSlT1kfj9Dl3ESAhcofOwZmtBqbPvdxzZAAAAAQCMVAsOy3mt+CTZHZUUCqdhF/33Ty/9VPQHJDoZaZl7SYfMXxh3LM9KfW7iovxucO2N+Jy1LUmPbOQmBC+Aql2To2MM0ogWNHfmmWLy3gQAAAICGX2xuvVWl7qUsPWd++b87VV54qDYnI9tUtncwefziAoD4EePbUhzeJyVPNycgcCEXkWf3i7OcoxEtqDP/tgzOn6ARBAAAADSW1tJ4gYtcM15j+b90ky//90HrHZ0qL2i82Hcz+GdeNb4tWu+fANpZaOpxmtDK88fjGwQAAAA0PAAY2Sq2w2W8bt/8K+IprVzw39NY/m9hdGfLzUtGYTnAi3k3Q+9iRjzFU8a3Jc3yf8CFfaYupsQXe5RGtLChY18V9/oajSAAAACgcSpuj+TDd5ovbNsXtXa86eX/lgevkdWe/pabl5TCCxodlRUJLMxc2HzMmr/4r3QOttQ7GYBmED7xIk1o9YvGSlFCZ9+gEQQAAAA0VnpcZ4m8C312XGf5vxtbck7ywVGpdG4xXncgceyC/nwgYf75/1z0tpZ6JwPQaJZdk7HDj9CINhA68hhNIAAAAKCxtJYDDJ59+YL+/GZf/u8n2ZYl2Yk7zM/J9MZ/+mTZtgSmzf/UMRW5gpMOuABDySnpWDpGI9pAf/JJ6S/M0wgCAAAAGqfoHZA1n/kQwLN4QnoXMxv+86aX/6u5eyW7JdKy85IKm395Ye/8q+JZW97YF9X8grhW58zv1+gOTjrgAoSnfkAT2mk+j79AEwgAAABorPTEzSp1B5MnN/xnTS//l4veJVWnq3XnZHR7Q+dkIGl+yapWfScD0Cie0rIMnvwqjWgjo0ceEUetSiMIAAAAaJxUZK9K3WDsnQ39OZXl/8Ktfav5anefLG8xv1xecIN3WgTih42P3arvZAAaJXT6NbGqJRrRRjqWT8pQ4iiNIAAAAKBx0sPjUnN1Gq/rn35OLLt23j+nsvxfaGfLz0smer35AGD6pfP+GcuuiS/2vPnjTOl9E0DbBgCHv00T2lB46vs0oYW5aAEAoNVVnW7JRe+R4Cmz60w713MSSMUlc55n8U0v/7fq3yPLfYGWn5dUaLdEXjdbs6N4WvrzKVn0DX7kn/GnE+JcLxgdt+bqlsxQlJMN2CBfNi69C8+p1X/lc9+URe8wjT6HocRhufLxX1WrP3DqYfHc+itS6uyl2QQAAAA0RjpylfEAQEQkmDzxsQGAyvJ/E/vaYk6yWyJSc/eKo7xk9stn8sTHBgDBC3h3w0a1+jsZgHoLH39erfby4M2SGRynyR8hGb1K9nSPi3vlrEp9q1aW8KlX5ORl99DsFsQjAACAtrAQVloOcOatj/19jeX/0qE9bTEnVadLcpE7Febk4Mf+fiB+0PiY6ciVnGTARi8wahUZPfKw3gXu5AM0+WPUHE5J7vm86hihIzzeQQAAAEADLff6ZCVo/iKtP/G8uMsf/RIr48v/OT2SGp5om3lJR8y/zNAfe1ac1co5f89ZLYs3YX6ZqtTYTk4yYINGZw6Kay2hVj++lRdynk9sx22q9XtSL4o/E6PRBAAAADTwYnPiJuM1LbsmwbmzH/n7A9P7jY5XCN8hVZe7beZE48LZUV4Sf+rcXzwDqbg4KmtGx1vz7pKl/iAnGLBBoamn1Grnww/JSo+fJp/v3xL/iBSH71YdI3LsWRpNAAAAQAMvNiOXqdT1z50656+710vSZ3r5v+jVbTUnS/1BWfOZfzwjOHvu5/yDyRPGx8pM3MzJBWxQ10pBgmceUauf3HUvTd6g+G7dRyWGp/5cnNUyjSYAAACgMTJbIlLtMP+TIX/y3G/5H5g/s6FlAi9EO95qnhk3/1JDf+LIOX89EDtgfKx0aDcnF7BB4ZMvGV8W9Udsp0cS49fQ5I0GAFtvkJqzS62+ay0pozMHaDQBAAAAjVFzOCU7bv6lc32zPxRn5cM/5QgmpoyOU+rfLou+LW03LxoX0P3JFz70HgBXuSR9sy+aveBwOCU1spWTC9jYGSOhw9/U+yzZ+nlZ7+imzRu07umW1I4vqI4RmvoejSYAAACgcVJR8y8CtGpV8afjH/r1wPRrRsfR+El5UwQAI1vFdjjNfoGprIk3O/u+XwsuzIhVqxodpxC6UypuDycWsAED86elK/emWv3Ezjto8gWK7dJ9D0Dg7DekezlHowkAAABoUACgdAu99wMBQNdKUbozZpebS0X2tuWclN0eKYTM35nR/4EAwD932vgYmchVnFTABoWPPaNWu+IZlrnQZTT5Ai2M7pJS36TeALb97mMfIAAAAKARVrv7ZGnI/BJRfemZ9/1/YGHa7HcoyyHp4W1tOy8aF9L9qbPv+3/vvPkXAC6EJjmpgA1wlUsydOxhvQvZnT8nVaebRl/Evy3JPZ9THWPs8DdFxKbZBAAAADRGevwG8wFA6vj7/v+jVga4WIuhO6Tc0b63mqfGdpkPAOaPvffflm1Lf/JVo/XLPWFZ9A9xQgEbuQic3i/Ost6t4PEdt9LkixTbcYtq/a78WzJo+N9EEAAAALDxi82w+ZfOdWfeft9L57zJw0brpyNXt/WcFALDUu4eNVqzJ73/vVUYehcz4lw3e/GRmbhNbMvihAI2IHT0CbXapb7dkh7aTpMvUrF/UAoh3SUBw8efodEEAAAANEZ2MCyVTrNv07dqVekpZkVExFVZl975V4zWT7X5rea2ZUlm4nazc1ItS/dSXkREvJmE8W1O87wxsCG9xbT4Yt9Rqz+7+2cI4y5RbPf9qvWHjn1V3OUSjSYAAACgUReb5l8611189yfMvszsez95NqHcHZJCYLjt5yUdNv+Sw75C+t0LkNys2cKWJalRfuIIbETk+Auq9ePbbqLJlyg5fo3U3F69i8pyQcbOvkmjCQAAAGiMVPQKhQAg8+5FZzZptO5mudVc44K6Jz//bgCQjRutWxy+SUqdrDcOnI9l12T0yNfV6i8P3iIF/yiNvkRlt0fmd/2i6hihI4/RaAIAAAAadbG5Q8TwRXVX8d2fNvdlzF5spsOb41bzUmePFIfN/iSvp/BuANCTPm52Tsav5yQCNmAoOSWe4pRa/eTkAzTZkNjOO1XrexOPS19hgUYTAAAA0IiLzW5ZHDX71uiuxXcvNvtSJ80Vtax3w4pNIhO91mi9zsU5cdSq0pU/ajYAUFi1AGhHoWNPq9aPb72BJpv6XBvaJqs+3RfORk68QKMJAAAAaNCXHcMXmx0reRER6Um9ZaxmcXjfprrVPG34ZYddhbh0ri6J2ObWoK54BiQ7GOIEAs7DU1qWLSe+olY/F/msrPT4abQhtmVJcs9Pq44xeuQRo+/IAQEAAAAbthDeY7SeezUrnrVlcVRWzF0Qj1+3qeYkOxiWaoe5L/SdhWPStVwwe9ExfrvYFl+RgPMJnX5drKrem9+TO++hyYbN7LjZ+ONxP6lj6YQMJY7SaAIAAADqrxAYlnJP2FwAsDIv3UtmLzbbffm/D6o5nJKLmlsO0KqWxZuKGd3GdORyTh5gIwHAkW/rfVY4uyQ5fjVNNmylxy/ZqO5dAOFjP6DRBAAAANSfbVmS3nqHsXqutYX3VgIwodI5KLmBsU03L+mI2RUadj73e0brLYzu5OQBzsOXTUjv/LN6nxPbPifrHazEoSE++SnV+oMnviKe0jKNJgAAAKD+UobXnr/88X9irFZ2k95qnhpr3pcergxcLas9/Zw4wHmEjz+nWj+54w6arNXb6JVS9WxRq2/VyhI+9SqNJgAAAKABF5uj28V2OJty29LhKzblnCz3+mU1sLc552T8Rk4a4HwXELWKjBz9c7X6Fc+wzIX20mglVadbZie/oDrGmOLjISAAAADgI5U7PFII3dmU29bMPwnXlhm/qTkDgNBuThrgPEZm3hH3akyt/vyuz0nV6aLRiuI7b1et37vwvPgzcRpNAAAAQAMu6qLXNN02LW+5Xla7+zbvnDThhXbN1S2ZoSgnDHAe4amnVOsntt9Kk5VlBsdleUA3iNV+TAQEAAAAnNNCuPnetJ+OXr+p5yQ9PC62091U25SL3MVPHYHz6FopSPCM3u3/pb7dkh7aRqPrILH7s6r1R45+TZzVCo0mAAAAoL4WfVuk1N9ct9unwpv7VvOKq0Py4buaapvS0Ss5WYDzCJ98ScS21erP7v4ZsRXXqcePxbbfpPoiWtdaQkZiB2k0AQAAAA24uNvaPLeUVt19kt0SYU4iVzXX9rD8H3AetoSOfEt1hPi2m2hznax19Ulm2y+ojhE6+j0aTQAAAED9pcKXNc225MbvklqTrkxQ1wvusea54F7z7pKiN8iJAnyMgYUz0pV9Q63+8uAtUvCP0ug6ik/eq1o/ePbr0r2cp9EEAAAA1DkAGNkqNaenOS58N+nyfx9U8A/Jeu9EU2xLZuJmJgQ4j/CxZ1TrJycfoMl1Nhu6TMrd43oD2Pa7j42AAAAAgHqqutySjzTHM+epELeav3fhPd4cF94s/wd8PFe5JENTX1UdI771BhpdZzWHS2Z3/7zqGGNHviUiNs0mAAAAoM4X3uONXw5wNbBXlnv9TMaPLryb4NEM2+GU1MhWJgP4uIu46f3iLOfU6ucin5WVHj4bGyG2Q/cdOV25N2Vg/jSNJgAAAKDOAUBoV+MveCf2MRE/OSej20Ua/MbvQuhOqbg9TAbwMUJHn1Ctn9x5D01ukHxgTIpDd6qOof34CAgAAAD4kKW+gKwG9jY2AOBW8/dZ93TJ4khjHwPINNlqBECz6S2mxRf7jlr9mrNLkk1wh9ZmltjzkGr9oWMPi6tcotEEAAAA1PkCvIE/ga+5OiU9PM4kfPACPHptQ8dfCE0yCcDHiBx/QfdzedvPy3pHF41uoPjW68VWfFGus5yTsbP7aTQBAAAA9dXI5QDz4Tuk6nQzCR/88j/WuEczyj1hWfQPMQnAR7Dsmowe+brqGMmdd9DoBit5eiS1/RdVxwhNPU6jCQAAAKivzFBUau7exlzoRrnF9VyygyGpdA425niYuE3sBr+DAGhmQ8kp8RSn1OpXPMMyG7qMRjeB2OTdqvV9sUelbzFFowkAAACon6rTJdnxxrxsKj26gwk4B9tySC56W2PmhAsP4GOFjj2tWn9+8uel5nDR6CYwPzop6726d2SFT7xIowkAAACor1TkyrqPuebdKYu+QZr/URfikcvrP6hlvbsKAYBz8pSWZfDEw6pjJLbfQqObhG05JLnn51THGDv8iFh2jWYTAAAAUMcAILSz7mNmxln+72PnpAF3RxSHb5JSZzfNBz7qYu306+KorqrVL/VfJukt22h0E5nZeatq/Y6lYzKUnKLRBAAAANTPSo9XlrdcV9cx02FuNT/fnKwMXF3fORm/nsYDHyN05Duq9Wcnf4p3cDSZYv8WKYx9WnWM8NQPaDQBAAAA9ZUev7FuY9kOp6RHttL0887JDfUdr4GrDwDNzpdNSN/8M6pjxLdxZ1Qziu++X7X+4Mmviqe0TKMJAAAAqJ9UeE/dxiqE7pSy20PTz3dBHtpdt7EqngHJDoZoOvARwsefV62/tOVWKfhHaHQTSkxcKzVXn1p9q1qS0OnXaTQBAAAA9ZMdDNdt6blM5CoavpE+DY1LzdVZl7Fy47eLbfE1CDjnBUKtIiNH/1x1jOSuB2h0kyq7O2V+1/+gOkboyLdpNAEAAAD1U3M4JDt+e13GWghN0vANqDpdkg/fVZexGrLqANAiRmKHxL06ozeAZUli6w00uonFd92hWr93/lnxZRM0ugGst/c/atMGADBjllgVAIypyihNAACD+KoKAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAgACAFgAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAGOeSFE0AAFP6yiGaAACG9MoyTQAAg7gDAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAABAC0AAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAAgAAAAAAAEAAAAAAAAAAWpWLFjSfPU/+T+JemlKrXwx9Vk7f+Ks0ukk4qhW57LG/JY5yTme+Rx+U0zf9Oo0G6uATj98vznKSRih5895nZK3LTyOAFrP38Z8VZ3muLffNdnRKzRWUmjsgVXe/VDyDUvX4pOwJSLkrKOtdQVnvDspa96DUnG4OBhAA4MNy0U/KlsN6AUBv8glxlX9JKu5Omt0EvAvH1C7+3z2ebqbJAAAACqzamjjXE+JcT8j5Lu/LPXtl1btXVv07ZcU7Lsu+qFRdfB8HAQABQOha2XJY84OqJN65I5IJX0Ozm4Av9qpa7Zo7IIWh3TQZAACgwdzLh8S9fEj6f3SjmOWQNd8tsjR4gyxuuUKWfONiO5w0CgQAm81ab1BWgzdLV+aHihedLxMANAFnpSR9icfU6hciD0rNyWkOAADQdOyadOael87c8zJwXKTmHpLF0YckP/oJWRzYKbZFGADzeAlgk8pF71Ct3zv3pLjWV2h0g/lmD4tVK6nVz0ZupMkAAACtcGFWnhff9H+W8Zd/RfY89bdk9NhfiWc1R2NAALAZ5EevELEUp8euiT/5Do1udAAQe0mtdrl3UpYCUZoMAADQYlxrp2Tw2O/L5FMPycT+P5aeQoymgACgnZU9PVIcuV91DK/ixSfOz11akt7ZJ9Xq58bvo8kAAAAtzZb++H+X7c/9gmx9/d9K92KcloAAoF3lIrpvb+9ZeFo61hZpdIP4EwdFxFarnw1dS5MBAADaRN/sN2THs5+X6MH/Ku4S3+FBANB2CsO7pObyKo5gi4/HABrGN/OcWu2VwTuk1BOgyQAAAO32HfLsf5LJp/+mDMReErFtGgICgHZRc3bIYvgB5YvQ52l0A3iWs6qrPOSit9FkAACAdr2IK6dk7K1/JNtf+T3pWCvQEBAAtIuc8lvcuzI/FM8KbxetN3/iLbXatsPz7kskAQAA0NZ6Uo/Jzmd/VbwLh2kGCADaQTG4VSpdum9y9yfeptF15pt+Wu+YCT0kFXcnTQYAANgEnOsJGX/l12Tk5OM0AwQArc62LMlHP606hjfGYwD11F2YFc/iAbX62chNNBkAAGCT2XLkX8n4W/+vWLUqzQABQCvLha5Trd+Ze126iikaXSf+xH612lXPqCxu2UGTAQAANiFv7P+TrW98SRzVMs0AAUCrWvEOS8l7teoYvuTbNLoebFt800+qlc+PPyC2xWkNAACwWfXOfUu2vvFvCQFAANDKcuP36AYA09+nyXXQl50W18pptfrZ8PU0GQAAYJPrmf+2TLz5ZbFsHgcAAUBrBgBjV6nW7ygelu7CLI1W5ou/oVa75L1aVryjNBkAAADSO/cNCR16mEaAAKAVrXd5ZXlI9y4AzWfTIWLVquKd+a5afe27RAAAANBaAmf+WAaneeE3CABaUj5yi2p978wPRGybRivpT50U5/qCUnVLcqGraTIAAADeZ+TgP5Oe/DSNAAFAq8mN7BXb4VGr714+Lr25GI1W4o+9plZ7aeQ+We/sp8kAAAB4H8uuSOTN/1Mc1XWaAXHRgtZRdXdKMfSg9M98Q20MX2K/LAUiNNswZ2Vd+uPfUaufU747BEBjHbr1m7LcN8K/g85ODgYA7zl161dktW+4fhfStao4qmVx2BVxlYriLi2Kq1SQjtW0eIpnpbMwJe6Vw03Zq47lgzI29Q2JXfYFDhwCALSSXOQm1QDAO/OkJPZ+VmzLotkm+zp/VKzqikrtmqtP8iN7aDLQzhe+rk6puLpoBAC877PRI1VXg4LB7oFz/rKzUpKe/LT0ZqekJ/WWdGeeEpHmeMQ2cOrfSzZ0iyx7wxw8mxiPALSYwuAOqXZsUavvWotJb+YMjTbMN/OyWu3F8Gek5uygyQAAAA1WdXlkcWCnJHd+Rk7c/M/lyH2Py+yV/4esBpvhZc22jL3zn5gkAgC0EtvhlEL0QdUx/PE3abRBrvUV6Z19XK1+LnIjTQYAAGhCZU+fLERvl+M3/ws5cccjUgj/sog07k7bruwPxD93gIkhAEAryYWuU63fH3tcrFqVRhvimz0klq3Tz3L3NlkMTtBkAACAJrfSPyZnr/41mbrnr6QQ+qWGbcfQsT9j5S8CALSSpUBEyr2TavWd6wvSnz5Fow3xK669mh//tAjvawAAAGgZpe6gnL3m1+XMzX8q5Z7L6z6+p/CKeFNHmAgCALSSXPSTqvV9sddpsgEdqwXpTj2rVj8bvo4mAwAAtKDF4E45dvu/a8jdAIOn/ooJIABASwUAoWtV6/fHvyuOaoVGXyJ/Qu8Zq9XgPlnrHaDJAAAALarq6pSz1/y6zO/5p3Udtyf1mHQup5gAAgC0irXeoKwGb9Y7MCoF8S4co9GXyDf9tFrtXPROGgwAANAG5rZ/WhJX/0FdxwzEX6LxBABoJbnoHboXr3EeA7gUXcWUdObfUKltO1ySG7uSJgMAALSJdHifJK/8vbqN54s9RtMJANBK8qNXiFh6U9iXeFSclRKNvkiayykujT4glY5umgwAANBGUtHbJLP979dlLPfKYeleTNB0AgC0irKnR4oj96vVt6pr4p2fotEXyTfzlFrtbORmGgwAANCGEpM/K6vBe+syVv/COzScAACtJKd8IeiLvUyTL0JPLibuJZ13KFQ7BqUwtIsmAwAAtCHb4ZTpq39LbGev+li9qf00nAAAraQwvEtqLq/eh8LsE+Iqr9HoC+SPv6E359GHxHY4aTIAAECbKnUHZWHX76iP0515Shy1Mg0nAECrqDk7ZDH8gFp9q1YRX5Jbgy6oZ3ZNvDPfU6ufDd9AkwEAANrcwsRdUvVEdL+31talqzhHswkA0EpykRtV63sTr9LkC9CXPi2utZhK7fW+vbLsD9FkAACANldzdkhqx99RH6e7ME2zCQDQSorBrVLpiqrV7519UtylJRq9Qf6Y3vKJufFP0mAAAIBNIh25RWrOftUxOhdnaDQBAFqJbVmSj35acwTxzR6i0Rs5oaoV6Y89qlY/G76GJgMAAGwSVVenFMd+RnUMzxJ3ABAAoOXkQtep1vfNvECTN8A7PyWOSkGl9vKWu2W9y0eTAQAANtP3/DHdVb88xeM0mQAArWbFOywl79Vq9btTz0nHaoFGn4cv9oreh3/0NhoMAACwyRSDO8V2dKrVd62dFMuu0WgCALSa3Pg9qvX9iQM0+eM+PMtr0pd8XKW27eyW/OhemgwAALDJ1BwuWQ3coTeAXRPXOu/7IgBA6wUAY1ep1vfGXqTJH8M3e0isWkml9mLoIam6PDQZAABgE1oeuFK1vmt9mSYTAKDVrHd5ZXlI7y6AruxL0rmcodEfFQDEXlKrnY3eRIMBAAA2qdW+sGp9Z2WVJhMAoBXlI7foXuTyGMA5udeK0jP3lErtSldUigNbaTIAAMAmtd4d1A0AygQABABoSbnRy8V26N0q7pt5miafgz95UERsldr56KfFtjhVAQAANm0A0BWgCSAAwIdVXR4phh5Sq+8pvC1dxQUa/QG+mefUamfD19NgAACATazc0ata31kt0WQCALSqXOQTqvX98f00+Sd0LmekK6Pz/P+a/wZZ7R+iyQAAAJtczeVTq83dpgQAaGGFwR1S9Qyr1ffO/IAm/wR//C212rnoXTQYAAAAYjv17gKoOdw0mAAALfvh4HBKIXK/Wv2OpaPSk0/Q6L/m0wpELIfkQlfRYAAAAIht6b3ny3Z20GACALSynPJz474EjwGIiHQXktKx+I5K7eLI/VL29NJkAAAAiFVdVqtdczhpMAEAWtmSPyzrvbv1AoCZp0Rse9P3WfN9CLnozRzIAAAAEBERZ3lOLwBwemgwAQBaXT56r1pt18pp6c3NbOr+WrYtvpnv6XwIuwNSGJrkIAYAAIA4ahXV+mVPP00mAECry4WvVa3vj7+5qfvbmz0rrpXTKrULkQel5uRlLAAAABDpWMur1bYtp1Q6emgyAQBa3VpPUFYHblGr7515Qiy7tmn764+9oVY7G7mRAxgAAADvBgArGbXalc7tLANIAIB2kYvcrlbbWUpKX/rMpuyrVauKd+Yxldrl3klZ8kc4eAEAACAiIp6VlFrtck+UBhMAoF3kx64QUUz0fPHXN2VfvakT4iinVWrnxu8TsSwOXgAAAIiISGfhrFrttb5tNJgAAO2i3NEjxdH79S6EY0+IVatuur76Yq+q1c6GruXABQAAwHt6Mnrv3lrzjtNgAgC0k1xYbzk5Rzkt3oXjm6qfzkpJ+uM6t/+vDN4upZ4ABy0AAABERMS1viyexdfU6q/2hWgyAQDaSWF4Umour1p9X+KNTdVP79xRsaorKrVz0ds5YAEAAPCe/vSUYnVLVvtGaDIBANpJzemWxfCDavX74o+Jo7q+afrpj72sUtd2eCQ/egUHLAAAAN7jS7ygVns1cJdUXR6aTACAdpOL3KB3EFWWxDu/OR4DcK2vSO/s4yq1i6EHpeLu5GAFAADAu989yyvSO/cttfrFoRtoMgEA2lExuFUqXRNq9bV+Kt5s/Ml3ROyaSu1sZB8HKgAAAN4TSLwmll3Ru0YYuIwmEwCgHdmWJfnofWr1e5NPiLNSavs++maeV6lb9YzK4pYdHKgAAAAQERGrVpWBUw+r1a+6h2XZG6HRBABoV7nwdYofUCXxzR5u6/55VvLSnXpOpXY++oDYFqcjAAAA3hVMvCbu5UNq9QuRnxPb4aTRBABoVyv9w1LyXaNW3xt/ra3750u+rVY7G7meAxQAAAAiIuKslmRo6v9RHSM7djONJgBAu8tF71ar3Tf7XXGtr7Rt7/zTz6jULXmvlhXvKAcnAAAARERk+Pij4lo9oVZ/ve86WfZx+z8BANo/ABi7Sq+4XWvbxwC6igviyb+pMyfj93BgAgAAQEREenNnZeDEl1THyEz8NI0mAMBmsN7lleWhe9Xq+2ZebMu++eP7lSpbkgtdzYEJAAAAcZVXJPLmvxYRW22MqntYMuGbaDYBADaLfETveZ+ehafFvVZsu575pr+nUndp5D5Z7+znoAQAANjkrFpVxt/8srhXjqiOk97xK1J1emg4AQA2i9zo5WI7tE56W/zJg23Vr97sjLiXj+vMReQWDkgAAABI5J0/k56Fb6uOUfVEJTV+J80mAMBmUnV5pBh6SK2+L9ZejwH442+o1K25+iQ/socDEgAAYJMLH/6a+Kb/s/o4c7t/U6quThpOAIDNJhf5hFrtrvQL4lnJtUWfLLsm3pknVGovhh+SmrODgxEAAGCTsmpViR74LxI49WX1sVYDd/LsPwgANqvC4A6peobV6vva5DGAvtQpcZaSKrU1QxgAAAA0N9f6smx77Yvim/4T9bFsyyXxK35DbIvLPwIAbEq2wymFyP16AcDMs23RJ3/8NZW65e5tshic4EAEAADYhHry07Lz+d9Rf+b/Rxb2/C+y0j9G4yEuWrB55cLXS+DEf1Gp3Zl7XTqX0rLWO9Cy/XFUy9If+65K7fz4p0Qsi4MQwIZc+cz9m26fj33iv0l6y+VMPoC24qiVZfjEd2Xw+BdF7Fpdxlze8hmZ33ovzce7xyAt2LyW/GFZ792tVt+feKul++OdPyaOSkGldjZ8PQcgAADAZmHbEki+KZPP/D0ZPPb7dbv4L3fvkelrfpNb/0EAgHflo3ppoG/m6ZbujT/2skrd1eC+lr4zAgAAABtj2VXxzR+UXS/8Ywm/8dviXj5Ut7FrrqCcufFfSrmjl4nAe3gEYJPLha+VLYd1ancsviPdhTlZ8Q633olRXpPe5GM6PY+y9ioAAEA761jNSSDxigTPPCKu1eN1H992dMjZG/9QVvtGmAwQAODH1nqCsjpwi3SlX1Sp70u8JSveT7dcX3zJd8SqVRQ+jF2SG7uSAw8AAKCNOKpl6S4mpC91WPpnX5DO/AsN2xbb0SHTN/57KQZ3MDEgAMCH5SK36wUAM09Jck8LBgCxl1TqLo0+IJWObg46AACAFuGslMSyq+KorIujVhbX+pJ0rGbFvZYVz/KcdOUOiafwslh2teHbaju7ZfqGP5LC4B4mDgQAOLf82BUy+pZD5WUk7uXj0puLyZI/3DL96FhblJ7576vUzkX2ccABAAAYsPOZn6MJP6HaMSpnb/wDWfKP0wx8JF4CCCl39EhxVG+JKV9if0v1w5c4KCK2wofyoOSHJjngAAAAYFSp/wY5eet/4OIfBADYmFz4ZrXa3pknxbLtlumFf+Y5lbqF6ENiO5wcbAAAADBmMfQ35MQtvydrPYM0A+fFIwB49+J0eFJqLq/Kuveu1RnpzZ6VYnCi6fvQuZyRzqzO8n/Z8PUcaAAAADCi5uyX2cv/qaQjN9MMbBh3AOCvP0Dcshh+UK2+L/5mS/TBH9d5XGG9b68st9B7EAAAANC8VgY/Lcfv/O9c/IMAABcvF7lBrbY39oRYCi8ZNM03rfTyv/FPcoABAADgklQ9EUlc84dy4qZ/KqXuIA3BBeMRALynGNwqla4Jca2eMV7bWZqT/tRJKWzZ2bT735NPSkfxsE4AELqGAwwAAAAXxXb2Smrnb8nCxD1SdXXSEFw07gDAjz9YLEvy0fvU6jf7YwBa27e85W4pdfs4wAAAAHBh388dHZKb+HU5es/XZXbHg1z845JxBwDeJxe+TgamdGr3xx4Vx5Wfk5qz+Q47y7bFN/OETk+jt3FgAQAAYMNq7kHJTvyyLEzcLWVPPw0BAQB0rPQPS8l3jXjy5l+G56gUpD91XPLDe5puv3szZ8S1Om28ru3slPzoXg4sAAAAnNd633WSmfgpyYRu4qf9IABAfeSid8twXudt+P7Ya00ZAPjjb6jUXQx9VqouDwcVAAAAzqnmCkoh/DnJhm+VJd84DQEBAOocAIxdJcMHdGr3Jb4rzqt/UaqujqbZX6tWFe/Md1VqZ6M3cUABAADg/Rf97iFZHHlAFoevl8LgpNScHTQFBABojPUurywP3Ss980+Zv9iuroh3/qhkx65smv31LhwXRzltvG6lKyLFga0cUAAAABARkaXhn5bUts9KMbBVbMtJQ1B3rAKAc8pHblar7Yu/1lT76o+9qtPD6P1iW5xiAAAAeFdH8ZR4lufFqlVpBhqCOwBwTrnRy2XU4RGrVjJeuzf5mLjKvyQVd+NfbOKslKQv8ahK7Wz4eg4kAEYcuvWbstw3sqn2ucrtsADaMQBYPiijbx+ULVPbZGHXr0g6vE9sB5dkIABAo794uTxSDD0k/TN/Yby2VauId/awZCLXNnw/fXNHxKquGa+75r9eVvuHOJAAGPpM7pSKq4tGAEC7XIStnZLRA/9EBk5dI4krflMWByZpCuqC+5PxkXKRT+hdeMdfbop99M28pNO76N0cQAAAAPhYHUv7ZeKlvyPRA38irvIqDQEBABqnMLhDqp5hldq9c98Td2m5ofvnLi1L79yT5gtbDsmFruIAAgAAwIb4pv+L7Hzut6U3f5ZmgAAAjWE7nFKI3K9UvCa+2UON/aBNHhSxa8brLo18WsqeXg4gAAAAbJh75YhsfeGXZSD2Es0AAQAaI6f4IjvfzAuNDQBiL6rUzUZv4cABAADABbPsioy99Y9k9Nhf0gyo4CWA+FhL/rCs9+6WjqWjxmt3p56VjrVfk/XO/rrvl2clJ92p54zXrbkDUhjiJS4AAADaTt36FVntu7THVS3bFmdlTVzrS+Jey0vn0qx0Lp6V7ux+cS+/07B9Gzz2B+KsrEnssl9gokEAgPrKR++VLYePqtT2JQ7IwrZb675P/sTbKnULkQel5nRz0AAAACirujxSdV36stIVd5eUuvwi3rDI0OXv/bpnJSP96aPiiz8t3ekn675/gVNfFltE4oQAMIhHAHBeubDecn2+WGMeA/BNP61SNxu5kQMGAACgDZS6g5KK3CIn9v2vcuyev5LM9t+WmrO+d64GT31Zhk8+wWSAAAD1s9YTlNUBnefauzIvSedypq770704L57CW8brlnsnZckf4YABAABot+/D3QMS3/N5mbrnEclu/U2xLWfdxh468r+Lf/YtJgEEAKifXOR2tdq+5MG67osvsV+nR9FPilgWBwsAAECbKnv6JLb3F+Xk7Q/Lmndf3cYN7//H0r0YZwJAAID6yI9dIWLpHC5at+Ofk22Lb/p7KqWz4es4UAAAADaBlf4xOX7r70lm+2/XZTyruiTR1/+1OMurNB8EANBX7uiR4uj9KrU9hbekq5iqy3705mbEvXzC/D8Cg7dLqSfAgQIAALBJ2A6XxPd8XuLXfklsR4f6eB3LByVy8E9pPAgAUB+58M1qtf1Kt+V/aJz4mzq9id7OAQIAALAJZcZukLOf+I91eUFgf+IrMjj9PE0HAQD0FYYnpebyqtT2zug/BmDZNfHOfNd4Xdvhkfzo5RwgAAAAm9TiwC45e9P/XZcQYOSdfy7dBd4HAAIAKKs53bIYflCldkfxsPTkE6rb3586Kc7SnPG6xdCDUnF3cYAAAABsYsXANpn+xB+pPw5g1dYluv/3xVEt03QQAEBXLnKDWm1f8m3VbffFXlOpm43s48AAAACALAZ3Suy6P1Ifp6P4powe+xYNBwEAdBWDW6XSNaFzgT79pIht6xzo1XXpjz9mvG7VMyqLg9s5MAAAACAiIrnhK2Ru779QHyd48o+kL3uKhoMAAHpsy5J89D6V2q6V09Kbi6nU9s4fE0elaLxuPvqA2A4nBwYAAADeM7/1HslHf0V9nPD+fyPOSomGgwAAenKK693742/o1J15WaVuNnI9BwQAAAA+JHb535A1362qY7hXDsvY0UdoNggAoGelf1hKvmtUavfHnhLLrhmt6SqvSu+s+bf/l7xXyYp3lAMCAAAAH1JzuOXs9f+zVDt0vy/6z/xH6c8cp+EgAICeXPRulbqutZj0pc8YrelLHhKrVjHfg/F7ORAAAADwkUpdAYlf/c/Uxxl7+0usCgACACgGAGNXqdX2Jd40W2/mRYWttCQXupoDAQAAAB8rP3SFZCd+Q3WMjuWDMnLiUZoNAgDoWO/yyvKQzk/AvTPfFatWNfNhuLYoPQs/ML6Ny8OflPXOfg4EAAAAnFdiz8/Let+1qmMET3xJuotJmg0CAOjIR27WOSjLaelPnTRSy584oLKN2eitHAAAAADYkJqzQ2JX/a6IWGpjWHZVQgf+g/H3aYEAABARkdzo5WI7PCq1/fHXjNTxTT9r/gPc1Sf5kT0cAAAAANiwJf+4pHf8juoYXdlnZHD6eZoNAgCYV3V5pBh6SKV2X/yJS36RSedSWjpzrxrftsXwQ1JzdnAAAAAA4ILM7vyM+qMAQ4f/jXSs5mk2CABgXi7yCZ0Ds1IQ7/yxS6rhj+9vqX0GAABAe6s53RK/8h/oXuBVFyV06E9pNggAYF5hcIdUPcMqtX2X+BiAb8b8y//K3dtkMTjBxAMAAOCiFANbJTf+a6pj9M3+hfjn3qbZIACAWbbDKYXI/TofXInHxFkpXdTf7cknpKN42Pg25cc/JWJZTDwAAAAuWnL356TqiaiOMXrwD8VZXqXZIACAWbnw9Sp1rVpJvHNHL+rv+uNvqGxTVmlfAQAAsHlU3N0yu1f3hYCutdMyOvUNmg0CAJi15A/Leu9uldq+2CsX/Hcs2xbvzJPGt2U1uE/WegeYcAAAAFyyzNgNsjJwn+oYgTN/LL25MzQbBAAwKx+9V6Vu79wT4lpfuaC/05c5La7VGePbkoveyUQDAADAmPjlvya25VQdI3Tgy2LVKjQbBAAweHEc1lnOxKpVxDd7Yc/y+2KvG98O2+GS3NiVTDQAAACMWe0bluz231Idw7P4qgydfopmgwAA5qz1BGV14BaV2r7YSxs/oKsV8caeML4NS6MPSKWjm4kGAACAUbM7PiOVrh2qY2yZ+qJ0LqdoNggAYE4ucrtK3Z7574u7tLShP9u/cFwc5bTCvu1jggEAAGBc1eWR5N6/rzqGVVuT0Dv/mWaDAADm5MeuELE0Dilb/MmDG/qT/vir5j+UOwYlPzTJBAMAAEBFbuRqWR76jOoYPQuPSlDhuzIIALBJlTt6pDh6v0ptb+yH5/0zzkpJ+uKPGh+7EHlQbIeTCQYAAICa+N6/JbblUh1j5NAXxb2+RLMJAAAzcuGbVep2p54Tz0ruY/+Mb/awWLWS8bGzkRuYWAAAAKha69ki6Z2/qzqGcz0pY0ceptkEAIAZheFJqbm8KrV9yXc+/vcv4GWBG7Xet1eW/WEmFgAAAOrmtn9ayt17VMfwzvxX6U8fo9kEAMClqzndshh+UOfDKvHyR/6ee31Zeue+Z3zM3Pi9TCoAAADq9F26Q5KX/5b6OKEDXxJHtUzDCQAAAxfNSrfMd6VfEPda8Zy/50seErFr5vcldC0TCgAAgLrJD10hxZGfVR3DvfyOjJx4lGYTAACXrhjcKpWuCZXa3vmj5w4ANvCSwAu1vOVuKXX7mFAAAADUVeKyXxbb0ak6RvDEl6S7mKTZBADApbEtS/LR+1Rq988d+NCvudeK0r3wtPGx8tFbmUwAAADUXak7KKld/1B1DMuuSujAH4ulcBctCACwyeTC16nU7Zn/oVi2/f5QIHXS+Di2s1Nyo5czkQAAAGiI+W33ynrPFapjdGWfloGZF2k2AQBwaVb6h6Xku8b8AVtOS9fi3Pt+rW/+oPFxFkOflarLw0QCAACgIWoOtySv+G31cYYP/4F0rBVoOAEAcGly0btV6vZmTr3335ZtS+/sc8bHyEY+wQQCAACgoQqDu2Vx9Bd0LwgrWQkd+jOaTQAAXGIAMHaVSt3u7I8DgO7CrDjXF4zWr3RFpDi4jQkEAABAwyUu+yWpOftVx+hLfk18CnfVggAAm8h6l1eWh+41Xrcre/jHAUA+Zrx+Pnq/2BanBgAAAJrhO7VPFnb/rvo4Ywf/rTgrazScAAC4hIvpyM3Ga3YUj4iz/O6HU3fG/AsAc+HrmTgAAAA0jYXxO2W97zrVMVyrJ2T02LdoNgEAcAkX06OXi+0w/zK97r9+EWB35h2jddf818tK/xATBwAAgKZhO1wSv+LvqY8TOPXvpSc/TcMJAICLU3V5pBh6yHjdzuK8OCsl6SgeMlpX68WFAAAAwKUoBndIIfw3lUexJXzgy2LVqjScAAC4yItqhTfqdywtiGc5a7ao5ZBc6ComDAAAAE0psecLUnMFVcfwFF6WoTPfp9kEAMDFKQzukKpn2OwHUzEhnUspozWXRj4tZU8vEwYAAICmVPb0y/zu31EfZ8vUF8WzkqbhBADAhbMdTilE7jcbACyeEs+y2QAgG72FyQIAAEBTS43fJmvefapjWNUVCb/zJzSbAAC4OKbfrN+xdFS2vPMlY/Vqbr8UhiaZKAAAADQ123JK4oq/qz5Oz/y3JZh4nYYTAAAXbskflvXe3U27fYXIQ1JzupkoAAAAtMB36wnJR39FfZyRQ18U1/oyDW8jLlqAeslH75Uth4825bZlIzcyQQCa1pXP3E8TzuGHn3mbJgDYtJK7Pyf9ye+IozyvNoazFJexo38u01f+bRreJrgDAHWTC1/blNtV7t0lS/4IEwQAAICWUe7olbnLfld9HN/0n0hf5gQNJwAALsxaT1BWB5rvRXu56H0ilsUEAQAAoKWkw/tkzX+7+jihA/9OHNUyDScAAC7wYjtye9NtUzZ8HRMDAACAlmNbDolf8esiovvDrI6lt2X41OM0nAAAuDD5sStErOY57FYHbpNST4CJAQAAQEta9kYku/U31McZOPZF6Vqao+EEAMDGlTt6pDjaPC+zyo7fwaQAAACgpc3u+mmpdoypjmHZVQkf+GMR26bhBADAxuXCNzfFdtgOj+RHL2dCAAAA0NIq7m6Z3fsP1cfpynxfBmM/pOEEAMDGFYYnpebyNnw7imMPSMXdxYQAAACg5WXGbpDV4L3q4wwf/qK4S4s0nAAA2Jia0y2L4Qcbvh3Z6M1MBgAAANqDZUn8il9Tf9+Wo5yS0KH/Rr8JAICNy0VuaOj4Vc+oLA5uZyIAAADQNlb6RiWz7e+pj9Of+Kr4Fg7RcAIAYGOKwa1S6Zpo2Pj56P1iO5xMBAAAANrK7I7PSKVzq/o4owe/JM5KiYYTAADnZ1uW5KP3NWz8bIPvQAAAAAA0VN1dMrv3H6iP416ZkpHjf0XDCQCAjcmFr2vIuCXvVbLiHWUCAAAA0Jayo9fKyuCn1ccJnvy/pKcQo+EEAMD5rfQPS8l3Td3HzY3fS/MBAADQ1uKX/6rYlvYjr7aEDnxZLLtKwwkAgA1cjEfvrvOIluRCV9N4AAAAtLXV3iHJ7PgH6uN05n8oW848S8MJAIANBABjV9V1vOXhT8p6Zz+NBwAAQNub2/GAlLt2qY8zdPT3xbOapeEEAMDHW+/yyvJQ/W7Jz0ZvpekAAADYFKpOj8xe/tvq41jVJQkd/BMaTgAAnF8+cnNdxqm5+qQwvIeGAwAAYNPIDV8lS0M/pT5O7/xfSiD5Jg0nAADO86E0ernYDo/6OIvhh6Tq6qDhAAAA2FQSe/9HsR3634NH3/lDcZVXaDgBAPDRqi6PFEMPqY+Ti3yCZgMAAGDTWesZlNTO31Ufx1maltGjX6fhTcx6+8lHbdoAAGYslUM0AQAM6ZVlmgAABnEHAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAAACAAAAAAAAQAAAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAABAAAAAAAAAAAgAAAAAAAEAAAAAAAAAACAAAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAACAFoAAAAAAAABAAAAAAAAIAAAAAAAAAAEAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAIAAAAAAABAAAAAAAAAAAgAAAAAAAAgAAAAAAAAAAQAAAAAAACAAAAAAAAAABAAAAAAAAAAAgAAAAAAAGDc/z8AZKi2E5CoEaAAAAAASUVORK5CYII=",se.ImageUtils={},se.ImageUtils.registerDefaultImage=function(e){null!=e.src?we.Logo.src=e.src:we.Logo.src=e},se.ImageUtils.registerAlarmImage=function(e){null!=e.src?we.AlarmBillboardImage.src=e.src:we.AlarmBillboardImage.src=e},we.ssaoNormalImage=new Image,we.ssaoNormalImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAhB0lEQVR42h2a53IjSZalXbuHhKDMUiNs9nnXbN9vpnu6qzKTJGQo1+570L/KLIsEIsLvPef7ANL/93/rxy2PO+5V6j+KPUr+lfJQl0XtVNIy26BTzUaThcVh0uRAlliahmyMmtvW7tsphNbnu2l2U3FHkSNpTCBX5bscl9ARkyQVLPBaryQNQs6Rval4v8nmkNbImRNKl5yYEXlKlfXS0BDPtb4o/ZnXLqtJ2ybteSFZXUp+E+UuMrsZ8paHzMUaiZLX250rW05Hqq7E6qpSrqYJPG9rVY1bbZZJWOM7M39c6Y5zv7IQKRuqO11oVjMr1dtbm/r/FtddyV9K8itZm9wFWrfFEpfL3ojjQn+ITLowfcbcNrf/DcVo3kbl65nwXRaS48aI87w9ZPtJnSAsZjdoWvOEB9auKdBrpiU51i3rB1PjTty3MvIY7qKqyG4600xVqSvlXRBTvvRiXMvAY66cRbYGelD4n/lJ8ESXy9T9h65/KcuKefH0RGvd4z1DKnUU9cZK8srFwnrbZ1mneBvkPtg848ok9TkPXOssNJlmujd03WJtk75LIeJ6k7J63gk+4TmUbgunRr7MPHPPiE6Z2UCMoLgKoSUrW2sOLjAz8/q+0dvKW87zhduh7EJKtIRWMsWHuZy7uqdVOrWSTHQ78PJFWJ8F0/zCaLOpeV/7leM2Vh2lk6I43/Nyb2W/cdV46wPnpYsvDAPZSBrSIqLLWol1wU+3dY27Q/pSXORKvUy3XKTu73TpdZNr4oF2wnO238TfRO1lDkmLvfBnsrVrs+qyj2zZkXaWtuT4ksz2OHpNyuzY+yVfWvrs6xaUSdU1tlbcuqK5SlrWjzAe6GlX9xNNLQ1rbCZaWrdG+pSt0yoGRXzVRkcdqNWe5pCzSYx3bomt8avsJM2WkThtxngaSeVDLdlY4vMzlyuRJXpCyVpUrLeGvaVyX9QfDRFr0ZKbaR/fVnajrIvpPNanQMk1hlFQJkiu4yy2LvEos8mMlXmoo+2iTWlI1MogC+sSNkxdo9tz7SjtoihkKbrTrmaRlGg3b3ckp4bcS6OEpcpgiSR+ve/YZhtO7yV38pmKz6fcOxIDl5nd29pVrq9l2dHKECiJztx1qXPKNxG3/DVW4b3HcPc3fiJEDs57sj/n1JZ8YOpUiuG44nWsbcisQaoQ19fnW72X2u2ZO9fR2Pmu8jNpZNGcFMqLnZkweALGhVlUlgRzMRmhU9zCnfZ0S6yrDpePEccq0MzCmtUgyhYmpbtrvQmkYp7n1HjBFXF70iCUTI20lEFol3JXw62aIfQzVmjU/mJXVg8i+ZNJpGhDPyhGWSAXsBnDv9bbRtlEYfeltTFVkk2zfs/q9xxOjB+Lniqe5pmKjgd+NNEpHn1si/aiSi6GOl3ZSJhmpm6FNOzqybEh2ZIl16GheAyJBaIUn9Ld1F9KOX/Xe11PQhIehNNpF7C9BnHpWVeEX3R8iuNWMgK6rKs1pV+Zpzo3RQhipW8XESwzMUrh3GzKaDGRPBc6h4A46qrZrHim80doj5ReGtx1UEE2VeRELnwZFgyAiSLQFFKoZ/pHX/5Jpcyeclasf9I4WDKxIJDIKmPoqcvBpNip/UbuzPB9Xgttuy1fZLSZ6iobv91lt98cCsGTZs0Rx90hQLA+S2zG8vOavu3pxSnmOK2UfsvYtXuRpsvywqlkiyJDqy4RA12lZvfsVaeZzamn0ti6oakoSf32Mu9uLenTmsqgCylNtul7oMNSt1bsmciZTraivAyGztD4PWE9mhYdgMxg+zHdL2FQlXETTpUqEn8hT5le0ShHok9q6wg3JVGWqH4NQuQSBafnH+z5EOc0DOHmexMpJR/MjyhInJ5YR3qq27do7reweyaE4Ce54DE6c9Rp4TVuRFTSLtG3XP2U5SXGWyGtdGgemfaa3CMJHS5AfPg4vFW1SnIt9C2RT8XekPvV8dxm2nH6/R/85Rc/1XGYzvnYqijMqcydTCE8Z4Jb2YIfkPvO5j2ZlBSyshoz/V2mSfR2u7dtXmtDUzmEuDWNirj6fGFH3Zykefk3ejvj8UeSCgtKGbJQJQPj1sg+rAMeawrHSq6aHnF7RTE6Vnaq6DWyZjaJ+tKq7btzbfztWP9cRPtGYsShiG5KVnPpsvovVS+0CX5tO3KnlHk/1t4rbfIJrX1TR8MTfvBI5aXK1otAKmuZ+PLR1NJgMmsr46TQN7TlsQYaQ6yjkjff6LRdMXFCBVGTrEMqjoEZJOhAh1k2MiXULgbaHZzauHWkU/lnEzoqxVITBjsFlwlrCyvdT+WRbORGZVbi2TmbqOdhx/h3V3rGeEGOHZpoBSsZUe59og3W4kjryS1tGiemOp4dE1qQr3MZR5Zzlniyia5K77c8c+a7olD6mW6XzPfGLRzXpi6EGUmec/8lAVRxJoVFwMZuqrOgQ2Xz4OhiMk3diwRijUt1W26PqO56zeIoq0XxktJeJPDFaEaaKf+j5z3nfVl/SPrGiKd4SY0pJ7q6WCWJR6XuhLRk+6zyxQxX6mQql9K+tkIw1rcedx8LpikrmpwvYWB5YeqzxpHQmF5b9rd7fR4BVlTu3VcVB2dW4xklfCiR6MMd8xMCYynl6GWfY1VoMoQ3S46w32hKZFgpjuge8WxjL+IXTy9F20zKR6+/MTGFa2THd2fvBBMCdMqhEuznSMO98rWkHXVzejfiH5f8uqdkpuzg77wI56mImpjKXeWV+51QpNabGwcZKcl3RnqBFTyYbZmHrg120QMgpHpqKGKe8Kgnd8Vv3dHoADR57OO9FQikLkVJWKZgtYKzJa0LzaNN5djltDWg3FDQ092h3LfYdThIxSYCtom3CEzWB14KrTern4AhpFhWdxjdLDmZ7qptCvCkJiqahO2ldOH8gMIQ86fnIzUHYlNNZ77v07QCjZI66Ja6ZePj3nnLWDCc1Nig9KV84tlnHOOpELpzt4n3HQlmCxcEqNdKSZZ1BQQQlEshhs/LxpDUlWpC1oBarJGZ3lx9ypTmqdDntF/YXz/D846EPdiRppnVpnYL+QK17CVaLzrUUWh1KzZA4ZwoxnrRCIfxIG4htje8ARGvOW6SN+ugm8+tNKWiisJNDTqcOypsamdxquUbKMnEbdNG1M0JoaARjp9M2OW21eCM/aLzIZeToV1gMbGh8bkMK6YreE2ajQx7Ot9c07UA4xR1czM3k/YHZj2AUnKV1xfWO+aF3Rn1ZWnralWZbxwjIpSM0WQflSphPtP9b7n/YRzq81DlwmdwpWCLTSN6tAHgh6lP/IO1r1s1yGap1XrZ6mDrXaS24c1MQ+PSyMQuDxu/N5v5Z0P7BNRH1GB8HrsR4hPJJyWOlTWFb0jqST+1dMPNEdooevP+6S7iW2UTtzgnRbqFkc1FVqdAZcE8qy8Sqi7Son+uEpyrmHINf2Ph6595HOtVwHgQoan7VemFWTzTVEDjhpXemeU/wmHiCV6kmIyMHBSxHNHNbBJje8ri1w+xdg+qef9L358TkCXbKm+ZiEIbKmj9snIYsIil7pJy0vaJwO82jEMdoxY43jXfPsPQNUwUP5VRl/Nr8y2lS4QrSqAkCtgwc3tnwpnSIl2qB49P8IgdnJbqrSJhFLLwWj1LZtb00frAJVHQMre8xpqZ3sWcRFkuybSUzxIxtkLfsGjPUALMBl4Ng8eBfwoB9UYbV26pNETrYcV1T4eqz6yTs0jQyZVxvWPkQ9lDLBedevWvt16x53XxfMfjpRK+ymKkJJg9EWc2TFmMxZ8c7oo/3dza9AQtM7NYCdl7ZLS6c5qJbSuTPnNNcqBPiVwl6WinRLLb2ulxZjcSecfQa3jtAiByGTVagthgPYnJsSBWko3UqydN5lq1K1uR7Z1vwjVDr+Dysa1ivS8Mctd5iINeZW2wJ7xMPR5IovceUUNa03BvJZzKtmNsgxERw60V3nLpekLL/hp/dPKdxemTqZZwaeeWdKR+nMTvfIMRBjjNnhOEvrdBtPTPnHZVWoREhkvqDBSsAxEpIFJZq8B4Xn5pALzFlDdI00furU6N3bZS3Ut2yqGPKqagubZdaVf6s1E7POzZXTv9VHN74Unm3G2cCyXq14W/4sF5oncpmArj4NQT0nEC/aZy5vI5MafEcBTXJRyTllitRPbjCkNb2mkgHbQmY5d4QE6z/5PZatDgxKod0LOk7178ZtgHzF42DjpZTR7YNkbxExQIwwNRU/rE3aa4qXmriglQAAfGU8YXUkaEDPWFJKOfnbr3Xu8pRSrODXpndeW98650pFszwplJsdEqmkpRGUe2D+HvW2xRlgTiUZ+asqaEx2uKXFcxN+5FdrfzmoeGAxBSYo0Y/ynPQ2k3w5t8g/7sxX8Wfq4h4mEpqAc6qEgXw4nHdyHXEGHwOpYNJ+Zva9M95fZngguXh/SJ3KMLiN5XnfIN3czjfq6XqvY7cHEk3O8Tv0EgmrgXZtuchoFwSTWAbdH8FL7E8Fzsuq8mpGZVN0gcQ3q09q2UhT9d80V43nUgeranPIGx5KS23lfbc3Oh0MXdrc4EoYaGIooWkG4FAqBxn7kA7HdBeFl8pozoRuM2wv9w+l4fLPAly4AKSHaW+Z5LbQxj1mCjwnERd2AcxMJp+8riVv64lh8Uqt4OpIibi+/Y9JiV0UItPyh/skxYfhkzr9RUsqT0eimBs6+jHyYIVSI83YGlnPUsPx49smjN4oWnTtYpaV8DfEMxLDwfS1gpaSkcmSu6LXgTWw1XiXxfyDgG1vDPWp9ZZR2BqqYbZZlwIWi3nKN+rWW5qnwoQJJ9YaeUDlMiRP2JgYxkSDnBuP8g+Tvtnsd0zuSwgax1sp59G/TsOX5Yu9ry1XPFcRHjuYnHlK2TzZHQlViRVJalq7LWsFT9yfNOWZoUafSYvSSwftPjNIDMPE9ZdmypHE8BMrY31Z8rM6ZLa70p2+CtA9qxM3kmIFS9k3K9BfVbS4FGqVg8g5FuKxaav6ThhDXJ1fKH4Gnkh9XCWKxmbVWen/LhZC8tMomUpAmmqPI5p0OTapvLxtRWHcpl5GUNdxrbla0Llc+F6A2BPfR08zFXyr8wKCLcMx+iISL7OivEFmiMLug0SsihFuuaBAnm39p4usMbgLGyiTiMUhhvfivutEI0NKH3JFWhI6k/awiGCu1dlDoxsUh6AB7NyJHc9gTzmU4ksyis5CLhv6HSIJJuuFvI/v6gYzZyReh2LZzLAY17Y/1rXm8CboxomRbfMzrdw04CLVBGIPPmhi34zddbvImmB9nxQGxk0QhMjmSNqp8/VHcMWciyEobdeRbG1c9z/QYk9ewm486LhZObrr2Um0/syjjj6omJXtDzLZhYdadWy/KQhqCs3pBqVDBfcw9chDpfLOJqIWa/91vAFnPWRGP45zntWhnOtN+xJSS0Gc/1nNPY8JU5ODhpCO7rjXf/xEY05GXNM4MnyiYz/Nguyc6U71N8f0PZNcLbOVM8n3apfw75aZNLs44blZgUBJPlBip0R9PQzCXvUohJ+EiY0oHHoST81O1UB0nu89D0KVqCJVMmLU6YA/xFNMQFdERIipOTNe2c+kFrwedv2V6IkpRXcoLzPOo2jlbFHrRs3pT+4GH8S6IZv1T9JaUPZFufjx7uBYDNo2nv1GE8OVWdigET4NXuA7+ay/3odkEsxRu926cH8+7SxMRIbAi0z6BGZz8c+b2tP0V9krkNBel76MTmhRjCZmtXxcC3i1VH4q2tTHmCTLyk9oncM6ZwKksTChcxDsR8EHdoKVziGHAcail89PlHpq8rnZ7Kzxz+zcqTJL8T9/evmjp+I+QXyZYSuglBiJhuv9VwHmqDl7O5MYVq6xJpDwnC6jAzYiaxqdFW/CPg+9ciTs/NYVodVoEKyfxW5cDoDb9MabiavXa4k6TUsVJHK3pKbnW9gHkUhawwQei4qdLeotqJuYZnpudzpapa2eG0eigOZ5LQ7538NScP9BsgkebThF90PUuxW+t3y15Qdz3aNI85+NCYewFaIqZhBxmqGISdWWOwkPzKmy6UPXq5o/vAyRVT4fJspVdxlGGFw+IIZmh0NSK5nXITRd4iMT3FtLEIIzSUrLCmoZYWvL1LKfYEmw3Ae/LU0tK85LqWbeODMqwJV527ewScLC0Ha+BOO5aWq5yE4zaxth44p5pZTK3pXaqOuvce5qVNk6mvZM2q5Vtfy0xXIOojOP2ydebgA1gzzkJs6NMywL5njHZuzmXpAeR0CcTIQBpZfZAC1CFcD54vcsq56ZgGwIC++4kZeU+5Z4fZ2UbUO1GmnoXSu2Bk+ZH401e+Gt0PWdCySPP4ZgH9nPII8aKBWjHzKG/ixTQfpQxY+I7ax0e2Od+Qy1TsJPAD7TZr8u7omZKG9fmp6Cgf29trsbZZrdFemBK8RuKfEoYUj5lONXHW7nDgoNAau/x6LydX+hY1XTcbW4uwsr1gxFCHhUcspNjsql1NBzYJ+baJB6L2tYc9ZZk2NqRwfykNcJpBDJSgQLhEIFYlWDwlFaiu6cQxAG0pn0/p9avZaJIXElAgXbYd9KZanRo8MliL4gHxNFr5ycSgozV6jvn4N1meOV6WPgEIS/CCTRQyac7JjSA7ZhvOVq6kB/7SMoBVAJllZpspv0f2SZgeLN243AlWmI9JZ/xYIZyFt4RyHiKdHH/qAhxkqqBTOUB2pRAycieBKbrB9pvTFIf/0dsLZUHUt6yC34rGkmlB3ezVgdSJu4Ht8ZuPD1TuKe1YnOPAi/q1g0pXUxgDbjZsiCsnA64RuhKbYcxiLj6lRMyB++/Z7cYyXQob607QuyM9ZGYhCVgEm5miGDMoMD/pEMjhziLDMdR2DOezQHP3vrS9+TjHF8jkS0ZbX6N7H+l8jqoFjOsUkWT1s/oxtXLwjy8fUNSSmNzMfdRrRr6ItFF+aOO58L5wn+8hDqJ6QHvcabO4S6ubaNdEd49v+2aL58nogIXAuJlBuNsXGRq8caWr8cU91kVVxliZiuglWQI/sHCqY1fPG33eRTze6Hw3VOSUY5TO9oAne3D0R0u7wHdt+GL6ENJCg8wVw7nVp7VfYeiXfTQbs5EcBKJAAr8qIzsi2N7l7whP1qS80A6VjK1u2mVdEEl8YPEUeDfWCp5tE+6WHGi/+rXKNZVeNFfE0IrYxoJusNGesBMprS0g0EHGHy1vL6Td4ZqVeYXHJSiiigUQAmAVJUaiiuJ84vSbpyH0P+qGqFhzJ01E+IGo+oUuba1Kkw1SWwfaIqk6zBvNO2q2AsnQTNmqyVokR0nBUjJbbv1xhzZg2P+RyRQ2mvOVqaGl4UddhoahvhugMmltxn2IimElogt3aEBlpUVCJvZZ+7GmXzO90TxQg8UmnKYgcAtQQEauz8Dj5koSfuo+iSfSPSaPUKKlJcA51jCezh1/kfQey+PohSg2uBKkPDbs8knoqxE3XpAONQqatkeXk7qYeHBw4SRFwi5Mce6AwbG+m/xRFDtmsz0+cAVk8Z66jBetIm8gT4X4L9XL2lsy0kqOJm5RXWr0ghf4qqAKLSaiysctf2dy96mAXazFe1Gj/6V4Q2EW74gGpF6QRdNfZg4g5T2B/UA8afdwx1dRPopUBwBQElzQaFmBzyAsnKivjHyy8OLIVkswy0ifmf28Atvy6SoHs7lG5IenEe0NxNoAUxINpSk92RI7SPrnjcL0kIglRGUEi9U+pTaL6GHPTD0XMNkH5L0l7CxmRY+34loSnICUrlvtaKOCRSyFlosTId9cmGncOD3CuZfLZdQqLqsQ3BdAdWEC6wIvTsqiKfcm+p8YCck/oCaYu+Rzxf1jDxdS4a9LoHlOus1Nya4IrbevOe1EbGgjS5lCdVt62fENzqAiUCDUJExqSTPb0GBcxxKv6LHSEKUv25WrDjKgQ0/UnSJZCHBiE74eSGOjPyP2pP0uGAK9Eh28jShCXyAyfUbQwy2bpyD2Q/3BgBkG/G0rett0JYd9wboPqoSLOeziVahXES8rLxqbDXyHDMS6r9nm/c74UAedLncxdijsMiPWDImI0Ao2kXxVlSasjMIpWDGxDG3gYpmZbg1xiC/Gc0hmFG0qf/f1D8FPaBUSnWiHHNhTPnv6ruuPi/5tDF+aPyt6nqXUvsVEgq/RELGygdWC5bLM97B1UqFEvCEL2b0Et8AyYngggDsE5SikhJinx/QzEjtSgwzWFrmjeSm5U9gO9KtM+v7Aa08e3zPJoXoY2WRsk9RS03OlNHL+r69WycJ5iDAcNGNHyjWRHiuFEdyRmpl14SDMdcqvjyuRsKN6q9gOedWhxQHjqvdi95MivEAptmdqzrlQdaRxovEo9JSZpDlSBgOoGdEQBH/8YxJM0aKaLQcd24y72zLdk/4rfPAyEp2lhfCsmRmVJwKpqrso3m7yS1FKkn08uuotqfCvJvIGqQUYBtnyWxMXL8c++1sMlPM9qxMGgOZzJQ0smDr16F7EGrgs+SLOl3rQUdyRUqUi5mtKe6FOFDKg1wrtHmwyxxg/jXihYYV6pw1DjSGc5kX1vwCwJBS3O8p0dVUaRA1SIR8DucB6AU4b4jA3nsKv51YaTEXDiheBpbo95htBt5J0KHxdUYbJrFKRuM5M8MhHqj/Ztg9izlPlu5WqvRdnHY91CXngQMoqRvO4oqb3m5HOinat9CtzpfjM8GQHg2Os5W7Ur7L9pJcBt4rh0mgd+p99/zNddNWxEQ29T3oQZT6w/h7IYB5wFLnfMrye4PUq3AvVmoJmqLOjYEs24rdAPyS2O0dp28irVpmNOv0cGF8F20r5GV2n2/nxARHrkTl5W018l92F3Q2sOrmDFDDHk9ia1WBGO9Bbz3QAqsN7sj5nn0vTlVny/s88dfW4wXPRfSSMhVwCB1tBTsGJc963/AvzuJSi6OzcvhLfOlzuE1k321sjWlAfdg+De22Q8njlbuVURBfFjroliIY7AolyZsS1ARRwUEp77lnL2bWOK55z1fXxBfas8j7CucX+RsRUZRvaqY37xGxbgdS3vnldCz0Vv+OPz9OvdSAsvAd+V0SkyGJ5rm1SaY0BpQ1hspQJXJ3AKDlYHaEteXwml+0Dgb3W6ZAGn9c3Rp2Jf8EP0fptL7DWqaiul9FaKh3qQT8xcW4Sz5Qw4Fv5gtWuHJG0DTUpg/0klJZnr2fIzgrgu3RRCO23lWJUrhlVGTBW+y9vn1hWRC+PT28Fq3Oi3f3xWUi2NPGKvcITY0+cXoowJcwiHIH+xYDwofXLFpQChEgXpqEe0Af36o+qvYcl3eWOPYgvOQBD5LTJTjHugX870m3+QmQrCKh2bMmMIJw8fWPZEr4B/h/fQgep9L1W4awVOuZWEuGpVsM2TWy3g4Q0cYq7Xn2fYkelGtI2STrgdJk/Sa34NpQdLemrhp1mf8X6DUAT2Vsdf5CyY+ulyjFqJgFssBM4kFnF4wOYX+J8qTtaG9oi4zi8WmQcbbOySdD9VKDaJCbXmzbErzv54xjPttmnfOm0uwQltex8PSv+muEp4wXV8vj7lX0R+SaglHa2da8FEjtN2bRsCls/8sdnKhZcuuIZEYczBgoKafMs6OEFJ5zNQLYJ8UPheWmvtC14Ayg/TXVSy8GKBy4XXFd0ofx7Zf+7k3rdKDWFzuOGpVR3vrVc+iEoUL2r3COx5KsCucGZ8mqkBh8PIq6JbZwfbZ64qd7pwlnF262CDggo2WuQ9OOzzX+I9/d6ARxpVb4kbSuRYCRdZW0tpE4/TH4gYQLopl7wGeiK7IaxUDaSWDTJniH8bGOP0SBwsDKvtNyPTb/lPzkbLtntuxF2eTfbsYo5GWl4pKmUDaeheUWxNeKIAvhvOfyRYGAUuHUWpaVPOl7co3nGTU6GkYx+YXFrBBPCw0ZDcisZX/0i++G+rJ1kvySMaxEJJz4Uub7UeV1faDv/iM0zxhypDI9EX4te0WmsFjxeeIv+B5Lf0TI1OYIYfXwIZ8uD/XAWgh3W+lFS8171JggMWj7+jC1Q1gc6i0epjzf6sbDxv5z1ff85TU9qfC5zoKg7kvIgKXnP4bYOvI8np1/JjDt4/AXbpa7wIkqbzU2qoY4za5td8B9NM9ibkvyvDotxW8X+d7KCZlpLJ8Q7hFbc5iQGIkuDNTk3cueCHUmJVL2UxT6WTHoGxsUAxi5Ogb8qtZ3srPNvhpyKcJlSxRZIXgFOw9ITf2vElg3gvmvogmR1KD+Bi+jjRejuH92wg5HJ8gdglvHXIILl5ZU1qw2PPyRjCmDEVkeRYfTQ5SmyZovzvo7Jyp1xuFyU3EksPaKAYDfqq9Y/ocZ4GQ2n23rWftHZeLw6zqip9QZHeUhSmrx6495BHNqqvPpUWaVEaYWqtEN8fIdviX8V4gsV9zh8BFUvfQIBTqJpC6Ko+yj51WobTjvyfEfMcf7BRBl9uBSlhITubbhfcIbpU1oGsbYJY5CY7OeUdVszsYpqV8qzfHyrZ/kdD/iEi64isn2gt8TaG9u+beLSZp17QqesO0BuxpUS2tCvJF9Ri1kqnIkjUxWqlapc858D+EkcQ/1S8SCbpeI5Bhjtoh8MOdKsifKs/CHLKcdeHzJyggwu5m9H0S3axoumfCqYlYj3W5rkGl63yM88dAVr0mv6T5ch0+hgJfyXl7tRurMlUUhRNqV2Ls40OMnGMeRH4IYCzcHPtjliSMDzXd19VKofhq0z7Cl8T+RXgZEpaxjNjjfeXS9yJ7yaSWCqgJXAbZrqjrkp1Z807wvC/5sWf3fljTKyldxHP2exqTKGzjZFAsWCvvdEUyqTVfsu7jw9M6/FPZEdNN92YyqLNuMWEXX+HeAkfRuHyZ6Vgh22Jqw/TP8S1iiLlmOOBQkrhZWgEpKOjysyCXnWeuqOhCG4w8Z3Y73HVXSwaqq5XsGCIRPfiA7qzxEvct/Rp1g+Re1ZBfWTuCSwPorGEOSgDtTXwu88NZtskMdM6igFXWZogdBPhX2VgF6F8QxhGR+PKh8IUtp8EZhnXiQfHp8hdYO7WNq82S2BeMD7LmTMQ8UYo3aQNx7qpx3QSdlti6LuMmdEPGUoHmEcGBsqFhkrQYTxcIF/OLrvAquMLiU8/t64tqfySR9/eBiGFCvnNUnTCL7Dy3TmjlfrIi/PPV0vRSPSjARvtREUZHvR3JEMc6yaw1b3W7xAwl/j8dRdVBxXCfLMXj3Tik7QhTx+NUAPEdzcjfW48HrIyFl1j0BK+aRorTuU4TkuMh0EM3sRzvHYGvVimxuUcDjv6jue9imzI28CO2tmaAUFja06T7WDDzbwFCEo//9wY9hCWlkh5gAAAABJRU5ErkJggg==",we.ssaoNormalImage.loaded=!0,se.EventDispatcher=function(){this.listeners={}},se.extend(se.EventDispatcher,null,{constructor:se.EventDispatcher,addEventListener:function(e,i){this.listeners[e]===t&&(this.listeners[e]=[]),-1===this.listeners[e].indexOf(i)&&this.listeners[e].push(i)},removeEventListener:function(e,t){var i=this.listeners[e].indexOf(t);-1!==i&&this.listeners[e].splice(i,1)},dispatchEvent:function(e){var i=this.listenters[e.type];if(i!=t){e.target=this;for(var r=0;r<i.length;r++)i[r].call(this,e)}},contains:function(e,t){if(this._ls)for(var i,r=0,a=this._ls.size();r<a;r++)if(i=this._ls.get(r),e===i.l&&t===i.s)return!0;return!1},add:function(e,t,i){if(null!=e){var r={l:e,s:t,a:i};this._ls||(this._ls=new _e),this._f?(this._addPendings||(this._addPendings=new _e),this._addPendings.add(r)):r.a?this._ls.add(r,0):this._ls.add(r)}else console.error("TGL.EventDispatcher#add:listener is null")},remove:function(e,t){this._ls&&(this._f?(this._removePendings||(this._removePendings=new _e),this._removePendings.add({l:e,s:t})):this._remove(e,t))},_remove:function(e,t){for(var i,r=0,a=this._ls.size();r<a;r++)if((i=this._ls.get(r)).l===e&&i.s===t)return void this._ls.removeAt(r)},fire:function(e){if(this._ls){var t,i,r=this._ls.size();for(this._f=!0,t=0;t<r;t++)(i=this._ls.get(t)).s?i.l.call(i.s,e):i.l(e);if(this._f=!1,this._removePendings){for(r=this._removePendings.size(),t=0;t<r;t++)i=this._removePendings.get(t),this._remove(i.l,i.s);delete this._removePendings}if(this._addPendings){for(r=this._addPendings.size(),t=0;t<r;t++)(i=this._addPendings.get(t)).a?this._ls.add(i,0):this._ls.add(i);delete this._addPendings}}}}),se.PropertyChangeDispatcher=function(){this._dispatcher=new se.EventDispatcher},se.extend(se.PropertyChangeDispatcher,Object,{addPropertyChangeListener:function(e,t,i){this._dispatcher.add(e,t,i)},removePropertyChangeListener:function(e,t){this._dispatcher.remove(e,t)},firePropertyChange:function(e,t,i){if(t==i)return!1;var r={property:e,oldValue:t,newValue:i,source:this};return this._dispatcher.fire(r),this.onPropertyChanged(r),!0},onPropertyChanged:function(e){}}),se.Texture=function(e,i,r,a,n,o,s,l,h){se.PropertyChangeDispatcher.call(this),this.id=se.TextureIdCount++,this.name="",null!=e&&this.setImage(e),this.mipmaps=[],this.mapping=i!==t?i:new se.UVMapping,this.wrapS=r!==t?r:se.RepeatWrapping,this.wrapT=a!==t?a:se.RepeatWrapping,this.magFilter=n!==t?n:se.LinearFilter,this.minFilter=o!==t?o:se.LinearMipMapLinearFilter,this.anisotropy=h!==t?h:1,this.format=s!==t?s:se.RGBAFormat,this.type=l!==t?l:se.UnsignedByteType,this.repeatX=1,this.repeatY=1,this.offsetX=0,this.offsetY=0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},se.extend(se.Texture,se.PropertyChangeDispatcher,{getUniqueCode:function(){if(fe.isImage(this._image)||"string"==typeof this._image||Ee.isArray(this._image))return this._imageSrc+" "+this.format+" "+this.type+"  "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy;if(fe.isCanvas(this._image)){var e=this._image;return e.__uniqueCode||(e.__uniqueCode=se.id("texture")),e.__uniqueCode+" "+this.format+" "+this.type+" "+this.wrapS+" "+this.wrapT+" "+this.magFilter+" "+this.minFilter+" "+this.flipY+" "+this.flipX+this.anisotropy}},resetValue:function(){this.name="",this._image=null,this.mipmaps=[],this.mapping=new se.UVMapping,this.wrapS=se.RepeatWrapping,this.wrapT=se.RepeatWrapping,this.magFilter=se.LinearFilter,this.minFilter=se.LinearMipMapLinearFilter,this.anisotropy=1,this.format=se.RGBAFormat,this.type=se.UnsignedByteType,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!1,this.flipX=!1,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},clone:function(e,i){return e===t&&(e=new se.Texture),null==i||i?e.setImage(this._image):e._image=this._image,e._imageSrc=this._imageSrc,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.flipX=this.flipX,e.unpackAlignment=this.unpackAlignment,e},onloadTexture:function(){},setImageSrc:function(e){if("string"==typeof e)this._imageSrc=e;else if(Ee.isArray(e)){for(var t="",i=0;i<e.length;i++)"string"==typeof e[i]?t+=e:t+=e[i].src;this._imageSrc=t}else this._imageSrc=e.src},loadAllImages:function(e,t){for(var i=e.length,r=0,a=this,n=0;n<i;n++)!function(n){n.onload=function(){n.loaded=!0,n.onload=null,++r==i&&(a.onloadTexture(),a.firePropertyChange("image",t,a._image),e.loaded=!0)}}(e[n])},setImage:function(e){o=this._image;if(Ee.isArray(e)){for(var t,i="",r=[],a=0;a<e.length;a++)"string"==typeof e[a]?(i+=e,t=new Image,e[a].startsWith("data:image")||(t.crossOrigin="use-credentials"),t.src=e[a],r.push(t)):(i+=e[a].src,r.push(e[a]));this._imageSrc=i,this.loadAllImages(r,o),this._image=r}else if("string"==typeof e){if(this._image&&this._image.src===e)return;this._imageSrc=e;var n=new Image;e.startsWith("data:image")||(n.crossOrigin="use-credentials"),n.src=e,(s=this)._image=n,n.onload=function(e){n.loaded=!0,n.onload=null,s.onloadTexture(),s.firePropertyChange("image",o,n)}}else{if(this._image===e)return;this._imageSrc=e.src;var o=this._image;if(fe.isCanvas(e)&&(e.loaded=!0),e&&!e.loaded){var s=this;s._image=e;var l=e.onload;e.onload=function(t){l&&l.call(null,t),e.loaded=!0,e.onload=null,s.onloadTexture(),s.firePropertyChange("image",o,e)}}else this._image=e,this.firePropertyChange("image",o,e)}},getImage:function(){return this._image},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),se.TextureIdCount=0,se.PixelsTexture=function(e,t,i,r,a,n,o,s,l,h,c){se.Texture.call(this,null,n,o,s,l,h,r,a,c),this.image={data:e,width:t,height:i}},se.PixelsTexture.prototype=Object.create(se.Texture.prototype),se.PixelsTexture.prototype.clone=function(){var e=new se.PixelsTexture;return se.Texture.prototype.clone.call(this,e),e},se.CompressedTexture=function(e,t,i,r,a,n,o,s,l,h,c){se.Texture.call(this,null,n,o,s,l,h,r,a,c),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=!1},se.CompressedTexture.prototype=Object.create(se.Texture.prototype),se.CompressedTexture.prototype.clone=function(){var e=new se.CompressedTexture;return se.Texture.prototype.clone.call(this,e),e};var be={pools:{},useTimes:{},size:0,setTexture:function(e,t){be.size++,be.pools[e]=t},getTexture:function(e){return be.pools[e]},useTexture:function(e){if(e){var t=e.id,i=be.useTimes[t]||0;i++,be.useTimes[t]=i}},unUseTexture:function(e){if(e){var t=e.id,i=be.useTimes[t]||0;if(i--,be.useTimes[t]=i,i<=0){var r=e.getUniqueCode();delete be.pools[r],be.size--,e.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};se.TexturePool=be,se.TexturePool.TestTexture=new se.Texture,se.SerializationSettings=function(){var e=se.SerializationSettings;this.isDataBoxSerializable=e.isDataBoxSerializable,this.isStyleSerializable=e.isStyleSerializable,this.isClientSerializable=e.isClientSerializable,this.encodeURI=e.encodeURI,this._pm=se.clone(e._pm),this._sm=se.clone(e._sm),this._cm=se.clone(e._cm)},function(){var e=se.SerializationSettings;e.isDataBoxSerializable=!0,e.isStyleSerializable=!0,e.isClientSerializable=!0,e.encodeURI=!0,e._pm={},e._sm={},e._cm={},e.setPropertyType=function(t,i){e._pm[t]=i},e.getPropertyType=function(t){return e._pm[t]},e.setStyleType=function(t,i){e._sm[t]=i},e.getStyleType=function(t){return e._sm[t]},e.setClientType=function(t,i){e._cm[t]=i},e.getClientType=function(t){return e._cm[t]}}(),se.extend(se.SerializationSettings,Object,{setPropertyType:function(e,t){this._pm[e]=t},getPropertyType:function(e){return this._pm[e]},setStyleType:function(e,t){this._sm[e]=t},getStyleType:function(e){return this._sm[e]},setClientType:function(e,t){this._cm[e]=t},getClientType:function(e){return this._cm[e]}}),se.Styles={_m:{},setStyle:function(e,t){return null==t?delete se.Styles._m[e]:se.Styles._m[e]=t,se.Styles},getStyle:function(e){return se.Styles._m[e]}},se.Styles.MaterailType="S:m.type",se.Styles.NormalType="S:m.normalType",se.Styles.PREFIX_STYLE="S:",function(){var e=function(e,t){se.SerializationSettings.setPropertyType(e,t)};e("combos","data.list"),e("name","cdata"),e("toolTip","cdata"),e("parent","data"),e("fromNode","data"),e("toNode","data"),e("alarmState","alarmstate"),e("vertices","list.vec3"),e("faces","serializeabe.list"),e("uvs","list.vec2"),e("position","vec3"),e("rotation","vec3"),e("scale","vec3"),e("location","point"),e("materialSize","number"),e("color","color"),e("ambient","color"),e("diffuse","color"),e("specular","color"),e("intensity","number"),e("distance","number"),e("type","number"),e("startClosed","boolean"),e("endClosed","boolean"),e("curveSegments","number"),e("amount","number"),e("vertical","boolean"),e("repeat","number"),e("centralized","boolean"),e("visible","boolean"),(e=function(e,t,i){null==i&&(i=null!=t?t instanceof se.Vec2?"vec2":t instanceof se.Vec3?"vec3":typeof t:"string"),se.Styles.setStyle(e,t),se.SerializationSettings.setStyleType(e,i)})("select.style","border"),e("select.width",1),e("select.color",65280),e("select.offset",0),e("outer.width",1),e("outer.offset",0),e("outer.color",null,"color"),e("m.type","basic"),e("m.color",16777215,"color"),e("m.side","front"),e("m.alphaTest",0),e("m.polygonOffset",!1),e("m.polygonOffsetFactor",0),e("m.polygonOffsetUnits",0),e("m.wireframe",!1),e("m.wireframeLinewidth",1),e("m.wireframeLinecolor",16777215,"color"),e("m.wireframeLineopacity",1),e("m.gradient",{}),e("m.gradientType",1),e("m.transparent",!1),e("m.opacity",1),e("m.visible",!0),e("m.depthTest",!0),e("m.depthMask",!0),e("m.alignment",new se.Vec2(0,0)),e("m.linewidth",1),e("m.texture.image",null),e("m.texture.offset",new se.Vec2(0,0)),e("m.texture.repeat",new se.Vec2(1,1)),e("m.texture.wrapS",se.RepeatWrapping),e("m.texture.wrapT",se.RepeatWrapping),e("m.texture.flipX",!1),e("m.texture.flipY",!1),e("m.normalmap.image",null),e("m.envmap.image",null),e("m.specularmap.image",null),e("right.m.type","basic"),e("left.m.type","basic"),e("top.m.type","basic"),e("bottom.m.type","basic"),e("front.m.type","basic"),e("back.m.type","basic"),e("side.m.type","basic"),e("alarm.billboard.scale",null),e("alarm.billboard.position","top"),e("alarm.billboard.vertical",!1),e("annotation.class","tgl_annotation")}(),se.extend(se.Styles,Object,{}),se.BoundingBox=function(e,i){this.min=e!==t?e:new he(1/0,1/0,1/0),this.max=i!==t?i:new he(-1/0,-1/0,-1/0)},se.BoundingBox.prototype={constructor:se.BoundingBox,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)(t=e[i]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(e,t){var i=se.BoundingBox.__v1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=0,this.max.x=this.max.y=this.max.z=0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new he).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new he).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e){return new he((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){t||new he;return(new he).copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return se.BoundingBox.__v1.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){var t=e||new se.Sphere;return t.center=this.center(),t.radius=.5*this.size(se.BoundingBox.__v0).length(),t},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},transform:function(e){var t=[se.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),se.BoundingBox.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),se.BoundingBox.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),se.BoundingBox.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),se.BoundingBox.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),se.BoundingBox.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),se.BoundingBox.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),se.BoundingBox.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),se.BoundingBox.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(e)];return this.makeEmpty(),this.setFromPoints(t),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new se.BoundingBox).copy(this)}},se.BoundingBox.__v0=new he,se.BoundingBox.__v1=new he,se.BoundingBox.__v2=new he,se.BoundingBox.__v3=new he,se.BoundingBox.__v4=new he,se.BoundingBox.__v5=new he,se.BoundingBox.__v6=new he,se.BoundingBox.__v7=new he,se.BoundingSphere=function(e,i){this.center=e!==t?e:new he,this.radius=i!==t?i:0},se.BoundingSphere.prototype={constructor:se.BoundingSphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,r=0,a=t.length;r<a;r++){var n=e.distanceToSquared(t[r]);i=Math.max(i,n)}return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsBoundingSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new he;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new se.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},transform:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new se.BoundingSphere).copy(this)}},se.Primitive=function(e,t){e=e||{},this.data=e,this.vertices=e.vertices,this.faces=e.faces,this.uvs=e.uvs,this.uv2s=e.uv2s,this.colors=e.colors||[],this.uniqueCode=t},se.extend(se.Primitive,Object,{clone:function(e){if(e){var t,i={};for(i.vertices=[],t=0;t<this.vertices.length;t++)i.vertices.push(this.vertices[t].clone());for(i.faces=[],t=0;t<this.faces.length;t++)i.faces.push(this.faces[t].clone());for(i.uvs=[],t=0;t<this.uvs.length;t++){for(var r=this.uvs[t],a=[],n=0;n<r.length;n++)a.push(r[n].clone);i.uvs.push(a)}for(i.uv2s=[],t=0;t<this.uv2s.length;t++)i.uv2s.push(this.uv2s[t].clone());return new se.Primitive(i)}return new se.Primitvie(this.data)}}),se.PrimitiveCache={_cache:{},_useCount:{},getPrimitive:function(e){return e?se.PrimitiveCache._cache[e]:null},setPrimitive:function(e,t){e&&(se.PrimitiveCache._cache[e]=t)},usePrimitive:function(e){var t=se.PrimitiveCache._useCount[e]||0;t++,se.PrimitiveCache._useCount[e]=t},unUsePrimitive:function(e){var t=se.PrimitiveCache._useCount[e]||0;--t<=0&&delete se.PrimitiveCache._useCount[e]}},se.PrimitiveGroupCache={},se.Color=function(e){return e!==t&&this.set(e),this},se.extend(se.Color,Object,{r:1,g:1,b:1,getUniqueCode:function(){return""+this.r+this.g+this.b},set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e)}},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){var r,a,n,o,s;return 0===i?this.r=this.g=this.b=0:(n=i*(1-t),o=i*(1-t*(a=6*e-(r=Math.floor(6*e)))),s=i*(1-t*(1-a)),0===r?(this.r=i,this.g=s,this.b=n):1===r?(this.r=o,this.g=i,this.b=n):2===r?(this.r=n,this.g=i,this.b=s):3===r?(this.r=n,this.g=o,this.b=i):4===r?(this.r=s,this.g=n,this.b=i):5===r&&(this.r=i,this.g=n,this.b=o)),this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(se.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},getHSV:function(e){var i,r,a=this.r,n=this.g,o=this.b,s=Math.max(Math.max(a,n),o),l=Math.min(Math.min(a,n),o),h=s;if(l===s)i=0,r=0;else{var c=s-l;r=c/s,i=a===s?(n-o)/c:n===s?2+(o-a)/c:4+(a-n)/c,(i/=6)<0&&(i+=1),i>1&&(i-=1)}return e===t&&(e={h:0,s:0,v:0}),e.h=i,e.s=r,e.v=h,e},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},clone:function(){return(new se.Color).setRGB(this.r,this.g,this.b)},toString:function(){return this.getStyle()}}),se.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},se.Data=function(e){if(se.PropertyChangeDispatcher.call(this),this._childList=new _e,this._childMap={},this._clientMap={},e===t||null===e)this._id=se.id("E");else if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)this._id=e;else{for(var i in e)if("clients"===i)for(var r in e.clients)this._clientMap[r]=e.clients[r];else"styles"===i?this.s(e.styles):null!=e[i]&&("id"===i?this._id=e[i]:this[se.setter(i)]&&this[se.setter(i)](e[i]));null==this._id&&(this._id=se.id("E"))}},se.extend(se.Data,se.PropertyChangeDispatcher,{___accessor:["name"],constructor:se.Data,getId:function(){return this._id},onAlarmChange:function(){},onPropertyChange:function(e,t,i){},setGroupId:function(e){if(this._groupId!==e){var t=this._groupId;this._groupId=e,this.firePropertyChange("groupId",t,e)}},getGroupId:function(){return this._groupId},hasChildren:function(){return this._childList.size()>0},getChildren:function(){return this._childList},isDescendantOf:function(e){if(!e)return!1;if(!e.hasChildren())return!1;for(var t=this._parent;t;){if(e===t)return!0;t=t.getParent()}return!1},getParent:function(){return this._parent},getRoot:function(){var e=this._parent;return e&&null==e._parent?e:e&&null!=e._parent?e.getRoot(e):arguments[0]},setParent:function(e){if(!(this._isUpdatingParent||this._parent===e||this===e||e&&e.isDescendantOf(this))){var t=this._parent;this._parent=e,this._isUpdatingParent=!0,t&&t.removeChild(this),e&&e.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",t,e),this.onParentChanged(t,e)}},onParentChanged:function(e,t){},addChild:function(e,i){return i===t&&(i=this._childList.size()),!(!e||e===this)&&(!this._childMap[e.getId()]&&(!this.isDescendantOf(e)&&(e.getParent()&&e.getParent().removeChild(e),(i<0||i>this._childList.size())&&(i=this._childList.size()),this._childList.add(e,i),this._childMap[e._id]=e,e.setParent(this),this.firePropertyChange("children",null,e),this.onChildAdded(e,i),!0)))},onChildAdded:function(e,t){},clearChildren:function(){if(null!=this._childList&&this._childList.size()>0){var e=this;this._childList.toList().forEach(function(t){e.removeChild(t)})}},removeChild:function(e){if(!e)return!1;if(!this._childMap[e._id])return!1;var t=this._childList.remove(e);return delete this._childMap[e._id],this.firePropertyChange("children",e,null),e.setParent(null),this.onChildRemoved(e,t),!0},onChildRemoved:function(e,t){},c:function(e){if(e)for(var t in e)this.setClient(t,e[t])},setClient:function(e,t){if(null==e)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[e];return i===t?this:(null==t?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,i,t),this.onClientChanged(e,i,t),this)},getClient:function(e){return this._clientMap[e]},onClientChanged:function(e,t,i){},setPropertyValue:function(e,t){if(this[e]===t)return!1;var i=this[e];return i instanceof se.Color&&null!=t?(i=i.clone(),t instanceof se.Color?this[e].copy(t):this[e].set(t)):this[e]=t,!0}}),se.Element=function(e){this.styleMap={},this._visible=!0,this._selected=!1,this._selectable=!0,this._editable=!0,this.editing=!1,this.up=new he(0,1,0),this._position=new he(0,0,0),this._rotation=new he(0,0,0),this._scale=new he(1,1,1),this.eulerOrder=se.defaultEulerOrder,this.rotationAutoUpdate=!0,this.matrix=new ue,this.worldMatrix=new ue,this.rotationWorldMatrix=new ue,this.matrixAutoUpdate=!1,this.worldMatrixNeedsUpdate=!0,this.quaternion=new se.Quat,this.useQuaternion=!1,this._sizeFixed=!1,this._fixedSize=108,this.castShadow=!0,this.receiveShadow=!0,this.frustumCulled=!0,this._vector=new he,this.renderDepth=null,this._attachId="",this._groupId=null,this.editTransformToParent=!1,this._alarmState=new se.AlarmState(this),this.colors=[],se.Data.call(this,e)},se.Element.__m1=new ue,se.ElementIdCount=0,se.extend(se.Element,se.Data,{IStyle:!0,___accessor:["visible","selected","selectable","editable","sizeFixed"],constructor:se.Element,getAlarmState:function(){return this._alarmState},onAlarmChange:function(e,t){var i=this._alarmState.getHighestNativeAlarmSeverity();i?this.setStyle("m.alarmColor",new se.Color(i.color)):this.setStyle("m.alarmColor",null)},getDefaultInstance:function(){return this.constructor.defaultInstance===t&&(this.constructor.defaultInstance=new this.constructor),this.constructor.defaultInstance},onParentChanged:function(e,t){this.updateWorldMatrix(!0,!1)},onChildAdded:function(e,t){e.updateWorldMatrix(!0,!1)},onChildRemoved:function(e,t){e.updateWorldMatrix(!0,!1)},generatePrimitiveKey:function(){return null},serializeProperty:function(){},clear:function(e){},getSelectStyle:function(){return this.getStyle("select.style")},isSpaceChangedProperty:function(e){return"scale"===e||"position"===e||"rotation"===e},isStyleEquals:function(e,t,i){return null==t&&null==i||t===i},setStyle:function(e,t){if(null==e)return this;null==this.styleMap&&(this.styleMap={});var i=this.styleMap[e];return this.isStyleEquals(e,i,t)?this:(null==t?delete this.styleMap[e]:this.styleMap[e]=t,this.onStyleChanged(e,i,t),this.firePropertyChange(se.Styles.PREFIX_STYLE+e,i,t),this)},c:function(e){if(e)for(var t in e)this.setClient(t,e[t])},s:function(e){if(null==e)return this;null==this.styleMap&&(this.styleMap={});var t,i,r,a={},n={};for(t in e)i=e[t],r=this.styleMap[t],this.isStyleEquals(t,r,i)||(null==i?delete this.styleMap[t]:this.styleMap[t]=i,n[t]=r,this.isMaterialStyle(t)&&(a[t]=[i,r]));this.onMaterialStylesChanged(a);for(t in e)this.firePropertyChange(se.Styles.PREFIX_STYLE+t,n[t],this.styleMap[t]);return this},getStyle:function(e,t,i){null==i&&(i=!0);var r;return null!=this.styleMap&&(r=this.styleMap[e]),t&&(r=this.getCloneObject(r)),null==r&&i&&(r=this.getDefaultStyle(e,t)),r},getCloneObject:function(e){if(null==e)return null;if(se.Utils.isArray(e)){for(var t=[],i=0;i<e.length;i++)t.push(this.getCloneObject(e[i]));return t}return e.clone?e.clone():e},getSideIndexMapping:function(){},setMaterialStyle:function(e,t){},setMaterialStyles:function(e){var t,r,a,n;for(var o in e){if(o.startsWith("m."))t=o.substr(o.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(a)){var s=a.substr(0,a.indexOf("."));if(this.getSideMaterialIndex(s)!=i)continue;t=(a=a.substr(a.indexOf(".")+1)).substr(o.indexOf(".")+1)}else o.startsWith("alarm.billboard.")&&(n=!0);null==(r=e[o][0])?r=se.Styles.getStyle(o):Ee.isArray(r)&&(r=r[i]),this._A97(this.material,t,r)}n&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},onMaterialStylesChanged:function(e){this.setMaterialStyles(e)},isMaterialStyle:function(e){return!!e.startsWith("m.")||!(!this.getSideIndexMapping()||!this.isSideStyle(e))},onStyleChanged:function(e,t,i){if(e.startsWith("m."))this.setMaterialStyle(e,i);else if(this.getSideIndexMapping()&&this.isSideStyle(e)){var r=e.substr(0,e.indexOf("."));e=e.substr(e.indexOf(".")+1);var a=this.getSideMaterialIndex(r);this.setMaterialStyle(e,i,a)}else e.startsWith("alarm.billboard.")&&this._alarmBillboard&&this._setAlarmBillboardPositionAndSize(this._alarmBillboard)},textureMapping:{texture:"map",texture1:"map1",texture2:"map2",textureb:"blendMap",texturebp:"bumpMap",lightMap:"lightMap",lightmap:"lightMap",normalmap:"normalMap",envmap:"envMap",specularmap:"specularMap"},_A97:function(e,t,i){if(t.startsWith("texture.")||t.startsWith("texture1.")||t.startsWith("texture2.")||t.startsWith("textureb.")||t.startsWith("texturen.")||t.startsWith("texturebp.")||t.startsWith("lightmap")||t.startsWith("envmap")||t.startsWith("normalmap")||t.startsWith("specularmap")){var r=t.substr(0,t.indexOf(".")),a=t.substr(t.indexOf(".")+1);if("offset"===a||"repeat"===a)return void e.setPropertyValue(a,this.getCloneObject(i));var n=this.textureMapping[r],o=e[n],s=se.TexturePool.TestTexture;if("image"===a){var l=i;if(t.startsWith("envmap")&&Ee.isArray(l))for(var h=0;h<l.length;h++)if(null==l[h]){l=null;break}if(null==o&&null!=l){s.resetValue(),s._image=l,s.setImageSrc(l);c=s.getUniqueCode();null==(u=se.TexturePool.getTexture(c))&&(u=new se.Texture(l),se.TexturePool.setTexture(c,u)),e.setMap(u,n)}else if(null==l)e.setMap(null,n);else{o.clone(s,!1),s._image=l,s.setImageSrc(l);c=s.getUniqueCode();(u=se.TexturePool.getTexture(c))===o||(null==u&&(u=new se.Texture,o.clone(u,!1),u.setImage(l),se.TexturePool.setTexture(c,u)),e.setMap(u,n))}}else if(null!=o){o.clone(s,!1),s[a]=this.getCloneObject(i);var c=s.getUniqueCode(),u=se.TexturePool.getTexture(c);u!=o&&(null==u&&(u=new se.Texture,o.clone(u),u[a]=i),e.setMap(u,n))}}else"type"===t&&e.setType?e.setType(i):e.setPropertyValue(t,this.getCloneObject(i))},getDefaultStyle:function(e,t){if(null==e)return null;if(e.startsWith("m.")){var i=[],r=e.substr(e.indexOf(".")+1);if(this.material.materials){var a=this.material.materials;a=a||[this.material];for(u=0;u<a.length;u++){m=a[u];if(r.startsWith("texture.")||r.startsWith("texture1.")||r.startsWith("texture2.")||r.startsWith("textureb.")||r.startsWith("texturen.")||r.startsWith("texturebp.")||r.startsWith("lightmap")||r.startsWith("envmap")||r.startsWith("normalmap")||r.startsWith("specularmap")){var n=r.substr(0,r.indexOf(".")),o=r.substr(r.indexOf(".")+1),s=(r.substr(r.indexOf(".")+1),m[this.textureMapping[n]]);if(s)if("image"===o)if(Ee.isArray(s._image)){var l=[];i.push(l);for(var h=0;h<s._image.length;h++)l.push(s._image[h].src)}else i.push(s._image.src);else"offset"===o||"repeat"===o?i.push(m[o]):i.push(m.map[o]);else i.push(se.Styles.getStyle(e))}else{d=se.Styles.getStyle(e);i.push(null==d?m[r]:d)}}}t&&(i=this.getCloneObject(i));for(var c=!0,u=0;u<i.length;u++)if(0!=i.indexOf(i[u])){c=!1;break}return c?i[0]:i}if(this.isSideStyle(e)){var f=e.substr(0,e.indexOf(".")),r=(e=e.substr(e.indexOf(".")+1)).substr(e.indexOf(".")+1),p=this.getSideMaterialIndex(f);if(null!=p){var d,m=this.material.materials[p];return r.startsWith("texture.")?m.map&&(d="texture.image"===r?m.map._image.src:m.map[r]):d=m[r],t&&(d=this.getCloneObject(d)),d}}return se.Styles.getStyle(e)},isSideStyle:function(e){if(-1===e.indexOf("."))return!1;var i=this.getSideIndexMapping();return!!i&&i[e.substr(0,e.indexOf("."))]!==t},setUp:function(e,t,i){var r;if(3===arguments.length){if(this.up.x===e&&this.up.y===t&&this.up.z===i)return;r=new he(e,t,i)}else{if(this.up.x===e.x&&this.up.y===e.y&&this.up.z===e.z)return;r=e}var a=this.up;this.up=r,this.onUpChanged(a,r),this.firePropertyChange("up",a,r)},getUp:function(){return this.up},onUpChanged:function(e,t){},checkNumber:function(e,t,i,r){Ee.isNaN(e)&&console.error(r+",x is not a number"),Ee.isNaN(t)&&console.error(r+",y is not a number"),Ee.isNaN(i)&&console.error(r+",z is not a number")},invalidateTexture:function(e){var t,i,r,a=this.material;if(null!=e&&a instanceof se.ArrayMaterial){if("string"==typeof e){var n=this.getSideIndexMapping();if(null!=n&&(e=n[e]),null==e)return}if("number"!=typeof e)return;r=a instanceof se.ArrayMaterial?a.materials[e]:materail,this._dirtyMaterialTexture(r)}else if(a instanceof se.ArrayMaterial)for(i=a.materials,t=0;t<i.length;t++)r=i[t],this._dirtyMaterialTexture(r);else this._dirtyMaterialTexture(a)},_dirtyMaterialTexture:function(e){null!=e&&(e.map instanceof se.Texture&&this._dirtyTexture(e.map),e.lightMap instanceof se.Texture&&this._dirtyTexture(e.lightMap))},_dirtyTexture:function(e){var t=e._image;e.firePropertyChange("image",null,t)},p:function(e,t,i){if(0===arguments.length)return this.getPosition();3===arguments.length?this.setPosition(e,t,i):this.setPosition(e)},checkPosition:function(e){return!0},setPosition:function(e,t,i){var r;if(3===arguments.length){if(this._position.x===e&&this._position.y===t&&this._position.z===i)return;this.checkNumber(e,t,i,"setPosition"),r=new he(e,t,i)}else{if(this._position.x===e.x&&this._position.y===e.y&&this._position.z===e.z)return;if(!(e instanceof he))throw"Element.setPosition : position is not instanceof TGL.Vec3";r=e}if(this.checkPosition(r)){var a=this._position;this._position=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("position",a,r)}},getPosition:function(e){return e==t&&(e=!0),e?this._position.clone():this._position},setPositionX:function(e){if(this._position.x!==e){this.checkNumber(e,0,0,"setPositionX");var t=this._position.x,i=this._position.clone();if(i.x=e,!this.checkPosition(i))return!1;this._position.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionX",t,e)}},setX:function(e){this.setPositionX(e)},getPositionX:function(){return this._position.x},getX:function(){return this.getPositionX()},setPositionY:function(e){if(this._position.y!==e){this.checkNumber(0,e,0,"setPositionY");var t=this._position.y,i=this._position.clone();if(i.y=e,!this.checkPosition(i))return!1;this._position.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionY",t,e)}},setY:function(e){this.setPositionY(e)},getPositionY:function(){return this._position.y},getY:function(){return this.getPositionY()},setPositionZ:function(e){if(this._position.z!==e){this.checkNumber(0,0,e,"setPositionZ");var t=this._position.z,i=this._position.clone();if(i.z=e,!this.checkPosition(i))return!1;this._position.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("positionZ",t,e)}},setZ:function(e){this.setPositionZ(e)},getPositionZ:function(){return this._position.z},getZ:function(){return this.getPositionZ()},setScale:function(e,t,i){var r;if(3===arguments.length){if(this._scale.x===e&&this._scale.y===t&&this._scale.z===i)return;this.checkNumber(e,t,i,"setScale"),r=new he(e,t,i)}else{if(this._scale.x===e.x&&this._scale.y===e.y&&this._scale.z===e.z)return;if(!(e instanceof he))throw"Element.setScale : scale is not instanceof TGL.Vec3";r=e}var a=this._scale;r.x=r.x||1,r.y=r.y||1,r.z=r.z||1,this._scale=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scale",a,r)},getScale:function(e){return e==t&&(e=!0),e?this._scale.clone():this._scale},setScaleX:function(e){if(this._scale.x!==e){this.checkNumber(e,0,0,"setScalX");var t=this._scale.x;this._scale.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleX",t,e)}},getScaleX:function(){return this._scale.x},setScaleY:function(e){if(this._scale.y!==e){this.checkNumber(0,e,0,"setScaleY");var t=this._scale.y;this._scale.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleY",t,e)}},getScaleY:function(){return this._scale.y},setScaleZ:function(e){if(this._scale.z!==e){this.checkNumber(0,0,e,"setScaleZ");var t=this._scale.z;this._scale.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("scaleZ",t,e)}},getScaleZ:function(){return this._scale.z},setRotation:function(e,t,i){var r;if(3===arguments.length){if(this._rotation.x===e&&this._rotation.y===t&&this._rotation.z===i)return;this.checkNumber(e,t,i,"setRotation"),r=new he(e,t,i)}else{if(this._rotation.x===e.x&&this._rotation.y===e.y&&this._rotation.z===e.z)return;if(!(e instanceof he))throw"Element.setRotation : rotation is not instanceof TGL.Vec3";r=e}var a=this._rotation;this._rotation=r,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotation",a,r)},getRotation:function(e){return e==t&&(e=!0),e?this._rotation.clone():this._rotation},setRotationX:function(e){if(this._rotation.x!==e){this.checkNumber(e,0,0,"setRotationX");var t=this._rotation.x;this._rotation.x=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationX",t,e)}},getRotationX:function(){return this._rotation.x},setRotationY:function(e){if(this._rotation.y!==e){this.checkNumber(0,e,0,"setRotationY");var t=this._rotation.y;this._rotation.y=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationY",t,e)}},getRotationY:function(){return this._rotation.y},setRotationZ:function(e){if(this._rotation.z!==e){this.checkNumber(0,0,e,"setRotationZ");var t=this._rotation.z;this._rotation.z=e,this.updateWorldMatrix(!0,!1),this.firePropertyChange("rotationZ",t,e)}},getRotationZ:function(){return this._rotation.z},applyMatrix:function(e){var t=this.matrix.clone();this.matrix.multiplyMatrices(e,this.matrix),this._scale.getScaleFromMatrix(this.matrix);var i=(new ue).extractRotation(this.matrix);this._rotation.setEulerFromRotationMatrix(i,this.eulerOrder),this._position.getPositionFromMatrix(this.matrix),this.updateWorldMatrix(!0,!1),this.firePropertyChange("matrix",t,this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.setPosition(this._position.clone().add(t.multiplyScalar(e)))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},rotateFromAxis:function(e,t,i){t=t.clone().applyMatrix4(this.matrix),e=e.clone().normalize().applyMatrix4((new ue).extractRotation(this.matrix));var r=(new ue).makeRotationAxisAndCenter(e,i,t);this.applyMatrix(r)},rotateFromWorldAxis:function(e,t){var i=new ue;i.makeRotationAxis(e.normalize(),t),i.multiply(this.matrix),this.matrix=i;var r=(new ue).extractRotation(this.matrix),a=new he;a.setEulerFromRotationMatrix(r,this.eulerOrder),this.setRotation(a)},getEulerAngles:function(){return this.matrix.getEulerAngles()},rotateFromWorldXAxis:function(e){this.rotateFromWorldAxis(new he(1,0,0),e)},rotateFromWorldYAxis:function(e){this.rotateFromWorldAxis(new he(0,1,0),e)},rotateFromWorldZAxis:function(e){this.rotateFromWorldAxis(new he(0,0,1),e)},getRelativeTransform:function(e){if(e instanceof se.Element){var t=(new ue).getInverse(e.matrix.clone()),i=(new ue).multiplyMatrices(t,this.matrix.clone());return{position:(new he).getPositionFromMatrix(i),rotation:(new he).setEulerFromRotationMatrix(i),scale:(new he).getScaleFromMatrix(i),matrix:i}}return null},localToWorld:function(e){return null==this._parent?e:e.clone().applyMatrix4(this._parent.worldMatrix)},localToWorld2:function(e){return e.clone().applyMatrix4(this.worldMatrix)},getWorldPosition:function(){return this.worldMatrix.getPosition()},direction:function(e){var t=e.applyMatrix4((new ue).extractRotation(this.worldMatrix));return t.normalize(),t},frontDirection:function(){var e=new he(0,0,1);return(e=e.applyMatrix4((new ue).extractRotation(this.worldMatrix))).normalize(),e},worldPosition:function(e,t){return t=t>0?t:e.length(),this.worldMatrix.getPosition().add(this.direction(e).multiplyScalar(t))},frontWorldPosition:function(e){return e=e>0?e:1,this.worldMatrix.getPosition().add(this.frontDirection().multiplyScalar(e))},worldToLocal:function(e){return e.clone().applyMatrix4(se.Element.__m1.getInverse(this.worldMatrix))},lookAt:function(e,t){this.matrix.lookAt(e,this._position,t||this.up),this.rotationAutoUpdate&&(!1===this.useQuaternion?this._rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1])),this.worldMatrixNeedsUpdate=!0},iterator:function(e){e(this),this._childList&&this._childList.forEach(function(t){t.iterator(e)})},getChildByName:function(e,i){for(var r=0,a=this.children.length;r<a;r++){var n=this.children[r];if(n.name===e)return n;if(!0===i&&(n=n.getChildByName(e,i))!==t)return n}return t},getDescendants:function(e){e===t&&(e=[]);var i=this.getChildren().toArray();Array.prototype.push.apply(e,i);for(var r=0,a=i.length;r<a;r++)i[r].getDescendants(e);return e},fixSize:function(e){if(this._sizeFixed){this.updateWorldMatrix();var t=new he,i=new he;t.getPositionFromMatrix(this.worldMatrix),e.updateWorldMatrix(),i.getPositionFromMatrix(e.worldMatrix),scale=t.distanceTo(i)/this._fixedSize,0===scale&&(scale=1e-5),this.setScale(scale,scale,scale)}},updateMatrix:function(){this.matrix.setPosition(this._position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this._rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this._scale.x&&1===this._scale.y&&1===this._scale.z||this.matrix.scale(this._scale),this.worldMatrixNeedsUpdate=!0},updateWorldMatrix:function(e,i){if(i=i==t||i,!0===this.matrixAutoUpdate&&this.updateMatrix(),!0===this.worldMatrixNeedsUpdate||!0===e){!1===this.matrixAutoUpdate&&this.updateMatrix();var r=this.worldMatrix.clone();this._parent==t?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0,r.equals(this.worldMatrix)||(i&&this.firePropertyChange("worldMatrix",r,this.worldMatrix),this.updateCameraMatrix&&this.updateCameraMatrix(!1))}this._childList.forEach(function(t){t.updateWorldMatrix(e)})},cloneCallback:function(e){},clonePrefab:function(e){var i=new mono.Entity;e===t&&(e=!0),i.name=this.name,null==i.up&&(i.up=new he(0,1,0)),i.up.copy(this.up),i._position.copy(this._position),i._rotation.copy(this._rotation),i.eulerOrder=this.eulerOrder,i._scale.copy(this._scale),i.renderDepth=this.renderDepth,i.rotationAutoUpdate=this.rotationAutoUpdate,i.matrix.copy(this.matrix),i.worldMatrix.copy(this.worldMatrix),i.rotationWorldMatrix.copy(this.rotationWorldMatrix),i.matrixAutoUpdate=this.matrixAutoUpdate,i.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,i.quaternion.copy(this.quaternion),i.useQuaternion=this.useQuaternion,i._visible=this._visible,i.castShadow=this.castShadow,i.receiveShadow=this.receiveShadow,i.frustumCulled=this.frustumCulled,i.styleMap=i.styleMap||{},e&&this._childList&&this._childList.forEach(function(t){i.addChild(t.clonePrefab(e))}),i.vertices=this.vertices,i.faces=this.faces,i.uvs=this.uvs,i.uv2s=this.uv2s,this.primitive&&(i.primitive=this.primitive,i.data=this.primitive.data,i.computed=!0);for(var r in this.styleMap)i.styleMap[r]=this.getCloneObject(this.styleMap[r]);if(null!=this._clientMap)for(var a in this._clientMap)i.setClient(a,this._clientMap[a]);if(i.material=this.material,this.material instanceof se.ArrayMaterial){i.material=new se.ArrayMaterial,i.material.materials=[];for(var n=0;n<this.material.materials.length;n++)i.material.materials.push(this.material.materials[n])}return i.materialSize=this.getMaterialSize?this.getMaterialSize():1,i},createCloneObject:function(){return this.constructor?object=new this.constructor:object=new se.Element,object},clone:function(e,i,r){if("boolean"==typeof e&&(r=i,i=e,e=t),e==t&&(e=this.createCloneObject()),r===t&&(r=!0),e.name=this.name,null==e.up&&(e.up=new he(0,1,0)),e.up.copy(this.up),e._position.copy(this._position),e._rotation.copy(this._rotation),e.eulerOrder=this.eulerOrder,e._scale.copy(this._scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.worldMatrix.copy(this.worldMatrix),e.rotationWorldMatrix.copy(this.rotationWorldMatrix),e.matrixAutoUpdate=this.matrixAutoUpdate,e.worldMatrixNeedsUpdate=this.worldMatrixNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e._visible=this._visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.styleMap=e.styleMap||{},r&&this._childList&&this._childList.forEach(function(t){e.addChild(t.clone(i,r))}),this.constructor){var a=this.constructor.prototype.__accessor,n=this.constructor.prototype.__bool;if(a&&a.length>0)for(u=0;u<a.length;u++){var o=a[u],s=se.getter(o,n),l=se.setter(o);"vertices"===o?e.vertices=this.vertices:"faces"===o?e.faces=this.faces:e[l]&&e[l](this[s]())}}if(i&&this.vertices){var h=e,c=this.vertices;h.vertices=[],h.faces=[],h.uvs=[];for(var u=0,f=c.length;u<f;u++)h.vertices.push(c[u].clone());for(var p=this.faces,u=0,f=p.length;u<f;u++)h.faces.push(p[u].clone());for(var d=this.uvs,u=0,f=d.length;u<f;u++){for(var m=d[u],g=[],y=0,v=m.length;y<v;y++)g.push(new se.Vec2(m[y].x,m[y].y));h.uvs.push(g)}}for(var x in this.styleMap)e.setStyle(x,this.getCloneObject(this.styleMap[x]));if(null!=this._clientMap)for(var A in this._clientMap)e.setClient(A,this._clientMap[A]);return e.cloneCallback(i),e}}),se.Annotation=function(e,t,i){se.Element.call(this,i),this._label=e,this._text=t,this._cameraPosition=null},se.extend(se.Annotation,se.Element,{___accessor:["label","text","cameraPosition"]}),se.Node=function(e){this.name="",this.computed=!1,this.selectionData=null,this.renderGroup=[],this.primitive=null,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.colors=[],this.normals=[],this.faces=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1,this.computeNodeData(),this._alarmBillboard=null,se.Element.call(this,e)},se.extend(se.Node,se.Element,{__accessor:["vertices","faces","uvs","linkAgent"],__SizePropeties:[],setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.colorsNeedUpdate=e},getLinks:function(){return this._links},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(e){this._allLinks||(this._allLinks=new _e),this._fromLinks||(this._fromLinks=new _e),this._allLinks.add(e),this._fromLinks.add(e),this._resetLinkSet()},_addToLink:function(e){this._allLinks||(this._allLinks=new _e),this._toLinks||(this._toLinks=new _e),this._allLinks.add(e),this._toLinks.add(e),this._resetLinkSet()},_removeFromLink:function(e){this._allLinks.remove(e),this._fromLinks.remove(e),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},_removeToLink:function(e){this._allLinks.remove(e),this._toLinks.remove(e),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},_resetLinkSet:function(){if(delete this._loopedLinks,this._allLinks&&0!==this._allLinks.size()){var e;this._allLinks.forEach(function(t){t.isLooped()&&(e||(e={}),e[t._id]||(this._loopedLinks||(this._loopedLinks=new _e),this._loopedLinks.add(t),e[t._id]=t))},this),e?(this._links=new _e,this._allLinks.forEach(function(t){e[t._id]?!1!==e[t._id]&&(e[t._id]=!1,this._links.add(t)):this._links.add(t)},this)):this._links=this._allLinks}else delete this._links},onAlarmChange:function(e,t){se.Element.prototype.onAlarmChange.call(this,e,t);var i=this;setTimeout(function(){var e=i._alarmState.getPropagateSeverity();e||(e=i._alarmState.getHighestNativeAlarmSeverity());var t=i._parent,r=!1;null!=t&&t._alarmState?t._alarmState.getPropagateSeverity()||(r=!0):r=!0,e&&r?(null==i._alarmBillboard&&i.setAlarmBillboard(new se.Billboard),i.setAlarmBillboardImageAndColor(i._alarmBillboard,e)):i.setAlarmBillboard(null)},10)},setAlarmBillboardImageAndColor:function(e,t){e.setStyle("m.texture.image",se.ImageCache.AlarmBillboardImage),e.setStyle("m.color",t.color),e.setStyle("m.alignment",se.BillboardAlignment.bottomCenter)},_setAlarmBillboardPositionAndSize:function(e){var t=this.getStyle("alarm.billboard.position"),i=this.getBoundingBox(),r=i.min,a=i.max,n=i.center(),o=i.size();"topLeft"===t?e._position.set(r.x,a.y,n.z+1):"topRight"===t?e._position.set(a.x,a.y,n.z+1):"topBack"===t?e._position.set(n.x,a.y,r.z-1):"topFront"===t?e._position.set(n.x,a.y,a.z+1):e._position.set(n.x,a.y,n.z+1);var s=this.getStyle("alarm.billboard.scale");s instanceof he?e._scale.copy(s):e._scale.set(o.x/2,o.x/2,1);var l=this.getStyle("alarm.billboard.vertical");e.setStyle("m.vertical",l)},getLinkOffset:function(e){return new mono.Vec3(0,0,0)},getLinkExtend:function(e){return new mono.Vec3(0,0,0)},clearLinkOrthogonal:function(e,t){return!1},clearLinkExtend:function(e,t){return!1},setAlarmBillboard:function(e){if(this._alarmBillboard!=e){var t=this._alarmBillboard;e?(this._alarmBillboard=e,e.setParent(this),e.setClient("alarmBillboard",!0),this._setAlarmBillboardPositionAndSize(e)):(this._alarmBillboard.setParent(null),delete this._alarmBillboard),this.firePropertyChange("alarmBillboard",t,e)}},needUpdate:function(){return this.verticesNeedUpdate||this.elementsNeedUpdate||this.uvsNeedUpdate||this.normalsNeedUpdate||this.colorsNeedUpdate},getVerticesWithChildren:function(e,t){function i(i){i.applyMatrix4(e),t.push(i)}null==t&&(t=[]),null==e&&(e=new ue);if(this instanceof se.Node){if(null!=this.vertices&&0!=this.vertices.length){var r=this.getBoundingBox(),a=r.min,n=r.max;i(a.clone()),i(n.clone()),i(new he(a.x,a.y,n.z)),i(new he(a.x,n.y,a.z)),i(new he(n.x,a.y,a.z)),i(new he(n.x,n.y,a.z)),i(new he(n.x,a.y,n.z)),i(new he(a.x,n.y,n.z))}for(var o=0;o<(this._childList?this._childList.size():0);o++){var s=this._childList.get(o),l=new ue;l.multiplyMatrices(e,s.matrix.clone()),s.getVerticesWithChildren&&s.getVerticesWithChildren(l,t)}}return t},getBoundingBoxWithChildren:function(e){var t=this.getVerticesWithChildren();if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r.getParent()===this.getParent()&&r!==this){var a=(new ue).getInverse(this.matrix.clone()),n=(new ue).multiplyMatrices(a,r.matrix.clone());t=t.concat(r.getVerticesWithChildren(n))}}var o=new se.BoundingBox;return o.setFromPoints(t),o},getWorldBoundingBox:function(){for(var e=[],t=0;t<this.vertices.length;t++){var i=this.vertices[t].clone();i.applyMatrix4(this.worldMatrix),e.push(i)}var r=new se.BoundingBox;return r.setFromPoints(e),r},getBoundingBox:function(){return null==this.boundingBox&&this.computeBoundingBox(),this.boundingBox},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new se.BoundingBox),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new se.BoundingSphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},createPropagateAlarmCube:function(e){if(null==this.boundingBox&&this.computeBoundingBox(),e._attachId=this._id,null==this.propagateAlarmData){var t=this.getStyle("outer.offset"),i=this.boundingBox.min,r=this.boundingBox.max;e.width=r.x-i.x+t,e.height=r.y-i.y+t,e.depth=r.z-i.z+t,e.computed=!1,e.computeNodeData(),this.propagateAlarmData=e.data,ve(e),this.propagateAlarmData.primitive=e.primitive,this.propagateAlarmData.groups=e.groups;for(var a=(new he).center(i,r),n=0;n<e.vertices.length;n++)e.vertices[n].add(a);this.propagateAlarmData.vertices=e.vertices}else{var o=this.propagateAlarmData;e.primitive=o.primitive,e.data=o,e.vertices=o.vertices,e.uvs=o.uvs,e.faces=o.faces,e.groups=o.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var s=e.material;s.wireframeLinewidth=this.getStyle("outer.width");var l=this.getAlarmState().getPropagateSeverity();return s.color.set(l.color),e},createCanvasSelectionCube:function(){return null==this._csc&&(this._csc=new Ce,this._csc.material=new se.EntityMaterial,this._csc.material.wireframe=!0),this.createSelectionCube(this._csc),this._csc},createSelectionCube:function(e){if(null==this.boundingBox&&this.computeBoundingBox(),e._attachId=this._id+"_selection",null==this.selectionData){var t=this.getStyle("select.offset"),i=this.boundingBox.min,r=this.boundingBox.max,a=(new he).center(i,r);e.width=r.x-i.x+t,e.height=r.y-i.y+t,e.depth=r.z-i.z+t,e.offset=a,e.computed=!1;e.computeNodeData();this.selectionData=e.data,ve(e),this.selectionData.primitive=e.primitive,this.selectionData.groups=e.groups,this.selectionData.vertices=e.vertices}else{var n=this.selectionData;e.primitive=n.primitive,e.data=n,e.vertices=n.vertices,e.uvs=n.uvs,e.faces=n.faces,e.groups=n.groups}this.updateMatrix(!0),e._position.copy(this._position),e._scale.copy(this._scale),e._rotation.copy(this._rotation),e.useQuaternion=this.useQuaternion,e.quaternion=this.quaternion,e.worldMatrix=this.worldMatrix,e._parent=this.getParent(),e.updateMatrix(!0);var o=e.material;return o.wireframeLinewidth=this.getStyle("select.width"),o.color.set(this.getStyle("select.color")),o.wireframeLinecolor.set(this.getStyle("select.color")),e},mergeVertices:function(){var e,i,r,a,n,o,s,l={},h=[],c=[],u=Math.pow(10,4);for(this.__tmpVertices=t,null==this.vertices&&console.log("vertices is null"),r=0,a=this.vertices.length;r<a;r++)e=this.vertices[r],l[i=[Math.round(e.x*u),Math.round(e.y*u),Math.round(e.z*u)].join("_")]===t?(l[i]=r,h.push(this.vertices[r]),c[r]=h.length-1):c[r]=c[l[i]];var f=[];for(r=0,a=this.faces.length;r<a;r++)if((n=this.faces[r])instanceof Se){n.a=c[n.a],n.b=c[n.b],n.c=c[n.c],o=[n.a,n.b,n.c];for(var p=-1,d=0;d<3;d++)if(o[d]==o[(d+1)%3]){p=d,f.push(r);break}}else if(n instanceof Pe){n.a=c[n.a],n.b=c[n.b],n.c=c[n.c],n.d=c[n.d],o=[n.a,n.b,n.c,n.d];for(var p=-1,d=0;d<4;d++)o[d]==o[(d+1)%4]&&(p>=0&&f.push(r),p=d);if(p>=0){o.splice(p,1);var m=new Se(o[0],o[1],o[2],n.normal,n.color,n.materialIndex);(s=this.uvs[r])&&s.splice(p,1),n.vertexNormals&&n.vertexNormals.length>0&&(m.vertexNormals=n.vertexNormals,m.vertexNormals.splice(p,1)),n.vertexColors&&n.vertexColors.length>0&&(m.vertexColors=n.vertexColors,m.vertexColors.splice(p,1)),this.faces[r]=m}}for(r=f.length-1;r>=0;r--);var g=this.vertices.length-h.length;return this.vertices=h,g},computeVertexNormals:function(e){var i,r,a,n,o,s;if(this.__tmpVertices===t){for(this.__tmpVertices=new Array(this.vertices.length),s=this.__tmpVertices,i=0,r=this.vertices.length;i<r;i++)s[i]=new se.Vec3;for(a=0,n=this.faces.length;a<n;a++)(o=this.faces[a]).vertexNormals=[new se.Vec3,new se.Vec3,new se.Vec3]}else for(s=this.__tmpVertices,i=0,r=this.vertices.length;i<r;i++)s[i].set(0,0,0);if(e){var l,h,c,u=new se.Vec3,f=new se.Vec3;new se.Vec3,new se.Vec3,new se.Vec3;for(a=0,n=this.faces.length;a<n;a++)o=this.faces[a],l=this.vertices[o.a],h=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,h),f.subVectors(l,h),u.cross(f),s[o.a].add(u),s[o.b].add(u),s[o.c].add(u),o.d!=t&&s[o.d].add(u)}else for(a=0,n=this.faces.length;a<n;a++)s[(o=this.faces[a]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(i=0,r=this.vertices.length;i<r;i++)s[i].normalize();for(a=0,n=this.faces.length;a<n;a++)(o=this.faces[a]).vertexNormals[0].copy(s[o.a]),o.vertexNormals[1].copy(s[o.b]),o.vertexNormals[2].copy(s[o.c]),o.d!=t&&(o.vertexNormals[3]=s[o.d].clone())},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++)(i=this.faces[e]).centroid=i.centroid||new he,null==i.centroid&&console.log("fdasfdsa"),i.centroid.set||(i.centroid=new he),i.centroid.set(0,0,0),i instanceof Se?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof Pe&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,i,r,a,n,o=new he,s=new he;for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],r=this.vertices[i.a],a=this.vertices[i.b],n=this.vertices[i.c],o.subVectors(n,a),s.subVectors(r,a),o.cross(s),o.normalize(),i.normal.copy||(i.normal=new he),i.normal.copy(o)},computeVertex:function(){},computePrimitive:function(){},generalteGroup:function(){},getMatetial:function(){return this.material},computeNodeMaterial:function(e){},cacheNodeMaterial:function(e){},needComputeVertexNormal:function(){return!0},computeNodeData:function(e){if(!1===this.computed){var t=this.generatePrimitiveKey();this._attachId&&(t+="_"+this._attachId);var i=se.PrimitiveCache.getPrimitive(t),r=!1;if(i)this.primitive&&se.PrimitiveCache.unUsePrimitive(i),this.computeNodeMaterial(i);else{var a=this.computeData();if(this.needComputeVertexNormal()&&(se.Node.prototype.mergeVertices.call(a),se.Node.prototype.computeFaceNormals.call(a),se.Node.prototype.computeVertexNormals.call(a,!0)),(null==a.uv2s||0==a.uv2s.length)&&(a.uv2s=[],null!=a.uvs&&a.uvs.length>0))for(var n=0;n<a.uvs.length;n++){for(var o=[],s=a.uvs[n],l=0;l<s.length;l++)o.push(s[l].clone());a.uv2s.push(o)}i=new se.Primitive(a,t),se.PrimitiveCache.setPrimitive(t,i),this.cacheNodeMaterial(i),r=!0}return se.PrimitiveCache.usePrimitive(i),this.primitive=i,this.data=i.data,this.vertices=i.vertices,this.faces=i.faces,this.uvs=i.uvs,this.uv2s=i.uv2s,this.colors=i.colors,this.computed=!0,r}},computeData:function(){var e={vertices:[],faces:[],uv2s:[],uvs:[]};return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},setMaterial:function(e,t,i){var r=t.getUniqueCode?t.getUniqueCode():null,a=at.getMaterial(r);a?(this.material.materials[e]=a,at.useMaterial(a)):(this.material.materials[e]=t,at.setMaterial(r,t),at.useMaterial(t)),at.unUseMaterial(i)},onMaterialMapping:function(){this.groups=t},getMaterialSize:function(){return this.materialSize||1},startBatch:function(){this.batch=!0},endBatch:function(){this.materialMappingChanges!==t&&(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",this.materialMappingChanges[0],this.materialMappingChanges[1]),this.materialMappingChanges=t),this.batch=!1},compareAndSetMaterial:function(e,t,i){this.setMaterial(i,t,e)},cloneStyle:function(e){if(this.getClassName()==e.getClassName()){for(var t=this.getMaterialMapping(),i=0;i<this.getMaterialSize();i++){var r=this.material.materials[i],a=e.material.materials[i];this.compareAndSetMaterial(r,a,i)}var n=this.getMaterialMapping();se.Utils.isSame(t,n)||(this.batch?this.materialMappingChanges=[t,n]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",t,n)))}else console.warn("ApplyStyle fail, the source with not the same class")},_considerArray:function(e,t){if(e.startsWith("envmap.image")){var i=!1;if(Ee.isArray(t))for(var r=0;r<t.length;r++)if(Ee.isArray(t[r])){i=!0;break}return i}return Ee.isArray(t)},setMaterialStyles:function(e){for(var t,i,r,a,n,o=this.getMaterialMapping(),o=this.getMaterialMapping(),s=0;s<this.getMaterialSize();s++){r=(i=this.material.materials[s]).clone();var l=!1;for(var h in e){if(h.startsWith("m."))a=h.substr(h.indexOf(".")+1);else if(this.getSideIndexMapping()&&this.isSideStyle(h)){var c=h.substr(0,h.indexOf("."));if(this.getSideMaterialIndex(c)!=s)continue;!0,a=(n=h.substr(h.indexOf(".")+1)).substr(n.indexOf(".")+1)}null==(t=e[h][0])?t=se.Styles.getStyle(h):this._considerArray(a,t)&&(t=t[s]),this._A97(r,a,t),l=!0}l&&this.compareAndSetMaterial(i,r,s)}this.changeMapping(o)},setMaterialStyle:function(e,t,i){var t,r,a,n,o,s=e;if(e.startsWith("m.")&&(s=e.substr(e.indexOf(".")+1)),null==i&&!se.Utils.isArray(t)){var l=[];for(f=0;f<this.getMaterialSize();f++)l.push(t);this.styleMap[e]=l,t=l}var h=!1;if(s.startsWith("envmap.image")&&t&&Ee.isArray(t))for(f=0;f<t.length;f++){if(Ee.isArray(t[f])){h=!1;break}h=!0}c=this.getMaterialMapping();if(null!=i||se.Utils.isArray(t)&&!h){if(se.Utils.isArray(t)){r=t;for(f=0;f<this.getMaterialSize();f++)a=r[f],o=(n=this.material.materials[f]).clone(),null==a&&(a=se.Styles.getStyle(e)),this._A97(o,s,a),this.compareAndSetMaterial(n,o,f)}else if(null!=i){var c=this.getMaterialMapping();o=(n=this.material.materials[i]).clone(),this._A97(o,s,t),this.compareAndSetMaterial(n,o,i),this.synchronizeIndexStyle(e,i,t)}}else for(var u=[],f=0;f<this.getMaterialSize();f++)!0!==u[f]&&(a=t,o=(n=this.material.materials[f]).clone(),null==a&&(a=se.Styles.getStyle(e)),this._A97(o,s,a),this.compareAndSetMaterial(n,o,f));this.changeMapping(c)},changeMapping:function(e){var t=this.getMaterialMapping();se.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onSizeChanged(),this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},synchronizeSideStyle:function(e,t,i){var r=this.getMaterialIndexSide(t);r&&null!=this.styleMap[r+"."+e]&&(this.styleMap[r+"."+e]=i)},synchronizeIndexStyle:function(e,t,r){var a=this.styleMap[e];if(null==a&&(a=this.getStyle(e),this.styleMap[e]=a),se.Utils.isArray(a))a[t]=r;else{var n=[];for(i=0;i<this.getMaterialSize();i++)n.push(a);n[t]=r,this.styleMap[e]=n}},getDefaultMaterial:function(e,t){return e?e instanceof se.ArrayMaterial?0===e.materials.length?at.DefaultMaterial:(t>=e.materials.length&&(t=e.materials.length-1),e.materials[t]):e:at.DefaultMaterial},createMaterial:function(e){var t=new se.ArrayMaterial;this.material=t;for(var i=this.getMaterialSize(),r=0;r<i;r++)this.setMaterial(r,this.getDefaultMaterial(e,r))},onPropertyChange:function(e,t,i){this.changeProperty=e,this.oldGroups=this.groups;var r=this.isSizeChangedProperty(e);r&&this.onSizeChanged(),r&&this.onMaterialMapping(),r&&this.firePropertyChange("materialMapping",0,1)},onSizeChanged:function(){this.computed=!1,this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null,this.changeProperty=null},isSizeChangedProperty:function(e){return-1!==this.__SizePropeties.indexOf(e)||"vertices"==e||"faces"==e||"uvs"==e},isGroupChangedProperty:function(e){},getMaterialMapping:function(){var e={},t=this.material.materials;for(var i in t)e[i]=t.indexOf(t[i]);return e},getSideMaterialIndex:function(e){var t=this.getSideIndexMapping();if(t)return t[e]},getMaterialIndexSide:function(e){var t=this.getIndexSideMapping();if(t)return t[e]},getIndexSideMapping:function(){var e=this.getSideIndexMapping();if(e&&!this.IndexSideMapping){this.IndexSideMapping={};var t,i;for(t in e)i=e[t],this.IndexSideMapping[i]=t}return this.IndexSideMapping},getSideIndexMapping:function(){},disposeMaterial:function(){},getMaterial:function(){return this.material}});var Me=function(e,t,i){this.normal=e instanceof se.Vec3?e:new se.Vec3,this.vertexNormals=e instanceof Array?e:[],this.color=t instanceof se.Color?t:new se.Color,this.vertexColors=t instanceof Array?t:[],this.materialIndex=i||0,this.centroid=new se.Vec3,this.needVertexNormal=!1};se.Face=Me,Me.prototype={constructor:se.Face,subClone:function(){},clone:function(){var e=this.subClone();e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;t<i;t++)e.vertexNormals.push(this.vertexNormals[t]);for(t=0,i=this.vertexColors.length;t<i;t++)e.vertexColors.push(this.vertexColors[t]);return e}};var Se=function(e,t,i,r,a,n){se.Face.call(this,r,a,n),this.a=e,this.b=t,this.c=i};se.Face3=Se,Se.prototype=Object.create(se.Face.prototype),Se.prototype.constructor=se.Face3,Se.prototype.subClone=function(){return new Se(this.a,this.b,this.c)},Se.prototype.vertexCount=3,Se.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c}};var Pe=function(e,t,i,r,a,n,o){se.Face.call(this,a,n,o),this.a=e,this.b=t,this.c=i,this.d=r};se.Face4=Pe,Pe.prototype=Object.create(se.Face.prototype),Pe.prototype.constructor=se.Face4,Pe.prototype.subClone=function(){return new Pe(this.a,this.b,this.c,this.d)},Pe.prototype.splitToFace3s=function(){return[new Se(this.a,this.b,this.d,this.normal,this.color,this.materialIndex),new Se(this.d,this.b,this.c,this.normal,this.color,this.materialIndex)]},Pe.prototype.vertexCount=4,Pe.prototype.serializeJsonValue=function(){return{a:this.a,b:this.b,c:this.c,d:this.d}},se.Entity=function(e,i){e instanceof se.ArrayMaterial?(this.material=e,this.materialSize=this.material.materials.length||1):e instanceof se.Material?(this.material=e,this.materialSize=1):e&&(this.materialSize=e),this.materialSize=this.materialSize||1,this.createMaterial(this.material),i!=t&&null==this._id&&(this._id=i),se.Node.call(this,this._id),this.groups=null},se.extend(se.Entity,se.Node,{constructor:se.Entity,className:"TGL.Entity",__accessor:["computeVertexNormal"],__SizePropeties:["computeVertexNormal"],setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.elementsNeedUpdate=e,this.uvsNeedUpdate=e,this.normalsNeedUpdate=e,this.colorsNeedUpdate=e,this.buffersNeedUpdate=e},cloneCallback:function(e){e&&"TGL.Entity"===this.className&&(this.computed=!1,this.computeNodeData())},needComputeVertexNormal:function(){return this.computeVertexNormal},computeData:function(){return{vertices:this.vertices,faces:this.faces,uvs:this.uvs,uv2s:this.uv2s}},createCloneObject:function(){return this.constructor===se.Entity?new se.Entity(this.materialSize):se.Element.prototype.createCloneObject.call(this)},getMaterialSize:function(){return this.materialSize},setMaterialSize:function(e){"number"==typeof e&&(this.materialSize=e,this.createMaterial(this.material))},calculateNormals:function(e,t){for(var i=[],r=0;r<e.length;r+=3)i[r+0]=0,i[r+1]=0,i[r+2]=0;for(r=0;r<t.length;r+=3){var a=[],n=[],o=[];a[0]=e[3*t[r+2]+0]-e[3*t[r+1]+0],a[1]=e[3*t[r+2]+1]-e[3*t[r+1]+1],a[2]=e[3*t[r+2]+2]-e[3*t[r+1]+2],n[0]=e[3*t[r]+0]-e[3*t[r+1]+0],n[1]=e[3*t[r]+1]-e[3*t[r+1]+1],n[2]=e[3*t[r]+2]-e[3*t[r+1]+2],o[0]=a[1]*n[2]-a[2]*n[1],o[1]=a[2]*n[0]-a[0]*n[2],o[2]=a[0]*n[1]-a[1]*n[0];for(var s=0;s<3;s++)i[3*t[r+s]+0]=i[3*t[r+s]+0]+o[0],i[3*t[r+s]+1]=i[3*t[r+s]+1]+o[1],i[3*t[r+s]+2]=i[3*t[r+s]+2]+o[2]}for(r=0;r<e.length;r+=3){var l=[];l[0]=i[r+0],l[1]=i[r+1],l[2]=i[r+2];var h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);0==h&&(h=1),l[0]=l[0]/h,l[1]=l[1]/h,l[2]=l[2]/h,i[r+0]=l[0],i[r+1]=l[1],i[r+2]=l[2]}return new Float32Array(i)}});var Ce=function(){var e,t,i,r,a,n,o,s,l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=(o=arguments[0]).width,t=o.height,i=o.depth,r=o.segmentsW,a=o.segmentsH,n=o.segmentsD,l=o.wrapMode,s=o.id):arguments[0]instanceof se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5],n=arguments[6],l=arguments[7]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],l=arguments[6],s=arguments[7]),this.width=e||1,this.height=t||1,this.depth=i||1,this.segmentsW=r||1,this.segmentsH=a||1,this.segmentsD=n||1,this.wrapMode=(l||"").toLowerCase(),this.materialSize=null==this.wrapMode||""==this.wrapMode?6:1,this.offset=new he(0,0,0),this._id=s,se.Entity.call(this)};se.Cube=Ce,se.extend(se.Cube,se.Entity,{__accessor:["width","height","depth","wrapMode"],__SizePropeties:["width","height","depth","wrapMode"],className:"TGL.Cube",getUVs:function(){return this.uvs},setPropertyValue:function(e,t){if(this[e]===t)return!1;if(this[e]=t,"wrapMode"===e){var i=this.wrapMode,r="six-each"==i||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i,a=null==this.wrapMode||""==this.wrapMode?6:1;this.setMaterialSize(a),r||(this[e]="")}return!0},getLinkOffset:function(e){e.length();e.normalize();var t=e.x/this.getWidth(),i=e.y/this.getHeight(),r=e.z/this.getDepth(),a=Math.max(Math.abs(t),Math.abs(i),Math.abs(r));return a==Math.abs(t)?new he(this.getWidth()/2*(t<0?-1:1),0,0):a==Math.abs(i)?new he(0,this.getHeight()/2*(i<0?-1:1),0):new he(0,0,this.getDepth()/2*(r<0?-1:1))},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new mono.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new ue).getInverse(t)))},computeData:function(){var e=ye.buildCubeData(this.width,this.height,this.depth,this.segmentsW,this.segmentsH,this.segmentsD,this.wrapMode,this.offset||new he(0,0,0));return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},getSideIndexMapping:function(){return this.wrapMap?null:se.Cube.SideIndexMapping},generatePrimitiveKey:function(){return"cube_"+this.width+"_"+this.height+"_"+this.depth+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.segmentsD+"_"+(this.material instanceof se.ArrayMaterial?1:0)+"_"+this.wrapMode+"_"+this.offset.x+"_"+this.offset.y+"_ "+this.offset.z+"_"+se.Utils.toString(this.getMaterialMapping())},serialize:function(e){var t=e;1!==this.width&&t.serializeSimple("p","width",this.width,"number"),1!==this.height&&t.serializeSimple("p","height",this.height,"number"),1!==this.depth&&t.serializeSimple("p","depth",this.depth,"number"),1!==this.widthSegemtns&&t.serializeSimple("p","widthSegemtns",this.widthSegemtns,"number"),1!==this.heightSegments&&t.serializeSimple("p","heightSegments",this.heightSegments,"number"),1!==this.depthSegments&&t.serializeSimple("p","depthSegments",this.depthSegments,"number"),se.Element.serialize.call(this,t)}}),Ce.SideIndexMapping={right:0,left:1,top:2,bottom:3,front:4,back:5},se.Sphere=function(){var e,i,r,a,n,o,s;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var l=arguments[0];e=l.radius,i=l.segmentsW,r=l.segmentsH,a=l.longitudeStart,n=l.longitudeLength,o=l.latitudeStart,this._id=l.id}else arguments[0]instanceof se.Material?(this.material=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6],s=arguments[7]):(e=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],o=arguments[5],s=arguments[6]);this.radius=e||50,this.segmentsW=Math.max(3,Math.floor(i)||22),this.segmentsH=Math.max(2,Math.floor(r)||15),this.longitudeStart=a!==t?a:0,this.longitudeLength=n!==t?n:2*Math.PI,this.latitudeStart=o!==t?o:0,this.latitudeLength=s!==t?s:Math.PI,this.materialSize=1,se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},se.extend(se.Sphere,se.Entity,{constructor:se.Sphere,__accessor:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],__SizePropeties:["radius","segmentsW","segmentsH","latitudeStart","latitudeLength","longitudeStart","longitudeLength"],className:"TGL.Sphere",computeData:function(){var e=ye.bsd(this.radius,this.segmentsW,this.segmentsH,this.longitudeStart,this.longitudeLength,this.latitudeStart,this.latitudeLength);return this.vertices=e.vertices,this.uvs=e.uvs,this.faces=e.faces,this.data=e,e},generatePrimitiveKey:function(){return"sphere_"+this.radius+"_"+this.segmentsW+"_"+this.segmentsH+"_"+this.longitudeStart+"_"+this.longitudeLength+"_"+this.latitudeStart+"_"+this.latitudeLength},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new se.BoundingSphere(new se.Vec3,this.radius))},getLinkOffset:function(e){e.length();return e.normalize(),e.multiplyScalar(this.radius)},serialize:function(e){var t=e;50!==this.radius&&t.serializeSimple(et,"radius",this.radius,"number"),24!==this.widthSegments&&t.serializeSimple(et,"widthSegments",this.widthSegments,"number"),18!==this.heightSegments&&t.serializeSimple(et,"heightSegments",this.heightSegments,"number"),0!==this.phiStart&&t.serializeSimple(et,"phiStart",this.phiStart,"number"),this.phiLength!==2*Math.PI&&t.serializeSimple(et,"phiLength",this.phiLength,"number"),0!==this.thetaStart&&t.serializeSimple(et,"thetaStart",this.thetaStart,"number"),this.thetaLength!==Math.PI&&t.serializeSimple(et,"thetaLength",this.thetaLength,"number")}}),se.Plane=function(){var e,t,i,r;arguments[0]instanceof se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3]),this.width=e||5,this.height=t||5,this.segmentsW=i||1,this.segmentsH=r||1,this.vertices=[],this.faces=[],this.uvs=[],this.uv2s=[],this.materialSize=1,this.computeData=function(){var e,t,i=this.width/2,r=this.height/2,a=this.segmentsW,n=this.segmentsH,o=a+1,s=n+1,l=this.width/a,h=this.height/n,c=new se.Vec3(0,0,1),u={vertices:[],faces:[],uvs:[]};for(t=0;t<s;t++)for(e=0;e<o;e++){var f=e*l-i,p=t*h-r;u.vertices.push(new se.Vec3(f,-p,0))}for(t=0;t<n;t++)for(e=0;e<a;e++){var d=e+o*t,m=e+o*(t+1),g=e+1+o*(t+1),y=e+1+o*t,v=new se.Vec2(e/a,1-t/n),x=new se.Vec2(e/a,1-(t+1)/n),A=new se.Vec2((e+1)/a,1-(t+1)/n),_=new se.Vec2((e+1)/a,1-t/n),w=new se.Face4(d,m,g,y);w.normal.copy(c),w.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone()),u.faces.push(w),u.uvs.push([v,x,A,_])}return u},se.Entity.call(this),this.computeCentroids()},se.extend(se.Plane,se.Entity,{constructor:se.Plane,className:"TGL.Plane",__accessor:["width","height","segmentsW","segmentsH"],__SizePropeties:["width","height","segmentsW","segmentsH"],clone:function(){var e=new se.Plane(this.material,this.width,this.height,this.segmentsW,this.segmentsH);return this.superClass.clone.call(this,e),e},getSelectStyle:function(){var e=this.getStyle("select.style");return"outline.normal"!=e&&"outline"!=e||(e="outline.wireframe"),e}}),se.Cylinder=function(){var e,i,r,a,n,o,s,l,h;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],e=options.radiusTop,i=options.radiusBottom,r=options.height,a=options.segmentsR,n=options.segmentsH,o=options.openTop,s=options.openBottom,l=options.arcLength,h=options.arcStart,this._id=options.id):arguments[0]instanceof se.Material?(this.material=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4],n=arguments[5],o=arguments[6],s=arguments[7],l=arguments[8],h=arguments[9]):(e=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],o=arguments[5],s=arguments[6],l=arguments[7],h=arguments[8]),this.radiusTop=e=e!==t?e:20,this.radiusBottom=i=i!==t?i:20,this.height=r=r!==t?r:100,this.segmentsR=a=a||20,this.segmentsH=n=n||1,this.openTop=o!==t&&o,this.openBottom=s!=t&&s,this.arcLength=l!==t?l:2*Math.PI,this.arcStart=h!==t?h:0,this.materialSize=3,se.Entity.call(this),this.computeNodeData(),this.computeCentroids(),this.computeFaceNormals()},se.extend(se.Cylinder,se.Entity,{constructor:se.Cylinder,__accessor:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],__bool:["openTop","openBottom"],__SizePropeties:["radiusTop","radiusBottom","height","segmentsR","segmentsH","openTop","openBottom","arcLength","arcStart"],className:"TGL.Cylinder",computeData:function(){return ye.bcld(this.height,this.segmentsH,this.radiusBottom,this.radiusTop,this.segmentsR,this.openTop,this.openBottom,this.arcLength,this.arcStart)},getLinkOffset:function(e){var t=e.length();e.normalize();var i=e.x,r=e.y,a=e.z,n=Math.sqrt(i*i+a*a),o=r>0?this.radiusTop:this.radiusBottom;return Math.abs(r/n)>this.height/2/o&&t>0?new he(0,this.height/2*(r>0?1:-1),0):new he(i,0,a).normalize().multiplyScalar((this.radiusTop+this.radiusBottom)/2)},getLinkExtend:function(e){var t=this.worldMatrix.clone();return t=(new mono.Mat4).extractRotation(t),this.getLinkOffset(e.applyMatrix4((new ue).getInverse(t)))},clearLinkOrthogonal:function(e,t,i,r){r=r||0;var a=this.getHeight()/2+r,n=(this.radiusTop+this.radiusBottom)/2+r;return"orthogonal.x"==i||"orthogonal.x.n"==i?!(Math.abs(e.y-t.y)>a||Math.abs(e.z-t.z)>n):"orthogonal.y"==i||"orthogonal.y.n"==i?!(Math.abs(e.x-t.x)>n||Math.abs(e.z-t.z)>n):("orthogonal.z"==i||"orthogonal.z.n"==i)&&!(Math.abs(e.y-t.y)>a||Math.abs(e.z-t.z)>n)},clearLinkExtend:function(e,t){if("extend.x"===t);else if("extend.y"===t&&e>this.getHeight()/2)return!0;return!1},getSideIndexMapping:function(){return se.Cylinder.SideIndexMapping},generatePrimitiveKey:function(){return"cylinder_"+this.height+"_"+this.segmentsH+"_"+this.radiusTop+"_"+this.radiusBottom+"_"+this.segmentsR+"_"+this.openTop+"_"+this.openBottom+"_"+this.arcLength+"_"+this.arcStart+se.Utils.toString(this.getMaterialMapping())},needComputeVertexNormal:function(){return!1}}),se.Cylinder.SideIndexMapping={side:0,top:1,bottom:2},se.Circle=function(){var e,i,r,a;4===arguments.length?(e=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3]):(this.material=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.radius=e=e||50,this.segments=i=i!==t?Math.max(3,i):8,this.thetaStart=r=r!==t?r:0,this.thetaLength=a=a!==t?a:2*Math.PI,this.materialSize=1,se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new se.BoundingSphere(new se.Vec3,e)},se.extend(se.Circle,se.Entity,{clone:function(){var e=new se.Circle(this.material,this.radius,this.segments,this.thetaStart,this.thetaLength);return this.constructor.superClass.clone.call(this,e),e},computeData:function(){var e,t=this.segments,i=[],r=new se.Vec3,a=new se.Vec2(.5,.5),n={vertices:[],faces:[],uvs:[],uv2s:[]};for(n.vertices.push(r),i.push(a),e=0;e<=t;e++){var o=new se.Vec3,s=this.thetaStart+e/t*this.thetaLength;o.x=this.radius*Math.cos(s),o.y=this.radius*Math.sin(s),n.vertices.push(o),i.push(new se.Vec2((o.x/this.radius+1)/2,(o.y/this.radius+1)/2))}var l=new se.Vec3(0,0,1);for(e=1;e<=t;e++){var h=e,c=e+1;n.faces.push(new se.Face3(h,c,0,[l,l,l])),n.uvs.push([i[e],i[e+1],a])}return n}}),se.Torus=function(){var e,t,i,r,a;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],e=options.radius,t=options.tube,i=options.segmentsR,r=options.segmentsT,a=options.arc,this._id=options.id):arguments[0]instanceof se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.radius=e||100,this.tube=t||40,this.segmentsR=i||8,this.segmentsT=r||6,this.arc=a||2*Math.PI,se.Entity.call(this),this.computeNodeData(),this.computeCentroids()},se.extend(se.Torus,se.Entity,{__accessor:["radius","tube","segmentsR","segmentsT","arc"],__SizePropeties:["radius","tube","segmentsR","segmentsT","arc"],className:"TGL.Torus",generatePrimitiveKey:function(){return"torus_"+this.radius+"_"+this.tube+"_"+this.segmentsR+"_"+this.segmentsT+"_"+this.arc},computeData:function(){for(var e=new se.Vec3,t=[],i=[],r={vertices:[],faces:[],uvs:[],uv2s:[]},a=0;a<=this.segmentsR;a++)for(l=0;l<=this.segmentsT;l++){var n=l/this.segmentsT*this.arc,o=a/this.segmentsR*Math.PI*2;e.x=this.radius*Math.cos(n),e.y=this.radius*Math.sin(n);var s=new se.Vec3;s.x=(this.radius+this.tube*Math.cos(o))*Math.cos(n),s.y=(this.radius+this.tube*Math.cos(o))*Math.sin(n),s.z=this.tube*Math.sin(o),r.vertices.push(s),t.push(new se.Vec2(l/this.segmentsT,a/this.segmentsR)),i.push(s.clone().sub(e).normalize())}for(a=1;a<=this.segmentsR;a++)for(var l=1;l<=this.segmentsT;l++){var h=(this.segmentsT+1)*a+l-1,c=(this.segmentsT+1)*(a-1)+l-1,u=(this.segmentsT+1)*(a-1)+l,f=(this.segmentsT+1)*a+l,p=new se.Face3(h,c,f,[i[h],i[c],i[f]]);p.normal.add(i[h]),p.normal.add(i[c]),p.normal.add(i[f]),p.normal.normalize(),r.faces.push(p),r.uvs.push([t[h].clone(),t[c].clone(),t[f].clone()]),(p=new se.Face3(c,u,f,[i[c],i[u],i[f]])).normal.add(i[c]),p.normal.add(i[u]),p.normal.add(i[f]),p.normal.normalize(),r.faces.push(p),r.uvs.push([t[c].clone(),t[u].clone(),t[f].clone()])}return r}}),se.Arrow=function(){var e,t,i,r,a;arguments[0]instanceof se.Material?(this.material=arguments[0],e=arguments[1],t=arguments[2],i=arguments[3],r=arguments[4],a=arguments[5]):(e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],a=arguments[4]),this.materialSize=1,this.tailHeight=e||100,this.tailRadius=t||20,this.headHeight=i||20,this.headRadius=r||30,this.radiusSegments=a||30,se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},se.extend(se.Arrow,se.Entity,{constructor:se.Arrow,className:"TGL.Arrow",computeData:function(){var e=this.tailHeight,t=this.tailRadius,i=this.headHeight,r=this.headRadius,a=this.radiusSegments;this.headRadius<this.tailRadius&&(this.headRadius=this.tailRadius);var n,o,s=e+i,l=s/2,h=[],c=[],u=[],f=[];for(o=0;o<=2;o++){var p=[],d=[],m=(g=o/2)*r;for(n=0;n<=a;n++){y=n/a;(v=new se.Vec3).x=m*Math.sin(y*Math.PI*2),v.y=-g*i+l,v.z=m*Math.cos(y*Math.PI*2),this.vertices.push(v),p.push(this.vertices.length-1),d.push(new se.Vec2(y,1-g))}h.push(p),u.push(d)}for(this.vertices.push(new se.Vec3(0,l-i,0)),o=0;o<=2;o++){var p=[],d=[],g=o/2,m=t;for(n=0;n<=a;n++){var y=n/a,v=new se.Vec3;v.x=m*Math.sin(y*Math.PI*2),v.y=-g*e+l-i,v.z=m*Math.cos(y*Math.PI*2),this.vertices.push(v),p.push(this.vertices.length-1),d.push(new se.Vec2(y,1-g))}c.push(p),f.push(d)}this.vertices.push(new se.Vec3(0,-l,0));R=this.headRadius/s;for(n=0;n<a;n++)for(D=this.vertices[h[0][n]].clone(),L=this.vertices[h[0][n+1]].clone(),D.setY(Math.sqrt(D.x*D.x+D.z*D.z)*R).normalize(),L.setY(Math.sqrt(L.x*L.x+L.z*L.z)*R).normalize(),o=0;o<2;o++){var x=h[o][n],A=h[o+1][n],_=h[o+1][n+1],w=h[o][n+1],b=D.clone(),M=D.clone(),S=L.clone(),P=L.clone(),C=u[o][n].clone(),T=u[o+1][n].clone(),E=u[o+1][n+1].clone(),z=u[o][n+1].clone();this.faces.push(new se.Face3(x,A,w,[b,M,P])),this.uvs.push([C,T,z]),this.faces.push(new se.Face3(A,_,w,[M,S,P])),this.uvs.push([T,E,z])}for(n=0;n<a;n++){var x=h[o][n+1],A=h[o][n],_=h.length-1,b=new se.Vec3(0,-1,0),M=new se.Vec3(0,-1,0),S=new se.Vec3(0,-1,0),C=u[o][n+1].clone(),T=u[o][n].clone(),E=new se.Vec2(T.u,1);this.faces.push(new se.Face3(x,A,_,[b,M,S])),this.uvs.push([C,T,E])}var D,L,R=0;for(n=0;n<a;n++)for(D=this.vertices[c[1][n]].clone(),L=this.vertices[c[1][n+1]].clone(),D.setY(Math.sqrt(D.x*D.x+D.z*D.z)*R).normalize(),L.setY(Math.sqrt(L.x*L.x+L.z*L.z)*R).normalize(),o=0;o<2;o++){var x=c[o][n],A=c[o+1][n],_=c[o+1][n+1],w=c[o][n+1],b=D.clone(),M=D.clone(),S=L.clone(),P=L.clone(),C=u[o][n].clone(),T=u[o+1][n].clone(),E=u[o+1][n+1].clone(),z=u[o][n+1].clone();this.faces.push(new se.Face3(x,A,w,[b,M,P])),this.uvs.push([C,T,z]),this.faces.push(new se.Face3(A,_,w,[M,S,P])),this.uvs.push([T,E,z])}for(n=0;n<a;n++){var x=c[o][n+1],A=c[o][n],_=c.length-1,b=new se.Vec3(0,-1,0),M=new se.Vec3(0,-1,0),S=new se.Vec3(0,-1,0),C=f[o][n+1].clone(),T=f[o][n].clone(),E=new se.Vec2(T.u,1);this.faces.push(new se.Face3(x,A,_,[b,M,S])),this.uvs.push([C,T,E])}return this}}),se.BufferNode=function(){this.uuid=se.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.materialSize=1,this.createMaterial(),se.Node.call(this)},se.extend(se.BufferNode,se.Node,{constructor:se.BufferNode,compuateBufferData:function(){if(!this.computed){var e=this.attributes.position;e&&e.array&&(e.itemSize=3,e.numItems=e.array.length,this.verticesNeedUpdate=!0);var t=this.attributes.uv;t&&t.array&&(t.itemSize=2,t.numItems=t.array.length,this.uvsNeedUpdate=!0);var i=this.attributes.index;i&&i.array&&(this.offsets=[{index:0,start:0,count:i.array.length}]),this.computed=!0}},applyMatrix:function(e){var i,r;this.attributes.position&&(i=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),i!==t&&(e.multiplyVec3Array(i),this.verticesNeedUpdate=!0),r!==t&&((new se.Matrix3).getNormalMatrix(e).multiplyVec3Array(r),this.normalizeNormals(),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new se.BoundingBox);var e=this.attributes.position.array;if(e){var i,r,a,n=this.boundingBox;e.length>=3&&(n.min.x=n.max.x=e[0],n.min.y=n.max.y=e[1],n.min.z=n.max.z=e[2]);for(var o=3,s=e.length;o<s;o+=3)i=e[o],r=e[o+1],a=e[o+2],i<n.min.x?n.min.x=i:i>n.max.x&&(n.max.x=i),r<n.min.y?n.min.y=r:r>n.max.y&&(n.max.y=r),a<n.min.z?n.min.z=a:a>n.max.z&&(n.max.z=a)}e!==t&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new se.BoundingBox,t=new se.Vec3;return function(){null===this.boundingSphere&&(this.boundingSphere=new se.BoundingSphere);var i=this.attributes.position.array;if(i){for(var r=this.boundingSphere.center,a=[],n=0,o=i.length;n<o;n+=3)t.set(i[n],i[n+1],i[n+2]),a.push(t);e.setFromPoints(a),e.center(r);for(var s=0,n=0,o=i.length;n<o;n+=3)t.set(i[n],i[n+1],i[n+2]),s=Math.max(s,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,i,r,a,n=this.attributes.position.array.length;if(this.attributes.normal===t)this.attributes.normal={itemSize:3,array:new Float32Array(n)};else for(e=0,i=this.attributes.normal.array.length;e<i;e++)this.attributes.normal.array[e]=0;var o,s,l,h,c,u,f=this.attributes.position.array,p=this.attributes.normal.array,d=new se.Vec3,m=new se.Vec3,g=new se.Vec3,y=new se.Vec3,v=new se.Vec3;if(this.attributes.index){var x=this.attributes.index.array,A=this.offsets;for(r=0,a=A.length;r<a;++r){var _=A[r].start,w=A[r].count,b=A[r].index;for(e=_,i=_+w;e<i;e+=3)o=b+x[e],s=b+x[e+1],l=b+x[e+2],h=f[3*o],c=f[3*o+1],u=f[3*o+2],d.set(h,c,u),h=f[3*s],c=f[3*s+1],u=f[3*s+2],m.set(h,c,u),h=f[3*l],c=f[3*l+1],u=f[3*l+2],g.set(h,c,u),y.subVectors(g,m),v.subVectors(d,m),y.cross(v),p[3*o]+=y.x,p[3*o+1]+=y.y,p[3*o+2]+=y.z,p[3*s]+=y.x,p[3*s+1]+=y.y,p[3*s+2]+=y.z,p[3*l]+=y.x,p[3*l+1]+=y.y,p[3*l+2]+=y.z}}else for(e=0,i=f.length;e<i;e+=9)h=f[e],c=f[e+1],u=f[e+2],d.set(h,c,u),h=f[e+3],c=f[e+4],u=f[e+5],m.set(h,c,u),h=f[e+6],c=f[e+7],u=f[e+8],g.set(h,c,u),y.subVectors(g,m),v.subVectors(d,m),y.cross(v),p[e]=y.x,p[e+1]=y.y,p[e+2]=y.z,p[e+3]=y.x,p[e+4]=y.y,p[e+5]=y.z,p[e+6]=y.x,p[e+7]=y.y,p[e+8]=y.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,r,a=this.attributes.normal.array,n=0,o=a.length;n<o;n+=3)e=a[n],t=a[n+1],i=a[n+2],r=1/Math.sqrt(e*e+t*t+i*i),a[n]*=r,a[n+1]*=r,a[n+2]*=r},clone:function(){var e=new se.BufferNode,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var i in this.attributes){for(var r=this.attributes[i],a=r.array,n={itemSize:r.itemSize,numItems:r.numItems,array:null},o=0,s=t.length;o<s;o++){var l=t[o];if(a instanceof l){n.array=new l(a);break}}e.attributes[i]=n}for(var o=0,s=this.offsets.length;o<s;o++){var h=this.offsets[o];e.offsets.push({start:h.start,index:h.index,count:h.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}}),se.Particle=function(e,t,i){var r;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])&&(r=arguments[0],this._id=r.id),se.Node.call(this,this._id),this.material=new se.ParticleMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1,this.vertices=(r?r.vertices:e)||[],this.colors=(r?r.colors:t)||[],this.sizes=(r?r.sizes:i)||[],this.setUpdateFlags(!0)},se.extend(se.Particle,se.Node,{clone:function(e){return e===t&&(e=new se.Particle(this.material)),e.sortParticles=this.sortParticles,e.frustumCulled=this.frustumCulled,se.Element.prototype.clone.call(this,e),e},needUpdate:function(){return!1},setUpdateFlags:function(e){this.verticesNeedUpdate=e,this.dirtyColors=e,this.normalsNeedUpdate=e},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)}}),se.Line=function(e){this.material=new se.LineMaterial({color:16777215}),se.Node.call(this,e),this.type=this.type!==t?this.type:se.LineStrip},se.LineStrip=0,se.LinePieces=1,se.extend(se.Line,se.Node,{className:"TGL.Line",__accessor:["vertices","type","colors"],__SizePropeties:["vertices","type","colors"],clone:function(e){return e===t&&(e=new se.Line(this.material,this.type)),se.Element.prototype.clone.call(this,e,!0),e},onPropertyChange:function(e,t,i){},setMaterialStyle:function(e,t){e=e.substr(e.indexOf(".")+1),this._A97(this.material,e,t)},setMaterialStyles:function(e){se.Element.prototype.setMaterialStyles.call(this,e)}}),se.Line.createEllipse=function(e,t,i,r,a,n,o){"number"==typeof e?(o=n,n=a,a=r,r=i,i=t,t=e,e=new se.Line):null==e&&(e=new se.Line);for(var s=new se.EllipseCurve(0,0,t,i,a,n,o),l=[],h=r||50,c=0;c<=h;c++){var u=s.getPoint(c/h);l.push(u)}return e.setVertices(l),e},se.Line.createHelix=function(e,t,i,r,a,n){"number"==typeof e?(n=a,a=r,r=i,i=t,t=e,e=new se.Line):null==e&&(e=new se.Line);var o=[],s=n||50;a=a||1;for(var l,h,c,u,f=0;f<=s;f++)l=(i*f+t*(s-f))/s,c=a*Math.PI*2*f/s,h=r*(.5-f/s),u=new he(l*Math.sin(c),h,l*Math.cos(c)),o.push(u);return e.setVertices(o),e},se.Line.createRectangle=function(e,t,i,r){"number"==typeof e?(r=i||1,i=t,t=e,e=new se.Line):null==e&&(e=new se.Line);var a=r||50,n=2*(t+i)/a,o=[];if(n>Math.min(t,i))o.push(new he(-t/2,-i/2,0)),o.push(new he(-t/2,i/2,0)),o.push(new he(t/2,i/2,0)),o.push(new he(t/2,-i/2,0)),o.push(new he(-t/2,-i/2,0));else for(var s,l=-t/2,h=-i/2,c=0;c<=a;c++)l==-t/2&&h<i/2?h+n<=i/2?h+=n:(o.push(new he(-t/2,i/2,0)),o.push(new he(-t/2,i/2,0)),l+=h+n-i/2,h=i/2):h==i/2&&l<=t/2?l+n<=t/2?l+=n:(o.push(new he(t/2,i/2,0)),o.push(new he(t/2,i/2,0)),h-=l+n-t/2,l=t/2):l==t/2&&h>-i/2?h-n>=-i/2?h-=n:(o.push(new he(t/2,-i/2,0)),o.push(new he(t/2,-i/2,0)),l-=-i/2-h+n,h=-i/2):h==-i/2&&l>=-t/2&&(l-n>=-t/2?l-=n:(h+=-t/2-l+n,l=-t/2)),s=new he(l,h,0),o.push(s);return e.setVertices(o),e},se.Line.createNurbs=function(e,t,i,r,a){if("[object Array]"===toString.apply(e)?(a=r,r=i,i=t,t=e,e=new se.Line):null==e&&(e=new se.Line),a){var n=e.material;n.skyY=a.skyY||0,n.horizonY=a.horizonY||0,n.earthY=a.earthY||0,n.skyColor=a.skyColor||new mono.Color(16777215),n.horizonColor=a.horizonColor||new mono.Color(16777215),n.earthColor=a.earthColor||new mono.Color(16777215)}i>t.length-1&&(console.log("max degree is :",t.length-1),i=t.length-1);for(var o=[],s=0;s<=i;s++)o.push(0);for(var s=0,l=t.length;s<l;s++){var h=(s+1)/(l-i);o.push(mono.Math.clamp(h,0,1))}var c=new mono.NurbsCurve(i,o,t);return e.setVertices(c.getPoints(t.length*r)),e},se.Line.createDottedLine=function(e,t,i,r){e instanceof Array?(i=t,t=e,e=new se.Line):null==e&&(e=new se.Line);for(var a=[],n=t[0],o=1;o<t.length;o++){var s=t[o],r=s.distanceTo(n)/(i[0]+i[1])||20,l=n.x,h=n.y,c=n.z,u=(s.x-l)/r,f=(s.y-h)/r,p=(s.z-c)/r,d=i[0]/(i[0]+i[1]),m=u*d,g=f*d,y=p*d;a.push(new mono.Vec3(l,h,c));for(var v=0;v<r;v++){var x=l+v*u,A=h+v*f,_=c+v*p;a.push(new mono.Vec3(x,A,_));var x=l+v*u+m,A=h+v*f+g,_=c+v*p+y;a.push(new mono.Vec3(x,A,_))}n=s}return e.setVertices(a),e},se.LineX=function(){var e,t,i;if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.points,t=r.colors,i=r.lineWidth,this._id=r.id||this._id}else e=arguments[0],t=arguments[1],i=arguments[2];this.material=new se.LineXMaterial({color:16777215}),this.points=e||[],this.colors=t||[],this.lineWidth=i||1,se.Entity.call(this,this.material,this._id)},se.extend(se.LineX,se.Entity,{__accessor:["points","colors","lineWidth"],__SizePropeties:["points","colors","lineWidth"],computeData:function(){var e=this.points,t=this.colors,i={vertices:[],verticesPrev:[],verticesNext:[],offset:[],faces:[]},r=t.length;0!=r&&(i.colors=[]);for(var a=e.length,n=i.vertices,o=i.verticesPrev,s=i.verticesNext,l=i.offset,h=i.faces,c=this.lineWidth,u=0;u<a;u++){var f=e[u],p=new he(f.x,f.y,f.z);if(n.push(p),n.push(p.clone()),l.push(c/2),l.push(-c/2),i.colors){var d=t[Math.floor(u*r/a)];d instanceof se.Color||(d=new se.Color(d)),i.colors.push(d),i.colors.push(d.clone())}}for(u=0;u<a;u++){var m=(v=2*u)>=2?v-2:0,g=v<a-2?v+2:2*a-1,p=n[m];o.push(p.clone()),o.push(p.clone()),p=n[g],s.push(p.clone()),s.push(p.clone())}var y=a-1;for(u=0;u<y;u++){var v=2*u,x=new Se(v,v+1,v+2);x.materialIndex=0,h.push(x),(x=new Se(v+2,v+1,v+3)).materialIndex=0,h.push(x)}return i},needComputeVertexNormal:function(){return!1}}),se.PathLine=function(){var e,t,i;if(1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof se.Path)){var r=arguments[0];e=r.path,t=r.segments,i=r.type,this._id=r.id||this._id}else e=arguments[0],t=arguments[1],i=arguments[2],this._id=arguments[3];se.Line.call(this,{vertices:[],colors:[],type:i,id:this._id}),this.segments=t||20,this.setPath(e)},se.extend(se.PathLine,se.Line,{constructor:se.PathLine,className:"TGL.PathLine",__accessor:["path","segments"],__SizePropeties:["path","segments"],onPropertyChange:function(){this.computeNodeData()},computeNodeData:function(){this.computeData()},adjustPath:function(e){return e},computeData:function(){var e=this.path;if(e){var t,i,r,a,n=(e=this.adjustPath(e)).curves.length,o=e.curves,s=[],l=e.getLength(),h=0,c=this.segments;for(m=0;m<n;m++){if(i=o[m],r=i.getLength(),i instanceof se.LineCurve3){var u=h/l,f=(r+h)/l;s.push(u),s.push(f)}else for(a=m>0?1:0;a<=c;a++){var p=(r*a/c+h)/l;s.push(p)}h+=r}for(var d=[],m=0;m<s.length;m++)t=s[m],pos=e.getPointAt(t),d.push(pos);return this.vertices=d,[]}}}),se.Polyhedron=function(){function e(e){var t=e.normalize().clone();t.index=h.vertices.push(t)-1;var a=i(e)/2/Math.PI+.5,n=r(e)/Math.PI+.5;return t.uv=new se.Vec3(a,1-n),t}function t(e,t,r){var n=new se.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);n.centroid.add(e).add(t).add(r).divideScalar(3),h.faces.push(n);var o=i(n.centroid);h.uvs.push([a(e.uv,e,o),a(t.uv,t,o),a(r.uv,r,o)])}function i(e){return Math.atan2(e.z,-e.x)}function r(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function a(e,t,i){return i<0&&1===e.x&&(e=new se.Vec3(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new se.Vec3(i/2/Math.PI+.5,e.y)),e.clone()}var n,o,s,l;arguments[0]instanceof se.Material?(this.material=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],l=arguments[4]):(n=arguments[0],o=arguments[1],s=arguments[2],l=arguments[3]),this.materialSize=1,se.Entity.call(this),s=s||1,l=l||0;for(var h=this,c=0,u=n.length;c<u;c++)e(new se.Vec3(n[c][0],n[c][1],n[c][2]));for(var f=this.vertices,p=[],c=0,u=o.length;c<u;c++){var d=f[o[c][0]],m=f[o[c][1]],g=f[o[c][2]];p[c]=new se.Face3(d.index,m.index,g.index,[d.clone(),m.clone(),g.clone()])}for(var c=0,u=p.length;c<u;c++)!function(i,r){for(var a=Math.pow(2,r),n=(Math.pow(4,r),e(h.vertices[i.a])),o=e(h.vertices[i.b]),s=e(h.vertices[i.c]),l=[],c=0;c<=a;c++){l[c]=[];for(var u=e(n.clone().lerp(s,c/a)),f=e(o.clone().lerp(s,c/a)),p=a-c,d=0;d<=p;d++)l[c][d]=0==d&&c==a?u:e(u.clone().lerp(f,d/p))}for(c=0;c<a;c++)for(d=0;d<2*(a-c)-1;d++){var m=Math.floor(d/2);d%2==0?t(l[c][m+1],l[c+1][m],l[c][m]):t(l[c][m+1],l[c+1][m+1],l[c+1][m])}}(p[c],l);for(var c=0,u=this.uvs.length;c<u;c++){var y=this.uvs[c],v=y[0].x,x=y[1].x,A=y[2].x,_=Math.max(v,Math.max(x,A)),w=Math.min(v,Math.min(x,A));_>.9&&w<.1&&(v<.2&&(y[0].x+=1),x<.2&&(y[1].x+=1),A<.2&&(y[2].x+=1))}for(var c=0,u=this.vertices.length;c<u;c++)this.vertices[c].multiplyScalar(s);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new se.BoundingSphere(new se.Vec3,s)},se.extend(se.Polyhedron,se.Entity,{}),se.Octahedron=function(e,t,i){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],a=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];se.Polyhedron.call(this,e,r,a,t,i)},se.extend(se.Octahedron,se.Polyhedron,{clone:function(){return new se.Octahedron(this.material,this.radius,this.detail)}}),se.Axis=function(e){var t=e&&e.size||1,i=[],r=[];i.push(new se.Vec3,new se.Vec3(t,0,0),new se.Vec3,new se.Vec3(0,t,0),new se.Vec3,new se.Vec3(0,0,t)),r.push(new se.Color(16711680),new se.Color(16711680),new se.Color(65280),new se.Color(65280),new se.Color(255),new se.Color(255));var a=new se.LineMaterial({vertexColors:se.VertexColors,depthTest:!1,depthMask:!1});se.Line.call(this,{vertices:i,colors:r,type:se.LinePieces,size:t}),this.material=a,this.xAxisText=this.makeAxisText("X",16711680),this.yAxisText=this.makeAxisText("Y",65280),this.zAxisText=this.makeAxisText("Z",255),this.xAxisText.setParent(this),this.yAxisText.setParent(this),this.zAxisText.setParent(this),this.xAxisText.setPosition(t,0,0),this.yAxisText.setPosition(0,t,0),this.zAxisText.setPosition(0,0,t),this._sizeFixed=!0},se.extend(se.Axis,se.Line,{showAxisText:function(e){this.xAxisText._visible=e,this.yAxisText._visible=e,this.zAxisText._visible=e},setSize:function(e){this.vertices[1].x=e,this.vertices[3].y=e,this.vertices[5].z=e},fixSize:function(e){se.Element.prototype.fixSize.call(this,e);this._scale.x,this._scale.y,this._scale.z;this.xAxisText.setScale(3,3,1),this.yAxisText.setScale(3,3,1),this.zAxisText.setScale(3,3,1)},makeAxisText:function(e,t){var i=se.BillboardAlignment.topLeft,r=document.createElement("canvas"),a=r.getContext("2d");a.font="Bold 36px Arial",t instanceof se.Color||(t=new se.Color(t));var n=a.measureText(e).width;r.width=Ee.nextPowerOfTwo(n),r.height=Ee.nextPowerOfTwo(2*a.measureText("e").width+4),a.fillStyle="rgba("+255*t.r+", "+255*t.g+", "+255*t.b+", 1.0)",a.fillText(e,0,10);var o=new se.Texture(r),s=new se.BillboardMaterial({map:o,useScreenCoordinates:!1,alignment:i,depthTest:!1,depthMask:!1}),l=new se.Billboard;return l.material=s,l}}),se.Curve=function(){},se.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},se.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},se.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},se.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},se.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},se.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],a=this.getPoint(0),n=0;for(r.push(0),i=1;i<=e;i++)n+=(t=this.getPoint(i/e)).distanceTo(a),r.push(n),a=t;return this.cacheArcLengths=r,r},se.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},se.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),a=0,n=r.length;i=t||e*r[n-1];for(var o,s=0,l=n-1;s<=l;)if(a=Math.floor(s+(l-s)/2),(o=r[a]-i)<0)s=a+1;else{if(!(o>0)){l=a;break}l=a-1}if(a=l,r[a]==i)return c=a/(n-1);var h=r[a],c=(a+(i-h)/(r[a+1]-h))/(n-1);return c},se.Curve.prototype.getTangent=function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},se.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},se.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,a){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*a},tangentSpline:function(e,t,i,r,a){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,a){var n=.5*(i-e),o=.5*(r-t),s=a*a;return(2*t-2*i+n+o)*(a*s)+(-3*t+3*i-2*n-o)*s+n*a+t}},se.Curve.create=function(e,t){return e.prototype=Object.create(se.Curve.prototype),e.prototype.getPoint=t,e},se.LineCurve=function(e,t){this.v1=e,this.v2=t},se.LineCurve.prototype=Object.create(se.Curve.prototype),se.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},se.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},se.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},se.LineCurve3=function(e,t){this.v1=e,this.v2=t,this.getPoint=function(e){var t=new se.Vec3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}},se.extend(se.LineCurve3,se.Curve,{}),se.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},se.CurvePath.prototype=Object.create(se.Curve.prototype),se.CurvePath.prototype.add=function(e){this.curves.push(e)},se.CurvePath.prototype.checkConnection=function(){},se.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new se.LineCurve3(t,e))},se.CurvePath.prototype.getPoint=function(e){for(var t,i,r=e*this.getLength(),a=this.getCurveLengths(),n=0;n<a.length;){if(a[n]>=r){var o=1-(t=a[n]-r)/(i=this.curves[n]).getLength();return i.getPointAt(o)}n++}return null},se.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},se.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,r=this.curves.length;for(e=0;e<r;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},se.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,a,n,o=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=a=Number.POSITIVE_INFINITY;var s,l,h,c,u=o[0]instanceof se.Vec3;for(c=u?new se.Vec3:new se.Vec2,l=0,h=o.length;l<h;l++)(s=o[l]).x>e?e=s.x:s.x<r&&(r=s.x),s.y>t?t=s.y:s.y<a&&(a=s.y),u&&(s.z>i?i=s.z:s.z<n&&(n=s.z)),c.add(s);var f={minX:r,minY:a,maxX:e,maxY:t,centroid:c.divideScalar(h)};return u&&(f.maxZ=i,f.minZ=n),f},se.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},se.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},se.CurvePath.prototype.createGeometry=function(e){for(var t=new se.Entity,i=0;i<e.length;i++)t.vertices.push(new se.Vec3(e[i].x,e[i].y,e[i].z||0));return t},se.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},se.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,a=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},se.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,a=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},se.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,a,n,o,s,l=this.getBoundingBox();for(i=0,r=e.length;i<r;i++){n=(a=e[i]).x,o=a.y,s=n/l.maxX,s=t.getUtoTmapping(s,n);var h=t.getPoint(s),c=t.getTangent(s);c.set(-c.y,c.x).multiplyScalar(o),a.x=h.x+c.x,a.y=h.y+c.y}return e},se.EllipseCurve=function(e,t,i,r,a,n,o){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=a||0,this.aEndAngle=n||2*Math.PI,this.aClockwise=o},se.EllipseCurve.prototype=Object.create(se.Curve.prototype),se.EllipseCurve.prototype.getPoint=function(e){var t,i=this.aEndAngle-this.aStartAngle;i<0&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-i):this.aStartAngle+e*i;var r=this.aX+this.xRadius*Math.cos(t),a=this.aY+this.yRadius*Math.sin(t);return new se.Vec3(r,a,0)},se.ArcCurve=function(e,t,i,r,a,n){se.EllipseCurve.call(this,e,t,i,i,r,a,n)},se.ArcCurve.prototype=Object.create(se.EllipseCurve.prototype),se.NurbsCurve=function(e,t,i){this.degree=e||3,this.knots=t||[],this.ctrlPoints=[];for(var r=0;r<i.length;++r){var a=i[r];this.ctrlPoints[r]=new se.Vec4(a.x,a.y,a.z,a.w)}},se.NurbsCurve.prototype=Object.create(se.Curve.prototype),se.NurbsCurve.prototype.constructor=se.NurbsCurve,se.NurbsCurve.prototype.getPoint=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=se.NurbsUtils.calcBSplinePoint(this.degree,this.knots,this.ctrlPoints,t);return 1!=i.w&&i.divideScalar(i.w),new se.Vec3(i.x,i.y,i.z)},se.NurbsCurve.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=se.NurbsUtils.calcNURBSDerivatives(this.degree,this.knots,this.ctrlPoints,t,1)[1].clone();return i.normalize(),i},se.NurbsSurface=function(e,t,i){this.degreeU=e,this.degreeV=t,this.knotsU=this.calculateKnots(e,i.length),this.knotsV=this.calculateKnots(t,i[0].length),this.ctlPoints=[];for(var r=i.length,a=i[0].length,n=0;n<r;++n){this.ctlPoints[n]=[];for(var o=0;o<a;++o){var s=i[n][o];this.ctlPoints[n][o]=new se.Vec4(s.x,s.y,s.z,s.w)}}},se.NurbsSurface.prototype={constructor:se.NurbsSurface,calculateKnots:function(e,t){for(var i=[],r=0;r<=e;r++)i.push(0);for(r=0;r<t;r++){var a=(r+1)/(t-e);i.push(mono.Math.clamp(a,0,1))}return i},getPoint:function(e,t){var i=this.knotsU[0]+e*(this.knotsU[this.knotsU.length-1]-this.knotsU[0]),r=this.knotsV[0]+t*(this.knotsV[this.knotsV.length-1]-this.knotsV[0]);return se.NurbsUtils.calcSurfacePoint(this.degreeU,this.degreeV,this.knotsU,this.knotsV,this.ctlPoints,i,r)}},se.Surface=function(e,t,i,r){this.parameters={func:function(t,i){return e.getPoint(t,i)},slices:t,stacks:i},this.ctrlCond=r,this.material=new se.SurfaceMaterial,se.Entity.call(this)},se.extend(se.Surface,se.Entity,{constructor:se.Surface,className:"TGL.Surface",createMaterial:function(e){a=new se.ArrayMaterial;this.material=a;for(var t=this.ctrlCond,i=this.getMaterialSize(),r=0;r<i;r++){var a=this.getDefaultMaterial(e,r);t&&(a.skyY=t.skyY||0,a.horizonY=t.horizonY||0,a.earthY=t.earthY||0,a.skyColor=t.skyColor||new mono.Color(16777215),a.horizonColor=t.horizonColor||new mono.Color(16777215),a.earthColor=t.earthColor||new mono.Color(16777215)),this.setMaterial(r,a)}},setMaterial:function(e,t,i){var r=t.getUniqueCode?t.getUniqueCode():null,a=at.getMaterial(r);a?(this.material.materials[e]=a,at.useMaterial(a)):(this.material.materials[e]=t,at.setMaterial(r,t),at.useMaterial(t)),at.unUseMaterial(i)},computeData:function(){var e={};e.faces=[],e.uvs=[],e.vertices=[];for(var t=this.parameters.stacks,i=this.parameters.slices,r=this.parameters.func,a=i+1,n=[],o=0;o<=t;o++){var s=o/t;for(j=0;j<=i;j++){var l=j/i,h=r(l,s);n.push(new le(l,s)),e.vertices.push(new he(h.x,h.y,h.z))}}var c,u,f,p;for(o=0;o<t;o++)for(j=0;j<i;j++){c=o*a+j,u=o*a+j+1,f=(o+1)*a+j+1,p=(o+1)*a+j;var d=new Pe(c,u,f,p),m=e.vertices[c].clone().sub(e.vertices[u].clone()),g=e.vertices[p].clone().sub(e.vertices[u].clone()),y=m.cross(g).normalize();d.normal.copy(y),e.faces.push(d),e.uvs.push([n[c],n[u],n[f],n[p]])}return e}}),se.LensFlare=function(e){var i,r,a,n,o,s;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(options=arguments[0],i=options.texture,r=options.size,a=options.distance,n=options.blending,o=options.color,s=options.opacity,options.id):arguments[0]instanceof se.Material?(this.material=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],n=arguments[4],o=arguments[5],s=arguments[6]):(i=arguments[0],r=arguments[1],a=arguments[2],n=arguments[3],o=arguments[4],s=arguments[5],arguments[6]),this.texture=i||null,this.size=r||-1,this.distance=a||0,this.blending=n||se.NormalBlending,this.color=o||new se.Color(16777215),this.opacity=s||1,this.material||(this.material=new se.Material),this.lensFlares=[],se.Node.apply(this,arguments),this.positionScreen=new he,this.customUpdateCallback=t,this.texture&&this.add(this.texture,this.size,this.distance,this.blending,this.color)},se.extend(se.LensFlare,se.Node,{isLensFlare:!0,add:function(e,i,r,a,n,o){i===t&&(i=-1),r===t&&(r=0),o===t&&(o=1),n===t&&(n=new se.Color(16777215)),a===t&&(a=se.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:i,distance:r,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:n,blending:a})},updateLensFlares:function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,a=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+a*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},copy:function(e){Cube.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);return this}}),se.Path=function(e){se.CurvePath.call(this),this.actions=[],this.points=[],e&&this.fromPoints(e)},se.extend(se.Path,se.CurvePath,{constructor:se.Path,className:"TGL.Path",serializeJsonValue:function(){return{actions:this.actions,class:"TGL.Path"}},deserializeJsonValue:function(e){var t,i,r,a;for(a=0;a<e.actions.length;a++)t=(i=e.actions[a]).action,r=i.args,this[t].apply(this,r)}}),se.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"curveTo",BEZIER_CURVE_TO:"bCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},se.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y,e[0].z);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y,e[t].z)},se.Path.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.lineTo(e.x,e.y,e.z)},se.Path.prototype.reverse=function(){var e,t,i,r,a,n=new se.Path,o=this.actions.length;for(e=o-1;e>=0;e--){if(t=this.actions[e].args,i=t.length,e===o-1&&n.moveTo(t[i-3],t[i-2],t[i-1]),null!=r)switch(a){case se.PathActions.MOVE_TO:n.moveTo(t[i-3],t[i-2],t[i-1]);break;case se.PathActions.LINE_TO:n.lineTo(t[i-3],t[i-2],t[i-1]);break;case se.PathActions.QUADRATIC_CURVE_TO:n.quadraticCurveTo(r[0],r[1],r[2],t[i-3],t[i-2],t[i-1]);break;case se.PathActions.BEZIER_CURVE_TO:n.bezierCurveTo(r[3],r[4],r[5],r[0],r[1],r[2],t[i-3],t[i-2],t[i-1])}r=t,a=this.actions[e].action}return n},se.Path.prototype.moveTo=function(e,t,i){e=e||0,t=t||0,i=i||0;var r=Array.prototype.slice.call(arguments);this.actions.push({action:se.PathActions.MOVE_TO,args:r}),this.points.push(new he(e,t,i))},se.Path.prototype.lineTo=function(e,t,i){e=e||0,t=t||0,i=i||0,this.actions&&1===this.actions.length&&(r=this.actions[0].args)[0]===e&&r[1]===t&&r[2]===i&&(console.log("TGL.Path:lineTo the same point of moveTo"),e+=.01);var r=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,n=a[a.length-3],o=a[a.length-2],s=a[a.length-1],l=new se.LineCurve3(new se.Vec3(n,o,s),new se.Vec3(e,t,i));this.curves.push(l),this.actions.push({action:se.PathActions.LINE_TO,args:r}),this.points.push(new he(e,t,i))},se.Path.prototype.quadraticCurveTo=function(e,t,i,r,a,n){e=e||0,t=t||0,i=i||0,r=r||0,a=a||0,n=n||0,this.actions&&1===this.actions.length&&(o=this.actions[0].args)[0]===r&&o[1]===a&&o[2]===n&&(console.log("TGL.Path:quadraticCurveTo the same point of moveTo"),r=.01);var o=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-3],h=s[s.length-2],c=s[s.length-1],u=new se.QuadraticBezierCurve3(new se.Vec3(l,h,c),new se.Vec3(e,t,i),new se.Vec3(r,a,n));this.curves.push(u),this.actions.push({action:se.PathActions.QUADRATIC_CURVE_TO,args:o}),this.points.push(new he(r,a,n))},se.Path.prototype.curveTo=se.Path.prototype.quadraticCurveTo,se.Path.prototype.bezierCurveTo=function(e,t,i,r,a,n,o,s,l){var h=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,u=c[c.length-3],f=c[c.length-2],p=c[c.length-1],d=new se.CubicBezierCurve3(new se.Vec3(u,f,p),new se.Vec3(e,t,i),new se.Vec3(r,a,n),new se.Vec3(o,s,l));this.curves.push(d),this.actions.push({action:se.PathActions.BEZIER_CURVE_TO,args:h}),this.points.push(new he(o,s,l))},se.Path.prototype.isClockwise=function(){if(this.points.length<2)return t;if(this.points.length<3){var e=this.points[0];return this.points[1].x>e.x}return se.Math.isClockwise(this.points)},se.Path.prototype.bCurveTo=se.Path.prototype.bezierCurveTo,se.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],a=i[i.length-1],n=[new se.Vec2(r,a)];Array.prototype.push.apply(n,e);var o=new se.SplineCurve(n);this.curves.push(o),this.actions.push({action:se.PathActions.CSPLINE_THRU,args:t})},se.Path.prototype.arc=function(e,t,i,r,a,n){var o=this.actions[this.actions.length-1].args,s=o[o.length-3],l=o[o.length-2];this.absarc(e+s,t+l,i,r,a,n)},se.Path.prototype.absarc=function(e,t,i,r,a,n){this.absellipse(e,t,i,i,r,a,n)},se.Path.prototype.ellipse=function(e,t,i,r,a,n,o){var s=this.actions[this.actions.length-1].args,l=s[s.length-3],h=s[s.length-2];this.absellipse(e+l,t+h,i,r,a,n,o)},se.Path.prototype.absellipse=function(e,t,i,r,a,n,o){var s=Array.prototype.slice.call(arguments),l=new se.EllipseCurve(e,t,i,r,a,n,o);this.curves.push(l);var h=l.getPoint(1);s.push(h.x),s.push(h.y),this.actions.push({action:se.PathActions.ELLIPSE,args:s})},se.Path.prototype.toArray=function(){var e,t=this.actions.length,i=[];for(e=0;e<t;e++){var r=this.actions[e];"moveTo"===r.action?(i.push("m"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"lineTo"===r.action?(i.push("l"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2])):"curveTo"===r.action&&(i.push("c"),i.push(r.args[0]),i.push(r.args[1]),i.push(r.args[2]),i.push(r.args[3]),i.push(r.args[4]),i.push(r.args[5]))}return i},se.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],r=0;r<e;r++)i.push(this.getPoint(r/e));return i},se.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,a,n,o,s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M=[];for(i=0,r=this.actions.length;i<r;i++)switch(a=this.actions[i],n=a.action,o=a.args,n){case se.PathActions.MOVE_TO:case se.PathActions.LINE_TO:M.push(new se.Vec3(o[0],o[1],o[2]));break;case se.PathActions.QUADRATIC_CURVE_TO:for(s=o[3],l=o[4],h=o[5],p=o[0],d=o[1],m=o[2],M.length>0?(g=(x=M[M.length-1]).x,y=x.y,v=x.z):(g=(x=this.actions[i-1].args)[x.length-3],y=x[x.length-2],v=x[x.length-1]),A=1;A<=e;A++)_=A/e,w=se.Shape.Utils.b2(_,g,p,s),b=se.Shape.Utils.b2(_,y,d,l),tz=se.Shape.Utils.b2(_,v,m,h),M.push(new se.Vec3(w,b,tz));break;case se.PathActions.BEZIER_CURVE_TO:for(s=o[6],l=o[7],h=o[8],p=o[0],d=o[1],m=o[2],c=o[3],u=o[4],f=o[5],M.length>0?(g=(x=M[M.length-1]).x,y=x.y,v=x.z):(g=(x=this.actions[i-1].args)[x.length-3],y=x[x.length-2],v=x[x.length-1]),A=1;A<=e;A++)_=A/e,w=se.Shape.Utils.b3(_,g,p,c,s),b=se.Shape.Utils.b3(_,y,d,u,l),tz=se.Shape.Utils.b3(_,v,m,f,h),M.push(new se.Vec3(w,b,tz));break;case se.PathActions.CSPLINE_THRU:x=this.actions[i-1].args;var S=[new se.Vec2(x[x.length-2],x[x.length-1])],P=e*o[0].length;S=S.concat(o[0]);var C=new se.SplineCurve(S);for(A=1;A<=P;A++)M.push(C.getPointAt(A/P));break;case se.PathActions.ARC:var T=o[0],E=o[1],z=o[2],D=o[3],L=o[4],R=!!o[5],N=L-D,B=2*e;for(A=1;A<=B;A++)_=A/B,R||(_=1-_),I=D+_*N,w=T+z*Math.cos(I),b=E+z*Math.sin(I),M.push(new se.Vec3(w,b));break;case se.PathActions.ELLIPSE:var I,T=o[0],E=o[1],F=o[2],V=o[3],D=o[4],L=o[5],R=!!o[6],N=L-D,B=2*e;for(A=1;A<=B;A++)_=A/B,R||(_=1-_),I=D+_*N,w=T+F*Math.cos(I),b=E+V*Math.sin(I),M.push(new se.Vec3(w,b))}var U=M[M.length-1];return Math.abs(U.x-M[0].x)<1e-10&&Math.abs(U.y-M[0].y)<1e-10&&M.splice(M.length-1,1),t&&M.push(M[0]),M},se.Path.prototype.toShapes=function(e){var i,r,a,n,o,s=[],l=new se.Path;for(i=0,r=this.actions.length;i<r;i++)o=(a=this.actions[i]).args,(n=a.action)==se.PathActions.MOVE_TO&&0!=l.actions.length&&(s.push(l),l=new se.Path),l[n].apply(l,o);if(0!=l.actions.length&&s.push(l),0==s.length)return[];var h,c,u,f=[];if(1==s.length)return c=s[0],u=new se.Shape,u.actions=c.actions,u.curves=c.curves,f.push(u),f;var p=!se.Shape.Utils.isClockWise(s[0].getPoints());if(p=e?!p:p)for(u=new se.Shape,i=0,r=s.length;i<r;i++)c=s[i],h=se.Shape.Utils.isClockWise(c.getPoints()),(h=e?!h:h)?(u.actions=c.actions,u.curves=c.curves,f.push(u),u=new se.Shape):u.holes.push(c);else{for(u=t,i=0,r=s.length;i<r;i++)c=s[i],h=se.Shape.Utils.isClockWise(c.getPoints()),(h=e?!h:h)?(u&&f.push(u),(u=new se.Shape).actions=c.actions,u.curves=c.curves):u.holes.push(c);f.push(u)}return f},se.Shape=function(){se.Path.apply(this,arguments),this.holes=[]},se.Shape.prototype=Object.create(se.Path.prototype),se.Shape.prototype.extrude=function(e){return new se.ShapeNode(this,e)},se.Shape.prototype.makeGeometry=function(e){return new se.ShapeGeometry(this,e)},se.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},se.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},se.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},se.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},se.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},se.Shape.Utils={removeHoles:function(e,t){var i,r,a,n,o,s,l,h,c,u,f,p,d,m,g,y,v=e.concat(),x=v.concat(),A=[];for(o=0;o<t.length;o++){for(l=t[o],Array.prototype.push.apply(x,l),h=Number.POSITIVE_INFINITY,s=0;s<l.length;s++){f=l[s];var _=[];for(u=0;u<v.length;u++)p=v[u],c=f.distanceToSquared(p),_.push(c),c<h&&(h=c,a=s,n=u)}i=n-1>=0?n-1:v.length-1,r=a-1>=0?a-1:l.length-1;var w=[l[a],v[n],v[i]],b=se.FontUtils.Triangulate.area(w),M=[l[a],l[r],v[n]],S=se.FontUtils.Triangulate.area(M),P=n,C=a;a+=-1,(n+=1)<0&&(n+=v.length),n%=v.length,a<0&&(a+=l.length),a%=l.length,i=n-1>=0?n-1:v.length-1,r=a-1>=0?a-1:l.length-1,w=[l[a],v[n],v[i]];var T=se.FontUtils.Triangulate.area(w);M=[l[a],l[r],v[n]],b+S>T+se.FontUtils.Triangulate.area(M)&&(a=C,(n=P)<0&&(n+=v.length),n%=v.length,a<0&&(a+=l.length),a%=l.length,i=n-1>=0?n-1:v.length-1,r=a-1>=0?a-1:l.length-1),d=v.slice(0,n),m=v.slice(n),g=l.slice(a),y=l.slice(0,a);var E=[l[a],v[n],v[i]],z=[l[a],l[r],v[n]];A.push(E),A.push(z),v=d.concat(g).concat(y).concat(m)}return{shape:v,isolatedPts:A,allpoints:x}},triangulateShape:function(e,i){var r,a,n,o,s,l,h=se.Shape.Utils.removeHoles(e,i),c=h.shape,u=h.allpoints,f=h.isolatedPts,p=se.FontUtils.Triangulate(c,!1),d={};for(r=0,a=u.length;r<a;r++)d[s=u[r].x+":"+u[r].y]!==t&&console.log("Duplicate point",s),d[s]=r;for(r=0,a=p.length;r<a;r++)for(o=p[r],n=0;n<3;n++)(l=d[s=o[n].x+":"+o[n].y])!==t&&(o[n]=l);for(r=0,a=f.length;r<a;r++)for(o=f[r],n=0;n<3;n++)(l=d[s=o[n].x+":"+o[n].y])!==t&&(o[n]=l);return p.concat(f)},isClockWise:function(e){return se.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,a){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,a)}},se.CubicBezierCurve3=se.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t,i,r;return t=se.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=se.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r=se.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new se.Vec3(t,i,r)}),se.QuadraticBezierCurve3=se.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i,r;return t=se.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=se.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r=se.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new se.Vec3(t,i,r)}),se.PathNode=function(e,i,r,a,n,o,s,l,h,c){this.materialSize=1,this.closed=!1;var u;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof se.Path)?(u=arguments[0],this.path=u.path,this.segments=u.segments||20,this.radius=u.radius||1,this.segmentsR=u.segmentsR||8,this.shape=u.shape,this.startCap=u.startCap||"plain",this.endCap=u.endCap||"plain",this.arc=u.arc!=t?u.arc:2*Math.PI,this.arcStart=u.arcStart!=t?u.arcStart:0,this.cutSurface=u.cutSurface||"none",this.startCapR=u.startCapR,this.endCapR=u.endCapR,this.startCapSize=u.startCapSize,this.endCapSize=u.endCapSize,this.binormal=u.binormal,this.startCapExtend=u.startCapExtend===t?1:u.startCapExtend,this.endCapExtend=u.endCapExtend===t?1:u.endCapExtend,this._id=u.id):(this.path=e,this.segments=i||20,this.radius=r||1,this.segmentsR=a||8,this.shape=s,this.startCap=n||"plain",this.endCap=o||"plain",this.arc=l!=t?l:2*Math.PI,this.arcStart=h!=t?h:0,this.cutSurface=c||"none"),this.shape instanceof Array&&(this.segmentsR=this.shape.length),this.startCapSize=this.startCapSize||1,this.endCapSize=this.endCapSize||1,this.segmentsCap=20,this.arc===2*Math.PI&&(this.cutSurface="none"),se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},se.extend(se.PathNode,se.Entity,{constructor:se.PathNode,className:"TGL.PathNode",__accessor:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],__SizePropeties:["path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","binormal"],getCrossSectionPoint:function(){},needComputeVertexNormal:function(){return!0},adjustPath:function(e,t,i){t=t||this.radius,i=i||this._adjustTimes||2;var r,a,n,o,s,l,h,c,u,f,p,d=new se.Path,m=new he,g=new he,y=new he,v=new he,x=e.actions.length;for(p=0;p<x;p++)if(n=e.actions[p],s=p+1===x?null:e.actions[p+1],o=n.args,"moveTo"===n.action)d.moveTo(o[0],o[1],o[2]);else if("lineTo"===n.action)if(s&&"lineTo"===s.action){if(r=e.actions[p-1],a=r.args,l=s.args,h=new he(a[0],a[1],a[2]),c=new he(o[0],o[1],o[2]),u=new he(l[0],l[1],l[2]),m.subVectors(c,h),g.subVectors(c,u),0==g.length()){e.actions.splice(p,1),p-=1,x-=1;continue}m.angleTo(g),f=Math.min(m.length()/2,g.length()/2),f=Math.min(t*i,f),y.addVectors(c,m.normalize().multiplyScalar(-f)),v.addVectors(c,g.normalize().multiplyScalar(-f)),d.lineTo(y.x,y.y,y.z),d.curveTo(c.x,c.y,c.z,v.x,v.y,v.z)}else d.lineTo(o[0],o[1],o[2]);else"quadraticCurveTo"===n.action&&d.curveTo(o[0],o[1],o[2],o[3],o[4],o[5]);return d},_resetPath:function(){return this.path},getPointAt:function(e){return this._realPath?this._realPath.getPoint(e):null},getTangentAt:function(e){if(this._realPath){var t=this._realPath.getPoint(e),i=this._realPath.getPoint(e-.001);return t.sub(i).normalize()}return null},computeData:function(){this.grid=[],this.startGrid=[],this.endGrid=[];var e,t,i,r,a,n,o,s,l,h,c,u,f,p,d=this.segmentsCap,m=new se.Vec3,g={};if(g.faces=[],g.uvs=[],g.vertices=[],null==this.path)return g;var y=this._resetPath(),v=this.startCap,x=this.endCap,A=this.cutSurface;this._realPath=y,1==this._autoAjust&&(y=this.adjustPath(y));var _,w,b=y.curves.length,M=y.curves,S=[],P=y.getLength(),C=0,T=this.segments;for(s=0;s<b;s++){if(_=M[s],w=_.getLength(),_ instanceof se.LineCurve3){var E=(.001*w+C)/P,z=(.999*w+C)/P;S.push(E),S.push(z)}else{var D=.998*w;for(Z=0;Z<=T;Z++){var L=(.001*w+D*Z/T+C)/P;S.push(L)}}C+=w}var R=this.frenetFrames(y,S,this.closed,this.binormal),N=R.tangents,B=R.normals,I=R.binormals;this.tangents=N,this.normals=B,this.binormals=I;var F,V=0,U=S.length-1,k=U+1,O=0,X=0;for(s=0;s<k;s++){if(this.grid[s]=[],ue=S[s],o=y.getPointAt(ue),e=N[s],t=B[s],i=I[s],"none"!==v&&0===s)if("round"===v||"arrow"===v){O+=this.radius*this.startCapSize;for(var G=o.clone().add(e.clone().multiplyScalar(-this.radius*this.startCapSize)),Y=0;Y<=d;Y++){this.startGrid[Y]=[];q=Y/d*Math.PI/2;j="round"===v?G.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*(1-Math.cos(q)))):G.clone().add(e.clone().multiplyScalar(this.radius*this.startCapSize*Y/d));for(Z=0;Z<this.segmentsR;Z++)r=Z/this.segmentsR*this.arc+this.arcStart,"round"===v?(a=-this.radius*Math.cos(r)*Math.sin(q),n=this.radius*Math.sin(r)*Math.sin(q)):(a=-this.radius*Math.cos(r)*Y/d,n=this.radius*Math.sin(r)*Y/d,a*=this.startCapR||1.3,n*=this.startCapR||1.3),(H=j.clone()).x+=a*t.x+n*i.x,H.y+=a*t.y+n*i.y,H.z+=a*t.z+n*i.z,this.startGrid[Y][Z]=g.vertices.push(H)-1;"center"===A&&(this.startGrid[Y][this.segmentsR]=g.vertices.push(j.clone())-1)}}else V=g.vertices.push(o);for(Z=0;Z<this.segmentsR;Z++){if(F=Z/(this.segmentsR-1),this.shape instanceof Array)a=-this.shape[Z].x,n=this.shape[Z].y;else if(this.shape instanceof se.Path){var W=this.shape.getPointAt(F);a=-W.x,n=-W.y}else r=Z/this.segmentsR*this.arc+this.arcStart,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);m.copy(o),m.x+=a*t.x+n*i.x,m.y+=a*t.y+n*i.y,m.z+=a*t.z+n*i.z,this.grid[s][Z]=function(e,t,i,r){return r.vertices.push(new se.Vec3(e,t,i))-1}(m.x,m.y,m.z,g)}if("center"===A&&(this.grid[s][this.segmentsR]=g.vertices.push(o.clone())-1),"none"!==x&&s===k-1)if("round"===x||"arrow"===x){X+=this.radius*this.endCapSize;for(var j,H,G=o.clone().add(e.clone().multiplyScalar(this.radius*this.endCapSize)),Y=0;Y<=d;Y++){this.endGrid[Y]=[];var q=(1-Y/d)*Math.PI/2;j="round"===x?G.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Math.cos(q)))):G.clone().add(e.clone().multiplyScalar(-this.radius*this.endCapSize*(1-Y/d)));for(var Z=0;Z<this.segmentsR;Z++)r=Z/this.segmentsR*this.arc+this.arcStart,"round"===x?(a=-this.radius*Math.cos(r)*Math.sin(q),n=this.radius*Math.sin(r)*Math.sin(q)):(a=-this.radius*Math.cos(r)*(1-Y/d),n=this.radius*Math.sin(r)*(1-Y/d),a*=this.endCapR||1.3,n*=this.endCapR||1.3),(H=j.clone()).x+=a*t.x+n*i.x,H.y+=a*t.y+n*i.y,H.z+=a*t.z+n*i.z,this.endGrid[Y][Z]=g.vertices.push(H)-1;"center"===A&&(this.endGrid[Y][this.segmentsR]=g.vertices.push(j)-1)}}else g.vertices.push(o)}var Q=this.segmentsR,K=this.segmentsR;this.arc!==2*Math.PI&&("center"===A?(Q++,K++):"none"===A&&Q--);var J=this.arc/Math.PI/2,$=y.getLength(),ee=$+O+X,te=O/ee,ie=te,re=$/ee,ae=te+re,ne=X/ee;if("none"!==v)if("plain"===v)for(c=0,Z=0;Z<this.segmentsR;Z++){h=(Z+1)%this.segmentsR,u=this.grid[0][Z],_=this.grid[0][h],g.faces.push(new se.Face3(c,u,_)),r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);oe=new le(.5,.5);r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);he=new le((a/this.radius+1)/2,(n/this.radius+1)/2);r=h/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);ce=new le((a/this.radius+1)/2,(n/this.radius+1)/2);g.uvs.push([oe,he,ce])}else for(s=0;s<=d;s++)for(Z=0;Z<Q;Z++){if(l=s+1,h=(Z+1)%K,c=this.startGrid[s][Z],l===d+1?(u=this.grid[0][Z],_=this.grid[0][h]):(u=this.startGrid[l][Z],_=this.startGrid[l][h]),f=this.startGrid[s][h],Z>=this.segmentsR-1){ue=(Y=this.segmentsR-1)/this.segmentsR*J;Q===this.segmentsR?(oe=new se.Vec2(s/d*te+0,ue),he=new se.Vec2((s+1)/d*te+0,ue),ce=new se.Vec2((s+1)/d*te+0,1),p=new se.Vec2(s/d*te+0,1)):Z>this.segmentsR-1?(oe=new se.Vec2(s/d*te+0,(1+ue)/2),he=new se.Vec2((s+1)/d*te+0,(1+ue)/2),ce=new se.Vec2((s+1)/d*te+0,1),p=new se.Vec2(s/d*te+0,1)):(oe=new se.Vec2(s/d*te+0,ue),he=new se.Vec2((s+1)/d*te+0,ue),ce=new se.Vec2((s+1)/d*te+0,(1+ue)/2),p=new se.Vec2(s/d*te+0,(1+ue)/2))}else oe=new se.Vec2(s/d*te+0,Z/this.segmentsR*J),he=new se.Vec2((s+1)/d*te+0,Z/this.segmentsR*J),ce=new se.Vec2((s+1)/d*te+0,(Z+1)/this.segmentsR*J),p=new se.Vec2(s/d*te+0,(Z+1)/this.segmentsR*J);0!==s&&(g.faces.push(new se.Face3(c,u,f,V-1)),g.uvs.push([oe,he,p])),g.faces.push(new se.Face3(u,_,f,V-1)),g.uvs.push([he.clone(),ce,p.clone()])}for(s=0;s<U;s++)for(Z=0;Z<Q;Z++){if(l=this.closed?(s+1)%U:s+1,h=(Z+1)%K,c=this.grid[s][Z],u=this.grid[l][Z],_=this.grid[l][h],f=this.grid[s][h],Z>=this.segmentsR-1){ue=(Y=this.segmentsR-1)/this.segmentsR*J;Q===this.segmentsR?(oe=new se.Vec2(S[s]*re+ie,ue),he=new se.Vec2(S[s+1]*re+ie,ue),ce=new se.Vec2(S[s+1]*re+ie,1),p=new se.Vec2(S[s]*re+ie,1)):Z>this.segmentsR-1?(oe=new se.Vec2(S[s]*re+ie,(ue+1)/2),he=new se.Vec2(S[s+1]*re+ie,(ue+1)/2),ce=new se.Vec2(S[s+1]*re+ie,1),p=new se.Vec2(S[s]*re+ie,1)):(oe=new se.Vec2(S[s]*re+ie,ue),he=new se.Vec2(S[s+1]*re+ie,ue),ce=new se.Vec2(S[s+1]*re+ie,(ue+1)/2),p=new se.Vec2(S[s]*re+ie,(ue+1)/2))}else oe=new se.Vec2(S[s]*re+ie,Z/this.segmentsR*J),he=new se.Vec2(S[s+1]*re+ie,Z/this.segmentsR*J),ce=new se.Vec2(S[s+1]*re+ie,(Z+1)/this.segmentsR*J),p=new se.Vec2(S[s]*re+ie,(Z+1)/this.segmentsR*J);g.faces.push(new se.Face3(c,u,f)),g.uvs.push([oe,he,p]),g.faces.push(new se.Face3(u,_,f)),g.uvs.push([he.clone(),ce,p.clone()])}if("none"!==x){c=g.vertices.length-1;b=this.grid.length;if("plain"===x)for(Z=0;Z<this.segmentsR;Z++){h=(Z+1)%this.segmentsR,u=this.grid[b-1][Z],_=this.grid[b-1][h],g.faces.push(new se.Face3(c,_,u)),r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var oe=new le(.5,.5);r=Z/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var he=new le((a/this.radius+1)/2,(n/this.radius+1)/2);r=h/this.segmentsR*2*Math.PI,a=-this.radius*Math.cos(r),n=this.radius*Math.sin(r);var ce=new le((a/this.radius+1)/2,(n/this.radius+1)/2);g.uvs.push([oe,ce,he])}else for(s=-1;s<d;s++)for(Z=0;Z<Q;Z++){if(l=s+1,h=(Z+1)%K,-1===s?(c=this.grid[b-1][Z],f=this.grid[b-1][h]):(c=this.endGrid[s][Z],f=this.endGrid[s][h]),u=this.endGrid[l][Z],_=this.endGrid[l][h],Z>=this.segmentsR-1){var ue=(Y=this.segmentsR-1)/this.segmentsR*J;Q===this.segmentsR?(oe=new se.Vec2(s/d*ne+ae,ue),he=new se.Vec2((s+1)/d*ne+ae,ue),ce=new se.Vec2((s+1)/d*ne+ae,1),p=new se.Vec2(s/d*ne+ae,1)):Z>this.segmentsR-1?(oe=new se.Vec2(s/d*ne+ae,(1+ue)/2),he=new se.Vec2((s+1)/d*ne+ae,(1+ue)/2),ce=new se.Vec2((s+1)/d*ne+ae,1),p=new se.Vec2(s/d*ne+ae,1)):(oe=new se.Vec2(s/d*ne+ae,ue),he=new se.Vec2((s+1)/d*ne+ae,ue),ce=new se.Vec2((s+1)/d*ne+ae,(1+ue)/2),p=new se.Vec2(s/d*ne+ae,(1+ue)/2))}else oe=new se.Vec2(s/d*ne+ae,Z/this.segmentsR*J),he=new se.Vec2((s+1)/d*ne+ae,Z/this.segmentsR*J),ce=new se.Vec2((s+1)/d*ne+ae,(Z+1)/this.segmentsR*J),p=new se.Vec2(s/d*ne+ae,(Z+1)/this.segmentsR*J);g.faces.push(new se.Face3(c,u,f)),g.uvs.push([oe,he,p]),g.faces.push(new se.Face3(u,_,f)),g.uvs.push([he.clone(),ce,p.clone()])}}return g},frenetFrames:function(e,t,i,r){new se.Vec3;var a,n,o,s,l,h,c,u=new se.Vec3,f=(new se.Vec3,[]),p=[],d=[],m=new se.Vec3,g=new se.Mat4,y=t.length-1+1,v=1e-4,x=[];for(x.tangents=f,x.normals=p,x.binormals=d,h=0;h<y;h++){c=t[h];var A=e.getTangentAt(c);f[h]=new se.Vec3(A.x,A.y,A.z?A.z:0),f[h].normalize()}for(p[0]=new se.Vec3,d[0]=new se.Vec3,n=Number.MAX_VALUE,o=Math.abs(f[0].x),s=Math.abs(f[0].y),l=Math.abs(f[0].z),s<=n&&(n=s,u.set(0,1,0)),o<=n&&(n=o,u.set(1,0,0)),l<=n&&u.set(0,0,1),r&&(u=r.clone()),m.crossVectors(f[0],u).normalize(),p[0].crossVectors(f[0],m),d[0].crossVectors(f[0],p[0]),h=1;h<y;h++)p[h]=p[h-1].clone(),d[h]=d[h-1].clone(),m.crossVectors(f[h-1],f[h]),m.length()>v&&(m.normalize(),a=Math.acos(se.Math.clamp(f[h-1].dot(f[h]),-1,1)),p[h].applyMatrix4(g.makeRotationAxis(m,a))),d[h].crossVectors(f[h],p[h]);if(i)for(a=Math.acos(se.Math.clamp(p[0].dot(p[y-1]),-1,1)),a/=y-1,f[0].dot(m.crossVectors(p[0],p[y-1]))>0&&(a=-a),h=1;h<y;h++)p[h].applyMatrix4(g.makeRotationAxis(f[h],a*h)),d[h].crossVectors(f[h],p[h]);return x}}),se.PathCube=function(e,t,i,r,a){var n;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof se.Path)?(n=arguments[0],this.path=n.path,this.width=n.width||50,this.height=n.height||100,this.curveSegements=n.curveSegements||32,this.repeat=n.repeat||20,this._id=n.id):(this.path=e,this.width=t||50,this.height=i||100,this.curveSegements=r||32,this.repeat=a||20),this.materialSize=6,se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},se.PathCube.SideIndexMapping={bottom:0,outside:1,inside:2,top:3,aside:4,zside:5},se.extend(se.PathCube,se.Entity,{__accessor:["path","width","height","curveSegements","repeat"],__SizePropeties:["path","width","height","curveSegements","repeat"],constructor:se.PathCube,className:"TGL.PathCube",getSideIndexMapping:function(){return se.PathCube.SideIndexMapping},computeData:function(){var e={};if(e.vertices=[],e.faces=[],e.uvs=[],e.uv2s=[],null==this.path)return e;var t,i=this.computePoints(this.path,this.width,this.curveSegements),r=i[0],a=i[1],n=r.length,o=i[2],s=this.height,l=this.repeat,h=[],c=[],u=[],f=[],p=this.path.isClockwise();for(this.innerPoints=this.clonePoints(r),this.outerPoints=this.clonePoints(a),t=0;t<n;t++)this.exchangeYZ(r[t]),this.exchangeYZ(a[t]),h[t]=e.vertices.push(r[t])-1,c[t]=e.vertices.push(a[t])-1,u[t]=e.vertices.push(r[t].clone().setY(s))-1,f[t]=e.vertices.push(a[t].clone().setY(s))-1;var d=o?n:n-1;for(t=0;t<d;t++)this.generateTop(e,t,n,u,f,!0,l),this.generateBottom(e,t,n,h,c,l),this.generateSideWall(e,t,n,f,c,!0,l,p),this.generateSideWall(e,t,n,u,h,!1,l,p);return o||(this.generateEnd(e,u,h,c,f,l,!0),this.generateEnd(e,u,h,c,f,l,!1)),this.clockwise=p,e},clonePoints:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].clone());return t},getInsidePoints:function(){return this.clockwise?this.innerPoints:this.outerPoints},generateEnd:function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M,S,P=o?0:i.length-1;s=t[P],l=i[P],h=r[P],c=a[P],w=e.vertices[s],b=e.vertices[l],M=e.vertices[h],S=e.vertices[c],u=w.x,f=w.y,p=w.z,d=b.x,m=b.y,g=b.z,y=M.x,v=M.y,_=M.z,x=S.x,A=S.y,dz=S.z;var C=Math.abs(p-_),T=Math.abs(u-y);o?(e.faces.push(new se.Face3(s,l,c,null,null,4)),C<T?e.uvs.push([new se.Vec2(u/n,f/n),new se.Vec2(d/n,m/n),new se.Vec2(x/n,A/n)]):e.uvs.push([new se.Vec2(p/n,f/n),new se.Vec2(g/n,m/n),new se.Vec2(dz/n,A/n)]),e.uv2s.push([new le(0,1),new le(0,0),new le(1,1)]),e.faces.push(new se.Face3(l,h,c,null,null,4)),C<T?e.uvs.push([new se.Vec2(d/n,m/n),new se.Vec2(y/n,v/n),new se.Vec2(x/n,A/n)]):e.uvs.push([new se.Vec2(g/n,m/n),new se.Vec2(_/n,v/n),new se.Vec2(dz/n,A/n)]),e.uv2s.push([new le(0,0),new le(1,0),new le(1,1)])):(e.faces.push(new se.Face3(l,s,c,null,null,5)),C<T?e.uvs.push([new se.Vec2(d/n,m/n),new se.Vec2(u/n,f/n),new se.Vec2(x/n,A/n)]):e.uvs.push([new se.Vec2(g/n,m/n),new se.Vec2(p/n,f/n),new se.Vec2(dz/n,A/n)]),e.uv2s.push([new le(0,0),new le(0,1),new le(1,1)]),e.faces.push(new se.Face3(h,l,c,null,null,5)),C<T?e.uvs.push([new se.Vec2(y/n,v/n),new se.Vec2(d/n,m/n),new se.Vec2(x/n,A/n)]):e.uvs.push([new se.Vec2(_/n,v/n),new se.Vec2(g/n,m/n),new se.Vec2(dz/n,A/n)]),e.uv2s.push([new le(1,0),new le(0,0),new le(1,1)]))},generateSideWall:function(e,t,i,r,a,n,o,s){var l,h,c,u,f,p,d,m,g,y,v,x,A,_,w,b,M,S,P,C;b=(t+1)%i,l=r[t],h=a[t],c=a[b],u=r[b],M=e.vertices[l],S=e.vertices[h],P=e.vertices[c],C=e.vertices[u],f=M.x,p=M.y,d=M.z,m=S.x,g=S.y,y=S.z,v=P.x,x=P.y,w=P.z,A=C.x,_=C.y,dz=C.z;var T,E=Math.abs(d-w),z=Math.abs(f-v);n?(T=s?1:2,e.faces.push(new se.Face3(l,h,u,null,null,T)),E<z?e.uvs.push([new se.Vec2(f/o,p/o),new se.Vec2(m/o,g/o),new se.Vec2(A/o,_/o)]):e.uvs.push([new se.Vec2(d/o,p/o),new se.Vec2(y/o,g/o),new se.Vec2(dz/o,_/o)]),e.uv2s.push([new le(0,1),new le(0,0),new le(1,1)]),e.faces.push(new se.Face3(h,c,u,null,null,T)),E<z?e.uvs.push([new se.Vec2(m/o,g/o),new se.Vec2(v/o,x/o),new se.Vec2(A/o,_/o)]):e.uvs.push([new se.Vec2(y/o,g/o),new se.Vec2(w/o,x/o),new se.Vec2(dz/o,_/o)]),e.uv2s.push([new le(0,0),new le(1,0),new le(1,1)])):(T=s?2:1,e.faces.push(new se.Face3(h,l,u,null,null,T)),E<z?e.uvs.push([new se.Vec2(m/o,g/o),new se.Vec2(f/o,p/o),new se.Vec2(A/o,_/o)]):e.uvs.push([new se.Vec2(y/o,g/o),new se.Vec2(d/o,p/o),new se.Vec2(dz/o,_/o)]),e.uv2s.push([new le(0,0),new le(0,1),new le(1,1)]),e.faces.push(new se.Face3(c,h,u,null,null,T)),E<z?e.uvs.push([new se.Vec2(v/o,x/o),new se.Vec2(m/o,g/o),new se.Vec2(A/o,_/o)]):e.uvs.push([new se.Vec2(w/o,x/o),new se.Vec2(y/o,g/o),new se.Vec2(dz/o,_/o)]),e.uv2s.push([new le(1,0),new le(0,0),new le(1,1)]))},generateBottom:function(e,t,i,r,a,n){this.generateTop(e,t,i,r,a,!1,n)},generateTop:function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,y,v,x,A,_,w;v=(t+1)%i,s=r[t],l=a[t],h=a[v],c=r[v],x=e.vertices[s],A=e.vertices[l],_=e.vertices[h],w=e.vertices[c],u=x.x,x.y,f=x.z,p=A.x,A.y,d=A.z,m=_.x,_.y,y=_.z,g=w.x,w.y,dz=w.z,n?(e.faces.push(new se.Face3(s,l,c,null,null,3)),e.uvs.push([new se.Vec2(u/o,f/o),new se.Vec2(p/o,d/o),new se.Vec2(g/o,dz/o)]),e.uv2s.push([new le(0,1),new le(0,0),new le(1,1)]),e.faces.push(new se.Face3(l,h,c,null,null,3)),e.uvs.push([new se.Vec2(p/o,d/o),new se.Vec2(m/o,y/o),new se.Vec2(g/o,dz/o)]),e.uv2s.push([new le(0,0),new le(1,0),new le(1,1)])):(e.faces.push(new se.Face3(l,s,c,null,null,0)),e.uvs.push([new se.Vec2(p/o,d/o),new se.Vec2(u/o,f/o),new se.Vec2(g/o,dz/o)]),e.uv2s.push([new le(0,0),new le(0,1),new le(1,1)]),e.faces.push(new se.Face3(h,l,c,null,null,0)),e.uvs.push([new se.Vec2(m/o,y/o),new se.Vec2(p/o,d/o),new se.Vec2(g/o,dz/o)]),e.uv2s.push([new le(1,0),new le(0,0),new le(1,1)]))},exchangeYZ:function(e){var t=e.y;e.y=e.z,e.z=-t},addPoints:function(e,t,i,r,a){t.multiplyScalar(.5),i.push((new se.Vec3).subVectors(e,t)),r.push((new se.Vec3).addVectors(e,t))},computeCurvePoint:function(e,t,i,r,a,n,o,s,l){var h,c,f,p,d=r?0:1,m=new se.Vec3,g=s;if(e){c=e.getTangentAt(1),f=t.getTangentAt(0),concave=se.Math.isConcave(c,f,!1),f.multiplyScalar(-1),angle=c.angleTo(f),p=Math.sin(angle/2),h=t.getPoint(0),p=0==p?.1:p;var y=concave?i/p:-i/p;1==p?m.crossVectors(f,new he(0,0,1)).normalize().multiplyScalar(y):m.addVectors(c,f).normalize().multiplyScalar(y),this.addPoints(h,m,n,o,l)}else f=t.getTangentAt(d),h=t.getPoint(d),m.crossVectors(f,new se.Vec3(0,0,1)).normalize().multiplyScalar(i),this.addPoints(h,m,n,o,l);if(!(t instanceof se.LineCurve3)&&a){var v=g+1;for(j=0;j<v-2;j++)u=j/(v-1),f=t.getTangentAt(u),h=t.getPointAt(u),m.crossVectors(f,new se.Vec3(0,0,1)).normalize().multiplyScalar(i),j*t.getLength()/g>i/Math.abs(p)&&this.addPoints(h,m,n,o,l)}},computePoints:function(e,t,i){new se.Vec3;var r,a,n,o=e.isClockwise(),s=e.curves[0].getPoint(0),l=e.curves[e.curves.length-1].getPoint(1);n=s.equals(l),a=e.curves.length;var h=[],c=[];new se.Path,e.getLength();for(r=0;r<a;r++){var u=r-1;n&&-1===u&&(u=a-1);var f=e.curves[u],p=e.curves[r];this.computeCurvePoint(f,p,t,!0,!0,h,c,i,o),r!==a-1||n||this.computeCurvePoint(null,p,t,!1,!1,h,c,i,o)}return[h,c,n]}}),se.ShapeNode=function(e,t,i,r,a){if(null==e)return e=[],this.materialSize=3,void se.Entity.call(this);var n;if(!(1===arguments.length&&arguments[0]instanceof Object)||arguments[0]instanceof se.Shape||arguments[0]instanceof se.Path&&!Array.isArray(arguments[0]))this.options={curveSegments:t,amount:i,vertical:r,zMinusHalfAmount:this.zMinusHalfAmount,repeat:a||20};else{if(n=arguments[0],null==(e=n.path))return e=[],this.materialSize=3,void se.Entity.call(this);t=n.curveSegments,i=n.amount,r=n.vertical,a=n.repeat,this.options={curveSegments:n.curveSegments,amount:n.amount,vertical:n.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:n.repeat||20},this._id=n.id}var o=[];e instanceof se.Path?(o=e.toShapes(),this.path=e):o=e,this.curveSegments=t,this.amount=i,this.vertical=r,this.repeat=a||20,o=o instanceof Array?o:[o],this.shapes=o,this.shapebb=o[o.length-1].getBoundingBox(),this.materialSize=3,se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},se.ShapeNode.SideIndexMapping={bottom:0,side:1,top:2},se.extend(se.ShapeNode,se.Entity,{constructor:se.ShapeNode,className:"TGL.ShapeNode",__accessor:["path","curveSegments","amount","vertical","repeat"],__bool:["vertical"],__SizePropeties:["path","curveSegments","amount","vertical","repeat"],computeData:function(){return this.options={curveSegments:this.curveSegments,amount:this.amount,vertical:this.vertical,zMinusHalfAmount:this.zMinusHalfAmount,repeat:this.repeat||20},this.addShapes(this.path,this.options)},getSideIndexMapping:function(){return se.ShapeNode.SideIndexMapping},addShapes:function(e,t){var i=[];i=e instanceof se.Path?e.toShapes():e;var r={};if(r.vertices=[],r.uvs=[],r.uv2s=[],r.faces=[],!i)return r;for(var a=i.length,n=0;n<a;n++){var o=i[n];this.addShape(o,t,r)}var s=new se.BoundingBox;s.setFromPoints(r.vertices);var l=(s.max.y-s.min.y)/2;if(t.zMinusHalfAmount)for(h=0;h<r.vertices.length;h++)r.vertices[h].y-=l;if(t.vertical)for(var h=0;h<r.vertices.length;h++){var c=r.vertices[h].y;r.vertices[h].y=r.vertices[h].z,r.vertices[h].z=-c}return r}}),se.ShapeNode.prototype.addShape=function(e,i,r){function a(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function n(e,t,i){return s(e,t,i)}function o(e,t,i){var r=Math.atan2(t.y-e.y,t.x-e.x),a=Math.atan2(i.y-e.y,i.x-e.x);r>a&&(a+=2*Math.PI);var n=(r+a)/2,o=-Math.cos(n),s=-Math.sin(n);return new se.Vec2(o,s)}function s(e,t,i){var r,a,n,s,l,h=se.ShapeNode.__v1,c=se.ShapeNode.__v2,u=se.ShapeNode.__v3,f=se.ShapeNode.__v4,p=se.ShapeNode.__v5,d=se.ShapeNode.__v6;return h.set(e.x-t.x,e.y-t.y),c.set(e.x-i.x,e.y-i.y),r=h.normalize(),a=c.normalize(),u.set(-r.y,r.x),f.set(a.y,-a.x),p.copy(e).add(u),d.copy(e).add(f),p.equals(d)?f.clone():(p.copy(t).add(u),d.copy(i).add(f),n=r.dot(f),s=d.sub(p).dot(f),0===n&&(console.log("Either infinite or no solutions!"),0===s?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),(l=s/n)<0?o(e,t,i):r.multiplyScalar(l).add(p).sub(e).clone())}function l(e){for(var t=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=e;o<r.uvs.length;o++)for(var s=r.uvs[o],l=0;l<s.length;l++)(f=s[l]).x>a&&(a=f.x),f.y>n&&(n=f.y),f.x<t&&(t=f.x),f.y<i&&(i=f.y);for(var h=a-t,c=n-i,o=e;o<r.uvs.length;o++){for(var s=r.uvs[o],u=[],l=0;l<s.length;l++){var f=s[l];u.push(new le((f.x-t)/h,(f.y-i)/c))}r.uv2s.push(u)}}function h(e,t){var i,r;for(Z=e.length;--Z>=0;){i=Z,(r=Z-1)<0&&(r=e.length-1);var a=0,n=_+2*v;for(a=0;a<n;a++){var o=j*a,s=j*(a+1);f(t+i+o,t+r+o,t+r+s,t+i+s,e,a,n,i,r)}}}function c(e,t,i){r.vertices.push(new se.Vec3(e,t,i-(m?d/2:0)))}function u(t,a,n,o){t+=R,a+=R,n+=R;var s=o?0:2;if(se.Math.isClockwise([r.vertices[t],r.vertices[a],r.vertices[n]]),"z"){r.faces.push(new se.Face3(t,a,n,null,null,s));l=o?S.generateBottomUV(r,e,i,t,a,n):S.generateTopUV(r,e,i,t,a,n);r.uvs.push(l)}else{r.faces.push(new se.Face3(t,n,a,null,null,s));var l=o?S.generateBottomUV(r,e,i,t,n,a):S.generateTopUV(r,e,i,t,n,a);r.uvs.push(l)}}function f(t,a,n,o,s,l,h,c,u){if(t+=R,a+=R,n+=R,o+=R,se.Math.isClockwise([r.vertices[t],r.vertices[a],r.vertices[o]]),"z"){r.faces.push(new se.Face3(t,a,o,null,null,M)),r.faces.push(new se.Face3(a,n,o,null,null,M));f=S.generateSideWallUV(r,e,s,i,t,a,n,o,l,h,c,u);r.uvs.push([f[0],f[1],f[3]]),r.uvs.push([f[1],f[2],f[3]])}else{r.faces.push(new se.Face3(t,o,a,null,null,M)),r.faces.push(new se.Face3(a,o,n,null,null,M));var f=S.generateSideWallUV(r,e,s,i,t,a,n,o,l,h,c,u);r.uvs.push([f[0],f[3],f[1]]),r.uvs.push([f[1],f[3],f[2]])}}var p,d=i.amount!==t?i.amount:100,m=i.zMinusHalfAmount!==t&&i.zMinusHalfAmount,g=i.bevelThickness!==t?i.bevelThickness:6,y=i.bevelSize!==t?i.bevelSize:g-2,v=i.bevelSegments!==t?i.bevelSegments:3,x=i.bevelEnabled!==t&&i.bevelEnabled,A=i.curveSegments!==t?i.curveSegments:12,_=i.steps!==t?i.steps:1,w=i.extrudePath,b=!1,M=(i.material,i.extrudeMaterial||1),S=i.UVGenerator!==t?i.UVGenerator:se.ShapeNode.WorldUVGenerator;S.repeat=i.repeat,S.amount=d;var P,C,T,E;this.shapebb;w&&(p=w.getSpacedPoints(_),b=!0,x=!1,P=i.frames!==t?i.frames:se.PathNode.prototype.frenetFrames(w,_,!1),C=new se.Vec3,T=new se.Vec3,E=new se.Vec3),x||(v=0,g=0,y=0);var z,D,L,R=r.vertices.length,N=e.extractPoints(A),B=N.shape,I=N.holes,F=!se.Shape.Utils.isClockWise(B);if(F){for(B=B.reverse(),D=0,L=I.length;D<L;D++)z=I[D],se.Shape.Utils.isClockWise(z)&&(I[D]=z.reverse());F=!1}var V=se.Shape.Utils.triangulateShape(B,I),U=B;for(D=0,L=I.length;D<L;D++)z=I[D],B=B.concat(z);for(var k,O,X,G,Y,W,j=B.length,H=V.length,q=(U.length,Math.PI,[]),Z=0,Q=U.length,K=Q-1,J=Z+1;Z<Q;Z++,K++,J++){K===Q&&(K=0),J===Q&&(J=0);U[Z],U[K],U[J];q[Z]=n(U[Z],U[K],U[J])}var $,ee=[],te=q.concat();for(D=0,L=I.length;D<L;D++){for(z=I[D],$=[],Z=0,K=(Q=z.length)-1,J=Z+1;Z<Q;Z++,K++,J++)K===Q&&(K=0),J===Q&&(J=0),$[Z]=n(z[Z],z[K],z[J]);ee.push($),te=te.concat($)}for(k=0;k<v;k++){for(G=g*(1-(X=k/v)),O=y*Math.sin(X*Math.PI/2),Z=0,Q=U.length;Z<Q;Z++)c((Y=a(U[Z],q[Z],O)).x,Y.y,-G);for(D=0,L=I.length;D<L;D++)for(z=I[D],$=ee[D],Z=0,Q=z.length;Z<Q;Z++)c((Y=a(z[Z],$[Z],O)).x,Y.y,-G)}for(O=y,Z=0;Z<j;Z++)Y=x?a(B[Z],te[Z],O):B[Z],b?(T.copy(P.normals[0]).multiplyScalar(Y.x),C.copy(P.binormals[0]).multiplyScalar(Y.y),E.copy(p[0]).add(T).add(C),c(E.x,E.y,E.z)):c(Y.x,Y.y,0);var ie;for(ie=1;ie<=_;ie++)for(Z=0;Z<j;Z++)Y=x?a(B[Z],te[Z],O):B[Z],b?(T.copy(P.normals[ie]).multiplyScalar(Y.x),C.copy(P.binormals[ie]).multiplyScalar(Y.y),E.copy(p[ie]).add(T).add(C),c(E.x,E.y,E.z)):c(Y.x,Y.y,d/_*ie);for(k=v-1;k>=0;k--){for(G=g*(1-(X=k/v)),O=y*Math.sin(X*Math.PI/2),Z=0,Q=U.length;Z<Q;Z++)c((Y=a(U[Z],q[Z],O)).x,Y.y,d+G);for(D=0,L=I.length;D<L;D++)for(z=I[D],$=ee[D],Z=0,Q=z.length;Z<Q;Z++)Y=a(z[Z],$[Z],O),b?c(Y.x,Y.y+p[_-1].y,p[_-1].x+G):c(Y.x,Y.y,d+G)}!function(){var e=r.uvs.length;if(x){var t=0,i=j*t;for(Z=0;Z<H;Z++)u((W=V[Z])[2]+i,W[1]+i,W[0]+i,!0);for(i=j*(t=_+2*v),Z=0;Z<H;Z++)u((W=V[Z])[0]+i,W[1]+i,W[2]+i,!1)}else{for(Z=0;Z<H;Z++)u((W=V[Z])[2],W[1],W[0],!0);for(Z=0;Z<H;Z++)u((W=V[Z])[0]+j*_,W[1]+j*_,W[2]+j*_,!1)}l(e)}(),function(){var e=r.uvs.length,t=0;for(h(U,t),t+=U.length,D=0,L=I.length;D<L;D++)h(z=I[D],t),t+=z.length;l(e)}()},se.ShapeNode.WorldUVGenerator={generateTopUV:function(e,t,i,r,a,n){var o=e.vertices[r].x,s=e.vertices[r].y,l=e.vertices[a].x,h=e.vertices[a].y,c=e.vertices[n].x,u=e.vertices[n].y;return[new se.Vec2(o/this.repeat,s/this.repeat),new se.Vec2(l/this.repeat,h/this.repeat),new se.Vec2(c/this.repeat,u/this.repeat)]},generateBottomUV:function(e,t,i,r,a,n){return this.generateTopUV(e,t,i,r,a,n)},uv:function(e,t,i){return new le(Math.sqrt(e*e+t*t)/this.repeat,(1-i)/this.repeat)},generateSideWallUV:function(e,t,i,r,a,n,o,s,l,h,c,u){var f=e.vertices[a].x,p=e.vertices[a].y,d=e.vertices[a].z,m=e.vertices[n].x,g=e.vertices[n].y,y=e.vertices[n].z,v=e.vertices[o].x,x=e.vertices[o].y,A=e.vertices[o].z,_=e.vertices[s].x,w=e.vertices[s].y,b=e.vertices[s].z;return Math.abs(p-g)<Math.abs(f-m)?[new se.Vec2(f/this.repeat,(this.amount-d)/this.repeat),new se.Vec2(m/this.repeat,(this.amount-y)/this.repeat),new se.Vec2(v/this.repeat,(this.amount-A)/this.repeat),new se.Vec2(_/this.repeat,(this.amount-b)/this.repeat)]:[new se.Vec2(p/this.repeat,(this.amount-d)/this.repeat),new se.Vec2(g/this.repeat,(this.amount-y)/this.repeat),new se.Vec2(x/this.repeat,(this.amount-A)/this.repeat),new se.Vec2(w/this.repeat,(this.amount-b)/this.repeat)]}},se.ShapeNode.__v1=new se.Vec2,se.ShapeNode.__v2=new se.Vec2,se.ShapeNode.__v3=new se.Vec2,se.ShapeNode.__v4=new se.Vec2,se.ShapeNode.__v5=new se.Vec2,se.ShapeNode.__v6=new se.Vec2,se.TextNode=function(e,i,r,a,n,o,s){var l;1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])?(e=(l=arguments[0]).text,this.font=l.font||"helvetiker",this.size=l.size||150,this.weight=l.weight||"normal",this.fontStyle=l.fontStyle||"normal",this.height=l.height||50,this._id=l.id,this.curveSegments=l.curveSegments):(this.font=a||"helvetiker",this.size=i||150,this.weight=n||"normal",this.fontStyle=o||"normal",this.height=r||50,this.curveSegments=s);var h={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0};this.text=e;var c=se.FontUtils.generateShapes(e,h);h.amount=h.height!==t?h.height:50,h.bevelThickness===t&&(h.bevelThickness=10),h.bevelSize===t&&(h.bevelSize=8),h.bevelEnabled===t&&(h.bevelEnabled=!1),se.ShapeNode.call(this,c,h.curveSegments,this.height,!1,50,!0)},se.extend(se.TextNode,se.ShapeNode,{constructor:se.TextNode,className:"TGL.TextNode",__accessor:["text","size","height","font","weight","fontStyle"],__SizePropeties:["text","size","height","font","weight","fontStyle"],computeData:function(){var e={size:this.size,height:this.height,font:this.font,weight:this.weight,style:this.fontStyle,curveSegments:this.curveSegments||30,bevelEnabled:!1,zMinusHalfAmount:!0},t={curveSegments:this.curveSegments,amount:this.height,vertical:!1,zMinusHalfAmount:!0,repeat:20},i=se.FontUtils.generateShapes(this.text,e);return se.ShapeNode.prototype.addShapes.call(this,i,t)}}),se.LatheNode=function(e,i,r,a,n,o){this.materialSize=3;var s;1===arguments.length&&arguments[0]instanceof Object&&!(arguments[0]instanceof se.Path)?(s=arguments[0],this.path=s.path,this.segmentsH=s.segmentsH||64,this.segmentsR=s.segmentsR||20,this.arc=s.arc!=t?s.arc:2*Math.PI,this.startClosed=s.startClosed,this.endClosed=s.endClosed,this._id=s.id):(this.path=e,this.segmentsH=i||64,this.segmentsR=r||20,this.arc=a!=t?a:2*Math.PI,this.startClosed=n,this.endClosed=o),se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},se.extend(se.LatheNode,se.Entity,{constructor:se.LatheNode,className:"TGL.LatheNode",__accessor:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],__SizePropeties:["path","segmentsH","segmentsR","arc","startClosed","endClosed"],computeData:function(){function e(e){var t=e.x,i=e.z,r=(1+(0===i?t/Math.abs(t):t/Math.abs(i)))/2;r=se.Math.clamp(r,0,1);var a=(1+(0===t?i/Math.abs(i):i/Math.abs(t)))/2;return a=se.Math.clamp(a,0,1),new se.Vec2(r,a)}var t={};if((t={}).faces=[],t.uvs=[],t.vertices=[],null==this.path)return t;var i,r,n,o,s,l,h,u=[],f=this.path,p=this.segmentsH,d=this.segmentsR;for(se.Shape.Utils.isClockWise(f.getPoints())||(f=f.reverse()),r=0;r<=p;r++){for(i=f.getPoint(r/p),u[r]=[],o=Math.abs(i.x),s=i.y,this.startClosed&&0===r&&t.vertices.push(new se.Vec3(0,s,0)),n=0;n<d;n++)h=n/d*this.arc,l=new se.Vec3(o*Math.cos(h),s,o*Math.sin(h)),u[r][n]=t.vertices.push(l)-1;this.endClosed&&r===p&&t.vertices.push(new se.Vec3(0,s,0))}var m=this.arc==2*Math.PI;if(this.startClosed)for(a=0,n=0;n<(m?d:d-1);n++)jp=(n+1)%d,b=u[0][n],c=u[0][jp],uva=new se.Vec2(.5,.5),uvb=e(t.vertices[b]),uvc=e(t.vertices[c]),t.faces.push(new se.Face3(a,b,c)),t.uvs.push([uva,uvb,uvc]);for(r=0;r<p;r++)for(n=0;n<(m?d:d-1);n++)ip=r+1,jp=(n+1)%d,a=u[r][n],b=u[ip][n],c=u[ip][jp],$e=u[r][jp],uva=new se.Vec2(r/p,n/d),uvb=new se.Vec2((r+1)/p,n/d),uvc=new se.Vec2((r+1)/p,(n+1)/d),uvd=new se.Vec2(r/p,(n+1)/d),t.faces.push(new se.Face3(a,b,$e)),t.uvs.push([uva,uvb,uvd]),t.faces.push(new se.Face3(b,c,$e)),t.uvs.push([uvb.clone(),uvc,uvd.clone()]);if(this.endClosed)for(a=t.vertices.length-1,n=0;n<(m?d:d-1);n++)jp=(n+1)%d,b=u[u.length-1][n],c=u[u.length-1][jp],uva=new se.Vec2(0,0),uvb=new se.Vec2(1,n/d),uvc=new se.Vec2(1,(n+1)/d),t.faces.push(new se.Face3(a,b,c)),t.uvs.push([uva,uvb,uvc]);return t}}),se.CurvePlane=function(e,t,i,r){this.pathH=e,this.pathV=t,this.segmentsH=i||20,this.segmentsV=r||20,se.Entity.call(this)},se.extend(se.CurvePlane,se.Entity,{constructor:se.CurvePlane,className:"TGL.CurvePlane",computeData:function(){var e={};if(e.faces=[],e.uvs=[],e.vertices=[],null==this.pathV||null==this.pathH)return e;var t,i,r,a,n,o,s,l,h,c=this.pathV,u=this.pathH,f=this.segmentsV,p=this.segmentsH,d=f+1,m=p+1;for(this.grid=[],t=0;t<m;t++){this.grid[t]=[];var g=u.getPointAt(t/m);for(i=0;i<d;i++){var y=c.getPointAt(i/d);this.grid[t][i]=e.vertices.push(new he(g.x,y.y,g.z+y.z))-1}}for(t=0;t<p;t++)for(i=0;i<f;i++)r=this.grid[t][i],a=this.grid[t][i+1],n=this.grid[t+1][i+1],o=this.grid[t+1][i],s=new le(t/m,i/d),l=new le(t/m,(i+1)/d),uvc=new le((t+1)/m,(i+1)/d),h=new le((t+1)/m,i/d),e.faces.push(new Se(r,n,a)),e.uvs.push([s,uvc,l]),e.faces.push(new Se(r,o,n)),e.uvs.push([s.clone(),h.clone(),uvc]);return e}}),se.ComboNode=function(e,t,i,r,a){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=e;this.combos=n.combos||[],this.operators=n.operators,this.centralized=i,this.names=a,this._id=n.id}else this.combos=e||[],this.operators=t,this.centralized=i,this._id=r,this.names=a;this.csgs=[],se.Entity.call(this)},se.extend(se.ComboNode,se.Entity,{constructor:se.ComboNode,className:"TGL.ComboNode",__accessor:["combos","operators","centralized","names"],__SizePropeties:["combos","operators","centralized"],getOffsetPosition:function(){return this._offsetPosition},getSideIndexMapping:function(){var e,t,i,r,a=this.combos,n=this.names||[],o={},s=0;if(a&&a.length)for(i=0;i<a.length;i++){e=a[i],(t=n[i])||((r=e.getClassName())&&r.indexOf(".")>0&&(r=r.substr(r.lastIndexOf(".")+1)),t=(t=r+""+i).toLowerCase());var l=e.getSideIndexMapping();if(l)for(var h in l)o[t+"-"+h]=s++;else o[t]=s++}return o},computeData:function(){this.csgs=[];var e={vertices:[],faces:[],uvs:[],uv2s:[]};if(!this.combos)return e;if(null==this.operators||0==this.operators.length){var i=Ee.mergeElements(this.combos);if(this.materialSize=i.material.materials.length,this.material=i.material,this.orgMaterial=i.material,e={vertices:i.vertices,faces:i.faces,uvs:i.uvs,uv2s:i.uv2s||[]},this.centralized&&e.vertices){(l=new se.BoundingBox).setFromPoints(e.vertices);h=l.center();for(r=0;r<e.vertices.length;r++)(c=e.vertices[r]).sub(h);this._offsetPosition=h}return e}this.operators=this.operators||[];var r,a,n,o,s=this.combos.length;for(r=0;r<s;r++)this.csgs.push(new se.CSG(this.combos[r]));for(r=0;r<s;r++)null==a?a=this.csgs[r]:"+"===(n=this.operators[r-1])||n==t?a=a.union(this.csgs[r]):"-"===n?a=a.substract(this.csgs[r]):"^"===n&&(a=a.intersect(this.csgs[r]));if(!a)return e;if(o=a.toMesh(),"centralized"==this.changeProperty&&null!=this.material||(this.materialSize=o.material.materials.length,this.material=o.material,this.orgMaterial=o.material),e={vertices:o.vertices,faces:o.faces,uvs:o.uvs,uv2s:o.uv2s},this.centralized&&e.vertices){var l=new se.BoundingBox;l.setFromPoints(e.vertices);var h=l.center();for(r=0;r<e.vertices.length;r++){var c=e.vertices[r];c.sub(h)}this._offsetPosition=h}return o=t,e},refreshStyleMap:function(){for(var e=this.combos,t=this.styleMap,i=0,r=0;r<e.length;r++){var a=e[r],n=a.getMaterailSize();for(s in a.styleMap)for(var o=t[s]||(t[s]=[]),l=a.styleMap[s],h=0;h<n;h++)o[i+h]=Ee.isArray(l)?l[h]:l;i+=n}},computeNodeMaterial:function(e){this.material=e.material,this.materialSize=e.materialSize},cacheNodeMaterial:function(e){e.material=this.material,e.materialSize=this.materialSize},needComputeVertexNormal:function(){return!0},generatePrimitiveKey:function(){return null},changeMapping:function(e){var t=this.getMaterialMapping();se.Utils.isSame(e,t)||(this.batch?this.materialMappingChanges=[e,t]:(this.onMaterialMapping(),this.firePropertyChange("materialMapping",e,t)))},isStyleEquals:function(e,t,i){return!1},getSelectStyle:function(){var e=this.getStyle("select.style");return"outline.normal"!=e&&"outline"!=e||(e="outline.wireframe"),e},onMaterialMapping:function(){this.groups=t,this.primitive.groups=t}}),se.Terrain=function(e){if(e=e||{},this._id=e.id,this.width=e.width,this.depth=e.depth,this.segmentsW=e.segmentsW||30,this.segmentsD=e.segmentsD||30,this.heightMap=e.heightMap,this.heightUnit=e.heightUnit||1,this.maxHeight=e.maxHeight||255,this.minHeight=e.minHeight||0,this.baseLayerHeight=e.baseLayerHeight||0,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):fe.isCanvas(this.heightMap)?this.canvas=this.heightMap:fe.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var t=this;this.image.onload=function(e){var i=document.createElement("canvas");i.width=t.image.width,i.height=t.image.height,i.getContext("2d").drawImage(t.image,0,0),t.canvas=i,t.computed=!1,t.computeNodeData(),t.firePropertyChange("width",0,1)}}this.materialSize=2,se.Entity.call(this),this.computeCentroids(),this.computeFaceNormals()},se.extend(se.Terrain,se.Entity,{constructor:se.Terrain,className:"TGL.Terrain",__accessor:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__SizePropeties:["width","depth","segmentsW","segmentsD","heightMap","heightUnit","maxHeight","minHeight","baseLayerHeight","smooth"],__bool:["smooth"],computeLayerData:function(e,t,i){var r,a,n=this.width/2,o=this.depth/2,s=i?this.segmentsW:1,l=i?this.segmentsD:1,h=s+1,c=l+1,u=this.width/s,f=this.depth/l,p=new se.Vec3(0,0,1),d=e.vertices.length;for(a=0;a<c;a++)for(r=0;r<h;r++){var m=r*u-n,g=a*f-o,y=0;y=i?i.call(this,r/h,a/c):this.baseLayerHeight*this.heightUnit,e.vertices.push(new se.Vec3(m,y,g))}for(a=0;a<l;a++)for(r=0;r<s;r++){var v=r+h*a+d,x=r+h*(a+1)+d,A=r+1+h*(a+1)+d,_=r+1+h*a+d,w=new se.Vec2(r/s,1-a/l),b=new se.Vec2(r/s,1-(a+1)/l),M=new se.Vec2((r+1)/s,1-(a+1)/l),S=new se.Vec2((r+1)/s,1-a/l);if(i)(P=new se.Face3(v,x,_)).materialIndex=t,e.faces.push(P),e.uvs.push([w,b,S]),(P=new se.Face3(x,A,_)).materialIndex=t,e.faces.push(P),e.uvs.push([b.clone(),M,S.clone()]);else{var P=new se.Face4(v,x,A,_);P.normal.copy(p),P.vertexNormals.push(p.clone(),p.clone(),p.clone(),p.clone()),P.materialIndex=t,e.faces.push(P),e.uvs.push([w,b,M,S])}}},computeData:function(){var e={};return e.vertices=[],e.faces=[],e.uvs=[],this.computeLayerData(e,0),this.computeLayerData(e,1,this.getHeight),e},getFaceNormal:function(e,t){this.computeFaceNormals();var i=this.segmentsW*e,r=this.segmentsD*t,a=Math.floor(i),n=Math.floor(r),o=n*this.segmentsW+a;o=2*o+1,a!=Math.round(i)&&n!=Math.round(r)&&o++;var s=this.faces[o];this.vertices[s.a],this.vertices[s.b],this.vertices[s.c];return s.normal.clone()},setHeightMap:function(e){if(this.heightMap=e,"string"==typeof this.heightMap?(this.image=new Image,this.image.src=this.heightMap):fe.isCanvas(this.heightMap)?this.canvas=this.heightMap:fe.isImage(this.heightMap)&&(this.image=this.heightMap),this.image){var t=this;if(this.image.width){var i=document.createElement("canvas");i.width=t.image.width,i.height=t.image.height,i.getContext("2d").drawImage(t.image,0,0),t.canvas=i,t.computed=!1,t.computeNodeData(),t.firePropertyChange("width",0,1)}else this.image.onload=function(e){var i=document.createElement("canvas");i.width=t.image.width,i.height=t.image.height,i.getContext("2d").drawImage(t.image,0,0),t.canvas=i,t.computed=!1,t.computeNodeData(),t.firePropertyChange("width",0,1)}}},getHeight:function(e,t){if(null==this.canvas)return 0;var i=this.canvas;if(null==this.heightData){for(var r=i.width*i.height,a=new Float32Array(r),n=0;n<r;n++)a[n]=0;for(var o=i.getContext("2d").getImageData(0,0,i.width,i.height).data,s=0,n=0,l=o.length;n<l;n+=4){var h=o[n]+o[n+1]+o[n+2];a[s++]=h/3}this.heightData=a}var c=e*i.width,u=t*i.height,f=Math.floor(c),p=Math.floor(u),d=[],m=[];d.push(f),c!=f&&d.push(f+1),m.push(p),u!=p&&m.push(p+1);var g,y=d.length*m.length,v=0;for(n=0;n<d.length;n++)for(s=0;s<m.length;s++)g=m[s]*i.width+d[n],v+=this.heightData[g];return v/=y,v=se.Math.clamp(v,this.minHeight,this.maxHeight),v*=this.heightUnit},getSideIndexMapping:function(){return se.Terrain.SideIndexMapping},refreshUniforms:function(e){e.heightUnit&&(e.heightUnit.value=this.heightUnit)}}),se.Terrain.SideIndexMapping={layer0:0,layer1:1},se.Link=function(e,t,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.fromNode,t=r.toNode,this._id=r.id}else this._id=i;se.Line.call(this),this.setFromNode(e),this.setToNode(t),this._editable=!1},se.extend(se.Link,se.Line,{className:"TGL.Link",___accessor:["linkType","extend","controls"],__SizePropeties:["fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this.onPropertyChange(),this.firePropertyChange("fromNode",t,e),this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange(),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(e){if(e.property.startsWith("position")||"worldMatrix"==e.property){var t=this.vertices;this.onPropertyChange(),this.firePropertyChange("vertices",t,this.vertices)}},computeNodeData:function(){this.computeData()},updateMatrix:function(){},updateWorldMatrix:function(){},computeData:function(){if(null!=this._fromNode&&null!=this._toNode){null==this._extend&&(this._extend=0);var e=this._fromNode.worldMatrix.getPosition(),t=this._toNode.worldMatrix.getPosition(),i=[];if(i.push(e.clone()),"orthogonal.x"==this._linkType){var r=Math.max(e.x,t.x),a=new he(r+this._extend,e.y,e.z);i.push(a),a=new he(r+this._extend,t.y,t.z),i.push(a)}else if("orthogonal.x.n"==this._linkType){var n=Math.min(e.x,t.x),a=new he(n-this._extend,e.y,e.z);i.push(a),a=new he(n-this._extend,t.y,t.z),i.push(a)}else if("orthogonal.y"==this._linkType){var o=Math.max(e.y,t.y),a=new he(e.x,o+this._extend,e.z);i.push(a),a=new he(t.x,o+this._extend,t.z),i.push(a)}else if("orthogonal.y.n"==this._linkType){var s=Math.min(e.y,t.y),a=new he(e.x,s-this._extend,e.z);i.push(a),a=new he(t.x,s-this._extend,t.z),i.push(a)}else if("orthogonal.z"==this._linkType){var l=Math.max(e.z,t.z),a=new he(e.x,e.y,l+this._extend);i.push(a),a=new he(t.x,t.y,l+this._extend),i.push(a)}else if("orthogonal.z.n"==this._linkType){var h=Math.min(e.z,t.z),a=new he(e.x,e.y,h-this._extend);i.push(a),a=new he(t.x,t.y,h-this._extend),i.push(a)}else if("control"==this._linkType){var c=this._controls;if(c&&c.length>0)for(var u=0;u<c.length;u++)c[u]instanceof he&&i.push(c[u].clone())}i.push(t.clone()),this.vertices=i}},onPropertyChange:function(){this.vertices=this.vertices||[],this.computeData(),this.computeBoundingBox(),this.selectionData=null,this.boundingSphere=null}}),se.PathLink=function(e,t,i){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var r=arguments[0];e=r.fromNode,t=r.toNode,this._id=r.id}else this._id=i;se.PathNode.call(this),this._autoAjust=!0,this.setFromNode(e),this.setToNode(t)},se.PathLink.allLinkTypes=["extend.x","extend.y","extend.z","extend.x.n","extend.y.n","extend.z.n","orthogonal.x","orthogonal.y","orthogonal.z","orthogonal.x.n","orthogonal.y.n","orthogonal.z.n","flex.x","flex.y","flex.z","flex.yz","flex.xz","flex.xy"],se.extend(se.PathLink,se.PathNode,{className:"TGL.PathLink",___accessor:["linkType","extend","controls","fromOffset","toOffset"],__SizePropeties:["fromOffset","toOffset","path","segments","radius","segmentsR","startCap","endCap","shape","startCapSize","endCapSize","segmentsCap","arc","arcStart","cutSurface","startCapR","endCapR","startCapExtend","endCapExtend","fromNode","toNode","linkType","extend","controls"],setFromNode:function(e){if(this._fromNode!=e){var t=this._fromNode;this._fromNode=e,this._dirtyPath=!0,this.onPropertyChange("fromNode",t,e),this.firePropertyChange("fromNode",t,e),this._fromNode=e,t&&(t._removeFromLink(this),t.removePropertyChangeListener(this.handleNodePropertyChange)),this._fromNode&&(this._fromNode._addFromLink(this),this._fromNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getFromNode:function(){return this._fromNode},setToNode:function(e){if(this._toNode!=e){var t=this._toNode;this._toNode=e,this.onPropertyChange("toNode",t,e),this.firePropertyChange("toNode",t,e),t&&(t.removePropertyChangeListener(this.handleNodePropertyChange),t._removeToLink(this)),this._toNode&&(this._toNode._addToLink(this),this._toNode.addPropertyChangeListener(this.handleNodePropertyChange,this))}},getToNode:function(){return this._toNode},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},handleNodePropertyChange:function(e){var t=e.source,i=e.property;if(i.startsWith("position")||i.startsWith("rotation")||i.startsWith("scale")||"worldMatrix"==i||"linkAgent"===i||t.isSizeChangedProperty(i)||"parent"===i){this.vertices;this._dirtyPath=!0;var r=this;Te.PATH_LINK_COMPUTE_DELAY?setTimeout(function(){r._computePath()},10):r._computePath()}},_resetPath:function(){if(this.path){if("arrow"!==this.endCap)return this.path;if(this.endCapExtend*this.endCapR>1)return this.path;!0;var e,t,i,r=this.path,a=new se.Path,n=r.actions.length,o=null;for(t=0;t<n-1;t++)i=(e=r.actions[t]).args,o=new se.Vec3(i[0],i[1],i[2]),"moveTo"===e.action?a.moveTo(i[0],i[1],i[2]):"lineTo"===e.action?a.lineTo(i[0],i[1],i[2]):"quadraticCurveTo"===e.action&&(a.curveTo(i[0],i[1],i[2],i[3],i[4],i[5]),o=new se.Vec3(i[3],i[4],i[5]));if(t=n-1,e=r.actions[t],i=e.args,"lineTo"===e.action){var s=new se.Vec3(i[0],i[1],i[2]),l=(new he).subVectors(s,o).normalize(),n=this.radius*this.endCapSize,h=null;h=(new he).subVectors(s,o).length()<n?o.add(l.multiplyScalar(.1)):s.clone().sub(l.multiplyScalar(n)),a.lineTo(h.x,h.y,h.z)}return a}},_getNodeOffset:function(e,t,i){t=e.worldToLocal(t.clone()),i=e.worldToLocal(i.clone());var r=(new he).subVectors(i,t),a=r.length(),n=e.getLinkOffset(r);return n&&n.length()>a&&n.normalize().multiplyScalar(a-.1),n||new he(0,0,0)},updateMatrix:function(){},updateWorldMatrix:function(e,t){},onPropertyChange:function(e,t,i){"fromNode"!==e&&"toNode"!==e&&"linkType"!==e&&"extend"!==e&&"controls"!==e&&"fromOffset"!==e&&"toOffset"!==e||(this._dirtyPath=!0),se.Node.prototype.onPropertyChange.call(this,e,t,i)},computeData:function(){return this._computePath(),se.PathNode.prototype.computeData.call(this)},_clearFromNodeExtend:function(e,t,i){},_flex:function(e,t,i,r,a){e=e.substr(e.indexOf(".")+1);for(var n,o=["x","y","z"],s=new he,l=new he,h=0;h<3;h++)s[n=o[h]]=n===e?r[n]:t[n],l[n]=n===e?r[n]:i[n];a.push(s,l)},_flex2:function(e,t,i,r){var a=["x","y","z"],n=(e=e.substr(e.indexOf(".")+1))[0],o=e[1];if(t[n]!=i[n]){for(var s=new mono.Vec3,l=0;l<a.length;l++)s[a[l]]=a[l]==n?i[a[l]]:t[a[l]];r.push(s)}if(t[o]!=i[o]){for(var h=new mono.Vec3,l=0;l<a.length;l++)h[a[l]]=a[l]==n||a[l]==o?i[a[l]]:t[a[l]];r.push(h)}},_orthogonal:function(e,t,i,r){e=e.substr(e.indexOf(".")+1);var a,n=!1,o=["x","y","z"],s=new he,l=0;e.endsWith(".n")&&(n=!0,e=e[0]);for(var h=n?t[e]:i[e],c=0;c<o.length;c++)(a=o[c])!==e&&t[a]==i[a]&&l++;if(2!==l){for(c=0;c<o.length;c++)s[a=o[c]]=a!==e?h:n?i[a]:t[a];r.push(s)}},_removeSamePoint:function(e){},computeLoopPath:function(e){var t=new mono.Path;return t.moveTo(e.x,e.y,e.z),t.lineTo(e.x,e.y+200,e.z),t.lineTo(e.x+200,e.y+200,e.z),t.lineTo(e.x+200,e.y,e.z),t.lineTo(e.x,e.y,e.z),this.setPath(t),t},_computePath:function(){if(this._dirtyPath&&(this._dirtyPath=!1,null!=this._fromNode&&null!=this._toNode)){null==this._extend&&(this._extend=0);var e=this._fromNode.getLinkAgent()||this._fromNode,t=this._toNode.getLinkAgent()||this._toNode,i=e.localToWorld2(new he(0,0,0)),r=t.localToWorld2(new he(0,0,0));if(e==t)return this.computeLoopPath(i,r);if(!i.equals(r)){var a=[],n=this.radius*this.endCapSize;if(this._linkType&&this._linkType.startsWith("extend")){var o,s,l,h;if("extend.x"===this._linkType){o=new he(1,0,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.x,r.x)+this._extend+n+.1,s=new he(h,i.y,i.z),l=new he(h,r.y,r.z)}else if("extend.y"===this._linkType){o=new he(0,1,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.y,r.y)+this._extend+n+.1,s=new he(i.x,h,i.z),l=new he(r.x,h,r.z)}else if("extend.z"===this._linkType){o=new he(0,0,1);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.max(i.z,r.z)+this._extend+n+.1,s=new he(i.x,i.y,h),l=new he(r.x,r.y,h)}else if("extend.x.n"===this._linkType){o=new he(-1,0,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.x,r.x)-this._extend-n-.1,s=new he(h,i.y,i.z),l=new he(h,r.y,r.z)}else if("extend.y.n"===this._linkType){o=new he(0,-1,0);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.y,r.y)-this._extend-n-.1,s=new he(i.x,h,i.z),l=new he(r.x,h,r.z)}else if("extend.z.n"===this._linkType){o=new he(0,0,-1);var i=e.localToWorld2(e.getLinkExtend(o.clone())),r=t.localToWorld2(t.getLinkExtend(o));h=Math.min(i.z,r.z)-this._extend-n-.1,s=new he(i.x,i.y,h),l=new he(r.x,r.y,h)}s?a.push(i,s,l,r):a.push(i,r)}else{if(a.push(i),"orthogonal.x"===this._linkType)if(i.y==r.y&&i.z==r.z);else{var c=r.x,u=new he(c,i.y,i.z);a.push(u)}else if("orthogonal.x.n"===this._linkType){var c=i.x,u=new he(c,r.y,r.z);a.push(u)}else if("orthogonal.y"===this._linkType){var f=r.y,u=new he(i.x,f,i.z);a.push(u)}else if("orthogonal.y.n"===this._linkType){var f=i.y,u=new he(r.x,f,r.z);a.push(u)}else if("orthogonal.z"===this._linkType){u=new he(i.x,i.y,r.z);a.push(u)}else if("orthogonal.z.n"===this._linkType){u=new he(r.x,r.y,i.z);a.push(u)}var p=new he(i.x+r.x,i.y+r.y,i.z+r.z).multiplyScalar(.5);if("flex.x"!==this._linkType&&"flex.y"!==this._linkType&&"flex.z"!==this._linkType||this._flex(this._linkType,i,r,p,a),"flex.yz"!==this._linkType&&"flex.zy"!==this._linkType&&"flex.xy"!==this._linkType&&"flex.yx"!==this._linkType&&"flex.xz"!==this._linkType&&"flex.zx"!==this._linkType||this._flex2(this._linkType,i,r,a),"control"===this._linkType){var d=this.getControls();Ee.isArray(d)&&(a=a.concat(d))}a.push(r),y=a.length;var m=this._getNodeOffset(e,a[0].clone(),a[1].clone()),g=this._getNodeOffset(t,a[y-1].clone(),a[y-2].clone());i=e.localToWorld2(m),r=t.localToWorld2(g),a[0]=i,a[y-1]=r}var y=a.length,v=this.getFromOffset(),x=this.getToOffset();v&&a[0].add(v),x&&a[y-1].add(x);for(var A,_=new se.Path,w=0;w<y;w++)A=a[w],0===w?_.moveTo(A.x,A.y,A.z):_.lineTo(A.x,A.y,A.z);return this.setPath(_),_}this.setPath(null)}}}),mono.LoadingManager=function(e,i,r){var a=this,n=0,o=0;this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(e){o++},this.itemEnd=function(e){n++,a.onProgress!==t&&a.onProgress(e,n,o),n===o&&a.onLoad!==t&&a.onLoad()}},mono.DefaultLoadingManager=new mono.LoadingManager,mono.ImageLoader=function(e){this.manager=e!==t?e:mono.DefaultLoadingManager},mono.ImageLoader.prototype={constructor:mono.ImageLoader,load:function(e,i,r,a){var n=this,o=document.createElement("img");return i!==t&&o.addEventListener("load",function(t){n.manager.itemEnd(e),i(this)},!1),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==t&&(o.crossOrigin=this.crossOrigin),o.src=e,n.manager.itemStart(e),o},loadFile:function(e,i,r,a){var n=this,o=new FileReader;i!==t&&(o.onload=function(){i(o.result),n.manager.itemEnd(e.name)}),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),o.readAsDataURL(e),n.manager.itemStart(e.name)},setCrossOrigin:function(e){this.crossOrigin=e}},mono.XHRLoader=function(e){this.manager=e!==t?e:mono.DefaultLoadingManager},mono.XHRLoader.prototype={constructor:mono.XHRLoader,load:function(e,i,r,a){var n=this,o=new XMLHttpRequest;i!==t&&o.addEventListener("load",function(t){i(t.target.responseText),n.manager.itemEnd(e)},!1),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),this.crossOrigin!==t&&(o.crossOrigin=this.crossOrigin),o.open("GET",e,!0),o.send(null),n.manager.itemStart(e)},loadFile:function(e,i,r,a){if(e){var n=this,o=new FileReader;i!==t&&(o.onload=function(){i(o.result),n.manager.itemEnd(e.name)}),r!==t&&o.addEventListener("progress",function(e){r(e)},!1),a!==t&&o.addEventListener("error",function(e){a(e)},!1),o.readAsText(e),n.manager.itemStart(e.name)}},setCrossOrigin:function(e){this.crossOrigin=e}},mono.MTLLoader=function(e,t,i){this.baseUrl=e,this.options=t,this.crossOrigin=i},mono.extend(mono.MTLLoader,null,{constructor:mono.MTLLoader,load:function(e,t,i,r){var a=this,n=new mono.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(a.parse(e))})},loadFile:function(e,t,i,r){var a=this;(new mono.XHRLoader).loadFile(e,function(e){t(a.parse(e))})},loadText:function(e,t){t(this.parse(e))},parse:function(e){var t=e.split("\n"),i={},r=/\s+/,a={};this.baseUrl||(this.baseUrl={});for(var n=0;n<t.length;n++){var o=t[n];if(0!==(o=o.trim()).length&&"#"!==o.charAt(0)){var s=o.indexOf(" "),l=s>=0?o.substring(0,s):o;l=l.toLowerCase();var h=s>=0?o.substring(s+1):"";if(h=h.trim(),"newmtl"===l)i={name:h},a[h]=i;else if(i)if("ka"===l||"kd"===l||"ks"===l){var c=h.split(r,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else if("map_kd"===l||"map_ka"===l){var u=h,f=h;if(h.indexOf(".")>0){h=h.substring(0,h.lastIndexOf(".")).toLowerCase();var p={};if(/\-s/.test(h)&&(p=(d=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/).exec(h),h=(m=h.split(p[0]))[m.length-1].trim(),f=(g=u.split(p[0]))[g.length-1].trim()),/\-t/.test(h)){var d=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;p=d.exec(h);var m=h.split(p[0]);h=m[m.length-1].trim();var g=u.split(p[0]);f=g[g.length-1].trim()}}this.baseUrl[h]||(this.baseUrl[h]=f),i[l]=u}else i[l]=h}}var y=new mono.MTLLoader.MaterialCreator(this.baseUrl,this.options);return y.setMaterials(a),y}}),mono.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:mono.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:mono.RepeatWrapping},mono.extend(mono.MTLLoader.MaterialCreator,mono.EventDispatcher,{constructor:mono.MTLLoader.MaterialCreator,setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],a={};t[i]=a;for(var n in r){var o=!0,s=r[n],l=n.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(o=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s)}o&&(a[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return this.materials[e]===t&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],r={name:e,side:this.side};for(var a in i){var n=i[a];switch(a.toLowerCase()){case"kd":r.diffuse=(new mono.Color).setRGB(n[0],n[1],n[2]);break;case"ka":r.ambient=(new mono.Color).setRGB(n[0],n[1],n[2]);break;case"ks":r.specular=(new mono.Color).setRGB(n[0],n[1],n[2]);break;case"map_kd":if("string"==typeof this.baseUrl)r.map={},r.map.img=this.baseUrl+n,r.map.wrapS=this.wrap,r.map.wrapT=this.wrap;else if("object"==typeof this.baseUrl&&n.indexOf(".")>0){n=n.substring(0,n.lastIndexOf(".")).toLowerCase();var o={};if(/\-s/.test(n)&&(o=(s=/\-s( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/).exec(n),n=(l=n.split(o[0]))[l.length-1].trim(),o.repeatR=parseInt(o[1]),o.repeatC=parseInt(o[2])),/\-t/.test(n)){var s=/\-t( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;o=s.exec(n);var l=n.split(o[0]);n=l[l.length-1].trim(),o.repeatR=parseInt(o[1]),o.repeatC=parseInt(o[2])}this.baseUrl[n]&&(r.map={},r.map.img=this.baseUrl[n],r.map.wrapS=t.wrap,r.map.wrapT=t.wrap,r.map.repeatR=o.repeatR||1,r.map.repeatC=o.repeatC||1)}break;case"ns":r.shininess=n;break;case"d":n<1&&(r.transparent=!0,r.opacity=n)}}return r.diffuse&&(r.ambient||(r.ambient=r.diffuse),r.color=r.diffuse),this.materials[e]=r,this.materials[e]},loadTexture:function(e,t,i,r){if(/\.dds$/i.test(e))n=mono.ImageUtils.loadCompressedTexture(e,t,i,r);else{var a=new Image,n=new mono.Texture(a,t),o=new mono.ImageLoader;o.crossOrigin=this.crossOrigin,o.load(e,function(e){n.image=mono.MTLLoader.ensurePowerOfTwo_(e),n.needsUpdate=!0,i&&i(n)})}return n}}),mono.MTLLoader.ensurePowerOfTwo_=function(e){if(!mono.MTLLoader.isPowerOfTwo_(e.width)||!mono.MTLLoader.isPowerOfTwo_(e.height)){var t=document.createElement("canvas");return t.width=mono.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=mono.MTLLoader.nextHighestPowerOfTwo_(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},mono.MTLLoader.isPowerOfTwo_=function(e){return 0==(e&e-1)},mono.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},mono.OBJMTLLoader=function(){},mono.extend(mono.OBJMTLLoader,mono.MTLLoader,{constructor:mono.OBJMTLLoader,load:function(e,t,i,r,a,n){var o=this;new mono.MTLLoader(i).load(t,function(t){var a=t;a.preload();var n=new mono.XHRLoader(o.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(t){var n=o.parse(t),s="";!i&&e.lastIndexOf("/")>0&&(s=e.substring(0,e.lastIndexOf("/")+1));for(var l=0;l<n._childList._as.length;l++){var h=n._childList._as[l];if(h.mname){var c=a.create(h.mname);o.setGeometryStyle(h,c,s)}for(var u=0;u<h._childList._as.length;u++){var f=h._childList._as[u];if(f.mname){var p=a.create(f.mname);o.setGeometryStyle(f,p,s)}}}r(n)})})},setGeometryStyle:function(e,t,i){if(t.map){i?this.loadTexture(e,i+t.map.img):this.loadTexture(e,t.map.img);var r=t.map.repeatR,a=t.map.repeatC;r&&a&&(e.setStyle("m.texture.repeat",new mono.Vec2(r,a)),e.setStyle("m.texture.wrapS",se.RepeatWrapping),e.setStyle("m.texture.wrapT",se.RepeatWrapping))}e.setStyle("m.ambient",t.ambient),e.setStyle("m.specular",t.specular),e.setStyle("m.color",t.color),t.transparent&&(e.setStyle("m.transparent",!0),e.setStyle("m.opacity",t.opacity))},loadBase64:function(e,t,i,r,a,n){var o=this,s=mono.base64decode(t),l=mono.base64decode(e);new mono.MTLLoader(i).loadText(s,function(e){var t=e;t.preload();var a=o.parse(l),n="";!i&&url.lastIndexOf("/")>0&&(n=url.substring(0,url.lastIndexOf("/")+1));for(var s=0;s<a._childList._as.length;s++){var h=a._childList._as[s];if(h.mname){var c=t.create(h.mname);o.setGeometryStyle(h,c,n)}for(var u=0;u<h._childList._as.length;u++){var f=h._childList._as[u];if(f.mname){var p=t.create(f.mname);o.setGeometryStyle(f,p,n)}}}r(a)})},loadFiles:function(e,t,i,r,a,n){var o=this;new mono.MTLLoader(i).loadFile(t,function(t){var i=t;i.preload(),new mono.XHRLoader(o.manager).loadFile(e,function(e){for(var t=o.parse(e),a=0;a<t._childList._as.length;a++){var n=t._childList._as[a];if(n.mname){var s=i.create(n.mname);o.setGeometryStyle(n,s)}for(var l=0;l<n._childList._as.length;l++){var h=n._childList._as[l];if(h.mname){var c=i.create(h.mname);o.setGeometryStyle(h,c)}}}r(t)})})},loadTexture:function(e,t){"string"==typeof t?e.setStyle("m.texture.image",t):e&&t&&(new mono.ImageLoader).loadFile(t,function(t){e.setStyle("m.texture.image",t)})},parse:function(e,i){function r(e,t,i){return new mono.Vec3(e,t,i)}function a(e,t,i,r,a){return new mono.Face3(e,t,i,r,null,a)}function n(e,i){if(p.length>0&&(f.vertices=p,y.length>0&&(f.setMaterialSize(y.length),f.setStyle("m.normalType",se.NormalTypeSmooth)),f.computed=!1,f.computeCentroids(),f.computeFaceNormals(),f.computeBoundingSphere(),f.faces.length>0)){var r=f._name;u.addChild(f),(f=new mono.Entity)._name=r,f.setStyle("m.type","phong"),d=0}e!==t&&(f._name=e),f.setClient("name",e),i!==t&&(f.mname=i)}function o(e,i,r,n,o){n===t?f.faces.push(a(parseInt(e)-(h+1),parseInt(i)-(h+1),parseInt(r)-(h+1))):f.faces.push(a(parseInt(e)-(h+1),parseInt(i)-(h+1),parseInt(r)-(h+1),[m[parseInt(n[0])-1].clone(),m[parseInt(n[1])-1].clone(),m[parseInt(n[2])-1].clone()],o))}function s(e,t,i){f.uvs.push([g[parseInt(e)-1].clone(),g[parseInt(t)-1].clone(),g[parseInt(i)-1].clone()])}function l(e,i,r){var a=y.length>0?y.indexOf(v):0;e[3]===t?(o(e[0],e[1],e[2],r,a),i!==t&&i.length>0&&s(i[0],i[1],i[2])):(r!==t&&r.length>0?(o(e[0],e[1],e[3],[r[0],r[1],r[3]],a),o(e[1],e[2],e[3],[r[1],r[2],r[3]],a)):(o(e[0],e[1],e[3]),o(e[1],e[2],e[3])),i!==t&&i.length>0&&(s(i[0],i[1],i[3]),s(i[1],i[2],i[3])))}var h=0,c=new mono.Entity,u=c,f=new mono.Entity;f.setStyle("m.type","phong");for(var p=[],d=0,m=[],g=[],y=[],v=0,x=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,A=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,_=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,w=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,b=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,M=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,S=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,P=/s( +(\d))?/,C=e.split("\n"),T=0;T<C.length;T++){var E,z=C[T];if(0!==(z=z.trim()).length&&("#"!==z.charAt(0)||"o"==z.charAt(2)))if(null!==(E=x.exec(z)))p.push(r(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=A.exec(z)))m.push(r(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])));else if(null!==(E=_.exec(z)))g.push(function(e,t){return new mono.Vec2(e,t)}(parseFloat(E[1]),parseFloat(E[2])));else if(null!==(E=w.exec(z)))l([E[1],E[2],E[3],E[4]]);else if(null!==(E=b.exec(z)))l([E[2],E[5],E[8],E[11]],[E[3],E[6],E[9],E[12]]);else if(null!==(E=M.exec(z)))l([E[2],E[6],E[10],E[14]],[E[3],E[7],E[11],E[15]],[E[4],E[8],E[12],E[16]]);else if(null!==(E=S.exec(z)))l([E[2],E[5],E[8],E[11]],[],[E[3],E[6],E[9],E[12]]);else if("#"===z.charAt(0)&&"o"===z.charAt(2))n(),h+=p.length,p=[],(u=new mono.Entity)._name=z.substring(2).trim(),c.addChild(u);else if(/^g /.test(z))n(z.substring(2).trim(),t);else if(/^usemtl /.test(z))n(t,z.substring(7).trim());else if(/^mtllib /.test(z)){if(i){var D=z.substring(7);i(D=D.trim())}}else/^s /.test(z)&&(E=P.exec(z),y.indexOf(E[2])<0&&y.push(E[2]),v=E[2])}return n(t,t),c}});mono.DaeAdapter=function(){function e(e,t,a){O=e,C(),j=u(),(Y=new o).parse();var n=U();if(q=E(),H=D(),K=r(),Y)for(var s=0;s<Y.nodes.length;s++)i(Y.nodes[s]);var l={lights:n,visualScenes:Y,images:q,materials:K,geometries:j,entityies:Q};t&&t(l)}function i(e,t){if(e){for(var r={},a=0;a<e.geometries.length;a++){var n,o=e.geometries[a],s=o.instance_material,l=j[o.url],h={},c=[],u=0;if(l){if(!l.mesh||!l.mesh.primitives)continue;if(s)for(S=0;S<s.length;S++){var f=s[S],p=K[f.target],d=p.instance_effect.url,m=H[d].shader.material;if(l.doubleSided){if(!(f.symbol in r)){var g=m.clone();g.side=mono.DoubleSide,r[f.symbol]=g}m=r[f.symbol]}m.opacity=m.opacity?m.opacity:1,h[f.symbol]=u,c.push(m),(n=m).name=null==p.name||""===p.name?p.id:p.name,u++}var y=n||new mono.LambertMaterial({color:14540253,shading:mono.FlatShading,side:l.doubleSided?mono.DoubleSide:mono.FrontSide}),v=l.mesh.node3D;if(u>1)for(y=new mono.ArrayMaterial(c),S=0;S<v.faces.length;S++){var x=v.faces[S];x.materialIndex=h[x.daeMaterial]}y instanceof mono.ArrayMaterial&&v.setMaterialSize(y.materials.length),v.createMaterial(y),v.matrix=e.matrix,v.matrix.decompose(v._position,v.quaternion,v.scale);var A=v.quaternion;if(A){var _=A.x*A.x,w=A.y*A.y,b=A.z*A.z,M=A.w*A.w;v._rotation.x=Math.atan2(2*(A.x*A.w-A.y*A.z),M-_-w+b),v._rotation.y=Math.asin(mono.Math.clamp(2*(A.x*A.z+A.y*A.w),-1,1)),v._rotation.z=Math.atan2(2*(A.z*A.w-A.x*A.y),M+_-w-b)}Q.push(v)}}for(var S=0;S<e.nodes.length;S++)i(e.nodes[S],e)}}function r(){var e=O.querySelectorAll("library_materials material"),t={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=e[i];if(r){var n=(new a).parse(r);n&&(t[n.id]=n)}}return t}function a(){this.id="",this.name="",this.instance_effect=null}function n(){this.url=""}function o(){this.nodes=[],this.id="",this.name=""}function s(){this.nodes=[],this.id="",this.name="",this.sid="",this.type="",this.controllers=[],this.geometries=[],this.type="",this.layer="",this.matrix=new mono.Mat4,this.transforms=[]}function l(){this.sid="",this.type="",this.data=[]}function h(){this.url="",this.instance_material=[]}function c(){this.symbol="",this.target=""}function u(){var e={};e.entity=[];var t=O.querySelectorAll("library_geometries geometry");if(t&&t.length>0)for(var i=0;i<t.length;i++){var r=(new f).parse(t[i]);r&&(e[r.id]=r,e.entity.push(r))}return e}function f(){this.id="",this.mesh=null}function p(){this.sources={},this.primitives=[],this.vertices=null,this.node3D=null}function d(e,t){var i=[e[t],e[t+1],e[t+2]];return m(i,-1),new mono.Vec3(i[0],i[1],i[2])}function m(e,t){if(!0===J.convertUpAxis&&X!==J.upAxis)switch(G){case"XtoY":i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function g(){this.id="",this.input={}}function y(){this.semantic="",this.offset=0,this.source="",this.set=0}function v(){this.inputs=[],this.count=0,this.p=[],this.material=""}function x(){v.call(this),this.vcount=3}function A(){this.id,this.dataType,this.technique_common={},this.accessor=null,this.data=[]}function _(){this.source="",this.count=0,this.stride=0,this.params=[]}function w(e){return e?parseInt(e,10):0}function b(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function M(e){var i=[];if(!e)return e;if((e=b(e)).length>0)for(var r=e.split(/\s+/),a=0;a<r.length;a++){var n=r[a];n!=t&&null!=n&&null!=parseFloat(n)&&i.push(parseFloat(n))}return i}function S(e){var i=[];if(!e)return[];if((e=b(e)).length>0)for(var r=e.split(/\s+/),a=0;a<r.length;a++){var n=r[a];n!=t&&null!=n&&null!=parseInt(n)&&i.push(parseInt(n))}return i}function P(e){var t=[];if(!e)return[];if((e=b(e)).length>0)for(var i=e.split(/\s+/),r=0;r<i.length;r++)t.push("true"==i[r]||"1"==i[r]);return t}function C(){if(!0!==J.convertUpAxis||X===J.upAxis)G=null;else switch(X){case"X":G="Y"===J.upAxis?"XtoY":"XtoZ";break;case"Y":G="X"===J.upAxis?"YtoX":"YtoZ";break;case"Z":G="X"===J.upAxis?"ZtoX":"ZtoY"}}function T(e){if(J.convertUpAxis){var t=[e[0],e[4],e[8]];m(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],m(t=[e[1],e[5],e[9]],-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],m(t=[e[2],e[6],e[10]],-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],m(t=[e[0],e[1],e[2]],-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],m(t=[e[4],e[5],e[6]],-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],m(t=[e[8],e[9],e[10]],-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],m(t=[e[3],e[7],e[11]],-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new mono.Mat4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function E(){var e=O.querySelectorAll("library_images image"),t={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=(new z).parse(r);t[a.id]=a}}return t}function z(){this.id="",this.init_from=""}function D(){var e=O.querySelectorAll("library_effects effect"),t={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=(new L).parse(r);t[a.id]=a}}return t}function L(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function R(e,t){this.type=e,this.effect=t,this.material=null}function N(){this.color=new mono.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function B(e){this.effect=e,this.init_from=null,this.format=null}function I(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function F(e){for(var i=O.querySelectorAll("library_nodes node"),r=0;r<i.length;r++){var a=i[r].attributes.getNamedItem("id");if(a&&a.value===e)return i[r]}return t}function V(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function U(){var e=[],t=O.querySelectorAll("library_lights light");if(t&&t.length>0)for(var i=0;i<t.length;i++){t[i];var r=(new k).parse(t);e.push(r)}return e}function k(){this.id="",this.name="",this.technique=""}this.id="",this.name="",this.type="";var O=null,X="Y",G=null,Y=null,W={},j={},H={},q={},Z="",Q=[],K={},J={};return a.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"==e.childNodes[t].nodeName){this.instance_effect=(new n).parse(e.childNodes[t]);break}return this},n.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},o.prototype.parse=function(){var e=O.querySelectorAll("library_visual_scenes visual_scene");if(!e||e.length<0)return this;this.id="",this.name="";for(var t=0;t<e.length;t++){var i=e[t];if(i&&i.childNodes&&i.childNodes.length>0)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"node":this.nodes.push((new s).parse(a))}}}return this},s.prototype.parse=function(e){if(!e)return this;if(this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"node":this.nodes.push((new s).parse(i));break;case"instance_camera":case"instance_controller":break;case"instance_geometry":this.geometries.push((new h).parse(i));break;case"instance_light":break;case"instance_node":var r=F(i.getAttribute("url").replace(/^#/,""));r&&this.nodes.push((new s).parse(r));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new l).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.updateMatrix(),this},s.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},l.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=M(e.textContent),this.convert(),this},l.prototype.convert=function(){switch(this.type){case"matrix":this.obj=T(this.data);break;case"rotate":this.angle=mono.Math.degToRad(this.data[3]);case"translate":m(this.data,-1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;case"scale":m(this.data,1),this.obj=new mono.Vec3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},l.prototype.apply=function(){var e=new mono.Mat4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),l.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=mono.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=mono.Math.degToRad(e[3])}}},h.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"==i.nodeName){for(var r=i.querySelectorAll("instance_material"),a=0;a<r.length;a++){var n=r[a];this.instance_material.push((new c).parse(n))}break}}return this},c.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},f.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&"mesh"==i.nodeName){var r=(new p).parse(i);r&&(this.mesh=r)}}return this},p.prototype.parse=function(e){if(e&&e.childNodes&&e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":var r=i.getAttribute("id");this.sources[r]=(new A).parse(i);break;case"vertices":var a=new g;this.vertices=a.parse(i);break;case"polygons":var n=(new v).parse(i);n&&this.primitives.push(n);break;case"triangles":var o=(new x).parse(i);o&&this.primitives.push(o);break;case"polylist":this.primitives.push(null)}}this.node3D=new mono.Entity;var s=null;for(this.vertices&&this.vertices.input&&this.vertices.input.POSITION&&(s=this.sources[this.vertices.input.POSITION.source].data),t=0;t<this.primitives.length;t++){var l=this.primitives[t];l.setVertices(this.vertices),this.handlePrimitive(l,this.node3D)}for(t=0;t<s.length;t+=3)this.node3D.vertices.push(d(s,t).clone());return this.node3D.computeFaceNormals(),this},p.prototype.handlePrimitive=function(e,i){var r,a,n,o,s,l,h,c=e.p,u=e.inputs,f=0,p=3,m=0,g=[];for(r=0;r<u.length;r++){var y=(n=u[r]).offset+1;switch(m=m<y?y:m,n.semantic){case"TEXCOORD":g.push(n.set)}}for(var v=0;v<c.length;++v)for(var x=c[v],A=0;A<x.length;){var _=[],w=[],b=null,M=[];for(p=e.vcount?e.vcount.length?e.vcount[f++]:e.vcount:x.length/m,r=0;r<p;r++)for(a=0;a<u.length;a++)switch(n=u[a],l=this.sources[n.source],o=x[A+r*m+n.offset],h=l.accessor.params.length,s=o*h,n.semantic){case"VERTEX":_.push(o);break;case"NORMAL":w.push(d(l.data,s));break;case"TEXCOORD":(b=b||{})[n.set]===t&&(b[n.set]=[]),b[n.set].push(new mono.Vec2(l.data[s],l.data[s+1]));break;case"COLOR":M.push((new mono.Color).setRGB(l.data[s],l.data[s+1],l.data[s+2]))}if(0==w.length)if(n=this.vertices.input.NORMAL){h=(l=l[n.source]).accessor.params.length;for(var S=0,P=_.length;S<P;S++)w.push(d(l.data,_[S]*h))}else i.calcNormals=!0;if(!b&&(b={},n=this.vertices.input.TEXCOORD)){g.push(n.set),h=(l=sources[n.source]).accessor.params.length;for(var S=0,P=_.length;S<P;S++)s=_[S]*h,b[n.set]===t&&(b[n.set]=[]),b[n.set].push(new mono.Vec2(l.data[s],1-l.data[s+1]))}if(0==M.length&&(n=this.vertices.input.COLOR)){h=(l=sources[n.source]).accessor.params.length;for(var S=0,P=_.length;S<P;S++)s=_[S]*h,M.push((new mono.Color).setRGB(l.data[s],l.data[s+1],l.data[s+2]))}var C,T,E=null,z=[];if(3===p)z.push(new mono.Face3(_[0],_[1],_[2],w,M.length?M:new mono.Color(16711680)));else if(4===p)z.push(new mono.Face3(_[0],_[1],_[3],[w[0],w[1],w[3]],M.length?[M[0],M[1],M[3]]:new mono.Color(16711680))),z.push(new mono.Face3(_[1],_[2],_[3],[w[1],w[2],w[3]],M.length?[M[1],M[2],M[3]]:new mono.Color(16711680)));else if(p>4&&J.subdivideFaces){var D=M.length?M:new mono.Color;for(a=1;a<p-1;)z.push(new mono.Face3(_[0],_[a],_[a+1],[w[0],w[a++],w[a]],D))}if(z.length)for(var S=0,P=z.length;S<P;S++)for((E=z[S]).daeMaterial=e.material,i.faces.push(E),a=0;a<g.length;a++)C=b[g[a]],T=p>4?[C[0],C[S+1],C[S+2]]:4===p?0===S?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],i.uvs===t&&(i.uvs=[]),i.uvs.push(T);else console.log("dropped face with vcount "+p+" for geometry with id: "+i.id);A+=m*p}},g.prototype.parse=function(e){if(e&&(this.id=e.getAttribute("id"),e.childNodes.length>0))for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new y).parse(i);this.input[r.semantic]=r}}return this},y.prototype.parse=function(e){return e&&(this.semantic=e.getAttribute("semantic"),this.offset=w(e.getAttribute("offset")),this.set=w(e.getAttribute("set")),this.source=e.getAttribute("source").replace(/^#/,""),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0)),this},v.prototype.parse=function(e){if(e&&(this.count=e.getAttribute("count"),this.material=e.getAttribute("material"),e.childNodes.length>0))for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"input":var r=(new y).parse(i);r&&this.inputs.push(r);break;case"p":this.p.push(S(i.textContent))}}return this},v.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},x.prototype=Object.create(v.prototype),A.prototype.parse=function(e){if(!e)return this;if(this.id=e.getAttribute("id"),e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"float_array":this.dataType=i.nodeName,this.data=M(i.textContent);break;case"bool_array":this.dataType=i.nodeName,this.data=P(i.textContent);break;case"int_array":this.data=S(i.textContent),this.dataType=i.nodeName;break;case"technique_common":if(i.childNodes&&i.childNodes.length>0)for(var r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];if(a&&a.nodeName)switch(a.nodeName){case"accessor":var n=(new _).parse(a);n.source&&(this.technique_common[n.source]=n,this.accessor=n)}}}}return this},A.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var r=T(this.data.slice(i,i+16));e.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},_.prototype.parse=function(e){if(!e)return this;if(this.source=e.getAttribute("source"),this.count=w(e.getAttribute("count")),this.stride=w(e.getAttribute("stride")),e.childNodes.length>0)for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(i&&i.nodeName)switch(i.nodeName){case"param":var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},z.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},L.prototype.create=function(){if(null==this.shader)return null},L.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),V(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},L.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[t]=new B(this).parse(r);break;case"sampler2D":this.sampler[t]=new I(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},L.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var a=(new z).parse(r);q[a.id]=a;break;case"extra":break;default:console.log(r.nodeName)}}return t},L.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new R(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},L.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},L.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(i)}}},R.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new N).parse(i);break;case"bump":var r=i.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new N).parse(i):"normalmap"===r.toLowerCase()?this.normal=(new N).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new N).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new N).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a=i.querySelectorAll("float");a.length>0&&(this[i.nodeName]=parseFloat(a[0].textContent))}}return this.create(),this},R.prototype.create=function(){var e={},i=!1;if(this.transparency!==t&&this.transparent!==t){this.transparent;var r=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;r>0&&(i=!0,e.transparent=!0,e.opacity=1-r)}var a={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var n in this)switch(n){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var o=this[n];if(o instanceof N)if(o.isTexture()){var s=o.texture,l=this.effect.sampler[s],h=null;if(l!==t&&l.source!==t){var c=this.effect.surface[l.source];h=q[c.init_from]}else h=q[s];if(h){var u=Z+h.init_from,f=new Image;f.loaded=!1;var p=new mono.Texture;p._imageSrc=u,p._image=f,p.setImage(u),p.wrapS=o.texOpts.wrapU?mono.RepeatWrapping:mono.ClampToEdgeWrapping,p.wrapT=o.texOpts.wrapV?mono.RepeatWrapping:mono.ClampToEdgeWrapping,p.offsetX=o.texOpts.offsetU,p.offsetY=o.texOpts.offsetV,p.repeatX=o.texOpts.repeatU,p.repeatY=o.texOpts.repeatV,e[a[n]]=p,"emission"===n&&(e.emissive=16777215)}}else"diffuse"!==n&&i||("emission"===n?e.emissive=o.color.getHex():e[n]=o.color.getHex());break;case"shininess":e[n]=this[n];break;case"reflectivity":e[n]=this[n],e[n]>0&&(e.envMap=J.defaultEnvMap),e.combine=mono.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[n],1!==this[n]&&(e.envMap=J.defaultEnvMap)}switch(e.shading=mono.SmoothShading,e.side=this.effect.doubleSided?mono.DoubleSide:mono.FrontSide,this.type){case"constant":e.emissive!=t&&(e.color=e.emissive),this.material=new mono.EntityMaterial(e);break;case"phong":case"blinn":e.diffuse!=t&&(e.color=e.diffuse),this.material=new mono.EntityMaterial(e);break;case"lambert":default:e.diffuse!=t&&(e.color=e.diffuse),this.material=new mono.LambertMaterial(e)}return this.material},N.prototype.isColor=function(){return null==this.texture},N.prototype.isTexture=function(){return null!=this.texture},N.prototype.parse=function(e){"transparent"==e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=M(i.textContent);this.color=new mono.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},N.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1]).childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},B.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},I.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},k.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},k.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var a=i.childNodes[r];switch(a.nodeName){case"color":var n=M(a.textContent);this.color=new mono.Color(0),this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"falloff_angle":this.falloff_angle=parseFloat(a.textContent);break;case"quadratic_attenuation":var o=parseFloat(a.textContent);this.distance=o?Math.sqrt(1/o):0}}}return this},k.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},{load:function(i,r,a){var n=0;if(i!==t){var o=i.split("/");o.pop(),Z=(o.length<1?".":o.join("/"))+"/"}var s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState?0!=s.status&&200!=s.status||(s.responseXML?e(s.responseXML,r,i):s.responseText?e((new DOMParser).parseFromString(s.responseText,"application/xml"),r,i):console.error("ColladaLoader: Empty or non-existing file ("+i+")")):3==s.readyState&&a&&(0==n&&(n=s.getResponseHeader("Content-Length")),a({total:n,loaded:s.responseText.length}))},s.open("GET",i,!0),s.send(null)},parse:e,geometries:W,options:J}};se.DataBox=function(e){se.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=e),this._dataList=new _e,this._dataMap={},this._rootList=new _e,this._rootMap={},this._clientMap={},this._lightList=new _e,this._flareList=new _e,this._billboardList=new _e,this._nodeList=new _e,this._annotationList=new _e,this._particleList=new _e,this.nodes=[],this.particles=[],this.billboards=[],this._dataBoxChangeDispatcher=new se.EventDispatcher,this._dataPropertyChangeDispatcher=new se.EventDispatcher,this._groupLists={},this.selection=new _e,this instanceof se.AlarmBox||(this._selectionModel=new se.SelectionModel(this),this._alarmBox=new se.AlarmBox(this),this._alarmStatePropagator=new se.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0)),this.batch=!1,this._clientMap={}},se.extend(se.DataBox,se.PropertyChangeDispatcher,{constructor:se.DataBox,className:"TGL.DataBox",___accessor:["name"],add:function(e,t){if(e){1===arguments.length&&(t=-1);var i=e.getId();if(this._dataMap.hasOwnProperty(i)){if(this._dataMap[i]!==e)throw"Data with ID '"+i+"' already exists"}else this._dataMap[i]=e,this._dataList.add(e),e.getParent()||(this._rootMap[i]=e,t>=0?this._rootList.add(e,t):this._rootList.add(e)),e instanceof se.Billboard?this._billboardList.add(e):e instanceof se.LensFlare?this._flareList.add(e):e instanceof se.Node?this._nodeList.add(e):e instanceof se.Particle?this._particleList.add(e):e instanceof se.Annotation?this._annotationList.add(e):e instanceof se.Light&&this._lightList.add(e),this._dataBoxChangeDispatcher.fire({kind:"add",data:e,source:this}),e.getGroupId()&&this.groupElements(e,null,e.getGroupId()),e.addPropertyChangeListener(this.handleDataPropertyChange,this),e._selected=!1}},onPropertyChange:function(){},firePropertyChange:function(){},addByDescendant:function(e,t){t&&0==t(e)||e&&(this.add(e),e.getChildren().size()>0&&e.getChildren().forEach(function(e){this.addByDescendant(e,t)},this))},getAlarmBox:function(){return this._alarmBox},removeById:function(e,t){var i=this.getDataById(e);this.remove(i,t)},remove:function(e,t){if(e&&this._dataMap.hasOwnProperty(e.getId())){e instanceof se.Link&&(e.setFromNode(null),e.setToNode(null)),e instanceof se.Node&&e.getLinks()&&e.getLinks().toList().forEach(function(e){this.remove(e)},this),t&&(e.getChildren().forEach(function(t){e.removeChild(t)},this),e.getParent()&&e.getParent().removeChild(e)),this._dataList.remove(e);var i=e._id;delete this._dataMap[i],this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(e)),e instanceof se.Billboard?this._billboardList.remove(e):e instanceof se.Node?this._nodeList.remove(e):e instanceof se.Particle?this._particleList.remove(e):e instanceof se.Annotation?this._annotationList.remove(e):e instanceof se.Light?this._lightList.remove(e):e instanceof se.LensFlare&&this._flareList.remove(e),e.getGroupId()&&this.groupElements(e,e.getGroupId(),null),e.removePropertyChangeListener(this.handleDataPropertyChange,this),this._dataBoxChangeDispatcher.fire({kind:"remove",data:e,source:this}),this._selectionModel&&this._selectionModel.removeSelection(e)}},removeByDescendant:function(e,t,i){if(e){var r=this;e.hasChildren()&&e.getChildren().forEachReverse(function(e){r.removeByDescendant(e,t,i)}),i&&0==i(e)||this.remove(e,t)}},containsById:function(e){return this._dataMap.hasOwnProperty(e)},contains:function(e){return!!e&&this._dataMap[e._id]===e},lightsSize:function(){return this._lightList.size()},getLights:function(){return this._lightList},getLightsArray:function(){return this._lightList.toArray()},getAnnotations:function(){return this._annotationList},clear:function(e){if(this._dataList.size()>0){var t=this._dataList.toList(function(t){return!this._lightList.contains(t)||e},this);if(t.forEach(function(e){e.removePropertyChangeListener(this.handleDataPropertyChange,this)},this),this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._nodeList.clear(),this._billboardList.clear(),e)this._lightList.clear(),this._flareList.clear();else{var i=this;this._lightList.forEach(function(e){i._dataList.add(e);var t=e.getId();i._dataMap[t]=e,null==e.getParent()&&(i._rootList.add(e),i._rootMap[t]=e)})}this._dataBoxChangeDispatcher.fire({kind:"clear",datas:t}),this.clearSelection()}},startBatch:function(){this.batch=!0},endBatch:function(){this.batch=!1,this._dataBoxChangeDispatcher.fire({kind:"batchEnd"})},removeSelection:function(){this._selectionModel.toSelection().forEach(function(e){this.remove(e)},this)},clearSelection:function(){this._selectionModel&&this._selectionModel.clearSelection()},clearEditing:function(){this._nodeList.forEach(function(e){e.editing=!1}),this._billboardList.forEach(function(e){e.editing=!1})},getDataById:function(e){return this._dataMap[e]},groupElements:function(e,t,i){var r;t&&(r=this._groupLists[t])&&(r.remove(e),r.isEmpty()&&delete this._groupLists[t]),i&&(null==(r=this._groupLists[i])&&(r=new _e,this._groupLists[i]=r),r.contains(e)||r.add(e))},synchronizeGroup:function(e,t,i,r){if(!this.isAdjustingGroup){this.isAdjustingGroup=!0;var a=e.getGroupId(),n=new se.Vec3;if(a){var o=this._groupLists[a];o&&o.size()>1&&o.forEach(function(a){a===e||a.isDescendantOf(e)||e.isDescendantOf(a)||(n.subVectors(i,t),a[se.setter(r)](a[se.getter(r)]().clone().add(n)))})}this.isAdjustingGroup=!1}},handleDataPropertyChange:function(e){var t=e.source;if("parent"===e.property){var i=t.getId();t.getParent()?this._rootMap[i]&&(delete this._rootMap[i],this._rootList.remove(t)):this._rootMap[i]||(this._rootMap[i]=t,this._rootList.add(t))}else if("groupId"===e.property){var r=e.oldValue,a=e.newValue;this.groupElements(t,r,a)}else"position"===e.property||"scale"===e.property||"rotation"===e.property?this.synchronizeGroup(t,e.oldValue,e.newValue,e.property):"selected"===e.property&&(t._selected?this._selectionModel.appendSelection(t):this._selectionModel.removeSelection(t));this.onDataPropertyChanged(t,e),this._dataPropertyChangeDispatcher.fire(e)},onDataPropertyChanged:function(e,t){},addDataBoxChangeListener:function(e,t,i){this._dataBoxChangeDispatcher.add(e,t,i)},removeDataBoxChangeListener:function(e,t){this._dataBoxChangeDispatcher.remove(e,t)},addDataPropertyChangeListener:function(e,t,i){this._dataPropertyChangeDispatcher.add(e,t,i)},removeDataPropertyChangeListener:function(e,t){this._dataPropertyChangeDispatcher.remove(e,t)},allocateLights:function(){var e,t,i,r,a,n;i=r=a=0;var o=this._lightList;for(e=0,t=o.size();e<t;e++)(n=o.get(e)).onlyShadow||(n instanceof se.DirectionalLight&&i++,n instanceof se.PointLight&&r++,n instanceof se.SpotLight&&a++);return{directional:i,point:r,spot:a,hemi:0}},allocateShadows:function(){var e,t,i,r=0,a=this._lightList;for(e=0,t=a.size();e<t;e++)(i=a.get(e)).castShadow&&(i instanceof se.SpotLight&&r++,i instanceof se.DirectionalLight&&!i.shadowCascade&&r++);return r},allocatePointShadows:function(){var e,t,i,r=0,a=this._lightList;for(e=0,t=a.size();e<t;e++)(i=a.get(e)).castShadow&&i instanceof se.PointLight&&r++;return r},getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(e){var t=this._limit;this._limit=e,this.firePropertyChange("limit",t,e),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(e){for(0===arguments.length&&(e=1);e>0&&this._dataList.size()>0;){var t=this._dataList.get(0);this.remove(t),e--}},getSiblings:function(e){if(!this.contains(e))throw e+" dosen't belong to this dataBox";var t=e.getParent();return t?t.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(e){return e.getParent()?e.getParent().getChildren().indexOf(e):this._rootList.indexOf(e)},getNodes:function(){return this._nodeList},getBillboards:function(){return this._billboardList},getLensFlares:function(){return this._flareList},getDatas:function(){return this._dataList},getDataAt:function(e){return this._dataList.get(e)},toDatas:function(e,t){return this._dataList.toList(e,t)},forEach:function(e,t){this._dataList.forEach(e,t)},forEachReverse:function(e,t){this._dataList.forEachReverse(e,t)},forEachByDepthFirst:function(e,t,i){if(t)this._depthFirst(e,t,i);else for(var r=this._rootList.size(),a=0;a<r;a++){var n=this._rootList.get(a);if(!1===this._depthFirst(e,n,i))return}},_depthFirst:function(e,t,i){for(var r=t.getChildrenSize(),a=0;a<r;a++){var n=t.getChildAt(a);if(!1===this._depthFirst(e,n,i))return!1}if(i){if(!1===e.call(i,t))return!1}else if(!1===e(t))return!1},forEachByBreadthFirst:function(e,t,i){var r=new _e;for(t?r.add(t):this._rootList.forEach(r.add,r);r.size()>0;)if((t=r.removeAt(0)).getChildren().forEach(r.add,r),i){if(!1===e.call(i,t))return}else if(!1===e(t))return},getAlarmStatePropagator:function(){return this._alarmStatePropagator},setAlarmStatePropagator:function(e){this._alarmStatePropagator!=e&&(this._alarmStatePropagator&&this._alarmStatePropagator.setEnable(!1),this._alarmStatePropagator=e,this._alarmStatePropagator.setEnable(!0))},setClient:function(e,t){if(null==e)return this;null==this._clientMap&&(this._clientMap=new Object);var i=this._clientMap[e];if(i!==t)return null==t?delete this._clientMap[e]:this._clientMap[e]=t,this._clientMap[e]=t,this.firePropertyChange("C:"+e,i,t),this},getClient:function(e){return this._clientMap[e]}}),se.QuickFinder=function(e,t,i,r,a){if(this._map={},!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=se.getter(t)),this._valueFunction=r||this.getValue,this._filterFunction=a||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},se.extend(se.QuickFinder,Object,{_NULL_:"mono-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(e){"add"===e.kind?this._addData(e.data):"remove"===e.kind?this._removeData(e.data):"clear"===e.kind&&(this._map={})},handleDataPropertyChange:function(e){if(this._filterFunction.call(this,e.source)){if("accessor"===this._propertyType&&this._propertyName===e.property);else if("style"===this._propertyType&&e.source.IStyle&&"S:"+this._propertyName===e.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==e.property)return;var t=this._getMap(e.oldValue);t&&t.remove(e.source),this._addData(e.source)}},_getMap:function(e){return e=null==e?this._NULL_:e,this._map[e]},find:function(e){var t=this._getMap(e);return t?t.toList():new _e},findFirst:function(e){var t=this._getMap(e);return!t||t.isEmpty()?null:t.get(0)},_addData:function(e){if(this._filterFunction.call(this,e)){var t=this._valueFunction.call(this,e),i=this._getMap(t);i||(i=new _e,t=null==t?this._NULL_:t,this._map[t]=i),i.add(e)}},_removeData:function(e){if(this._filterFunction.call(this,e)){var t=this._valueFunction.call(this,e),i=this._getMap(t);i&&(i.remove(e),i.isEmpty()&&(t=null==t?this._NULL_:t,delete this._map[t]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(e){return!("style"===this._propertyType&&!e.IStyle)&&!("accessor"===this._propertyType&&this._valueFunction===this.getValue&&!e[this._getter])},getValue:function(e){return"accessor"===this._propertyType?e[this._getter]():"style"===this._propertyType&&e.getStyle?e.getStyle(this._propertyName):"client"===this._propertyType&&e.getClient?e.getClient(this._propertyName):null}}),se.SelectionModel=function(e){se.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new _e,this._selectionChangeDispatcher=new se.EventDispatcher,this._selectionMap={},this._setDataBox(e)},se.extend(se.SelectionModel,se.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(e){if(this._selectionMode!==e&&("noneSelection"===e||"singleSelection"===e||"multipleSelection"===e)){this.clearSelection();var t=this._selectionMode;this._selectionMode=e,this.firePropertyChange("selectionMode",t,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(e){if(!e)throw"dataBox can not be null";if(this._dataBox!==e){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var t=this._dataBox;this._dataBox=e,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",t,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(e){if("remove"===e.kind){var t=e.data;this.contains(t)&&(this._selectionList.remove(t),delete this._selectionMap[t.getId()],this.fireSelectionChange("remove",new _e(t))),t._selected=!1}else"clear"===e.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(e){if(this._filterFunction!==e){this.clearSelection();var t=this._filterFunction;this._filterFunction=e,this.firePropertyChange("filterFunction",t,this._filterFunction)}},fireSelectionChange:function(e,t,i){i&&(this._selectionList.forEach(function(e){i.contains(e)?i.remove(e):i.add(e)}),t=i.toList()),this._selectionChangeDispatcher.fire({kind:e,datas:new _e(t)})},addSelectionChangeListener:function(e,t,i){this._selectionChangeDispatcher.add(e,t,i)},removeSelectionChangeListener:function(e,t){this._selectionChangeDispatcher.remove(e,t)},_filterList:function(e,t){for(var i=new _e(e),r=0;r<i.size();r++){var a=i.get(r);(this._filterFunction&&!this._filterFunction(a)||t&&this.contains(a)||!t&&!this.contains(a)||!this._dataBox.contains(a))&&(i.removeAt(r),r--)}return i},appendSelection:function(e){if("noneSelection"!==this._selectionMode){var t=this._filterList(e,!0);if(!t.isEmpty()){var i=null;"singleSelection"===this._selectionMode&&(i=new _e(this._selectionList),this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},t=new _e(t.get(t.size()-1)));for(var r=0;r<t.size();r++){var a=t.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a._id]=a}this.fireSelectionChange("append",t,i)}}},removeSelection:function(e){var t=this._filterList(e);if(0!==t.size()){for(var i=0;i<t.size();i++){var r=t.get(i);r._selected=!1,this._selectionList.remove(r),delete this._selectionMap[r.getId()]}this.fireSelectionChange("remove",t)}},toSelection:function(e,t){return this._selectionList.toList(e,t)},getSelection:function(){return this._selectionList},setSelection:function(e){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=e)){var t=new _e(this._selectionList);this._selectionList.clear(),this._selectionMap={};var i=this._filterList(e,!0);"singleSelection"===this._selectionMode&&i.size()>1&&(i=new _e(i.get(i.size()-1)));for(var r=0;r<i.size();r++){var a=i.get(r);a._selected=!0,this._selectionList.add(a),this._selectionMap[a.getId()]=a}this.fireSelectionChange("set",null,t)}},clearSelection:function(){if(this._selectionList.size()>0){var e=this._selectionList.toList();this._selectionList.forEach(function(e){e._selected=!1}),this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",e)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var e=this._dataBox.toDatas(),t=0,i=null;if(this._filterFunction)for(t=0;t<e.size();t++)i=e.get(t),this._filterFunction(i)||(e.removeAt(t),t--);var r=new _e(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&e.size()>1&&(e=new _e(e.get(e.size()-1))),t=0;t<e.size();t++)i=e.get(t),this._selectionList.add(i),this._selectionMap[i.getId()]=i;this.fireSelectionChange("all",null,r)}},size:function(){return this._selectionList.size()},contains:function(e){return!!e&&null!=this._selectionMap[e._id]},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(e){return!!e&&("noneSelection"!==this._selectionMode&&!(this._filterFunction&&!this._filterFunction(e)))}}),se.AlarmSeverity=function(e,t,i,r,a){this.value=e,this.name=t,this.nickName=i,this.color=r,this.displayName=a},se.extend(se.AlarmSeverity,Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var e=se.AlarmSeverity;e.severities=new _e,e._vm={},e._nm={},e._cp=function(e,t){if(e&&t){var i=e.value-t.value;return i>0?1:i<0?-1:0}return e&&!t?1:!e&&t?-1:0},e.forEach=function(t,i){e.severities.forEach(t,i)},e.getSortFunction=function(){return e._cp},e.setSortFunction=function(t){e._cp=t,e.severities.sort(t)},e.add=function(t,i,r,a,n){var o=new e(t,i,r,a,n);return e._vm[t]=o,e._nm[i]=o,e.severities.add(o),e.severities.sort(e._cp),o},e.remove=function(t){var i=e._nm[t];return i&&(delete e._nm[t],delete e._vm[i.value],e.severities.remove(i)),i},e.CRITICAL=e.add(500,"Critical","C","#FF0000"),e.MAJOR=e.add(400,"Major","M","#FFA000"),e.MINOR=e.add(300,"Minor","m","#FFFF00"),e.WARNING=e.add(200,"Warning","W","#00FFFF"),e.INDETERMINATE=e.add(100,"Indeterminate","N","#C800FF"),e.CLEARED=e.add(0,"Cleared","R","#00FF00"),e.isClearedAlarmSeverity=function(e){return!!e&&0===e.value},e.getByName=function(t){return e._nm[t]},e.getByValue=function(t){return e._vm[t]},e.clear=function(){e.severities.clear(),e._vm={},e._nm={}},e.compare=function(t,i){return e._cp(t,i)}}(),se.AlarmState=function(e){this._e=e,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},se.extend(se.AlarmState,Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var e=null;for(var t in this._am)t=se.AlarmSeverity.getByName(t),se.AlarmSeverity.isClearedAlarmSeverity(t)||0!==this.getAcknowledgedAlarmCount(t)&&(e=e&&se.AlarmSeverity.compare(e,t)>0?e:t);this._haa=e},_c2:function(){var e=null;for(var t in this._nm)t=se.AlarmSeverity.getByName(t),se.AlarmSeverity.isClearedAlarmSeverity(t)||0!==this.getNewAlarmCount(t)&&(e=e&&se.AlarmSeverity.compare(e,t)>0?e:t);this._hna=e},_c3:function(){if(this._hna){for(var e in this._nm)if(e=se.AlarmSeverity.getByName(e),!se.AlarmSeverity.isClearedAlarmSeverity(e)&&0!==this.getNewAlarmCount(e)&&se.AlarmSeverity.compare(this._hna,e)>0)return void(this._hls=!0);this._hls=!1}else this._hls=!1},_c4:function(){var e=this._haa,t=this._hna,i=this._ps;this._hoa=e,se.AlarmSeverity.compare(t,this._hoa)>0&&(this._hoa=t),se.AlarmSeverity.compare(i,this._hoa)>0&&(this._hoa=i)},_c5:function(){var e=this._haa,t=this._hna;this._hta=e,se.AlarmSeverity.compare(t,this._hta)>0&&(this._hta=t)},increaseAcknowledgedAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._am[e.name];null==i&&(i=0),i+=t,this._am[e.name]=i,this._f(),this._e.onAlarmChange()}},increaseNewAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._nm[e.name];null==i&&(i=0),i+=t,this._nm[e.name]=i,this._f(),this._e.onAlarmChange()}},decreaseAcknowledgedAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._am[e.name];if(null==i&&(i=0),(i-=t)<0)throw"Alarm count can not be negative";this._am[e.name]=i,this._f(),this._e.onAlarmChange()}},decreaseNewAlarm:function(e,t){if(null==t&&(t=1),0!==t){var i=this._nm[e.name];if(null==i&&(i=0),(i-=t)<0)throw"Alarm count can not be negative";this._nm[e.name]=i,this._f(),this._e.onAlarmChange()}},acknowledgeAlarm:function(e){this.decreaseNewAlarm(e,1),this.increaseAcknowledgedAlarm(e,1)},acknowledgeAllAlarms:function(e){if(e){var t=this.getNewAlarmCount(e);this.decreaseNewAlarm(e,t),this.increaseAcknowledgedAlarm(e,t)}else for(var i in this._nm)this.acknowledgeAllAlarms(se.AlarmSeverity.getByName(i))},_c6:function(){this._aac=0;for(var e in this._am)e=se.AlarmSeverity.getByName(e),this._aac+=this.getAcknowledgedAlarmCount(e)},getAcknowledgedAlarmCount:function(e){if(e){var t=this._am[e.name];return null==t?0:t}return this._aac},getAlarmCount:function(e){return this.getAcknowledgedAlarmCount(e)+this.getNewAlarmCount(e)},_c7:function(){this._nac=0;for(var e in this._nm)e=se.AlarmSeverity.getByName(e),this._nac+=this.getNewAlarmCount(e)},getNewAlarmCount:function(e){if(e){var t=this._nm[e.name];return null==t?0:t}return this._nac},setNewAlarmCount:function(e,t){this._nm[e.name]=t,this._f()},removeAllNewAlarms:function(e){e?delete this._nm[e]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(e,t){this._am[e.name]=t,this._f()},removeAllAcknowledgedAlarms:function(e){e?delete this._am[e.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(e){if(this._ep||(e=null),this._ps!==e){var t=this._ps;this._ps=e,this._f(),this._e.onAlarmChange(),this._e.firePropertyChange("propagateSeverity",t,e)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(e){var t=this._ep;this._ep=e,this._e.firePropertyChange("enablePropagation",t,e)&&(e||this.setPropagateSeverity(null))}}),se.Alarm=function(e,t,i,r,a){se.Data.call(this,e),this._id=null!=e?e:se.id("A"),this._elementId=t,this._alarmSeverity=i,this._acked=r||!1,this._cleared=a||!1},se.extend(se.Alarm,se.Data,{IAlarm:!0,getElementId:function(){return this._elementId},___accessor:["acked","cleared","alarmSeverity"]}),se.AlarmBox=function(e){if(!e)throw"elementBox can not be null.";se.AlarmBox.superClass.constructor.call(this),this._elementBox=e,this._alarmElementMapping=new se.AlarmElementMapping(this,e),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},se.extend(se.AlarmBox,se.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(e){var t=this._removeAlarmWhenAlarmIsCleared;if(this._removeAlarmWhenAlarmIsCleared=e,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",t,e),e)for(var i in this.datas){var r=this.datas[i];r.isCleard()&&this.remove(r)}},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(e){if(!e)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==e){var t=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=e,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",t,e)}},handleElementBoxChange:function(e){"add"===e.kind?this.handleElementAdded(e.data):"remove"===e.kind?(this.handleElementRemoved(e.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(e.data)):"clear"===e.kind&&(e.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(e){"add"===e.kind?this._increaseAlarmState(e.data):"remove"===e.kind?this._decreaseAlarmState(e.data):"clear"===e.kind&&e.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(e){var t=e.source;t.isCleared()||("alarmSeverity"===e.property?this.handleAlarmSeverityChange(t,e):"acked"===e.property&&this.handleAckedChange(t,e)),"cleared"===e.property&&(t.isCleared()?(this._decreaseAlarmState(t,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(t)):this._increaseAlarmState(t,!0))},handleAckedChange:function(e,t){if(e.getAlarmSeverity()){var i=this.getCorrespondingElements(e);if(i)for(var r=0;r<i.size();r++){var a=i.get(r);t.oldValue?a.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity()),t.newValue?a.getAlarmState().increaseAcknowledgedAlarm(e.getAlarmSeverity()):a.getAlarmState().increaseNewAlarm(e.getAlarmSeverity())}}},handleAlarmSeverityChange:function(e,t){var i=t.oldValue,r=t.newValue,a=this.getCorrespondingElements(e);if(a)for(var n=0;n<a.size();n++){var o=a.get(n);i&&(e.isAcked()?o.getAlarmState().decreaseAcknowledgedAlarm(i):o.getAlarmState().decreaseNewAlarm(i)),r&&(e.isAcked()?o.getAlarmState().increaseAcknowledgedAlarm(r):o.getAlarmState().increaseNewAlarm(r))}},getCorrespondingAlarms:function(e){return this._alarmElementMapping.getCorrespondingAlarms(e)},getCorrespondingElements:function(e){return this._alarmElementMapping.getCorrespondingElements(e)},handleElementAdded:function(e){var t=this.getCorrespondingAlarms(e);if(t)for(var i=0;i<t.size();i++){var r=t.get(i);if(!r.isCleared()){var a=r.getAlarmSeverity();a&&(r.isAcked()?e.getAlarmState().increaseAcknowledgedAlarm(a):e.getAlarmState().increaseNewAlarm(a))}}},_increaseAlarmState:function(e,t){if(!e.isCleared()||t){var i=e.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(e);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);e.isAcked()?n.getAlarmState().increaseAcknowledgedAlarm(i):n.getAlarmState().increaseNewAlarm(i)}}}},_decreaseAlarmState:function(e,t){if(e.isCleared||console.log(),!e.isCleared()||t){var i=e.getAlarmSeverity();if(i){var r=this.getCorrespondingElements(e);if(r)for(var a=0;a<r.size();a++){var n=r.get(a);e.isAcked()?n.getAlarmState().decreaseAcknowledgedAlarm(i):n.getAlarmState().decreaseNewAlarm(i)}}}},handleElementRemoved:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(function(t){!t.isCleared()&&t.getAlarmSeverity()&&(t.isAcked()?e.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity()))})},removeAlarmsByElement:function(e){var t=this.getCorrespondingAlarms(e);t&&t.forEach(this.remove,this)},add:function(e,t){if(!e.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&e.isCleared()||se.AlarmBox.superClass.add.apply(this,arguments)}}),se.AlarmElementMapping=function(e,t){if(!t)throw"ElementBox can not be null";if(!e)throw"AlarmBox can not be null";this._elementBox=t,this._alarmBox=e,this._alarmsFinder=new se.QuickFinder(e,"elementId")},se.extend(se.AlarmElementMapping,Object,{getCorrespondingAlarms:function(e){return this._alarmsFinder.find(e.getId())},getCorrespondingElements:function(e){var t=this._elementBox.getDataById(e.getElementId());return new _e(t)},dispose:function(){delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),se.PropertyPropagator=function(e,t,i){if(!e)throw"dataBox can not be null";if(!t)throw"propertyName can not be null";this._dataBox=e,this._propertyName=t,this._propertyType=i||"accessor","accessor"===this._propertyType&&(this._getter=se.getter(t),this._setter=se.setter(t)),this._enable=!1,this._isPropagating=!1},se.extend(se.PropertyPropagator,Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(e){if(this._enable!==e)if(this._enable=e,this._enable){this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this);for(var t in this._dataBox.datas)this.propagate(this._dataBox.datas[t])}else this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)},handleDataBoxChange:function(e){e.data&&this.propagate(e.data)},handleDataPropertyChange:function(e){if(this.isInterestedProperty(e))this.propagate(e.source);else if("parent"===e.property){var t=e.oldValue;t&&this.propagate(t),this.propagate(e.source)}},isInterestedProperty:function(e){return"accessor"===this._propertyType&&this._propertyName===e.property||(!("style"!==this._propertyType||!e.IElement||"S:"+this._propertyName!==e.property)||"client"===this._propertyType&&"C:"+this._propertyName===e.property)},propagate:function(e){e&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(e),this._isPropagating=!1)},propagateToTop:function(e){for(this.propagateToParent(null,e);e&&e.getParent();)this.propagateToParent(e,e.getParent()),e=e.getParent()},propagateToParent:function(e,t){}}),se.AlarmStatePropagator=function(e){se.AlarmStatePropagator.superClass.constructor.call(this,e,"alarmState")},se.extend(se.AlarmStatePropagator,se.PropertyPropagator,{handleDataPropertyChange:function(e){"enablePropagation"===e.property?this.propagate(e.source):se.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,e)},propagateToParent:function(e,t){var i=null;t.getChildren().forEach(function(e){var t=e.getAlarmState().getHighestOverallAlarmSeverity();se.AlarmSeverity.compare(t,i)>0&&(i=t)}),t.getAlarmState&&t.getAlarmState().setPropagateSeverity(i)}});var Te={KEEP_DEFAULT_FUNCTION:function(e){return!(!e.target.keepDefault&&!e.target.getAttribute("keepDefault"))||(!(!e.target.parentNode||!e.target.parentNode.keepDefault&&!e.target.parentNode.getAttribute("keepDefault"))||!!e.shiftKey)}};Te.paintSortFunction=function(e,t){return e.z!==t.z?e.z-t.z:0},Te.doubleClickToLookAtFunction=function(e){return!0},Te.needSmoothNormalFunction=function(e){return!(e instanceof Ce||e instanceof se.TextNode||e instanceof se.PathCube||e instanceof se.ShapeNode||e instanceof se.ComboNode||"TGL.Entity"==e.getClassName())},Te.PATH_LINK_COMPUTE_DELAY=!1,se.Defaults=Te,se.ShaderChunk={gradient_parts_fragment:["#ifdef MAX_GRADIENT","uniform vec3 gradientColor[MAX_GRADIENT];","uniform float gradientStop[MAX_GRADIENT];","uniform int gradientType;","#endif"].join("\n"),gradient_basic_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] <= gradientUV){","if((gradientStop[i] >= gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 =gradientStop[i]; ","gl_FragColor = vec4( (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1),opacity);","break;","}","}","}","#endif"].join("\n"),gradient_phong_fragment:["#ifdef MAX_GRADIENT","float gradientUV = 1.0;","float PI = 3.14;","if(gradientType == 1){","gradientUV = oUv.x;","} else if(gradientType == 2){","gradientUV = oUv.y;","} else if(gradientType == 3){","gradientUV = (oUv.x + oUv.y)/2.0;","} else if(gradientType == 4){","gradientUV = (oUv.x + 1.0 - oUv.y)/2.0;","} else if(gradientType == 5){","gradientUV = 1.414 * sqrt((oUv.x - 0.5) * (oUv.x - 0.5) + (oUv.y - 0.5) * (oUv.y - 0.5));","} else if(gradientType == 6){","gradientUV = (atan(oUv.y - 0.5,oUv.x - 0.5)) / (2.0 * PI);","if(gradientUV < 0.0){","gradientUV = 1.0 + gradientUV;","}","}","for( int i = 1; i < MAX_GRADIENT; i ++ ){","if(gradientStop[i - 1] < gradientUV){","if((gradientStop[i] > gradientUV)){","vec3 color1 = gradientColor[i-1];","vec3 color2 = gradientColor[i];","float stop1 = gradientStop[i-1];","float stop2 = gradientStop[i]; ","tempDiffuse = (color1 * (stop2 - gradientUV )  + color2 * (gradientUV - stop1))/(stop2 - stop1);","break;","}","}","}","#endif"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#else","vec4 cubeColor = textureCube( envMap, vec3(reflectVec.x*flipEnvMap,  reflectVec.y,reflectVec.z) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","#ifdef PHONG","#else","float specularStrength = 1.0;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP ) ","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","uniform vec4 offsetRepeat;","uniform bool flipX; ","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","varying vec2 vUv;","varying vec2 oUv;","#endif","#ifdef USE_MAP","uniform bool mapLoaded;","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined(MAX_GRADIENT)","if(flipX){","vUv.x = uv.x * offsetRepeat.z * (-1.0) + offsetRepeat.x + offsetRepeat.z;","vUv.y = uv.y * offsetRepeat.w  + offsetRepeat.y;","}else{","vUv = uv * offsetRepeat.zw  + offsetRepeat.xy;","}","oUv = uv;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","if(mapLoaded){","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = texelColor * gl_FragColor;","}","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = uspecularStrength;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0 ","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += tempDiffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ]) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += tempDiffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += tempDiffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += tempDiffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","float ssao = 1.0;","#ifdef USE_SSAO","ssao = clamp(1.0 - texture2D(mapSSAO, (finalPosition.xy / finalPosition.w / 2.0 + vec2(0.5,0.5))).x,0.0,1.0);","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient * ssao) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + (ambientLightColor * ambient) * ssao ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","uniform sampler2D pShadowMap[MAX_POINT_SHADOWS];","uniform vec2 pShadowMapSize[ MAX_POINT_SHADOWS ];","uniform float pShadowDarkness[MAX_POINT_SHADOWS];","uniform float pShadowRadius [MAX_POINT_SHADOWS];","uniform vec3 pPosition[MAX_POINT_SHADOWS];","uniform float shadowCameraNear;","uniform float shadowCameraFar;","varying vec4 pWorldPosition;","vec2 cubeToUV( vec3 v, float texelSizeY ) {","\tvec3 absV = abs( v );","\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );","\tabsV *= scaleToCube;","\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );","\tvec2 planar = v.xy;","\tfloat almostATexel = 1.5 * texelSizeY;","\tfloat almostOne = 1.0 - almostATexel;","\tif ( absV.z >= almostOne ) {","\t\tif ( v.z > 0.0 )","\t\t\tplanar.x = 4.0 - v.x;","\t\t} else if ( absV.x >= almostOne ) {","\t\t \tfloat signX = sign( v.x );","\t\t\tplanar.x = v.z * signX + 2.0 * signX;","\t\t} else if ( absV.y >= almostOne ) {","\t\t\tfloat signY = sign( v.y );","\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;","\t\t\tplanar.y = v.z * signY - 2.0;","\t\t}","\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );","}","float texture2DCompare( sampler2D depths, vec2 uv, float compare ){","\treturn step( compare, unpack( texture2D( depths, uv ) ) );","}","float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec3 lightToPosition, float shadowCameraNear, float shadowCameraFar ) {","\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );","\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );","\tdp += shadowBias;","\tvec3 bd3D = normalize( lightToPosition );","\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )","\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;","\treturn (","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +","\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )","\t) * ( 1.0 / 9.0 );","#else","\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );","#endif","}","#endif","#if defined(USE_SHADOWMAP) || defined(USE_POINT_SHADOWMAP)","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","float unpack (vec4 colour){","const vec4 bitShifts = vec4(1.0,1.0 / 255.0,1.0 / (255.0 * 255.0),1.0 / (255.0 * 255.0 * 255.0));","return dot(colour, bitShifts) ;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3(inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2(inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif","#ifdef USE_POINT_SHADOWMAP"," ","for( int i = 0; i < MAX_POINT_SHADOWS; i ++ ) {","vec3 lightToPosition = pWorldPosition.xyz - pPosition[i];","vec2 shadowMapSize = pShadowMapSize[i];","float shadow = getPointShadow(pShadowMap[i],shadowMapSize,0.0015,pShadowRadius[i],lightToPosition,shadowCameraNear,shadowCameraFar);","float darkness = 1.0 - pShadowDarkness[i];","gl_FragColor.xyz *= (darkness + (1.0 - darkness) * shadow);","}","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif","#ifdef USE_POINT_SHADOWMAP","varying vec4 pWorldPosition;","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_SHADOWMAP","pWorldPosition = modelMatrix * vec4(position,1.0);","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},se.UniformsUtils={merge:function(e){var t,i,r,a={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(i in r)a[i]=r[i]}return a},clone:function(e){var t,i,r,a={};for(t in e){a[t]={};for(i in e[t])(r=e[t][i])instanceof se.Color||r instanceof se.Vec2||r instanceof se.Vec3||r instanceof se.Vec4||r instanceof se.Mat4||r instanceof se.Texture?a[t][i]=r.clone():r instanceof Array?a[t][i]=r.slice():a[t][i]=r}return a}},se.UniformsLib={outline:{diffuse:{type:"c",value:new se.Color(15658734)},outline_offset:{type:"f",value:0}},glow:{map:{type:"t",value:null}},blur:{orientation:{type:"i",value:0},texelSize:{type:"v2",value:new se.Vec2(512,512)},blurAmount:{type:"i",value:10},blurScale:{type:"f",value:1},blurStrength:{type:"f",value:.2},map:{type:"t",value:null},useBlur:{type:"i",value:1},blurGlobalAlpha:{type:"f",value:1}},deferred:{linearDepth:{type:"f",value:9e3},isNormal:{type:"i",value:1}},ssao:{map0:{type:"t",value:null},map1:{type:"t",value:null},map2:{type:"t",value:null},occluderBias:{type:"f",value:.05},samplingRadius:{type:"f",value:20},attenuation:{type:"v2",value:new le(1,0)},texelSize:{type:"v2",value:new le(1/512,1/512)}},common:{diffuse:{type:"c",value:new se.Color(15658734)},wireframeLinecolor:{type:"c",value:new se.Color(0)},wireframeLineopacity:{type:"f",value:1},opacity:{type:"f",value:1},map:{type:"t",value:null},mapLoaded:{type:"i",value:0},offsetRepeat:{type:"v4",value:new se.Vec4(0,0,1,1)},flipX:{type:"i",value:0},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},gradient:{gradientColor:{type:"v3v",value:[]},gradientStop:{type:"fv1",value:[]},gradientType:{type:"i",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new se.Vec2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new se.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new se.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new se.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},pShadowMap:{type:"tv",value:[]},pShadowMapSize:{type:"v2v",value:[]},pShadowDarkness:{type:"fv1",value:[]},pShadowRadius:{type:"fv1",value:[]},pPosition:{type:"v3v",value:[]},shadowCameraNear:{type:"f",value:.1},shadowCameraFar:{type:"f",value:1e4}},gradientramp:{skyColor:{type:"c",value:new se.Color(16777215)},horizonColor:{type:"c",value:new se.Color(16777215)},earthColor:{type:"c",value:new se.Color(16777215)},skyY:{type:"f",value:0},horizonY:{type:"f",value:0},earthY:{type:"f",value:0}}},se.ShaderLib={outline:{uniforms:se.UniformsUtils.merge([se.UniformsLib.outline]),vertexShader:["uniform float outline_offset;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position + normalize(position)  * outline_offset, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","void main() {","gl_FragColor = vec4(diffuse, 1.0 );","}"].join("\n")},blur:{uniforms:se.UniformsUtils.merge([se.UniformsLib.blur]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform vec2 texelSize;","uniform sampler2D map;","uniform int orientation;","uniform int blurAmount;","uniform float blurScale;","uniform float blurStrength;","uniform int useBlur;","uniform float blurGlobalAlpha;","uniform sampler2D depthMap;","varying vec2 vUv;","float Gaussian (float x, float deviation){","return (1.0 / sqrt(2.0 * 3.141592 * deviation)) * exp(-((x * x) / (2.0 * deviation)));","}","void main (){","float halfBlur = float(blurAmount) * 0.5;","vec4 colour = vec4(0.0);","if(useBlur == 0){","colour = texture2D(map,vUv);","}else {","vec4 texColour = vec4(0.0);","float deviation = halfBlur * 0.35;","deviation *= deviation;","float strength = 1.0 - blurStrength;","if ( orientation == 0 ){","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount ){","break;","}","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(offset / texelSize.x * blurScale, 0.0)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}else{","for (int i = 0; i < 20; ++i){","if ( i >= blurAmount )","break;","float offset = float(i) - halfBlur;","texColour = texture2D(map, vUv + vec2(0.0, offset / texelSize.y * blurScale)) * Gaussian(offset * strength, deviation);","colour += texColour;","}","}","}","gl_FragColor = clamp(colour, 0.0, 1.0);","if(useBlur == 0){","gl_FragColor.w *=  gl_FragColor.w * gl_FragColor.w * gl_FragColor.w * blurGlobalAlpha;","}","}"].join("\n")},linex:{uniforms:{near:{type:"f",value:.1},opacity:{type:"f",value:1},viewport:{type:"v4",value:new se.Vec4(0)},lineColor:{type:"c",value:new se.Color(16777215)},modelViewProjectionMatrix:{type:"m4",value:new ue},useVertexColor:{type:"i",value:0}},vertexShader:["attribute vec3 positionPrev;","attribute vec3 positionNext;","attribute float offset;","varying  vec3 vColor;","uniform mat4 modelViewProjectionMatrix;","uniform vec4 viewport;","uniform float near;","vec4 clipNear(vec4 p1,vec4 p2){","\tfloat n = (p1.w - near) / (p1.w - p2.w);","\treturn vec4(mix(p1.xy,p2.xy,n),-near,near);","}","void main(){","\tvec4 prevProj = modelViewProjectionMatrix * vec4(positionPrev, 1.0);","\tvec4 currProj = modelViewProjectionMatrix * vec4(position, 1.0);","\tvec4 nextProj = modelViewProjectionMatrix * vec4(positionNext, 1.0);","\tif (currProj.w < 0.0) {","\t\tif (prevProj.w < 0.0) {","\t \t\tcurrProj = clipNear(currProj, nextProj);","\t\t}else {","\t\t\tcurrProj = clipNear(currProj, prevProj);","\t\t}","\t}","\tvec2 prevScreen = (prevProj.xy / abs(prevProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 currScreen = (currProj.xy / abs(currProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 nextScreen = (nextProj.xy / abs(nextProj.w) + 1.0) * 0.5 * viewport.zw;","\tvec2 dir;","\tfloat len = offset;","\tif(position == positionPrev){","\t\tdir = normalize(nextScreen - currScreen);","\t}else if(position == positionNext){","\t\tdir = normalize(currScreen - prevScreen);","\t}else {","\t\tvec2 dirA = normalize(currScreen - prevScreen);","\t\tvec2 dirB = normalize(nextScreen - currScreen);","\t\tvec2 tanget = normalize(dirA + dirB);","\t\tfloat miter = 1.0 / max(dot(tanget,dirA),0.5);","\t\tlen *= miter;","\t\tdir = tanget;","\t}","\tdir = vec2(-dir.y,dir.x) * len;","\tcurrScreen += dir;","\tcurrProj.xy = (currScreen / viewport.zw - 0.5) * 2.0 * abs(currProj.w);","\tgl_Position = currProj;","\tvColor = color;","}"].join("\n"),fragmentShader:["uniform vec3 lineColor;","uniform float opacity;","uniform int useVertexColor;","varying  vec3 vColor;","void main (){","\tif(useVertexColor == 0){","\t\tgl_FragColor = vec4(lineColor,opacity);","\t}else{","\t\tgl_FragColor = vec4(vColor,opacity);","\t}","}"].join("\n")},lensflare:{uniforms:{renderType:{type:"i",value:2},screenPosition:{type:"v3",value:new se.Vec3(0)},scale:{type:"v2",value:new se.Vec2(0)},rotation:{type:"f",value:0},occlusionMap:{type:"t",value:null},map:{type:"t",value:null}},vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},deferred:{uniforms:se.UniformsUtils.merge([se.UniformsLib.deferred]),vertexShader:["varying vec4 vPosition;","varying vec3 vNormal;","void main (){","vNormal = mat3(modelViewMatrix) * normal;","vPosition = modelViewMatrix * vec4(position, 1.0);","gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fragmentShader:["uniform float linearDepth;","uniform int isNormal;","varying vec4 vPosition;","varying vec3 vNormal;","void main (){","float linear_depth = length(vPosition) / linearDepth;","if(isNormal == 1){","vec3 normal = normalize(vNormal);","gl_FragColor = vec4(normal.x, normal.y, normal.z, 1.0);","}else{","gl_FragColor = vec4(vPosition.x, vPosition.y, vPosition.z, linear_depth);","}","}"].join("\n")},ssao:{uniforms:se.UniformsUtils.merge([se.UniformsLib.ssao]),vertexShader:["varying vec2 vUv;","void main (){","gl_Position = vec4(position, 1.0);","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D map0;","uniform sampler2D map1;","uniform sampler2D map2;","uniform vec2 texelSize;","uniform float occluderBias;","uniform float samplingRadius;","uniform vec2 attenuation;","varying vec2 vUv;","float samplePixels (vec3 srcPosition, vec3 srcNormal, vec2 uv){","vec3 dstPosition = texture2D(map0, uv).xyz;","vec3 positionVec = dstPosition - srcPosition;","float intensity = max(dot(normalize(positionVec), srcNormal) - occluderBias, 0.0);","float dist = length(positionVec);","float attenuationValue = 1.0 / (attenuation.x + (attenuation.y * dist));","return intensity * attenuationValue;","}","void main (){","vec3 srcPosition = texture2D(map0, vUv).xyz;","vec3 srcNormal = texture2D(map1, vUv).xyz;","vec2 randVec = normalize(texture2D(map2, vUv).xy * 2.0 - 1.0);","float srcDepth = texture2D(map0, vUv).w;","float kernelRadius = samplingRadius * (1.0 - srcDepth);","vec2 kernel[4];","kernel[0] = vec2(0.0, 1.0);","kernel[1] = vec2(1.0, 0.0);","kernel[2] = vec2(0.0, -1.0);","kernel[3] = vec2(-1.0, 0.0);","const float sin45 = 0.707107;","float occlusion = 0.0;","for (int i = 0; i < 4; ++i){","vec2 k1 = reflect(kernel[i], randVec);","vec2 k2 = vec2(k1.x * sin45 - k1.y * sin45,k1.x * sin45 + k1.y * sin45);","k1 *= texelSize;","k2 *= texelSize;","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.75);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k1 * kernelRadius * 0.5);","occlusion += samplePixels(srcPosition, srcNormal, vUv + k2 * kernelRadius * 0.25);","}","occlusion /= 16.0;","occlusion = clamp(occlusion, 0.0, 1.0);","gl_FragColor =  vec4(occlusion,0.0,0.0,1.0);","}"].join("\n")},basic:{uniforms:se.UniformsUtils.merge([se.UniformsLib.common,se.UniformsLib.gradient,se.UniformsLib.fog,se.UniformsLib.gradientramp]),vertexShader:[se.ShaderChunk.map_pars_vertex,se.ShaderChunk.lightmap_pars_vertex,se.ShaderChunk.envmap_pars_vertex,se.ShaderChunk.color_pars_vertex,se.ShaderChunk.morphtarget_pars_vertex,se.ShaderChunk.skinning_pars_vertex,se.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",se.ShaderChunk.map_vertex,se.ShaderChunk.lightmap_vertex,se.ShaderChunk.color_vertex,se.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",se.ShaderChunk.morphnormal_vertex,se.ShaderChunk.skinnormal_vertex,se.ShaderChunk.defaultnormal_vertex,"#endif",se.ShaderChunk.morphtarget_vertex,se.ShaderChunk.skinning_vertex,se.ShaderChunk.default_vertex,se.ShaderChunk.worldpos_vertex,se.ShaderChunk.envmap_vertex,se.ShaderChunk.shadowmap_vertex,"vPosition = position;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",se.ShaderChunk.color_pars_fragment,se.ShaderChunk.map_pars_fragment,se.ShaderChunk.gradient_parts_fragment,se.ShaderChunk.lightmap_pars_fragment,se.ShaderChunk.envmap_pars_fragment,se.ShaderChunk.fog_pars_fragment,se.ShaderChunk.specularmap_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );","}","else{","gl_FragColor = vec4( diffuse, opacity );","}",se.ShaderChunk.gradient_basic_fragment,se.ShaderChunk.map_fragment,se.ShaderChunk.alphatest_fragment,se.ShaderChunk.lightmap_fragment,"if(skyY <= earthY){",se.ShaderChunk.color_fragment,"}",se.ShaderChunk.envmap_fragment,se.ShaderChunk.linear_to_gamma_fragment,se.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},lambert:{uniforms:se.UniformsUtils.merge([se.UniformsLib.common,se.UniformsLib.fog,se.UniformsLib.lights,se.UniformsLib.shadowmap,{ambient:{type:"c",value:new se.Color(16777215)},emissive:{type:"c",value:new se.Color(0)},wrapRGB:{type:"v3",value:new se.Vec3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",se.ShaderChunk.map_pars_vertex,se.ShaderChunk.lightmap_pars_vertex,se.ShaderChunk.envmap_pars_vertex,se.ShaderChunk.lights_lambert_pars_vertex,se.ShaderChunk.color_pars_vertex,se.ShaderChunk.morphtarget_pars_vertex,se.ShaderChunk.skinning_pars_vertex,se.ShaderChunk.shadowmap_pars_vertex,"void main() {",se.ShaderChunk.map_vertex,se.ShaderChunk.lightmap_vertex,se.ShaderChunk.color_vertex,se.ShaderChunk.morphnormal_vertex,se.ShaderChunk.skinbase_vertex,se.ShaderChunk.skinnormal_vertex,se.ShaderChunk.defaultnormal_vertex,se.ShaderChunk.morphtarget_vertex,se.ShaderChunk.skinning_vertex,se.ShaderChunk.default_vertex,se.ShaderChunk.worldpos_vertex,se.ShaderChunk.envmap_vertex,se.ShaderChunk.lights_lambert_vertex,se.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",se.ShaderChunk.color_pars_fragment,se.ShaderChunk.map_pars_fragment,se.ShaderChunk.lightmap_pars_fragment,se.ShaderChunk.envmap_pars_fragment,se.ShaderChunk.fog_pars_fragment,se.ShaderChunk.shadowmap_pars_fragment,se.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",se.ShaderChunk.map_fragment,se.ShaderChunk.alphatest_fragment,se.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",se.ShaderChunk.lightmap_fragment,se.ShaderChunk.color_fragment,se.ShaderChunk.envmap_fragment,se.ShaderChunk.shadowmap_fragment,se.ShaderChunk.linear_to_gamma_fragment,se.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:se.UniformsUtils.merge([se.UniformsLib.common,se.UniformsLib.gradient,se.UniformsLib.bump,se.UniformsLib.normalmap,se.UniformsLib.fog,se.UniformsLib.lights,se.UniformsLib.shadowmap,se.UniformsLib.gradientramp,{ambient:{type:"c",value:new se.Color(16777215)},emissive:{type:"c",value:new se.Color(0)},specular:{type:"c",value:new se.Color(1118481)},uspecularStrength:{type:"f",value:1},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new se.Vec3(1,1,1)},mapSSAO:{type:"t",value:null}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;","varying vec4 finalPosition;",se.ShaderChunk.map_pars_vertex,se.ShaderChunk.lightmap_pars_vertex,se.ShaderChunk.envmap_pars_vertex,se.ShaderChunk.lights_phong_pars_vertex,se.ShaderChunk.color_pars_vertex,se.ShaderChunk.morphtarget_pars_vertex,se.ShaderChunk.skinning_pars_vertex,se.ShaderChunk.shadowmap_pars_vertex,"varying vec3 vPosition;","void main() {",se.ShaderChunk.map_vertex,se.ShaderChunk.lightmap_vertex,se.ShaderChunk.color_vertex,se.ShaderChunk.morphnormal_vertex,se.ShaderChunk.skinbase_vertex,se.ShaderChunk.skinnormal_vertex,se.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",se.ShaderChunk.morphtarget_vertex,se.ShaderChunk.skinning_vertex,se.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",se.ShaderChunk.worldpos_vertex,se.ShaderChunk.envmap_vertex,se.ShaderChunk.lights_phong_vertex,se.ShaderChunk.shadowmap_vertex,"finalPosition = gl_Position;","vPosition = position;","}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 wireframeLinecolor;","uniform float wireframeLineopacity;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float uspecularStrength;","uniform float shininess;","varying vec4 finalPosition;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",se.ShaderChunk.color_pars_fragment,se.ShaderChunk.gradient_parts_fragment,se.ShaderChunk.map_pars_fragment,se.ShaderChunk.lightmap_pars_fragment,se.ShaderChunk.envmap_pars_fragment,se.ShaderChunk.fog_pars_fragment,se.ShaderChunk.lights_phong_pars_fragment,se.ShaderChunk.shadowmap_pars_fragment,se.ShaderChunk.bumpmap_pars_fragment,se.ShaderChunk.normalmap_pars_fragment,se.ShaderChunk.specularmap_pars_fragment,"#ifdef USE_SSAO","uniform sampler2D mapSSAO;","#endif","vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","#ifdef USE_WIREFRAME","float wireframeLineopacityValue = wireframeLineopacity * opacity;","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(skyColor ,wireframeLineopacityValue),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,wireframeLineopacityValue),vec4(earthColor ,wireframeLineopacityValue),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), wireframeLineopacityValue );","}","else{","gl_FragColor = vec4( wireframeLinecolor, wireframeLineopacityValue );","}","#else","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( vec3 ( 1.0 ), opacity );","}","else{","gl_FragColor = vec4(  vec3 ( 1.0 ), opacity );","}","vec3 tempDiffuse = diffuse;",se.ShaderChunk.gradient_phong_fragment,se.ShaderChunk.map_fragment,se.ShaderChunk.alphatest_fragment,se.ShaderChunk.specularmap_fragment,se.ShaderChunk.lights_phong_fragment,se.ShaderChunk.lightmap_fragment,se.ShaderChunk.color_fragment,se.ShaderChunk.envmap_fragment,se.ShaderChunk.shadowmap_fragment,se.ShaderChunk.linear_to_gamma_fragment,se.ShaderChunk.fog_fragment,"#endif","}"].join("\n")},particle_basic:{uniforms:se.UniformsUtils.merge([se.UniformsLib.particle,se.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",se.ShaderChunk.color_pars_vertex,se.ShaderChunk.shadowmap_pars_vertex,"void main() {",se.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","float s = normal.x;","if(s == 0.0){","   s = 1.0;","}","gl_PointSize = size * s;","#endif","gl_Position = projectionMatrix * mvPosition;",se.ShaderChunk.worldpos_vertex,se.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",se.ShaderChunk.color_pars_fragment,se.ShaderChunk.map_particle_pars_fragment,se.ShaderChunk.fog_pars_fragment,se.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",se.ShaderChunk.map_particle_fragment,se.ShaderChunk.alphatest_fragment,se.ShaderChunk.color_fragment,se.ShaderChunk.shadowmap_fragment,se.ShaderChunk.fog_fragment,"}"].join("\n")},billboard:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")},dashed:{uniforms:se.UniformsUtils.merge([se.UniformsLib.common,se.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}},se.UniformsLib.gradientramp]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;","varying vec3 vPosition;",se.ShaderChunk.color_pars_vertex,"void main() {",se.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vPosition = position;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;","uniform vec3 skyColor;","uniform vec3 horizonColor;","uniform vec3 earthColor;","uniform float skyY;","uniform float horizonY;","uniform float earthY;","varying vec3 vPosition;",se.ShaderChunk.color_pars_fragment,se.ShaderChunk.fog_pars_fragment,"vec4 lerp (vec4 colora, vec4 colorb, float t) {","if(t >= 1.0){","return colorb;}","float r = mix(colora.r, colorb.r, t);","float g = mix(colora.g, colorb.g, t);","float b = mix(colora.b, colorb.b, t);","float a = mix(colora.a, colorb.a, t);","return vec4(r,g,b,a);","}","void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","if(skyY > earthY){","if(vPosition.y > horizonY){","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(skyColor ,opacity),dist/(skyY - horizonY));}","else{","float dist = distance(vPosition, vec3(vPosition.x , horizonY, vPosition.z));","gl_FragColor = lerp(vec4(horizonColor ,opacity),vec4(earthColor ,opacity),dist/(horizonY - earthY));}","gl_FragColor = gl_FragColor * vec4( diffuse, opacity );",se.ShaderChunk.fog_fragment,"}","else{","gl_FragColor = vec4( diffuse, opacity );",se.ShaderChunk.color_fragment,se.ShaderChunk.fog_fragment,"}","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:se.UniformsUtils.merge([se.UniformsLib.fog,se.UniformsLib.lights,se.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new se.Vec2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new se.Color(16777215)},uSpecularColor:{type:"c",value:new se.Color(1118481)},uSpecualarStrength:{type:"f",value:1},uAmbientColor:{type:"c",value:new se.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new se.Vec2(0,0)},uRepeat:{type:"v2",value:new se.Vec2(1,1)},wrapRGB:{type:"v3",value:new se.Vec3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform vec3 uSpecularStrength;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",se.ShaderChunk.shadowmap_pars_fragment,se.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",se.ShaderChunk.shadowmap_fragment,se.ShaderChunk.linear_to_gamma_fragment,se.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",se.ShaderChunk.skinning_pars_vertex,se.ShaderChunk.shadowmap_pars_vertex,"void main() {",se.ShaderChunk.skinbase_vertex,se.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{isCube:{type:"i",value:0},nearDistance:{type:"f",value:10},farDistance:{type:"f",value:1e4},referencePosition:{type:"v3",value:new mono.Vec3}},vertexShader:[se.ShaderChunk.morphtarget_pars_vertex,se.ShaderChunk.skinning_pars_vertex,"varying vec4 vPosition1;","void main() {",se.ShaderChunk.skinbase_vertex,se.ShaderChunk.morphtarget_vertex,se.ShaderChunk.skinning_vertex,se.ShaderChunk.default_vertex,"vPosition1 = modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int isCube;","uniform float nearDistance;","uniform float farDistance;","varying vec4 vPosition1;","varying vec3 vPosition2;","vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","vec4 pack (float depth){","const vec4 bias = vec4(1.0 / 255.0,1.0 / 255.0,1.0 / 255.0, 0.0);","float r = depth;","float g = fract(r * 255.0);","float b = fract(g * 255.0);","float a = fract(b * 255.0);","vec4 colour = vec4(r, g, b, a);","return colour - (colour.yzww * bias);","}","void main() {","if(isCube == 1){"," \tfloat dist = length( vPosition1.xyz/vPosition1.w);","\t\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );","\t\tgl_FragData[ 0 ] = pack(dist);","}else{","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}","}"].join("\n")}},se.ShaderTerrain={terrain:{uniforms:se.UniformsUtils.merge([se.UniformsLib.fog,se.UniformsLib.lights,se.UniformsLib.shadowmap,{enableDiffuse1:{type:"i",value:0},enableDiffuse2:{type:"i",value:0},enableDiffuse3:{type:"i",value:0},enableDisplacement:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse1:{type:"t",value:null},tDiffuse2:{type:"t",value:null},tDiffuse3:{type:"t",value:null},tDetail:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tDisplacement:{type:"t",value:null},heightUnit:{type:"f",value:1},blendRange:{type:"fv1",value:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new se.Color(15658734)},uSpecularColor:{type:"c",value:new se.Color(1118481)},uAmbientColor:{type:"c",value:new se.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uRepeatBase:{type:"v2",value:new se.Vec2(1,1)},uRepeatOverlay:{type:"v2",value:new se.Vec2(1,1)},uOffset:{type:"v2",value:new se.Vec2(0,0)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableDiffuse3;","uniform bool enableSpecular;","uniform bool enableDisplacement;","uniform float blendRange[2];","uniform float heightUnit;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDiffuse3;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","varying vec3 vViewPosition;",se.ShaderChunk.shadowmap_pars_fragment,se.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( (enableDiffuse1 && enableDiffuse2)  || (enableDiffuse1 && enableDiffuse3) || (enableDiffuse2 && enableDiffuse3) ){","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","vec4 colDiffuse3 = texture2D( tDiffuse3, uvOverlay );","vec4 allDefiuuses[3];","allDefiuuses[0] = colDiffuse1;","allDefiuuses[1] = colDiffuse2;","allDefiuuses[2] = colDiffuse3;","#ifdef GAMMA_INPUT","colDiffuse1.xyz *= colDiffuse1.xyz;","colDiffuse2.xyz *= colDiffuse2.xyz;","colDiffuse3.xyz *= colDiffuse3.xyz;","#endif","vec4 mixColor;","if(enableDisplacement){","vec4 dis = texture2D( tDisplacement, uvBase );","if(enableDiffuse1 && enableDiffuse2 && enableDiffuse3){","float total = dis.r + dis.g + dis.b;","if(total == 0.0){","mixColor = colDiffuse1 * 1.0/3.0 + colDiffuse2 * 1.0/3.0 + colDiffuse3 * 1.0/3.0;","}else{","mixColor = colDiffuse1 * dis.r/total + colDiffuse2 * dis.g/total + colDiffuse3 * dis.b/total;","}","}","}else {","mixColor = colDiffuse2;","float y = vPosition.y;","float blend2Bottom = blendRange[1] * heightUnit * 255.0;","float percent = 0.0;","if(y < blendRange[0] * heightUnit * 255.0){","mixColor = colDiffuse1;","percent = y / (blendRange[0] * heightUnit * 255.0);","if(percent >=0.8){","mixColor = mix(colDiffuse1,colDiffuse2,(percent - 0.8) / 0.2);","}","} else if(y > blend2Bottom){","mixColor = colDiffuse3;","percent = (y - blend2Bottom) / (heightUnit * 255.0 - blend2Bottom);","if(percent <= 0.2){","mixColor = mix(colDiffuse2,colDiffuse3,percent/0.2);","}","}","}","gl_FragColor = gl_FragColor * mixColor;"," } else if( enableDiffuse1 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","gl_FragColor = gl_FragColor * texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDistance = lDistance;","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","hemiDiffuse += uDiffuseColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","hemiSpecular += uSpecularColor * mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif",se.ShaderChunk.shadowmap_fragment,se.ShaderChunk.linear_to_gamma_fragment,se.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec4 vPosition;","varying vec3 vViewPosition;",se.ShaderChunk.shadowmap_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vPosition = vec4(position,1.0);","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",se.ShaderChunk.shadowmap_vertex,"}"].join("\n")}},se.ShaderLib.terrain=se.ShaderTerrain.terrain,se.Fog=function(e,i,r){this.name="",this.color=new se.Color(e),this.near=i!==t?i:1,this.far=r!==t?r:1e3},se.Fog.prototype={constructor:se.Fog,clone:function(){return new se.Flog(this.color.getHex(),this.near,this.far)},refreshUniforms:function(e){e.fogNear.value=this.near,e.fogFar.value=this.far,e.fogColor.value=this.color}},se.FogExp2=function(e,i){this.name="",this.color=new se.Color(e),this.density=i!==t?i:1},se.FogExp2.prototype={DensityFactor:25e-5,constructor:se.FogExp2,clone:function(){return new se.FogExp2(this.color.getHex(),this.density)},refreshUniforms:function(e){e.fogDensity.value=this.density*this.DensityFactor,e.fogColor.value=this.color}};var Ee={},ze=Ee.RADIANS_TO_DEGREES=180/Math.PI,De=Ee.DEGREES_TO_RADIANS=Math.PI/180;Ee.isPowerOfTwo=function(e){return 0==(e&e-1)},Ee.clone=function(e,i){i==t&&(i=new e.prototype.constructor);for(var r in e)if("id"!==r){var a=e[r];if(a.copy&&"function"==typeof a.copy)i[r].copy(a);else if(a instanceof Array){var n=a,o=i[r];null==o&&(o=[]);for(var s=0;s<n.length;s++){var l=n[s];o.push(l.clone())}}else cloneObjet[r]=a}},Ee.paramToGL=function(e,t){if(t){switch(e){case se.RepeatWrapping:return t.REPEAT;case se.ClampToEdgeWrapping:return t.CLAMP_TO_EDGE;case se.MirroredRepeatWrapping:return t.MIRRORED_REPEAT;case se.NearestFilter:return t.NEAREST;case se.NearestMipMapNearestFilter:return t.NEAREST_MIPMAP_NEAREST;case se.NearestMipMapLinearFilter:return t.NEAREST_MIPMAP_LINEAR;case se.LinearFilter:return t.LINEAR;case se.LinearMipMapNearestFilter:return t.LINEAR_MIPMAP_NEAREST;case se.LinearMipMapLinearFilter:return t.LINEAR_MIPMAP_LINEAR;case se.ByteType:return t.BYTE;case se.UnsignedByteType:return t.UNSIGNED_BYTE;case se.ShortType:return t.SHORT;case se.UnsignedShortType:return t.UNSIGNED_SHORT;case se.IntType:return t.INT;case se.UnsignedIntType:return t.UNSIGNED_INT;case se.FloatType:return t.FLOAT;case se.AlphaFormat:return t.ALPHA;case se.RGBFormat:return t.RGB;case se.RGBAFormat:return t.RGBA;case se.LuminanceFormat:return t.LUMINANCE;case se.LuminanceAlphaFormat:return t.LUMINANCE_ALPHA;case se.AddEquation:return t.FUNC_ADD;case se.SubtractEquation:return t.FUNC_SUBTRACT;case se.ReverseSubtractEquation:return t.FUNC_REVERSE_SUBTRACT;case se.ZeroFactor:return t.ZERO;case se.OneFactor:return t.ONE;case se.SrcColorFactor:return t.SRC_COLOR;case se.OneMinusSrcColorFactor:return t.ONE_MINUS_SRC_COLOR;case se.SrcAlphaFactor:return t.SRC_ALPHA;case se.OneMinusSrcAlphaFactor:return t.ONE_MINUS_SRC_ALPHA;case se.DstAlphaFactor:return t.DST_ALPHA;case se.OneMinusDstAlphaFactor:return t.ONE_MINUS_DST_ALPHA;case se.DstColorFactor:return t.DST_COLOR;case se.OneMinusDstColorFactor:return t.ONE_MINUS_DST_COLOR;case se.SrcAlphaSaturateFactor:return t.SRC_ALPHA_SATURATE}return 0}console.error("No webgl context")},Ee.createElement=function(e,i,r,a){var n,o,s,l,h=e.vertices.length,c=(e.uvs.length,e.vertices),u=i.vertices,f=e.faces,p=i.faces,d=e.uvs,m=i.uvs,g=[],y=[],v=[];a===t&&(a=0),e instanceof se.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,o=(new ce).getNormalMatrix(n)),i instanceof se.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),s=i.matrix,l=(new ce).getNormalMatrix(s));for(var x=0,A=c.length;x<A;x++){w=(_=c[x]).clone();n&&w.applyMatrix4(n),y.push(w)}for(var x=0,A=u.length;x<A;x++){var _=u[x],w=_.clone();s&&w.applyMatrix4(s),y.push(w)}for(x=0,A=f.length;x<A;x++){var b=(z=f[x]).vertexNormals,M=z.vertexColors;(C=z instanceof Se?new Se(z.a,z.b,z.c):new Pe(z.a,z.b,z.c,z.d)).normal.copy(z.normal),o&&C.normal.applyMatrix3(o).normalize();for(var S=0,P=b.length;S<P;S++)T=b[S].clone(),o&&T.applyMatrix3(o).normalize(),C.vertexNormals.push(T);C.color.copy(z.color);for(var S=0,P=M.length;S<P;S++)E=M[S],C.vertexColors.push(E.clone());C.materialIndex=z.materialIndex,C.centroid.copy(z.centroid),n&&C.centroid.applyMatrix4(n),g.push(C)}for(x=0,A=p.length;x<A;x++){var C,T,E,z=p[x],b=z.vertexNormals,M=z.vertexColors;(C=z instanceof Se?new Se(z.a+h,z.b+h,z.c+h):new Pe(z.a+h,z.b+h,z.c+h,z.d+h)).normal.copy(z.normal),l&&C.normal.applyMatrix3(l).normalize();for(var S=0,P=b.length;S<P;S++)T=b[S].clone(),l&&T.applyMatrix3(l).normalize(),C.vertexNormals.push(T);C.color.copy(z.color);for(var S=0,P=M.length;S<P;S++)E=M[S],C.vertexColors.push(E.clone());C.materialIndex=z.materialIndex+a,C.centroid.copy(z.centroid),s&&C.centroid.applyMatrix4(s),g.push(C)}for(x=0,A=d.length;x<A;x++){for(var D=[],S=0,P=(L=d[x]).length;S<P;S++)D.push(new le(L[S].x,L[S].y));v.push(D)}for(x=0,A=m.length;x<A;x++){for(var L=m[x],D=[],S=0,P=L.length;S<P;S++)D.push(new le(L[S].x,L[S].y));v.push(D)}var R=new se.Entity;return R.vertices=y,R.faces=g,R.uvs=v,R.material=r===t?e.material:r,R},Ee.transformElement=function(e,t){var i,r,a=e.vertices,n=e.faces,o=e.uvs,s=[],l=[],h=[];e instanceof se.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),i=e.matrix,r=(new ce).getNormalMatrix(i));for(var c=0,u=a.length;c<u;c++){var f=a[c].clone();i&&f.applyMatrix4(i),l.push(f)}for(c=0,u=n.length;c<u;c++){var p,d,m,g=n[c],y=g.vertexNormals,v=g.vertexColors;(p=g instanceof Se?new Se(g.a,g.b,g.c):new Pe(g.a,g.b,g.c,g.d)).normal.copy(g.normal),r&&p.normal.applyMatrix3(r).normalize();for(var x=0,A=y.length;x<A;x++)d=y[x].clone(),r&&d.applyMatrix3(r).normalize(),p.vertexNormals.push(d);p.color.copy(g.color);for(var x=0,A=v.length;x<A;x++)m=v[x],p.vertexColors.push(m.clone());p.materialIndex=g.materialIndex,p.centroid.copy(g.centroid),i&&p.centroid.applyMatrix4(i),s.push(p)}for(c=0,u=o.length;c<u;c++){for(var _=o[c],w=[],x=0,A=_.length;x<A;x++)w.push(new le(_[x].x,_[x].y));h.push(w)}if(t){var b=new se.Entity(e.material);return b.vertices=l,b.faces=s,b.uvs=h,b.setPosition(0,0,0),b.setRotation(0,0,0),b.setScale(1,1,1),(M={}).vertices=l,M.faces=s,M.uvs=h,b.primitive=new se.Primitive(M),b}e.vertices=l,e.faces=s,e.uvs=h,e.setPosition(0,0,0),e.setRotation(0,0,0),e.setScale(1,1,1);var M={};M.vertices=l,M.faces=s,M.uvs=h,e.primitive=new se.Primitive(M);for(var c in i.elements)e._attachId+=i.elements[c];return e},Ee.mergeElements=function(e){var t,i,r,a,n,o,s=0,l=0,h=0;for(t=0;t<e.length;t++)s+=(r=e[t]).materialSize;var c=new se.Entity(s),u={},f={},p=(new he(0,0,0),[]),d=[],m=[],g=[],y=new se.ArrayMaterial;for(t=0;t<e.length;t++){for((r=e[t]).matrixAutoUpdate&&r.updateWorldMatrix(),a=r.worldMatrix.clone(),n=(new ce).getNormalMatrix(a),i=0;i<r.vertices.length;i++)o=r.vertices[i],p.push(o.clone().applyMatrix4(a));for(i=0;i<r.faces.length;i++){var v,x=r.faces[i];x.vertexNormals,x.vertexColors;(v=x instanceof Se?new Se(x.a+l,x.b+l,x.c+l):new Pe(x.a+l,x.b+l,x.c+l,x.d+l)).normal.copy(x.normal),n&&v.normal.applyMatrix3(n).normalize(),v.materialIndex=x.materialIndex+h,v.centroid.copy(x.centroid),a&&v.centroid.applyMatrix4(a),d.push(v)}for(i=0,len=r.uvs.length;i<len;i++){for(var A=r.uvs[i],_=[],w=0,b=A.length;w<b;w++)_.push(new le(A[w].x,A[w].y));m.push(_)}if(r.uv2s&&r.uv2s.length>0)for(i=0,len=r.uv2s.length;i<len;i++){for(var M=r.uv2s[i],S=[],w=0,b=M.length;w<b;w++)S.push(new le(M[w].x,M[w].y));g.push(S)}y.materials=y.materials.concat(r.material.materials),l+=r.vertices.length,h+=r.materialSize;for(var P in r.styleMap){var C=u[P];null==C&&(C=[]);var T=r.styleMap[P],E=!0;if(Ee.isArray(T))for(w=0;w<T.length;w++)C.push(T[t]),w>0&&T[w]!=T[w-1]&&(E=!1);else for(w=0;w<r.materialSize;w++)C.push(T);1!=f[P]&&null!=f[P]||(f[P]=E),u[P]=C}}for(var P in f)1==f[P]&&(u[P]=u[P][0]);return c.styleMap=u,c.material=y,c.vertices=p,c.faces=d,c.setUvs(m),c.uv2s=g,c.setUpdateFlags(!0),c},Ee.mergeElement=function(e,i,r){var a,n,o,s,l=e.vertices.length,h=(e.uvs.length,e.vertices),c=i.vertices,u=e.faces,f=i.faces,p=e.uvs,d=i.uvs,m=[],g=[],y=[];r===t&&(r=0),e instanceof se.Element&&(e.matrixAutoUpdate&&e.updateMatrix(),a=e.matrix,n=(new ce).getNormalMatrix(a)),i instanceof se.Element&&(i.matrixAutoUpdate&&i.updateMatrix(),o=i.matrix,s=(new ce).getNormalMatrix(o));for(var v=0,x=h.length;v<x;v++){_=(A=h[v]).clone();a&&_.applyMatrix4(a),g.push(_)}for(var v=0,x=c.length;v<x;v++){var A=c[v],_=A.clone();o&&_.applyMatrix4(o),g.push(_)}for(v=0,x=u.length;v<x;v++){var w=(E=u[v]).vertexNormals,b=E.vertexColors;(P=E instanceof Se?new Se(E.a,E.b,E.c):new Pe(E.a,E.b,E.c,E.d)).normal.copy(E.normal),n&&P.normal.applyMatrix3(n).normalize();for(var M=0,S=w.length;M<S;M++)C=w[M].clone(),n&&C.applyMatrix3(n).normalize(),P.vertexNormals.push(C);P.color.copy(E.color);for(var M=0,S=b.length;M<S;M++)T=b[M],P.vertexColors.push(T.clone());P.materialIndex=E.materialIndex,P.centroid.copy(E.centroid),a&&P.centroid.applyMatrix4(a),m.push(P)}for(v=0,x=f.length;v<x;v++){var P,C,T,E=f[v],w=E.vertexNormals,b=E.vertexColors;(P=E instanceof Se?new Se(E.a+l,E.b+l,E.c+l):new Pe(E.a+l,E.b+l,E.c+l,E.d+l)).normal.copy(E.normal),s&&P.normal.applyMatrix3(s).normalize();for(var M=0,S=w.length;M<S;M++)C=w[M].clone(),s&&C.applyMatrix3(s).normalize(),P.vertexNormals.push(C);P.color.copy(E.color);for(var M=0,S=b.length;M<S;M++)T=b[M],P.vertexColors.push(T.clone());P.materialIndex=E.materialIndex+r,P.centroid.copy(E.centroid),o&&P.centroid.applyMatrix4(o),m.push(P)}for(v=0,x=p.length;v<x;v++){for(var z=[],M=0,S=(D=p[v]).length;M<S;M++)z.push(new le(D[M].x,D[M].y));y.push(z)}for(v=0,x=d.length;v<x;v++){for(var D=d[v],z=[],M=0,S=D.length;M<S;M++)z.push(new le(D[M].x,D[M].y));y.push(z)}return e.vertices=g,e.faces=m,e.uvs=y,e._position.set(0,0,0),e._rotation.set(0,0,0),e._scale.set(1,1,1),e},Ee.autoAdjustNetworkBounds=function(t,i,r,a,n,o){n=n||0,o=o||0,t.adjustBounds(i[r]-n,i[a]-o),!t._resizeFunction&&(t._resizeFunction=function(){t.adjustBounds(i[r]-n,i[a]-o,o,n)}),e.addEventListener("resize",t._resizeFunction,!0)},Ee.isEmptyObject=function(e){for(var t in e)return!1;return!0},Ee.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ee.isSame=function(e,t){if(e===t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;if(typeof e!=typeof t)return!1;for(var i in e)if(e[i]!=t[i])return!1;for(var i in t)if(e[i]!=t[i])return!1;return!0},Ee.toString=function(e){if(e){var t="";for(var i in e)t+=i+":"+e[i];return t}},Ee.validateLicense=function(e){Ie=e,Ze()},Ee.getLicense=function(){return Ie},Ee.getObjectCount=function(e){if(!e)return 0;var t=0;for(var i in e)t++;return t},Ee.isNaN=function(e){return""===e||null===e||isNaN(e)},Ee.getTransformVertices=function(e,t,i){null==i&&(i=[]);var r;if(e instanceof se.Node||e instanceof se.Billboard){for(a=0;a<e.vertices.length;a++)r=e.vertices[a].clone(),e instanceof se.Billboard?(r.x*=e.rotation3d.x,r.y*=e.rotation3d.y,r.add(e.getPosition())):r.applyMatrix4(e.worldMatrix),i.push(r);for(var a=0;a<(e._childList?e._childList.size():0);a++){var n=e._childList.get(a);Ee.getTransformVertices(n,t,i)}}return i},Ee.getBoundingBox=function(e,t){var i,r,a;if(null==e)return null;i=e instanceof _e?e._as:Ee.isArray(e)?e:[e];var n=[];for(r=0;r<i.length;r++)a=i[r],Ee.getTransformVertices(a,t,n);var o=new se.BoundingBox;return o.setFromPoints(n),o},Ee.mergeWrapMap=function(e){if(e instanceof Ce&&!e.getWrapMap()){for(var t,i=[],r=(e.getMaterialMapping(),e.material.materials),a=0;a<r.length;a++)(t=r[a]).map&&-1==i.indexOf(t.map._image)&&i.push(t.map._image);e.setWrapMap(!0)}},Ee.setWrapMap=function(e,t,i,r){Ee.loadImages(t,function(a){var n=mono.Utils.createWrapMapFromImages(a,i,r);n.__uniqueCode="";for(o=0;o<t.length;o++)n.__uniqueCode+=t[o].src;for(var o in i)n.__uniqueCode+=o+":"+i[o];if(Ee.isArray(e))for(o=0;o<e.length;o++)e[o].setStyle("m.texture.image",n),e[o].setClient("_originalImage",t),e[o].setClient("_wrapMapping",i);else e.setStyle("m.texture.image",n),e.setClient("_wrapMapping",i)})},Ee.loadImages=function(e,t){function i(){for(var i=0;i<e.length;i++)if(!e[i].loaded)return;t(e)}if(null!=e&&0!=e.length&&null!=t)for(var r=0;r<e.length;r++){var a=e[r];"string"==typeof a&&(e[r]=new Image,e[r].crossOrigin="",e[r].src=a),function(e){e.onload=function(){e.loaded=!0,i(),e.onload=null}}(a=e[r])}},Ee.createWrapMapFromImages=function(e,t,i,r,a){if(null==e||0==e.length)return null;if("six-each"==(i=(i||"six-each").toLowerCase())||"front-other"==i||"back-other"==i||"left-other"==i||"right-other"==i||"top-other"==i||"bottom-other"==i){null==t&&(t={0:"bottom",1:"top",2:"back",3:"left",4:"front",5:"right"});var n=document.createElement("canvas"),o=n.getContext("2d"),s=0,l=0;if("six-each"==i){var h={bottom:[0,0],top:[1/3,0],back:[2/3,0],left:[0,.5],front:[1/3,.5],right:[2/3,.5]};if(null==r||null==a)for(p=0;p<e.length;p++)s=Math.max(e[p].width,s),l=Math.max(e[p].height,l);l*=2,(s*=3)>1024&&(s=1024),l>1024&&(l=1024);var c,u=["front","back","right","left","top","bottom"],f=[];for(var p in t)"other"!==(g=t[p])?(f.push(g),u.splice(u.indexOf(g),1)):c=p;null!=c&&(t[c]=u),r=r||s,a=a||l,n.setAttribute("width",r),n.setAttribute("height",a);Math.min(e.length,6);for(p=0;p<6;p++)if(A=t[p]){var d=A;d=Ee.isArray(A)?A:-1!=A.indexOf(",")?A.split(","):[A];for(var m=0;m<d.length;m++){var g=d[m],y=h[g][0],v=h[g][1];o.drawImage(e[p],y*r,v*a,r/3,a/2)}}}else{var x=i.split("-")[0];if(null==r||null==a)for(p=0;p<e.length;p++)s+=e[p].width,l=Math.max(e[p].height,l);r=r||s,a=a||l,n.setAttribute("width",r),n.setAttribute("height",a);t[x],Math.min(e.length,2);for(p=0;p<2;p++){var A=t[p];A&&(A==x?o.drawImage(e[p],0,0,r/2,a):o.drawImage(e[p],r/2,0,r/2,a))}}return n}},Ee.getVectorAngles=function(e,t){var i=e;t&&(i=t.clone().sub(e)),i=i.normalize();var r=Math.asin(i.y)*ze;return[Math.atan2(i.x,i.z)*ze,r]},Ee.getPixelFromImage=function(e,t,i){var r;return fe.isCanvas(e)?r=e:((r=document.createElement("canvas")).width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0,e.width,e.height)),t-=Math.floor(t),i=1-(i-=Math.floor(i)),r.getContext("2d").getImageData(e.width*t,e.height*i,1,1).data},Ee.nextPowerOfTwo=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},Ee.createTextBillboard=function(e,t){var i=new mono.Billboard;e=e||"",t=t||{};var r=Ee.createTextImage(e,t);return i.setStyle("m.texture.image",r),i.setScale(r.width,r.height,1),i},Ee.createTextImage=function(e,i){e=e||"";var r=i.font,a=i.color,n=i.background,o=i.powerOfTwo,s=i.canvas,l=i.drawFunction;s=s||document.createElement("canvas"),r=r||'20px "Dialog"',a=a||"white",n=n===t?"#0F90C4":n,o=o||!1;var h,c=i.textAlign||"center";h=Ee.isArray(e)?e:e.split("\n");var u=mono.Utils.getMaxTextSize(h,r),f=i.ratio||u.width/u.height,p=s.realSize={width:u.width,height:u.height};o&&(u.width=mono.Utils.nextPowerOfTwo(u.width),u.height=mono.Utils.nextPowerOfTwo(u.height));var d=s.drawRect={width:p.width/p.height>f?p.width:p.height*f,height:p.width/p.height>f?p.width/f:p.height};Number.isNaN(d.width)&&console.log("debug -- b",p.width,p.height,f),d.width=Math.min(d.width,u.width),d.height=Math.min(d.height,u.height),s.width=u.width,s.height=u.height,Number.isNaN(d.width)&&console.log("debug -- a");var m=s.getContext("2d");if(n&&(m.fillStyle=n),l)l(m,s.width,s.height);else{n&&m.fillRect(0,0,s.width,s.height),m.font=r,m.fillStyle=a,m.strokeStyle="gray",m.textBaseline="middle",m.textAlign=c;for(var g,y=h.length,v=p.height/y,x=0;x<y;x++){Ee.isArray(a)&&(g=a[x])&&(m.fillStyle=g);var A=mono.Utils.getTextSize(r,h[x]),_=(A.width,A.height,s.height,(d.width-p.width)/2);"center"===c?_=d.width/2:"right"===c&&(_=d.width);var w=(d.height-p.height)/2+v/2+x*v+(s.height-d.height);m.strokeText(h[x],_,w),m.fillText(h[x],_,w)}}return s},Ee.createTextImage2=function(e,i){e=e||"",e=String(e);var a=i.font,n=i.color,o=i.background,s=i.powerOfTwo,l=i.canvas,h=i.drawFunction;l=l||document.createElement("canvas"),a=a||'20px "Dialog"',n=n||"white",o=o===t?"#0F90C4":o,s=s||!1;i.align;var c=i.sizeScale||1,u=Ee.getMaxTextSize(e.split("\n"),a);l.realSize={width:u.width,height:u.height},u.width*=c,u.height*=c,s&&(u.width=Ee.nextPowerOfTwo(u.width),u.height=Ee.nextPowerOfTwo(u.height)),l.width=u.width,l.height=u.height;var f=l.getContext("2d");return o&&(f.fillStyle=o),h?h(f,l.width,l.height):(o&&f.fillRect(0,0,l.width,l.height),r(f,e,a,n,l,"center")),l},Ee.getMaxTextSize=function(e,t){if(e&&e.length>0){for(var i=e.length,r=ge.getTextSize(t,e[0]),a=r.width,n=r.height*i,o=0;o<i;o++){var s=ge.getTextSize(t,e[o]).width;a<s&&(a=s)}return{width:a,height:n}}return null},Ee.getTextSize=function(e,t){return ge.getTextSize(e,t)},Ee.playCameraAnimation=function(e,t,i,r,a){if(Ee.activeAnimates&&Ee.activeAnimates instanceof Array)for(var n=0;n<Ee.activeAnimates.length;n++)Ee.activeAnimates[n].stop();if(t=t||e.p(),i=i||e.getTarget(),t.equals(e.getPosition())&&i.equals(e.target))return a&&a(),null;var o=e.getPosition().sub(e.getTarget()),s=(new mono.Vec3).addVectors(o,i);r=r||3e3;var l=mono.Utils.getVectorAngles(i,s),h=mono.Utils.getVectorAngles(i,t),c=h[0]-l[0];c>180?c-=360:c<-180&&(c+=360);var u=h[1]-l[1];u>180?u-=360:u<-180&&(u+=360);var f=e.getTarget(),p=i,d=e.getDistance(),m=(new mono.Vec3).subVectors(t,i).length(),g=l[0],y=l[1],v=h[0],x=h[1],A=new mono.Animate({from:0,to:1,repeat:1,dur:r/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(t){var i=v,r=y>x?y+u*t:x,a=p,n=d+(m-d)*t,o=new mono.Vec3;o.x=a.x+n*Math.sin(i*De)*Math.cos(r*De),o.z=a.z+n*Math.cos(i*De)*Math.cos(r*De),o.y=a.y+n*Math.sin(r*De),e.p(o),e.lookAt(a)},onDone:function(){a&&a()},onStop:function(){}}),_=new mono.Animate({from:0,to:1,repeat:1,dur:r/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(t){var i=g+c*t,r=y>x?y:x,a=p,n=d>m?d:m;if(x>=y)n=m;var o=new mono.Vec3;o.x=a.x+n*Math.sin(i*De)*Math.cos(r*De),o.z=a.z+n*Math.cos(i*De)*Math.cos(r*De),o.y=a.y+n*Math.sin(r*De),e.p(o),e.lookAt(a)},onDone:function(){d=e.getDistance(),f=e.getTarget()},onStop:function(){this.isPlaying&&(delete this.isPlaying,x>=y?a&&a():A.play())}}),w=new mono.Animate({from:0,to:1,dur:r/3,onPlay:function(){this.isPlaying=!0},onUpdate:function(t){var i=g,r=y>x?y:y+u*t,a=(new mono.Vec3).lerpVectors(f,p,t),n=d+(m-d)*t;d>m&&(0!=c||x<y)&&(n=d);var o=new mono.Vec3;o.x=a.x+n*Math.sin(i*De)*Math.cos(r*De),o.z=a.z+n*Math.cos(i*De)*Math.cos(r*De),o.y=a.y+n*Math.sin(r*De),e.p(o),e.lookAt(a)},onDone:function(){},onStop:function(){this.isPlaying&&(delete this.isPlaying,0==c&&x>=y?a&&a():0!=c?_.play():A.play())}});return 0==c&&x>=y?(w.dur=r,w.finish=r):0==c?(A.dur=2*r/3,A.finish=2*r/3):x<y&&(_.dur=2*r/3,_.finish=2*r/3),w.play(),Ee.activeAnimates=[w,_,A],[w,_,A]},Ee.stopAnimate=function(e,t){ie(e,t)},Ee.stopAllAnimates=function(e){re(e)},se.Utils=Ee,se.NurbsUtils={findSpan:function(e,t,i){var r=i.length-e-1;if(t>=i[r])return r-1;if(t<=i[e])return e;for(var a=e,n=r,o=Math.floor((a+n)/2);t<i[o]||t>=i[o+1];)t<i[o]?n=o:a=o,o=Math.floor((a+n)/2);return o},calcBasisFunctions:function(e,t,i,r){var a=[],n=[],o=[];a[0]=1;for(var s=1;s<=i;++s){n[s]=t-r[e+1-s],o[s]=r[e+s]-t;for(var l=0,h=0;h<s;++h){var c=o[h+1],u=n[s-h],f=a[h]/(c+u);a[h]=l+c*f,l=u*f}a[s]=l}return a},calcBSplinePoint:function(e,t,i,r){for(var a=this.findSpan(e,r,t),n=this.calcBasisFunctions(a,r,e,t),o=new se.Vec4(0,0,0,0),s=0;s<=e;++s){var l=i[a-e+s],h=n[s],c=l.w*h;o.x+=l.x*c,o.y+=l.y*c,o.z+=l.z*c,o.w+=l.w*h}return o},calcBasisFunctionDerivatives:function(e,t,i,r,a){for(var n=[],o=0;o<=i;++o)n[o]=0;for(var s=[],o=0;o<=r;++o)s[o]=n.slice(0);for(var l=[],o=0;o<=i;++o)l[o]=n.slice(0);l[0][0]=1;for(var h=n.slice(0),c=n.slice(0),u=1;u<=i;++u){h[u]=t-a[e+1-u],c[u]=a[e+u]-t;for(var f=0,p=0;p<u;++p){var d=c[p+1],m=h[u-p];l[u][p]=d+m;var g=l[p][u-1]/l[u][p];l[p][u]=f+d*g,f=m*g}l[u][u]=f}for(u=0;u<=i;++u)s[0][u]=l[u][i];for(p=0;p<=i;++p){for(var y=0,v=1,x=[],o=0;o<=i;++o)x[o]=n.slice(0);x[0][0]=1;for(S=1;S<=r;++S){var A=0,_=p-S,w=i-S;p>=S&&(x[v][0]=x[y][0]/l[w+1][_],A=x[v][0]*l[_][w]);for(var b=_>=-1?1:-_,M=p-1<=w?S-1:i-p,u=b;u<=M;++u)x[v][u]=(x[y][u]-x[y][u-1])/l[w+1][_+u],A+=x[v][u]*l[_+u][w];p<=w&&(x[v][S]=-x[y][S-1]/l[w+1][p],A+=x[v][S]*l[p][w]),s[S][p]=A;u=y;y=v,v=u}}for(var p=i,S=1;S<=r;++S){for(u=0;u<=i;++u)s[S][u]*=p;p*=i-S}return s},calcBSplineDerivatives:function(e,t,i,r,a){for(var n=a<e?a:e,o=[],s=this.findSpan(e,r,t),l=this.calcBasisFunctionDerivatives(s,r,e,n,t),h=[],c=0;c<i.length;++c){var u=(f=i[c].clone()).w;f.x*=u,f.y*=u,f.z*=u,h[c]=f}for(d=0;d<=n;++d){for(var f=h[s-e].clone().multiplyScalar(l[d][0]),p=1;p<=e;++p)f.add(h[s-e+p].clone().multiplyScalar(l[d][p]));o[d]=f}for(var d=n+1;d<=a+1;++d)o[d]=new se.Vec4(0,0,0);return o},calcKoverI:function(e,t){for(var i=1,r=2;r<=e;++r)i*=r;for(var a=1,r=2;r<=t;++r)a*=r;for(r=2;r<=e-t;++r)a*=r;return i/a},calcRationalCurveDerivatives:function(e){for(var t=e.length,i=[],r=[],a=0;a<t;++a){var n=e[a];i[a]=new se.Vec3(n.x,n.y,n.z),r[a]=n.w}for(var o=[],s=0;s<t;++s){for(var l=i[s].clone(),a=1;a<=s;++a)l.sub(o[s-a].clone().multiplyScalar(this.calcKoverI(s,a)*r[a]));o[s]=l.divideScalar(r[0])}return o},calcNURBSDerivatives:function(e,t,i,r,a){var n=this.calcBSplineDerivatives(e,t,i,r,a);return this.calcRationalCurveDerivatives(n)},calcSurfacePoint:function(e,t,i,r,a,n,o){for(var s=this.findSpan(e,n,i),l=this.findSpan(t,o,r),h=this.calcBasisFunctions(s,n,e,i),c=this.calcBasisFunctions(l,o,t,r),u=[],f=0;f<=t;++f){u[f]=new se.Vec4(0,0,0,0);for(var p=0;p<=e;++p){var d=a[s-e+p][l-t+f].clone(),m=d.w;d.x*=m,d.y*=m,d.z*=m,u[f].add(d.multiplyScalar(h[p]))}}for(var g=new se.Vec4(0,0,0,0),f=0;f<=t;++f)g.add(u[f].multiplyScalar(c[f]));return g.divideScalar(g.w),new se.Vec3(g.x,g.y,g.z)}},se.GLParameters=function(e,t,i){this.material=e,this.network=t,this.precision=t._precision,this.map=!!e.map,this.mapLoaded=!0,this.envMap=!!e.envMap,this.lightMap=!!e.lightMap,this.bumpMap=!!e.bumpMap&&"phong"===e._type,this.normalMap=!!e.normalMap&&"phong"===e._type,this.specularMap=!!e.specularMap,this.vertexColors=e.vertexColors,this.wireframe=e.wireframe,this.fog=t._fog,this.useFog=e.fog,this.fogExp=this.fog instanceof se.FogExp2,this.sizeAttenuation=e.sizeAttenuation,this.skinning=e.skinning,this.maxBones=t.maxBones,this.useVertexTexture=t._supportsBoneTextures&&i&&i.useVertexTexture,this.boneTextureWidth=i&&i.boneTextureWidth,this.boneTextureHeight=i&&i.boneTextureHeight,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.maxMorphTargets=t.maxMorphTargets,this.maxMorphNormals=t.maxMorphNormals,this.maxDirLights=t.maxLightCount.directional,this.maxPointLights=t.maxLightCount.point,this.maxSpotLights=t.maxLightCount.spot,this.maxHemiLights=t.maxLightCount.hemi,this.maxShadows=t.maxShadows,this.maxPointShadows=t.maxPointShadows,this.shadowMapEnable=t._shadowMapEnable&&i.receiveShadow&&this.maxShadows>0,this.pointShadowMapEnable=t._shadowMapEnable&&i.receiveShadow&&this.maxPointShadows>0,this.shadowMapType=t.shadowMapType,this.shadowMapDebug=t.shadowMapDebug,this.shadowMapCascade=t.shadowMapCascade,this.alphaTest=e.alphaTest,this.metal=e.metal,this.perPixel=e.perPixel,this.wrapAround=e.wrapAround,this.doubleSided=e.side===se.DoubleSide&&!pe.isIE,this.flipSided=e.side===se.BackSide,this.useSSAO=t.isSSAOEnable()&&t.pm.isLightMaterial(e),this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.physicallyBasedShading=t.physicallyBasedShading,this.supportsVertexTextures=!1,this.shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC",this.shadowMapType===se.PCFShadowMap?this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":this.shadowMapType===se.PCFSoftShadowMap&&(this.shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"),this.maxGrandient=Ee.getObjectCount(e.gradient)},se.GLParameters.prototype.getShaders=function(e){e=e===t?"":e;var i=this;return[["precision "+i.precision+" float;",e,this.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.gammaInput?"#define GAMMA_INPUT":"",i.gammaOutput?"#define GAMMA_OUTPUT":"",i.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.boneTextureWidth?"#define N_BONE_PIXEL_X "+i.boneTextureWidth.toFixed(1):"",i.boneTextureHeight?"#define N_BONE_PIXEL_Y "+i.boneTextureHeight.toFixed(1):"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable||i.pointShadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),["precision "+this.precision+" float;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",e,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_POINT_SHADOWS "+i.maxPointShadows,i.useSSAO?"#define USE_SSAO":"",i.wireframe?"#define USE_WIREFRAME":"",i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",this.gammaInput?"#define GAMMA_INPUT":"",this.gammaOutput?"#define GAMMA_OUTPUT":"",this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.maxGrandient>0?"#define MAX_GRADIENT "+i.maxGrandient:"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnable?"#define USE_SHADOWMAP":"",i.shadowMapEnable||i.pointShadowMapEnable?"#define "+i.shadowMapTypeDefine:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.pointShadowMapEnable?"#define USE_POINT_SHADOWMAP":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")]};var Le={};Le.setDepthTest=function(e,t){var i=t._gl;t._oldDepthTest!==e&&(e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),t._oldDepthTest=e)},Le.setSmapleAlphaToCoverage=function(e,t){var i=t._gl;t._oldSmapleAlphaToCoverage!==e&&(e?i.enable(i.SAMPLE_ALPHA_TO_COVERAGE):i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),t._oldSmapleAlphaToCoverage=e)},Le.setDepthWrite=function(e,t){var i=t._gl;t._oldDepthWrite!==e&&(i.depthMask(e),t._oldDepthWrite=e)},Le.clear=function(e,i,r,a){var n=a._gl,o=0;(e===t||e)&&(o|=n.COLOR_BUFFER_BIT),(i===t||i)&&(o|=n.DEPTH_BUFFER_BIT),(r===t||r)&&(o|=n.STENCIL_BUFFER_BIT),a._gl.clear(o)},Le.setPolygonOffset=function(e,t,i,r){var a=r._gl;r._oldPolygonOffset!==e&&(e?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL),r._oldPolygonOffset=e),!e||r._oldPolygonOffsetFactor===t&&r._oldPolygonOffsetUnits===i||(a.polygonOffset(t,i),r._oldPolygonOffsetFactor=t,r._oldPolygonOffsetUnits=i)},Le.setBlending=function(e,t,i,r,a){var n=a._gl;e!==a._oldBlending&&(e===se.NoBlending?n.disable(n.BLEND):e===se.AdditiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE)):e===se.SubtractiveBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.ONE_MINUS_SRC_COLOR)):e===se.MultiplyBlending?(n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ZERO,n.SRC_COLOR)):e===se.CustomBlending?n.enable(n.BLEND):(n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)),a._oldBlending=e),e===se.CustomBlending?(t!==this._oldBlendEquation&&(n.blendEquation(Ee.paramToGL(t)),a._oldBlendEquation=t),i===_oldBlendSrc&&r===_oldBlendDst||(n.blendFunc(Ee.paramToGL(i),Ee.paramToGL(r)),a._oldBlendSrc=i,a._oldBlendDst=r)):(a._oldBlendEquation=null,a._oldBlendSrc=null,a._oldBlendDst=null)},Le.enableStencil=function(e){e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,1,1),e.stencilOp(e.KEEP,e.REPLACE,e.REPLACE),e.stencilMask(1),e.clearStencil(0),e.clear(e.STENCIL_BUFFER_BIT)},Le.stencilTest=function(e){e.enable(e.STENCIL_TEST),e.stencilFunc(e.EQUAL,0,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(0)},Le.disableStencil=function(e){e.disable(e.STENCIL_TEST)},Le.r=function(e,t,i,r,a,n,o){e._AK47(t,i,r,a,n,o)},Le.g=function(e,t,i,r,a,n){e.renderGroup(t,i,r,a,n)},se.GLUtils=Le,se.GPU=function(e){var t=e._gl;this._glExtensionTextureFloat=t.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=t.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("Float textures not supported."),this._glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this._maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._maxVertexTextures=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this._maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxAnisotropy=this._glExtensionTextureFilterAnisotropic?t.getParameter(this._glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._supportsVertexTextures=this._maxVertexTextures>0,this._supportsBoneTextures=this._supportsVertexTextures&&this._glExtensionTextureFloat,this._compressedTextureFormats=this._glExtensionCompressedTextureS3TC?t.getParameter(t.COMPRESSED_TEXTURE_FORMATS):[],this._vertexShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),this._vertexShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),this._vertexShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_FLOAT),this._fragmentShaderPrecisionHighpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),this._fragmentShaderPrecisionMediumpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),this._fragmentShaderPrecisionLowpFloat=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_FLOAT),this._vertexShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_INT),this._vertexShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_INT),this._vertexShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.LOW_INT),this._fragmentShaderPrecisionHighpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT),this._fragmentShaderPrecisionMediumpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_INT),this._fragmentShaderPrecisionLowpInt=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.LOW_INT);var i=this._vertexShaderPrecisionHighpFloat&&this._vertexShaderPrecisionHighpFloat.precision>0&&this._fragmentShaderPrecisionHighpFloat&&this._fragmentShaderPrecisionHighpFloat.precision>0,r=this._vertexShaderPrecisionMediumpFloat&&this._vertexShaderPrecisionMediumpFloat.precision>0&&this._fragmentShaderPrecisionMediumpFloat&&this._fragmentShaderPrecisionMediumpFloat.precision>0,a=e._precision;"highp"!==a||i||(r?(a="mediump",console.log("highp not supported, using mediump")):(a="lowp",console.log("highp and mediump not supported, using lowp"))),"mediump"!==a||r||(a="lowp",console.log("mediump not supported, using lowp")),e._precision=a},se.Program=function(e,t,i,r){this.entity=e,this.group=t,this.material=i,this.network=r},se.Program.prototype.setEntity=function(){this.entity},se.Program.prototype.buildGLProgram=function(){},se.Uniform=function(e,i,r){this.id=e,this.type=i,this.value=r,this.location=t},se.Uniform.prototype={constructor:se.Uniform,setValue:function(e){this.value=e},getUniformLocation:function(e,t){return e.getUniformLocation(this.id)}},se.Uniform.loadUniform=function(e,r,a){if(type=r.type,value=r.value,"i"===type)a.uniform1i(e,value);else if("f"===type)a.uniform1f(e,value);else if("v2"===type)a.uniform2f(e,value.x,value.y);else if("v3"===type)a.uniform3f(e,value.x,value.y,value.z);else if("v4"===type)a.uniform4f(e,value.x,value.y,value.z,value.w);else if("c"===type)a.uniform3f(e,value.r,value.g,value.b);else if("iv1"===type)a.uniform1iv(e,value);else if("iv"===type)a.uniform3iv(e,value);else if("fv1"===type)a.uniform1fv(e,value);else if("fv"===type)a.uniform3fv(e,value);else if("v2v"===type){for(r._array===t&&(r._array=new Float32Array(2*value.length)),i=0,il=value.length;i<il;i++)offset=2*i,r._array[offset]=value[i].x,r._array[offset+1]=value[i].y;a.uniform2fv(e,r._array)}else if("v3v"===type){for(r._array===t&&(r._array=new Float32Array(3*value.length)),i=0,il=value.length;i<il;i++)offset=3*i,r._array[offset]=value[i].x,r._array[offset+1]=value[i].y,r._array[offset+2]=value[i].z;a.uniform3fv(e,r._array)}else if("v4v"===type){for(r._array===t&&(r._array=new Float32Array(4*value.length)),i=0,il=value.length;i<il;i++)offset=4*i,r._array[offset]=value[i].x,r._array[offset+1]=value[i].y,r._array[offset+2]=value[i].z,r._array[offset+3]=value[i].w;a.uniform4fv(e,r._array)}else if("m4"===type)r._array===t&&(r._array=new Float32Array(16)),value.flattenToArray(r._array),a.uniformMatrix4fv(e,!1,r._array);else if("m4v"===type){for(r._array===t&&(r._array=new Float32Array(16*value.length)),i=0,il=value.length;i<il;i++)value[i].flattenToArrayOffset(r._array,16*i);a.uniformMatrix4fv(e,!1,r._array)}else if("t"===type)texture=value,textureUnit=getTextureUnit(),a.uniform1i(e,textureUnit),texture&&(texture.image instanceof Array&&6===texture.image.length?setCubeTexture(texture,textureUnit):texture instanceof $CubeRenderTargetCube?setCubeTextureDynamic(texture,textureUnit):_this.setTexture(texture,textureUnit));else if("tv"===type){for(r._array===t&&(r._array=[]),i=0,il=r.value.length;i<il;i++)r._array[i]=getTextureUnit();for(a.uniform1iv(e,r._array),i=0,il=r.value.length;i<il;i++)texture=r.value[i],textureUnit=r._array[i],texture&&_this.setTexture(texture,textureUnit)}},se.Uniform.loadGeneralUniforms=function(e,t,i){var r,a,n;for(a=0,n=t.length;a<n;a++)e.uniforms[t[a][1]]&&(r=t[a][0],se.Uniform.loadUniform(r,i))},se.ProgramManager=function(e){this.id=se.ProgramManagerId++,this.network=e,this.gl=this.network._gl,this.gpu=this.network.gpu,this.programs=[],this.currentProgram=null,this.currentEntity=null,this.currentGroup=null,this.currentMaterial=null,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.textureCount=0,this._lightNeedsUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}},this.gammaInput=!1,this.textureCount=0,this.programMap={},this.textureMap={},this.textureUpdateFlags={},this.glTextureMap={},this.textureMaterialMap={},this.unLoadedImage={},this.materialMap={},this.materialUpdateFlags={},this.handleTextureChange=function(e){if("image"===e.property||"loaded"===e.property){t=e.source;this.changeTextureUpdateFlags(t,!0),delete this.unLoadedImage[t._image]}else if("disposed"===e.property){var t=e.source;this.deallocateTexture(t),t.removePropertyChangeListener(this.handleTextureChange),delete this.textureUpdateFlags[t.id],delete this.textureMap[t.id]}Ee.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()},this.handleMaterialChange=function(e){if("map"==e.property||e.property.endsWith("Map")||"needsUpdate"===e.property){t=e.source;this.materialUpdateFlags[t.id]=!0}else if("disposed"===e.property){var t=e.source;this.deallocateMaterial(t),t.removePropertyChangeListener(this.handleMaterialChange),delete this.materialUpdateFlags[t.id],delete this.materialMap[t.id],delete this.programMap[t.id]}Ee.getObjectCount(this.unLoadedImage)<=0&&this.network.dirtyNetwork()}},se.ProgramManager.prototype.addMaterial=function(e){null==this.materialMap[e.id]&&(this.materialMap[e.id]=e,e.addPropertyChangeListener(this.handleMaterialChange,this))},se.ProgramManager.prototype.dispose=function(){for(var e in this.materialMap)this.materialMap[e].removePropertyChangeListener(this.handleMaterialChange,this);this.materialMap={};for(var e in this.textureMap)this.textureMap[e].removePropertyChangeListener(this.handleTextureChange,this);this.textureMap={}},se.ProgramManager.prototype.needsUpdateMaterial=function(e){return this.materialUpdateFlags[e.id]===t||!0===this.materialUpdateFlags[e.id]||(e.map instanceof Re||e.map instanceof Ne)},se.ProgramManager.prototype.changeMaterialUpdateFlags=function(e,t){this.materialUpdateFlags[e.id]=t},se.ProgramManager.prototype.isLightMaterial=function(e){return e instanceof se.LambertMaterial||e instanceof se.PhongMaterial||e.lights||"lambert"===e._type||"phong"===e._type||"terrain"===e._type},se.ProgramManager.prototype.changeAllMaterialUpdateFlags=function(e,t,i){for(var r in this.materialMap){var a=this.materialMap[r];(null==t||t.call(i,a))&&(this.materialUpdateFlags[a.id]=e)}},se.ProgramManager.prototype.changeAllLightMaterialUpdateFlags=function(e){this.changeAllMaterialUpdateFlags(e,this.isLightMaterial,this)},se.ProgramManager.prototype.addTexture=function(e){null!=e.id&&this.textureMap[e.id]===t&&(this.textureMap[e.id]=e,e.addPropertyChangeListener(this.handleTextureChange,this),e._image.loaded||(this.unLoadedImage[e._image]=1))},se.ProgramManager.prototype.needsUpdateTexture=function(e){return this.textureUpdateFlags[e.id]===t||!0===this.textureUpdateFlags[e.id]},se.ProgramManager.prototype.changeTextureUpdateFlags=function(e,t){this.textureUpdateFlags[e.id]=t;for(var i in this.materialMap){var r=this.materialMap[i];r.map!==e&&r.lightMap!==e&&r.envMap!==e&&r.normalMap!==e&&r.specularMap!==e||this.changeMaterialUpdateFlags(r,!0)}},se.ProgramManager.prototype.buildProgram=function(e,t,i){this.currentEntity=e,this.currentGroup=t,this.currentMaterial=i,i.shaderID||i.setupMaterialShader();var r,a,n,o=new se.GLParameters(this.currentMaterial,this.network,e),s=[];if(i.shaderID?s.push(i.shaderID):(s.push(i.vertexShader),s.push(i.fragmentShader)),i instanceof se.ShaderMaterial);else for(et in o)"material"!==et&&"network"!==et&&"node"!==et&&(s.push(et),s.push(o[et]));for(n=s.join(),m=0,r=this.programs.length;m<r;m++)if(this.programs[m].code===n){i.program=this.programs[m].program,i.uniformsList=[];for(p in i.uniforms)i.uniformsList.push([i.uniforms[p],p]);return this.programs[m].usedTimes++,this.programs[m].program}a=this.gl.createProgram();var l=o.getShaders(),c=l[1],u=l[0];if(this.gl.attachShader(a,h("fragment",c+i.fragmentShader,this.gl)),this.gl.attachShader(a,h("vertex",u+i.vertexShader,this.gl)),this.gl.linkProgram(a),this.gl.getProgramParameter(a,this.gl.LINK_STATUS)||this.gl.isContextLost()||console.log("Could not initialise shader\nVALIDATE_STATUS: "+this.gl.getProgramParameter(a,this.gl.VALIDATE_STATUS)+", gl error ["+this.gl.getError()+"]"),!a)return a;a.uniforms={},a.attributes={};var f,p,d,m;f=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(p in i.uniforms)f.push(p);for(this.attachGLLocations(a,f,"uniform"),f=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],m=0;m<o.maxMorphTargets;m++)f.push("morphTarget"+m);for(m=0;m<o.maxMorphNormals;m++)f.push("morphNormal"+m);for(d in i.attributes)f.push(d);this.attachGLLocations(a,f,"attribute"),a.id=this.programs.length,this.programs.push({program:a,code:n,usedTimes:1}),this.info.memory.programCount=this.programs.length,i.program=a,i.uniformsList=[];for(p in i.uniforms)i.uniformsList.push([i.uniforms[p],p]);return a},se.ProgramManager.prototype.enableAttribute=function(e,i){var r=i.program.attributes;if(r.position>=0&&_gl.enableVertexAttribArray(r.position),r.color>=0&&_gl.enableVertexAttribArray(r.color),r.normal>=0&&_gl.enableVertexAttribArray(r.normal),i.attributes)for(a in i.attributes)r[a]!==t&&r[a]>=0&&_gl.enableVertexAttribArray(r[a])},se.ProgramManager.prototype.attachGLLocations=function(e,t,i){var r,a,n,o=this.gl;if("uniform"===i)for(r=0,a=t.length;r<a;r++)n=t[r],e.uniforms[n]=o.getUniformLocation(e,n);else if("attribute"===i)for(r=0,a=t.length;r<a;r++)n=t[r],e.attributes[n]=o.getAttribLocation(e,n)},se.ProgramManager.prototype.setProgram=function(e,t,i,r,a,s){if(this.textureCount=0,this.addMaterial(r),this.needsUpdateMaterial(r)){r.setupMaterialShader(),this.programMap[r.id]&&this.deallocateMaterial(r);var h=this.buildProgram(s,a,r);this.programMap[r.id]=h,this.changeMaterialUpdateFlags(r,!1)}var c=!1,u=this.programMap[r.id];if(!u)return u;var p=u.uniforms,d=r.uniforms;return u!=this.currentProgram&&(this.gl.useProgram(u),this.currentProgram=u,c=!0),r.id!==this.currentMaterialId&&(this.currentMaterialId=r.id,c=!0),(c||e!==this.network._currentCamera)&&(this.gl.uniformMatrix4fv(p.projectionMatrix,!1,e.projectionMatrix.elements),e!==this.network._currentCamera&&(this.network._currentCamera=e)),i&&r.fog&&i.refreshUniforms(d),(r.lights||"phong"===r._type||"lambert"===r._type||"terrain"===r._type)&&(this._lightNeedsUpdate&&(this.setupLights(u,t),this._lightNeedsUpdate=!1),f(d,this._lights)),c&&r.refreshUniforms(!1,{camera:this.network._camera,network:this.network}),s.receiveShadow&&!r._shadowPass&&this.network.isShadowable()&&(n(d,t),o(d,t)),c&&this.loadUniformsGeneric(u,r.uniformsList,r),r.loadCameraPosition(p,e,this.gl),(r.skinning||"phong"===r._type||"lambert"===r._type||"terrain"===r._type||r instanceof se.ShaderMaterial)&&null!==p.viewMatrix&&this.gl.uniformMatrix4fv(p.viewMatrix,!1,e.worldMatrixInverse.elements),l(p,s,this.gl,this.network),null!=p.modelMatrix&&this.gl.uniformMatrix4fv(p.modelMatrix,!1,s.worldMatrix.elements),this.network._baseRender&&this.loadSSAOUniforms(p,r,c),u},se.ProgramManager.prototype.loadSSAOUniforms=function(e,t,i){if(null!=e.mapSSAO&&this.network._sSAOEnable){var r=e.mapSSAO,a=i?this.getTextureUnit():t._ssaoSlot;this.gl.uniform1i(r,a),this.setTexture(this.network.finalSSAOTarget,a),t._ssaoSlot=a}},se.ProgramManager.prototype.onTextureDispose=function(e){var t=e.target;t.removeEventListener("dispose",onTextureDispose),deallocateTexture(t),this.info.memory.textures--},se.ProgramManager.prototype.deallocateTexture=function(e){var t=this.gl;if(e._image&&e._image.__webglTextureCube)t.deleteTexture(e._image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,t.deleteTexture(e.__webglTexture)}},se.ProgramManager.prototype.setTextureParameters=function(e,t,i,r){var a=this.gl,n=this.gpu,o=se.Utils.paramToGL;i&&!r?(a.texParameteri(e,a.TEXTURE_WRAP_S,o(t.wrapS,a)),a.texParameteri(e,a.TEXTURE_WRAP_T,o(t.wrapT,a)),a.texParameteri(e,a.TEXTURE_MAG_FILTER,o(t.magFilter,a)),a.texParameteri(e,a.TEXTURE_MIN_FILTER,o(t.minFilter,a))):(a.texParameteri(e,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(e,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(e,a.TEXTURE_MAG_FILTER,this.filterFallback(t.magFilter)),a.texParameteri(e,a.TEXTURE_MIN_FILTER,this.filterFallback(t.minFilter))),n._glExtensionTextureFilterAnisotropic&&t.type!==se.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(a.texParameterf(e,n._glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,n._maxAnisotropy)),t.__oldAnisotropy=t.anisotropy)},se.ProgramManager.prototype.setCubeTexture=function(e,i){var r=this.gl;this.addTexture(e);var a=e.id;if(6===e._image.length){if(!e._image.loaded)return;var n=se.Utils.isPowerOfTwo,o=se.Utils.paramToGL;if(this.needsUpdateTexture(e)){this.glTextureMap[a]===t&&(this.glTextureMap[a]=r.createTexture(),this.info.memory.texture++),this.changeTextureUpdateFlags(e,!1),r.activeTexture(r.TEXTURE0+i),r.bindTexture(r.TEXTURE_CUBE_MAP,this.glTextureMap[a]),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var s=e instanceof se.CompressedTexture,l=[],h=0;h<6;h++)this.autoScaleCubemaps&&!s?l[h]=clampToMaxSize(e._image[h],_maxCubemapSize):l[h]=e._image[h];var c=l[0],u=n(c.width)&&n(c.height),f=o(e.format,r),p=o(e.type,r);this.setTextureParameters(r.TEXTURE_CUBE_MAP,e,u);for(h=0;h<6;h++)if(s)for(var d,m=l[h].mipmaps,g=0,y=m.length;g<y;g++)d=m[g],r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,g,f,d.width,d.height,0,d.data);else r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,f,f,p,l[h]);e.generateMipmaps&&u&&r.generateMipmap(r.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else r.activeTexture(r.TEXTURE0+i),r.bindTexture(r.TEXTURE_CUBE_MAP,this.glTextureMap[a])}},se.ProgramManager.prototype.setCubeTextureDynamic=function(e,t){var i=this.gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_CUBE_MAP,e.__webglTexture)},se.ProgramManager.prototype.loadUniformsGeneric=function(e,i,r){var a,n,o,s,l,h,c,u,f,p,d,m=this.gl;for(f=0,p=i.length;f<p;f++)if(s=e.uniforms[i[f][1]])if(a=i[f][0],o=a.type,n=a.value,"i"===o)m.uniform1i(s,n);else if("f"===o)m.uniform1f(s,n);else if("v2"===o)m.uniform2f(s,n.x,n.y);else if("v3"===o)m.uniform3f(s,n.x,n.y,n.z);else if("v4"===o)m.uniform4f(s,n.x,n.y,n.z,n.w);else if("c"===o)m.uniform3f(s,n.r,n.g,n.b);else if("iv1"===o)m.uniform1iv(s,n);else if("iv"===o)m.uniform3iv(s,n);else if("fv1"===o)m.uniform1fv(s,n);else if("fv"===o)m.uniform3fv(s,n);else if("v2v"===o){for(a._array===t&&(a._array=new Float32Array(2*n.length)),c=0,u=n.length;c<u;c++)d=2*c,a._array[d]=n[c].x,a._array[d+1]=n[c].y;m.uniform2fv(s,a._array)}else if("v3v"===o){for(a._array===t&&(a._array=new Float32Array(3*n.length)),c=0,u=n.length;c<u;c++)d=3*c,n[c]instanceof se.Color?(a._array[d]=n[c].r,a._array[d+1]=n[c].g,a._array[d+2]=n[c].b):(a._array[d]=n[c].x,a._array[d+1]=n[c].y,a._array[d+2]=n[c].z);m.uniform3fv(s,a._array)}else if("v4v"===o){for(a._array===t&&(a._array=new Float32Array(4*n.length)),c=0,u=n.length;c<u;c++)d=4*c,a._array[d]=n[c].x,a._array[d+1]=n[c].y,a._array[d+2]=n[c].z,a._array[d+3]=n[c].w;m.uniform4fv(s,a._array)}else if("m4"===o)a._array===t&&(a._array=new Float32Array(16)),n.flattenToArray(a._array),m.uniformMatrix4fv(s,!1,a._array);else if("m4v"===o){for(a._array===t&&(a._array=new Float32Array(16*n.length)),c=0,u=n.length;c<u;c++)n[c].flattenToArrayOffset(a._array,16*c);m.uniformMatrix4fv(s,!1,a._array)}else if("t"===o){if(l=n,h=this.getTextureUnit(),m.uniform1i(s,h),!l)continue;if(l._image instanceof Array&&6===l._image.length)this.setCubeTexture(l,h);else{g=l._image;this.setTexture(l,h,!g||!g.loaded)}}else if("tv"===o){for(a._array===t&&(a._array=[]),c=0,u=a.value.length;c<u;c++)a._array[c]=this.getTextureUnit();if(0==a._array.length)return;for(m.uniform1iv(s,a._array),c=0,u=a.value.length;c<u;c++)if(l=a.value[c],h=a._array[c],l){var g=l._image;l instanceof Ne?this.setCubeTextureDynamic(l,h):this.setTexture(l,h,!g||!g.loaded)}}},se.ProgramManager.prototype.setTexture=function(e,i,r){var a=this.gl,n=se.Utils.isPowerOfTwo,o=e.id;if(this.addTexture(e),!this.needsUpdateTexture(e)||e instanceof Re)a.activeTexture(a.TEXTURE0+i),e instanceof Re?a.bindTexture(a.TEXTURE_2D,e.__webglTexture):a.bindTexture(a.TEXTURE_2D,this.glTextureMap[o]);else{if(!e._image)return;this.glTextureMap[o]===t&&(this.glTextureMap[o]=a.createTexture(),this.info.memory.textures++),this.changeTextureUpdateFlags(e,!1),a.activeTexture(a.TEXTURE0+i),a.bindTexture(a.TEXTURE_2D,this.glTextureMap[o]),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!e.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,e.unpackAlignment);var s=se.Utils.paramToGL,l=r?se.ImageCache.Logo:e._image,h=n(l.width)&&n(l.height),c=s(e.format,a),u=s(e.type,a);this.setTextureParameters(a.TEXTURE_2D,e,h,r);var f,p=e.mipmaps;if(e instanceof se.PixelsTexture)if(p.length>0&&h){for(var d=0,m=p.length;d<m;d++)f=p[d],a.texImage2D(a.TEXTURE_2D,d,c,f.width,f.height,0,c,u,f.data);e.generateMipmaps=!1}else a.texImage2D(a.TEXTURE_2D,0,c,l.width,l.height,0,c,u,l.data);else if(e instanceof se.CompressedTexture)for(var d=0,m=p.length;d<m;d++)f=p[d],a.compressedTexImage2D(a.TEXTURE_2D,d,c,f.width,f.height,0,f.data);else if(p.length>0&&h){for(var d=0,m=p.length;d<m;d++)f=p[d],a.texImage2D(a.TEXTURE_2D,d,c,c,u,f);e.generateMipmaps=!1}else try{a.texImage2D(a.TEXTURE_2D,0,c,c,u,l)}catch(e){console.log(e)}e.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),e.onUpdate&&e.onUpdate()}},se.ProgramManager.prototype.getTextureUnit=function(){var e=this.textureCount;return e>=this.gpu._maxTextures&&console.warn("Network3D: trying to use "+e+" texture units while this GPU supports only "+this.gpu._maxTextures),this.textureCount++,e},se.ProgramManager.prototype.deallocateMaterial=function(e){var i=e.program;if(i!==t){e.program=t;var r,a,n,o=!1;for(r=0,a=this.programs.length;r<a;r++)if((n=this.programs[r]).program===i){0===--n.usedTimes&&(o=!0);break}if(!0===o){var s=[];for(r=0,a=this.programs.length;r<a;r++)(n=this.programs[r]).program!==i&&s.push(n);this.programs=s,this.gl.deleteProgram(i),this.info.memory.programs--}}},se.ProgramManager.prototype.filterFallback=function(e){return e===se.NearestFilter||e===se.NearestMipMapNearestFilter||e===se.NearestMipMapLinearFilter?this.gl.NEAREST:this.gl.LINEAR},se.ProgramManager.prototype.setupLights=function(e,t){var i,r,a,n,o,s,l,h,c,u,f=0,m=0,g=0,y=this._lights,v=y.directional.colors,x=y.directional.positions,A=y.point.colors,_=y.point.positions,w=y.point.distances,b=y.spot.colors,M=y.spot.positions,S=y.spot.distances,P=y.spot.directions,C=y.spot.anglesCos,T=y.spot.exponents,E=y.hemi.skyColors,z=y.hemi.groundColors,D=y.hemi.positions,L=0,R=0,N=0,B=0,I=0,F=0,V=0,U=0,k=0,O=0,X=0,G=0,Y=new se.Vec3;for(i=0,r=t.size();i<r;i++)if(!(a=t.get(i)).onlyShadow)if(n=a.color,l=a.intensity*this.network.lightIntensityRatio,u=a.distance,a.updateWorldMatrix(!0),a instanceof se.AmbientLight){if(!a._visible)continue;this.gammaInput?(f+=n.r*n.r,m+=n.g*n.g,g+=n.b*n.b):(f+=n.r,m+=n.g,g+=n.b)}else if(a instanceof se.DirectionalLight){if(I+=1,!a._visible)continue;if(a.direction?Y.copy(a.direction):(Y.copy(a.worldMatrix.getPosition()),Y.sub(a.target.worldMatrix.getPosition())),Y.normalize(),0===Y.x&&0===Y.y&&0===Y.z)continue;x[k=3*L]=Y.x,x[k+1]=Y.y,x[k+2]=Y.z,this.gammaInput?d(v,k,n,l*l):p(v,k,n,l),L+=1}else if(a instanceof se.PointLight){if(F+=1,!a._visible)continue;O=3*R,this.gammaInput?d(A,O,n,l*l):p(A,O,n,l),c=a.worldMatrix.getPosition(),_[O]=c.x,_[O+1]=c.y,_[O+2]=c.z,w[R]=u,R+=1}else if(a instanceof se.SpotLight){if(V+=1,!a._visible)continue;X=3*N,this.gammaInput?d(b,X,n,l*l):p(b,X,n,l),c=a.worldMatrix.getPosition(),M[X]=c.x,M[X+1]=c.y,M[X+2]=c.z,S[N]=u,Y.copy(c),Y.sub(a.target.worldMatrix.getPosition()),Y.normalize(),P[X]=Y.x,P[X+1]=Y.y,P[X+2]=Y.z,C[N]=Math.cos(a.angle),T[N]=a.exponent,N+=1}else if(a instanceof se.HemisphereLight){if(U+=1,!a._visible)continue;if(Y.copy(a.worldMatrix.getPosition()),Y.normalize(),0===Y.x&&0===Y.y&&0===Y.z)continue;D[G=3*B]=Y.x,D[G+1]=Y.y,D[G+2]=Y.z,o=a.color,s=a.groundColor,this.gammaInput?(d(E,G,o,h=l*l),d(z,G,s,h)):(p(E,G,o,l),p(z,G,s,l)),B+=1}for(i=3*L,r=Math.max(v.length,3*I);i<r;i++)v[i]=0;for(i=3*R,r=Math.max(A.length,3*F);i<r;i++)A[i]=0;for(i=3*N,r=Math.max(b.length,3*V);i<r;i++)b[i]=0;for(i=3*B,r=Math.max(E.length,3*U);i<r;i++)E[i]=0;for(i=3*B,r=Math.max(z.length,3*U);i<r;i++)z[i]=0;y.directional.length=L,y.point.length=R,y.spot.length=N,y.hemi.length=B,y.ambient[0]=f,y.ambient[1]=m,y.ambient[2]=g},se.ProgramManagerId=0;var Re=function(e,i,r){this.width=e,this.height=i,r=r||{},this.wrapS=r.wrapS!==t?r.wrapS:se.ClampToEdgeWrapping,this.wrapT=r.wrapT!==t?r.wrapT:se.ClampToEdgeWrapping,this.magFilter=r.magFilter!==t?r.magFilter:se.LinearFilter,this.minFilter=r.minFilter!==t?r.minFilter:se.LinearMipMapLinearFilter,this.anisotropy=r.anisotropy!==t?r.anisotropy:1,this.offset=new se.Vec2(0,0),this.repeat=new se.Vec2(1,1),this.format=r.format!==t?r.format:se.RGBAFormat,this.type=r.type!==t?r.type:se.UnsignedByteType,this.depthBuffer=r.depthBuffer===t||r.depthBuffer,this.stencilBuffer=r.stencilBuffer===t||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null,this.flipY=!0};Re.prototype={constructor:Re,clone:function(){var e=new Re(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},getUniqueCode:function(){return this._id},dispose:function(){this.dispatchEvent({type:"dispose"})}};var Ne=function(e,t,i){Re.call(this,e,t,i),this.activeCubeFace=0};se.extend(Ne,Re,{}),se.Network3D=function(i,r,a,n){se.Element.call(this);var o=this;this.id=se.Network3DId++,this._interactionDispatcher=new se.EventDispatcher,n=n||{},this.helperBox=new se.DataBox,this.helperBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._rootView=fe.createView("hidden"),this._canvas=a=this.initCanvas(a),this._topCanvas=fe.createCanvas(this),this._bottomCanvas=fe.createCanvas(this);var s=this._canvas.parentNode;s&&(s.removeChild(this._canvas),s.appendChild(this._rootView),this.adjustRootViewBounds(0,0,this._canvas.width,this._canvas.height)),this._rootView.appendChild(this._bottomCanvas),this._rootView.appendChild(this._canvas),this._rootView.appendChild(this._topCanvas),this.setCanvasPropety(),this._camera=r||new se.PerspectiveCamera,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this._clearColor=n.clearColor!==t?n.clearColor:new se.Color(16777215),this._clearAlpha=n.clearAlpha!=t?n.clearAlpha:1,this._precision=n.precision!==t?n.precision:"mediump",this.__fog=new se.FogExp2,this.devicePixelRatio=n.devicePixelRatio!==t?n.devicePixelRatio:e.devicePixelRatio!==t?e.devicePixelRatio:1,this._premultipliedAlpha=null==n.premultipliedAlpha||n.premultipliedAlpha,this.lightIntensityRatio=1,pe.isIOS||pe.isAndroid?(this._antialias=!1,this._preserveDrawingBuffer=!1,this.lightIntensityRatio=.1):(this._preserveDrawingBuffer=null==n.preserveDrawingBuffer||n.preserveDrawingBuffer,this._antialias=n.antialias==t||n.antialias),a.addEventListener("webglcontextlost",function(t){console.log("webgl context lost"),t.preventDefault(),o._animateId&&((o._vrDisplay&&o._vrDisplay.isPresenting?o._vrDisplay:e).cancelAnimationFrame(o._animateId),o._animateId=null)}),a.addEventListener("webglcontextrestored",function(e){console.log("webgl context restored"),o._currentProgram=null,o.billboardRenderer=null,o.pm.dispose(),at.clear(),o._enabledAttributes={},o._currentGroupHash=null,o._oldLineWidth=null,o.gpu=new se.GPU(o),o.pm=new se.ProgramManager(o),o.setDefaultGLState(),o.dirtyNetwork(),o._clearNodeCache(),m(o)}),this._gl=this.initGL(),this._currentProgram=null,this.overrideMaterial=null,this._maxLights=n.maxLights!==t?n.maxLights:4,this._projScreenMatrix=new ue,this._projScreenMatrixPS=new ue,this._frustum=new se.Frustum,this._vector3=new he,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldBlending=null,this._oldBlendEquation=null,this._oldBlendSrc=null,this._oldBlendDst=null,this._currentCamera=null,this._enabledAttributes={},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.gpu=new se.GPU(this),this.pm=new se.ProgramManager(this),this.setDefaultGLState(),this.paintSortFunction=se.Defaults.paintSortFunction,this.sortNodes=!0,this.sortOpaqueOrderByMaterial=!0,this.glNodeList=[],this.helperGLNodeList=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},currentMaterialId:-1},this.projector=new se.Projector,this.up=new se.Vec3(0,1,0),this.position=new se.Vec3(0,0,0),this.seletionMaterial=new se.BasicMaterial,this.seletionMaterial.wireframe=!0,this.seletionMaterial.wireframeLinewidth=1,this.seletionMaterial.color=new se.Color(65280),this.selectionCube=new Ce,this.selectionCube.material=this.seletionMaterial,this.outlineMaterialMap={},this.selectionCube._modelViewMatrix=new ue,this.selectionCube._normalMatrix=new ce,this.selectionCube.name="select",this.alarmMaterial=new se.BasicMaterial,this.alarmMaterial.wireframe=!0,this.alarmMaterial.wireframeLinewidth=1,this.alarmMaterial.color=new se.Color(16711680),this.alarmCube=new Ce,this.alarmCube.material=this.alarmMaterial,this.alarmCube._modelViewMatrix=new ue,this.alarmCube._normalMatrix=new ce,this.alarmCube.name="alarm";this._glowSurface=new se.Plane(2,2),this._glowSurface2=new se.Plane(512,512),this._glowSurface.target=new Re(512,512,{type:se.UnsignedByteType}),this._glowSurface.target1=new Re(512,512,{type:se.UnsignedByteType}),this._glowSurface.target2=new Re(512,512,{type:se.UnsignedByteType}),this._glowSurfaceMaterial=new se.BlurMaterial,this._blurMaterialH=new se.BlurMaterial,this._blurMaterialH.orientation=1,this._blurMaterialV=new se.BlurMaterial,this.deferredPostionMaterial=new se.DeferredMaterial,this.deferredNormalMaterial=new se.DeferredMaterial({isNormal:1}),this.ssaoMaterial=new se.SSAOMaterial,this.ssaoMaterial.map2=new se.Texture(we.ssaoNormalImage);this.deferredPostionTarget=new Re(1024,1024,{type:se.FloatType,magFilter:se.NearestFilter,minFilter:se.NearestFilter}),this.deferredNormalTarget=new Re(1024,1024,{type:se.FloatType,magFilter:se.NearestFilter,minFilter:se.NearestFilter,format:se.RGBFormat}),this.ssaoTarget=new Re(1024,1024,{type:se.FloatType,magFilter:se.NearestFilter,minFilter:se.NearestFilter}),this.ssaoTarget1=new Re(512,512,{type:se.UnsignedByteType}),this.ssaoTarget2=new Re(512,512,{type:se.UnsignedByteType}),this.finalSSAOTarget=null,this._interactions=null,this.billboardRenderer=null,this.flareRenderer=null,this._groupCounter=0,this.groupMap={},this.groupCountMap={},this.bufferNodeMap={},this.lineMap={},this.particleMap={},this.normalNodeMap={},this.showAxis=!1,this.axisSize=20,this.axisPosition=new se.Vec3(0,0,0),this.axis=new se.Axis({size:this.axisSize}),this.alarmBillboards=[],this.areaPickingRect={},this.setDataBox(i===t?new se.DataBox:i),this.renderCallback=null,this.beforeRenderFunction=null,this.dirtyNetwork(),this.prepareData(),this.autoUpdateCameraAspect=!0,this.shadowMapRenderer=null,this.shadowMapType=se.PCFSoftShadowMap,this.shadowMapCullFace=se.CullFaceFront,this.adjustBounds(this._canvas.width,this._canvas.height,0,0),this.getRootView().addEventListener("mousedown",function(e){o.handleMouseDown(e)}),this.getRootView().addEventListener("mouseup",function(e){o.handleClick(e)}),this.setInteractions([new se.DefaultInteraction(this),new se.SelectionInteraction(this)]),this.doubleClickToLookAtFunction=Te.doubleClickToLookAtFunction,m(this),this.initSurfaceGroup(),this.materialRenderListMap={},this._selectTransparencyThreshold=0,this._pickingTexturePixel=!0,this._dynamicBatchDraw=!1,this._dynamicBatchDrawCountLimit=1024,this.needSmoothNormalFunction=Te.needSmoothNormalFunction,this._annotationMap={},this._activeAnnotation=null},se.extend(se.Network3D,se.Data,{___accessor:["shadowMapEnable","editableFunction","keyboardRemoveEnabled","selectTransparencyThreshold","pickingTexturePixel","dynamicBatchDraw","showFps"],setUseFog:function(e){this._useFog=e,this._useFog?this._fog=this.__fog:this._fog=null},setOverloadMaterial:function(e){this._overloadMaterial=e},setFogColor:function(e){this.__fog.color=e},setFogDensity:function(e){this.__fog.density=e},setDataBox:function(e){if(!e)throw"DataBox can not be null";if(this.dataBox!==e){var t=this.dataBox;t&&(this._clearDataBox(t),t.removeDataBoxChangeListener(this.handleDataBoxChange,this),t.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),t.getAlarmBox().removeDataBoxChangeListener(this.dirtyNetwork,this),t.getSelectionModel().removeSelectionChangeListener(this.dirtyNetwork,this)),this.dataBox=e,this.dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this.dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.dataBox.getAlarmBox().addDataBoxChangeListener(this.dirtyNetwork,this),this.dataBox.getSelectionModel().addSelectionChangeListener(this.dirtyNetwork,this),this.firePropertyChange("dataBox",t,this._box),this.glNodeList=[],this.dirtyNetwork(),this._clearNodeCache()}},setRenderCallback:function(e){this.renderCallback=e},setBeforeRenderFunction:function(e){this.beforeRenderFunction=e},getDataBox:function(){return this.dataBox},getClearColor:function(){return this._clearColor},setClearColor:function(e){3==arguments.length?(this._clearColor=new se.Color,this._clearColor.setRGB(arguments[0],arguments[1],arguments[2])):(this._clearColor=e,this._clearColor instanceof se.Color||(this._clearColor=new se.Color(e))),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},setClearAlpha:function(e){this._clearAlpha=e,this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.dirtyNetwork()},getClearAlpha:function(){return this._clearAlpha},getPrecision:function(){return this._precision},setPrecision:function(e){this._precesion=e},setSSAOBlur:function(e){this._ssaoBlur=e},setSSAOEnable:function(e){return!(e&&!this.isFloatTextureSupport())&&(this._sSAOEnable=e,this._dirty=!0,!0)},isSSAOEnable:function(){return this._sSAOEnable&&this._baseRender},setSSAOOccluderBias:function(e){this._occluderBias=e,this._dirty=!0},setSSAOSamplingRadius:function(e){this._samplingRadius=e,this._dirty=!0},setSSAOAttenuation:function(e){this._attenuation=e,this._dirty=!0},isFloatTextureSupport:function(){return null!=this._glExtensionTextureFloat},getCamera:function(){return this._camera},setCamera:function(e,t){if(this._camera!=e){var i=this._camera;if(i.removePropertyChangeListener(this.dirtyNetwork),this._camera=e,this._camera.addPropertyChangeListener(this.dirtyNetwork,this),this.autoUpdateCameraAspect){this._camera.setAspect&&this._camera.setAspect(i.aspect);var r=this.getDefaultInteraction();r&&(r.object=this._camera)}t&&(this._camera.p(i.p()),this._camera.lookAt(i.getTarget())),this.dirtyNetwork()}},isVisible:function(e){if(e){if(e instanceof se.Link||e instanceof se.PathLink){if(!e.isVisible())return!1;if(!this.isVisible(e._fromNode))return!1;if(!this.isVisible(e._toNode))return!1}if(!e.isVisible())return!1;if(e._parent)return this.isVisible(e._parent);if(this.visibleFunction)return this.visibleFunction(e)}return!0},setCanvasPropety:function(){this._canvas&&(this._canvas.setAttribute("tabindex",this.id),this._canvas.style.outline="none",this._canvas.style.position="absolute")},initCanvas:function(e){return e===t?document.createElement("canvas"):("string"==typeof e&&(e=document.getElementById(e)),e)},initGL:function(){var e=this._canvas.gl;if(!e)try{e=this._canvas.getContext("webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})||this._canvas.getContext("experimental-webgl",{preserveDrawingBuffer:this._preserveDrawingBuffer,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:!0})}catch(e){console.log(e)}if(this._initVR(),e||console.error("Can not init webgl context"),this._glExtensionTextureFloat=e.getExtension("OES_texture_float"),this._glExtensionStandardDerivatives=e.getExtension("OES_standard_derivatives"),this._glExtensionTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._glExtensionCompressedTextureS3TC=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._glExtensionTextureFloat||console.log("TGL.Network3D: Float textures not supported."),this._glExtensionStandardDerivatives||console.log("TGL.Network3D: Standard derivatives not supported."),this._glExtensionTextureFilterAnisotropic||console.log("TGL.Network3D: Anisotropic texture filtering not supported."),this._glExtensionCompressedTextureS3TC||console.log("TGL.Network3D: S3TC compressed textures not supported."),e)return e;console.log("Error: Your browser does not support WebGL.")},resetRenderInfo:function(){this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this.info.currentMaterialId=-1},_clearDataBox:function(e,t){for(var i=null,r=(i=e===this.helperBox?this.helperGLNodeList:this.glNodeList).length-1;r>=0;r--){i[r];i.splice(r,1)}i=[],this.prepareData(),this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0);var a=this;(t=t||e.getDatas()).forEach(function(e){a._clearNodeCache(e)}),this.deleteCloneNode()},handleDataBoxChange:function(e){var t=e.kind,i=e.data,r=e.source,a=null;a=r===this.helperBox?this.helperGLNodeList:this.glNodeList,"add"===t?i instanceof se.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof se.Annotation?this._createAnnotationDiv(i):(this.addNodeMaterials(i),this.addNode(i,a),i._alarmBillboard&&this.alarmBillboards.push(i._alarmBillboard)):"remove"===t?i instanceof se.Light?(this.pm._lightNeedsUpdate=!0,this.pm.changeAllLightMaterialUpdateFlags(!0),this.prepareData()):i instanceof se.Annotation?this._removeAnnotationDiv(i):(this.removeNode(i,a),this.deleteCloneNode(i)):"clear"===t&&this._clearDataBox(r,e.datas),this.boundingBox=null,this.shadowMapRenderer&&this.shadowMapRenderer.handleDataBoxChange(e),this.dirtyNetwork()},removeNode:function(e,t){for(var i=t.length-1;i>=0;i--)t[i].node===e&&t.splice(i,1);this._clearNodeCache(e)},_clearNodeCache:function(e){if(e){if(e.oldGroups=e.groups||e.oldGroups,null!=e.oldGroups)for(var t in e.oldGroups){var i=e.oldGroups[t],r=this.groupCountMap[i.id];null!=r&&(--r<=0?(delete this.groupCountMap[i.id],delete this.groupMap[i.id]):this.groupCountMap[i.id]=r)}for(var a=0;a<this.alarmBillboards.length;a++)this.alarmBillboards[a].getParent()===e&&(this.alarmBillboards.splice(a,1),a--);e instanceof se.Annotation&&this._removeAnnotationDiv(e)}else{for(var n in this.groupMap){var o=this.groupMap[n]._nodeId;this.helperBox.containsById(o)||delete this.groupMap[n]}this.alarmBillboards.splice(0),this.glNodeList=[]}for(var n in this._annotationMap)this._removeAnnotationDiv(n)},addNode:function(e,t){for(var i=this.addWebGLNode(t,e),r=0;r<i.length;r++){var a=i[r];this.updateWebGLNode(a)}},addNodeMaterials:function(e){var t,i=e.material;if(i instanceof se.Material)this.addMaterial(i);else if(i instanceof se.ArrayMaterial){var r=i.materials,a=r.length;for(t=0;t<a;t++)this.addMaterial(r[t])}},addMaterial:function(e){this.pm.addMaterial(e),e.map&&this.pm.addTexture(e.map)},handleDataPropertyChange:function(e){var t=e.source;if(t instanceof se.Node){var i=e.property;if(t.isSizeChangedProperty(i)||i===se.Styles.MaterailType||i===se.Styles.NormalType){if(t instanceof se.Line){t.verticesNeedUpdate=!0;n=this.lineMap[t._id];this.initLineBuffers(t),ye.buildLineBufferData(t,this._gl.DYNAMIC_DRAW,this._gl,n)}else if(t.groups){t.verticesNeedUpdate=!0,i!==se.Styles.MaterailType&&i!==se.Styles.NormalType||(t.normalsNeedUpdate=!0);for(var r in t.groups){var a=t.groups[r],n=this.groupMap[a.id],o=ye.getMaterial(t,a.materialIndex);t.normalsNeedUpdate&&this.initGroupBuffer(t,a,n,!0),ye.buildGroupBufferData(a,t,this._gl.DYNAMIC_DRAW,!t.dynamic,o,this._gl,n,this)}}}else if("materialMapping"===i)this._currentGroupHash=null,this.removeNode(t,this.glNodeList),this.addNode(t,this.glNodeList);else if("alarmBillboard"===i){var s=e.oldValue,l=e.newValue;this._addNodeAlarmBillboard(t,s,l)}this.addNodeMaterials(t)}else t instanceof se.Light&&(this.pm._lightNeedsUpdate=!0);(t.isSizeChangedProperty&&t.isSizeChangedProperty(i)||"parent"==i||t.isSpaceChangedProperty(i))&&(this.deleteCloneNode(t),this.boundingBox=null),this.shadowMapRenderer&&this.shadowMapRenderer.handleDataPropertyChange(e),this.dirtyNetwork()},deleteCloneNode:function(e){if(e){var t=e.getId?e.getId():e,i=this.normalNodeMap[t];if(null!=i){i.setParent(null);for(var r in i.groups){var a=i.groups[r];delete this.groupMap[a.id]}}delete this.normalNodeMap[t]}else for(var t in this.normalNodeMap)this.deleteCloneNode(t)},setBlurAmount:function(e){this._blurAmount=e},setBlurScale:function(e){this._blurScale=e},setBlurStrength:function(e){this._blurStrength=e},setBlurGlobalAlpha:function(e){this._blurGlobalAlpha=e},dirtyNetwork:function(e){this.dataBox.batch||(this._dirty=!0)},dirtyShadowMap:function(e){this.shadowMapRenderer&&this.shadowMapRenderer.dirtyShadowMap()},_addNodeAlarmBillboard:function(e,i,r){if(r===t&&(r=e._alarmBillboard),null!=i&&-1!==this.alarmBillboards.indexOf(i)){var a=this.alarmBillboards.indexOf(i);this.alarmBillboards.splice(a,1),i.removePropertyChangeListener(this.dirtyNetwork,this)}r&&-1===this.alarmBillboards.indexOf(r)&&(this.alarmBillboards.push(r),r.addPropertyChangeListener(this.dirtyNetwork,this))},initWebGLNodes:function(e,t){var i,r,a=e.getNodes();for(i=0,r=a.size();i<r;i++){var n=a.get(i);n.renderSelected=!1,this.addWebGLNode(t,n)}for(i=0,r=t.length;i<r;i++)this.updateWebGLNode(t[i])},updateWebGLNode:function(e){var t,i,r=e.node;if(r instanceof se.Entity){for(var a in r.groups)if(t=r.groups[a],i=ye.getMaterial(r,t.materialIndex),r.buffersNeedUpdate){n=this.groupMap[t.id];this.initGroupBuffer(r,t,n),ye.buildGroupBufferData(t,r,this._gl.DYNAMIC_DRAW,!r.dynamic,i,this._gl,n,this)}r.setUpdateFlags(!1),r.buffersNeedUpdate=!1}else if(r instanceof se.BufferNode)this.setBufferNodeData(r,this._gl.DYNAMIC_DRAW,!r.dynamic);else if(r instanceof se.Line){n=this.lineMap[r._id];ye.buildLineBufferData(r,this._gl.DYNAMIC_DRAW,this._gl,n)}else if(r instanceof se.Particle){var n=this.particleMap[r._id];xe(r,this._gl.DYNAMIC_DRAW,this._gl,n)}},addWebGLNode:function(e,i){var r,a,n,o,s=[];if(this._addNodeAlarmBillboard(i),i._modelViewMatrix=new ue,i._normalMatrix=new ce,i instanceof se.Entity){i.groups==t&&ve(i);for(r in i.groups){(a=i.groups[r]).id=a.id===t?se.Network3D.GroupCache._groupCounter++:a.id;var l=this.groupCountMap[a.id]||0;l++,this.groupCountMap[a.id]=l,this.groupMap[a.id]===t&&(this.groupMap[a.id]={}),(h=this.groupMap[a.id])._nodeId=i.getId(),h.__webglVertexBuffer||(this.createGroupBuffer(a,h),this.initGroupBuffer(i,a,h),i.setUpdateFlags(!0))}}else if(i instanceof se.Line)null==this.lineMap[i._id]&&(this.lineMap[i._id]={}),(h=this.lineMap[i._id])._nodeId=i.getId(),h.__webglVertexBuffer||(this.createLineBuffers(i),this.initLineBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0,i.lineDistancesNeedUpdate=!0);else if(i instanceof se.Particle){null==this.lineMap[i._id]&&(this.lineMap[i._id]={});var h=this.lineMap[i._id];h._nodeId=i.getId(),h.__webglVertexBuffer||(this.createParticleBuffers(i),this.initParticleBuffers(i),i.verticesNeedUpdate=!0,i.colorsNeedUpdate=!0)}else i instanceof se.BufferNode?this.initBufferNode(i):i instanceof se.Annotation&&this._createAnnotationDiv(i);if(i instanceof se.Entity){for(r in i.groups)o={group:a=i.groups[r],node:i,opaque:(n=ye.getMaterial(i,a.materialIndex)).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o);i.groups}else i instanceof se.Line||i instanceof se.LensFlare?(o={group:i,node:i,opaque:(n=i.material).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o)):i instanceof se.Particle?(o={group:i,node:i,opaque:(n=i.material).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o)):i instanceof se.BufferNode&&(o={group:i,node:i,opaque:(n=i.material instanceof se.ArrayMaterial?i.material.materials[0]:i.material).transparent?null:n,transparent:n.transparent?n:null},e.push(o),s.push(o));return i.glActive=!0,s},onElementDispose:function(e){var t=e.target;t.removeEventListener("dispose",this.onElementDispose),deallocateElement(t),this.info.memory.geometries--},deallocateElement:function(e){},_AK47:function(e,i,r,a,n,o){this._fog;e.parent===t&&e.updateWorldMatrix(!0,!1),!this._isPresenting&&e.worldMatrixInverse.getInverse(e.worldMatrix),this._projScreenMatrix.multiply(e.projectionMatrix,e.worldMatrixInverse),this._frustum.setFromMatrix(this._projScreenMatrix),0===r.length&&(this.initWebGLNodes(i,r),this.prepareData());var s,l,h,c;if(!o)for(s=0,l=r.length;s<l;s++)(c=(h=r[s]).node).renderSelected=!1,h.render=!1,this.isVisible(c)&&(this.unrollBufferMaterial(h),this.setupMatrices(c,e),(c instanceof se.Entity||c instanceof se.Particle)&&c.frustumCulled&&!this._frustum.intersectsObject(c)||(h.render=!0,this.sortNodes&&(this._vector3.copy(c.worldMatrix.getPosition()),this._vector3.applyProjection(this._projScreenMatrix),null!=c.renderDepth?h.z=c.renderDepth+this._vector3.z:h.z=this._vector3.z)));var u=new _e;if(u.addAll(a),!n&&!o){for(var f=this.alarmBillboards.length-1;f>=0;f--)null==this.alarmBillboards[f].getParent()&&this.alarmBillboards.splice(f,1);u.addAll(this.alarmBillboards)}var p=this;!o&&u.forEach(function(e){e.renderDepth?e.z=e.renderDepth:(p._vector3.copy(e.worldMatrix.getPosition()),p._vector3.applyProjection(p._projScreenMatrix),e.z=p._vector3.z)}),u.size()>0&&!o&&null==this.billboardRenderer&&(this.billboardRenderer=new se.BillboardRenderer),i.getLensFlares().size()>0&&!o&&null==this.flareRenderer&&(this.flareRenderer=new se.FlareRenderer);var d=[].concat(r).concat(u._as),m=this.sortNodesFunc(d);this.setBlending(se.NoBlending),this.renderNodes(m,!1,"opaque",e,i.getLights(),!1,null,o,this.sortOpaqueOrderByMaterial),this.renderNodes(m,!0,"transparent",e,i.getLights(),!0,null,o),this.setDepthTest(!0),this.setDepthWrite(!0)},unrollBufferMaterial:function(e){var t,i,r,a=e.node,n=e.group;(r=a.material)instanceof se.ArrayMaterial?(i=n.materialIndex||0,(t=r.materials[i]).transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r)&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null))},renderLicense:function(){},isShadowable:function(){return this.isShadowMapEnable()&&(this.maxShadows>0||this.maxPointShadows>0)},render:function(){if(this._dirty&&(this.resetRenderInfo(),this._dirty=!1,null!=this.beforeRenderFunction&&this.beforeRenderFunction.call(this),!this.isShadowable()||(this.shadowMapRender(),this.setRenderTarget(t),!this.debugPointLight))){if(Qe.twm(this),this.paintBottom(this._bottomCanvas),this.getShowFps()&&(this.__time=(new Date).getTime()),this.innerRender(this._camera,!0),this.renderAnnotations(this._camera),this.extendRender(this._camera),this.paintTopCanvas(),this.getShowFps()){this._tpf=(new Date).getTime()-this.__time;var e=this._topCanvas.getContext("2d"),i=(1e3/this._tpf).toFixed(0);i>500&&(i="> 500");s="FPS:"+i+",TPF:"+this._tpf+" ms";e.font="20px Arial sans-serif",e.fontWeight="bold",e.lineWith=2,e.fillStyle="rgba(0, 0, 0, 1)",e.fillText(s,10,25)}if(this._xyz!=t){var r,a=this._xyz,n=a.markText,o=a.type,s=(a.expired,a.innerHTML),l=0,h=0,e=(this._topCanvas.getBoundingClientRect(),this._topCanvas.getContext("2d"));n!=t&&null!=n&&""!=n||"2"==o?(e.font="24px Arial sans-serif",r=ge.getTextSize(e.font,s),e.fillStyle="red",l=this._canvas.width-r.width-20,h=this._canvas.height-r.height-10):(e.font="15px Arial sans-serif",e.fillStyle="rgba(240, 120, 25, 0.6)",r=ge.getTextSize(e.font,s),l=this._canvas.width-r.width-20,h=this._canvas.height-r.height-10),e.fillText(s,l,h)}null!=this.renderCallback&&this.renderCallback.call(this)}},getTextSize:function(e,t){return ge.getTextSize(e,t)},shadowMapRender:function(){null==this.shadowMapRenderer&&(this.shadowMapRenderer=new ot,this.shadowMapRenderer.init(this)),0===this.glNodeList.length&&(this.initWebGLNodes(this.dataBox,this.glNodeList),this.prepareData()),this.shadowMapRenderer.render(this.dataBox,this._camera)},handleMouseDown:function(e){var t=e.target;this.lastX=e.clientX,this.lastY=e.clientY,"tgl_annotation"==t.getAttribute("class")&&"1"==t.style.opacity&&(e.stop=!0,e.stopPropagation())},handleClick:function(e){var t=e.clientX-this.lastX,i=e.clientY-this.lastY;if(Math.abs(t)<.1&&Math.abs(i)<.1){var r=e.target;if("tgl_annotation"!=r.getAttribute("clazz"))this._activeAnnotation&&(this._activeAnnotation=null,this.dirtyNetwork());else if("1"==r.style.opacity){var a=r.getAttribute("id"),n=this.getDataBox().getDataById(a),o=this._annotationMap[a];this.handleDefaultAnnotationClick(n,o),this.handleAnnotationClick(n,o),this.dirtyNetwork()}}},handleDefaultAnnotationClick:function(e,t){this._activeAnnotation==e||(this._activeAnnotation=e)},handleAnnotationClick:function(e,t){},renderAnnotations:function(e){var t=this.dataBox.getAnnotations(),i=this;if(t&&(t.forEach(function(t){i.renderAnnotation(e,t)}),this._createAnnotationStyle()),this._activeAnnotation){this._createAnnotationToolTipDiv();var r=this._annotationToolTipDiv;r.innerHTML=this._activeAnnotation.getText();var a=this._annotationMap[this._activeAnnotation.getId()];r.parentNode!=a&&a.appendChild(r),r.style.opacity=a.style.opacity}},getAnnotationDiv:function(e){return this._annotationMap[e.getId()]},renderAnnotation:function(e,t){var i=this._annotationMap[t.getId()];null==i&&(i=this._createAnnotationDiv(t)),i.innerHTML=t._label,t.updateWorldMatrix();var r=t.worldMatrix.getPosition(),a=t.getStyle("annotation.class");i.setAttribute("class",a);var n=this.getViewPosition(r);this._annotationToolTipDiv;i.style.left=n.x+"px",i.style.top=n.y+"px",i.style.opacity="1";var o=r.distanceTo(e.getPosition()),s=this.getElementByScreenPoint(n,!1);s&&s.length>0&&s[0].distance<o&&(i.style.opacity="0.03")},_addCSSRule:function(e,t,i,r){r=r||(e.cssRules||e.rules).length,e.insertRule?e.insertRule(t+"{"+i+"}",r):e.addRule&&e.addRule(t,i,r)},_createAnnotationStyle:function(){if(!this._annotationStyle){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e);var t=e.sheet;this._addCSSRule(t,".tgl_annotation","position:absolute;width:16px;height:16px;border-radius:10px;text-align:center;border : 2px solid gray;"),this._addCSSRule(t,".tgl_annotation:hover","border : 2px solid black;"),this._annotationStyle=e}},_removeAnnotationDiv:function(e){var t=e.getId?e.getId():e,i=this._annotationMap[t];null!=i&&this.getRootView().removeChild(i)},_createAnnotationDiv:function(e){var t=document.createElement("div"),i=e.getStyle("annotation.class");return t.setAttribute("id",e.getId()),t.setAttribute("class",i),t.setAttribute("clazz","tgl_annotation"),this._annotationMap[e.getId()]=t,this.getRootView().appendChild(t),t},_createAnnotationToolTipDiv:function(){if(null==this._annotationToolTipDiv){var e=document.createElement("div");e.setAttribute("class","tgl_annotation_tooltip");var t=document.createElement("style");t.appendChild(document.createTextNode("")),document.head.appendChild(t);var i=t.sheet,r="position: absolute;border: 3px solid #333; background-color: #ccd; padding: 3px;text-align: left;width: 220px;height: 'auto';border-radius: 10px;bottom:35px;left:-13px;";this._addCSSRule(i,".tgl_annotation_tooltip",r),r="content: ' ';position: absolute;top: 100%; border: 1px solid;",this._addCSSRule(i,".tgl_annotation_tooltip:after, .tgl_annotation_tooltip:before",r),r="border-color: #333 transparent transparent transparent;border-width: 16px 17px 0 7px;left: 10px;",this._addCSSRule(i,".tgl_annotation_tooltip:before",r),r="border-color: #ccd transparent transparent transparent;border-width: 12px 11px 0 4px;left: 14px;",this._addCSSRule(i,".tgl_annotation_tooltip:after",r),this._annotationToolTipDiv=e}},extendRender:function(e){},innerRender:function(e,i){if(e===t&&(e=this._camera),null!==e){if(this.debug&&console.log("inner Render"),(!this._vrDisplay||!this._vrDisplay.isPresenting)&&this.autoClear){var r=this._clearColor;this._gl.clearColor(r.r,r.g,r.b,this._clearAlpha),Le.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil,this)}if(i)for(var a=0;a<this._interactions.length;a++){var n=this._interactions[a];n.update&&n.update()}if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),this._vrDisplay||this._gl.viewport(0,0,this._canvas.width,this._canvas.height),this._sSAOEnable){this.linearDepth=e.far-e.near,this.ssaoing=!0,this._renderDeferredTarget(e,this.deferredPostionMaterial,this.deferredPostionTarget),this._renderDeferredTarget(e,this.deferredNormalMaterial,this.deferredNormalTarget),this._setSSAOMaterial(),this._overloadMaterial=null,this._renderSurface(e,this.ssaoTarget,this.ssaoMaterial);u=this._canvas.width/this._canvas.height;this._ssaoBlur?(this._renderBlurTarget(e,this._blurMaterialH,this.ssaoTarget,this.ssaoTarget1,u),this._renderBlurTarget(e,this._blurMaterialV,this.ssaoTarget1,this.ssaoTarget2,u),this.finalSSAOTarget=this.ssaoTarget2):this.finalSSAOTarget=this.ssaoTarget,this.setRenderTarget(t),this.ssaoing=!1}if(this.renderOutline=!1,this.renderOutlineGlow=!1,Le.enableStencil(this._gl),this._baseRender=!0,Le.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards()),this._baseRender=!1,Le.stencilTest(this._gl),this.renderOutline&&Le.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards(),!1,"stencil"),this.renderOutlineGlow){var o=this._glowSurface.target,s=this._glowSurface.target1,l=this._glowSurface.target2;Le.disableStencil(this._gl),this.setRenderTarget(o),o._id=o._id||(new Date).getTime()+"0",s._id=s._id||(new Date).getTime()+"1",l._id=l._id||(new Date).getTime()+"2",this._gl.viewport(0,0,o.width,o.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.colorMask(!1,!1,!1,!1),Le.r(this,e,this.dataBox,this.glNodeList,[],!1,"glow.unselect"),this._gl.colorMask(!0,!0,!0,!0),Le.r(this,e,this.dataBox,this.glNodeList,[],!1,"glow.select");var h,c;this.setRenderTarget(s),this._gl.viewport(0,0,s.width,s.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);u=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new le(o.width,o.height/u),this._blurMaterialH.blurAmount=this._blurAmount||5,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=1;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialH,c,this._glowSurface2);this.setRenderTarget(l),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(s),this._blurMaterialV.texelSize=new le(s.width,s.height/u),this._blurMaterialV.blurAmount=this._blurAmount||5,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=0;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialV,c,this._glowSurface2);this.setRenderTarget(t),this._glowSurface._modelViewMatrix=new ue,this._glowSurface._normalMatrix=new ce,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(l),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,Le.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._glowSurfaceMaterial,c,this._glowSurface);this.setRenderTarget(s),this._gl.viewport(0,0,s.width,s.height),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialH.setMap(o);var u=this._canvas.width/this._canvas.height;this._blurMaterialH.texelSize=new le(o.width,o.height/u),this._blurMaterialH.blurAmount=this._blurAmount||10,this._blurMaterialH.blurScale=this._blurScale||1,this._blurMaterialH.blurStrength=this._blurStrength||1,this._blurMaterialH.orientation=0;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialH,c,this._glowSurface2);this.setRenderTarget(l),this._gl.clearColor(0,0,0,0),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._blurMaterialV.setMap(s),this._blurMaterialV.texelSize=new le(s.width,s.height/u),this._blurMaterialV.blurAmount=this._blurAmount||10,this._blurMaterialV.blurScale=this._blurScale||1,this._blurMaterialV.blurStrength=this._blurStrength||1,this._blurMaterialV.orientation=1;for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._blurMaterialV,c,this._glowSurface2);this.setRenderTarget(t),this._glowSurface._modelViewMatrix=new ue,this._glowSurface._normalMatrix=new ce,this.setupMatrices(this._glowSurface,e),this._glowSurfaceMaterial.setMap(l),this._glowSurfaceMaterial.useBlur=0,this._glowSurfaceMaterial.blurGlobalAlpha=this._blurGlobalAlpha||1,Le.setBlending(this._glowSurfaceMaterial.blendMode,this._glowSurfaceMaterial.blendEquation,this._glowSurfaceMaterial.blendSrc,this._glowSurfaceMaterial.blendDst,this),this._gl.enable(this._gl.STENCIL_TEST);for(h in this._glowSurface.groups)c=this._glowSurface.groups[h],this.renderGroup(e,[],this._glowSurfaceMaterial,c,this._glowSurface);this._gl.clearColor(0,0,0,0)}Le.disableStencil(this._gl),this.renderHelper(e)}else console.log(" no camera")},_renderDeferredTarget:function(e,t,i,r){r=r||new se.Vec4(0,0,0,0,0),t.linearDepth=this.linearDepth,this.setRenderTarget(i),this._overloadMaterial=t,this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),Le.r(this,e,this.dataBox,this.glNodeList,this.dataBox.getBillboards())},_renderBlurTarget:function(e,t,i,r,a){clearColor=clearColor||new se.Vec4(0,0,0,0,0),this.setRenderTarget(r),this._gl.viewport(0,0,r.width,r.height),this._gl.clearColor(clearColor.x,clearColor.y,clearColor.z,clearColor.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),t.setMap(i),t.texelSize=new le(i.width,i.height/a),t.blurAmount=this._blurAmount||5,t.blurScale=this._blurScale||1,t.blurStrength=this._blurStrength||1;var n,o;for(n in this._glowSurface.groups)o=this._glowSurface.groups[n],this.renderGroup(e,[],t,o,this._glowSurface2)},_setSSAOMaterial:function(){this.ssaoMaterial.map=this.deferredPostionTarget,this.ssaoMaterial.map1=this.deferredNormalTarget,this.ssaoMaterial.attenuation=this._attenuation||new le(1,.02),this.ssaoMaterial.occluderBias=this._occluderBias||.5,this.ssaoMaterial.samplingRadius=this._samplingRadius||20,this.ssaoMaterial.texelSize=new le(1/this.deferredPostionTarget.width,1/this.deferredPostionTarget.height)},_renderSurface:function(e,t,i,r){r=r||new se.Vec4(1,1,1,1),this.setRenderTarget(t),this._gl.clearColor(r.x,r.y,r.z,r.w),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._glowSurface._modelViewMatrix=new ue,this._glowSurface._normalMatrix=new ce,this.setupMatrices(this._glowSurface,e);var a,n;for(n in this._glowSurface.groups)a=this._glowSurface.groups[n],this.renderGroup(e,[],i,a,this._glowSurface)},renderHelper:function(e){Le.r(this,e,this.helperBox,this.helperGLNodeList,this.helperBox.getBillboards(),"stencil")},initSurfaceGroup:function(){this._glowSurface.setUpdateFlags(!0),ve(this._glowSurface);for(var e in this._glowSurface.groups){(i=this._glowSurface.groups[e]).id=i.id===t?se.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===t&&(this.groupMap[i.id]={});r=this.groupMap[i.id];this.createGroupBuffer(i,r),this.initGroupBuffer(this._glowSurface,i,r),ye.buildGroupBufferData(i,this._glowSurface,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,r,this)}this._glowSurface2.setUpdateFlags(!0),ve(this._glowSurface2);for(var e in this._glowSurface2.groups){var i=this._glowSurface2.groups[e];i.id=i.id===t?se.Network3D.GroupCache._groupCounter++:i.id,this.groupMap[i.id]===t&&(this.groupMap[i.id]={});var r=this.groupMap[i.id];this.createGroupBuffer(i,r),this.initGroupBuffer(this._glowSurface2,i,r),ye.buildGroupBufferData(i,this._glowSurface2,this._gl.DYNAMIC_DRAW,!1,this._glowSurfaceMaterial,this._gl,r,this)}},getOutlineMaterial:function(e,t){var i=(t.getStyle("select.width")||1)+1+" "+new se.Color(t.getStyle("select.color")).getUniqueCode()+e,r=this.outlineMaterialMap[i];return null==r&&(r=new se.EntityMaterial,"outline.normal"==e?(r._type="outline",r.outline=t.getStyle("select.width")||1):"outline.glow"==e?r._type="basic":(r.wireframe=!0,r.wireframeLinewidth=(t.getStyle("select.width")||1)+1),r.color=new se.Color(t.getStyle("select.color")),this.outlineMaterialMap[i]=r),r},renderNodes:function(e,t,i,r,a,n,o,s,l){if("glow.unselect"!==s||!n){var h,c,u,f,p,d,m;t?(p=e.length-1,d=-1,m=-1):(p=0,d=e.length,m=1);for(var g=p;g!==d;g+=m)if(h=e[g],f=h.node?h.transparent||h.opaque:h.material){this._overloadMaterial&&(f=this._overloadMaterial);var y=this.getOverLoadMaterial(h.node?h.node:h,f);if(y){var v=y.getUniqueCode(),x=at.getMaterial(v);x?f=x:(at.setMaterial(v,y),f=y)}if(!("opaque"==i&&1==f.transparent||"transparent"==i&&0==f.transparent)){if(n?(Le.setBlending(f.blendMode,f.blendEquation,f.blendSrc,f.blendDst,this),Le.setDepthWrite(!1,this)):Le.setDepthWrite(f.depthMask,this),h instanceof se.Billboard)i==(h.material.transparent?"transparent":"opaque")&&this.billboardRenderer.render(this,[h],r,2*this._canvas.width,2*this._canvas.height,y);else if(h.render){if(this.billboardRenderer&&this.billboardRenderer.disable(),this.flareRenderer&&this.flareRenderer.disable(),c=h.node,u=h.group,Le.setDepthTest(f.depthTest,this),Le.setPolygonOffset(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits,this),this.setGLFaces(f),c instanceof se.Particle){if(c.verticesNeedUpdate||c.colorsNeedUpdate||c.sortParticles){var A=this.particleMap[c._id];xe(c,this._gl.DYNAMIC_DRAW,this._gl,A)}c.verticesNeedUpdate=!1,c.colorsNeedUpdate=!1}var _=this.getSelectStyle(c);if("outline"==_&&(_="outline.normal"),s?"glow.unselect"===s&&(c.isSelected()||(c instanceof se.BufferNode?this.renderBufferNode(r,a,f,u,c):Le.g(this,r,a,f,u,c))):(!c.isSelected()||"outline.normal"!==_&&"outline.wireframe"!==_&&"outline.glow"!==_?this.setStencilTest(!1):(this.setStencilTest(!0),"outline.glow"===_?this.renderOutlineGlow=!0:this.renderOutline=!0),c instanceof se.BufferNode?this.renderBufferNode(r,a,f,u,c):(this._gl.stencilMask(this._oldStencilTest?1:0),Le.g(this,r,a,f,u,c))),c.isSelected()&&this.renderSelect(c))if("outline.normal"===_||"outline.wireframe"===_||"outline.glow"===_){if(null!=s&&"glow.unselect"!=s)if("outline.normal"===_){if(!1===c.renderSelected){M=this.getOutlineMaterial(_,c);if(null==(w=this.normalNodeMap[c.getId()])){var w=this.cloneNode(c,M);this.normalNodeMap[c.getId()]=w}this.setupMatrices(w,r);for(var b in w.groups)Le.g(this,r,a,M,w.groups[b],w);c.renderSelected=!0}}else if("outline.normal"!==_){var M=this.getOutlineMaterial(_,c);Le.g(this,r,a,M,u,c)}}else!1===c.renderSelected&&(this.renderNodeSelection(r,a,c),c.renderSelected=!0);c instanceof se.LensFlare&&this.flareRenderer&&this.flareRenderer.render(this,[h],r,2*this._canvas.width,2*this._canvas.height),c.getAlarmState().getPropagateSeverity()&&this.renderAlarmBorder(c)&&this.renderNodeAlarm(r,a,c)}c&&c.setUpdateFlags(!1)}}}},cloneNode:function(e,t){var i,r,a=new se.Entity,n={vertices:[],uvs:[],faces:[]};for(i=0,r=e.vertices.length;i<r;i++)n.vertices.push(e.vertices[i].clone());for(i=0,r=e.faces.length;i<r;i++)n.faces.push(e.faces[i].clone());for(i=0,r=e.uvs.lenght;i<r;i++){for(var o=uvs[i],s=[],l=0;l<o;l++)s.push(o[l].clone());n.uvs.push(s)}return se.Node.prototype.mergeVertices.call(n),se.Node.prototype.computeFaceNormals.call(n),se.Node.prototype.computeVertexNormals.call(n,!0),a.setPosition(e.getPosition()),a.setScale(e.getScale()),a.setRotation(e.getRotation()),a.setParent(e.getParent()),a._modelViewMatrix=new ue,a._normalMatrix=new ce,a.data=n,a.vertices=n.vertices,a.uvs=n.uvs,a.faces=n.faces,a.material=t,a.primitive=new se.Primitive(n),a.setUpdateFlags(!0),ve(a),this.buildNodeBufferData(a),a},buildNodeBufferData:function(e){for(var i in e.groups){var r=e.groups[i];r.id=r.id===t?se.Network3D.GroupCache._groupCounter++:r.id,this.groupMap[r.id]===t&&(this.groupMap[r.id]={});var a=this.groupMap[r.id];this.createGroupBuffer(r,a),this.initGroupBuffer(e,r,a),ye.buildGroupBufferData(r,e,this._gl.DYNAMIC_DRAW,!1,e.material,this._gl,a,this)}},needSmoothNormal:function(e,i){var r=i.normalType;return r!=t?r===se.NormalTypeSmooth:!!this.needSmoothNormalFunction&&this.needSmoothNormalFunction(e)},renderNodeSelection:function(e,i,r){r.createSelectionCube(this.selectionCube),this.setupMatrices(this.selectionCube,e);var a=this.selectionCube.groups;this.selectionCube.material.needsUpdate=!0;for(var n in a){var o=a[n];o.id=o.id===t?se.Network3D.GroupCache._groupCounter++:o.id,this.groupMap[o.id]===t&&(this.groupMap[o.id]={});var s=this.groupMap[o.id];s.__webglVertexBuffer||(this.createGroupBuffer(o,s),this.initGroupBuffer(r,o,s)),this.selectionCube.setUpdateFlags(!0),ye.buildGroupBufferData(o,this.selectionCube,this._gl.DYNAMIC_DRAW,!1,this.selectionCube.material,this._gl,s,this),this.renderGroup(e,[],this.selectionCube.material,o,this.selectionCube)}},renderNodeAlarm:function(e,i,r){r.createPropagateAlarmCube(this.alarmCube),this.setupMatrices(this.alarmCube,e);var a=this.alarmCube.groups;this.alarmCube.material.needsUpdate=!0;for(var n in a){var o=a[n];o.id=o.id===t?se.Network3D.GroupCache._groupCounter++:o.id,this.groupMap[o.id]===t&&(this.groupMap[o.id]={});var s=this.groupMap[o.id];s.__webglVertexBuffer||(this.createGroupBuffer(o,s),this.initGroupBuffer(r,o,s)),this.alarmCube.setUpdateFlags(!0),ye.buildGroupBufferData(o,this.alarmCube,this._gl.DYNAMIC_DRAW,!1,this.alarmCube.material,this._gl,s,this),this.renderGroup(e,[],this.alarmCube.material,o,this.alarmCube)}},renderBufferNode:function(e,t,i,r,a,n){if(!1!==i.visible){var o,s;s=(o=this.pm.setProgram(e,t,this._fog,i,r,a)).attributes;var l=a,h=!1,c=i.wireframe?1:0,u=16777215*r._id+2*o.id+c;(u!==this._currentGroupHash||n)&&(this._currentGroupHash=u,h=!0),h&&this.disableAttributes();var f=this._gl,p=l.attributes.index,d=this.bufferNodeMap[a._id];if(p){var m=l.offsets;m.length>1&&(h=!0);for(var g=0,y=m.length;g<y;g++){var v=m[g].index;if(h){x=(P=l.attributes.position).itemSize;f.bindBuffer(f.ARRAY_BUFFER,d.position),this.enableAttribute(s.position),f.vertexAttribPointer(s.position,x,f.FLOAT,!1,0,v*x*4);A=l.attributes.normal;if(s.normal>=0&&A){_=A.itemSize;f.bindBuffer(f.ARRAY_BUFFER,d.normal),this.enableAttribute(s.normal),f.vertexAttribPointer(s.normal,_,f.FLOAT,!1,0,v*_*4)}w=l.attributes.uv;if(s.uv>=0&&w){b=w.itemSize;f.bindBuffer(f.ARRAY_BUFFER,d.uv),this.enableAttribute(s.uv),f.vertexAttribPointer(s.uv,b,f.FLOAT,!1,0,v*b*4)}M=l.attributes.color;if(s.color>=0&&M){S=M.itemSize;f.bindBuffer(f.ARRAY_BUFFER,d.color),this.enableAttribute(s.color),f.vertexAttribPointer(s.color,S,f.FLOAT,!1,0,v*S*4)}f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.index)}f.drawElements(f.TRIANGLES,m[g].count,f.UNSIGNED_SHORT,2*m[g].start),this.info.render.calls++,this.info.render.vertices+=m[g].count,this.info.render.faces+=m[g].count/3}}else{if(h){var x=(P=l.attributes.position).itemSize;f.bindBuffer(f.ARRAY_BUFFER,P.buffer),this.enableAttribute(s.position),f.vertexAttribPointer(s.position,x,f.FLOAT,!1,0,0);var A=l.attributes.normal;if(s.normal>=0&&A){var _=A.itemSize;f.bindBuffer(f.ARRAY_BUFFER,A.buffer),this.enableAttribute(s.normal),f.vertexAttribPointer(s.normal,_,f.FLOAT,!1,0,0)}var w=l.attributes.uv;if(s.uv>=0&&w){var b=w.itemSize;f.bindBuffer(f.ARRAY_BUFFER,w.buffer),this.enableAttribute(s.uv),f.vertexAttribPointer(s.uv,b,f.FLOAT,!1,0,0)}var M=l.attributes.color;if(s.color>=0&&M){var S=M.itemSize;f.bindBuffer(f.ARRAY_BUFFER,M.buffer),this.enableAttribute(s.color),f.vertexAttribPointer(s.color,S,f.FLOAT,!1,0,0)}}var P=l.attributes.position;f.drawArrays(f.TRIANGLES,0,P.numItems/3),this.info.render.calls++,this.info.render.vertices+=P.numItems/3,this.info.render.faces+=P.numItems/3/3}}},getOverLoadMaterial:function(e,t){return null},renderGroup:function(e,t,i,r,a){if(null==i&&console.log("material is null"),!1!==i.visible){var n,o=this._gl;if(a instanceof se.Entity?n=this.groupMap[r.id]:a instanceof se.Line?n=this.lineMap[r._id]:a instanceof se.Particle&&(n=this.particleMap[r._id]),null!=n){var s,l,h,c,u,f;if(s=this.pm.setProgram(e,t,this._fog,i,r,a)){l=s.attributes;var p,d=!1,m=i.wireframe?1:0;if((p=null!=r.id?16777215*r.id+2*s.id+m:r._id+""+(2*s.id+m))!==this._currentGroupHash&&(this._currentGroupHash=p,d=!0),d&&this.disableAttributes(),l.position>=0&&d&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglVertexBuffer),this.enableAttribute(l.position),o.vertexAttribPointer(l.position,3,o.FLOAT,!1,0,0)),d){if(n.__webglCustomAttributesList)for(u=0,f=n.__webglCustomAttributesList.length;u<f;u++)l[(c=n.__webglCustomAttributesList[u]).buffer.belongsToAttribute]>=0&&(o.bindBuffer(o.ARRAY_BUFFER,c.buffer),this.enableAttribute(l[c.buffer.belongsToAttribute]),o.vertexAttribPointer(l[c.buffer.belongsToAttribute],c.size,o.FLOAT,!1,0,0));l.color>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglColorBuffer),this.enableAttribute(l.color),o.vertexAttribPointer(l.color,3,o.FLOAT,!1,0,0)),l.normal>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglNormalBuffer),this.enableAttribute(l.normal),o.vertexAttribPointer(l.normal,3,o.FLOAT,!1,0,0)),l.uv>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglUVBuffer),this.enableAttribute(l.uv),o.vertexAttribPointer(l.uv,2,o.FLOAT,!1,0,0)),l.uv2>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglUV2Buffer),this.enableAttribute(l.uv2),o.vertexAttribPointer(l.uv2,2,o.FLOAT,!1,0,0)),l.lineDistance>=0&&(o.bindBuffer(o.ARRAY_BUFFER,n.__webglLineDistanceBuffer),this.enableAttribute(l.lineDistance),o.vertexAttribPointer(l.lineDistance,1,o.FLOAT,!1,0,0))}a instanceof se.Entity?(i.wireframe?(this.setLineWidth(i.wireframeLinewidth),this._gl.lineJoin="round",d&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),o.drawElements(o.LINES,n.__webglLineCount,o.UNSIGNED_SHORT,0)):(d&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),o.drawElements(o.TRIANGLES,n.__webglFaceCount,o.UNSIGNED_SHORT,0)),this.info.render.calls++,this.info.render.vertices+=n.__webglFaceCount,this.info.render.faces+=n.__webglFaceCount/3):a instanceof se.Line?(h=a.type===se.LineStrip?o.LINE_STRIP:o.LINES,this.setLineWidth(i.linewidth),o.drawArrays(h,0,n.__webglLineCount),this.info.render.calls++):a instanceof se.Particle?(o.drawArrays(o.POINTS,0,n.__webglParticleCount),this.info.render.calls++,this.info.render.points+=n.__webglParticleCount):a instanceof se.Ribbon&&(o.drawArrays(o.TRIANGLE_STRIP,0,r.__webglVertexCount),this.info.render.calls++)}}else this.debug&&console.error("tempGroup for id:"+(r.id||r._id)+" is null,please check")}},prepareData:function(){this.maxLightCount=this.dataBox.allocateLights(this._maxLights),this.maxShadows=this.dataBox.allocateShadows(),this.maxPointShadows=this.dataBox.allocatePointShadows()},wrapBillboardMaterial:function(e){e instanceof se.Billboard&&e.material&&(e.opaque=e.material.transparent?null:e.material,e.transparent=e.material.transparent?e.material:null)},sortNodesFunc:function(e){if(this.sortNodes&&(null!==this.paintSortFunction||this.sortOpaqueOrderByMaterial)){var t=this;this.sortOpaqueOrderByMaterial?null==this.__st&&(this.__st=function(e,i){t.wrapBillboardMaterial(e),t.wrapBillboardMaterial(e);if(e.opaque&&i.opaque)return e.opaque.id-i.opaque.id;if(!e.opaque&&i.opaque)return-1;if(e.opaque&&!i.opaque)return 1;if(e.transparent&&i.transparent)return e.transparent.id-i.transparent.id;var r=e.node?e.node:e,a=i.node?i.node:i;return r.z=e.z,a.z=i.z,t.paintSortFunction?t.paintSortFunction(r,a):void 0}):null==this.__st&&(this.__st=function(e,i){if(e.transparent||i.transparent)return e.transparent&&i.transparent?e.transparent.id-i.transparent.id:e.transparent?-1:1;var r=e.node?e.node:e,a=i.node?i.node:i;return r.z=e.z,a.z=i.z,t.paintSortFunction?t.paintSortFunction(r,a):void 0}),e.sort(this.__st)}return e},renderNode:function(e,t){this.setupMatrices(e),e instanceof se.Entity&&renderEntity(e)},paintTopCanvas:function(){var e=this._topCanvas.getContext("2d");e.clearRect(0,0,this._topCanvas.width,this._topCanvas.height);var t=this.areaPickingRect;t&&(e.beginPath(),e.lineStyle="#FFffff",e.rect(t.x,t.y,t.w,t.h),e.stroke()),this.renderLicense()},setBackgroundImage:function(e){if("string"==typeof e){var t=new Image;e.startsWith("data:image")||(t.crossOrigin="use-credentials"),t.src=e,this._backgroundImage=t;var i=this;t.onload=function(){i.dirtyNetwork()}}else this._backgroundImage=e,this.dirtyNetwork()},paintBottom:function(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var i=this._backgroundImage;i instanceof Image&&i.height&&t.drawImage(i,0,0,e.width,e.height)},initBufferNode:function(e){if(!this.bufferNodeMap[e._id]){var t={};this.bufferNodeMap[e._id]=t;var i,r,a,n=this._gl;for(i in e.attributes)a="index"===i?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER,r=e.attributes[i],t[i]=n.createBuffer(),n.bindBuffer(a,t[i]),n.bufferData(a,r.array,n.STATIC_DRAW)}},setBufferNodeData:function(e,i,r){var a=this.bufferNodeMap[e._id],n=e.attributes,o=n.index,s=n.position,l=n.normal,h=n.uv,c=n.color,u=(n.tangent,this._gl);if(e.elementsNeedUpdate&&o!==t&&(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.index),u.bufferData(u.ELEMENT_ARRAY_BUFFER,o.array,i)),e.verticesNeedUpdate&&s!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.position),u.bufferData(u.ARRAY_BUFFER,s.array,i)),e.normalsNeedUpdate&&l!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.normal),u.bufferData(u.ARRAY_BUFFER,l.array,i)),e.uvsNeedUpdate&&h!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.uv),u.bufferData(u.ARRAY_BUFFER,h.array,i)),e.colorsNeedUpdate&&c!==t&&(u.bindBuffer(u.ARRAY_BUFFER,a.color),u.bufferData(u.ARRAY_BUFFER,c.array,i)),r)for(var f in e.attributes);},initGroupBuffer:function(e,t,i,r){var a=this._gl,n=t.faces3,o=t.faces4,s=3*n.length+4*o.length,l=1*n.length+2*o.length,h=3*n.length+4*o.length,c=ye.getMaterial(e,t.materialIndex?t.materialIndex:0),u=c.needUV(),f=c.getNormalType(),p=c.isVertexColor(),d=c.isGradientColor();if(i.__vertexArray=new Float32Array(3*s),f&&(i.__normalArray=new Float32Array(3*s)),!r){p&&(i.__colorArray=new Float32Array(3*s)),d&&(i.__color2Array=new Float32Array(6)),u&&(i.__uvArray=new Float32Array(2*s),e.uv2s&&(i.__uv2Array=new Float32Array(2*s))),i.__faceArray=new Uint16Array(3*l),i.__lineArray=new Uint16Array(2*h);var m,g;if(t.numMorphTargets)for(i.__morphTargetsArrays=[],m=0,g=t.numMorphTargets;m<g;m++)i.__morphTargetsArrays.push(new Float32Array(3*s));if(t.numMorphNormals)for(i.__morphNormalsArrays=[],m=0,g=t.numMorphNormals;m<g;m++)i.__morphNormalsArrays.push(new Float32Array(3*s));if(i.__webglFaceCount=3*l,i.__webglLineCount=2*h,c.attributes){i.__webglCustomAttributesList=[];for(var y in c.attributes){var v=c.attributes[y],x={};for(var A in v)x[A]=v[A];if(!x.__webglInitialized||x.createUniqueBuffers){x.__webglInitialized=!0;var _=1;"v2"===x.type?_=2:"v3"===x.type?_=3:"v4"===x.type?_=4:"c"===x.type&&(_=3),x.size=_,x.array=new Float32Array(s*_),x.buffer=a.createBuffer(),x.buffer.belongsToAttribute=y,v.needsUpdate=!0,x.__original=v,x.value=e.data[x.ref]}i.__webglCustomAttributesList.push(x)}}i.__inittedArrays=!0}},createLineBuffers:function(e){null==this.lineMap[e._id]&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglLineDistanceBuffer=i.createBuffer(),this.info.memory.geometries++},initLineBuffers:function(e){null==this.lineMap[e._id]&&(this.lineMap[e._id]={});var t=this.lineMap[e._id],i=e.vertices.length;t.__vertexArray=new Float32Array(3*i),t.__colorArray=new Float32Array(3*i),t.__color2Array=new Float32Array(6),t.__lineDistanceArray=new Float32Array(1*i),t.__webglLineCount=i},createParticleBuffers:function(e){null==this.particleMap[e._id]&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglNormalBuffer=i.createBuffer(),this.info.memory.geometries++},initParticleBuffers:function(e){null==this.particleMap[e._id]&&(this.particleMap[e._id]={});var t=this.particleMap[e._id],i=e.vertices.length;t.__vertexArray=new Float32Array(3*i),t.__colorArray=new Float32Array(3*i),t.__normalArray=new Float32Array(3*i),t.__sortArray=[],t.__webglParticleCount=i},createGroupBuffer:function(e,t){var i=this._gl;t.__webglVertexBuffer=i.createBuffer(),t.__webglNormalBuffer=i.createBuffer(),t.__webglColorBuffer=i.createBuffer(),t.__webglColor2Buffer=i.createBuffer(),t.__webglUVBuffer=i.createBuffer(),t.__webglUV2Buffer=i.createBuffer(),t.__webglFaceBuffer=i.createBuffer(),t.__webglLineBuffer=i.createBuffer(),this.info.memory.geometries++},setRenderTarget:function(e){var i=e instanceof Ne,r=this._gl;if(e&&!e.__webglFramebuffer){e.depthBuffer===t&&(e.depthBuffer=!0),e.stencilBuffer===t&&(e.stencilBuffer=!0),e.__webglTexture=r.createTexture(),this.info.memory.textures++;var a=Ee.isPowerOfTwo,n=a(e.width)&&a(e.height),o=Ee.paramToGL(e.format,r),s=Ee.paramToGL(e.type,r);e.type,se.FloatType;var l=o;if(i){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],r.bindTexture(r.TEXTURE_CUBE_MAP,e.__webglTexture),this.pm.setTextureParameters(r.TEXTURE_CUBE_MAP,e,n);for(var h=0;h<6;h++)e.__webglFramebuffer[h]=r.createFramebuffer(),e.__webglRenderbuffer[h]=r.createRenderbuffer(),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,l,e.width,e.height,0,o,s,null),this.setupFrameBuffer(e.__webglFramebuffer[h],e,r.TEXTURE_CUBE_MAP_POSITIVE_X+h),this.setupRenderBuffer(e.__webglRenderbuffer[h],e);n&&r.generateMipmap(r.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=r.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=r.createRenderbuffer(),r.bindTexture(r.TEXTURE_2D,e.__webglTexture),this.pm.setTextureParameters(r.TEXTURE_2D,e,n),r.texImage2D(r.TEXTURE_2D,0,l,e.width,e.height,0,o,s,null),this.setupFrameBuffer(e.__webglFramebuffer,e,r.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e.__webglRenderbuffer):this.setupRenderBuffer(e.__webglRenderbuffer,e),n&&r.generateMipmap(r.TEXTURE_2D);i?r.bindTexture(r.TEXTURE_CUBE_MAP,null):r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null)}var c,u,f,p,d;e?(c=i?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,u=e.width,f=e.height,p=0,d=0):(c=null,u=this._viewportWidth,f=this._viewportHeight,p=this._viewportX,d=this._viewportY),c!==this._currentFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,c),r.viewport(p,d,u,f),this._currentFramebuffer=c),this._currentWidth=u,this._currentHeight=f},setupFrameBuffer:function(e,t,i){var r=this._gl;r.bindFramebuffer(r.FRAMEBUFFER,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,i,t.__webglTexture,0)},setupRenderBuffer:function(e,t){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e)):i.renderbufferStorage(i.RENDERBUFFER,i.RGBA4,t.width,t.height)},setLineWidth:function(e){if(e!==this._oldLineWidth){try{this._gl.lineWidth&&this._gl.lineWidth(e)}catch(e){}this._oldLineWidth=e}},setupMatrices:function(e,t){e.fixSize(t),e.updateWorldMatrix(),e._modelViewMatrix.multiplyMatrices(t.worldMatrixInverse,e.worldMatrix),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)},setDefaultGLState:function(){var e=this._gl,t=new se.Color(this._clearColor);e.clearColor(t.r,t.g,t.b,this._clearAlpha),e.clearDepth(1),pe.isIE||e.clearStencil(0),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.CULL_FACE),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},clear:function(e,i,r){var a=this._gl,n=0;(e===t||e)&&(n|=a.COLOR_BUFFER_BIT),(i===t||i)&&(n|=a.DEPTH_BUFFER_BIT),(r===t||r)&&(n|=a.STENCIL_BUFFER_BIT),a.clear(n)},setGLFaces:function(e){var t=this._gl,i=e.side===se.DoubleSide,r=e.side===se.BackSide;this._oldDoubleSided!==i&&(i?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),this._oldDoubleSided=i),this._oldFlipSided!==r&&(r?t.frontFace(t.CW):t.frontFace(t.CCW),this._oldFlipSided=r)},getView:function(){return this._canvas},getRootView:function(){return this._rootView},setBlending:function(e,t,i,r){Le.setBlending(e,t,i,r,this)},setDepthTest:function(e){Le.setDepthTest(e,this)},setStencilTest:function(e){this._oldStencilTest!=e&&(e?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),this._oldStencilTest=e)},setDepthWrite:function(e){Le.setDepthWrite(e,this)},getLineWidthRange:function(){var e=this._gl;return e.getParameter(e.ALIASED_LINE_WIDTH_RANGE)},setTexture:function(e,t){this.pm.setTexture(e,t)},disableAttributes:function(){for(var e in this._enabledAttributes)this._enabledAttributes[e]&&(this._gl.disableVertexAttribArray(e),this._enabledAttributes[e]=!1)},enableAttribute:function(e){this._enabledAttributes[e]||(this._gl.enableVertexAttribArray(e),this._enabledAttributes[e]=!0)},adjustRootViewBounds:function(e,t){var i=this._rootView;i.style.width=e+"px",i.style.height=t+"px"},adjustCanvasBounds:function(e,t,i,r,a){e.width=t*this.devicePixelRatio,e.height=i*this.devicePixelRatio,e.style.margin="0px",e.style.padding="0px",e.style.width=t+"px",e.style.height=i+"px"},adjustBounds:function(e,t,i,r){var a=this.getView();if(this.adjustRootViewBounds(e,t,i,r),this.adjustCanvasBounds(a,e,t,i,r),this.adjustCanvasBounds(this._topCanvas,e,t,i,r),this.adjustCanvasBounds(this._bottomCanvas,e,t,i,r),this.adjustCallback(e,t,i,r),this.setViewport(0,0,a.width,a.height),this.autoUpdateCameraAspect&&0!==t){var n=this._camera;n.aspect=e/t,n.updateProjectionMatrix(),this._currentCamera=null}this.dirtyNetwork()},adjustCallback:function(){},setViewport:function(e,i,r,a){var n=this.getView();this._viewportX=e!==t?e:0,this._viewportY=i!==t?i:0,this._viewportWidth=r!==t?r:n.width,this._viewportHeight=a!==t?a:n.height,this._gl.viewport(this._viewportX,this._viewportY,this._viewportWidth,this._viewportHeight)},setShowAxis:function(e){this.showAxis!==e&&(this.showAxis=e,this.showAxis&&(this.helperBox.contains(this.axis)||this.helperBox.addByDescendant(this.axis)),this.axis._visible=e,this.dirtyNetwork())},setShowAxisText:function(e){this.axis.showAxisText(e),this.dirtyNetwork()},setAxisSize:function(e){this.axis.setSize(e)},onSelect:function(e){null!=this.onSelectFunction&&this.onSelectFunction(e)},setOnSelectFunction:function(e){this.onSelectFunction=e},isSelectable:function(e){return!!e.isSelectable()&&(!this.selectableFunction||this.selectableFunction(e))},setSelectableFunction:function(e){this.selectableFunction=e},setRenderSelectFunction:function(e){this.renderSelectFunction=e},renderSelect:function(e){return!this.renderSelectFunction||this.renderSelectFunction(e)},renderAlarmBorder:function(e){return!this.renderAlarmBorderFunction||this.renderAlarmBorderFunction(e)},selectable:function(e){return this.isVisible(e.element)&&this.isSelectable(e.element)&&this.getDataBox().getSelectionModel().isSelectable(e.element)},editable:function(e){var t=this.selectable(e);return t&&null!=this.editableFunction?this.editableFunction(e.element):t},getFirstSelectElement:function(e){if(null==e)return null;for(var t,i=0;i<e.length;){var r=e[i];if(this.selectable(r)){t=r.element;break}i++}return t},getFirstEditElement:function(e){if(null==e)return null;for(var t,i=0;i<e.length;){var r=e[i];if(this.editable(r)){t=r.element;break}i++}return t},toImageData:function(e,t,i,r){return this.dirtyNetwork(),this.render(),(e=e||"PNG").toUpperCase(),"PNG"===e?de.saveAsPNG(this.getView(),t,!1,i,r):"JPEG"===e?de.saveAsJPEG(this.getView(),t,!1,i,r):"BMP"===e?de.saveAsBMP(this.getView(),t,!1,i,r):void console.log("Not surport type "+e)},getPickingByEvent:function(e){var t=this._camera,i={},r=this.getView().getBoundingClientRect(),a=e.clientX,n=e.clientY;e.touches&&e.touches.length&&(a=e.touches[0].pageX,n=e.touches[0].pageY);var o=(a-r.left)/r.width,s=(n-r.top)/r.height;i.x=2*o-1,i.y=2*-s+1;var l=new se.Vec3(i.x,i.y,.5);this.projector.unprojectVector(l,t);var h=null;if(t instanceof se.PerspectiveCamera)h=new se.Picking(t._position,l.sub(t._position).normalize(),t.up,null,null,this);else{var c=l.clone().sub(t._position),u=t.getTarget().clone().sub(t.p()).normalize(),f=u.multiplyScalar(c.clone().dot(u)),p=c.sub(f),d=(new he).addVectors(t._position,p);h=new se.Picking(d,l.sub(d).normalize(),t.up,null,null,this)}return h},getElementsByMouseEvent:function(e,t,i){var r=this.getPickingByEvent(e),a=new _e;return a.addAll(this.dataBox.getNodes()),a.addAll(this.dataBox.getBillboards()),i&&a.addAll(new _e(this.alarmBillboards)),r.intersectObjects(a.toArray(),!1,t)},getElementByScreenPoint:function(e,t,i){var r={},a=this.getView(),n=this._camera,o=a.getBoundingClientRect();e.x&&(i=t,t=e.y,e=e.x),e/=o.width,t/=o.height,r.x=2*e-1,r.y=2*-t+1;var s=new se.Vec3(r.x,r.y,.5);this.projector.unprojectVector(s,n);var l=new se.Picking(n._position,s.sub(n._position).normalize(),n.up,null,null,this),h=new _e;return h.addAll(this.dataBox.getNodes()),h.addAll(this.dataBox.getBillboards()),l.intersectObjects(h.toArray(),!1,i)},getFirstElementByMouseEvent:function(e,t,i,r){var a=this.getElementsByMouseEvent(e,t,r);if(a.length)for(var n=0;n<a.length;n++){var o=a[n],s=o.element;if(null==i||i.call(null,s))return o}return null},getUnProjectVector:function(e){var t={},i=this.getView().getBoundingClientRect(),r=e.x/i.width,a=e.y/i.height;t.x=2*r-1,t.y=2*-a+1;var n=new se.Vec3(t.x,t.y,.5);return this.projector.unprojectVector(n,this._camera),n},getFrustumByBounding:function(e){var t=e,i=this.getUnProjectVector(new le(t.x,t.y)),r=this.getUnProjectVector(new le(t.x+t.w,t.y)),a=this.getUnProjectVector(new le(t.x,t.y+t.h)),n=this.getUnProjectVector(new le(t.x+t.w,t.y+t.h)),o=this.getNearFarPoints(i),s=this.getNearFarPoints(r),l=this.getNearFarPoints(a),h=this.getNearFarPoints(n),c=new se.math.Plane,u=new se.math.Plane,f=new se.math.Plane,p=new se.math.Plane,d=new se.math.Plane,m=new se.math.Plane;c.setFromCoplanarPoints(o[0],s[0],l[0]),u.setFromCoplanarPoints(o[0],o[1],s[0]),f.setFromCoplanarPoints(o[0],l[0],o[1]),p.setFromCoplanarPoints(s[0],s[1],h[0]),d.setFromCoplanarPoints(l[0],h[0],l[1]),m.setFromCoplanarPoints(o[1],l[1],s[1]);var g=new se.Frustum(c,u,f,p,d,m);return g.setPoints([o[0],s[0],l[0],h[0],o[1],s[1],l[1],h[1]]),g},getNearFarPoints:function(e){var t=this._camera,i=e.sub(t._position).normalize(),r=t.target.clone().sub(t._position),a=i.angleTo(r),n=t.getNear()/Math.acos(a),o=t.getFar()/Math.acos(a);return[t._position.clone().add(i.clone().multiplyScalar(n)),t._position.clone().add(i.clone().multiplyScalar(o))]},getSpacePointOnPlane:function(e,t){var i={},r=this.getView(),a=this._camera,n=r.getBoundingClientRect(),o=e.clientX,s=e.clientY;e.touches&&e.touches.length&&(o=e.touches[0].pageX,s=e.touches[0].pageY);var l=(o-n.left)/n.width,h=(s-n.top)/n.height;i.x=2*l-1,i.y=2*-h+1;var c=new se.Vec3(i.x,i.y,.5);this.projector.unprojectVector(c,a);var u=a._position;if(a instanceof mono.OrthoCamera){var f=new se.Vec3(0,0,.5);this.projector.unprojectVector(f,a),u=u.clone().sub(f.sub(c))}var p=c.sub(u).normalize(),d=new se.Ray(u,p),m=d.distanceToPlane(t);return m<0||Math.abs(m)<se.Picking.prototype.precision?null:d.at(m)},getElementsByBounding:function(e,t,i){var r=new _e;r.addAll(this.dataBox.getNodes()),r.addAll(this.dataBox.getBillboards());var a,n=this.getFrustumByBounding(e),o=[],s=new he,l=this._camera;return r.forEach(function(e){if(e instanceof se.Billboard){s.setFromMatrixPosition(e.worldMatrix);var t=e.material,r=t.alignment;a=new se.Plane(1,1),(r.x||r.y)&&(a.setPosition(r.x,r.y,0),a=se.Utils.transformElement(a,!0)),a.setPosition(s);var h=(new he).getScaleFromMatrix(e.worldMatrix);a.setScale(h.x,h.y,1);var c=l.getTarget().clone(),u=l.getPosition();c.sub(u);var f=a.getPosition().clone();t&&t.vertical&&(c.y=0),f.sub(c),a.lookAt(f),a.updateWorldMatrix(!0),n.intersectsObjectAccurate(a,i)&&o.push({element:e})}else se.Line,n.intersectsObjectAccurate(e,i)&&o.push({element:e})}),o},getViewPosition:function(e){var t=new he;return(t=this.projector.projectVector(e,this._camera,t)).x=t.x/2+.5,t.y=-t.y/2+.5,{x:this._canvas.width*t.x/this.devicePixelRatio,y:this._canvas.height*t.y/this.devicePixelRatio,h:this._canvas.height}},setInteractions:function(e){var t,i=this._interactions;if(i)for(t=0;t<i.length;t++)i[t].tearDown();if(this._interactions=e,e)for(t=0;t<e.length;t++)e[t].setUp()},getDefaultInteraction:function(){if(this._interactions&&this._interactions.length>0)for(var e=0;e<this._interactions.length;e++){var t=this._interactions[e];if(t instanceof se.DefaultInteraction)return t}return null},getInteractions:function(){return this._interactions},fireInteractionEvent:function(e){this._interactionDispatcher.fire(e)},addInteractionListener:function(e,t,i){this._interactionDispatcher.add(e,t,i)},removeInteractionListener:function(e,t){this._interactionDispatcher.remove(e,t)},dispose:function(){this._animateId&&((this._vrDisplay&&this._vrDisplay.isPresenting?this._vrDisplay:e).cancelAnimationFrame(this._animateId),this._animateId=null),this.setInteractions(null),this.pm.dispose(),this._resizeFunction&&e.removeEventListener("resize",this._resizeFunction)},setRenderInterval:function(e){(Ee.isNaN(e)||e<=5)&&(e=5),this._renderInterval=e},_computeNetworkBoundingBox:function(){function e(e,t){e.applyMatrix4(t),s.push(e)}var t,i,r,a,n=this.getDataBox().size(),o=this.getDataBox().getDatas(),s=[];for(t=0;t<n;t++)if((i=o.get(t))instanceof se.Node){r=i.getBoundingBox(),a=i.worldMatrix;var l=r.min,h=r.max;e(l.clone(),a),e(h.clone(),a),e(new he(l.x,l.y,h.z),a),e(new he(l.x,h.y,l.z),a),e(new he(h.x,l.y,l.z),a),e(new he(h.x,h.y,l.z),a),e(new he(h.x,l.y,h.z),a),e(new he(l.x,h.y,h.z),a)}if(s.length<=1)return null;var c=new se.BoundingBox;return c.setFromPoints(s),c},getNetworkBoundingBox:function(){return null==this.boundingBox&&(this.boundingBox=this._computeNetworkBoundingBox()),this.boundingBox},getSelectStyle:function(e){return e.getSelectStyle()},setZoomStandard:function(e){this._zoomStandard=e},getZoomStandard:function(){return this._zoomStandard},zoom:function(e,t){t=t||this._zoomStandard,this._camera.zoom(e,t)},zoomIn:function(e){this.zoom(.9,e)},zoomOut:function(e){this.zoom(1.1,e)},move:function(e,t){new mono.Vec3(-e,-t,0);var i=this._camera.t(),r=this._camera.p();this._camera.translateX(-e),this._camera.translateY(-t);var a=this._camera.p();i.add(a.clone().sub(r)),this._camera.lookAt(i)},moveLeft:function(e){e=e||50,this.move(-e,0)},moveRight:function(e){e=e||50,this.move(e,0)},moveUp:function(e){e=e||30,this.move(0,e)},moveDown:function(e){e=e||30,this.move(0,-e)},zoomEstimateOverview:function(e){var t=this.getNetworkBoundingBox();if(null!=t){var i=t.center(),r=new he(0,t.max.y-t.min.y,t.max.z-t.min.z),a=new he(t.max.x-t.min.x,0,0,0),n=r.clone();n.length()<a.length()&&(n=a.clone());var o;if(e){var s=r.length();r.y=r.z*Math.tan(e/180*Math.PI),r.setLength(s)}o=(new he).addVectors(i,r.multiplyScalar(.5));var l=this._camera.fov,h=(this._camera.aspect,n.length()/2/Math.tan(l*Math.PI/180));o.add(r.normalize().multiplyScalar(h)),this._camera.setPosition(o),this._camera.lookAt(i),this._overviewDistance=this._camera.getDistance()}},_onVRRequestPresent:function(){var e=this,t=e._canvas,i=e._vrDisplay;if(i){e._oldCamera=e._camera;var r=new mono.VRCamera(e,e._oldCamera.near,e._oldCamera.far);r.setPosition(e._camera.getPosition()),e.setCamera(r),i.requestPresent([{source:t}]).then(function(){e._isPresenting=!0,e.onEnterVR()},function(e){console.log("requestPresent failed.",e)})}},onEnterVR:function(){},_onVRExitPresent:function(){var e=this,t=e._vrDisplay;t&&t.isPresenting&&t.exitPresent().then(function(){e.setCamera(e._oldCamera),e._oldCamera=null,e._isPresenting=!1},function(){console.log("exitPresent failed.")})},enterVR:function(){this._onVRRequestPresent()},_initVR:function(){var t,i=this,r=i._canvas;i._vrDisplay||navigator.getVRDisplays&&navigator.getVRDisplays().then(function(a){a&&a.length&&((t=i._vrDisplay=a[0]).depthNear=i._camera.near,t.depthFar=i._camera.far,i.onVRRequestPresent||(i.onVRRequestPresent=function(e){i._onVRRequestPresent()}),i.onVRExitPresent||(i.onVRExitPresent=function(e){i._onVRExitPresent()}),i.onVRPresentChange||(i.onVRPresentChange=function(e){if(t.isPresenting){var a=t.getEyeParameters("left"),n=t.getEyeParameters("right");r.width=2*Math.max(a.renderWidth,n.renderWidth),r.height=Math.max(a.renderHeight,n.renderHeight)}else i.adjustBounds(i._rootView.clientWidth,i._rootView.clientHeight)}),e.addEventListener("vrdisplaypresentchange",i.onVRPresentChange,!1),e.addEventListener("vrdisplayactivate",i.onVRRequestPresent,!1),e.addEventListener("vrdisplaydeactivate",i.onVRExitPresent,!1))})},exitVR:function(){this._onVRExitPresent()},s:function(e){this.setStyle(e)},setStyle:function(e){var t=this;if(e){if(e.parentDom&&e.parentDom.appendChild(t.getRootView()),e.width&&e.height&&t.adjustBounds(e.width,e.height),e.autoAdjustBounds&&mono.Utils.autoAdjustNetworkBounds(t,document.documentElement,"clientWidth","clientHeight"),e.camera){var i=t.getCamera(),r=e.camera;null!=r.near&&i.setNear(r.near),null!=r.far&&i.setFar(r.far),null!=r.fov&&i.setFov&&i.setFov(r.fov),null!=r.width&&i.setWidth&&i.setWidth(r.width),null!=r.position&&i.setPosition(r.position),null!=r.target&&i.lookAt(r.target)}if(e.lights){var a=t.getDataBox();e.lights.forEach(function(e){var t;"directional"===e.type&&(t=new mono.DirectionalLight(e.color,e.intensity),e.direction&&t.setDirection(e.direction)),"point"===e.type&&(t=new mono.PointLight(e.color,e.intensity,e.distance),e.position&&t.setPosition(e.position)),"ambient"===e.type&&(t=new mono.AmbientLight(e.color)),"spot"===e.type&&(t=new mono.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent)),t&&a.add(t)})}if(e.interactions){var n,o,s,l;t.getInteractions().forEach(function(e){e instanceof mono.DefaultInteraction&&(n=e),e instanceof mono.EditInteraction&&(o=e),e instanceof mono.SelectionInteraction&&(s=e)}),e.interactions.forEach(function(e){"default"===e.type&&(n||(n=new mono.DefaultInteraction(t)),l=n),"edit"===e.type&&(o||(o=new mono.EditInteraction(t)),l=o),"selection"===e.type&&(s||(s=new mono.SelectionInteraction(t)),l=s),Object.keys(e).forEach(function(t){"type"!==t&&(l[t]=e[t])})});var h=[];n&&h.push(n),o&&h.push(o),s&&h.push(s),t.setInteractions(h)}}}}),se.Network3DId=0,se.Network3D.GroupCache={_groupCounter:0};se.Projector=function(){function e(){if(c===w){var e=new $RenderObject;return _.push(e),w++,c++,e}return _[c++]}function i(){if(f===M){var e=new $RenderVertex;return b.push(e),M++,f++,e}return b[f++]}function r(){if(d===P){var e=new se.RenderFace3;return S.push(e),P++,d++,e}return S[d++]}function a(){if(m===T){var e=new se.RenderFace4;return C.push(e),T++,m++,e}return C[m++]}function n(){if(y===z){var e=new se.RenderLine;return E.push(e),z++,y++,e}return E[y++]}function o(){if(x===L){var e=new se.RenderableParticle;return D.push(e),L++,x++,e}return D[x++]}function s(e,t){return t.z-e.z}function l(e,t){var i=0,r=1,a=e.z+e.w,n=t.z+t.w,o=-e.z+e.w,s=-t.z+t.w;return a>=0&&n>=0&&o>=0&&s>=0||!(a<0&&n<0||o<0&&s<0)&&(a<0?i=Math.max(i,a/(a-n)):n<0&&(r=Math.min(r,a/(a-n))),o<0?i=Math.max(i,o/(o-s)):s<0&&(r=Math.min(r,o/(o-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}var h,c,u,f,p,d,m,g,y,v,x,A,_=[],w=0,b=[],M=0,S=[],P=0,C=[],T=0,E=[],z=0,D=[],L=0,R={objects:[],sprites:[],lights:[],elements:[]},N=new se.Vec3,B=new se.Vec4,I=new se.BoundingBox(new se.Vec3(-1,-1,-1),new se.Vec3(1,1,1)),F=new se.BoundingBox,V=new Array(3),U=new Array(4),k=new se.Mat4,O=new se.Mat4,X=new se.Mat4,G=new se.Mat3,Y=new se.Mat3,W=new se.Vec3,j=new se.Frustum,H=new se.Vec4,q=new se.Vec4;this.projectVector=function(e,i,r){return i.worldMatrixInverse.getInverse(i.worldMatrix),O.multiplyMatrices(i.projectionMatrix,i.worldMatrixInverse),r===t?e.applyProjection(O):(r.copy(e),r.applyProjection(O))},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),O.multiplyMatrices(t.worldMatrix,t.projectionMatrixInverse),e.applyProjection(O)},this.pickingRay=function(e,t){e.z=-1;var i=new se.Vec3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new se.Picking(e,i)};var Z=function(t,i){c=0,R.objects.length=0,R.sprites.length=0,R.lights.length=0;var r=function(t){for(var i,a=0,n=(i=(i=t instanceof se.DataBox?t.getRoots():t.getChildren()).toList()).size();a<n;a++)(o=i.get(a)).isSelected()&&o instanceof se.Node&&(i.add(o.createCanvasSelectionCube(),a),a++);for(var a=0,n=i.size();a<n;a++){var o=i.get(a);!1!==o._visible&&(o instanceof se.Light?R.lights.push(o):o instanceof se.Entity||o instanceof se.Line?!1!==o.frustumCulled&&!0!==j.intersectsObject(o)||((h=e()).object=o,null!==o.renderDepth?h.z=o.renderDepth:(N.copy(o.worldMatrix.getPosition()),N.applyProjection(O),h.z=N.z),R.objects.push(h)):o instanceof se.Billboard||o instanceof se.Particle?((h=e()).object=o,null!==o.renderDepth?h.z=o.renderDepth:(N.copy(o.worldMatrix.getPosition()),N.applyProjection(O),h.z=N.z),R.sprites.push(h)):((h=e()).object=o,null!==o.renderDepth?h.z=o.renderDepth:(N.copy(o.worldMatrix.getPosition()),N.applyProjection(O),h.z=N.z),R.objects.push(h)),r(o))}};return r(t),!0===i&&R.objects.sort(s),R};this.projectDataBox=function(e,h,c,_){var w,M,S,P,C,T,E,z,D,L,N,Q,K,J,$,ee,te,ie,re,ae,ne,oe,le,he=!1;d=0,m=0,y=0,x=0,R.elements.length=0;for(var ce=0;ce<e.getRoots().size();ce++)e.getRoots().get(ce).updateWorldMatrix();for(h.parent===t&&h.updateWorldMatrix(!0,!1),k.copy(h.worldMatrixInverse.getInverse(h.worldMatrix)),O.multiplyMatrices(h.projectionMatrix,k),Y.getInverse(k),Y.transpose(),j.setFromMatrix(O),w=0,M=(R=Z(e,c)).objects.length;w<M;w++)if(N=R.objects[w].object,A=N.worldMatrix,f=0,N instanceof se.Entity){for(K=(Q=N).vertices,J=Q.faces,te=Q.uvs,G.getInverse(A),G.transpose(),le=!0===(oe=N.material instanceof se.ArrayMaterial)?N.material:null,S=0,P=K.length;S<P;S++)(u=i()).positionWorld.copy(K[S]).applyMatrix4(A),u.positionScreen.copy(u.positionWorld).applyMatrix4(O),u.positionScreen.x/=u.positionScreen.w,u.positionScreen.y/=u.positionScreen.w,u.positionScreen.z/=u.positionScreen.w,u.visible=!(u.positionScreen.x<-1||u.positionScreen.x>1||u.positionScreen.y<-1||u.positionScreen.y>1||u.positionScreen.z<-1||u.positionScreen.z>1);for(C=0,T=J.length;C<T;C++){$=J[C];var ue=!0===oe?le.materials[$.materialIndex]:N.material;if(ue!==t){var fe=ue.side;if($ instanceof se.Face3){if(ie=b[$.a],re=b[$.b],ae=b[$.c],V[0]=ie.positionScreen,V[1]=re.positionScreen,V[2]=ae.positionScreen,!0!==ie.visible&&!0!==re.visible&&!0!==ae.visible&&!I.isIntersectionBox(F.setFromPoints(V)))continue;if(he=(ae.positionScreen.x-ie.positionScreen.x)*(re.positionScreen.y-ie.positionScreen.y)-(ae.positionScreen.y-ie.positionScreen.y)*(re.positionScreen.x-ie.positionScreen.x)<0,fe!==se.DoubleSide&&he!==(fe===se.FrontSide))continue;(p=r()).v1.copy(ie),p.v2.copy(re),p.v3.copy(ae)}else if($ instanceof se.Face4){if(ie=b[$.a],re=b[$.b],ae=b[$.c],ne=b[$.d],U[0]=ie.positionScreen,U[1]=re.positionScreen,U[2]=ae.positionScreen,U[3]=ne.positionScreen,!0!==ie.visible&&!0!==re.visible&&!0!==ae.visible&&!0!==ne.visible&&!I.isIntersectionBox(F.setFromPoints(U)))continue;if(he=(ne.positionScreen.x-ie.positionScreen.x)*(re.positionScreen.y-ie.positionScreen.y)-(ne.positionScreen.y-ie.positionScreen.y)*(re.positionScreen.x-ie.positionScreen.x)<0||(re.positionScreen.x-ae.positionScreen.x)*(ne.positionScreen.y-ae.positionScreen.y)-(re.positionScreen.y-ae.positionScreen.y)*(ne.positionScreen.x-ae.positionScreen.x)<0,fe!==se.DoubleSide&&he!==(fe===se.FrontSide))continue;(p=a()).v1.copy(ie),p.v2.copy(re),p.v3.copy(ae),p.v4.copy(ne)}for(p.normalModel.copy($.normal),!1!==he||fe!==se.BackSide&&fe!==se.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(G).normalize(),p.normalModelView.copy(p.normalModel).applyMatrix3(Y),p.centroidModel.copy($.centroid).applyMatrix4(A),E=0,z=(ee=$.vertexNormals).length;E<z;E++){var pe=p.vertexNormalsModel[E];pe.copy(ee[E]),!1!==he||fe!==se.BackSide&&fe!==se.DoubleSide||pe.negate(),pe.applyMatrix3(G).normalize(),p.vertexNormalsModelView[E].copy(pe).applyMatrix3(Y)}p.vertexNormalsLength=ee.length;var de=te[C];for(D=0,L=de.length;D<L;D++)p.uvs[0][D]=de[D];p.color=$.color,p.material=ue,W.copy(p.centroidModel).applyProjection(O),p.z=W.z,R.elements.push(p)}}}else if(N instanceof se.Line){X.multiplyMatrices(O,A),K=N.vertices,(ie=i()).positionScreen.copy(K[0]).applyMatrix4(X);var me=N.type===se.LinePieces?2:1;for(S=1,P=K.length;S<P;S++)(ie=i()).positionScreen.copy(K[S]).applyMatrix4(X),(S+1)%me>0||(re=b[f-2],H.copy(ie.positionScreen),q.copy(re.positionScreen),!0===l(H,q)&&(H.multiplyScalar(1/H.w),q.multiplyScalar(1/q.w),(g=n()).v1.positionScreen.copy(H),g.v2.positionScreen.copy(q),g.z=Math.max(H.z,q.z),g.material=N.material,R.elements.push(g)))}for(w=0,M=R.sprites.length;w<M;w++)N=R.sprites[w].object,A=N.worldMatrix,N instanceof se.Particle&&(B.set(A.elements[12],A.elements[13],A.elements[14],1),B.applyMatrix4(O),B.z/=B.w,B.z>0&&B.z<1&&((v=o()).object=N,v.x=B.x/B.w,v.y=B.y/B.w,v.z=B.z,v.rotation=N.rotation.z,v.scale.x=N.scale.x*Math.abs(v.x-(B.x+h.projectionMatrix.elements[0])/(B.w+h.projectionMatrix.elements[12])),v.scale.y=N.scale.y*Math.abs(v.y-(B.y+h.projectionMatrix.elements[5])/(B.w+h.projectionMatrix.elements[13])),v.material=N.material,R.elements.push(v)));return!0===_&&R.elements.sort(s),R}},se.Billboard=function(e){null!=e&&null!=e.id?this._id=e.id:this._id=e,se.Element.call(this,this._id),this.material=new se.BillboardMaterial,this.rotation3d=this._rotation,this.rotation=0,this.vertices=[new he(-.5,-.5,0),new he(.5,-.5,0),new he(.5,.5,0),new he(-.5,.5,0)]},se.extend(se.Billboard,se.Element,{constructor:se.Billboard,className:"TGL.Billboard",updateMatrix:function(){this.matrix.setPosition(this._position),this.rotation=this._rotation.z,this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this._scale.x&&1===this._scale.y||this.matrix.scale(this._scale),this.matrixWorldNeedsUpdate=!0},invalidateTexture:function(){var e=this.material;e instanceof se.BillboardMaterial&&this._dirtyMaterialTexture(e)},clone:function(e){return e===t&&(e=new se.Billboard(this.material)),se.Element.prototype.clone.call(this,e),e},setMaterialStyle:function(e,t){var i=this.material.clone();e=e.substr(e.indexOf(".")+1),this._A97(i,e,t);var r=i.getUniqueCode(),a=at.getMaterial(r);null!=a?(at.unUseMaterial(this.material),this.material=a,at.useMaterial(a)):(at.unUseMaterial(this.material),at.setMaterial(r,i),this.material=i)}}),se.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","uniform bool vertical;","uniform float fixedSize;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","vUV = uvOffset + uv * uvScale;","vec2 finalScale;","if(fixedSize != 0.0){","   finalScale = scale  * length(finalPosition.xyz) / fixedSize;","}else{","   finalScale = scale;","}","vec2 alignedPosition = (position + alignment) * finalScale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 upPosition;","vec4 rightPosition = vec4(finalScale.x,0.0,0.0,1.0);","if(vertical){","upPosition =  modelViewMatrix * vec4( 0.0, 1.0, 0.0, 1.0 ) - finalPosition;","normalize(upPosition);","}","if(vertical){","finalPosition.xyz += (rotatedPosition.x * rightPosition.xyz / finalScale.x) + (rotatedPosition.y * upPosition.xyz / scale.y);","}else{","finalPosition.xy += rotatedPosition;","}","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform int useMap;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","if(useMap > 0){","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","} else {","gl_FragColor = vec4( color, 1.0);","}","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},se.BillboardRenderer=function(){function e(e,i){var r=t.createProgram(),a=t.createShader(t.FRAGMENT_SHADER),n=t.createShader(t.VERTEX_SHADER),o="precision "+i+" float;\n";return t.shaderSource(a,o+e.fragmentShader),t.shaderSource(n,o+e.vertexShader),t.compileShader(a),t.compileShader(n),t.attachShader(r,a),t.attachShader(r,n),t.linkProgram(r),r}var t,i,r,a={},n=(new se.Billboard,new se.BillboardMaterial({color:255}));this.init=function(n){this.enable=!0,n._currentGroupHash=null,t=n._gl,i=n,r=n.getPrecision(),a.vertices=new Float32Array(16),a.faces=new Uint16Array(6),a.lines=new Uint16Array(8);var o=0;a.vertices[o++]=-.5,a.vertices[o++]=-.5,a.vertices[o++]=0,a.vertices[o++]=0,a.vertices[o++]=.5,a.vertices[o++]=-.5,a.vertices[o++]=1,a.vertices[o++]=0,a.vertices[o++]=.5,a.vertices[o++]=.5,a.vertices[o++]=1,a.vertices[o++]=1,a.vertices[o++]=-.5,a.vertices[o++]=.5,a.vertices[o++]=0,a.vertices[o++]=1,o=0,a.faces[o++]=0,a.faces[o++]=1,a.faces[o++]=2,a.faces[o++]=0,a.faces[o++]=2,a.faces[o++]=3,o=0,a.lines[o++]=0,a.lines[o++]=1,a.lines[o++]=0,a.lines[o++]=3,a.lines[o++]=1,a.lines[o++]=2,a.lines[o++]=2,a.lines[o++]=3,a.vertexBuffer=t.createBuffer(),a.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,a.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,a.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.faces,t.STATIC_DRAW),a.program=e(se.ShaderSprite.sprite,r),a.attributes={},a.uniforms={},a.attributes.position=t.getAttribLocation(a.program,"position"),a.attributes.uv=t.getAttribLocation(a.program,"uv"),a.uniforms.uvOffset=t.getUniformLocation(a.program,"uvOffset"),a.uniforms.uvScale=t.getUniformLocation(a.program,"uvScale"),a.uniforms.rotation=t.getUniformLocation(a.program,"rotation"),a.uniforms.scale=t.getUniformLocation(a.program,"scale"),a.uniforms.alignment=t.getUniformLocation(a.program,"alignment"),a.uniforms.color=t.getUniformLocation(a.program,"color"),a.uniforms.useMap=t.getUniformLocation(a.program,"useMap"),a.uniforms.map=t.getUniformLocation(a.program,"map"),a.uniforms.opacity=t.getUniformLocation(a.program,"opacity"),a.uniforms.vertical=t.getUniformLocation(a.program,"vertical"),a.uniforms.fixedSize=t.getUniformLocation(a.program,"fixedSize"),a.uniforms.useScreenCoordinates=t.getUniformLocation(a.program,"useScreenCoordinates"),a.uniforms.sizeAttenuation=t.getUniformLocation(a.program,"sizeAttenuation"),a.uniforms.screenPosition=t.getUniformLocation(a.program,"screenPosition"),a.uniforms.modelViewMatrix=t.getUniformLocation(a.program,"modelViewMatrix"),a.uniforms.projectionMatrix=t.getUniformLocation(a.program,"projectionMatrix"),a.uniforms.fogType=t.getUniformLocation(a.program,"fogType"),a.uniforms.fogDensity=t.getUniformLocation(a.program,"fogDensity"),a.uniforms.fogNear=t.getUniformLocation(a.program,"fogNear"),a.uniforms.fogFar=t.getUniformLocation(a.program,"fogFar"),a.uniforms.fogColor=t.getUniformLocation(a.program,"fogColor"),a.uniforms.alphaTest=t.getUniformLocation(a.program,"alphaTest"),this.inited=!0},this.render=function(e,r,o,s,l,h){this.inited||this.init(e);var c=new _e(r),u=c.size();if(u){var f=a.attributes,p=a.uniforms,d=!1;e.pm.currentProgram!=a.program&&(t.useProgram(a.program),e.pm.currentProgram=a.program,e._currentGroupHash=null,t.enableVertexAttribArray(f.position),t.enableVertexAttribArray(f.uv),t.disable(t.CULL_FACE),t.bindBuffer(t.ARRAY_BUFFER,a.vertexBuffer),t.vertexAttribPointer(f.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(f.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),this.enable=!0,d=!0),t.uniformMatrix4fv(p.projectionMatrix,!1,o.projectionMatrix.elements),d&&t.activeTexture(t.TEXTURE0),d&&t.uniform1i(p.map,0);var m=0,g=0,y=e.fog;y?(t.uniform3f(p.fogColor,y.color.r,y.color.g,y.color.b),y instanceof se.Fog?(t.uniform1f(p.fogNear,y.near),t.uniform1f(p.fogFar,y.far),t.uniform1i(p.fogType,1),m=1,g=1):y instanceof se.FogExp2&&(t.uniform1f(p.fogDensity,y.density),t.uniform1i(p.fogType,2),m=2,g=2)):(m=0,g=0);var v,x,A;for(v=0;v<u;v++)x=c.get(v),A=h||x.material,i.isVisible(x)&&0!==A.opacity&&(x.updateWorldMatrix(!0,!1),A.useScreenCoordinates?x.z=-x.position.z:(x._modelViewMatrix=new se.Mat4,x._modelViewMatrix.multiplyMatrices(o.worldMatrixInverse,x.worldMatrix),x.z=-x._modelViewMatrix.elements[14]));for(v=0;v<u;v++)x=c.get(v),this.renderBillboard(x,p,e,m,g,null,h),x._selected&&(x._scale.x=1.01*x._scale.x,x._scale.y=1.01*x._scale.y,x.material.clone(n),n.map=null,n.color.set(65280),this.renderBillboard(x,p,e,m,g,n),x._scale.x=x._scale.x/1.01,x._scale.y=x._scale.y/1.01)}},this.disable=function(){if(this.enable){var e=a.attributes;a.uniforms;t.disableVertexAttribArray(e.position),t.disableVertexAttribArray(e.uv),i._oldDoubleSided||t.enable(t.CULL_FACE),i._oldBlending===se.NoBlending&&t.disable(t.BLEND),Le.setDepthWrite(!0,i),this.enable=!1,this.lastMaterialId=null,i.pm.currentProgram=null}},this.renderBillboard=function(e,r,n,o,s,l,h){var c,u,f,p=[],d=new he;if(c=l||(h||e.material),i.isVisible(e)&&0!==c.opacity){var m=!(c.id==this.lastMaterialId);m&&t.uniform1f(r.alphaTest,c.alphaTest),m&&(!0===c.useScreenCoordinates?(t.uniform1i(r.useScreenCoordinates,1),t.uniform3f(r.screenPosition,(e.position.x*i.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-e.position.y*i.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,e.position.z)))):(t.uniform1i(r.useScreenCoordinates,0),t.uniform1i(r.sizeAttenuation,c.sizeAttenuation?1:0))),!0===c.useScreenCoordinates?(p[0]=i.devicePixelRatio,p[1]=i.devicePixelRatio):(t.uniformMatrix4fv(r.modelViewMatrix,!1,e._modelViewMatrix.elements),p[0]=1,p[1]=1),o!==(f=n.fog&&c.fog?s:0)&&(t.uniform1i(r.fogType,f),o=f),u=1/(c.scaleByViewport?viewportHeight:1),d.getScaleFromMatrix(e.worldMatrix),p[0]*=u*d.x,p[1]*=u*d.y,m&&(t.uniform2f(r.uvScale,c.repeat.x,c.repeat.y),t.uniform2f(r.uvOffset,c.offset.x,c.offset.y),t.uniform2f(r.alignment,c.alignment.x,c.alignment.y),t.uniform1f(r.opacity,c.opacity),t.uniform1i(r.vertical,c.vertical),t.uniform1f(r.fixedSize,c.fixedSize),t.uniform3f(r.color,c.color.r,c.color.g,c.color.b),t.uniform1f(r.rotation,e.rotation)),t.uniform2fv(r.scale,p),m&&(i.setBlending(c.blending,c.blendEquation,c.blendSrc,c.blendDst),i.setDepthTest(c.depthTest),i.setDepthWrite(c.depthMask)),c.map&&c.map._image&&i.pm.addTexture(c.map),m=m||c.map&&i.pm.needsUpdateTexture(c.map),c.map&&c.map._image&&c.map._image.width?(m&&i.setTexture(c.map,0),m&&t.uniform1i(r.useMap,1)):m&&t.uniform1i(r.useMap,0),l?(m&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),m&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.lines,t.STATIC_DRAW),m&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),t.drawElements(t.LINES,8,t.UNSIGNED_SHORT,0)):(m&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),m&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.faces,t.STATIC_DRAW),m&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.elementBuffer),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)),this.lastMaterialId=c.id}}},se.ShaderFlare={flare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},se.FlareRenderer=function(){var e,t,i,r,a,n,o,s,l,h;this.init=function(c){this.enable=!0,s=c._gl,l=c,h=c.getPrecision();var u=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),f=new Uint16Array([0,1,2,0,2,3]);e=s.createBuffer(),t=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e),s.bufferData(s.ARRAY_BUFFER,u,s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),s.bufferData(s.ELEMENT_ARRAY_BUFFER,f,s.STATIC_DRAW),n=s.createTexture(),o=s.createTexture(),s.bindTexture(s.TEXTURE_2D,n),s.texImage2D(s.TEXTURE_2D,0,s.RGB,16,16,0,s.RGB,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.bindTexture(s.TEXTURE_2D,o),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,16,16,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),i=this.createProgram(se.ShaderFlare.flare),r={vertex:s.getAttribLocation(i,"position"),uv:s.getAttribLocation(i,"uv")},a={renderType:s.getUniformLocation(i,"renderType"),map:s.getUniformLocation(i,"map"),occlusionMap:s.getUniformLocation(i,"occlusionMap"),opacity:s.getUniformLocation(i,"opacity"),color:s.getUniformLocation(i,"color"),scale:s.getUniformLocation(i,"scale"),rotation:s.getUniformLocation(i,"rotation"),screenPosition:s.getUniformLocation(i,"screenPosition")},this.inited=!0},this.render=function(h,c,u,f,p){if(this.inited||this.init(h),l=h,0!==c.length){var d=new he,m=p/f,g=.5*f,y=.5*p,v=16/p,x=new le(v*m,v),A=new he(1,1,0),_=new le(1,1),w=new se.Box2;if(w.min.set(0,0),w.max.set(f-16,p-16),h.pm.currentProgram!=i){s.useProgram(i),h.pm.currentProgram=i,h._currentGroupHash=null,s.enableVertexAttribArray(r.vertex),s.enableVertexAttribArray(r.uv),s.uniform1i(a.occlusionMap,0),s.uniform1i(a.map,1),s.bindBuffer(s.ARRAY_BUFFER,e),s.vertexAttribPointer(r.vertex,2,s.FLOAT,!1,16,0),s.vertexAttribPointer(r.uv,2,s.FLOAT,!1,16,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),s.disable(s.CULL_FACE),this.enable=!0;for(var b=0,M=c.length;b<M;b++){v=16/p,x.set(v*m,v);var S=c[b].node;if(d.set(S.worldMatrix.elements[12],S.worldMatrix.elements[13],S.worldMatrix.elements[14]),d.applyMatrix4(u.worldMatrixInverse),d.applyMatrix4(u.projectionMatrix),A.copy(d),_.x=0+A.x*g+g-8,_.y=0+A.y*y+y-8,!0===w.containsPoint(_)){s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGB,_.x/2,_.y/2,16,16,0),s.uniform1i(a.renderType,0),s.uniform2f(a.scale,x.x,x.y),s.uniform3f(a.screenPosition,A.x,A.y,A.z),s.disable(s.BLEND),s.enable(s.DEPTH_TEST),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),s.uniform1i(a.renderType,1),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,o),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,_.x/2,_.y/2,16,16,0),s.uniform1i(a.renderType,1),s.disable(s.DEPTH_TEST),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),S.positionScreen=A,S.customUpdateCallback?S.customUpdateCallback(S):S.updateLensFlares(),s.uniform1i(a.renderType,2),s.enable(s.BLEND);for(var P=0,C=S.lensFlares.length;P<C;P++){var T=S.lensFlares[P];T.opacity>.001&&T.scale>.001&&(A.x=T.x,A.y=T.y,A.z=T.z,v=T.size*T.scale/p,x.x=v*m,x.y=v,s.uniform3f(a.screenPosition,A.x,A.y,A.z),s.uniform2f(a.scale,x.x,x.y),s.uniform1f(a.rotation,T.rotation),s.uniform1f(a.opacity,T.opacity),s.uniform3f(a.color,T.color.r,T.color.g,T.color.b),l.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,T.texture),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0))}}}s.enable(s.CULL_FACE),s.enable(s.DEPTH_TEST)}}},this.createProgram=function(e){var t=s.createProgram(),i=s.createShader(s.FRAGMENT_SHADER),r=s.createShader(s.VERTEX_SHADER),a="precision "+h+" float;\n";return s.shaderSource(i,a+e.fragmentShader),s.shaderSource(r,a+e.vertexShader),s.compileShader(i),s.compileShader(r),s.attachShader(t,i),s.attachShader(t,r),s.linkProgram(t),t},this.disable=function(){this.enable&&(s.disableVertexAttribArray(r.vertex),s.disableVertexAttribArray(r.uv),l._oldDoubleSided||s.enable(s.CULL_FACE),l._oldBlending===se.NoBlending&&s.disable(s.BLEND),Le.setDepthWrite(!0,l),this.enable=!1,this.lastMaterialId=null,l.pm.currentProgram=null)}};var Be,Ie="l=1.0\ntype=1\ngis=0\n3d=1\nstart=2017-09-20\nend=2018-01-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=4b5d3387b1c804f09e328970efc02856c399f68a223de3e3912bfb7029f835846b38cac4390349d8cd5782b8df18b2d7199672a05da9044963f6ac80b5ba0d48b89dc3223b280165723d7986f8860921d17308c661ee3e74eea66f33a977c8eb032c8bc5b551cd9c30f54ecc83fbce33f3159691c827bb2a0987556d8e6397582f4bc4801204119e8cdfb4212a980c55360f3cbaed34e6bd63823593add7dea33926b1443cf02e7236f30459bf93721c3c220132bc81b9d49e345c108763370611430e699c3dd24d995d1bfd7c0e6148cf751228c3ff48c6336d040620797bf52df2ed3ab6a54f54116887e6693d50e5d5013e4e94ef9cfd5752f715db00757709eb88fba1f17ba6b5d9580f07ec1e1f55a780db9511f2049ef476fdd3d8dac62f39cf1418b299d1f091bae8738655bbaf228d58386685dff89992ed6ed06061c0c67203d9b687ec1bfa875bf655b73e0409265deee9c213f34bf0a4a9f3b6d2c07b6f317ff6ac1eb623e079d9f248accf031861b1149876dcdd27ebc754af1864b918712cad43e92d0b9b607828c9db6c93e80a243313ef79dee9aa6d0445d55bd21559a8dc99ddaf0c49b69a422f12915f5bf2117e63370c3a870c7e2bea3a5b6c78f6318ea4a6b098e3ec8c16aa72fb08a146093e7203b7a1fdf63f3a99e5bfa5cd8a223b16abc087d9f8d1e1dcd130d563d2d9528ac61717748a9f912a4720e1925805e4eecaa5d0473ab3b25e308c9de18931d63dcebff0e45d535bfaa2b79306569446f8d2a4d946e77aaca343ef27cc98deb4a7873c1319874aefd808533819e424fabd2e34692ee552445790b215dc0b2a40be47f16e29d4a6415c416545c33663bfe08b717272263805b190c1010735dfc926fe08b7f6d1647e37c9";"Microsoft Internet Explorer"==navigator.appName?(g.prototype.am=function(e,t,i,r,a,n){for(var o=32767&t,s=t>>15;--n>=0;){var l=32767&this[e],h=this[e++]>>15,c=s*l+h*o;a=((l=o*l+((32767&c)<<15)+i[r]+(1073741823&a))>>>30)+(c>>>15)+s*h+(a>>>30),i[r++]=1073741823&l}return a},Be=30):"Netscape"!=navigator.appName?(g.prototype.am=function(e,t,i,r,a,n){for(;--n>=0;){var o=t*this[e++]+i[r]+a;a=Math.floor(o/67108864),i[r++]=67108863&o}return a},Be=26):(g.prototype.am=function(e,t,i,r,a,n){for(var o=16383&t,s=t>>14;--n>=0;){var l=16383&this[e],h=this[e++]>>14,c=s*l+h*o;a=((l=o*l+((16383&c)<<14)+i[r]+a)>>28)+(c>>14)+s*h,i[r++]=268435455&l}return a},Be=28),g.prototype.DB=Be,g.prototype.DM=(1<<Be)-1,g.prototype.DV=1<<Be;g.prototype.FV=Math.pow(2,52),g.prototype.F1=52-Be,g.prototype.F2=2*Be-52;var Fe,Ve,Ue="0123456789abcdefghijklmnopqrstuvwxyz",ke=new Array;for(Fe="0".charCodeAt(0),Ve=0;Ve<=9;++Ve)ke[Fe++]=Ve;for(Fe="a".charCodeAt(0),Ve=10;Ve<36;++Ve)ke[Fe++]=Ve;for(Fe="A".charCodeAt(0),Ve=10;Ve<36;++Ve)ke[Fe++]=Ve;w.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},w.prototype.revert=function(e){return e},w.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},w.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},w.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},M.prototype.convert=function(e){var t=y();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(g.ZERO)>0&&this.m.subTo(t,t),t},M.prototype.revert=function(e){var t=y();return e.copyTo(t),this.reduce(t),t},M.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=32767&e[t],r=i*this.mpl+((i*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[i=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},M.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},M.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},g.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},g.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+DV:this.t=0},g.prototype.fromString=function(e,t){var i;if(16==t)i=4;else if(8==t)i=3;else if(256==t)i=8;else if(2==t)i=1;else if(32==t)i=5;else{if(4!=t)return void this.fromRadix(e,t);i=2}this.t=0,this.s=0;for(var r=e.length,a=!1,n=0;--r>=0;){var o=8==i?255&e[r]:x(e,r);o<0?"-"==e.charAt(r)&&(a=!0):(a=!1,0==n?this[this.t++]=o:n+i>this.DB?(this[this.t-1]|=(o&(1<<this.DB-n)-1)<<n,this[this.t++]=o>>this.DB-n):this[this.t-1]|=o<<n,(n+=i)>=this.DB&&(n-=this.DB))}8==i&&0!=(128&e[0])&&(this.s=-1,n>0&&(this[this.t-1]|=(1<<this.DB-n)-1<<n)),this.clamp(),a&&g.ZERO.subTo(this,this)},g.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},g.prototype.dlShiftTo=function(e,t){var i;for(i=this.t-1;i>=0;--i)t[i+e]=this[i];for(i=e-1;i>=0;--i)t[i]=0;t.t=this.t+e,t.s=this.s},g.prototype.drShiftTo=function(e,t){for(var i=e;i<this.t;++i)t[i-e]=this[i];t.t=Math.max(this.t-e,0),t.s=this.s},g.prototype.lShiftTo=function(e,t){var i,r=e%this.DB,a=this.DB-r,n=(1<<a)-1,o=Math.floor(e/this.DB),s=this.s<<r&this.DM;for(i=this.t-1;i>=0;--i)t[i+o+1]=this[i]>>a|s,s=(this[i]&n)<<r;for(i=o-1;i>=0;--i)t[i]=0;t[o]=s,t.t=this.t+o+1,t.s=this.s,t.clamp()},g.prototype.rShiftTo=function(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)t.t=0;else{var r=e%this.DB,a=this.DB-r,n=(1<<r)-1;t[0]=this[i]>>r;for(var o=i+1;o<this.t;++o)t[o-i-1]|=(this[o]&n)<<a,t[o-i]=this[o]>>r;r>0&&(t[this.t-i-1]|=(this.s&n)<<a),t.t=this.t-i,t.clamp()}},g.prototype.subTo=function(e,t){for(var i=0,r=0,a=Math.min(e.t,this.t);i<a;)r+=this[i]-e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r-=e[i],t[i++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[i++]=this.DV+r:r>0&&(t[i++]=r),t.t=i,t.clamp()},g.prototype.multiplyTo=function(e,t){var i=this.abs(),r=e.abs(),a=i.t;for(t.t=a+r.t;--a>=0;)t[a]=0;for(a=0;a<r.t;++a)t[a+i.t]=i.am(0,r[a],t,a,0,i.t);t.s=0,t.clamp(),this.s!=e.s&&g.ZERO.subTo(t,t)},g.prototype.squareTo=function(e){for(var t=this.abs(),i=e.t=2*t.t;--i>=0;)e[i]=0;for(i=0;i<t.t-1;++i){var r=t.am(i,t[i],e,2*i,0,1);(e[i+t.t]+=t.am(i+1,2*t[i],e,2*i+1,r,t.t-i-1))>=t.DV&&(e[i+t.t]-=t.DV,e[i+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(i,t[i],e,2*i,0,1)),e.s=0,e.clamp()},g.prototype.divRemTo=function(e,t,i){var r=e.abs();if(!(r.t<=0)){var a=this.abs();if(a.t<r.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=y());var n=y(),o=this.s,s=e.s,l=this.DB-_(r[r.t-1]);l>0?(r.lShiftTo(l,n),a.lShiftTo(l,i)):(r.copyTo(n),a.copyTo(i));var h=n.t,c=n[h-1];if(0!=c){var u=c*(1<<this.F1)+(h>1?n[h-2]>>this.F2:0),f=this.FV/u,p=(1<<this.F1)/u,d=1<<this.F2,m=i.t,v=m-h,x=null==t?y():t;for(n.dlShiftTo(v,x),i.compareTo(x)>=0&&(i[i.t++]=1,i.subTo(x,i)),g.ONE.dlShiftTo(h,x),x.subTo(n,n);n.t<h;)n[n.t++]=0;for(;--v>=0;){var A=i[--m]==c?this.DM:Math.floor(i[m]*f+(i[m-1]+d)*p);if((i[m]+=n.am(0,A,i,v,0,h))<A)for(n.dlShiftTo(v,x),i.subTo(x,i);i[m]<--A;)i.subTo(x,i)}null!=t&&(i.drShiftTo(h,t),o!=s&&g.ZERO.subTo(t,t)),i.t=h,i.clamp(),l>0&&i.rShiftTo(l,i),o<0&&g.ZERO.subTo(i,i)}}},g.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return t=t*(2-(15&e)*t)&15,t=t*(2-(255&e)*t)&255,t=t*(2-((65535&e)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t},g.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},g.prototype.exp=function(e,t){if(e>4294967295||e<1)return g.ONE;var i=y(),r=y(),a=t.convert(this),n=_(e)-1;for(a.copyTo(i);--n>=0;)if(t.sqrTo(i,r),(e&1<<n)>0)t.mulTo(r,a,i);else{var o=i;i=r,r=o}return t.revert(i)},g.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var i,r=(1<<t)-1,a=!1,n="",o=this.t,s=this.DB-o*this.DB%t;if(o-- >0)for(s<this.DB&&(i=this[o]>>s)>0&&(a=!0,n=v(i));o>=0;)s<t?(i=(this[o]&(1<<s)-1)<<t-s,i|=this[--o]>>(s+=this.DB-t)):(i=this[o]>>(s-=t)&r,s<=0&&(s+=this.DB,--o)),i>0&&(a=!0),a&&(n+=v(i));return a?n:"0"},g.prototype.negate=function(){var e=y();return g.ZERO.subTo(this,e),e},g.prototype.abs=function(){return this.s<0?this.negate():this},g.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var i=this.t;if(0!=(t=i-e.t))return t;for(;--i>=0;)if(0!=(t=this[i]-e[i]))return t;return 0},g.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+_(this[this.t-1]^this.s&this.DM)},g.prototype.mod=function(e){var t=y();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(g.ZERO)>0&&e.subTo(t,t),t},g.prototype.modPowInt=function(e,t){var i;return i=e<256||t.isEven()?new w(t):new M(t),this.exp(e,i)},g.ZERO=A(0),g.ONE=A(1),D.prototype.convert=L,D.prototype.revert=L,D.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i)},D.prototype.sqrTo=function(e,t){e.squareTo(t)},R.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=y();return e.copyTo(t),this.reduce(t),t},R.prototype.revert=function(e){return e},R.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},R.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},R.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var Oe=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Xe=(1<<26)/Oe[Oe.length-1];g.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},g.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),r=A(i),a=y(),n=y(),o="";for(this.divRemTo(r,a,n);a.signum()>0;)o=(i+n.intValue()).toString(e).substr(1)+o,a.divRemTo(r,a,n);return n.intValue().toString(e)+o},g.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var i=this.chunkSize(t),r=Math.pow(t,i),a=!1,n=0,o=0,s=0;s<e.length;++s){var l=x(e,s);l<0?"-"==e.charAt(s)&&0==this.signum()&&(a=!0):(o=t*o+l,++n>=i&&(this.dMultiply(r),this.dAddOffset(o,0),n=0,o=0))}n>0&&(this.dMultiply(Math.pow(t,n)),this.dAddOffset(o,0)),a&&g.ZERO.subTo(this,this)},g.prototype.fromNumber=function(e,t,i){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,i),this.testBit(e-1)||this.bitwiseTo(g.ONE.shiftLeft(e-1),P,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(g.ONE.shiftLeft(e-1),this);else{var r=new Array,a=7&e;r.length=1+(e>>3),t.nextBytes(r),a>0?r[0]&=(1<<a)-1:r[0]=0,this.fromString(r,256)}},g.prototype.bitwiseTo=function(e,t,i){var r,a,n=Math.min(e.t,this.t);for(r=0;r<n;++r)i[r]=t(this[r],e[r]);if(e.t<this.t){for(a=e.s&this.DM,r=n;r<this.t;++r)i[r]=t(this[r],a);i.t=this.t}else{for(a=this.s&this.DM,r=n;r<e.t;++r)i[r]=t(a,e[r]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()},g.prototype.changeBit=function(e,t){var i=g.ONE.shiftLeft(e);return this.bitwiseTo(i,t,i),i},g.prototype.addTo=function(e,t){for(var i=0,r=0,a=Math.min(e.t,this.t);i<a;)r+=this[i]+e[i],t[i++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;i<this.t;)r+=this[i],t[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<e.t;)r+=e[i],t[i++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[i++]=r:r<-1&&(t[i++]=this.DV+r),t.t=i,t.clamp()},g.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},g.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},g.prototype.multiplyLowerTo=function(e,t,i){var r=Math.min(this.t+e.t,t);for(i.s=0,i.t=r;r>0;)i[--r]=0;var a;for(a=i.t-this.t;r<a;++r)i[r+this.t]=this.am(0,e[r],i,r,0,this.t);for(a=Math.min(e.t,t);r<a;++r)this.am(0,e[r],i,r,0,t-r);i.clamp()},g.prototype.multiplyUpperTo=function(e,t,i){--t;var r=i.t=this.t+e.t-t;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)i[this.t+r-t]=this.am(t-r,e[r],i,0,0,this.t+r-t);i.clamp(),i.drShiftTo(1,i)},g.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,i=this.s<0?e-1:0;if(this.t>0)if(0==t)i=this[0]%e;else for(var r=this.t-1;r>=0;--r)i=(t*i+this[r])%e;return i},g.prototype.millerRabin=function(e){var t=this.subtract(g.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var r=t.shiftRight(i);(e=e+1>>1)>Oe.length&&(e=Oe.length);for(var a=y(),n=0;n<e;++n){a.fromInt(Oe[Math.floor(Math.random()*Oe.length)]);var o=a.modPow(r,this);if(0!=o.compareTo(g.ONE)&&0!=o.compareTo(t)){for(var s=1;s++<i&&0!=o.compareTo(t);)if(0==(o=o.modPowInt(2,this)).compareTo(g.ONE))return!1;if(0!=o.compareTo(t))return!1}}return!0},g.prototype.clone=function(){var e=y();return this.copyTo(e),e},g.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},g.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},g.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},g.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},g.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var i,r=this.DB-e*this.DB%8,a=0;if(e-- >0)for(r<this.DB&&(i=this[e]>>r)!=(this.s&this.DM)>>r&&(t[a++]=i|this.s<<this.DB-r);e>=0;)r<8?(i=(this[e]&(1<<r)-1)<<8-r,i|=this[--e]>>(r+=this.DB-8)):(i=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&i)&&(i|=-256),0==a&&(128&this.s)!=(128&i)&&++a,(a>0||i!=this.s)&&(t[a++]=i);return t},g.prototype.equals=function(e){return 0==this.compareTo(e)},g.prototype.min=function(e){return this.compareTo(e)<0?this:e},g.prototype.max=function(e){return this.compareTo(e)>0?this:e},g.prototype.and=function(e){var t=y();return this.bitwiseTo(e,S,t),t},g.prototype.or=function(e){var t=y();return this.bitwiseTo(e,P,t),t},g.prototype.xor=function(e){var t=y();return this.bitwiseTo(e,C,t),t},g.prototype.andNot=function(e){var t=y();return this.bitwiseTo(e,T,t),t},g.prototype.not=function(){for(var e=y(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},g.prototype.shiftLeft=function(e){var t=y();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},g.prototype.shiftRight=function(e){var t=y();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},g.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+E(this[e]);return this.s<0?this.t*this.DB:-1},g.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,i=0;i<this.t;++i)e+=z(this[i]^t);return e},g.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},g.prototype.setBit=function(e){return this.changeBit(e,P)},g.prototype.clearBit=function(e){return this.changeBit(e,T)},g.prototype.flipBit=function(e){return this.changeBit(e,C)},g.prototype.add=function(e){var t=y();return this.addTo(e,t),t},g.prototype.subtract=function(e){var t=y();return this.subTo(e,t),t},g.prototype.multiply=function(e){var t=y();return this.multiplyTo(e,t),t},g.prototype.divide=function(e){var t=y();return this.divRemTo(e,t,null),t},g.prototype.remainder=function(e){var t=y();return this.divRemTo(e,null,t),t},g.prototype.divideAndRemainder=function(e){var t=y(),i=y();return this.divRemTo(e,t,i),new Array(t,i)},g.prototype.modPow=function(e,t){var i,r,a=e.bitLength(),n=A(1);if(a<=0)return n;i=a<18?1:a<48?3:a<144?4:a<768?5:6,r=a<8?new w(t):t.isEven()?new R(t):new M(t);var o=new Array,s=3,l=i-1,h=(1<<i)-1;if(o[1]=r.convert(this),i>1){var c=y();for(r.sqrTo(o[1],c);s<=h;)o[s]=y(),r.mulTo(c,o[s-2],o[s]),s+=2}var u,f,p=e.t-1,d=!0,m=y();for(a=_(e[p])-1;p>=0;){for(a>=l?u=e[p]>>a-l&h:(u=(e[p]&(1<<a+1)-1)<<l-a,p>0&&(u|=e[p-1]>>this.DB+a-l)),s=i;0==(1&u);)u>>=1,--s;if((a-=s)<0&&(a+=this.DB,--p),d)o[u].copyTo(n),d=!1;else{for(;s>1;)r.sqrTo(n,m),r.sqrTo(m,n),s-=2;s>0?r.sqrTo(n,m):(f=n,n=m,m=f),r.mulTo(m,o[u],n)}for(;p>=0&&0==(e[p]&1<<a);)r.sqrTo(n,m),f=n,n=m,m=f,--a<0&&(a=this.DB-1,--p)}return r.revert(n)},g.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return g.ZERO;for(var i=e.clone(),r=this.clone(),a=A(1),n=A(0),o=A(0),s=A(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&n.isEven()||(a.addTo(this,a),n.subTo(e,n)),a.rShiftTo(1,a)):n.isEven()||n.subTo(e,n),n.rShiftTo(1,n);for(;r.isEven();)r.rShiftTo(1,r),t?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(e,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);i.compareTo(r)>=0?(i.subTo(r,i),t&&a.subTo(o,a),n.subTo(s,n)):(r.subTo(i,r),t&&o.subTo(a,o),s.subTo(n,s))}return 0!=r.compareTo(g.ONE)?g.ZERO:s.compareTo(e)>=0?s.subtract(e):s.signum()<0?(s.addTo(e,s),s.signum()<0?s.add(e):s):s},g.prototype.pow=function(e){return this.exp(e,new D)},g.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var r=t;t=i,i=r}var a=t.getLowestSetBit(),n=i.getLowestSetBit();if(n<0)return t;for(a<n&&(n=a),n>0&&(t.rShiftTo(n,t),i.rShiftTo(n,i));t.signum()>0;)(a=t.getLowestSetBit())>0&&t.rShiftTo(a,t),(a=i.getLowestSetBit())>0&&i.rShiftTo(a,i),t.compareTo(i)>=0?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return n>0&&i.lShiftTo(n,i),i},g.prototype.isProbablePrime=function(e){var t,i=this.abs();if(1==i.t&&i[0]<=Oe[Oe.length-1]){for(t=0;t<Oe.length;++t)if(i[0]==Oe[t])return!0;return!1}if(i.isEven())return!1;for(t=1;t<Oe.length;){for(var r=Oe[t],a=t+1;a<Oe.length&&r<Xe;)r*=Oe[a++];for(r=i.modInt(r);t<a;)if(r%Oe[t++]==0)return!1}return i.millerRabin(e)},g.prototype.square=function(){var e=y();return this.squareTo(e),e},N.prototype.init=function(e){var t,i,r;for(t=0;t<256;++t)this.S[t]=t;for(i=0,t=0;t<256;++t)i=i+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[i],this.S[i]=r;this.i=0,this.j=0},N.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var Ge,Ye,We,je=256;if(null==Ye){Ye=new Array,We=0;var He;if("Netscape"==navigator.appName&&navigator.appVersion<"5"&&e.crypto){var qe=e.crypto.random(32);for(He=0;He<qe.length;++He)Ye[We++]=255&qe.charCodeAt(He)}for(;We<je;)He=Math.floor(65536*Math.random()),Ye[We++]=He>>>8,Ye[We++]=255&He;We=0,F()}U.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=V()};X.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},X.prototype.setPublic=function(e,t){this.n=k(e,16),this.e=parseInt(t,16)},X.prototype.encrypt=function(e){var t=O(e,this.n.bitLength()+7>>3);if(null==t)return null;var i=this.doPrivate(t);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r},X.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),i=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(i)<0;)t=t.add(this.p);return t.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},X.prototype.setPrivate=function(e,t,i){this.n=k(e,16),this.e=parseInt(t,16),this.d=k(i,16)},X.prototype.setPrivateEx=function(e,t,i,r,a,n,o,s){this.n=k(e,16),this.e=parseInt(t,16),this.d=k(i,16),this.p=k(r,16),this.q=k(a,16),this.dmp1=k(n,16),this.dmq1=k(o,16),this.coeff=k(s,16)},X.prototype.decrypt=function(e){var t=k(e,16),i=this.doPublic(t);return null==i?null:G(i,this.n.bitLength()+7>>3)};var Ze=function(){Qe.v(Ie)},Qe={},Ke="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",Je="10001",$e="61a921483dfa8f24e26204ace4d990b965d11e5bef5d8a5e768ebc5853a6bdd94b02369a3165207460fb91001d3fd83fbe69c6e51b8e40c8ae8a4e30a7c539dca98b44858bdc0b76f25af6803d4d13dacd9fa1a28f66cf561fa36309d4239a2cf50fe20ef0e99e01fc8701090f0685a524f411e00ca91f877d3b49d2d0052f9",et="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";Qe.cross=function(e){if(e){for(var t="",i=0;i<e.length;)i+1<e.length?(t+=e[i+1],t+=e[i]):t+=e[i],i+=2;return t}return null},Qe.reverse=function(e){if(e){for(var t="",i=e.length;i>0;i--)t+=e[i-1];return t}return null},Qe.v=function(e){if(e){var t=Qe;if(t.start=null,t.beginDate=null,t.end=null,t.endDate=null,t.gis=null,t["3D"]=null,t["3d"]=null,t.l=null,t.__li__=null,e.indexOf("signature=")>0){var i=e.split("signature="),r=i[0],a=i[1],n=new X;n.setPublic(Ke,Je);for(var o=a,s=o.length,l=0,h="",c="";l<s;)h=o.substr(l,256),c+=n.decrypt(h),l+=256;if(c===r)return t.i(e),!0}}return!1},Qe.i=function(e){var i=Qe;i.__li__=e;var r,a,n,o,s=e.split("\n");for(r=0;r<s.length;r++)a=(o=s[r].split("="))[0],n=o[1],i[a]=n;i.start!=t&&(i.beginDate=new Date(Date.parse(i.start.replace(/-/g,"/")))),i.end!=t&&(i.endDate=new Date(Date.parse(i.end.replace(/-/g,"/"))));var l=i.gis;l!=t&&(l=parseInt(l)),l&&(i._isPermissionGIS=!0);var h=i["3D"]||i["3d"];h!=t&&(h=parseInt(h)),h&&(i._isPermission3D=!0),i.l!=t&&(i.version=i.l)};var tt=function(e){return e.__li__!==t&&e._isPermission3D},it=function(e){if(!tt(e))return!0;var t=new Date;return null!=e.beginDate&&e.beginDate.getTime()-t.getTime()>=0||null!=e.endDate&&e.endDate.getTime()-t.getTime()<=0};Qe.$z=function(e){var t=new X;t.setPublic(Ke,Je);for(var i=e,r=i.length,a=0,n="",o="";a<r;)n=i.substr(a,256),o+=t.decrypt(n),a+=256;return o},Qe.twm=function(e){var i=Qe,r=i.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),a=this.type,n=this.markText;e[i.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341")]=i.__li__;var o=e;if(o._xyz=null,"3"!==a||it(Qe)||n!==t){e.DEBUG&&(console.log("license: "+Qe.__li__),console.log("license Type : "+a),console.log("beginDate: "+Qe.beginDate),console.log("endDate: "+Qe.endDate),console.log("mark: "+n)),e.__liLabel==t&&(e.__liLabel=document.createElement("div")),i.startDate===t&&(i.startDate=new Date);var s=(new Date).getTime()-i.startDate.getTime(),l="2"===a?7200:300;if(!(s<1e3*l)){var h=it(i)&&s>1e3*l,c=n;if(h?c=i.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=a||c!==t&&""!=c?"1"!=a||n||(c=r):c=i.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),c!==t){var u=o.__liLabel;u.innerHTML=c,u.type=a,u.mark=n,u.expired=h,o._xyz=u,h&&(o.getView().style.opacity=.1)}}}},Ee.validateLicense(Ie),se.Material=function(e){se.PropertyChangeDispatcher.call(this),this.id=se.MaterialIdCount++,this.type="basic",this.shaderID="",this.uniforms=t,this.vertexShader="",this.fragmentShader="",this.alarmColor=null,this.name="",this.side=se.FrontSide,this.fog=!0,this.normalType=t,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecolor=new se.Color(16777215),this.wireframeLineopacity=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=2,this.gradientColors=3,this.blendMode=se.NormalBlending,this.blendSrc=se.SrcAlphaFactor,this.blendDst=se.OneMinusSrcAlphaFactor,this.blendEquation=se.AddEquation,this.depthTest=!0,this.depthMask=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.transparent=!1,this.opacity=1,this.visible=!0,this.needsUpdate=!0,this.setValues(e),this.useCount=0,this.styleMap={},this.offset=new le(0,0),this.repeat=new le(1,1),this.gradient={},this.gradientType=1,this.gradientCenter=new le(.5,.5),this.outline=0},se.extend(se.Material,se.PropertyChangeDispatcher,{generateKey:function(){},setMap:function(e,t){if(null==t&&(t="map"),this[t]!==e){var i=this[t];this[t]=e,this.firePropertyChange(t,i,e),this.onMapChanged(i,e)}},handleTextureChange:function(e){if("image"===e.property){this.firePropertyChange("needsUpdate",!1,!0)}else e.property},onPropertyChange:function(e,t,i){},onMapChanged:function(e,t){},setColor:function(e){if(this.color!==e){var t=this.color.clone();e instanceof se.Color?this.color.copy(e):this.color.set(e),this.firePropertyChange("color",t,e)}},setPropertyValue:function(e,t){if(this[e]!==t){var i=this[e];if(i instanceof se.Color)null!=t&&(i=i.clone(),t instanceof se.Color?this[e].copy(t):this[e].set(t));else if("gradient"==e){var r={};for(var a in t)t[a]instanceof se.Color?r[a]=t[a]:r[a]=new se.Color(t[a]);this[e]=r}else this[e]=t;this._uniqueCode=null,this.firePropertyChange(e,i,t)}},isTextureStyle:function(e){return"terrain"===this._type?e.startsWith("texture1.")||e.startsWith("texture2.")||e.startsWith("textureb.")||e.startsWith("texturen.")||e.startsWith("texturebp."):e.startsWith("texture.")||e.startsWith("lightmap")||e.startsWith("envmap")||e.startsWith("normalmap")||e.startsWith("specularmap")},setNeedsUpdate:function(e){},getShaderID:function(){return this instanceof se.BasicMaterial&&(this.shaderID="basic"),this.shaderID},setupMaterialShader:function(){var e=this.getShaderID(),t=se.ShaderLib[e];t&&(this.uniforms=se.UniformsUtils.clone(t.uniforms),this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader)},refreshUniforms:function(e,t){this.refreshUniformsCommon(e,t),this.refreshUniformsSpecific(e,t)},loadCameraPosition:function(e,t,i){if((this instanceof se.ShaderMaterial||this instanceof se.PhongMaterial||this.envMap||"phong"===this._type)&&null!=e.cameraPosition){var r=t.worldMatrix.getPosition();i.uniform3f(e.cameraPosition,r.x,r.y,r.z)}},loadViewMatrix:function(e,t,i){("lambert"===this.type||"phong"===this.type||material.skinning)&&null!==e.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,t.worldMatrixInverse.elements)},refreshUniformsSpecific:function(e){},refreshUniformsCommon:function(e){var i=this.uniforms,r=this;i.opacity.value=r.opacity,i.wireframeLinecolor.value=r.wireframeLinecolor,i.wireframeLineopacity.value=r.wireframeLineopacity;var a=Ee.getObjectCount(this.gradient)>0;if(e?i.diffuse.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.color):i.diffuse.value=this.alarmColor?this.alarmColor:this.color,a){var n=[],o=[];for(var s in this.gradient)n.push(s);n.sort();for(var l=0;l<n.length;l++)o.push(this.gradient[n[l]]);i.gradientColor.value=o,i.gradientStop.value=n,i.gradientType.value=this.gradientType}i.map.value=r.map,i.lightMap.value=r.lightMap,i.specularMap.value=r.specularMap,r.bumpMap&&(i.bumpMap.value=r.bumpMap,i.bumpScale.value=r.bumpScale),r.normalMap&&"phong"===r._type&&(i.normalMap.value=r.normalMap,i.normalScale.value.copy(r.normalScale));var h;if(r.map?h=r.map:r.specularMap?h=r.specularMap:r.normalMap&&"phong"===r._type?h=r.normalMap:r.bumpMap&&"phong"===r._type&&(h=r.bumpMap),h!=t){var c=this.offset,u=this.repeat;i.offsetRepeat.value.set(c.x,c.y,u.x,u.y),i.flipX.value=h.flipX?1:0,i.mapLoaded.value=1,h._image&&!h._image.loaded&&i.offsetRepeat.value.set(0,0,1,1)}i.envMap.value=r.envMap,i.flipEnvMap.value=1,i.reflectivity.value=e?r.reflectRatio*r.reflectRatio:r.reflectRatio,i.refractionRatio.value=r.refractionRatio,i.combine.value=r.combine,i.useRefract.value=r.envMap&&r.envMap.mapping instanceof se.CubeRefractionMapping},loadGeneralUniforms:function(){},getNormalType:function(){return this&&this.normalType!==t&&this.normalType===se.NormalTypeSmooth?se.SmoothShading:se.FlatShading},isVertexColor:function(){return!!this.vertexColors&&this.vertexColors},isGradientColor:function(){return!!this.gradientColors&&this.gradientColors},needUV:function(){return this.map||this.lightMap||this.bumpMap||this.normalMap||this.specularMap,!0},setValues:function(e){if(e!==t)for(var i in e){var r=e[i];if(r!==t){if(i in this){var a=this[i];a instanceof se.Color&&r instanceof se.Color?a.copy(r):a instanceof se.Color?a.set(r):a instanceof se.Vec3&&r instanceof se.Vec3?a.copy(r):this[i]=r}}else console.warn("TGL.Material: '"+i+"' parameter is undefined.")}},isCustomAttributesNeedUpdate:function(){if(!this.attributes)return!1;for(var e in this.attributes)if(this.attributes[e].needsUpdate)return!0;return!1},clearCustomAttributes:function(){if(this.attributes)for(var e in this.attributes)this.attributes[e].needsUpdate=!1},clone:function(e){return e===t&&(e=new se.Material),e.name=this.name,e.side=this.side,e.blendMode=this.blendMode,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthMask=this.depthMask,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.transparent=this.transparent,e.opacity=this.opacity,e.visible=this.visible,e.normalType=this.normalType,e.wireframe=this.wireframe,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecolor=this.wireframeLinecolor.clone(),e.wireframeLineopacity=this.wireframeLineopacity,e.gradient=this.gradient,e.gradientType=this.gradientType,e.outline=this.outline,e},dispose:function(){this.firePropertyChange("disposed",!1,!0)}}),se.MaterialIdCount=0,se.EntityMaterial=function(e){se.Material.call(this),this._type="basic",this.color=new se.Color(16777215),this.map=null,this.ambient=new se.Color(16777215),this.emissive=new se.Color(0),this.specular=new se.Color(1118481),this.specularStrength=1,this.shininess=30,this.wrapAround=!1,this.wrapRGB=new se.Vec3(1,1,1),this.lightMap=null,this.specularMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new se.Vec2(1,1),this.envMap=null,this.combine=se.MultiplyOperation,this.reflectRatio=1,this.refractionRatio=.98,this.fog=!0,this.shading=se.SmoothShading,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.metal=!1,this.perPixel=!0,this.map1=null,this.map2=null,this.blendMap=null,this.detailMap=null,this.specularMap=null,this.blendRange=new le(0,1),this.setValues(e),this.bakeLightMap=!1},se.extend(se.EntityMaterial,se.Material,{getShaderID:function(){return this.getType()},getUniqueCode:function(){if(null!=this._uniqueCode)return this._uniqueCode;var e=this._type+" "+this.color.r+this.color.g+this.color.b+" "+this.ambient.getUniqueCode()+" "+this.emissive.getUniqueCode()+this.specular.getUniqueCode()+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth+" "+this.wireframeLinecolor+" "+this.wireframeLineopacity+" "+this.polygonOffset+" "+this.polygonOffsetFactor+" "+this.polygonOffsetUnits+" "+this.overdraw+" "+this.shininess+" "+this.metal+" "+this.specularStrength;if(this.alphaTest&&(e+=this.alphaTest),e+=" "+this.normalType+" ",e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,e+=" "+this.blendRange.x+" "+this.blendRange.y,e+=" "+this.normalScale.x+" "+this.normalScale.y,e+=" "+this.reflectRatio,this.map&&(e+=this.map.getUniqueCode()),this.map1&&(e+=this.map1.getUniqueCode()),this.map2&&(e+=this.map2.getUniqueCode()),this.blendMap&&(e+=this.blendMap.getUniqueCode()),this.normalMap&&(e+=this.normalMap.getUniqueCode()),this.lightMap&&(e+=this.lightMap.getUniqueCode()),this.envMap&&(e+=this.envMap.getUniqueCode()),this.specularMap&&(e+=this.specularMap.getUniqueCode()),this.alarmColor&&(e+=" "+this.alarmColor.getUniqueCode()),this.gradient)for(var t in this.gradient)e+=" "+t+":"+this.gradient[t].getUniqueCode();return e+=" "+this.gradientType,e+=" "+this.outline,e+=this.combine,e+=this.bakeLightMap?" bakeLightMap ":"",this._uniqueCode=e,e},loadViewMatrix:function(e,t,i){("lambert"===this._type||"phong"===this._type||material.skinning)&&null!==e.viewMatrix&&i.uniformMatrix4fv(p_uniforms.viewMatrix,!1,t.worldMatrixInverse.elements)},onMapChanged:function(e,t){if(se.TexturePool.useTexture(t),se.TexturePool.unUseTexture(e),t){var i=t.getUniqueCode();null==se.TexturePool.getTexture(i)&&se.TexturePool.setTexture(i,t)}},setType:function(e){if(this._type!==e){var t=this._type;this._type=e,this.firePropertyChange("type",t,e),this.onTypeChanged(t,e)}},onTypeChanged:function(){},getType:function(){return this._type},setStyle:function(e,t){if(null!=e){null==this.styleMap&&(this.styleMap={});var i=this.styleMap[e];return null==t?delete this.styleMap[e]:this.styleMap[e]=t,this.firePropertyChange(se.Styles.PREFIX_STYLE+e,i,t),this.onStyleChanged(e,i,t),this}},getStyle:function(e,t){null==t&&(t=!0);var i;return null!=this.styleMap&&(i=this.styleMap[e]),null==i&&t&&(i=se.Styles.getStyle(e)),i},clone:function(e){return e=e||new se.EntityMaterial,se.Material.prototype.clone.call(this,e),e._type=this._type,e.color.copy(this.color),e.wireframeLinecolor.copy(this.wireframeLinecolor),e.setMap(this.map,"map"),e.setMap(this.map1,"map1"),e.setMap(this.map2,"map2"),e.setMap(this.blendMap,"blendMap"),e.setMap(this.normalMap,"normalMap"),e.setMap(this.specularMap,"specularMap"),e.setMap(this.envMap,"envMap"),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.setMap(this.lightMap,"lightMap"),e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalScale.copy(this.normalScale),e.combine=this.combine,e.reflectRatio=this.reflectRatio,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e.specularStrength=this.specularStrength,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.blendRange.copy(this.blendRange),e},refreshUniformsSpecific:function(e){var t=this.uniforms;"lambert"===this._type?(e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)):"phong"===this._type&&(t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.alarmColor?this.alarmColor:this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.alarmColor?this.alarmColor:this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),t.uspecularStrength.value=this.specularStrength,this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB))},refreshUniformsCommon:function(e){if("terrain"===this._type)(t=this.uniforms).enableDiffuse1.value=this.map?1:0,t.tDiffuse1.value=this.map,t.enableDiffuse2.value=this.map1?1:0,t.tDiffuse2.value=this.map1,t.enableDiffuse3.value=this.map2?1:0,t.tDiffuse3.value=this.map2,t.enableDisplacement.value=this.blendMap?1:0,t.tDisplacement.value=this.blendMap,t.uRepeatOverlay.value=this.repeat,null==this.blendRangeArray&&(this.blendRangeArray=[0,1]),this.blendRangeArray[0]=this.blendRange.x,this.blendRangeArray[1]=this.blendRange.y,t.blendRange.value=this.blendRangeArray;else if("outline"===this._type){var t=this.uniforms;t.diffuse.value=this.color,t.outline_offset.value=this.outline}else se.Material.prototype.refreshUniformsCommon.call(this,e)}}),se.BlurMaterial=function(){se.Material.call(this),this.orientation=0,this.blurAmount=5,this.blurScale=1,this.blurStrength=1,this.useBlur=1,this.texelSize=new le(512,512),this.blurGlobalAlpha=1},se.extend(se.BlurMaterial,se.Material,{refreshUniformsCommon:function(e){var t=this.uniforms;t.map.value=this.map,t.orientation.value=this.orientation,t.blurAmount.value=this.blurAmount,t.blurScale.value=this.blurScale,t.blurStrength.value=this.blurStrength,t.useBlur.value=this.useBlur,t.texelSize.value=this.texelSize,t.blurGlobalAlpha.value=this.blurGlobalAlpha},getShaderID:function(){return"blur"}}),se.DeferredMaterial=function(e){e=e||{},se.Material.call(this,e),this.linearDepth=30,this.isNormal=e.isNormal!==t?e.isNormal:0},se.extend(se.DeferredMaterial,se.Material,{getShaderID:function(){return"deferred"},refreshUniformsCommon:function(e){var t=this.uniforms;t.linearDepth.value=this.linearDepth,t.isNormal.value=this.isNormal}}),se.SSAOMaterial=function(e){se.Material.call(this),this.map1=null,this.map2=null,this.occluderBias=.05,this.samplingRadius=20,this.attenuation=new le(1,.02),this.texelSize=new le(1/512,1/512)},se.extend(se.SSAOMaterial,se.Material,{getShaderID:function(){return"ssao"},refreshUniformsCommon:function(e){var t=this.uniforms;t.map0.value=this.map,t.map1.value=this.map1,t.map2.value=this.map2,t.occluderBias.value=this.occluderBias,t.samplingRadius.value=this.samplingRadius,t.attenuation.value=this.attenuation,t.texelSize.value=this.texelSize}}),se.BasicMaterial=function(e){se.Material.call(this),this._type="basic",this.color=new se.Color(16777215),this.map=null,this.setValues(e),this.offset=new le(0,0),this.repeat=new le(1,1)},se.extend(se.BasicMaterial,se.Material,{getShaderID:function(){return"basic"},clone:function(){var e=new se.BasicMaterial;return se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e},getUniqueCode:function(){var e=this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e}}),se.LambertMaterial=function(e){se.Material.call(this),this._type="basic",this.color=new se.Color(16777215),this.ambient=new se.Color(16777215),this.emissive=new se.Color(0),this.wrapAround=!1,this.wrapRGB=new se.Vec3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=se.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=se.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=se.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},se.extend(se.LambertMaterial,se.Material,{clone:function(){var e=new se.LambertMaterial;return se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"lambert"},refreshUniformsSpecific:function(e){var t=this.uniforms;e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive),this.wrapAround&&t.wrapRGB.value.copy(this.wrapRGB)}}),se.PhongMaterial=function(e){se.Material.call(this),this._type="basic",this.color=new se.Color(16777215),this.ambient=new se.Color(16777215),this.emissive=new se.Color(0),this.specular=new se.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new se.Vec3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new se.Vec2(1,1),this.specularMap=null,this.envMap=null,this.combine=se.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=se.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=se.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e),this.offset=new le(0,0),this.repeat=new le(1,1)},se.extend(se.PhongMaterial,se.Material,{getUniqueCode:function(){var e="phong "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.repeat.x+" "+this.repeat.y+this.offset.x+" "+this.offset.y,this.map&&(e+=this.map.getUniqueCode()),e},clone:function(){var e=new se.PhongMaterial;return se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},getShaderID:function(){return"phong"},refreshUniformsSpecific:function(e){var t=this.uniforms;t.shininess.value=this.shininess,e?(t.ambient.value.copyGammaToLinear(this.ambient),t.emissive.value.copyGammaToLinear(this.emissive),t.specular.value.copyGammaToLinear(this.specular)):(t.ambient.value=this.ambient,t.emissive.value=this.emissive,t.specular.value=this.specular),this.wrapAround&&t.wrapRGB.value.copy(material.wrapRGB)}}),se.LineMaterial=function(e){se.Material.call(this),this.color=new se.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.dashed=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new se.Color(16777215),this.horizonColor=new se.Color(16777215),this.earthColor=new se.Color(16777215),this.vertexColors=!1,this.gradientColors=!0,this.fog=!0,this.setValues(e)},se.extend(se.LineMaterial,se.Material,{getUniqueCode:function(){var e=this.color.getUniqueCode+" "+this.linewidth+" "+this.dashed+" "+this.visible;return e+=this.transparent+" "+this.opacity,e+=this.skyY+" "+this.horizonY+" "+this.earthY,e+=this.skyColor.getUniqueCode(),e+=this.horizonColor.getUniqueCode(),e+=this.earthColor.getUniqueCode()},clone:function(){var e=new se.LineMaterial;return se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.dashed=this.dashed,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.dashed?"dashed":"basic"},refreshUniforms:function(e){Y(this.uniforms,this),this.dashed&&W(this.uniforms,this)}}),se.LineXMaterial=function(e){se.Material.call(this),this.color=new se.Color(16777215),this.side=se.DoubleSide,this.attributes={positionPrev:{type:"v3",ref:"verticesPrev"},positionNext:{type:"v3",ref:"verticesNext"},offset:{type:"f",ref:"offset"}},this.useVertexColor=!1},se.extend(se.LineXMaterial,se.Material,{getUniqueCode:function(){var e=this.color.getUniqueCode()+this.visible;return e+=this.transparent+" "+this.opacity,e+=this.side,e+=this.useVertexColor},clone:function(){var e=new se.LineXMaterial;return se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.useVertexColor=this.useVertexColor,e},getShaderID:function(){return"linex"},refreshUniforms:function(e,t){if(this.uniforms.lineColor.value=this.color,this.uniforms.opacity.value=this.opacity,t.network){var i=t.network.getView();this.uniforms.viewport.value=new se.Vec4(0,0,i.width,i.height)}t.camera&&(this.uniforms.near.value=t.camera.near||1),this.uniforms.useVertexColor.value=this.useVertexColor?1:0}}),se.SurfaceMaterial=function(e){se.EntityMaterial.call(this),this.skyY=0,this.horizonY=0,this.earthY=0,this.skyColor=new se.Color(16777215),this.horizonColor=new se.Color(16777215),this.earthColor=new se.Color(16777215)},se.extend(se.SurfaceMaterial,se.EntityMaterial,{getUniqueCode:function(){var e=se.EntityMaterial.prototype.getUniqueCode.call(this);return this.skyColor&&(e+=" "+this.skyColor.getUniqueCode()),this.horizonColor&&(e+=" "+this.horizonColor.getUniqueCode()),this.earthColor&&(e+=" "+this.earthColor.getUniqueCode()),e+=" "+this.skyY,e+=" "+this.horizonY,e+=" "+this.earthY,this._uniqueCode=e,e},clone:function(){var e=new se.SurfaceMaterial;return se.EntityMaterial.prototype.clone.call(this,e),e.skyY=this.skyY,e.horizonY=this.horizonY,e.earthY=this.earthY,e.skyColor=this.skyColor,e.horizonColor=this.horizonColor,e.earthColor=this.earthColor,e},refreshUniforms:function(e){se.EntityMaterial.prototype.refreshUniforms.call(this,e),H(this.uniforms,this)}}),se.ArrayMaterial=function(e){this.materials=e||[]},se.extend(se.ArrayMaterial,Object,{clone:function(){for(var e=new se.ArrayMaterial,t=0;t<this.materials.length;t++){var i=this.materials[t],r=this.materials.indexOf(i);null!=e.materials[r]?e.materials.push(e.materials[r]):e.materials.push(i.clone())}return e}}),se.BillboardMaterial=function(e){se.Material.call(this),this.alignment=se.BillboardAlignment.center.clone(),this.fog=!1,this.color=new se.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.offset=new se.Vec2(0,0),this.repeat=new se.Vec2(1,1),this.transparent=!0,this.setValues(e),this.depthMask=!0,this.vertical=!1,this.fixedSize=0,this.alphaTest=0},se.extend(se.BillboardMaterial,se.Material,{clone:function(e){return e=e||new se.BillboardMaterial,se.Material.prototype.clone.call(this,e),e.alignment.copy(this.alignment),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.fog=this.fog,e.vertical=this.vertical,e.transparent=this.transparent,e.alphaTest=this.alphaTest,e.blendMode=this.blendMode,e.fixedSize=this.fixedSize,e},getUniqueCode:function(){var e="Billboard "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return e+=this.vertical+" "+this.alphaTest+" "+this.alignment.x+" "+this.alignment.y,e+=this.fixedSize,e+=this.repeat.x+" "+this.repeat.y,e+=this.offset.x+" "+this.offset.y,e+=" "+this.blendMode,this.map&&(e+=this.map.getUniqueCode()),e}}),se.BillboardAlignment={},se.BillboardAlignment.topLeft=new se.Vec2(.5,-.5),se.BillboardAlignment.topCenter=new se.Vec2(0,-.5),se.BillboardAlignment.topRight=new se.Vec2(-.5,-.5),se.BillboardAlignment.centerLeft=new se.Vec2(.5,0),se.BillboardAlignment.center=new se.Vec2(0,0),se.BillboardAlignment.centerRight=new se.Vec2(-.5,0),se.BillboardAlignment.bottomLeft=new se.Vec2(.5,.5),se.BillboardAlignment.bottomCenter=new se.Vec2(0,.5),se.BillboardAlignment.bottomRight=new se.Vec2(-.5,.5);var rt=function(e){se.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms=e.uniforms||{},this.defines={},this.attributes=null,this.shaderID=e.shaderID||"depth",this._type="shader",this.shading=se.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=se.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)};se.ShaderMaterial=rt,se.extend(se.ShaderMaterial,se.Material,{clone:function(){var e=new se.ShaderMaterial;return se.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=se.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},setupMaterialShader:function(){},needUV:function(){return!0},getShaderID:function(){return this.shaderID},refreshUniformsCommon:function(e,t){}}),se.TransformGizmoMaterial=function(e){se.BasicMaterial.call(this),this.depthTest=!1,this.depthMask=!1,this.side=se.DoubleSide,this.transparent=!0,this.setValues(e)},se.extend(se.TransformGizmoMaterial,se.BasicMaterial,{getUniqueCode:function(){var e=this.id+"TransformGizmo "+this.color.r+this.color.g+this.color.b+" "+this.transparent+" "+this.visible+" "+this.opacity+" "+this.depthTest+this.depthMask+" "+this.side+" "+this.wireframe+" "+this.wireframeLinewidth;return this.map&&(e+=this.map.getUniqueCode()),e}});var at={pools:{},useTimes:{},size:0,getMaterial:function(e){return at.pools[e]},setMaterial:function(e,t){at.size++,at.pools[e]=t},useMaterial:function(e){if(e){var t=e.id,i=at.useTimes[t]||0;i++,at.useTimes[t]=i}},unUseMaterial:function(e){if(e){var t=e.id,i=at.useTimes[t]||0;if(i--,at.useTimes[t]=i,i<=0){var r=e.getUniqueCode();delete at.pools[r],at.size--,e.dispose()}}},clear:function(){this.pools={},this.useTimes={},this.size=0}};se.MaterialPool=at,at.DefaultMaterial=new se.EntityMaterial,at.TestMaterial=new se.EntityMaterial,at.DefaultBillBoardMaterial=new se.BillboardMaterial,at.DefaultLineMaterial=new se.LineMaterial,se.ParticleMaterial=function(e){se.Material.call(this),this.color=new se.Color(16777215),this.map=null,this.size=2,this.sizeAttenuation=!1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},se.extend(se.ParticleMaterial,se.Material,{clone:function(){var e=new se.ParticleMaterial;return se.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},getShaderID:function(){return this.shaderID="particle_basic",this.shaderID},getUniqueCode:function(){var e=this.color.getUniqueCode();return e+=map?map.getUniqueCode():"",e+=" "+this.size,e+=" "+this.fog,e+=" "+this.sizeAttenuation,e+=" "+this.transparent,e+=" "+this.opacity,e+=" "+this.depthTest,e+=" "+this.alphaTest},refreshUniforms:function(e){q(this.uniforms,this)}}),se.Light=function(e,t){se.Element.call(this,t),this.color=new se.Color(e),this.ambient=new se.Color,this.diffuse=new se.Color,this.specular=new se.Color,this.castShadow=!1,this.onlyShadow=!1},se.extend(se.Light,se.Element,{__accessor:["color","ambient","diffuse","specular"],constructor:se.Light,className:"TGL.Light",setCastShadow:function(e){this.castShadow=e},setOnlyShadow:function(e){this.onlyShadow=e},refreshShadowUniforms:function(e,t){var i=this;if(e.shadowMatrix&&i.castShadow&&(i instanceof se.SpotLight||i instanceof se.DirectionalLight&&!i.shadowCascade))return e.shadowMap.value[t]=i.shadowMap,e.shadowMapSize.value[t]=i.shadowMapSize,e.shadowMatrix.value[t]=i.shadowMatrix,e.shadowDarkness.value[t]=i.shadowDarkness,e.shadowBias.value[t]=i.shadowBias,!0},refreshUniformsPointShadow:function(e,t){var i=this;if(e.pShadowMap&&i.castShadow&&i instanceof se.PointLight)return e.pShadowMap.value[t]=i.shadowMap,e.pShadowMapSize.value[t]=i.shadowMapSize,e.pShadowDarkness.value[t]=i.shadowDarkness||.5,e.pPosition.value[t]=i.getPosition(),e.pShadowRadius.value[t]=i.shadowRadius||1,e.shadowCameraNear.value=i.shadowCameraNear,e.shadowCameraFar.value=i.shadowCameraFar,!0}}),se.PointLight=function(e,i,r,a){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var n=arguments[0];e=n.hex,i=n.intensity,r=n.distance,a=n.id}se.Light.call(this,e,a),this.position=new se.Vec3(0,0,0),this.intensity=i!==t?i:1,this.distance=r!==t?r:0,this.shadowCameraNear=10,this.shadowCameraFar=1e3,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowDarkness=.5},se.extend(se.PointLight,se.Light,{constructor:se.PointLight,className:"TGL.PointLight",__accessor:["intensity","distance"]}),se.SpotLight=function(e,i,r,a,n){se.Light.call(this,e),this._position=new se.Vec3(0,1,0),this.target=new se.Element,this.intensity=i!==t?i:1,this.distance=r!==t?r:0,this.angle=a!==t?a:Math.PI/2,this.exponent=n!==t?n:10,this.shadowCameraNear=100,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},se.extend(se.SpotLight,se.Light,{__accessor:["color","ambient","diffuse","specular","intensity","distance","angle","exponent"],constructor:se.SpotLight,className:"TGL.SpotLight"}),se.DirectionalLight=function(e,i,r){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var a=arguments[0];e=a.hex,i=a.intensity,r=a.id}se.Light.call(this,e,r),this.direction=new se.Vec3(0,1,0),this.position=new se.Vec3(0,1,0),this.target=new se.Element,this.intensity=i!==t?i:1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new se.Vec3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},se.extend(se.DirectionalLight,se.Light,{className:"TGL.DirectionalLight",__accessor:["direction"]}),se.AmbientLight=function(e,t){if(1===arguments.length&&arguments[0]instanceof Object&&!Array.isArray(arguments[0])){var i=arguments[0];e=i.hex,t=i.id}se.Light.call(this,e,t)},se.extend(se.AmbientLight,se.Light,{constructor:se.AmbientLight,className:"TGL.AmbientLight",clone:function(){var e=new se.AmbientLight;return se.Light.prototype.clone.call(this,e),e}}),se.Camera=function(){se.Element.call(this),this.projectionMatrix=new se.Mat4,this.projectionMatrixInverse=new se.Mat4,this.worldMatrixInverse=new se.Mat4,this.target=new se.Vec3,this.setPosition(0,0,500),this.lookat=this.lookAt},se.extend(se.Camera,se.Element,{constructor:se.Camera,updateCameraMatrix:function(e){var t=this.matrix.clone();this.matrix.lookAt(this._position,this.target,this.up),this.rotationAutoUpdate&&this._rotation.setEulerFromRotationMatrix(this.matrix),!t.equals(this.matrix)&&e&&this.firePropertyChange("matrix",t,this.matrix)},lookAt:function(e,i){3===arguments.length&&e.x===t?(e=new mono.Vec3(arguments[0],arguments[1],arguments[2]),i=t):4===arguments.length&&e.x===t&&(e=new mono.Vec3(arguments[0],arguments[1],arguments[2]),i=arguments[4]),i===t&&(i=!0),this.target=e,this.updateCameraMatrix(i)},look:function(e){3===arguments.length&&e.x===t&&(e=new mono.Vec3(arguments[0],arguments[1],arguments[2])),this.lookAt(e,!0)},onUpChanged:function(e,t){this.updateCameraMatrix()},getTarget:function(){return this.target},t:function(){return this.getTarget()},getDistance:function(){return(new he).subVectors(this._position,this.target).length()},setDistance:function(e){var t=this.getDistance();this.zoom(e/t)},lookAtElement:function(e,t,i){t instanceof he?(i=t,t=this.getDistance()):i=i||new he(0,0,1),e instanceof se.Element&&(t=t||this.getDistance(),this.setPosition(e.worldPosition(i,t)),this.look(e.getWorldPosition()))},zoomOut:function(e){this.zoom(1.1,e)},zoomIn:function(e){this.zoom(.9,e)},zoom:function(e,t){if(e>0){var i=t||this.getDistance();i*=e;var r=(new he).addVectors(this.target,(new he).subVectors(this._position,this.target).setLength(i));this.setPosition(r)}}}),se.OrthoCamera=function(e,t,i,r){se.Camera.call(this),this.width=e||1,this.aspect=t||1,this.near=i||.1,this.far=r||1e4,this.updateProjectionMatrix()},se.extend(se.OrthoCamera,se.Camera,{constructor:se.OrthoCamera,className:"TGL.OrthoCamera",__accessor:["width","aspect","near","far"],updateProjectionMatrix:function(){var e=this.getDistance(),t=e*this.width/2,i=-t,r=e/this.aspect*this.width/2,a=-r;this.projectionMatrix.makeOrthographic(i,t,r,a,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()},updateCameraMatrix:function(e){se.Camera.prototype.updateCameraMatrix.call(this,e),this.updateProjectionMatrix()}}),se.PerspectiveCamera=function(e,i,r,a){se.Camera.call(this),this.fov=e!==t?e:50,this.aspect=i!==t?i:1,this.near=r!==t?r:1,this.far=a!==t?a:5e4,this.updateProjectionMatrix()},se.extend(se.PerspectiveCamera,se.Camera,{constructor:se.PerspectiveCamera,className:"TGL.PerspectiveCamera",__accessor:["fov","aspect","near","far"],updateProjectionMatrix:function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},onPropertyChange:function(){this.updateProjectionMatrix()}}),se.VRCamera=function(e,i,r){se.Camera.call(this),this.network=e,this.vrDisplay=e._vrDisplay,this.near=i!==t?i:.01,this.far=r!==t?r:1e4,this.orientation=[0,0,0,1],this.leftPm=new ue,this.rightPm=new ue,this.leftVm=new ue,this.leftVmInverse=new ue,this.rightVm=new ue,this.rightVmInverse=new ue,this.speed=.01,this.lockY=!1,this.updateProjectionMatrix()},se.extend(se.VRCamera,se.Camera,{constructor:se.VRCamera,className:"TGL.VRCamera",__accessor:["near","far","lockY","speed"],updateCameraMatrix:function(e){},updateMatrix:function(){},updateWorldMatrix:function(e,t){},updateProjectionMatrix:function(){function e(){t=null,i=null,r=null;for(var e=navigator.getGamepads(),a=0;a<e.length;a++){var n=e[a];n&&n.pose&&("right"===n.hand?i=n:t=n,n.buttons.some(function(e,t){if(e.pressed)return r=n,!0}))}}var t,i,r,a=new ue,n=new ue,o=new ue,s=new he,l=new ue,h=new mono.Quat,c=new mono.Quat;return function(){var u=this,f=u.leftVm,p=u.rightVm,d=u.leftVmInverse,m=u.rightVmInverse,g=u.leftPm,y=u.rightPm,v=u._frameData,x=u.vrDisplay;if(x){if(v||(v=u._frameData=new VRFrameData),x.getFrameData(v),e(),l.set(x.stageParameters.sittingToStandingTransform),r){var A;if(r.buttons.some(function(e,t){if(e.pressed)return A=t,!0}),2===A){s.set(0,0,-u.speed),c.setFromRotationMatrix(l);var _=r.pose.orientation;h.set(_[0],_[1],_[2],_[3]),h.multiplyQuaternions(c,h),s.applyQuaternion(h),u.lockY&&s.setY(0),u.getPosition(!1).add(s)}}u.network.onGamepadChanged&&u.network.onGamepadChanged(t,i,r),a.identity(),a.setPosition(u.getPosition()),a.multiplyMatrices(a,l),n.getInverse(a),o.set(v.leftViewMatrix),d.multiplyMatrices(o,n),f.getInverse(d),o.set(v.rightViewMatrix),m.multiplyMatrices(o,n),p.getInverse(m),g.set(v.leftProjectionMatrix),y.set(v.rightProjectionMatrix)}}}(),onPropertyChange:function(){this.updateProjectionMatrix()}}),se.CameraHelper=function(e){function i(e,t,i){r(e,i),r(t,i)}function r(e,i){a.vertices.push(new se.Vec3),a.colors.push(new se.Color(i)),o[e]===t&&(o[e]=[]),o[e].push(a.vertices.length-1)}var a=new se.Entity,n=new se.LineMaterial({color:16777215,vertexColors:se.FaceColors}),o={};i("n1","n2",16755200),i("n2","n4",16755200),i("n4","n3",16755200),i("n3","n1",16755200),i("f1","f2",16755200),i("f2","f4",16755200),i("f4","f3",16755200),i("f3","f1",16755200),i("n1","f1",16755200),i("n2","f2",16755200),i("n3","f3",16755200),i("n4","f4",16755200),i("p","n1",16711680),i("p","n2",16711680),i("p","n3",16711680),i("p","n4",16711680),i("u1","u2",43775),i("u2","u3",43775),i("u3","u1",43775),i("c","t",16777215),i("p","c",3355443),i("cn1","cn2",3355443),i("cn3","cn4",3355443),i("cf1","cf2",3355443),i("cf3","cf4",3355443),se.Line.call(this,a.vertices,a.colors,n,se.LinePieces),this.camera=e,this.worldMatrix=e.worldMatrix,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},se.CameraHelper.prototype=Object.create(se.Line.prototype),se.CameraHelper.prototype.update=function(){var e=new se.Vec3,i=new se.Camera,r=new se.Projector;return function(){function a(a,o,s,l){e.set(o,s,l),r.unprojectVector(e,i);var h=n.pointMap[a];if(h!==t)for(var c=0,u=h.length;c<u;c++)n.vertices[h[c]].copy(e)}var n=this;i.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-1,-1,-1),a("n2",1,-1,-1),a("n3",-1,1,-1),a("n4",1,1,-1),a("f1",-1,-1,1),a("f2",1,-1,1),a("f3",-1,1,1),a("f4",1,1,1),a("u1",.7,1.1,-1),a("u2",-.7,1.1,-1),a("u3",0,2,-1),a("cf1",-1,0,1),a("cf2",1,0,1),a("cf3",0,-1,1),a("cf4",0,1,1),a("cn1",-1,0,-1),a("cn2",1,0,-1),a("cn3",0,-1,-1),a("cn4",0,1,-1),this.verticesNeedUpdate=!0}}();var nt=function(){se.Element.call(this)};(nt.prototype=Object.create(se.Element.prototype)).updateworldMatrix=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this._parent?(this.worldMatrix.multiplyMatrices(this._parent.worldMatrix,this.matrix),this.worldMatrix.decompose(this.translationWorld,this.QuatWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.QuatObject,this.scaleObject),this.worldMatrix.compose(this.translationWorld,this.QuatObject,this.scaleWorld)):this.worldMatrix.copy(this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(var t=0,i=this.getChildren().size();t<i;t++)this.getChildren().get(t).updateworldMatrix(e)},nt.prototype.translationWorld=new se.Vec3,nt.prototype.translationObject=new se.Vec3,nt.prototype.QuatWorld=new se.Quat,nt.prototype.QuatObject=new se.Quat,nt.prototype.scaleWorld=new se.Vec3,nt.prototype.scaleObject=new se.Vec3;var ot=function(){function e(e,t){var i=new se.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,a=i.pointsFrustum,n=0;n<8;n++)r[n]=new se.Vec3,a[n]=new se.Vec3;var o=e.shadowCascadeNearZ[t],s=e.shadowCascadeFarZ[t];return a[0].set(-1,-1,o),a[1].set(1,-1,o),a[2].set(-1,1,o),a[3].set(1,1,o),a[4].set(-1,-1,s),a[5].set(1,-1,s),a[6].set(-1,1,s),a[7].set(1,1,s),i}function i(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t],n=i.pointsFrustum;n[0].z=r,n[1].z=r,n[2].z=r,n[3].z=r,n[4].z=a,n[5].z=a,n[6].z=a,n[7].z=a}function r(e,t){var i=t.shadowCamera,r=t.pointsFrustum,a=t.pointsWorld;p.set(1/0,1/0,1/0),d.set(-1/0,-1/0,-1/0);for(var n=0;n<8;n++){var o=a[n];o.copy(r[n]),ot.__projector.unprojectVector(o,e),o.applyMatrix4(i.worldMatrixInverse),o.x<p.x&&(p.x=o.x),o.x>d.x&&(d.x=o.x),o.y<p.y&&(p.y=o.y),o.y>d.y&&(d.y=o.y),o.z<p.z&&(p.z=o.z),o.z>d.z&&(d.z=o.z)}i.left=p.x,i.right=d.x,i.top=d.y,i.bottom=p.y,i.updateProjectionMatrix()}function a(e){return e.material instanceof se.ArrayMaterial?e.material.materials[0]:e.material}var n,o,s,l,h,c,u=new se.Frustum,f=new se.Mat4,p=new se.Vec3,d=new se.Vec3,m=new se.Vec3;this.init=function(e){n=e._gl,o=e;var t=se.ShaderLib.depthRGBA,i=se.UniformsUtils.clone(t.uniforms);s=new rt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),_depthCubeMaterial=new rt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,refreshUniformsCommon:function(e){this.uniforms.isCube.value=1,this.uniforms.nearDistance.value=this.nearDistance,this.uniforms.farDistance.value=this.farDistance,this.uniforms.referencePosition.value=this.referencePosition}}),l=new rt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),h=new rt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),c=new rt({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),s._shadowPass=!0,l._shadowPass=!0,h._shadowPass=!0,c._shadowPass=!0};var g=[new mono.Vec3(1,0,0),new mono.Vec3(-1,0,0),new mono.Vec3(0,0,1),new mono.Vec3(0,0,-1),new mono.Vec3(0,1,0),new mono.Vec3(0,-1,0)],y=[new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,1,0),new mono.Vec3(0,0,1),new mono.Vec3(0,0,-1)],v=[new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4,new mono.Vec4];this.dirty=!0,this.dirtyShadowMap=function(){this.dirty=!0},this.render=function(e,t){o._shadowMapEnable&&this.update(e,t)},this.handleDataPropertyChange=function(e){var t=e.source,i=e.property;(t.isSizeChangedProperty&&t.isSizeChangedProperty(i)||"parent"==i||t.isSpaceChangedProperty(i))&&this.dirtyShadowMap()},this.handleDataBoxChange=function(e){this.dirtyShadowMap()},this.update=function(p,d){if(this.dirty){this.dirty=!1;var x,A,_,w,b,M,S,P,C,T,E,z,D,L,R=[],N=0;n.clearColor(1,1,1,1),n.disable(n.BLEND),n.enable(n.CULL_FACE),n.frontFace(n.CCW),o.shadowMapCullFace===se.CullFaceFront?n.cullFace(n.FRONT):n.cullFace(n.BACK),o.setDepthTest(!0);var B=p.getLights();for(x=0,A=B.size();x<A;x++)if((D=B.get(x)).castShadow)if(D instanceof se.DirectionalLight&&D.shadowCascade)for(b=0;b<D.shadowCascadeCount;b++){var I;if(D.shadowCascadeArray[b])I=D.shadowCascadeArray[b];else{(I=e(D,b)).originalCamera=d;var F=new nt;F.position=D.shadowCascadeOffset,F.add(I),F.add(I.target),d.add(F),D.shadowCascadeArray[b]=I}i(D,b),R[N]=I,N++}else R[N]=D,N++;for(x=0,A=R.length;x<A;x++){var V=(D=R[x])instanceof se.PointLight,U=V?6:1;if(!D.shadowMap){var k=se.NearestFilter;o.shadowMapType===se.PCFSoftShadowMap&&(k=se.NearestFilter);var O={minFilter:k,magFilter:k,format:se.RGBAFormat},X=new mono.Vec2(D.shadowMapWidth,D.shadowMapHeight);if(V){var G=X.x,Y=X.y;v[0].set(2*G,Y,G,Y),v[1].set(0,Y,G,Y),v[2].set(3*G,Y,G,Y),v[3].set(G,Y,G,Y),v[4].set(3*G,0,G,Y),v[5].set(G,0,G,Y),X.x*=4,X.y*=2,D.shadowMap=new Re(X.x,X.y,O),D.shadowMapSize=new le(X.x,X.y),D.shadowMatrix=new se.Mat4}else D.shadowMap=new Re(D.shadowMapWidth,D.shadowMapHeight,O),D.shadowMapSize=new le(D.shadowMapWidth,D.shadowMapHeight),D.shadowMatrix=new se.Mat4}if(!D.shadowCamera){if(D instanceof se.SpotLight)D.shadowCamera=new se.PerspectiveCamera(D.shadowCameraFov,D.shadowMapWidth/D.shadowMapHeight,D.shadowCameraNear,D.shadowCameraFar);else if(D instanceof se.DirectionalLight)D.shadowCamera=new se.OrthoCamera(D.shadowCameraLeft,D.shadowMapWidth/D.shadowMapHeight,D.shadowCameraNear,D.shadowCameraFar);else{if(!(D instanceof se.PointLight)){console.error("Unsupported light type for shadow");continue}D.shadowCamera=new se.PerspectiveCamera(90,1,D.shadowCameraNear,D.shadowCameraFar)}D.shadowCamera.updateWorldMatrix();for(var W=p.getRoots(),j=W.size(),H=0;H<j;H++)W.get(H).updateWorldMatrix()}D.shadowCameraVisible&&!D.cameraHelper&&(D.cameraHelper=new se.CameraHelper(D.shadowCamera),D.shadowCamera.addChild(D.cameraHelper),D.shadowCamera.updateWorldMatrix(!0),o.helperBox.add(D.shadowCamera),o.helperBox.add(D.cameraHelper)),D.isVirtual&&I.originalCamera==d&&r(d,D);new he(1,0,0),new he(-1,0,0),new he(0,1,0),new he(0,-1,0),new he(0,0,1),new he(0,0,-1);M=D.shadowMap,S=D.shadowMatrix,P=D.shadowCamera,o.debugPointLight==t&&o.setRenderTarget(M),o.clear();for(N=0;N<U;N++)if(null==D.debugFace||N==D.debugFace){if(P._position.setFromMatrixPosition(D.worldMatrix),D.target?(m.setFromMatrixPosition(D.target.worldMatrix),P.lookAt(m),P.updateWorldMatrix(!0)):m=P.p().clone().add(g[N]),P.worldMatrixInverse.getInverse(P.worldMatrix),D.cameraHelper&&(D.cameraHelper.visible=D.shadowCameraVisible),D.shadowCameraVisible&&D.cameraHelper.update(),V){S.translate(P._position.clone().negate()),P.setUp(y[N]),P.lookAt(m),P.updateWorldMatrix(!0),P.setNear(D.shadowCameraNear),P.setFar(D.shadowCameraFar),_depthCubeMaterial.nearDistance=D.shadowCameraNear,_depthCubeMaterial.farDistance=D.shadowCameraFar,_depthCubeMaterial.referencePosition=P._position.clone();var q=v[N];P.worldMatrixInverse.getInverse(P.worldMatrix),o.setViewport(q.x,q.y,q.z,q.w)}else S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),S.multiply(P.projectionMatrix),S.multiply(P.worldMatrixInverse);for(f.multiplyMatrices(P.projectionMatrix,P.worldMatrixInverse),u.setFromMatrix(f),_=0,w=(L=o.glNodeList).length;_<w;_++)z=(E=L[_]).node,E.render=!1,z._visible&&z.castShadow&&((z instanceof se.Node||z instanceof se.Particle)&&z.frustumCulled&&!u.intersectsObject(z)||(z._modelViewMatrix.multiplyMatrices(P.worldMatrixInverse,z.worldMatrix),E.render=!0));var Z,Q;for(_=0,w=L.length;_<w;_++)(E=L[_]).render&&(z=E.node,C=E.group,a(z),Z=!1,Q=!1,T=z.customDepthMaterial?z.customDepthMaterial:Q?Z?c:h:Z?l:1==U?s:_depthCubeMaterial,z instanceof se.BufferNode||o.renderGroup(P,p.getLights(),T,C,z))}}var K=o.getClearColor(),J=o.getClearAlpha();n.clearColor(K.r,K.g,K.b,J),n.enable(n.BLEND),o.shadowMapCullFace===se.CullFaceFront&&n.cullFace(n.BACK)}}};ot.__projector=new se.Projector,se.Picking=function(e,t,i,r,a,n){this.network=n,this.origin=e,this.cameraUp=i,this.direction=t,this.near=r||0,this.far=a||1/0,this.ray=new se.Ray(e,t),this.ray.direction.length>0&&this.ray.direction.normalize()},se.Picking.testPlane=new se.Plane(1,1),se.Picking.prototype={constructor:se.Picking,precision:1e-4,linePrecision:2,matrixPosition:new se.Vec3,set:function(e,t){this.origin=e,this.direction=t,this.ray.set(e,t),this.ray.direction.length>0&&this.ray.direction.normalize()},intersectObject:function(e,t,i){var r=[];return!0===t&&K(e,this,r,i),Q(e,this,r,i),r.sort(Z),r},intersectObjects:function(e,t,i){e._as&&(e=e._as);for(var r=[],a=0,n=e.length;a<n;a++)Q(e[a],this,r,i,this.network),!0===t&&K(e[a],this,r,i,this.network);return r.sort(Z),r}};var st=new se.Ray,lt=new se.Mat4,ht=new se.math.Plane,ct=new se.Vec3,ut=new se.BoundingSphere,ft=function(e){arguments.length>0&&this.init(e)};ft.prototype.init=function(e){this.status=e,this.points=new Array},ft.prototype.appendPoint=function(e){this.points.push(e)},ft.prototype.appendPoints=function(e){this.points=this.points.concat(e)},ft.intersectShapes=function(e,t){var i,r=e.getIntersectionParams(),a=t.getIntersectionParams();if(null!=r&&null!=a)if("Path"==r.name)i=ft.intersectPathShape(e,t);else if("Path"==a.name)i=ft.intersectPathShape(t,e);else{var n,o;if(r.name<a.name?(n="intersect"+r.name+a.name,o=r.params.concat(a.params)):(n="intersect"+a.name+r.name,o=a.params.concat(r.params)),!(n in ft))throw new Error("Intersection not available: "+n);i=ft[n].apply(null,o)}else i=new ft("No Intersection");return i},ft.intersectPathShape=function(e,t){return e.intersectShape(t)},ft.intersectBezier2Bezier2=function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m=new ft("No Intersection");if(o=t.multiply(-2),l=e.add(o.add(i)),o=e.multiply(-2),s=t.multiply(2),h=o.add(s),c=new le(e.x,e.y),o=a.multiply(-2),u=r.add(o.add(n)),o=r.multiply(-2),s=a.multiply(2),f=o.add(s),p=new le(r.x,r.y),0==l.y){var g=(v=l.x*(c.y-p.y))+(x=v-h.x*h.y),y=h.y*h.y;d=new Polynomial(l.x*u.y*u.y,2*l.x*f.y*u.y,l.x*f.y*f.y-u.x*y-u.y*v-u.y*x,-f.x*y-f.y*v-f.y*x,(c.x-p.x)*y+(c.y-p.y)*x)}else{var v=l.x*u.y-l.y*u.x,x=l.x*f.y-f.x*l.y,g=h.x*l.y-h.y*l.x,y=c.y-p.y,A=l.y*(c.x-p.x)-l.x*y,_=-h.y*g+l.y*A,w=g*g;d=new Polynomial(v*v,2*v*x,(-u.y*w+l.y*x*x+l.y*v*A+v*_)/l.y,(-f.y*w+l.y*x*A+x*_)/l.y,(y*w+A*_)/l.y)}for(var b=d.getRoots(),M=0;M<b.length;M++){var S=b[M];if(0<=S&&S<=1){var P=new Polynomial(l.x,h.x,c.x-p.x-S*f.x-S*S*u.x).getRoots(),C=new Polynomial(l.y,h.y,c.y-p.y-S*f.y-S*S*u.y).getRoots();if(P.length>0&&C.length>0){e:for(var T=0;T<P.length;T++){var E=P[T];if(0<=E&&E<=1)for(var z=0;z<C.length;z++)if(Math.abs(E-C[z])<1e-4){m.points.push(u.multiply(S*S).add(f.multiply(S).add(p)));break e}}}}}return m.points.length>0&&(m.status="$Intersection"),m},ft.intersectBezier2Bezier3=function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m,g,y,v=new ft("No Intersection");s=t.multiply(-2),u=e.add(s.add(i)),s=e.multiply(-2),l=t.multiply(2),f=s.add(l),p=new le(e.x,e.y),s=r.multiply(-1),l=a.multiply(3),h=n.multiply(-3),c=s.add(l.add(h.add(o))),d=new Vector2D(c.x,c.y),s=r.multiply(3),l=a.multiply(-6),h=n.multiply(3),c=s.add(l.add(h)),m=new Vector2D(c.x,c.y),s=r.multiply(-3),l=a.multiply(3),h=s.add(l),g=new Vector2D(h.x,h.y),y=new Vector2D(r.x,r.y);for(var x=p.x*p.x,A=p.y*p.y,_=f.x*f.x,w=f.y*f.y,b=u.x*u.x,M=u.y*u.y,S=y.x*y.x,P=y.y*y.y,C=g.x*g.x,T=g.y*g.y,E=m.x*m.x,z=m.y*m.y,D=d.x*d.x,L=d.y*d.y,R=new Polynomial(-2*u.x*u.y*d.x*d.y+b*L+M*D,-2*u.x*u.y*m.x*d.y-2*u.x*u.y*m.y*d.x+2*M*m.x*d.x+2*b*m.y*d.y,-2*u.x*g.x*u.y*d.y-2*u.x*u.y*g.y*d.x-2*u.x*u.y*m.x*m.y+2*g.x*M*d.x+M*E+b*(2*g.y*d.y+z),2*p.x*u.x*u.y*d.y+2*p.y*u.x*u.y*d.x+f.x*f.y*u.x*d.y+f.x*f.y*u.y*d.x-2*y.x*u.x*u.y*d.y-2*u.x*y.y*u.y*d.x-2*u.x*g.x*u.y*m.y-2*u.x*u.y*g.y*m.x-2*p.x*M*d.x-2*p.y*b*d.y+2*y.x*M*d.x+2*g.x*M*m.x-w*u.x*d.x-_*u.y*d.y+b*(2*y.y*d.y+2*g.y*m.y),2*p.x*u.x*u.y*m.y+2*p.y*u.x*u.y*m.x+f.x*f.y*u.x*m.y+f.x*f.y*u.y*m.x-2*y.x*u.x*u.y*m.y-2*u.x*y.y*u.y*m.x-2*u.x*g.x*u.y*g.y-2*p.x*M*m.x-2*p.y*b*m.y+2*y.x*M*m.x-w*u.x*m.x-_*u.y*m.y+C*M+b*(2*y.y*m.y+T),2*p.x*u.x*u.y*g.y+2*p.y*u.x*g.x*u.y+f.x*f.y*u.x*g.y+f.x*f.y*g.x*u.y-2*y.x*u.x*u.y*g.y-2*u.x*y.y*g.x*u.y-2*p.x*g.x*M-2*p.y*b*g.y+2*y.x*g.x*M-w*u.x*g.x-_*u.y*g.y+2*b*y.y*g.y,-2*p.x*p.y*u.x*u.y-p.x*f.x*f.y*u.y-p.y*f.x*f.y*u.x+2*p.x*u.x*y.y*u.y+2*p.y*y.x*u.x*u.y+f.x*y.x*f.y*u.y+f.x*f.y*u.x*y.y-2*y.x*u.x*y.y*u.y-2*p.x*y.x*M+p.x*w*u.x+p.y*_*u.y-2*p.y*b*y.y-y.x*w*u.x-_*y.y*u.y+x*M+A*b+S*M+b*P).getRootsInInterval(0,1),N=0;N<R.length;N++){var B=R[N],I=new Polynomial(u.x,f.x,p.x-y.x-B*g.x-B*B*m.x-B*B*B*d.x).getRoots(),F=new Polynomial(u.y,f.y,p.y-y.y-B*g.y-B*B*m.y-B*B*B*d.y).getRoots();if(I.length>0&&F.length>0){e:for(var V=0;V<I.length;V++){var U=I[V];if(0<=U&&U<=1)for(var k=0;k<F.length;k++)if(Math.abs(U-F[k])<1e-4){v.points.push(d.multiply(B*B*B).add(m.multiply(B*B).add(g.multiply(B).add(y))));break e}}}}return v.points.length>0&&(v.status="Intersection"),v},ft.intersectBezier2Circle=function(e,t,i,r,a){return ft.intersectBezier2Ellipse(e,t,i,r,a,a)},ft.intersectBezier2Ellipse=function(e,t,i,r,a,n){var o,s,l,h,c,u=new ft("No Intersection");o=t.multiply(-2),l=e.add(o.add(i)),o=e.multiply(-2),s=t.multiply(2),h=o.add(s),c=new le(e.x,e.y);for(var f=a*a,p=n*n,d=new Polynomial(p*l.x*l.x+f*l.y*l.y,2*(p*l.x*h.x+f*l.y*h.y),p*(2*l.x*c.x+h.x*h.x)+f*(2*l.y*c.y+h.y*h.y)-2*(p*r.x*l.x+f*r.y*l.y),2*(p*h.x*(c.x-r.x)+f*h.y*(c.y-r.y)),p*(c.x*c.x+r.x*r.x)+f*(c.y*c.y+r.y*r.y)-2*(p*r.x*c.x+f*r.y*c.y)-f*p).getRoots(),m=0;m<d.length;m++){var g=d[m];0<=g&&g<=1&&u.points.push(l.multiply(g*g).add(h.multiply(g).add(c)))}return u.points.length>0&&(u.status="Intersection"),u},ft.intersectBezier2Line=function(e,t,i,r,a){var n,o,s,l,h,c,u,f=r.min(a),p=r.max(a),d=new ft("No Intersection");n=t.multiply(-2),s=e.add(n.add(i)),n=e.multiply(-2),o=t.multiply(2),l=n.add(o),h=new le(e.x,e.y),u=new Vector2D(r.y-a.y,a.x-r.x),c=r.x*a.y-a.x*r.y,roots=new Polynomial(u.dot(s),u.dot(l),u.dot(h)+c).getRoots();for(var m=0;m<roots.length;m++){var g=roots[m];if(0<=g&&g<=1){var y=e.lerp(t,g),v=t.lerp(i,g),x=y.lerp(v,g);r.x==a.x?f.y<=x.y&&x.y<=p.y&&(d.status="Intersection",d.appendPoint(x)):r.y==a.y?f.x<=x.x&&x.x<=p.x&&(d.status="Intersection",d.appendPoint(x)):x.gte(f)&&x.lte(p)&&(d.status="Intersection",d.appendPoint(x))}}return d},ft.intersectBezier2Polygon=function(e,t,i,r){for(var a=new ft("No Intersection"),n=r.length,o=0;o<n;o++){var s=r[o],l=r[(o+1)%n],h=ft.intersectBezier2Line(e,t,i,s,l);a.appendPoints(h.points)}return a.points.length>0&&(a.status="Intersection"),a},ft.intersectBezier2Rectangle=function(e,t,i,r,a){var n=r.min(a),o=r.max(a),s=new le(o.x,n.y),l=new le(n.x,o.y),h=ft.intersectBezier2Line(e,t,i,n,s),c=ft.intersectBezier2Line(e,t,i,s,o),u=ft.intersectBezier2Line(e,t,i,o,l),f=ft.intersectBezier2Line(e,t,i,l,n),p=new ft("No Intersection");return p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(u.points),p.appendPoints(f.points),p.points.length>0&&(p.status="Intersection"),p},ft.intersectBezier3Bezier3=function(e,t,i,r,a,n,o,s){var l,h,c,u,f,p,d,m,g,y,v,x,A=new ft("No Intersection");l=e.multiply(-1),h=t.multiply(3),c=i.multiply(-3),u=l.add(h.add(c.add(r))),f=new Vector2D(u.x,u.y),l=e.multiply(3),h=t.multiply(-6),c=i.multiply(3),u=l.add(h.add(c)),p=new Vector2D(u.x,u.y),l=e.multiply(-3),h=t.multiply(3),c=l.add(h),d=new Vector2D(c.x,c.y),m=new Vector2D(e.x,e.y),l=a.multiply(-1),h=n.multiply(3),c=o.multiply(-3),u=l.add(h.add(c.add(s))),g=new Vector2D(u.x,u.y),l=a.multiply(3),h=n.multiply(-6),c=o.multiply(3),u=l.add(h.add(c)),y=new Vector2D(u.x,u.y),l=a.multiply(-3),h=n.multiply(3),c=l.add(h),v=new Vector2D(c.x,c.y),x=new Vector2D(a.x,a.y);for(var _=m.x*m.x,w=m.x*m.x*m.x,b=m.y*m.y,M=m.y*m.y*m.y,S=d.x*d.x,P=d.x*d.x*d.x,C=d.y*d.y,T=d.y*d.y*d.y,E=p.x*p.x,z=p.x*p.x*p.x,D=p.y*p.y,L=p.y*p.y*p.y,R=f.x*f.x,N=f.x*f.x*f.x,B=f.y*f.y,I=f.y*f.y*f.y,F=x.x*x.x,V=x.x*x.x*x.x,U=x.y*x.y,k=x.y*x.y*x.y,O=v.x*v.x,X=v.x*v.x*v.x,G=v.y*v.y,Y=y.x*y.x,W=y.x*y.x*y.x,j=y.y*y.y,H=g.x*g.x,q=g.x*g.x*g.x,Z=g.y*g.y,Q=g.y*g.y*g.y,K=new Polynomial(-N*Q+I*q-3*f.x*B*H*g.y+3*R*f.y*g.x*Z,-6*f.x*y.x*B*g.x*g.y+6*R*f.y*y.y*g.x*g.y+3*y.x*I*H-3*N*y.y*Z-3*f.x*B*y.y*H+3*R*y.x*f.y*Z,-6*v.x*f.x*B*g.x*g.y-6*f.x*y.x*B*y.y*g.x+6*R*y.x*f.y*y.y*g.y+3*v.x*I*H+3*Y*I*g.x+3*v.x*R*f.y*Z-3*f.x*v.y*B*H-3*f.x*Y*B*g.y+R*f.y*g.x*(6*v.y*g.y+3*j)+N*(-v.y*Z-2*j*g.y-g.y*(2*v.y*g.y+j)),d.x*p.y*f.x*f.y*g.x*g.y-d.y*p.x*f.x*f.y*g.x*g.y+6*v.x*y.x*I*g.x+3*d.x*p.x*f.x*f.y*Z+6*m.x*f.x*B*g.x*g.y-3*d.x*p.x*B*g.x*g.y-3*d.y*p.y*f.x*f.y*H-6*m.y*R*f.y*g.x*g.y-6*x.x*f.x*B*g.x*g.y+3*d.y*p.y*R*g.x*g.y-2*p.x*D*f.x*g.x*g.y-6*v.x*f.x*y.x*B*g.y-6*v.x*f.x*B*y.y*g.x-6*f.x*v.y*y.x*B*g.x+6*v.x*R*f.y*y.y*g.y+2*E*p.y*f.y*g.x*g.y+W*I-3*m.x*I*H+3*m.y*N*Z+3*x.x*I*H+L*f.x*H-z*f.y*Z-3*m.x*R*f.y*Z+3*m.y*f.x*B*H-2*d.x*p.y*R*Z+d.x*p.y*B*H-d.y*p.x*R*Z+2*d.y*p.x*B*H+3*x.x*R*f.y*Z-p.x*D*f.y*H-3*x.y*f.x*B*H+E*p.y*f.x*Z-3*f.x*Y*B*y.y+R*f.y*g.x*(6*x.y*g.y+6*v.y*y.y)+R*y.x*f.y*(6*v.y*g.y+3*j)+N*(-2*v.y*y.y*g.y-x.y*Z-y.y*(2*v.y*g.y+j)-g.y*(2*x.y*g.y+2*v.y*y.y)),6*d.x*p.x*f.x*f.y*y.y*g.y+d.x*p.y*f.x*y.x*f.y*g.y+d.x*p.y*f.x*f.y*y.y*g.x-d.y*p.x*f.x*y.x*f.y*g.y-d.y*p.x*f.x*f.y*y.y*g.x-6*d.y*p.y*f.x*y.x*f.y*g.x-6*m.x*y.x*I*g.x+6*x.x*y.x*I*g.x+6*m.y*N*y.y*g.y+2*L*f.x*y.x*g.x-2*z*f.y*y.y*g.y+6*m.x*f.x*y.x*B*g.y+6*m.x*f.x*B*y.y*g.x+6*m.y*f.x*y.x*B*g.x-3*d.x*p.x*y.x*B*g.y-3*d.x*p.x*B*y.y*g.x+2*d.x*p.y*y.x*B*g.x+4*d.y*p.x*y.x*B*g.x-6*m.x*R*f.y*y.y*g.y-6*m.y*R*y.x*f.y*g.y-6*m.y*R*f.y*y.y*g.x-4*d.x*p.y*R*y.y*g.y-6*x.x*f.x*y.x*B*g.y-6*x.x*f.x*B*y.y*g.x-2*d.y*p.x*R*y.y*g.y+3*d.y*p.y*R*y.x*g.y+3*d.y*p.y*R*y.y*g.x-2*p.x*D*f.x*y.x*g.y-2*p.x*D*f.x*y.y*g.x-2*p.x*D*y.x*f.y*g.x-6*x.y*f.x*y.x*B*g.x-6*v.x*f.x*v.y*B*g.x-6*v.x*f.x*y.x*B*y.y+6*x.x*R*f.y*y.y*g.y+2*E*p.y*f.x*y.y*g.y+2*E*p.y*y.x*f.y*g.y+2*E*p.y*f.y*y.y*g.x+3*v.x*Y*I+3*O*I*g.x-3*f.x*v.y*Y*B-3*O*f.x*B*g.y+R*y.x*f.y*(6*x.y*g.y+6*v.y*y.y)+R*f.y*g.x*(6*x.y*y.y+3*G)+v.x*R*f.y*(6*v.y*g.y+3*j)+N*(-2*x.y*y.y*g.y-g.y*(2*x.y*y.y+G)-v.y*(2*v.y*g.y+j)-y.y*(2*x.y*g.y+2*v.y*y.y)),d.x*v.x*p.y*f.x*f.y*g.y+d.x*p.y*f.x*v.y*f.y*g.x+d.x*p.y*f.x*y.x*f.y*y.y-d.y*p.x*v.x*f.x*f.y*g.y-d.y*p.x*f.x*v.y*f.y*g.x-d.y*p.x*f.x*y.x*f.y*y.y-6*d.y*v.x*p.y*f.x*f.y*g.x-6*m.x*v.x*I*g.x+6*x.x*v.x*I*g.x+2*v.x*L*f.x*g.x+6*m.x*v.x*f.x*B*g.y+6*m.x*f.x*v.y*B*g.x+6*m.x*f.x*y.x*B*y.y+6*m.y*v.x*f.x*B*g.x-3*d.x*p.x*v.x*B*g.y-3*d.x*p.x*v.y*B*g.x-3*d.x*p.x*y.x*B*y.y+2*d.x*v.x*p.y*B*g.x+4*d.y*p.x*v.x*B*g.x-6*m.y*v.x*R*f.y*g.y-6*m.y*R*v.y*f.y*g.x-6*m.y*R*y.x*f.y*y.y-6*x.x*v.x*f.x*B*g.y-6*x.x*f.x*v.y*B*g.x-6*x.x*f.x*y.x*B*y.y+3*d.y*v.x*p.y*R*g.y-3*d.y*p.y*f.x*Y*f.y+3*d.y*p.y*R*v.y*g.x+3*d.y*p.y*R*y.x*y.y-2*p.x*v.x*D*f.x*g.y-2*p.x*v.x*D*f.y*g.x-2*p.x*D*f.x*v.y*g.x-2*p.x*D*f.x*y.x*y.y-6*x.y*v.x*f.x*B*g.x-6*v.x*f.x*v.y*y.x*B+6*x.y*R*v.y*f.y*g.x+2*E*v.x*p.y*f.y*g.y+2*E*p.y*v.y*f.y*g.x+2*E*p.y*y.x*f.y*y.y-3*m.x*Y*I+3*x.x*Y*I+3*O*y.x*I+L*f.x*Y+3*m.y*f.x*Y*B+d.x*p.y*Y*B+2*d.y*p.x*Y*B-p.x*D*Y*f.y-3*x.y*f.x*Y*B-3*O*f.x*B*y.y+E*p.y*f.x*(2*v.y*g.y+j)+d.x*p.x*f.x*f.y*(6*v.y*g.y+3*j)+v.x*R*f.y*(6*x.y*g.y+6*v.y*y.y)+z*f.y*(-2*v.y*g.y-j)+m.y*N*(6*v.y*g.y+3*j)+d.y*p.x*R*(-2*v.y*g.y-j)+d.x*p.y*R*(-4*v.y*g.y-2*j)+m.x*R*f.y*(-6*v.y*g.y-3*j)+R*y.x*f.y*(6*x.y*y.y+3*G)+x.x*R*f.y*(6*v.y*g.y+3*j)+N*(-2*x.y*v.y*g.y-y.y*(2*x.y*y.y+G)-x.y*(2*v.y*g.y+j)-v.y*(2*x.y*g.y+2*v.y*y.y)),-m.x*d.x*p.y*f.x*f.y*g.y+m.x*d.y*p.x*f.x*f.y*g.y+6*m.x*d.y*p.y*f.x*f.y*g.x-6*m.y*d.x*p.x*f.x*f.y*g.y-m.y*d.x*p.y*f.x*f.y*g.x+m.y*d.y*p.x*f.x*f.y*g.x+d.x*d.y*p.x*p.y*f.x*g.y-d.x*d.y*p.x*p.y*f.y*g.x+d.x*x.x*p.y*f.x*f.y*g.y+d.x*x.y*p.y*f.x*f.y*g.x+d.x*v.x*p.y*f.x*f.y*y.y+d.x*p.y*f.x*v.y*y.x*f.y-x.x*d.y*p.x*f.x*f.y*g.y-6*x.x*d.y*p.y*f.x*f.y*g.x-d.y*p.x*x.y*f.x*f.y*g.x-d.y*p.x*v.x*f.x*f.y*y.y-d.y*p.x*f.x*v.y*y.x*f.y-6*d.y*v.x*p.y*f.x*y.x*f.y-6*m.x*x.x*I*g.x-6*m.x*v.x*y.x*I-2*m.x*L*f.x*g.x+6*x.x*v.x*y.x*I+2*x.x*L*f.x*g.x+2*v.x*L*f.x*y.x+2*m.y*z*f.y*g.y-6*m.x*m.y*f.x*B*g.x+3*m.x*d.x*p.x*B*g.y-2*m.x*d.x*p.y*B*g.x-4*m.x*d.y*p.x*B*g.x+3*m.y*d.x*p.x*B*g.x+6*m.x*m.y*R*f.y*g.y+6*m.x*x.x*f.x*B*g.y-3*m.x*d.y*p.y*R*g.y+2*m.x*p.x*D*f.x*g.y+2*m.x*p.x*D*f.y*g.x+6*m.x*x.y*f.x*B*g.x+6*m.x*v.x*f.x*B*y.y+6*m.x*f.x*v.y*y.x*B+4*m.y*d.x*p.y*R*g.y+6*m.y*x.x*f.x*B*g.x+2*m.y*d.y*p.x*R*g.y-3*m.y*d.y*p.y*R*g.x+2*m.y*p.x*D*f.x*g.x+6*m.y*v.x*f.x*y.x*B-3*d.x*x.x*p.x*B*g.y+2*d.x*x.x*p.y*B*g.x+d.x*d.y*D*f.x*g.x-3*d.x*p.x*x.y*B*g.x-3*d.x*p.x*v.x*B*y.y-3*d.x*p.x*v.y*y.x*B+2*d.x*v.x*p.y*y.x*B+4*x.x*d.y*p.x*B*g.x+4*d.y*p.x*v.x*y.x*B-2*m.x*E*p.y*f.y*g.y-6*m.y*x.x*R*f.y*g.y-6*m.y*x.y*R*f.y*g.x-6*m.y*v.x*R*f.y*y.y-2*m.y*E*p.y*f.x*g.y-2*m.y*E*p.y*f.y*g.x-6*m.y*R*v.y*y.x*f.y-d.x*d.y*E*f.y*g.y-2*d.x*C*f.x*f.y*g.x+3*x.x*d.y*p.y*R*g.y-2*x.x*p.x*D*f.x*g.y-2*x.x*p.x*D*f.y*g.x-6*x.x*x.y*f.x*B*g.x-6*x.x*v.x*f.x*B*y.y-6*x.x*f.x*v.y*y.x*B+3*d.y*x.y*p.y*R*g.x+3*d.y*v.x*p.y*R*y.y+3*d.y*p.y*R*v.y*y.x-2*p.x*x.y*D*f.x*g.x-2*p.x*v.x*D*f.x*y.y-2*p.x*v.x*D*y.x*f.y-2*p.x*D*f.x*v.y*y.x-6*x.y*v.x*f.x*y.x*B-C*p.x*p.y*f.x*g.x+2*x.x*E*p.y*f.y*g.y+6*x.y*R*v.y*y.x*f.y+2*S*d.y*f.x*f.y*g.y+S*p.x*p.y*f.y*g.y+2*E*x.y*p.y*f.y*g.x+2*E*v.x*p.y*f.y*y.y+2*E*p.y*v.y*y.x*f.y+X*I+3*_*I*g.x-3*b*N*g.y+3*F*I*g.x+T*R*g.x-P*B*g.y-d.x*C*R*g.y+S*d.y*B*g.x-3*_*f.x*B*g.y+3*b*R*f.y*g.x-S*D*f.x*g.y+C*E*f.y*g.x-3*O*f.x*v.y*B-3*F*f.x*B*g.y+3*U*R*f.y*g.x+d.x*p.x*f.x*f.y*(6*x.y*g.y+6*v.y*y.y)+z*f.y*(-2*x.y*g.y-2*v.y*y.y)+m.y*N*(6*x.y*g.y+6*v.y*y.y)+d.y*p.x*R*(-2*x.y*g.y-2*v.y*y.y)+E*p.y*f.x*(2*x.y*g.y+2*v.y*y.y)+d.x*p.y*R*(-4*x.y*g.y-4*v.y*y.y)+m.x*R*f.y*(-6*x.y*g.y-6*v.y*y.y)+x.x*R*f.y*(6*x.y*g.y+6*v.y*y.y)+v.x*R*f.y*(6*x.y*y.y+3*G)+N*(-2*x.y*v.y*y.y-U*g.y-v.y*(2*x.y*y.y+G)-x.y*(2*x.y*g.y+2*v.y*y.y)),-m.x*d.x*p.y*f.x*f.y*y.y+m.x*d.y*p.x*f.x*f.y*y.y+6*m.x*d.y*p.y*f.x*y.x*f.y-6*m.y*d.x*p.x*f.x*f.y*y.y-m.y*d.x*p.y*f.x*y.x*f.y+m.y*d.y*p.x*f.x*y.x*f.y+d.x*d.y*p.x*p.y*f.x*y.y-d.x*d.y*p.x*p.y*y.x*f.y+d.x*x.x*p.y*f.x*f.y*y.y+d.x*x.y*p.y*f.x*y.x*f.y+d.x*v.x*p.y*f.x*v.y*f.y-x.x*d.y*p.x*f.x*f.y*y.y-6*x.x*d.y*p.y*f.x*y.x*f.y-d.y*p.x*x.y*f.x*y.x*f.y-d.y*p.x*v.x*f.x*v.y*f.y-6*m.x*x.x*y.x*I-2*m.x*L*f.x*y.x+2*x.x*L*f.x*y.x+2*m.y*z*f.y*y.y-6*m.x*m.y*f.x*y.x*B+3*m.x*d.x*p.x*B*y.y-2*m.x*d.x*p.y*y.x*B-4*m.x*d.y*p.x*y.x*B+3*m.y*d.x*p.x*y.x*B+6*m.x*m.y*R*f.y*y.y+6*m.x*x.x*f.x*B*y.y-3*m.x*d.y*p.y*R*y.y+2*m.x*p.x*D*f.x*y.y+2*m.x*p.x*D*y.x*f.y+6*m.x*x.y*f.x*y.x*B+6*m.x*v.x*f.x*v.y*B+4*m.y*d.x*p.y*R*y.y+6*m.y*x.x*f.x*y.x*B+2*m.y*d.y*p.x*R*y.y-3*m.y*d.y*p.y*R*y.x+2*m.y*p.x*D*f.x*y.x-3*d.x*x.x*p.x*B*y.y+2*d.x*x.x*p.y*y.x*B+d.x*d.y*D*f.x*y.x-3*d.x*p.x*x.y*y.x*B-3*d.x*p.x*v.x*v.y*B+4*x.x*d.y*p.x*y.x*B-2*m.x*E*p.y*f.y*y.y-6*m.y*x.x*R*f.y*y.y-6*m.y*x.y*R*y.x*f.y-6*m.y*v.x*R*v.y*f.y-2*m.y*E*p.y*f.x*y.y-2*m.y*E*p.y*y.x*f.y-d.x*d.y*E*f.y*y.y-2*d.x*C*f.x*y.x*f.y+3*x.x*d.y*p.y*R*y.y-2*x.x*p.x*D*f.x*y.y-2*x.x*p.x*D*y.x*f.y-6*x.x*x.y*f.x*y.x*B-6*x.x*v.x*f.x*v.y*B+3*d.y*x.y*p.y*R*y.x+3*d.y*v.x*p.y*R*v.y-2*p.x*x.y*D*f.x*y.x-2*p.x*v.x*D*f.x*v.y-C*p.x*p.y*f.x*y.x+2*x.x*E*p.y*f.y*y.y-3*d.y*O*p.y*f.x*f.y+6*x.y*v.x*R*v.y*f.y+2*S*d.y*f.x*f.y*y.y+S*p.x*p.y*f.y*y.y+2*E*x.y*p.y*y.x*f.y+2*E*v.x*p.y*v.y*f.y-3*m.x*O*I+3*x.x*O*I+3*_*y.x*I-3*b*N*y.y+3*F*y.x*I+O*L*f.x+T*R*y.x-P*B*y.y+3*m.y*O*f.x*B-d.x*C*R*y.y+d.x*O*p.y*B+2*d.y*p.x*O*B+S*d.y*y.x*B-p.x*O*D*f.y-3*x.y*O*f.x*B-3*_*f.x*B*y.y+3*b*R*y.x*f.y-S*D*f.x*y.y+C*E*y.x*f.y-3*F*f.x*B*y.y+3*U*R*y.x*f.y+E*p.y*f.x*(2*x.y*y.y+G)+d.x*p.x*f.x*f.y*(6*x.y*y.y+3*G)+z*f.y*(-2*x.y*y.y-G)+m.y*N*(6*x.y*y.y+3*G)+d.y*p.x*R*(-2*x.y*y.y-G)+d.x*p.y*R*(-4*x.y*y.y-2*G)+m.x*R*f.y*(-6*x.y*y.y-3*G)+x.x*R*f.y*(6*x.y*y.y+3*G)+N*(-2*x.y*G-U*y.y-x.y*(2*x.y*y.y+G)),-m.x*d.x*p.y*f.x*v.y*f.y+m.x*d.y*p.x*f.x*v.y*f.y+6*m.x*d.y*v.x*p.y*f.x*f.y-6*m.y*d.x*p.x*f.x*v.y*f.y-m.y*d.x*v.x*p.y*f.x*f.y+m.y*d.y*p.x*v.x*f.x*f.y-d.x*d.y*p.x*v.x*p.y*f.y+d.x*d.y*p.x*p.y*f.x*v.y+d.x*x.x*p.y*f.x*v.y*f.y+6*d.x*p.x*x.y*f.x*v.y*f.y+d.x*x.y*v.x*p.y*f.x*f.y-x.x*d.y*p.x*f.x*v.y*f.y-6*x.x*d.y*v.x*p.y*f.x*f.y-d.y*p.x*x.y*v.x*f.x*f.y-6*m.x*x.x*v.x*I-2*m.x*v.x*L*f.x+6*m.y*x.y*N*v.y+2*x.x*v.x*L*f.x+2*m.y*z*v.y*f.y-2*z*x.y*v.y*f.y-6*m.x*m.y*v.x*f.x*B+3*m.x*d.x*p.x*v.y*B-2*m.x*d.x*v.x*p.y*B-4*m.x*d.y*p.x*v.x*B+3*m.y*d.x*p.x*v.x*B+6*m.x*m.y*R*v.y*f.y+6*m.x*x.x*f.x*v.y*B-3*m.x*d.y*p.y*R*v.y+2*m.x*p.x*v.x*D*f.y+2*m.x*p.x*D*f.x*v.y+6*m.x*x.y*v.x*f.x*B+4*m.y*d.x*p.y*R*v.y+6*m.y*x.x*v.x*f.x*B+2*m.y*d.y*p.x*R*v.y-3*m.y*d.y*v.x*p.y*R+2*m.y*p.x*v.x*D*f.x-3*d.x*x.x*p.x*v.y*B+2*d.x*x.x*v.x*p.y*B+d.x*d.y*v.x*D*f.x-3*d.x*p.x*x.y*v.x*B+4*x.x*d.y*p.x*v.x*B-6*m.x*x.y*R*v.y*f.y-2*m.x*E*p.y*v.y*f.y-6*m.y*x.x*R*v.y*f.y-6*m.y*x.y*v.x*R*f.y-2*m.y*E*v.x*p.y*f.y-2*m.y*E*p.y*f.x*v.y-d.x*d.y*E*v.y*f.y-4*d.x*x.y*p.y*R*v.y-2*d.x*C*v.x*f.x*f.y+3*x.x*d.y*p.y*R*v.y-2*x.x*p.x*v.x*D*f.y-2*x.x*p.x*D*f.x*v.y-6*x.x*x.y*v.x*f.x*B-2*d.y*p.x*x.y*R*v.y+3*d.y*x.y*v.x*p.y*R-2*p.x*x.y*v.x*D*f.x-C*p.x*v.x*p.y*f.x+6*x.x*x.y*R*v.y*f.y+2*x.x*E*p.y*v.y*f.y+2*S*d.y*f.x*v.y*f.y+S*p.x*p.y*v.y*f.y+2*E*x.y*v.x*p.y*f.y+2*E*x.y*p.y*f.x*v.y+3*_*v.x*I-3*b*N*v.y+3*F*v.x*I+T*v.x*R-P*v.y*B-3*U*N*v.y-d.x*C*R*v.y+S*d.y*v.x*B-3*_*f.x*v.y*B+3*b*v.x*R*f.y-S*D*f.x*v.y+C*E*v.x*f.y-3*F*f.x*v.y*B+3*U*v.x*R*f.y,m.x*m.y*d.x*p.y*f.x*f.y-m.x*m.y*d.y*p.x*f.x*f.y+m.x*d.x*d.y*p.x*p.y*f.y-m.y*d.x*d.y*p.x*p.y*f.x-m.x*d.x*x.y*p.y*f.x*f.y+6*m.x*x.x*d.y*p.y*f.x*f.y+m.x*d.y*p.x*x.y*f.x*f.y-m.y*d.x*x.x*p.y*f.x*f.y-6*m.y*d.x*p.x*x.y*f.x*f.y+m.y*x.x*d.y*p.x*f.x*f.y-d.x*x.x*d.y*p.x*p.y*f.y+d.x*d.y*p.x*x.y*p.y*f.x+d.x*x.x*x.y*p.y*f.x*f.y-x.x*d.y*p.x*x.y*f.x*f.y-2*m.x*x.x*L*f.x+2*m.y*z*x.y*f.y-3*m.x*m.y*d.x*p.x*B-6*m.x*m.y*x.x*f.x*B+3*m.x*m.y*d.y*p.y*R-2*m.x*m.y*p.x*D*f.x-2*m.x*d.x*x.x*p.y*B-m.x*d.x*d.y*D*f.x+3*m.x*d.x*p.x*x.y*B-4*m.x*x.x*d.y*p.x*B+3*m.y*d.x*x.x*p.x*B+6*m.x*m.y*x.y*R*f.y+2*m.x*m.y*E*p.y*f.y+2*m.x*d.x*C*f.x*f.y+2*m.x*x.x*p.x*D*f.y+6*m.x*x.x*x.y*f.x*B-3*m.x*d.y*x.y*p.y*R+2*m.x*p.x*x.y*D*f.x+m.x*C*p.x*p.y*f.x+m.y*d.x*d.y*E*f.y+4*m.y*d.x*x.y*p.y*R-3*m.y*x.x*d.y*p.y*R+2*m.y*x.x*p.x*D*f.x+2*m.y*d.y*p.x*x.y*R+d.x*x.x*d.y*D*f.x-3*d.x*x.x*p.x*x.y*B-2*m.x*E*x.y*p.y*f.y-6*m.y*x.x*x.y*R*f.y-2*m.y*x.x*E*p.y*f.y-2*m.y*S*d.y*f.x*f.y-m.y*S*p.x*p.y*f.y-2*m.y*E*x.y*p.y*f.x-2*d.x*x.x*C*f.x*f.y-d.x*d.y*E*x.y*f.y+3*x.x*d.y*x.y*p.y*R-2*x.x*p.x*x.y*D*f.x-x.x*C*p.x*p.y*f.x+3*b*d.x*p.x*f.x*f.y+3*d.x*p.x*U*f.x*f.y+2*x.x*E*x.y*p.y*f.y-3*_*d.y*p.y*f.x*f.y+2*S*d.y*x.y*f.x*f.y+S*p.x*x.y*p.y*f.y-3*F*d.y*p.y*f.x*f.y-w*I+M*N+V*I-k*N-3*m.x*F*I-m.x*T*R+3*_*x.x*I+m.y*P*B+3*m.y*U*N+x.x*T*R+_*L*f.x-3*b*x.y*N-b*z*f.y+F*L*f.x-P*x.y*B-z*U*f.y-m.x*S*d.y*B+m.y*d.x*C*R-3*m.x*b*R*f.y-m.x*C*E*f.y+m.y*S*D*f.x-d.x*C*x.y*R+3*_*m.y*f.x*B+_*d.x*p.y*B+2*_*d.y*p.x*B-2*b*d.x*p.y*R-b*d.y*p.x*R+S*x.x*d.y*B-3*m.x*U*R*f.y+3*m.y*F*f.x*B+d.x*F*p.y*B-2*d.x*U*p.y*R+x.x*C*E*f.y-d.y*p.x*U*R-_*p.x*D*f.y-3*_*x.y*f.x*B+3*b*x.x*R*f.y+b*E*p.y*f.x-S*x.y*D*f.x+2*F*d.y*p.x*B+3*x.x*U*R*f.y-F*p.x*D*f.y-3*F*x.y*f.x*B+E*U*p.y*f.x).getRootsInInterval(0,1),J=0;J<K.length;J++){var $=K[J],ee=new Polynomial(f.x,p.x,d.x,m.x-x.x-$*v.x-$*$*y.x-$*$*$*g.x).getRoots(),te=new Polynomial(f.y,p.y,d.y,m.y-x.y-$*v.y-$*$*y.y-$*$*$*g.y).getRoots();if(ee.length>0&&te.length>0){e:for(var ie=0;ie<ee.length;ie++){var re=ee[ie];if(0<=re&&re<=1)for(var ae=0;ae<te.length;ae++)if(Math.abs(re-te[ae])<1e-4){A.points.push(g.multiply($*$*$).add(y.multiply($*$).add(v.multiply($).add(x))));break e}}}}return A.points.length>0&&(A.status="Intersection"),A},ft.intersectBezier3Circle=function(e,t,i,r,a,n){return ft.intersectBezier3Ellipse(e,t,i,r,a,n,n)},ft.intersectBezier3Ellipse=function(e,t,i,r,a,n,o){var s,l,h,c,u,f,p,d,m=new ft("No Intersection");s=e.multiply(-1),l=t.multiply(3),h=i.multiply(-3),c=s.add(l.add(h.add(r))),u=new Vector2D(c.x,c.y),s=e.multiply(3),l=t.multiply(-6),h=i.multiply(3),c=s.add(l.add(h)),f=new Vector2D(c.x,c.y),s=e.multiply(-3),l=t.multiply(3),h=s.add(l),p=new Vector2D(h.x,h.y),d=new Vector2D(e.x,e.y);for(var g=n*n,y=o*o,v=new Polynomial(u.x*u.x*y+u.y*u.y*g,2*(u.x*f.x*y+u.y*f.y*g),2*(u.x*p.x*y+u.y*p.y*g)+f.x*f.x*y+f.y*f.y*g,2*u.x*y*(d.x-a.x)+2*u.y*g*(d.y-a.y)+2*(f.x*p.x*y+f.y*p.y*g),2*f.x*y*(d.x-a.x)+2*f.y*g*(d.y-a.y)+p.x*p.x*y+p.y*p.y*g,2*p.x*y*(d.x-a.x)+2*p.y*g*(d.y-a.y),d.x*d.x*y-2*d.y*a.y*g-2*d.x*a.x*y+d.y*d.y*g+a.x*a.x*y+a.y*a.y*g-g*y).getRootsInInterval(0,1),x=0;x<v.length;x++){var A=v[x];m.points.push(u.multiply(A*A*A).add(f.multiply(A*A).add(p.multiply(A).add(d))))}return m.points.length>0&&(m.status="Intersection"),m},ft.intersectBezier3Line=function(e,t,i,r,a,n){var o,s,l,h,c,u,f,p,d,m,g=a.min(n),y=a.max(n),v=new ft("No Intersection");o=e.multiply(-1),s=t.multiply(3),l=i.multiply(-3),h=o.add(s.add(l.add(r))),c=new Vector2D(h.x,h.y),o=e.multiply(3),s=t.multiply(-6),l=i.multiply(3),h=o.add(s.add(l)),u=new Vector2D(h.x,h.y),o=e.multiply(-3),s=t.multiply(3),l=o.add(s),f=new Vector2D(l.x,l.y),p=new Vector2D(e.x,e.y),m=new Vector2D(a.y-n.y,n.x-a.x),d=a.x*n.y-n.x*a.y,roots=new Polynomial(m.dot(c),m.dot(u),m.dot(f),m.dot(p)+d).getRoots();for(var x=0;x<roots.length;x++){var A=roots[x];if(0<=A&&A<=1){var _=e.lerp(t,A),w=t.lerp(i,A),b=i.lerp(r,A),M=_.lerp(w,A),S=w.lerp(b,A),P=M.lerp(S,A);a.x==n.x?g.y<=P.y&&P.y<=y.y&&(v.status="Intersection",v.appendPoint(P)):a.y==n.y?g.x<=P.x&&P.x<=y.x&&(v.status="Intersection",v.appendPoint(P)):P.gte(g)&&P.lte(y)&&(v.status="Intersection",v.appendPoint(P))}}return v},ft.intersectBezier3Polygon=function(e,t,i,r,a){for(var n=new ft("No Intersection"),o=a.length,s=0;s<o;s++){var l=a[s],h=a[(s+1)%o],c=ft.intersectBezier3Line(e,t,i,r,l,h);n.appendPoints(c.points)}return n.points.length>0&&(n.status="Intersection"),n},ft.intersectBezier3Rectangle=function(e,t,i,r,a,n){var o=a.min(n),s=a.max(n),l=new le(s.x,o.y),h=new le(o.x,s.y),c=ft.intersectBezier3Line(e,t,i,r,o,l),u=ft.intersectBezier3Line(e,t,i,r,l,s),f=ft.intersectBezier3Line(e,t,i,r,s,h),p=ft.intersectBezier3Line(e,t,i,r,h,o),d=new ft("No Intersection");return d.appendPoints(c.points),d.appendPoints(u.points),d.appendPoints(f.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d},ft.intersectCircleCircle=function(e,t,i,r){var a,n=t+r,o=Math.abs(t-r),s=e.distanceFrom(i);if(s>n)a=new ft("Outside");else if(s<o)a=new ft("Inside");else{a=new ft("Intersection");var l=(t*t-r*r+s*s)/(2*s),h=Math.sqrt(t*t-l*l),c=e.lerp(i,l/s),u=h/s;a.points.push(new le(c.x-u*(i.y-e.y),c.y+u*(i.x-e.x))),a.points.push(new le(c.x+u*(i.y-e.y),c.y-u*(i.x-e.x)))}return a},ft.intersectCircleEllipse=function(e,t,i,r,a){return ft.intersectEllipseEllipse(e,t,t,i,r,a)},ft.intersectCircleLine=function(e,t,i,r){var a,n=(r.x-i.x)*(r.x-i.x)+(r.y-i.y)*(r.y-i.y),o=2*((r.x-i.x)*(i.x-e.x)+(r.y-i.y)*(i.y-e.y)),s=o*o-4*n*(e.x*e.x+e.y*e.y+i.x*i.x+i.y*i.y-2*(e.x*i.x+e.y*i.y)-t*t);if(s<0)a=new ft("Outside");else if(0==s)a=new ft("Tangent");else{var l=Math.sqrt(s),h=(-o+l)/(2*n),c=(-o-l)/(2*n);(h<0||h>1)&&(c<0||c>1)?a=new ft(h<0&&c<0||h>1&&c>1?"Outside":"Inside"):(a=new ft("Intersection"),0<=h&&h<=1&&a.points.push(i.lerp(r,h)),0<=c&&c<=1&&a.points.push(i.lerp(r,c)))}return a},ft.intersectCirclePolygon=function(e,t,i){for(var r,a=new ft("No Intersection"),n=i.length,o=0;o<n;o++){var s=i[o],l=i[(o+1)%n];r=ft.intersectCircleLine(e,t,s,l),a.appendPoints(r.points)}return a.points.length>0?a.status="Intersection":a.status=r.status,a},ft.intersectCircleRectangle=function(e,t,i,r){var a=i.min(r),n=i.max(r),o=new le(n.x,a.y),s=new le(a.x,n.y),l=ft.intersectCircleLine(e,t,a,o),h=ft.intersectCircleLine(e,t,o,n),c=ft.intersectCircleLine(e,t,n,s),u=ft.intersectCircleLine(e,t,s,a),f=new ft("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),f.points.length>0?f.status="Intersection":f.status=l.status,f},ft.intersectEllipseEllipse=function(e,t,i,r,a,n){for(var o=[i*i,0,t*t,-2*i*i*e.x,-2*t*t*e.y,i*i*e.x*e.x+t*t*e.y*e.y-t*t*i*i],s=[n*n,0,a*a,-2*n*n*r.x,-2*a*a*r.y,n*n*r.x*r.x+a*a*r.y*r.y-a*a*n*n],l=ft.bezout(o,s).getRoots(),h=.001*(o[0]*o[0]+2*o[1]*o[1]+o[2]*o[2]),c=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),u=new ft("No Intersection"),f=0;f<l.length;f++)for(var p=new Polynomial(o[0],o[3]+l[f]*o[1],o[5]+l[f]*(o[4]+l[f]*o[2])).getRoots(),d=0;d<p.length;d++){var m=(o[0]*p[d]+o[1]*l[f]+o[3])*p[d]+(o[2]*l[f]+o[4])*l[f]+o[5];Math.abs(m)<h&&(m=(s[0]*p[d]+s[1]*l[f]+s[3])*p[d]+(s[2]*l[f]+s[4])*l[f]+s[5],Math.abs(m)<c&&u.appendPoint(new le(p[d],l[f])))}return u.points.length>0&&(u.status="Intersection"),u},ft.intersectEllipseLine=function(e,t,i,r,a){var n,o=new Vector2D(r.x,r.y),s=Vector2D.fromPoints(r,a),l=new Vector2D(e.x,e.y),h=o.subtract(l),c=new Vector2D(s.x/(t*t),s.y/(i*i)),u=new Vector2D(h.x/(t*t),h.y/(i*i)),f=s.dot(c),p=s.dot(u),d=p*p-f*(e=h.dot(u)-1);if(d<0)n=new ft("Outside");else if(d>0){var m=Math.sqrt(d),g=(-p-m)/f,y=(-p+m)/f;(g<0||1<g)&&(y<0||1<y)?n=new ft(g<0&&y<0||g>1&&y>1?"Outside":"Inside"):(n=new ft("Intersection"),0<=g&&g<=1&&n.appendPoint(r.lerp(a,g)),0<=y&&y<=1&&n.appendPoint(r.lerp(a,y)))}else{var v=-p/f;0<=v&&v<=1?(n=new ft("Intersection")).appendPoint(r.lerp(a,v)):n=new ft("Outside")}return n},ft.intersectEllipsePolygon=function(e,t,i,r){for(var a=new ft("No Intersection"),n=r.length,o=0;o<n;o++){var s=r[o],l=r[(o+1)%n],h=ft.intersectEllipseLine(e,t,i,s,l);a.appendPoints(h.points)}return a.points.length>0&&(a.status="Intersection"),a},ft.intersectEllipseRectangle=function(e,t,i,r,a){var n=r.min(a),o=r.max(a),s=new le(o.x,n.y),l=new le(n.x,o.y),h=ft.intersectEllipseLine(e,t,i,n,s),c=ft.intersectEllipseLine(e,t,i,s,o),u=ft.intersectEllipseLine(e,t,i,o,l),f=ft.intersectEllipseLine(e,t,i,l,n),p=new ft("No Intersection");return p.appendPoints(h.points),p.appendPoints(c.points),p.appendPoints(u.points),p.appendPoints(f.points),p.points.length>0&&(p.status="Intersection"),p},ft.intersectLineLine=function(e,t,i,r){var a,n=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x),o=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x),s=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y);if(0!=s){var l=n/s,h=o/s;0<=l&&l<=1&&0<=h&&h<=1?(a=new ft("Intersection")).points.push(new le(e.x+l*(t.x-e.x),e.y+l*(t.y-e.y))):a=new ft("No Intersection")}else a=new ft(0==n||0==o?"Coincident":"Parallel");return a},ft.intersectLinePolygon=function(e,t,i){for(var r=new ft("No Intersection"),a=i.length,n=0;n<a;n++){var o=i[n],s=i[(n+1)%a],l=ft.intersectLineLine(e,t,o,s);r.appendPoints(l.points)}return r.points.length>0&&(r.status="Intersection"),r},ft.intersectLineRectangle=function(e,t,i,r){var a=i.min(r),n=i.max(r),o=new le(n.x,a.y),s=new le(a.x,n.y),l=ft.intersectLineLine(a,o,e,t),h=ft.intersectLineLine(o,n,e,t),c=ft.intersectLineLine(n,s,e,t),u=ft.intersectLineLine(s,a,e,t),f=new ft("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),f.points.length>0&&(f.status="Intersection"),f},ft.intersectPolygonPolygon=function(e,t){for(var i=new ft("No Intersection"),r=e.length,a=0;a<r;a++){var n=e[a],o=e[(a+1)%r],s=ft.intersectLinePolygon(n,o,t);i.appendPoints(s.points)}return i.points.length>0&&(i.status="Intersection"),i},ft.intersectPolygonRectangle=function(e,t,i){var r=t.min(i),a=t.max(i),n=new le(a.x,r.y),o=new le(r.x,a.y),s=ft.intersectLinePolygon(r,n,e),l=ft.intersectLinePolygon(n,a,e),h=ft.intersectLinePolygon(a,o,e),c=ft.intersectLinePolygon(o,r,e),u=new ft("No Intersection");return u.appendPoints(s.points),u.appendPoints(l.points),u.appendPoints(h.points),u.appendPoints(c.points),u.points.length>0&&(u.status="Intersection"),u},ft.intersectRayRay=function(e,t,i,r){var a,n=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x),o=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x),s=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y);if(0!=s){var l=n/s;(a=new ft("Intersection")).points.push(new le(e.x+l*(t.x-e.x),e.y+l*(t.y-e.y)))}else a=new ft(0==n||0==o?"Coincident":"Parallel");return a},ft.intersectRectangleRectangle=function(e,t,i,r){var a=e.min(t),n=e.max(t),o=new le(n.x,a.y),s=new le(a.x,n.y),l=ft.intersectLineRectangle(a,o,i,r),h=ft.intersectLineRectangle(o,n,i,r),c=ft.intersectLineRectangle(n,s,i,r),u=ft.intersectLineRectangle(s,a,i,r),f=new ft("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(c.points),f.appendPoints(u.points),f.points.length>0&&(f.status="Intersection"),f},ft.bezout=function(e,t){var i=e[0]*t[1]-t[0]*e[1],r=e[0]*t[2]-t[0]*e[2],a=e[0]*t[3]-t[0]*e[3],n=e[0]*t[4]-t[0]*e[4],o=e[0]*t[5]-t[0]*e[5],s=e[1]*t[2]-t[1]*e[2],l=e[1]*t[4]-t[1]*e[4],h=e[1]*t[5]-t[1]*e[5],c=e[2]*t[3]-t[2]*e[3],u=e[3]*t[4]-t[3]*e[4],f=e[3]*t[5]-t[3]*e[5],p=h+u,d=l-c;return new Polynomial(i*s-r*r,i*d+a*s-2*r*n,i*p+a*d-n*n-2*r*o,i*f+a*p-2*n*o,a*f-o*o)},se.Intersection=ft,se.AreaPicking=function(e,t){this.network=e,this.bounding=t,this.cache={}},se.extend(se.AreaPicking,Object,{intersectObjects:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];this.intersectObject(r,t)}return t},getViewPoint:function(e,t){var i=t.vertices[e].clone(),r=this.cache[t.getId()][i.x+" "+i.y+" "+i.z];return r||(i.applyMatrix4(t.worldMatrix),r=this.network.getViewPosition(i),r.y=r.h-r.y,r)},intersectObject:function(e,t){if(e instanceof se.Entity){this.cache[e.getId()]={};for(var i=0;i<e.vertices.length;i++){var r=e.vertices[i].clone();r.applyMatrix4(e.worldMatrix);var a=this.network.getViewPosition(r);if(a.y=a.h-a.y,this.cache[e.getId()][r.x+" "+r.y+" "+r.z]=a,a.x>this.bounding.x&&a.y>this.bounding.y&&a.x<this.bounding.x+this.bounding.w&&a.y<this.bounding.y+this.bounding.h){var n={element:e};return void t.push(n)}}}}}),se.BaseInteraction=function(e){this.network=e,this.view=e.getView()||document},se.addEventListener=function(e,t,i,r){var a="_"+e+"_";if(!r[a]){var n=function(e){r[t](e)};r[a]=n,i.addEventListener(e,n,!1)}},se.removeEventListener=function(e,t,i){var r="_"+e+"_",a=i[r];a&&(t.removeEventListener(e,a,!1),delete i[r])},se.extend(se.BaseInteraction,Object,{onPropertyChange:function(){},firePropertyChange:function(){},setUp:function(){},tearDown:function(){},update:function(){},addListener:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];se.addEventListener(t,"handle_"+t,this.network.getRootView(),this)}},removeListener:function(){for(var e=0;e<arguments.length;e++){arguments[e];se.removeEventListener(arguments[e],this.network.getRootView(),this)}},isCtrlDown:function(e){return e.ctrlKey||e.metaKey},isFinished:function(){return!0}}),se.DefaultInteraction=function(t){se.BaseInteraction.call(this,t),this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=this.screen.width/4,this.domElement=this.network.getRootView(),this.rotateSpeed=1,this.zoomSpeed=10,this.panSpeed=3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.easing=!0,this.dynamicDampingFactor=.05,this.timeInterval=2e3,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.lastPosition=new se.Vec3;var i,r,a=this.STATE.NONE,n=(this.STATE.NONE,new se.Vec3),o=new se.Vec3,s=new se.Vec3,l=new se.Vec2,h=new se.Vec2,c=0,u=0,f=new se.Vec2,p=new se.Vec2;this.object=this.network._camera,this.object.target||(this.object.target=new se.Vec3),this.movementSpeed=1,this.lookSpeed=.005,this.verticalLookRatio=.1,this.keyboardEnable=!0,this.lookVertical=!0,this.autoForward=!1,this.fpsMode=!1,this.dragMode=!0,this.activeLook=!1,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalFixed=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.freeze=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.lastX=0,this.lastY=0,this.touchSeq=[1,2,3],this.fpsMinDistance=100,this.network.getRootView().addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.yRistrict=!0,this.yLowerLimitAngle=-Math.PI/2,this.yUpLimitAngle=Math.PI/2,this.updateIntervalTime=0;var d=null;this.handleResize=function(){this.screen.width=e.innerWidth,this.screen.height=e.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleResize(),this.handle_mousedown=function(e){if(!fe.isCtrlDown(e)){if(e.preventDefault(),this.fpsMode){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.lastX=e.pageX,this.lastY=e.pageY,this.mouseDragOn=!0}else a===this.STATE.NONE&&(a=e.button),a!==this.STATE.ROTATE||this.noRotate?this.state!==this.STATE.ZOOM||this.noZoom?a!==this.STATE.PAN||this.noPan||(f=p=this.getMouseOnScreen(e.clientX,e.clientY)):l=h=this.getMouseOnScreen(e.clientX,e.clientY):(o=s=this.getMouseProjectionOnBall(e.clientX,e.clientY),i=r=this.getRotateY(e.clientX,e.clientY));this.beforeUpdate(),this.addListener("mousemove","mouseup")}},this.handle_mousemove=function(e){if(!e.stop){e.preventDefault(),this.fpsMode?this.dragMode?this.mouseDragOn?(this.mouseX=300*(e.pageX-this.lastX),this.mouseY=300*(e.pageY-this.lastY),this.lastX=e.pageX,this.lastY=e.pageY):(this.mouseX=0,this.mouseY=0):this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY):a!==this.STATE.ROTATE||this.noRotate?a!==this.STATE.ZOOM||this.noZoom?a!==this.STATE.PAN||this.noPan||(p=this.getMouseOnScreen(e.clientX,e.clientY)):h=this.getMouseOnScreen(e.clientX,e.clientY):(s=this.getMouseProjectionOnBall(e.clientX,e.clientY),r=this.getRotateY(e.clientX,e.clientY));var t=(new Date).getTime();if(null==this._lt)this.update();else{if(t-this._lt<this.updateIntervalTime)return;this.update()}this._lt=t}},this.handle_mouseup=function(e){if(e.preventDefault(),this.fpsMode){if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.lastX=0,this.lastY=0,this.dragMode&&(this.mouseX=0,this.mouseY=0),this.mouseDragOn=!1}else a=this.STATE.NONE;this.removeListener("mousemove","mouseup"),this.update(),this.afterHandleMouseup()},this.afterHandleMouseup=function(){},this.handle_touchstart=function(e){if(!1!==this.enabled){switch(e.touches.length){case this.touchSeq[0]:a=this.STATE.TOUCH_ROTATE,o=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY),i=r=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY),s.copy(o);break;case this.touchSeq[1]:a=this.STATE.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;u=c=Math.sqrt(t*t+n*n);break;case this.touchSeq[2]:a=this.STATE.TOUCH_PAN,f.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),p.copy(f);break;default:a=this.STATE.NONE}this.update()}},this.handle_touchmove=function(e){if(!1!==this.enabled){switch(e.preventDefault(),e.touches.length){case this.touchSeq[0]:s=this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,s),r=this.getRotateY(e.touches[0].pageX,e.touches[0].pageY);break;case this.touchSeq[1]:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;u=Math.sqrt(t*t+i*i);break;case this.touchSeq[2]:p=this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,p);break;default:a=this.STATE.NONE}this.update()}},this.handle_touchend=function(e){if(!1!==this.enabled){switch(e.touches.length){case this.touchSeq[0]:o.copy(this.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,s));break;case this.touchSeq[1]:c=u=0;break;case this.touchSeq[2]:p.copy(this.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY)),f.copy(p)}a=this.STATE.NONE,this.update()}},this.handle_DOMMouseScroll=function(e){this.handle_mousewheel(e)},this.handle_mousewheel=function(e){e.preventDefault();var t=0;e.wheelDelta?t=e.wheelDelta%120==0?e.wheelDelta/40:Math.abs(e.wheelDelta)>=100?e.wheelDelta/40:e.wheelDelta:e.detail&&(t=-e.detail/3),t&&(l.y+=1/t*.01),this.mouseMoving=!0,this.update()},this.handle_dblclick=function(e){if(this.isCtrlDown(e)){var t=this.network.getElementsByMouseEvent(e);t.length>0&&(d=t[0]),this.update()}},this.getMouseOnScreen=function(e,t){return new se.Vec2((e-this.screen.offsetLeft)/this.radius*.5,(t-this.screen.offsetTop)/this.radius*.5)},this.getRotateY=function(e,t){if(this.yRistrict)return(.5*this.screen.height+this.screen.offsetTop-t)/this.screen.height*2},this.handle_keydown=function(e){if(this.keyboardEnable){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}this.update()}},this.handle_keyup=function(e){if(this.keyboardEnable){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}this.update()}},this.getMouseProjectionOnBall=function(e,t){if(this.yRistrict)return(r=(i=new se.Vec3((e-.5*this.screen.width-this.screen.offsetLeft)/(.5*this.screen.width),0,0)).length())>1?i.normalize():i.z=Math.sqrt(1-r*r),i.normalize();var i=new se.Vec3((e-.5*this.screen.width-this.screen.offsetLeft)/this.radius,(.5*this.screen.height+this.screen.offsetTop-t)/this.radius,0),r=i.length();r>1?i.normalize():i.z=Math.sqrt(1-r*r),n.copy(this.object._position).sub(this.object.target);var a=this.object.up.clone().setLength(i.y);return a.add(this.object.up.clone().cross(n).setLength(i.x)),a.add(n.setLength(i.z)),a},this.rotateSpeedFunction=function(){return this.rotateSpeed},this.rotateCamera=function(){var e=o.dot(s)/o.length()/s.length(),t=Math.acos(e),a=!this.easing||Math.abs(t)<1e-4,l=!1,h=this.rotateSpeedFunction();if(t){var c=(new se.Vec3).crossVectors(o,s).normalize(),u=new se.Quat;u.setFromAxisAngle(c,-t*this.dynamicDampingFactor*h),a?(u.setFromAxisAngle(c,-t*h),n.applyQuaternion(u),this.object.up.applyQuaternion(u),o.copy(s)):(u.setFromAxisAngle(c,-t*this.dynamicDampingFactor*h),n.applyQuaternion(u),this.object.up.applyQuaternion(u),u.setFromAxisAngle(c,t*this.dynamicDampingFactor),o.applyQuaternion(u),l=!0)}var a=!this.easing||Math.abs(r-i)<1e-4,f=(r-i)*n.length();Ee.isNaN(f)||(a?(f&&this.yRistrict&&this.limitY(f),i=r):((f=f*this.dynamicDampingFactor)&&this.yRistrict&&this.limitY(f),i+=(r-i)*this.dynamicDampingFactor,l=!0)),l&&this.network.dirtyNetwork()},this.limitY=function(e){var t=n.length();Math.abs(n.x)<=.1*t&&Math.abs(n.z)<=.1*t&&(n.x=.1*t);var i=n.x,r=n.z,a=Math.sqrt(i*i+r*r),o=Math.tan(this.yLowerLimitAngle)*a,s=Math.tan(this.yUpLimitAngle)*a;n.y-=e,n.y>s?n.y=s:n.y<o&&(n.y=o)},this.getValueByTime=function(e,t){var i=(new Date).getTime()-this._timeStart;return i>this.timeInterval?t:e+(t-e)*i/this.timeInterval},this.zoomCamera=function(){if(a===this.STATE.TOUCH_ZOOM){t=c/u;c=u,n.multiplyScalar(t)}else{var e=this.zoomSpeed;this.easing||(e*=5);var t;1!==(t=1+(h.y-l.y)*e)&&t>0&&(n.multiplyScalar(t),!this.easing||Math.abs(h.y-l.y)<.001?l.copy(h):(l.y+=(h.y-l.y)*this.dynamicDampingFactor,this.network.dirtyNetwork()))}},this.panCamera=function(){var e=p.clone().sub(f);if(e.lengthSq()){e.multiplyScalar(n.length()*this.panSpeed);var t=n.clone().cross(this.object.up).setLength(e.x),i=(new ue).extractRotation(this.object.matrix),r=this.object.up.clone().applyMatrix4(i);t.add(r.setLength(e.y));var a=this.object.p().add(t);this.object.checkPosition(a)&&(this.object.p(a),this.object.target.add(t)),f=p,this.network.dirtyNetwork()}},this.checkAngles=function(){},this.checkDistances=function(){this.noZoom&&this.noPan||(n.lengthSq()>this.maxDistance*this.maxDistance&&this.object._position.addVectors(this.object.target,n.setLength(this.maxDistance)),n.lengthSq()<this.minDistance*this.minDistance&&this.object._position.addVectors(this.object.target,n.setLength(this.minDistance)))},this.updateFPS=function(){if(!this.freeze){if(this.heightSpeed){var e=se.Math.clamp(this.object._position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*this.heightCoef*2}else this.autoSpeedFactor=0;var t=2*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward){s=this.object._position.clone();this.object.translateZ(-(t+this.autoSpeedFactor));var i=this.object.target;this.verticalFixed&&this.object.setY(s.y);var r=this.object._position,a=new he,o=new he;a.subVectors(r,i),o.subVectors(s,i),a.z*o.z<=this.minDistance*this.minDistance&&this.object.target.subVectors(this.object._position,n)}if(this.moveBackward){var s=this.object._position.clone();this.object.translateZ(t),this.verticalFixed&&this.object.setY(s.y)}this.moveLeft&&(this.object.translateX(this.fpsMode?t:-t),this.object.target.subVectors(this.object._position,n)),this.moveRight&&(this.object.translateX(this.fpsMode?-t:t),this.object.target.subVectors(this.object._position,n)),this.moveUp&&(this.object.translateY(t),this.object.target.subVectors(this.object._position,n)),this.moveDown&&(this.object.translateY(-t),this.object.target.subVectors(this.object._position,n));var l=2*this.lookSpeed;this.activeLook||this.dragMode||(l=0);var h=this.verticalLookRatio;if(this.constrainVertical&&(h=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*l,this.dragMode&&(this.mouseX=0),this.lookVertical&&(this.lat-=this.mouseY*l*h),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=se.Math.degToRad(90-this.lat),this.theta=se.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=se.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),this.fpsMode){var c=this.object.target,r=this.object._position;length=length<this.fpsMinDistance?this.fpsMinDistance:length,c.x=r.x+length*Math.sin(this.phi)*Math.sin(this.theta),c.y=r.y+length*Math.cos(this.phi),c.z=r.z-length*Math.sin(this.phi)*Math.cos(this.theta),this.object.look(c)}}},this.setCameraTarget=function(e){this.Object.p()},this.update=function(){if(n.subVectors(this.object._position,this.object.target),this.noRotate||this.fpsMode||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.fpsMode||this.panCamera(),d&&d.element&&this.network.doubleClickToLookAtFunction(d.element)){this.object.target=d.point;var e=this.object._position.distanceTo(this.object.target),t=d.face.normal.clone();(t=t.applyMatrix4((new se.Mat4).extractRotation(d.element.worldMatrix))).normalize(),n=t.multiplyScalar(e),d=null}this.object.setPosition(this.object._position.clone().addVectors(this.object.target,n)),this.updateFPS(),this.fpsMode||(this.checkDistances(),this.object.look(this.object.target)),this.lastPosition.distanceToSquared(this.object._position)>0&&this.lastPosition.copy(this.object._position)},this.handleCameraChange=function(e){var t=this.object;if(t){var i=t.p(),r=t.target;if(this.fpsMode){var a=Ee.getVectorAngles(r,i);this.lat=-a[1],this.lon=-a[0]}}}},se.extend(se.DefaultInteraction,se.BaseInteraction,{STATE:{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},__accessor:["rotateSpeed","zoomSpeed","panSpeed","yLowerLimitAngle","yUpLimitAngle","minDistance","maxDistance","easing","touchSeq"],__bool:["noRotate","noPan","noZoom","fpsMode","yRistrict","keyboardEnable"],setUp:function(){this.addListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.addPropertyChangeListener(this.handleCameraChange,this)},tearDown:function(){this.removeListener("mousedown","touchstart","touchend","touchmove","mousewheel","DOMMouseScroll","dblclick","keydown","keyup"),this.object&&this.object.removePropertyChangeListener(this.handleCameraChange,this)},beforeUpdate:function(){},setUpdateIntervalTime:function(e){this.updateIntervalTime=e}}),se.SelectionInteraction=function(e){se.BaseInteraction.call(this,e),this.selectUnVisible=!0,this.ctrlDown=!1,this.deleteTimeoutId=null,this._areaPickingLevel=1},se.extend(se.SelectionInteraction,se.BaseInteraction,{constructor:se.SelectionInteraction,setAreaPickingLevel:function(e){this._areaPickingLevel=e},getAreaPickingLevel:function(){return this._areaPickingLevel},setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},setFocus:function(e){if(document.activeElement!==e){var t,i,r,a=document.documentElement;document.body;a&&(pe.isIE||pe.isOpera||a.scrollLeft||a.scrollTop)&&(t=a.scrollLeft,i=a.scrollTop,r=a),e.focus(),r&&(r.scrollLeft=t,r.scrollTop=i)}},handle_mousedown:function(e){if(1!=e.stop&&!fe.isRightClick(e)){this.setFocus(this.network.getView()),this.isCtrlDown(e)?(this.addListener("mousemove","mouseup"),this.ctrlDownEvent=e):this.network.getDataBox().clearSelection();var t=this.network.getElementsByMouseEvent(e),i=this.network.getFirstSelectElement(t);this.network.getDataBox().getSelectionModel().appendSelection(i),this.network.onSelect(i)}},handle_mousemove:function(e){var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent,this.network.devicePixelRatio);this.mousemoved=!0,this.network.areaPickingRect=t,this.network.paintTopCanvas()},handle_mouseup:function(e){this.network.areaPickingRect=null,this.network.paintTopCanvas();var t=this.getBoundingByMouseEvent(e,this.ctrlDownEvent);if(this.removeListener("mousemove","mouseup"),this.ctrlDownEvent=null,t&&this.mousemoved){var i=this.network.getElementsByBounding(t,!0,this._areaPickingLevel),r=new _e;if(i.length>0)for(var a=0;a<i.length;a++){var n=i[a].element;this.network.selectable(i[a])&&r.add(n)}r.size()>0&&this.network.getDataBox().getSelectionModel().appendSelection(r)}},getBoundingByMouseEvent:function(e,t,i){if(e&&t){var r=this.network.getView().getBoundingClientRect(),a=e.clientX-r.left,n=e.clientY-r.top,o=t.clientX-r.left,s=t.clientY-r.top,l=i||1,h=Math.min(a,o)*l,c=Math.min(n,s)*l,u=Math.abs(a-o)*l,f=Math.abs(n-s)*l;return 0===u&&0===f?null:{x:h,y:c,w:u,h:f}}}}),se.TransformGizmo=function(){var e=new se.TransformGizmoMaterial({color:16711680}),i=new se.TransformGizmoMaterial({color:65280}),r=new se.TransformGizmoMaterial({color:255});this.handleGizmos={X:[new se.Cylinder(e,.005,.005,1,4,1,!1,!1),new he(.5,0,0),new he(0,0,-Math.PI/2)],Y:[new se.Cylinder(i,.005,.005,1,4,1,!1,!1),new he(0,.5,0)],Z:[new se.Cylinder(r,.005,.005,1,4,1,!1,!1),new he(0,0,.5),new he(Math.PI/2,0,0)]};this.showHelpers=!0,this.showable=!0,this.init=function(){se.Element.call(this),this.handles=new se.Element,this.pickers=new se.Element,this.planes=new se.Element,this.addChild(this.handles),this.addChild(this.pickers),this.addChild(this.planes);var e=new se.BasicMaterial({wireframe:!1,color:65535,side:se.DoubleSide}),t=(new se.Plane(e,5e4,5e4,2,2),{XY:new se.Plane(e,5e4,5e4,2,2),YZ:new se.Plane(e,5e4,5e4,2,2),XZ:new se.Plane(e,5e4,5e4,2,2),XYZE:new se.Plane(e,5e4,5e4,2,2)});t.YZ._rotation.set(0,Math.PI/2,0),t.XZ._rotation.set(-Math.PI/2,0,0);for(var i in t)t[i].name=i,this.planes.addChild(t[i]),this.planes[i]=t[i],t[i]._visible=!0;for(var i in this.handleGizmos){var r=this.handleGizmos[i][0];if(r.name=i,this.handleGizmos[i][1]&&r._position.set(this.handleGizmos[i][1].x,this.handleGizmos[i][1].y,this.handleGizmos[i][1].z),this.handleGizmos[i][2]&&r._rotation.set(this.handleGizmos[i][2].x,this.handleGizmos[i][2].y,this.handleGizmos[i][2].z),r.mode=this.mode,this.handles.addChild(r),this.pickerGizmos&&this.pickerGizmos[i]){a=this.pickerGizmos[i][0];this.pickerGizmos[i][1]&&a._position.set(this.pickerGizmos[i][1].x,this.pickerGizmos[i][1].y,this.pickerGizmos[i][1].z),this.pickerGizmos[i][2]&&a._rotation.set(this.pickerGizmos[i][2].x,this.pickerGizmos[i][2].y,this.pickerGizmos[i][2].z)}else var a=r.clone();a.mode=this.mode,a.name=i,this.pickers.addChild(a)}this.iterator(function(e){e instanceof se.Entity&&se.Utils.transformElement(e)})},this.hide=function(){this.handles.getChildren().forEach(function(e){e._visible=!1}),this.pickers.getChildren().forEach(function(e){e._visible=!1}),this.planes.getChildren().forEach(function(e){e._visible=!1})},this.show=function(){var e=this;this.handles.getChildren().forEach(function(t){t._visible=e.showHelpers&&e.showable}),this.pickers.getChildren().forEach(function(e){e._visible=!1}),this.activePlane&&(this.activePlane._visible=!1)},this.highlight=function(e){var i;for(var r in this.handleGizmos)(i=this.handleGizmos[r][0]).oldColor&&(i.material instanceof se.ArrayMaterial?(i.material.materials[0].color.copy(i.oldColor),i.material.materials[0].opacity=i.oldOpacity):(i.material.color.copy(i.oldColor),i.material.opacity=i.oldOpacity),i.oldColor=null);this.handleGizmos[e]&&((i=this.handleGizmos[e][0]).material instanceof se.ArrayMaterial?(i.oldColor=i.oldColor||i.material.materials[0].color.clone(),i.oldOpacity=i.oldOpacit!==t?i.oldOpacity:i.material.materials[0].opacity,i.material.materials[0].opacity=1):(i.oldColor=i.oldColor||i.material.color.clone(),i.oldOpacity=i.material.opacity,i.setStyle("material.opacity",1)))},this.init()},se.TransformGizmo.prototype=Object.create(se.Element.prototype),se.TransformGizmo.prototype.update=function(e,t){for(var i=new he(0,0,0),r=new he(0,1,0),a=new ue,n=0;n<this.getChildren().size();n++)for(var o=0;o<this.getChildren().get(n).getChildren().size();o++){var s=this.getChildren().get(n).getChildren().get(o);-1!=s.name.search("E")?(s.quaternion.setFromRotationMatrix(a.lookAt(t,i,r)),s._rotation.setEulerFromQuaternion(s.quaternion)):(s.quaternion.setFromEuler(e),s._rotation.setEulerFromQuaternion(s.quaternion))}},se.TransformGizmoTranslate=function(){se.TransformGizmo.call(this);var e=new se.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new se.TransformGizmoMaterial({color:65280,opacity:.2}),i=new se.TransformGizmoMaterial({color:255,opacity:.2}),r=new se.Arrow(e,1,.03,.2,.05,30),a=new se.Arrow(t,1,.03,.2,.05,30),n=new se.Arrow(i,1,.03,.2,.05,30),o=new se.TransformGizmoMaterial({color:255,opacity:.5}),s=new se.TransformGizmoMaterial({color:16711680,opacity:.5}),l=new se.TransformGizmoMaterial({color:65280,opacity:.5}),h=new se.TransformGizmoMaterial({color:16777215,opacity:.5}),c=new se.Circle(o,.5,10,0,Math.PI/2),u=new se.Circle(s,.5,10,0,Math.PI/2),f=new se.Circle(l,.5,10,0,Math.PI/2),p=new se.Octahedron(h,1e-4,0);this.handleGizmos={X:[r,new he(1.6,0,0),new he(0,0,-Math.PI/2)],Y:[a,new he(0,1.6,0)],Z:[n,new he(0,0,1.6),new he(Math.PI/2,0,0)],XYZ:[p],XY:[c,new he(0,0,0)],YZ:[u,new he(0,0,0),new he(Math.PI/2,Math.PI/2,0)],XZ:[f,new he(0,0,0),new he(Math.PI/2,0,0)]};var h=new se.TransformGizmoMaterial({color:16711680,opacity:.25}),d=new se.TransformGizmoMaterial({color:65280,opacity:.25}),m=new se.TransformGizmoMaterial({color:255,opacity:.25}),g=new se.Cylinder(h,.075,0,1.2,4,1,!1),y=new se.Cylinder(d,.075,0,1.2,4,1,!1),v=new se.Cylinder(m,.075,0,1.2,4,1,!1),p=new se.Octahedron(h,1e-4,0);this.pickerGizmos={X:[g,new he(1.6,0,0),new he(0,0,-Math.PI/2)],Y:[y,new he(0,1.6,0)],Z:[v,new he(0,0,1.6),new he(Math.PI/2,0,0)],XYZ:[p]},this.setActivePlane=function(e,t){var i=new ue;t.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},se.TransformGizmoTranslate.prototype=Object.create(se.TransformGizmo.prototype),se.TransformGizmoTranslate.prototype.mode="translate",se.TransformGizmoRotate=function(){se.TransformGizmo.call(this);var e=new se.TransformGizmoMaterial({color:16711680,opacity:.2}),t=new se.TransformGizmoMaterial({color:65280,opacity:.2}),i=new se.TransformGizmoMaterial({color:255,opacity:.2}),r=new se.TransformGizmoMaterial({color:16776960}),a=new se.TransformGizmoMaterial({color:7895160,opacity:.25}),a=new se.TransformGizmoMaterial({color:16711680}),n=new se.Torus(e,1,.02,4,32,Math.PI),o=new se.Torus(t,1,.02,4,32,Math.PI),s=new se.Torus(i,1,.02,4,32,Math.PI);new se.Torus(r,1.25,.01,4,64),new se.Torus(a,1,.01,4,64);this.handleGizmos={X:[n,new he(0,0,0),new he(0,-Math.PI/2,-Math.PI/2)],Y:[o,new he(0,0,0),new he(Math.PI/2,0,0)],Z:[s,new he(0,0,0),new he(0,0,-Math.PI/2)]};var l=new se.TransformGizmoMaterial({color:16711680,opacity:.25}),h=new se.TransformGizmoMaterial({color:65280,opacity:.25}),c=new se.TransformGizmoMaterial({color:255,opacity:.25}),u=new se.TransformGizmoMaterial({color:983040,opacity:.25}),f=new se.Torus(l,1,.05,4,12,Math.PI),p=new se.Torus(h,1,.05,4,12,Math.PI),d=new se.Torus(c,1,.05,4,12,Math.PI);new se.Torus(u,1,.05,2,24);this.pickerGizmos={X:[f,new he(0,0,0),new he(0,-Math.PI/2,-Math.PI/2)],Y:[p,new he(0,0,0),new he(Math.PI/2,0,0)],Z:[d,new he(0,0,0),new he(0,0,-Math.PI/2)]},this.setActivePlane=function(e){"E"==e&&(this.activePlane=this.planes.XYZE),"X"==e&&(this.activePlane=this.planes.YZ),"Y"==e&&(this.activePlane=this.planes.XZ),"Z"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){se.TransformGizmo.prototype.update.apply(this,arguments);var i={handles:this.handles,pickers:this.pickers},r=new ue,a=new se.Euler(0,0,1),n=new se.Quat,o=new he(1,0,0),s=new he(0,1,0),l=new he(0,0,1),h=new se.Quat,c=new se.Quat,u=new se.Quat,f=t.clone();a.copy(this.planes.XY._rotation),n.setFromEuler(a),r.makeRotationFromQuaternion(n).getInverse(r),f.applyProjection(r);for(var p in i)for(var d=0;d<i[p].getChildren().size;d++){var m=i[p].getChildren().get(d);n.setFromEuler(a),"X"==m.name&&(h.setFromAxisAngle(o,Math.atan2(-f.y,f.z)),n.multiplyQuaternions(n,h),m.quaternion.copy(n)),"Y"==m.name&&(c.setFromAxisAngle(s,Math.atan2(f.x,f.z)),n.multiplyQuaternions(n,c),m.quaternion.copy(n)),"Z"==m.name&&(u.setFromAxisAngle(l,Math.atan2(f.y,f.x)),n.multiplyQuaternions(n,u),m.quaternion.copy(n))}},this.init()},se.TransformGizmoRotate.prototype=Object.create(se.TransformGizmo.prototype),se.TransformGizmoRotate.prototype.mode="rotate",se.TransformGizmoScale=function(){se.TransformGizmo.call(this);var e=new se.TransformGizmoMaterial({color:11184810,opacity:1}),t=new se.TransformGizmoMaterial({color:16711680,opacity:.2}),i=new se.TransformGizmoMaterial({color:65280,opacity:.2}),r=new se.TransformGizmoMaterial({color:255,opacity:.2}),a=new se.Cube(e,.25,.25,.25),n=new se.Cylinder(null,.1,.1,1,4,1,!1),o=new se.Cube(e,.225,.225,.225);(s=new se.Cylinder(null,.1,0,1,20,1,!0))._position.y=.05;var s=se.Utils.createElement(n,s,t),l=(se.Utils.createElement(n,s,i),se.Utils.createElement(n,s,r),new se.Cylinder(t,.08,0,1,4,1,!1)),h=new se.Cylinder(i,.08,0,1,4,1,!1),c=new se.Cylinder(r,.08,0,1,4,1,!1),u=new se.Element;u.material=new se.BasicMaterial;var f=new se.Element;f.material=new se.BasicMaterial;var p=new se.Element;p.material=new se.BasicMaterial,this.handleGizmos={X:[l,new he(.5,0,0),new he(0,0,-Math.PI/2)],Y:[h,new he(0,.5,0)],Z:[c,new he(0,0,.5),new he(Math.PI/2,0,0)],XY:[u],YZ:[f],XZ:[p],XYZ:[a]};var d=new se.TransformGizmoMaterial({color:16711680,opacity:.25}),m=new se.TransformGizmoMaterial({color:65280,opacity:.25}),g=new se.TransformGizmoMaterial({color:255,opacity:.25}),y=new se.Cylinder(d,.125,0,1,4,1,!1),v=new se.Cylinder(m,.125,0,1,4,1,!1),x=new se.Cylinder(g,.125,0,1,4,1,!1);this.pickerGizmos={X:[y,new he(.6,0,0),new he(Math.PI/4,0,-Math.PI/2)],Y:[v,new he(0,.6,0),new he(0,Math.PI/4,0)],Z:[x,new he(0,0,.6),new he(Math.PI/2,Math.PI/4,0)],XYZ:[o]},this.setActivePlane=function(e,t){var i=new ue;t.applyProjection(i.getInverse(i.extractRotation(this.planes.XY.worldMatrix))),"X"==e?(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)):"Y"==e?(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)):"Z"==e?(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)):this.activePlane="XYZ"==e?this.planes.XYZE:this.planes[e],this.hide(),this.show()},this.init()},se.TransformGizmoScale.prototype=Object.create(se.TransformGizmo.prototype),se.TransformGizmoScale.prototype.mode="scale",se.EditInteraction=function(i){function r(t){if(y.network._keyboardRemoveEnabled&&46==t.keyCode&&i.getDataBox().getSelectionModel().size()>0){e.confirm("Delete?")&&i.getDataBox().removeSelection()}}function a(t){1===t.touches.length&&(y.deleteTimeoutId=setTimeout(function(){var i=y.network.getElementsByMouseEvent(t,y.selectUnVisible);if(i.length>0){var r=i[0];e.confirm("Delete?")&&y.network.getDataBox().remove(r.element)}},1e3))}function n(e){clearTimeout(y.deleteTimeoutId)}function o(e){clearTimeout(y.deleteTimeoutId)}function s(e){y.update()}function l(e){if(y.object&&!v){e.preventDefault(),e.stopPropagation();var t=p(e.touches?e.touches[0]:e,y.filterIntersectPicker(y.pickers));if(t)y.axis=t.object.name,y.setMode(t.object.mode);else{var i=u(e);i===y.object||null!=i&&i.editTransformToParent&&i.isDescendantOf(y.object)?(y.axis=y.getAxis(),y.setMode(y.getMode())):y.axis=!1}y.update(!0)}}function h(e){if(!e.stop)if(Z.set(e.clientX,e.clientY),y.showHelpers&&y.axis||(f(e),l(e)),y.object&&!v){e.preventDefault(),e.stopPropagation();var r=e.touches?e.touches[0]:e;if(0===r.button||r.button==t){var a=p(r,y.filterIntersectPicker(y.pickers)),n=u(e);if(a||(n===y.object||null!=n&&n.editTransformToParent&&n.isDescendantOf(y.object))&&y.getDefaultPickers()&&(a={object:y.getDefaultPickers()}),a){y.axis=a.object.name,P.copy(j).sub(G).normalize(),y.gizmo[x].setActivePlane(y.axis,P);var o=p(r,[y.gizmo[x].activePlane]);if(!o&&n&&(o=p(r,[n])),o){V.copy(y.object._position),U.copy(y.object._scale),k.extractRotation(y.object.matrix),W.extractRotation(y.object.worldMatrix);var s=y.object.getParent();s==t&&(s=i),O.extractRotation(s.worldMatrix),X.getScaleFromMatrix(C.getInverse(s.worldMatrix)),_.copy(o.point)}}}y.update(!0),v=!0}else y.network.dirtyNetwork()}function c(e){if(y.object&&y.axis&&v){e.preventDefault(),e.stopPropagation(),e.stop=!0;var t=e.touches?e.touches[0]:e,r=p(t,[y.gizmo[x].activePlane]);if(r||(r=p(t,[y.object])),r){if(y.moving?i.fireInteractionEvent({kind:"liveMoveBetween",event:Je}):(i.fireInteractionEvent({kind:"liveMoveStart",event:Je}),y.moving=!0),A.copy(r.point),"translate"==x&&y.translateable){if(A.sub(_),A.multiply(X),"local"==y.space&&(A.applyMatrix4(C.getInverse(W)),-1==y.axis.search("X")&&(A.x=0),-1==y.axis.search("Y")&&(A.y=0),-1==y.axis.search("Z")&&(A.z=0),A.applyMatrix4(k),y.object.setPosition(V.clone().add(A))),"world"==y.space||-1!=y.axis.search("XYZ")){-1==y.axis.search("X")&&(A.x=0),-1==y.axis.search("Y")&&(A.y=0),-1==y.axis.search("Z")&&(A.z=0),A.applyMatrix4(C.getInverse(O)),y.object._position.copy(V);var a=y.object._position.clone().add(A);y.snap&&(-1!=y.axis.search("X")&&(a.x=Math.round(y.object._position.x/y.snap)*y.snap),-1!=y.axis.search("Y")&&(a.y=Math.round(y.object._position.y/y.snap)*y.snap),-1!=y.axis.search("Z")&&(a.z=Math.round(y.object._position.z/y.snap)*y.snap)),y.object.setPosition(a)}}else if("scale"==x&&y.scaleable){A.sub(_),A.multiply(X);var n=y.object._scale.clone(),o=(y.scaleRate||1)/10;if("XYZ"==y.axis)c=1+A.y*o,n.x=U.x*c,n.y=U.y*c,n.z=U.z*c;else if("XY"===y.axis){var s=1+A.x*o,l=1+A.y*o;if(y.forceSameScale){c=Math.max(s,l);n.x=U.x*c,n.y=U.y*c}else n.x=U.x*s,n.y=U.y*l}else if("YZ"===y.axis){var h=1+A.z*o,l=1+A.y*o;if(y.forceSameScale){c=Math.max(h,l);n.z=U.z*c,n.y=U.y*c}else n.z=U.z*h,n.y=U.y*l}else if("XZ"===y.axis){var s=1+A.x*o,h=1+A.z*o;if(y.forceSameScale){var c=Math.max(s,l);n.x=U.x*c,n.z=U.z*c}else n.x=U.x*s,n.z=U.z*h}else A.applyMatrix4(C.getInverse(W)),"X"==y.axis&&(n.x=U.x*(1+A.x*o)),"Y"==y.axis&&(n.y=U.y*(1+A.y*o)),"Z"==y.axis&&(n.z=U.z*(1+A.z*o));y.object.setScale(n)}else if("rotate"==x&&y.rotateable)if(A.sub(G),A.multiply(X),T.copy(_).sub(G),T.multiply(X),"E"==y.axis)A.applyMatrix4(C.getInverse(S)),T.applyMatrix4(C.getInverse(S)),w.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),b.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),E.setFromRotationMatrix(C.getInverse(O)),F.setFromAxisAngle(P,w.z-b.z),R.setFromRotationMatrix(W),E.multiplyQuaternions(E,F),E.multiplyQuaternions(E,R),y.object.quaternion.copy(E);else if("XYZE"==y.axis)F.setFromEuler(A.clone().cross(T).normalize()),E.setFromRotationMatrix(C.getInverse(O)),N.setFromAxisAngle(F,-A.clone().angleTo(T)),R.setFromRotationMatrix(W),E.multiplyQuaternions(E,N),E.multiplyQuaternions(E,R),y.object.quaternion.copy(E);else if("local"==y.space)A.applyMatrix4(C.getInverse(W)),T.applyMatrix4(C.getInverse(W)),w.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),b.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),R.setFromRotationMatrix(k),N.setFromAxisAngle(z,w.x-b.x),B.setFromAxisAngle(D,w.y-b.y),I.setFromAxisAngle(L,w.z-b.z),"X"==y.axis&&R.multiplyQuaternions(R,N),"Y"==y.axis&&R.multiplyQuaternions(R,B),"Z"==y.axis&&R.multiplyQuaternions(R,I),y.object.quaternion.copy(R),(u=y.object._rotation.clone()).setEulerFromQuaternion(R),y.object.setRotation(u);else if("world"==y.space){w.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),b.set(Math.atan2(T.z,T.y),Math.atan2(T.x,T.z),Math.atan2(T.y,T.x)),E.setFromRotationMatrix(C.getInverse(O)),N.setFromAxisAngle(z,w.x-b.x),B.setFromAxisAngle(D,w.y-b.y),I.setFromAxisAngle(L,w.z-b.z),R.setFromRotationMatrix(W),"X"==y.axis&&E.multiplyQuaternions(E,N),"Y"==y.axis&&E.multiplyQuaternions(E,B),"Z"==y.axis&&E.multiplyQuaternions(E,I),E.multiplyQuaternions(E,R),y.object.quaternion.copy(E);var u=y.object._rotation.clone();u.setEulerFromQuaternion(E),y.object.setRotation(u)}y.changed=!0}y.update(!0),y.updateTextNote(e,y.object)}}function u(e){var t=y.network.getElementsByMouseEvent(e);return i.getFirstEditElement(t)}function f(e){if(null===q&&(q=new le),q.set(e.clientX,e.clientY),i.getDataBox().clearEditing(),0===q.distanceTo(Z)){var t=y.network.getElementsByMouseEvent(e),r=i.getFirstEditElement(t);r&&(y.object,y.object=r,y.translateable&&y.gizmo.translate.show(),y.rotateable&&y.gizmo.rotate.show(),y.scaleable&&y.gizmo.scale.show()),r||(y.gizmo[x].hide(),y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide(),y.object=null)}else y.changed&&y.onElementPropertyChanged&&(y.changed=!1,y.moving=!1,y.onElementPropertyChanged(e,y.object),i.fireInteractionEvent({kind:"liveMoveEnd",event:{e:e,source:y.object,time:(new Date).getTime()}}));y.axis=!1,v=!1,y.update(!0),y.hideTextNote()}function p(e,t){if(!t)return null;var i=y.network.getPickingByEvent(e).intersectObjects(t,!0,!0);return!!i[0]&&i[0]}se.BaseInteraction.call(this,i);var d=new se.Element,m=i.getCamera(),g=i.getRootView();g=g!==t?g:document,this.domElement=g,this.gizmo={},this.gizmo.translate=new se.TransformGizmoTranslate,this.gizmo.rotate=new se.TransformGizmoRotate,this.gizmo.scale=new se.TransformGizmoScale,d.addChild(this.gizmo.translate),d.addChild(this.gizmo.rotate),d.addChild(this.gizmo.scale),this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.object=!1,this.snap=!1,this.space="local",this.size=1,this.axis=!1;var y=this;this.scaleable=!0,this.rotateable=!0,this.translateable=!0,this.setShowHelpers(!0);var v=!1,x="translate",A=(new se.Picking,new se.Projector,new he,new he),_=new he,w=new he,b=new he,M=1,S=new ue,P=new he,C=new ue,T=new he,E=new se.Quat,z=new he(1,0,0),D=new he(0,1,0),L=new he(0,0,1),R=new se.Quat,N=new se.Quat,B=new se.Quat,I=new se.Quat,F=new se.Quat,V=new he,U=new he,k=new ue,O=new ue,X=new he,G=new he,Y=new se.Euler,W=new ue,j=new he,H=new se.Euler;this.showNote=!0,this.handleDataBoxChange=function(e){"remove"==e.kind?e.data==y.object&&(y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide()):"clear"==e.kind&&(y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide())},this.network.getDataBox().addDataBoxChangeListener(this.handleDataBoxChange,this),this.network.addPropertyChangeListener(function(e){if("dataBox"==e.property){var t=e.oldValue,i=e.value;t.removeDataBoxChangeListener(this.handleDataBoxChange),i.addDataBoxChangeListener(this.handleDataBoxChange,this)}}),this.defaultMode="TranslateXY",this.pickers=[],this.gizmo.translate.pickers.getChildren().forEach(function(e){y.pickers.push(e)}),this.gizmo.rotate.pickers.getChildren().forEach(function(e){y.pickers.push(e)}),this.gizmo.scale.pickers.getChildren().forEach(function(e){y.pickers.push(e)}),this.attach=function(e){y.object=e,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide(),this.gizmo[x].show(),y.update()},this.detach=function(e){y.object=!1,this.axis=!1,this.gizmo.translate.hide(),this.gizmo.rotate.hide(),this.gizmo.scale.hide()},this.setMode=function(e){x=e||x,this.update()},this.setUp=function(){g.addEventListener("mousedown",h,!1),g.addEventListener("touchstart",h,!1),g.addEventListener("mousemove",l,!1),g.addEventListener("touchmove",l,!1),g.addEventListener("mousemove",c,!1),g.addEventListener("touchmove",c,!1),g.addEventListener("mouseup",f,!1),g.addEventListener("mouseout",f,!1),g.addEventListener("touchend",f,!1),g.addEventListener("touchcancel",f,!1),g.addEventListener("touchleave",f,!1),g.addEventListener("keydown",r,!1),g.addEventListener("touchstart",a,!1),g.addEventListener("touchmove",n,!1),g.addEventListener("touchend",o,!1),g.addEventListener("mousewheel",s,!1),y.network.helperBox.addByDescendant(d)},this.tearDown=function(){g.removeEventListener("mousedown",h,!1),g.removeEventListener("touchstart",h,!1),g.removeEventListener("mousemove",l,!1),g.removeEventListener("touchmove",l,!1),g.removeEventListener("mousemove",c,!1),g.removeEventListener("touchmove",c,!1),g.removeEventListener("mouseup",f,!1),g.removeEventListener("mouseout",f,!1),g.removeEventListener("touchend",f,!1),g.removeEventListener("touchcancel",f,!1),g.removeEventListener("touchleave",f,!1),g.removeEventListener("keydown",r,!1),g.removeEventListener("touchstart",a,!1),g.removeEventListener("touchmove",n,!1),g.removeEventListener("touchend",o,!1),g.removeEventListener("mousewheel",s,!1),y.gizmo.translate.hide(),y.gizmo.rotate.hide(),y.gizmo.scale.hide(),y.network.helperBox.removeByDescendant(d)},this.setSnap=function(e){y.snap=e},this.setSize=function(e){y.size=e,this.update()},this.setSpace=function(e){y.space=e,this.update()},this.update=function(e){y.object&&(y.object.updateWorldMatrix(),G.getPositionFromMatrix(y.object.worldMatrix),Y.setFromRotationMatrix(C.extractRotation(y.object.worldMatrix)),m.updateWorldMatrix(),j.getPositionFromMatrix(m.worldMatrix),H.setFromRotationMatrix(C.extractRotation(m.worldMatrix)),M=G.distanceTo(j)/12*y.size,d.setPosition(G),d.setScale(M,M,M),P.copy(j).sub(G).normalize(),this.gizmo.scale.update(Y,P),"local"==y.space?(this.gizmo.translate.update(Y,P),this.gizmo.rotate.update(Y,P)):(this.gizmo.translate.update(new se.Euler,P),this.gizmo.rotate.update(new se.Euler,P)),this.gizmo.translate.highlight(null),this.gizmo.rotate.highlight(null),this.gizmo.scale.highlight(null),this.gizmo[x].highlight(y.axis),d.updateWorldMatrix(!0),e&&y.network.dirtyNetwork())},this.getDefaultPickers=function(){return"TranslateX"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(0):"TranslateY"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(1):"TranslateZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(2):"TranslateXY"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(4):"TranslateYZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(5):"TranslateXZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(6):"TranslateXYZ"===this.defaultMode?y.gizmo.translate.pickers.getChildren().get(3):"RotateX"===this.defaultMode?y.gizmo.rotate.pickers.getChildren().get(0):"RotateY"===this.defaultMode?y.gizmo.rotate.pickers.getChildren().get(1):"RotateZ"===this.defaultMode?y.gizmo.rotate.pickers.getChildren().get(2):"ScaleX"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(0):"ScaleY"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(1):"ScaleZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(2):"ScaleXYZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(6):"ScaleXY"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(3):"ScaleYZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(4):"ScaleXZ"===this.defaultMode?y.gizmo.scale.pickers.getChildren().get(5):null},this.getMode=function(){var e=this.defaultMode;return e.startsWith("Translate")?"translate":e.startsWith("Rotate")?"rotate":e.startsWith("Scale")?"scale":"translate"},this.getAxis=function(){var e=this.defaultMode;return e.endsWith("XYZ")?"XYZ":e.endsWith("XY")?"XY":e.endsWith("YZ")?"YZ":e.endsWith("XZ")?"XZ":e.endsWith("Y")?"X":e.endsWith("Y")?"Y":e.endsWith("Z")?"Z":""};var q=null,Z=new le;this.filterIntersectPicker=function(e){var t=[];if(!this.showHelpers)return t;for(var i=0;i<e.length;i++){var r=e[i];r.getParent()===this.gizmo.translate.pickers&&this.translateable&&t.push(r),r.getParent()===this.gizmo.rotate.pickers&&this.rotateable&&t.push(r),r.getParent()===this.gizmo.scale.pickers&&this.scaleable&&t.push(r)}return t}},se.extend(se.EditInteraction,se.BaseInteraction,{setShowHelpers:function(e){this.showHelpers=e,this.gizmo.translate.showHelpers=e,this.gizmo.rotate.showHelpers=e,this.gizmo.scale.showHelpers=e,this.resetHelpers()},onElementPropertyChanged:function(e,t){},resetHelpers:function(){this.showHelpers&&this.translateable&&this.object?this.gizmo.translate.show():this.gizmo.translate.hide(),this.showHelpers&&this.rotateable&&this.object?this.gizmo.rotate.show():this.gizmo.rotate.hide(),this.showHelpers&&this.scaleable&&this.object?this.gizmo.scale.show():this.gizmo.scale.hide(),this.update(!0)},setShowNote:function(e){this.showNote=e},setScaleable:function(e){this.scaleable=e,this.gizmo.scale.showable=e,this.resetHelpers()},setRotateable:function(e){this.rotateable=e,this.gizmo.rotate.showable=e,this.resetHelpers()},setTranslateable:function(e){this.translateable=e,this.gizmo.translate.showable=e,this.resetHelpers()},setDefaultMode:function(e){this.defaultMode=e},setScaleRate:function(e){this.scaleRate=e||1},setForceSameScale:function(e){this.forceSameScale=e},setSpaceMode:function(e){this.space="world"==e?"world":"local",this.update()},createTextNote:function(){this.textNote=document.createElement("div"),this.textNote.style.position="relative",this.textNote.style.color="black",this.textNote.style.height="0px",this.textNote.style.zIndex="1000",this.domElement.appendChild(this.textNote);var e=document.createElement("table");this.noteTable=e,this.textNote.appendChild(this.noteTable);e.createTHead();e.style.borderLeft="1px solid #ffa500",e.style.borderTop="1px solid #ffa500",e.style.fontSize="14px",e.style.backgroundColor="rgba(255, 170, 13, 0.5)",e.setAttribute("border",0),e.setAttribute("cellspacing",0),e.setAttribute("cellpadding",0);for(var t=0;t<4;t++){for(var i=document.createElement("tr"),r=0;r<4;r++){var a=document.createElement("td");a.style.borderRight="1px solid #ffa500",a.style.borderBottom="1px solid #ffa500",a.style.paddingLeft="5px",a.style.paddingRight="5px",a.style.paddingTop="2px",a.style.paddingBottom="2px",0==t&&r>0||t>0&&0==r?(a.style.textAlign="center",a.style.fontWeight="bold"):a.style.textAlign="right",i.appendChild(a)}e.appendChild(i)}},showTextNote:function(){this.showNote&&(null==this.textNote&&this.createTextNote(),this.textNote.style.display="")},hideTextNote:function(){this.textNote&&(this.textNote.style.display="none")},updateTextNote:function(e,t){if(null!=t&&this.showNote){var i=this.network.getRootView().getBoundingClientRect();this.showTextNote(),this.textNote.style.top=e.clientY-i.top+20+"px",this.textNote.style.left=e.clientX-i.left+20+"px";for(var r=t.getRotation(),a=t.getPosition(),n=t.getScale(),o=[[" ","x","y","z"],["p",a.x,a.y,a.z],["r",r.x,r.y,r.z],["s",n.x,n.y,n.z]],s=this.noteTable,l=0;l<4;l++)for(var h=0;h<4;h++){var c=o[l][h];l>0&&h>0&&(c=2==l?(180*c/Math.PI).toFixed(0)+"&deg;":c.toFixed(2)),s.rows[l].cells[h].innerHTML=""+c}}}});se.CSG=function(e){var t,i,r,a,n,o,s=[];if(!(e instanceof se.Element)){if(e instanceof mt)return this.tree=e,this.matrix=new ue,this;throw"TGL.CSG: Given geometry is unsupported"}for(e.computeNodeData&&e.computeNodeData(),e.updateWorldMatrix(!0),this.matrix=e.worldMatrix.clone(),h=0,t=e.faces.length;h<t;h++){if(i=e.faces[h],a=e.uvs[h],n=e.uv2s[h],o=new pt,i instanceof Se)r=e.vertices[i.a],(r=new dt(r.x,r.y,r.z,i.vertexNormals[0],new le(a[0].x,a[0].y),n[0].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.b],(r=new dt(r.x,r.y,r.z,i.vertexNormals[1],new le(a[1].x,a[1].y),n[1].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.c],(r=new dt(r.x,r.y,r.z,i.vertexNormals[2],new le(a[2].x,a[2].y),n[2].clone())).applyMatrix4(this.matrix),r.materialIndex=i.materialIndex,o.vertices.push(r);else{if(!(i instanceof Pe))throw"Invalid face type at index "+h;r=e.vertices[i.a],(r=new dt(r.x,r.y,r.z,i.vertexNormals[0],new le(a[0].x,a[0].y),n[0].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.b],(r=new dt(r.x,r.y,r.z,i.vertexNormals[1],new le(a[1].x,a[1].y),n[1].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.c],(r=new dt(r.x,r.y,r.z,i.vertexNormals[2],new le(a[2].x,a[2].y),n[2].clone())).materialIndex=i.materialIndex,r.applyMatrix4(this.matrix),o.vertices.push(r),r=e.vertices[i.d],(r=new dt(r.x,r.y,r.z,i.vertexNormals[3],new le(a[3].x,a[3].y),n[3].clone())).applyMatrix4(this.matrix),r.materialIndex=i.materialIndex,o.vertices.push(r)}isNaN(o.calculateProperties().w)?console.log("Not right polygon"):s.push(o)}if(this.tree=new mt(s),this.tree.materialSize=e.getMaterialSize?e.getMaterialSize():0,e.material instanceof se.ArrayMaterial)this.tree.material=e.material;else{var l=new se.ArrayMaterial;this.tree.material=l;for(var h=0;h<this.tree.materialSize;h++)l.push(e.material)}},se.CSG.prototype.substract=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),t=new se.CSG(t),t.matrix=this.matrix,t},se.CSG.prototype.union=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t=new se.CSG(t),t.matrix=this.matrix,t},se.CSG.prototype.intersect=function(e){var t=this.tree.clone(),i=e.tree.clone();return t.sumMateriaSize(i),t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),t=new se.CSG(t),t.matrix=this.matrix,t},se.CSG.prototype.inverse=function(){var e=this.tree.clone();return e.polygons.map(function(e){e.flip()}),e=new se.CSG(e)},se.CSG.prototype.toGeometry=function(e){(new ue).getInverse(this.matrix);var t,i,r,a,n,o,s,l,h,c,u,f=new se.Entity(this.tree.material,e),p=this.tree.allPolygons(),d=p.length,m={};for(t=0;t<d;t++)for(a=(r=p[t]).vertices.length,i=2;i<a;i++){c=[],u=[],l=r.vertices[0],c.push(new le(l.uv.x,l.uv.y)),u.push(l.uv2.clone());var g=l.materialIndex;void 0!==m[(l=new he(l.x,l.y,l.z)).x+","+l.y+","+l.z]?n=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),n=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i-1],c.push(new le(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),void 0!==m[(l=new he(l.x,l.y,l.z)).x+","+l.y+","+l.z]?o=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),o=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),l=r.vertices[i],c.push(new le(l.uv.x,l.uv.y)),u.push(l.uv2.clone()),void 0!==m[(l=new he(l.x,l.y,l.z)).x+","+l.y+","+l.z]?s=m[l.x+","+l.y+","+l.z]:(f.vertices.push(l),s=m[l.x+","+l.y+","+l.z]=f.vertices.length-1),(h=new Se(n,o,s,new he(r.normal.x,r.normal.y,r.normal.z))).materialIndex=g||0,f.faces.push(h),f.uvs.push(c),f.uv2s.push(u)}return f},se.CSG.prototype.toMesh=function(e){var t=this.toGeometry(e);return t.computeBoundingBox(),t};var pt=function(e,i,r){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=t};pt.prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],i=this.vertices[2],r=t.clone().subtract(e),a=i.clone().subtract(e);return this.normal=r.cross(a).normalize(),this.w=this.normal.clone().dot(e),this},pt.prototype.clone=function(){var e,t,i=new pt;for(e=0,t=this.vertices.length;e<t;e++)i.vertices.push(this.vertices[e].clone());return i.calculateProperties(),i},pt.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},pt.prototype.classifyVertex=function(e){var t=this.normal.dot(e)-this.w;return t<-1e-5?2:t>1e-5?1:0},pt.prototype.classifySide=function(e){var t,i,r,a=0,n=0,o=e.vertices.length;for(t=0;t<o;t++)i=e.vertices[t],1===(r=this.classifyVertex(i))?a++:2===r&&n++;return a>0&&0===n?1:0===a&&n>0?2:0===a&&0===n?0:3},pt.prototype.splitPolygon=function(e,t,i,r,a){var n=this.classifySide(e);if(0===n)(this.normal.dot(e.normal)>0?t:i).push(e);else if(1===n)r.push(e);else if(2===n)a.push(e);else{var o,s,l,h,c,u,f,p,d,m=[],g=[];for(s=0,o=e.vertices.length;s<o;s++)l=(s+1)%o,u=e.vertices[s],f=e.vertices[l],h=this.classifyVertex(u),c=this.classifyVertex(f),2!=h&&m.push(u),1!=h&&g.push(u),3==(h|c)&&(p=(this.w-this.normal.dot(u))/this.normal.dot(f.clone().subtract(u)),d=u.interpolate(f,p),m.push(d),g.push(d));m.length>=3&&r.push(new pt(m).calculateProperties()),g.length>=3&&a.push(new pt(g).calculateProperties())}},se.CSG.Polygon=pt;var dt=function(e,t,i,r,a,n){this.x=e,this.y=t,this.z=i,this.normal=r||new he,this.uv=a||new le,this.uv2=n||new le};dt.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dt.prototype.clone=function(){var e=new dt(this.x,this.y,this.z,this.normal.clone(),this.uv.clone(),this.uv2.clone());return e.materialIndex=this.materialIndex,e},dt.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},dt.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},dt.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},dt.prototype.cross=function(e){var t=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-t*e.z,this.z=t*e.y-i*e.x,this},dt.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},dt.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},dt.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this.uv2.add(e.uv2.clone().sub(this.uv2).multiplyScalar(t)),this},dt.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},dt.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12],this.y=a[1]*t+a[5]*i+a[9]*r+a[13],this.z=a[2]*t+a[6]*i+a[10]*r+a[14],this},se.CSG.Vertex=dt;var mt=function(e){var i,r,a=[],n=[];if(this.polygons=[],this.front=this.back=t,e instanceof Array&&0!==e.length){for(this.divider=e[0].clone(),i=0,r=e.length;i<r;i++)this.divider.splitPolygon(e[i],this.polygons,this.polygons,a,n);a.length>0&&(this.front=new mt(a)),n.length>0&&(this.back=new mt(n))}};mt.isConvex=function(e){var t,i;for(t=0;t<e.length;t++)for(i=0;i<e.length;i++)if(t!==i&&2!==e[t].classifySide(e[i]))return!1;return!0},mt.prototype.build=function(e){var t,i,r=[],a=[];for(this.divider||(this.divider=e[0].clone()),t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],this.polygons,this.polygons,r,a);r.length>0&&(this.front||(this.front=new mt),this.front.build(r)),a.length>0&&(this.back||(this.back=new mt),this.back.build(a))},mt.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},mt.prototype.clone=function(){var e=new mt;if(this.divider&&(e.divider=this.divider.clone()),e.polygons=this.polygons.map(function(e){return e.clone()}),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.materialSize=this.materialSize,e.material=new se.ArrayMaterial,this.material)for(var t=0;t<this.material.materials.length;t++)e.material.materials.push(this.material.materials[t]);return e},mt.prototype.invert=function(){var e,t,i;for(e=0,t=this.polygons.length;e<t;e++)this.polygons[e].flip();return this.divider&&this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),i=this.front,this.front=this.back,this.back=i,this},mt.prototype.clipPolygons=function(e){var t,i,r,a;if(!this.divider)return e.slice();for(r=[],a=[],t=0,i=e.length;t<i;t++)this.divider.splitPolygon(e[t],r,a,r,a);return this.front&&(r=this.front.clipPolygons(r)),a=this.back?this.back.clipPolygons(a):[],r.concat(a)},mt.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},mt.prototype.sumMateriaSize=function(e){e.changeMaterialIndex(this.materialSize),this.materialSize=this.materialSize+e.materialSize;for(var t=0;t<e.material.materials.length;t++)this.material.materials.push(e.material.materials[t])},mt.prototype.changeMaterialIndex=function(e){for(var t=0;t<this.polygons.length;t++)for(var i=this.polygons[t],r=0;r<i.vertices.length;r++){var a=i.vertices[r];a.materialIndex=a.materialIndex+e}this.front&&this.front.changeMaterialIndex(e),this.back&&this.back.changeMaterialIndex(e)},se.CSG.Node=mt,se.XmlSerializer=function(e,t,i){this.dataBox=e,this.settings=t||new se.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},se.extend(se.XmlSerializer,Object,{serialize:function(){return this.xmlString="<TGL version='"+se.version+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</TGL>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this)},isSerializable:function(e){return!!this.dataBox.contains(e)&&!(this.filterFunction&&!this.filterFunction(e))},getPropertyType:function(e,t){var i=this.settings.getPropertyType(t);return i||e.__SizePropeties&&-1!=e.__SizePropeties.indexOf(t)&&(i="number"),i},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),i=this.refMap[e.getId()];this.xmlString+="<data class='"+e.getClassName()+"' ref='"+i+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+e.getId()+"'"),this.xmlString+=">\n",e.serializeXml(this,t),this.xmlString+="</data>\n"}e.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(e,t,i){var r=this.getPropertyType(e,t);if(r){var a=se.getValue(e,t,r),n=se.getValue(i,t,r);a!==n&&this.serializeValue("p",t,a,n,r)}},serializeStyleXml:function(e,t,i){var r=this.settings.getStyleType(t);if(r){var a=e.getStyle(t),n=i.getStyle(t);a!=n&&this.serializeValue("s",t,a,n,r)}},serializeClientXml:function(e,t,i){var r=this.settings.getClientType(t);if(null!=r){var a=e.getClient(t),n=i.getClient(t);a!=n&&this.serializeValue("c",t,a,n,r)}},serializeValue:function(e,t,i,r,a){if("s"===e&&(i=this.flattenArray(i))instanceof Array&&"string"!==a&&"color"!==a&&"number"!==a&&(a="list."+a,i=new _e(i)),null==i)this.xmlString+="\t<"+e+" n='"+t+"' none=''/>\n";else if("cdata"===a)this.xmlString+="\t<"+e+" n='"+t+"'><![CDATA["+i+"]]></"+e+">\n";else if("data"===a){var n=this.refMap[i.getId()];null!=n&&(this.xmlString+="\t<"+e+" n='"+t+"' ref='"+n+"'/>\n")}else"vec2"===a?r&&i.x===r.x&&i.y===r.y||(this.xmlString+="\t<"+e+" n='"+t+"' x='"+i.x+"' y='"+i.y+"'/>\n"):"vec3"===a?r&&i.x===r.x&&i.y===r.y&&i.z==r.z||(this.xmlString+="\t<"+e+" n='"+t+"' x='"+i.x+"' y='"+i.y+"' z='"+i.z+"'/>\n"):"list.vec2"===a?(this.xmlString+="\t<"+e+" n='"+t+"'>\n",i instanceof Array&&(i=new _e(i)),i.forEach(function(t){if(t instanceof Array){this.xmlString+="\t<"+e+">\n";for(var i=0;i<t.length;i++){var r=t[i];this.xmlString+="\t\t<p x='"+r.x+"' y='"+r.y+"'/>\n"}this.xmlString+="\t</"+e+">\n"}else this.xmlString+="\t\t<p x='"+t.x+"' y='"+t.y+"'/>\n"},this),this.xmlString+="\t</"+e+">\n"):"list.vec3"===a?(this.xmlString+="\t<"+e+" n='"+t+"'>\n",i instanceof Array&&(i=new _e(i)),i.forEach(function(t){if(t instanceof Array){this.xmlString+="\t<"+e+">\n";for(var i=0;i<t.length;i++){var r=t[i];this.xmlString+="\t<"+e+"' x='"+r.x+"' y='"+r.y+"' z='"+r.z+"'/>\n"}this.xmlString+="\t</"+e+">\n"}else this.xmlString+="\t\t<"+e+"' x='"+t.x+"' y='"+t.y+"' z='"+t.z+"'/>\n"},this),this.xmlString+="\t</"+e+">\n"):"list.string"===a||"list.number"===a||"list.color"===a?(this.xmlString+="\t<"+e+" n='"+t+"'>\n",i.forEach(function(e){this.xmlString+="\t\t<s>"+e+"</s>\n"},this),this.xmlString+="\t</"+e+">\n"):this.xmlString+="\t<"+e+" n='"+t+"'>"+i+"</"+e+">\n"},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserialize:function(e,t){se.isDeserializing=!0,this.xmlString=e;var i=se.xml(e).documentElement;this.refMap={},this.idMap={};var r,a,n,o=new _e,s=new _e,l=i.getElementsByTagName("data"),h=l.length;for(n=0;n<h;n++){var c=(a=l[n]).getAttribute("class"),u=this.settings.getPropertyType("id");if(u&&a.hasAttribute("id")){var f=null;if("string"===u)f=a.getAttribute("id");else if("int"===u)f=parseInt(a.getAttribute("id"));else{if("number"!==u)throw"Unsupported id type '"+u+"'";f=parseFloat(a.getAttribute("id"))}if("remove"===a.getAttribute("action")){this.dataBox.removeById(f);continue}(r=this.dataBox.getDataById(f))||(r=se.newInstance(c,f))}else r=se.newInstance(c);if(a.hasAttribute("ref")){var p=a.getAttribute("ref");this.refMap[p]=r}o.add(r),s.add(a),this.idMap[r.getId()]=r}for(this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),h=o.size(),n=0;n<h;n++)r=o.get(n),this.dataBox.containsById(r.getId())||(t&&!r.getParent()&&r.setParent(t),this.dataBox.add(r));for(n=0;n<h;n++)r=o.get(n),a=s.get(n),r.deserializeXml(this,a);this.settings.isDataBoxSerializable&&1===i.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,i.getElementsByTagName("dataBox")[0]),se.isDeserializing=!1},deserializePropertyXml:function(e,t,i){var r=this.getPropertyType(e,i);r&&se.setValue(e,i,this.deserializeValue(t,r))},deserializeStyleXml:function(e,t,i){var r=this.settings.getStyleType(i);r&&e.setStyle(i,this.deserializeValue(t,r))},deserializeClientXml:function(e,t,i){var r=this.settings.getClientType(i);r&&e.setClient(i,this.deserializeValue(t,r))},deserializePoint:function(e){var t=e.getAttribute("x")?parseFloat(e.getAttribute("x")):null,i=e.getAttribute("a")?parseFloat(e.getAttribute("a")):null;if(null!=t){var r=e.getAttribute("y")?parseFloat(e.getAttribute("y")):null,a=e.getAttribute("z")?parseFloat(e.getAttribute("z")):null,n=e.getAttribute("w")?parseFloat(e.getAttribute("w")):null;return null!=n?new se.Vec4(t,r,a,n):null!=a?new se.Vec3(t,r,a):new se.Vec2(t,r)}if(null!=i){var o=e.getAttribute("b")?parseFloat(e.getAttribute("b")):null,s=e.getAttribute("c")?parseFloat(e.getAttribute("c")):null,l=e.getAttribute("d")?parseFloat(e.getAttribute("d")):null;return null!=l?new se.Face4(i,o,s,l):new se.Face3(i,o,s)}return null},arrayStyleValue:function(e,t){var i=[];if(e.indexOf(",")){if(i=e.split(","),"string"===t)return i;if("number"===t){for(var r=[],a=0;a<i.length;a++)r.push(parseFloat(i[a]));return r}if("color"===t){for(var n=[],a=0;a<i.length;a++)n.push(new se.Color(i[a]));return n}}},deserializeValue:function(e,t,i){if(e.hasAttribute("@none"))return null;var r="s"===e.nodeName,a=r&&-1!==e.textContent.indexOf(",");if("string"===t)return a?this.arrayStyleValue(e.textContent,t):e.textContent;if("color"===t)return a?this.arrayStyleValue(e.textContent,t):e.textContent;if("number"===t)return a?this.arrayStyleValue(e.textContent,t):parseFloat(e.textContent);if("boolean"===t)return"true"===e.textContent;if("int"===t)return parseInt(e.textContent);if("point"===t)return this.deserializePoint(e);if("vec2"===t){var n=parseFloat(e.getAttribute("x")),o=parseFloat(e.getAttribute("y"));if(!isNaN(n)&&!isNaN(o)||!r)return new se.Vec2(n,o);t="list.point"}if("vec3"===t){var n=parseFloat(e.getAttribute("x")),o=parseFloat(e.getAttribute("y")),s=parseFloat(e.getAttribute("z"));return new se.Vec3(n,o,s)}if("data"===t){var l=e.getAttribute("ref"),h=this.refMap[l];return h||this.idMap[l]}var c,u,f,p;if("list.point"===t){var d=new _e,m=e.getElementsByTagName("p");for(c=m.length,p=0;p<c;p++){var g=m[p];d.add(this.deserializePoint(g))}return r?d._as:d}if("list.string"===t){var y=new _e;for(c=(f=e.getElementsByTagName("s")).length,p=0;p<c;p++)y.add(f[p].textContent);return y}if("list.number"===t){for(u=new _e,c=(f=e.getElementsByTagName("s")).length,p=0;p<c;p++)u.add(parseFloat(f[p].textContent));return u}if("array.string"===t)return e.textContent.split(",");if("array.number"===t){for(c=(u=e.textContent.split(",")).length,p=0;p<c;p++)u[p]=parseFloat(u[p]);return u}return"rectangle"===t?{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),width:parseFloat(e.getAttribute("w")),height:parseFloat(e.getAttribute("h"))}:e.textContent}}),se.addMethod(se.Data,{serializeXml:function(e,t){if(this.__SizePropeties&&this.__SizePropeties.length){var i,r;for(i=0,r=this.__SizePropeties.length;i<r;i++)this.serializePropertyXml(e,this.__SizePropeties[i],t)}else this.serializePropertyXml(e,"materialSize",t),this.vertices&&this.vertices.length&&this.serializePropertyXml(e,"vertices",t),this.faces&&this.faces.length&&this.serializePropertyXml(e,"faces",t),this.uvs&&this.uvs.length&&this.serializePropertyXml(e,"uvs",t);if(e.settings.isClientSerializable&&this._clientMap)for(var a in this._clientMap)this.serializeClientXml(e,a,t);this.serializePropertyXml(e,"name",t),this.serializePropertyXml(e,"parent",t)},serializePropertyXml:function(e,t,i){e.serializePropertyXml(this,t,i)},serializeClientXml:function(e,t,i){e.serializeClientXml(this,t,i)},deserializeXml:function(e,t){var i,r,a,n,o=t.getElementsByTagName("p"),s=o.length;for(i=0;i<s;i++)(r=o[i]).hasAttribute("n")&&this.deserializePropertyXml(e,r,r.getAttribute("n"));if(e.settings.isClientSerializable)for(s=(a=t.getElementsByTagName("c")).length,i=0;i<s;i++)(n=a[i]).hasAttribute("n")&&this.deserializeClientXml(e,n,n.getAttribute("n"))},deserializePropertyXml:function(e,t,i){e.deserializePropertyXml(this,t,i)},deserializeClientXml:function(e,t,i){e.deserializeClientXml(this,t,i)}}),se.addMethod(se.Element,{serializeXml:function(e,t){if(e.settings.isStyleSerializable&&this.styleMap)for(var i in this.styleMap)this.isSideStyle(i)||this.serializeStyleXml(e,i,t);this.serializePropertyXml(e,"position",t),this.serializePropertyXml(e,"rotation",t),this.serializePropertyXml(e,"scale",t),se.Element.superClass.serializeXml.call(this,e,t),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===e.settings.getPropertyType("alarmState")&&(e.xmlString+="\t<p n='alarmState'>\n",se.AlarmSeverity.forEach(function(t){var i=this.getNewAlarmCount(t);i>0&&(e.xmlString+="\t\t<n n='"+t.name+"' c='"+i+"'/>\n")},this._alarmState),se.AlarmSeverity.forEach(function(t){var i=this.getAcknowledgedAlarmCount(t);i>0&&(e.xmlString+="\t\t<a n='"+t.name+"' c='"+i+"'/>\n")},this._alarmState),e.xmlString+="\t</p>\n")},serializeStyleXml:function(e,t,i){e.serializeStyleXml(this,t,i)},deserializeXml:function(e,t){if(se.Element.superClass.deserializeXml.call(this,e,t),e.settings.isStyleSerializable){var i,r,a=t.getElementsByTagName("s"),n=a.length;for(i=0;i<n;i++)(r=a[i]).hasAttribute("n")&&this.deserializeStyleXml(e,r,r.getAttribute("n"))}},deserializeStyleXml:function(e,t,i){e.deserializeStyleXml(this,t,i)},deserializePropertyXml:function(e,t,i){if("alarmState"===i){if("alarmstate"===e.settings.getPropertyType("alarmState")){var r,a,n,o=t.getElementsByTagName("n");for(a=0;a<o.length;a++)n=o[a],r=mono.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setNewAlarmCount(r,parseInt(n.getAttribute("c")));for(o=t.getElementsByTagName("a"),a=0;a<o.length;a++)n=o[a],r=mono.AlarmSeverity.getByName(n.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(r,parseInt(n.getAttribute("c")))}}else se.Element.superClass.deserializePropertyXml.call(this,e,t,i)}}),se.addMethod(se.DataBox,{serializeXml:function(e,t){if(e.settings.isClientSerializable&&this._clientMap)for(var i in this._clientMap)this.serializeClientXml(e,i,t);this.serializePropertyXml(e,"name",t)},serializePropertyXml:function(e,t,i){e.serializePropertyXml(this,t,i)},serializeClientXml:function(e,t,i){e.serializeClientXml(this,t,i)},deserializeXml:function(e,t){var i,r,a,n,o=t.getElementsByTagName("p"),s=o.length;for(i=0;i<s;i++)(r=o[i]).hasAttribute("n")&&this.deserializePropertyXml(e,r,r.getAttribute("n"));if(e.settings.isClientSerializable)for(s=(a=t.getElementsByTagName("c")).length,i=0;i<s;i++)(n=a[i]).hasAttribute("n")&&this.deserializeClientXml(e,n,n.getAttribute("n"))},deserializePropertyXml:function(e,t,i){e.deserializePropertyXml(this,t,i)},deserializeClientXml:function(e,t,i){e.deserializeClientXml(this,t,i)}}),se.JsonSerializer=function(e,t,i){this.dataBox=e,this.settings=t||new se.SerializationSettings,this.filterFunction=i,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},se.extend(se.JsonSerializer,Object,{constructor:se.JsonSerializer,className:"TGL.JsonSerializer",serialize:function(){return this.jsonObject={v:se.version,platform:"html5"},this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var e={class:this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=e,this.dataBox.serializeJson(this,this.dataBox.newInstance(),e),Ee.isEmptyObject(e.p)&&delete e.p,Ee.isEmptyObject(e.s)&&delete e.s,Ee.isEmptyObject(e.c)&&delete e.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(e){if(this.refMap[e.getId()]=this.ref++,e.getChildren().forEach(this.initRefs,this),e instanceof se.ComboNode)for(var t=0;t<e.combos.length;t++){var i=e.combos[t];this.refMap[i.getId()]||(this.refMap[i.getId()]=this.ref++)}},isSerializable:function(e){return!!this.dataBox.contains(e)&&!(this.filterFunction&&!this.filterFunction(e))},serializeData:function(e){if(this.isSerializable(e)){var t=e.newInstance(),i=this.refMap[e.getId()],r={class:e.getClassName(),ref:i,p:{},s:{},c:{}};this.settings.getPropertyType("id")&&(this.jsonObject.id=e.getId()),this.jsonObject.datas.push(r),e.serializeJson(this,t,r),Ee.isEmptyObject(r.p)&&delete r.p,Ee.isEmptyObject(r.s)&&delete r.s,Ee.isEmptyObject(r.c)&&delete r.c}e.getChildren().forEach(this.serializeData,this)},serializeDataValue:function(e){var t=e.newInstance(),i=this.refMap[e.getId()],r={class:e.getClassName(),ref:i,p:{},s:{},c:{}};return e.serializeJson(this,t,r),Ee.isEmptyObject(r.p)&&delete r.p,Ee.isEmptyObject(r.s)&&delete r.s,Ee.isEmptyObject(r.c)&&delete r.c,r},getPropertyType:function(e,t){var i=this.settings.getPropertyType(t);return i||(e.__bool&&-1!=e.__bool.indexOf(t)?i="boolean":e.__SizePropeties&&-1!=e.__SizePropeties.indexOf(t)&&(i="number")),i},getStyleType:function(e,t){return e.isSideStyle(t)&&(t=t.substr(t.indexOf(".")+1)),this.settings.getStyleType(t)},serializePropertyJson:function(e,t,i,r){var a=this.getPropertyType(e,t);if(a){var n=se.getValue(e,t,a),o=se.getValue(i,t,a);n!==o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.p):this.serializeValue(t,n,o,a,r.p))}},serializeStyleJson:function(e,t,i,r){var a=this.getStyleType(e,t);if(a){var n=e.getStyle(t),o=i.getStyle(t);t.startsWith("m.")&&(n=this.flattenArray(n),o=this.flattenArray(o)),t.endsWith(".image")&&(n=this.encodeURI(n),o=this.encodeURI(o)),n!=o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.s):this.serializeValue(t,n,o,a,r.s))}},serializeClientJson:function(e,t,i,r){var a=this.settings.getClientType(t);if(null!=a){var n=e.getClient(t),o=i.getClient(t);n!=o&&(n&&n.equals?!n.equals(o)&&this.serializeValue(t,n,o,a,r.c):this.serializeValue(t,n,o,a,r.c))}},serializeValue:function(e,t,i,r,a){if(null==t)a[e]=null;else if(t instanceof _e)a[e]=t._as;else if("data"===r){var n=this.refMap[t.getId()];null!=n&&(a[e]=n)}else if("data.list"===r){for(var o=[],s=0;s<t.length;s++)o.push(this.serializeDataValue(t[s]));a[e]=o}else if("serializeabe.list"===r){for(var o=[],s=0;s<t.length;s++)o.push(t[s].serializeJsonValue());a[e]=o}else t.serializeJsonValue?a[e]=t.serializeJsonValue():a[e]=t},deserialize:function(e,t){se.isDeserializing=!0,this.jsonObject=JSON.parse(e),this.refMap={},this.idMap={};var i,r=new _e,a=new _e,n=this.jsonObject.datas.length;null!=this.deserializeStartCreateData&&this.deserializeStartCreateData(n);for(var o=0;o<n;o++){var s=this.jsonObject.datas[o],l=s.class;if(this.settings.getPropertyType("id")&&null!=s.id){if("remove"===s.action){this.dataBox.removeById(s.id);continue}(i=this.dataBox.getDataById(s.id))||(i=se.newInstance(l,s.id))}else{i=se.newInstance(l)}null!=s.ref&&(this.refMap[s.ref]=i),r.add(i),a.add(s),this.idMap[i.getId()]=i,this.deserializeCreateData&&this.deserializeCreateData(o,n)}for(this.dataBox.forEach(function(e){this.idMap[e.getId()]=e},this),n=r.size(),this.deserializeStartFillData&&this.deserializeStartFillData(n),o=0;o<n;o++)(i=r.get(o)).deserializeJson(this,a.get(o)),this.deserializeFillData&&this.deserializeFillData(o,n);for(this.deserializeStartAddData&&this.deserializeStartAddData(n),o=0;o<n;o++)i=r.get(o),this.dataBox.containsById(i.getId())||(t&&!i.getParent()&&i.setParent(t),"TGL.Entity"===i.getClassName()&&(i.computed=!1,i.computeNodeData()),this.dataBox.add(i),this.deserializeAddData&&this.deserializeAddData(o,n));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),se.isDeserializing=!1},deserializePropertyJson:function(e,t,i){var r=this.getPropertyType(e,i);r&&se.setValue(e,i,this.deserializeValue(t,r))},deserializeStyleJson:function(e,t,i){var r=this.getStyleType(e,i);if(r){var a=this.deserializeValue(t,r);a._as&&(a=a._as),e.setStyle(i,a)}},deserializeClientJson:function(e,t,i){var r=this.settings.getClientType(i);r&&e.setClient(i,this.deserializeValue(t,r))},getClassName:function(e){if(null!=e)return e.class?e.class:e.w!==t&&e.x!==t&&e.y!==t&&e.z!==t?"TGL.Vec4":e.x!==t&&e.y!==t&&e.z!==t?"TGL.Vec3":e.x!==t&&e.y!==t?"TGL.Vec2":e.a!==t&&e.b!==t&&e.c!==t&&e.d!==t?"TGL.Face4":e.a!==t&&e.b!==t&&e.c!==t?"TGL.Face3":void 0},translateJson:function(e){if(null!=e){if(null!=this.getClassName(e)){var t=se.newInstance(this.getClassName(e));if(t.deserializeJsonValue)t.deserializeJsonValue(e);else for(var i in e)t[i]=e[i];return t}if(e instanceof Array)for(var r=0;r<e.length;r++)e[r]=this.translateJson(e[r]);return e}},isChinese:function(e){return e=e||"",escape(e).indexOf("%u")>0},encodeURI:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)e[t]=this.encodeURI(e[t]);return e}return"string"==typeof e&&this.isChinese(e)?encodeURI(e):e},flattenArray:function(e){if(e instanceof Array){for(var t=0;t<e.length-1;t++)if(e[t]!=e[t+1]){if(!e[t]||!e[t].equals)return e;if(!e[t].equals(e[t+1]))return e}return e[0]}return e},deserializeValue:function(e,i){if("data"===i){var r=this.refMap[e];return r||this.idMap[e]}if("data.list"===i){for(var a,n,o=[],s=0;s<e.length;s++)a=e[s],n=se.newInstance(a.class),null!=a.ref&&(this.refMap[a.ref]=n),n.deserializeJson(this,a),o.push(n);return o}if("color"===i&&e.r!=t){var l=new se.Color;return l.setRGB(e.r,e.g,e.b),l}if("TGL.Path"===e.class){var h=new se.Path;return h.deserializeJsonValue(e),h}if(e instanceof Array){for(s=0;s<e.length;s++)e[s]=this.translateJson(e[s]);return e}return null!=this.getClassName(e)?this.translateJson(e):e}}),se.addMethod(se.DataBox,{serializeJson:function(e,t,i){if(e.settings.isClientSerializable&&this._clientMap)for(var r in this._clientMap)this.serializeClientJson(e,r,t,i);this.serializePropertyJson(e,"name",t,i)},serializePropertyJson:function(e,t,i,r){e.serializePropertyJson(this,t,i,r)},serializeClientJson:function(e,t,i,r){e.serializeClientJson(this,t,i,r)},deserializeJson:function(e,t){var i;for(i in t.p)this.deserializePropertyJson(e,t.p[i],i);if(e.settings.isClientSerializable)for(i in t.c)this.deserializeClientJson(e,t.c[i],i)},deserializePropertyJson:function(e,t,i){e.deserializePropertyJson(this,t,i)},deserializeClientJson:function(e,t,i){e.deserializeClientJson(this,t,i)}}),se.addMethod(se.Data,{serializeJson:function(e,t,i){if(!this.__SizePropeties||!this.__SizePropeties.length||this instanceof se.Entity)this.materialSize&&this.serializePropertyJson(e,"materialSize",t,i),this instanceof se.Entity&&(this.vertices&&this.vertices.length&&this.serializePropertyJson(e,"vertices",t,i),this.faces&&this.faces.length&&this.serializePropertyJson(e,"faces",t,i),this.uvs&&this.uvs.length&&this.serializePropertyJson(e,"uvs",t,i),this.uv2s&&this.uv2s.length&&this.serializePropertyJson(e,"uv2s",t,i));else{var r,a;for(r=0,a=this.__SizePropeties.length;r<a;r++)this.serializePropertyJson(e,this.__SizePropeties[r],t,i)}if(e.settings.isClientSerializable&&this._clientMap)for(var n in this._clientMap)this.serializeClientJson(e,n,t,i);this.serializePropertyJson(e,"name",t,i),this.serializePropertyJson(e,"parent",t,i)},serializePropertyJson:function(e,t,i,r){e.serializePropertyJson(this,t,i,r)},serializeClientJson:function(e,t,i,r){e.serializeClientJson(this,t,i,r)},deserializeJson:function(e,t){var i;for(i in t.p)this.deserializePropertyJson(e,t.p[i],i);if(e.settings.isClientSerializable)for(i in t.c)this.deserializeClientJson(e,t.c[i],i)},deserializePropertyJson:function(e,t,i){e.deserializePropertyJson(this,t,i)},deserializeClientJson:function(e,t,i){e.deserializeClientJson(this,t,i)}}),se.addMethod(se.Element,{serializeJson:function(e,t,i){if(e.settings.isStyleSerializable&&this.styleMap)for(var r in this.styleMap)this.isSideStyle(r)||this.serializeStyleJson(e,r,t,i);if(se.Element.superClass.serializeJson.call(this,e,t,i),this.serializePropertyJson(e,"position",t,i),this.serializePropertyJson(e,"rotation",t,i),this.serializePropertyJson(e,"scale",t,i),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===e.settings.getPropertyType("alarmState")){var a={n:{},a:{}};i.p.alarmState=a,se.AlarmSeverity.forEach(function(e){var t=this.getNewAlarmCount(e);t>0&&(a.n[e.name]=t)},this._alarmState),se.AlarmSeverity.forEach(function(e){var t=this.getAcknowledgedAlarmCount(e);t>0&&(a.a[e.name]=t)},this._alarmState),Ee.isEmptyObject(a.n)&&delete a.n,Ee.isEmptyObject(a.a)&&delete a.a,Ee.isEmptyObject(a)&&delete i.p.alarmState}},serializeStyleJson:function(e,t,i,r){e.serializeStyleJson(this,t,i,r)},deserializeJson:function(e,t){if(se.Element.superClass.deserializeJson.call(this,e,t),e.settings.isStyleSerializable)for(var i in t.s)this.deserializeStyleJson(e,t.s[i],i)},deserializeStyleJson:function(e,t,i){e.deserializeStyleJson(this,t,i)},deserializePropertyJson:function(e,t,i){if("alarmState"===i){if("alarmstate"===e.settings.getPropertyType("alarmState")){var r;for(r in t.n)this._alarmState.setNewAlarmCount(mono.AlarmSeverity.getByName(r),t.n[r]);for(r in t.a)this._alarmState.setAcknowledgedAlarmCount(mono.AlarmSeverity.getByName(r),t.a[r])}}else se.Element.superClass.deserializePropertyJson.call(this,e,t,i)}}),se.addMethod(se.Light,{serializeJson:function(e,t,i){if(se.Light.superClass.serializeJson.call(this,e,t,i),this.serializePropertyJson(e,"color",t,i),this.serializePropertyJson(e,"ambient",t,i),this.serializePropertyJson(e,"diffuse",t,i),this.serializePropertyJson(e,"specular",t,i),this.serializePropertyJson(e,"castShadow",t,i),this.serializePropertyJson(e,"onlyShadow",t,i),t.__accessor&&t.__accessor.length)for(var r=0;r<t.__accessor.length;r++)this.serializePropertyJson(e,t.__accessor[r],t,i)}});var gt=se.Animate=function(e){var t=this;t.type=null==e.type?"number":e.type,t.delay=null==e.delay?0:e.delay,t.dur=null==e.dur?1e3:e.dur,t.interval=null==e.interval?0:e.interval,t.finish=null==e.finish?t.delay+t.dur+t.interval:e.finish,t.repeat=null==e.repeat?1:e.repeat,t.reverse=null==e.reverse||e.reverse,t.easing=null==e.easing?"easeNone":e.easing,t.onUpdate=e.onUpdate,t.onDone=e.onDone,t.onStop=e.onStop,t.onPlay=e.onPlay,t.attr=e.attr,t.source=e.source,t.filter=e.filter,t.from=e.from,t.to=e.to,t.start=null,t.time=0,t.total=0,t.count=0,t.started=!1,t.stopped=!1,t.id=vt++};se.extend(se.Animate,Object,{play:function(){return $(this)},stop:function(e){return ie(this,e)},clone:function(){return new gt(this)},chain:function(e){var t,i=this;return i.onDone?(t=i.onDone,i.onDone=function(){t.call(i),e.play()}):i.onDone=function(){e.play()},i}});var yt={},vt=1,xt=!1;if(function e(t){requestAnimationFrame(e),xt&&(xt=!1,ae(t))}(0),!e.make){var At={},_t={},wt=[],bt={};(Mt=e.make={}).Default={path:"./",resPath:"",getImagePath:function(e){return this.path+this.resPath+"res/images/"+(e||"")},register:function(e,t,i){(i=i||{}).name=i.name||e,i.modelDefaultParameters=i.modelDefaultParameters||{},i.description=i.description||i.name,At[e]&&console.log(e," already exist"),At[e]=t;var r=i.category||"",a=_t[r]||{};a[e]=t,_t[r]=a,bt[e]=i,-1==wt.indexOf(r)&&wt.push(r),this.checkModelDefaultParameters(i.modelDefaultParameters)},checkModelDefaultParameters:function(e){if(e)for(var i in e){var r=e[i];r instanceof Object||(r={value:r},e[i]=r),r.propertyName=i,r.hidden=!!r.hidden,r.propertyType=r.propertyType||Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,r.type=r.type||Mt.Default.PARAMETER_TYPE_STRING,r.category=r.category||Mt.Default.PARAMETER_CATEGORY_DETAIL,r.editable=r.editable===t||!!r.editable,r.index=r.index===t?100:parseInt(r.index)}},remove:function(e){if(At[e]){At[e]=t,delete At[e];var i=Mt.Default.getCategory(e),r=_t[i];delete r[e];var a=0;for(var n in r)n&&a++;if(0==a)for(n=0;n<wt.length;n++){var o=wt.indexOf(i);o>=0&&wt.splice(o,1)}delete bt[e]}else console.log(e," not exist")},getCategories:function(){return wt},getCreatorsForCategory:function(e){return _t[e]},getCreator:function(e){return At[e]},getIds:function(e){var t=[];for(var i in At)(!e||e&&e(this.getParameters(i)))&&t.push(i);return t},getModelDefaultParameters:function(e){return this.getParameters(e).modelDefaultParameters},getDescription:function(e){return this.getParameters(e).description},getName:function(e){return this.getParameters(e).name},getIcon:function(e){var t=this.getParameters(e);return this.path+t.icon},isAsync:function(e){return this.getParameters(e).async},isCombo:function(e){return this.getParameters(e).combo},getCategory:function(e){return this.getParameters(e).category},getOrder:function(e){return this.getParameters(e).order||0},getType:function(e){return this.getParameters(e).type},getOtherParameter:function(e,t){return this.getParameters(e)[t]},registerIcon:function(e,t){var i=this.getParameters(e);if(i)return i.icon=t,i.icon},registerDescription:function(e,t){var i=this.getParameters(e);return i.description=t,i.description},registerName:function(e,t){var i=this.getParameters(e);return i.name=t,i.name},registerOther:function(e,t,i){var r=a[t],a=this.getParameters(e);return a[t]=i,"modelDefaultParameters"===t&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",e,r,i),this.checkModelDefaultParameters(i)),r},appendModelDefaultParameter:function(e,t,i,r,a,n,o){},getParameters:function(e){return bt[e]||{}},load:function(e,t,i){var r,a=(i=i||{}).isRelation;if(t){var n=t;t=function(t){a&&e instanceof Array&&e.length>1&&t instanceof Array&&t.length>1&&this._relation(e,t),n(t)}}if(e instanceof Array){var o={};if(t){var s=function(i,r){var a=e.length;return function(e){i.datas=i.datas||[],i.datas.push(e),i._total===a&&t(i.datas)}(r)};o._total=0;for(l=0;l<e.length;l++){h=e[l];this.load(h,function(e){o._total++,s(o,e)})}return null}r=[];for(var l=0;l<e.length;l++){var h=e[l],c=this.load(h);c&&r.push(c)}}else{var u={};"string"==typeof e?u.id=e:u=e,u=this.filterJson(u),t?this._load(u,t):r=this._load(u)}return a&&r instanceof Array&&r.length>1&&this._relation(e,r),r},_relation:function(e,t){var i={};t.forEach(function(e){e.getId&&(i[e.getId()]=e)}),e.forEach(function(e){e.objectId&&e.parentId&&i[e.objectId]&&i[e.parentId]&&i[e.objectId].setParent&&i[e.objectId].setParent(i[e.parentId])})},_load:function(e,t){var i=e.id,r=this.getCreator(i);if(!r)return console.log("unknown id: ",i),null;if(!t){var a=r(e);return Mt.Default._setObjectClientId(a,i),a}r(e,function(e){Mt.Default._setObjectClientId(e,i),t&&t(e)})},_setObjectClientId:function(e,t){e&&e.setClient&&e.setClient("id",t)},copyArray:function(e,t,i){if(t=[],e)for(var r,a=0,n=e.length;a<n;a++)r={},this.copyProperties(e[a],r),t.push(r);return t},copyProperties:function(e,i,r){if(e&&i)for(var a in e)r&&r.indexOf(a)>=0||0==a.indexOf("_")||(i[a]===t&&(e[a]instanceof Array?i[a]=[]:e[a]instanceof Function?i[a]=e[a]:e[a]instanceof Object?i[a]={}:i[a]=e[a]),!(e[a]instanceof Function)&&e[a]instanceof Object&&i[a]instanceof Object&&Mt.Default.copyProperties(e[a],i[a]))},getModelDefaultParametersValues:function(e,t){var i=this.getModelDefaultParameters(e),r={};for(var a in i){var n=i[a];t&&t(n)||(n.propertyType==Mt.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(r.client=r.client||{},r.client[a]=n.value):n.propertyType==Mt.Default.PARAMETER_PROPERTY_TYPE_STYLE?(r.style=r.style||{},r.style[a]=n.value):r[a]=n.value)}return r},getModelDefaultParameterProperties:function(e,t){var i=this,r=[],a=this.getModelDefaultParameters(e);if(!a)return r;t&&!a.id&&(a.id={propertyName:"id",name:"模型ID",category:Mt.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Mt.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),t&&!a.objectId&&(a.objectId={propertyName:"objectId",name:"实例ID",category:Mt.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:Mt.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var n in a)r.push(a[n]);return r.sort(function(e,t){return e.index-t.index}),r=r.map(function(e){return i.modelParameterToProperty(e)})},_getNameFromPropertyName:function(e){for(var t=e.split("."),i="",r=0;r<t.length;r++)t[r].length>0&&(i+=t[r].substring(0,1).toUpperCase()+t[r].substring(1,t[r].length)),r<t.length-1&&(i+=" ");return i},modelParameterToProperty:function(e){var t=new twaver.Property;return t.setCategoryName(e.category),e.name||(e.name=this._getNameFromPropertyName(e.propertyName)),t.setName(e.name),t.setEditable(e.editable),t.setPropertyType(e.propertyType),t.setPropertyName(e.propertyName),t.setValueType(e.type),t.setEnumInfo(e.enumInfo),t.isVisible=function(){return!e.hidden},t},filterJson:function(e){var i=this.getModelDefaultParameters(e.id);for(var r in i){var a=i[r].propertyType||"client",n=i[r].value;a==Mt.Default.PARAMETER_PROPERTY_TYPE_STYLE?e.style&&e.style[r]!==t||(e.style=e.style||{},e.style[r]=n):a==Mt.Default.PARAMETER_PROPERTY_TYPE_CLIENT?e.client&&e.client[r]!==t||(e.client=e.client||{},e.client[r]=n):e[r]===t&&(e[r]=n)}return e},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(e){return parseInt(e)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*e},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(e){return parseInt(e)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(e)+this.RACK_OFFSET_Y}},Mt.Default.toJson=function(e,t){if(e&&e.getClient){var i=e.getClient("id"),r=Mt.Default.getModelDefaultParameters(i),a={},n=null,o=null;for(var s in r)if(!1!==r[s].exportable){var l=r[s].propertyType,o=r[s].value;l==Mt.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(n=e[_twaver.getter(s)](),Mt.Default.equals(n,o)||(a[s]=n)):l==Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD?(n=e[s],Mt.Default.equals(n,o)||(a[s]=n)):l==Mt.Default.PARAMETER_PROPERTY_TYPE_STYLE?(n=e.getStyle(s),Mt.Default.equals(n,o)||(a.style=a.style||{},a.style[s]=n)):l==Mt.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(n=e.getClient(s),Mt.Default.equals(n,o)||(a.client=a.client||{},a.client[s]=n))}return a.id=i,Mt.Default.EXPORT_OBJECT_ID&&(a.objectId=e.getId()),t&&(a=t(a)),a}return t&&(e=t(e)),e},Mt.Default.copy=function(e,i,r,a,n){!function(e,i,r,a,n){n=n||{};var o={},s={},l=Mt.Default.getParameters(i);if(l=Mt.Default.clone(l),Mt.Default.copyProperties(l,s),a instanceof Function?o=a(s)||{}:Mt.Default.copyProperties(a,o),n.copyDefaultParamCoverage&&delete s.modelDefaultParameters,n.copyParamCoverage||Mt.Default.copyProperties(s,o),n.defaultValue&&o.modelDefaultParameters)for(var h in n.defaultValue)o.modelDefaultParameters[h]!==t&&(o.modelDefaultParameters[h]instanceof Object?o.modelDefaultParameters[h].value=n.defaultValue[h]:o.modelDefaultParameters[h]=n.defaultValue[h]);Mt.Default.register(e,function(e,t){var a={id:i};return r instanceof Function?r(e):Mt.Default.copyProperties(r,a),Mt.Default.copyProperties(e,a),Mt.Default.load(a,t)},o)}(e,i,r,a,n)},Mt.Default.PARAMETER_CATEGORY_BASIC="BASIC",Mt.Default.PARAMETER_CATEGORY_DETAIL="Detail",Mt.Default.PARAMETER_TYPE_STRING="string",Mt.Default.PARAMETER_TYPE_BOOLEAN="boolean",Mt.Default.PARAMETER_TYPE_COLOR="color",Mt.Default.PARAMETER_TYPE_INT="int",Mt.Default.PARAMETER_TYPE_NUMBER="number",Mt.Default.PARAMETER_TYPE_IMAGE="image",Mt.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",Mt.Default.PARAMETER_TYPE_ARRAY_INT="array.int",Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",Mt.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",Mt.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",Mt.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(e,t,i){return RegExp.prototype.isPrototypeOf(e)?this.replace(e,t):this.replace(new RegExp(e,i?"gi":"g"),t)},String.prototype.format=function(e){var t=this;if(arguments.length>1){for(var i=[],r=0;r<arguments.length;r++)i.push(arguments[r]);e=i}if(e){if(e instanceof Array)e.forEach(function(e,i){e instanceof Object&&(e=JSON.stringify(e)),t=t.replaceAll("{"+i+"}",e)});else{if(!(e instanceof Object))return t.replaceAll("{}",e);for(var a in e){var n=e[a];n instanceof Object&&(n=JSON.stringify(n)),t=t.replaceAll("{"+a+"}",n)}}}return t},Mt.Default.getId=function(e){return e.getClient("id")},Mt.Default.objectWrapper=function(e,t,i,r){Object.defineProperty(e,t,{get:function(){var r=e["___"+t];return i&&(r=i.call(e,r,e,t)),r},set:function(i){var a=e[t];r&&(i=r.call(e,i,e,t)),a!==i&&(e["___"+t]=i,this.firePropertyChange&&this.firePropertyChange(t,a,i))}})},Mt.Default.equals=function(e,t){return e instanceof Object&&t instanceof Object?JSON.stringify(e)==JSON.stringify(t):e==t},Mt.Default.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){throw console.error(t,e),t}},Mt.Default.EXPORT_OBJECT_ID=!0}var Mt=e.make;mono.Element.prototype.direction2=function(e){var t=e.applyMatrix4((new mono.Mat4).extractRotation(this.matrix));return t.normalize(),t},Mt.Utils3D={positionFloor:"floor-top",_objMap:{},_objObject:{},_envMaps:{envmap:"envmap.jpg",envmap1:"envmap1.jpg",envmap2:"envmap2.jpg",envmap3:"envmap3.jpg",envmap4:"envmap4.jpg",envmap5:"envmap5.jpg",envmap6:"envmap6.jpg"},getEnvMap:function(e){var t=Mt.Default.getImagePath()+Mt.Default._envMaps[e];return[t,t,t,t,t,t]},getOBjPath:function(e){return e?e.indexOf("http")>=0?e:this.path+e:this.path+"obj/"},createFloorForWall:function(e){var t={type:"twaver.floor",data:e.getClient("data")};this.getCreator(t.type)&&this.loadData(t).setParent(e)},createCombo:function(e,t){var i=[],r=[],a=[],n=[];!e||e instanceof Array||(e=[e]);for(var o=0;o<e.length;o++){var s=e[o],l=s.op||"+",h=s.style,c=s.client,u=s.position||[0,0,0],f=s.rotation||[0,0,0],p=s.scale||[1,1,1],d=null;if("cube"===s.type&&(d=this.createCube(s)),"cylinder"===s.type&&(d=this.createCylinder(s)),"sphere"===s.type&&(d=this.createSphere(s)),"polygon"===s.type&&(d=this.createPolygon(s)),"torus"===s.type&&(d=this.createTorus(s)),"path"===s.type&&(d=this.createPathCube(s)),"pathNode"===s.type&&(d=this.createPathNode(s)),"shapeNode"===s.type&&(d=this.createShapeNode(s)),d){if(f&&!s.rotationAnchor&&d.setRotation(f[0],f[1],f[2]),s.rotationAnchor){var m=d.getPosition();u=[u[0]+m.x,u[1]+m.y,u[2]+m.z]}d.setPosition(u[0],u[1],u[2]),d.setScale(p[0],p[1],p[2]),h&&d.s(h),c&&d.c(c),s.op?(d.getChildren().size()>0&&(i=i.concat(d.getChildren().toArray())),i.push(d),d.getChildren().size()>0?d.getChildren().forEach(function(){a.push(l)}):i.length>1&&a.push(l),n.push(d.getId())):r.push(d)}}if(i.length>0){var g;return(g=t?new mono.ComboNode(i,a,!1,t):new mono.ComboNode(i,a)).setNames(n),g}return 1==r.length?r[0]:r},setMainObject:function(e){var t=null;if(e instanceof Array){for(i=0;i<e.length;i++)(r=e[i])instanceof mono.Entity&&(t=function(e,t){if(e){var i=e.getBoundingBox(),r=t.getBoundingBox(),a=i.min,n=i.max,o=r.min,s=r.max;(n.x-a.x<s.x-o.x||n.z-a.z<s.z-o.z)&&(e=t)}else e=t;return e}(t,r));for(var i=0;i<e.length;i++){var r=e[i];r instanceof mono.Entity&&(t!=r&&e[i].setParent(t))}}else t=e;return t&&t.setClient("main",!0),t},createCube:function(e){var t,i=e.width,r=e.height,a=e.depth,n=e.color,o=(e.position,e.rotation||[0,0,0]),s=e.rotationAnchor,l=e.topColor||n,h=e.repeatX||1,c=e.repeatY||1,u=e.image,f=e.frontImage,p=e.wrapMode;if(t=e.objectId?new mono.Cube({id:e.objectId,width:i,height:r,depth:a}):new mono.Cube(i,r,a),n&&t.s({"m.color":n,"m.ambient":n}),l&&t.s({"top.m.color":l,"top.m.ambient":l,"bottom.m.color":l,"bottom.m.ambient":l}),u&&t.s({"m.texture.image":u,"m.texture.repeat":new mono.Vec2(h,c),"m.texture.anisotropy":15}),f&&t.setStyle("front.m.texture.image",f),p&&t.setWrapMode(p),s){var d,m;"left"===s&&(d=new mono.Vec3(i/2,0,0),m=new mono.Vec3(0,1,0)),"right"===s&&(d=new mono.Vec3(-i/2,0,0),m=new mono.Vec3(0,1,0)),t.rotateFromAxis(m.clone(),d.clone(),o[1])}else t.setRotation(o[0]/180*Math.PI,o[1]/180*Math.PI,o[2]/180*Math.PI);return Mt.Default.setObject3dCSProps(t,e),t},createCylinder:function(e){var t=e.radius,i=e.topRadius||t,r=e.bottomRadius||t,a=e.height,n=e.color,o=e.image,s=new mono.Cylinder(i,r,a);return s.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":n,"m.ambient":n,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),o&&s.setStyle("m.texture.image",o),s},createSphere:function(e){var t=e.radius,i=e.color||"#F5F5F5",r=e.image,a=new mono.Sphere(t);return a.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":i,"m.ambient":i,"m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),r&&a.setStyle("m.texture.image",r),a},createPolygon:function(e){var t=e.radius||100,i=e.topRadius||t,r=e.bottomRadius||t,a=e.height||200,n=e.radialSegments||3,o=e.color||"#F5F5F5",s=e.topColor||o,l=e.smooth||!0,h=e.image,c=new mono.Cylinder(i,r,a,n,l);return c.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":o,"m.ambient":o,"top.m.color":s,"top.m.ambient":s,"bottom.m.color":s,"bottom.m.ambient":s,"side.m.lightmap.image":this.getImagePath("inside_lightmap.jpg")}),h&&c.setStyle("m.texture.image",h),c},createTorus:function(e){var t=e.radius||50,i=e.tube||30,r=e.tubularSegments||3,a=e.radialSegments||6,n=e.color||"#F5F5F5",o=e.image,s=new mono.Torus(t,i,r,a);return s.s({"m.normalType":mono.NormalTypeSmooth,"m.type":"phong","m.color":n,"m.ambient":n,"m.lightmap.image":this.getImagePath("outside_lightmap.jpg")}),o&&s.setStyle("m.texture.image",o),s},createBillboard:function(e){var t=e.position||[0,0,0],i=e.scale||[1,1,1],r=e.image||this.getImagePath("outside_lightmap.jpg"),a=new mono.Billboard;return a.s({"m.texture.image":r,"m.alignment":mono.BillboardAlignment.bottomCenter,"m.depthTest":!1}),a.setScale(i[0],i[1],i[2]),a.p(t[0],t[1],t[2]),a},createPathNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(r=0;r<e.length;r++){var i=e[r];t?"c"===i[0]?t.quadraticCurveTo(i[1],i[2],i[3],i[4],i[5],i[6]):t.lineTo(i[0],0,i[1]):(t=new mono.Path).moveTo(i[0],0,i[1])}else for(var r=0;r<e.length;r+=2)t?t.lineTo(e[r],0,e[r+1]):(t=new mono.Path).moveTo(e[r],0,e[r+1]);return t},createPathNode:function(e){var t,i=e.radius,r=e.pathImage,a=e.repeat||50,n=e.offset||new mono.Vec2(0,0),o=e.startCap||"plain",s=e.endCap||"plain",l=e.pathWidth,h=e.pathHeight,c=l/2,u=h/2,f=[{x:c,y:-u},{x:c,y:u},{x:-c,y:u},{x:-c,y:-u}],p=this.createPathNodePath(e.data),d=p.getLength();return l&&h?t=new mono.PathNode({path:p,shape:f,segments:10,segmentsR:5}):(p=mono.PathNode.prototype.adjustPath(p,i,2),t=new mono.PathNode({path:p,radius:i})),t.s({"m.texture.image":r,"m.texture.repeat":new mono.Vec2(d/a,1),"m.texture.offset":n}),o&&t.setStartCap(o),s&&t.setEndCap(s),Mt.Default.setObject3dCSProps(t,e),t},createShapeNodePath:function(e){var t;if(e[0]&&e[0]instanceof Array)for(r=0;r<e.length;r++){var i=e[r];t?"c"===i[0]?t.quadraticCurveTo(i[1],-i[2],0,i[3],-i[4],0):t.lineTo(i[0],-i[1],0):(t=new mono.Path).moveTo(i[0],-i[1],0)}else for(var r=0;r<e.length;r+=2)t?t.lineTo(e[r],-e[r+1],0):(t=new mono.Path).moveTo(e[r],-e[r+1],0);return t},createShapeNode:function(e){var i=e.repeat||100,r=e.amount||2,a=!0;null===e.vertical&&e.vertical==t||(a=e.vertical);var n,o=this.createShapeNodePath(e.data);return n=e.id?new mono.ShapeNode({id:e.id,path:o}):new mono.ShapeNode(o),e.curveSegments&&n.setCurveSegments(e.curveSegments),n.setAmount(r),n.setVertical(a),n.setRepeat(i),n},createPathCube:function(e){var t=e.width,i=e.height,r=e.data,a=e.insideColor,n=e.outsideColor,o=e.asideColor,s=e.zsideColor,l=e.topColor,h=e.bottomColor,c=e.insideImage||e.image,u=e.outsideImage||e.image,f=e.insideMap,p=e.outsideMap,d=e.repeat||e.height,m=e.closed,g=this.createShapeNodePath(r);m&&g.closePath();var y=new mono.PathCube(g,t,i);return y.s({"outside.m.color":n,"inside.m.type":"basic","inside.m.color":a,"aside.m.color":o||n,"zside.m.color":s||n,"top.m.color":l,"top.m.ambient":l,"bottom.m.color":h||l,"inside.m.lightmap.image":f,"outside.m.lightmap.image":p,"aside.m.lightmap.image":p,"zside.m.lightmap.image":p,"inside.m.texture.image":c,"outside.m.texture.image":u}),y.setRepeat(d),y},getPicInfo:function(e,t){var i={};"string"==typeof t&&(t=[t]);for(var r=0;r<t.length;r++){var a=t[r],n=a.substring(0,a.indexOf(".")).toLowerCase();a=e+a,i[n]=a}return i},getRByD:function(e){return e*Math.PI/180},getDByR:function(e){return 180*e/Math.PI},getRsByDs:function(e){var t;if(e&&e.length>0){t=[];for(var i=0;i<e.length;i++)t.push(Mt.Default.getRByD(e[i]))}return t},setObject3dCSProps:function(e,t){t.client&&e.c(t.client),t.style&&e.s(t.style)},setObject3dCommonProps:function(e,t){var i=Mt.Default.getRsByDs(t.rotation)||[0,0,0],r=t.scale||[1,1,1],a=t.position||[0,0,0];e.setRotation(i[0],i[1],i[2]),e.setScale(r[0],r[1],r[2]),e.setPosition(a[0],0,a[2]),Mt.Default.setPositionY(e,a[1]),Mt.Default.setObject3dCSProps(e,t)},cloneObjElement:function(e,t){var i=Mt.Default.getRsByDs(e.rotation)||[0,0,0],r=e.scale||[1,1,1],a=e.position||[0,0,0];a[1]=parseFloat(a[1])||0;var n=this._objObject[e.name],o=n.getBoundingBoxWithChildren(),s=(o.max.y-o.min.y)/2,l=e.singleton?n:n.clonePrefab();if(e._id&&(l._id=e._id),e.client)for(var h in e.client)l.setClient(h,e.client[h]);return e.style&&l.s(e.style),l.setClient("type",e.name),l.setClient("showShadow",e.showShadow),e.showShadow&&(null!=e.shadowType?(l.setClient("shadowType",e.shadowType),l.setClient("shadowWeight",1)):e.showShadowImage&&l.setClient("shadowImage",e.shadowImage)),"function"==typeof e.interepter&&e.interepter.call(this,l),l.setClient("json",e),l.setScale(r[0],r[1],r[2]),l.setPosition(a[0],a[1]+s*r[1],a[2]),l.setRotation(i[0],i[1],i[2]),t&&t(l),l},setDefaultEnvMap:function(e){var t=this.getEnvMap("envmap5");return e.setStyle("m.envmap.image",t),e.getDescendants().forEach(function(e){e.setStyle("m.envmap.image",t)}),e},setShadowImage:function(e,t){e.setClient("shadowImage",t),twaver.Util.registerImageByUrl(t,t)},createObj:function(e,t){var i=this;if(this._objObject[e.name]){var r=this.getOBjPath(e.path),a=e.shadowImage=r+e.name+"S.png";return this.cloneObjElement(e,t)}if(this._objMap[e.name]){if(e.showShadow){var r=this.getOBjPath(e.path),a=e.shadowImage=r+e.name+"S.png";null==e.shadowType&&twaver.Util.registerImageByUrl(a,a)}}else{this._objMap[e.name]=[];var n=(r=this.getOBjPath(e.path))+e.name+".obj",o=r+e.name+".mtl";e.scale;if(e.showShadow){a=e.shadowImage=r+e.name+"S.png";null==e.shadowType&&twaver.Util.registerImageByUrl(a,a)}(new mono.OBJMTLLoader).load(n,o,null,function(t){if(e.merged)t=mono.Utils.mergeElements(t.getDescendants());else if(e.envImages){var r=Mt.Default.getEnvMap("envmap5");t.getDescendants().forEach(function(t){var i=t.getStyle("m.texture.image");i&&e.envImages.forEach(function(e){(i.indexOf(e)>=0||i instanceof Array&&i[0].indexOf(e)>=0)&&t.setStyle("m.envmap.image",r)})})}i._objObject[e.name]=t,i._objMap[e.name].forEach(function(e){return i.cloneObjElement(e.json,e.callback)})})}this._objMap[e.name].push({json:e,callback:t})},getTextSize:function(e,t){var i=document.createElement("canvas").getContext("2d"),r=e.split("\n"),a=0;i.font=t;for(var n=0;n<r.length;n++){var o=r[n],s=i.measureText(o).width;s>a&&(a=s)}return{w:a,h:i.measureText("e").width*r.length*3+4}},generateTextCanvas:function(e,t,i,r,a,n){var o=document.createElement("canvas"),i=i||"bold 80px 微软雅黑,sans-serif",s=o.getContext("2d"),l=e.split("\n"),h=Mt.Default.getTextSize(e,i),c=h.w,u=h.h,f={width:c,height:u};o.height=mono.Utils.nextPowerOfTwo(h.h),o.width=mono.Utils.nextPowerOfTwo(h.w),r&&(s.save(),s.globalAlpha=1,s.fillStyle=a||"#FE642E",s.beginPath(),s.moveTo(0,0),s.lineTo(c,0),s.lineTo(c,u),s.lineTo(0,u),s.closePath(),s.fill()),s.restore(),s.fillStyle=t||"white",s.textBaseline="middle",s.textAlign="center",s.font=i,n||(s.shadowColor="#585858",s.shadowBlur=25,s.shadowOffsetX=10,s.shadowOffsetY=10);for(var p=2.5*s.measureText("o").width,d=0;d<l.length;d++){var m=c/2,g=p*d+p/2+(o.height-f.height);s.fillText(l[d],m,g)}return o.drawRect=f,o},generateShadowNode:function(e,t,i){var r=null,a=e.getDescendants();if(a&&a.length>0)for(var n=0;n<a.length;n++){var o=a[n];if(o instanceof mono.Entity&&o.getClient("type")&&"floor"==o.getClient("type")){r=o;break}}if(r){var s=r.getBoundingBox(),l=(s.max.z,s.min.z,s.max.x,s.min.x,e.getRotation());e.setRotation(0,0,0);var h=Mt.Default.createShadowImage(e,r,t,i);return r.setStyle("top.m.lightmap.image",h),r.invalidateTexture(),Mt.Default.newcanvas=Mt.Default.newcanvas||h,e.setRotation(l),r}},_getWorldRotation:function(e){var t=(new mono.Mat4).extractRotation(e.worldMatrix),i=new mono.Vec3;return i.setEulerFromRotationMatrix(t),i},createShadowImage:function(e,t,i,r){var a=r&&r.shadowColor||"#000",n=(r&&r.shadowWeight,t.getBoundingBox()),o=n.max.z-n.min.z,s=n.max.x-n.min.x,l=Math.max(s,o),h=l>4096?Math.ceil(l/4096):1,c=Mt.Default.canvas||document.createElement("canvas"),u=s/(le=s/h),f=o/(he=o/h);c.width=le,c.height=he;var p=c.getContext("2d");p.clearRect(0,0,le,he),p.fillStyle="white",p.fillRect(0,0,le,he),p.beginPath();for(var d,m=e.getPosition(),g=e?e.getBoundingBox():null,y=-(g.max.x+g.min.x)/2-m.x,v=-(g.max.z+g.min.z)/2-m.z,x=e.getDescendants(),A=0;A<x.length;A++)if((w=x[A]).getClient&&"wallCombos"==w.getClient("id")){d=w;break}d&&(b=d.getClient("combos")).forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}x.push(e)});for(var _,A=0;A<x.length;A++){var w=x[A];if(w.getClient&&"columnCombos"==w.getClient("id")){_=w;break}}if(_){var b=_.getClient("combos");b.forEach(function(e){if(e.getClient&&!e.getClient("resetPos")){var t=e.getPosition();e.p(t.x+parseFloat(m.x),t.y+parseFloat(m.y),t.z+parseFloat(m.z)),e.setClient("resetPos",!0)}x.push(e)})}x.push(e);for(var M=0;M<x.length;M++){var S=x[M],P=S.getWorldPosition(),C=le/2+P.x/u,T=he/2+P.z/f,E=Mt.Default._getWorldRotation(S),z=S.getClient("type");if(0!=(Y=S.getClient("showShadow"))&&(Y=!0),Y&&("wall"==z||"inner_wall"==z||"glass_wall"==z)){var D=S.getClient("data"),L=S.getClient("doorData"),R=.9*S.getClient("wallDepth");if(p.save(),p.translate(C,T),p.beginPath(),D[0]&&D[0]instanceof Array){for(N=0;N<D.length;N++)0==N?p.moveTo(D[N][0]/u+y/u,D[N][1]/f+v/f):p.lineTo(D[N][0]/u+y/u,D[N][1]/f+v/f);"wall"==z&&p.lineTo(D[0][0]/u+y/u,D[0][1]/f+v/f)}else{for(var N=0;N<D.length;N+=2)0==N?p.moveTo(D[N]/u+y/u,D[N+1]/f+v/f):p.lineTo(D[N]/u+y/u,D[N+1]/f+v/f);"wall"==z&&p.lineTo(D[0]/u+y/u,D[1]/f+v/f)}p.lineWidth=R/u,p.strokeStyle="#ccc",p.shadowColor=a;var B=Math.min(parseInt(s/15),300);p.shadowBlur=parseInt(B/u),"inner_wall"!=z&&"glass_wall"!=z||(p.lineWidth=R/u,p.shadowBlur=parseInt(B/u)),p.shadowOffsetX=0,p.shadowOffsetY=0;for(var I=0;I<3;I++)p.shadowBlur=l>=4e3?180+80*I:100+50*I,p.stroke(),0==I&&(p.shadowColor="#666",p.shadowBlur=l>=4e3?300:200,p.stroke(),p.shadowColor="#000",p.shadowBlur=10,p.stroke());if(L){p.save(),p.shadowBlur=100,p.shadowColor="#ffffff";for(A=0;A<L.length;A+=2){var F=(L[A][0]+y)/h,V=(L[A][1]+v)/h,U=(L[A+1][0]+y)/h,k=(L[A+1][1]+v)/h,O=50/h,X=200/h,G=p.createLinearGradient(F-O,V-X,F-O,V+X);F==U&&(G=p.createLinearGradient(F-X,V-O,F+X,V-O)),F==U?(V+=8/h,k-=8/h):V==k&&(F+=8/h,U-=8/h),G.addColorStop(0,"rgba(255,255,255,0)"),G.addColorStop(.5,"rgba(255,255,255,1)"),G.addColorStop(1,"rgba(255,255,255,0)"),p.fillStyle=G,p.beginPath(),F==U?(p.moveTo(F-X,V-O),p.lineTo(F,V),p.lineTo(F+X,V-O),p.lineTo(F+X,k+O),p.lineTo(U,k),p.lineTo(F-X,k+O)):V==k&&(p.moveTo(F-O,V-X),p.lineTo(U+O,V-X),p.lineTo(U,k),p.lineTo(U+O,k+X),p.lineTo(F-O,k+X),p.lineTo(F,V)),p.closePath(),p.fill()}p.restore()}p.restore()}var Y=S.getClient("showShadow");i&&(Y=Y&&i(S));var W=S.getClient("shadowImage"),j=S.getClient("shadowType")||0,H=S.getClient("shadowRatio")||.99,q=S.getClient("shadowWeight")||2;if(Y){var Z=S.getBoundingBox().size(),Q=Z.x/u*H,R=depth=Z.z/f*H;if(E.y%(Math.PI/2)==0&&(Q=Z.x/f*H,R=depth=Z.z/u*H),E.y%Math.PI==0&&(Q=Z.x/u*H,R=depth=Z.z/f*H),1==j){var K=Math.min(Z.x,Z.z);Q=K/u*H,R=depth=K/f*H,E.y%(Math.PI/2)==0&&(Q=K/f*H,R=depth=K/u*H),E.y%Math.PI==0&&(Q=K/u*H,R=depth=K/f*H)}if(W){E=S.getRotation();var J=twaver.Util.getImageAsset(W);if(!J)continue;p.save(),p.translate(C+y/u,T+v/f),p.rotate(-E.y);var $,ee,te,ie,re=.3*Math.max(Q,depth);E.y%(Math.PI/2)==0&&($=-Q/2-re/2,ee=-depth/2-re/2,te=Q+re,ie=depth+re),E.y%Math.PI==0&&($=-Q/2-re/2,ee=-depth/2-re/2,te=Q+re,ie=depth+re),p.drawImage(J.getImage(),$,ee,te,ie),p.restore()}else if(0==j){p.save(),p.translate(C+y/u,T+v/f),p.rotate(-E.y),p.beginPath(),p.moveTo(-Q/2,0),p.lineTo(Q/2,0),p.lineWidth=R,p.strokeStyle="gray",p.shadowColor="#333";var ae=Math.min(Q,depth);p.shadowBlur=2*ae,p.shadowOffsetX=0,p.shadowOffsetY=0,1==q?(p.shadowBlur=3*ae,p.stroke()):2==q&&(p.stroke(),p.stroke()),p.restore()}else if(1==j){var C=C+y/u,T=T+v/f,ne=S.getClient("shadowRadius");ne?ne/=f:ne=Math.sqrt(Q*Q+depth*depth)/2,p.save(),p.beginPath(),p.arc(C,T,ne,0,2*Math.PI,!1),p.fillStyle="gray",p.shadowColor=a,p.shadowBlur=2*ne,p.shadowOffsetX=0,p.shadowOffsetY=0,1==q?(p.shadowBlur=3*ne,p.fill()):2==q&&(p.fill(),p.fill()),p.restore()}}}Mt.Default.canvas=Mt.Default.canvas||c;var oe=(l=Math.max(2048,Math.max(s/h,o/h)))/2048,se=Mt.Default.newcanvas||document.createElement("canvas"),le=mono.Utils.nextPowerOfTwo(s/oe),he=mono.Utils.nextPowerOfTwo(o/oe);se.width=le,se.height=he,se.style.width=le,se.style.height=he;var ce=se.getContext("2d");return ce.clearRect(0,0,le,he),ce.fillStyle="white",ce.fillRect(0,0,le,he),ce.drawImage(c,0,0,s/h,o/h,0,0,le,he),se},getRelativePosition:function(e,t){var i,r;return i=(new mono.Mat4).getInverse(e.worldMatrix.clone()),r=(new mono.Mat4).multiplyMatrices(i,t.worldMatrix.clone()),main.position=(new mono.Vec3).getPositionFromMatrix(r)},getPathBoundingBox:function(e){var t={},i={centerPoint:{x:0,y:0},min:{x:0,y:0},max:{x:0,y:0},size:{x:0,y:0}};if(0==e.length)return i;var r,a,n,o;if(e[0]instanceof Array){r=e[0][0],a=e[0][0],n=-e[0][1],o=-e[0][1];for(s=1;s<e.length;s++)r=Math.min(r,e[s][0]),a=Math.max(a,e[s][0]),n=Math.min(n,-e[s][1]),o=Math.max(o,-e[s][1])}else{if(e.length<2)return i;r=e[0],a=e[0],n=-e[1],o=-e[1];for(var s=2;s<e.length;s+=2)r=Math.min(r,e[s]),a=Math.max(a,e[s]),n=Math.min(n,-e[s+1]),o=Math.max(o,-e[s+1])}return t.centerPoint={x:(r+a)/2,y:(n+o)/2},t.min={x:r,y:n},t.max={x:a,y:o},t.size={x:a-r,y:o-n},t},setPositionY:function(e,t){if("number"==typeof t)e.setPositionY(t);else if(t==Mt.Default.positionFloor){var i=e.getBoundingBox().size();e.setPositionY(i.y/2)}},playAnimation:function(e,t,i){var r=t.split(":");if("move"===r[0]){var a=r[1],n=r[2],o=parseInt(r[3])||1e3,s=parseInt(r[4]||0),l=r[5];this.animateMove(e,a,n,o,s,l,i)}if("rotation"===r[0]){var h=r[1],c=r[2],o=parseInt(r[3])||1e3,s=parseInt(r[4]),l=r[5];this.animateRotate(e,h,c,o,s,l,i)}},animateMove:function(e,t,i,r,a,n,o){n=n||"easeInStrong";var s=e.getBoundingBox().size().multiply(e.getScale()),i=i||.8,l=new mono.Vec3(0,0,1),h=0;"right"===t&&(l=new mono.Vec3(1,0,0),h=s.x),"left"===t&&(l=new mono.Vec3(-1,0,0),h=s.x),"top"===t&&(l=new mono.Vec3(0,1,0),h=s.y),"bottom"===t&&(l=new mono.Vec3(0,-1,0),h=s.y),"front"===t&&(l=new mono.Vec3(0,0,1),h=s.z),"back"===t&&(l=new mono.Vec3(0,0,-1),h=s.z),h*=i,e.getClient("animated")&&(l=l.negate()),l=e.direction2(l);var c=e.getPosition().clone();e.setClient("animated",!e.getClient("animated")),new twaver.Animate({from:0,to:1,dur:r,easing:n,delay:a,onUpdate:function(t){e.setPosition(c.clone().add(l.clone().multiplyScalar(h*t)))},onDone:function(){o&&o()}}).play()},animateRotate:function(e,i,r,a,n,o,s){o=o||"easeInStrong";var l=e.getBoundingBox().size().multiply(e.getScale()),h=1;e.getClient("animated")&&(h=-1),e.setClient("animated",!e.getClient("animated"));var c;if("left"===i){c=new mono.Vec3(-l.x/2,0,0);u=new mono.Vec3(0,1,0)}if("right"===i){c=new mono.Vec3(l.x/2,0,0);u=new mono.Vec3(0,1,0)}if("center-z"===i){c=new mono.Vec3(0,0,0);var u=new mono.Vec3(0,0,1)}new twaver.Animate({from:0,to:h,dur:a,delay:n,easing:o,onUpdate:function(i){this.lastValue===t&&(this.lastValue=0),e.rotateFromAxis(u.clone(),c.clone(),Math.PI/180*-r*(i-this.lastValue)),this.lastValue=i},onDone:function(){delete this.lastValue,s&&s()}}).play()},animateCameraPosition:function(e,t,i,r){var a=e.getPosition(),n=new twaver.Animate({from:0,to:1,dur:i,easing:"easeBoth",onUpdate:function(i){var r=a.x+(t.x-a.x)*i,n=a.y+(t.y-a.y)*i,o=a.z+(t.z-a.z)*i,s=new mono.Vec3(r,n,o);e.setPosition(s)}});return n.onDone=r,n},playCameraAnimation:function(e,t,i,r){var a=e.getTarget(),n=e.getPosition().sub(e.getTarget()),o=new twaver.Animate({from:0,to:1,dur:500,easing:"easeBoth",onUpdate:function(r){var o=a.x+(i.x-a.x)*r,s=a.y+(i.y-a.y)*r,l=a.z+(i.z-a.z)*r,h=new mono.Vec3(o,s,l);e.lookAt(h),t.target=h;var c=(new mono.Vec3).addVectors(n,h);e.setPosition(c)}});o.onDone=r,o.play()}};for(var et in Mt.Utils3D)Mt.Default[et]=Mt.Utils3D[et];Mt.Default.register("twaver.cube",function(e,t){e.image&&e.image.indexOf("http")<0&&(e.image=Mt.Default.path+e.image);var i=Mt.Default.createCube(e);return 0==e.visible&&i.setStyle("m.visible",!1),Mt.Default.setObject3dCommonProps(i,e),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"立方体",icon:"model/idc/icons/cube.png",description:"立方体是make里面提供的最基本的模型，可以用这种模型扩展出各种立方体形状的模型，比如箱子，柱子，盒子等。支持更改长，宽，高，贴图等基本参数",modelDefaultParameters:{width:{name:"宽",value:100,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},depth:{name:"深",value:100,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Mt.Default.PARAMETER_TYPE_COLOR,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Mt.Default.PARAMETER_TYPE_IMAGE,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Mt.Default.register("twaver.cylinder",function(e,t){var i=Mt.Default.createCylinder(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),Mt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"圆柱体",icon:"model/idc/icons/cylinder.png",description:"圆柱体是make中提供的最基本模型，支持更改半径，高度的参数。可以更改这些参数扩展出各个圆柱体形状的模型，比如圆形柱子，桌子腿，瓶子，圆筒等",modelDefaultParameters:{topRadius:{name:"顶半径",value:60,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:60,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:100,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"white",type:Mt.Default.PARAMETER_TYPE_COLOR,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Mt.Default.PARAMETER_TYPE_IMAGE,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Mt.Default.register("twaver.sphere",function(e,t){var i=Mt.Default.createSphere(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),i.setClient("showShadow",!0),i.setClient("shadowType",1),i.setClient("shadowRatio",.3),Mt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"球体",icon:"model/idc/icons/sphere.png",description:"球体是make中提供的最基本模型，支持更改半径的参数。可以更改这些参数扩展出各个球体形状的模型，比如圆球等",modelDefaultParameters:{radius:{name:"半径",value:80,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},color:{name:"颜色",value:"#F5F5F5",type:Mt.Default.PARAMETER_TYPE_COLOR,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Mt.Default.PARAMETER_TYPE_IMAGE,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Mt.Default.register("twaver.polygon",function(e,t){var i=Mt.Default.createPolygon(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),Mt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"多边形",icon:"model/idc/icons/polygon.png",description:"多边形是make中提供的最基本模型，支持更改半径，高度，边数的参数。可以更改这些参数扩展出各个多边形状的模型，比如多边形柱子，多边形箱子，各种支架等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Mt.Default.PARAMETER_TYPE_COLOR,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Mt.Default.PARAMETER_TYPE_IMAGE,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},topRadius:{name:"顶半径",value:100,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},bottomRadius:{name:"底半径",value:100,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},height:{name:"高",value:200,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:3,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}}),Mt.Default.register("twaver.torus",function(e,t){var i=Mt.Default.createTorus(e),r=e.position||[0,0,0];return i.p(r[0],0,r[2]),Mt.Default.setPositionY(i,r[1]),t&&t(i),i},{category:"基本模型",type:"mono.Element",name:"圆环",icon:"model/idc/icons/torus.png",description:"圆环体是make中提供的最基本模型，支持更改半径，高度，扁平程度，管半径的参数。可以更改这些参数扩展出各个圆环体形状的模型，比如轮胎等",modelDefaultParameters:{color:{name:"颜色",value:"white",type:Mt.Default.PARAMETER_TYPE_COLOR,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},image:{name:"贴图",value:t,type:Mt.Default.PARAMETER_TYPE_IMAGE,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},radius:{name:"半径",value:50,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},tube:{name:"内外径差",value:30,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},tubularSegments:{name:"扁平程度",value:3,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},radialSegments:{name:"边数",value:6,type:Mt.Default.PARAMETER_TYPE_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD},position:{value:[0,0,0],name:"位置",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1},rotation:{value:[0,0,0],name:"旋转角度",type:Mt.Default.PARAMETER_TYPE_ARRAY_NUMBER,propertyType:Mt.Default.PARAMETER_PROPERTY_TYPE_FIELD,editable:!1}}});var St=0;Mt.Default.register("twaver.combo",function(e,t){var i="pack_"+St++,r=e.data;if(r&&mono.Utils.isArray(r)){for(var a=null,n=null,o=[],s=[],l=0;l<r.length;l++){if(n=Mt.Default.load(r[l]),a){var h=n.getClient("type");"inner_wall"==h||"glass_wall"==h?(o.push(n),n.getChildren().size()>0&&n.getChildren().forEachReverse(function(e){e.setParent(a)})):"column"==h?s.push(n):n.setParent(a)}else a=n;n.setClient?n.setClient("pack",i):(n.client=n.client||{},n.client.pack=i)}if(o&&o.length>0&&((c=new mono.ComboNode(o)).setClient("id","wallCombos"),c.setClient("combos",c.getCombos()),c.setParent(a)),s&&s.length>0){var c=new mono.ComboNode(s);c.setClient("id","columnCombos"),c.setClient("combos",c.getCombos()),c.setParent(a)}return t&&t(a),a}},{icon:"model/idc/icons/combo.png",category:"基本模型",type:"mono.Element",name:"组合模型",description:"组合模型，可以把多个不同的模型组合在一块，组成一个新的模型，传如参数是一个数组"}),Mt.Default.registerObj=function(e,t,i,r,a,n,o,s,l,h,c){(r=r||{}).async=!0;Mt.Default.register(e,function(e,s){return e.name=t,e.path=i,e.showShadow=a,a&&(e.showShadowImage=!0),e.shadowType=n,e.merged=o,e.envImages=h,e.singleton=c,l&&(e.style=l),null==e.merged&&(e.merged=!0),e.interepter=r.interepter,Mt.Default.createObj(e,s)},r)},Mt.Default.register("twaver.loader",function(e,t){return Mt.Default.load(e.data,t)}),Mt.Utils3D.getRectOfPoints=function(e){if(!e||e.length/2<2)return null;var t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=0,o=e.length,s=[],l=function(e,n){r=Math.min(r,e),a=Math.max(a,e),t=Math.min(t,n),i=Math.max(i,n),s.push({x:e,y:n})};if(o>0&&e[n]instanceof Array)for(;n<o;n++){var h=e[n];2==h.length?l(h[0],h[1]):5==h.length&&"c"==h[0]&&l(h[3],h[4])}else for(;n<o;n+=2)l(e[n],e[n+1]);return{min:{x:r,y:t},max:{x:a,y:i},center:function(){return{x:(r+a)/2,y:(t+i)/2}},width:a-r,height:i-t,points:s}}}(window);
+function(){function a(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function b(){return new a(null)}function c(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function d(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e}function e(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function f(a){return bc.charAt(a)}function g(a,b){var c=cc[a.charCodeAt(b)];return null==c?-1:c}function h(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function j(a){this.t=1,this.s=0>a?-1:0,a>0?this[0]=a:-1>a?this[0]=a+DV:this.t=0}function k(a){var c=b();return c.fromInt(a),c}function l(b,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else{if(4!=c)return void this.fromRadix(b,c);d=2}this.t=0,this.s=0;for(var e=b.length,f=!1,h=0;--e>=0;){var i=8==d?255&b[e]:g(b,e);0>i?"-"==b.charAt(e)&&(f=!0):(f=!1,0==h?this[this.t++]=i:h+d>this.DB?(this[this.t-1]|=(i&(1<<this.DB-h)-1)<<h,this[this.t++]=i>>this.DB-h):this[this.t-1]|=i<<h,h+=d,h>=this.DB&&(h-=this.DB))}8==d&&0!=(128&b[0])&&(this.s=-1,h>0&&(this[this.t-1]|=(1<<this.DB-h)-1<<h)),this.clamp(),f&&a.ZERO.subTo(this,this)}function m(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function n(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,g="",h=this.t,i=this.DB-h*this.DB%b;if(h-->0)for(i<this.DB&&(c=this[h]>>i)>0&&(e=!0,g=f(c));h>=0;)b>i?(c=(this[h]&(1<<i)-1)<<b-i,c|=this[--h]>>(i+=this.DB-b)):(c=this[h]>>(i-=b)&d,0>=i&&(i+=this.DB,--h)),c>0&&(e=!0),e&&(g+=f(c));return e?g:"0"}function o(){var c=b();return a.ZERO.subTo(this,c),c}function p(){return this.s<0?this.negate():this}function q(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(b=c-a.t,0!=b)return b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function r(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function s(){return this.t<=0?0:this.DB*(this.t-1)+r(this[this.t-1]^this.s&this.DM)}function t(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function u(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function v(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function w(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function x(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function y(b,c){var d=this.abs(),e=b.abs(),f=d.t;for(c.t=f+e.t;--f>=0;)c[f]=0;for(f=0;f<e.t;++f)c[f+d.t]=d.am(0,e[f],c,f,0,d.t);c.s=0,c.clamp(),this.s!=b.s&&a.ZERO.subTo(c,c)}function z(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function A(c,d,e){var f=c.abs();if(!(f.t<=0)){var g=this.abs();if(g.t<f.t)return null!=d&&d.fromInt(0),void(null!=e&&this.copyTo(e));null==e&&(e=b());var h=b(),i=this.s,j=c.s,k=this.DB-r(f[f.t-1]);k>0?(f.lShiftTo(k,h),g.lShiftTo(k,e)):(f.copyTo(h),g.copyTo(e));var l=h.t,m=h[l-1];if(0!=m){var n=m*(1<<this.F1)+(l>1?h[l-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,q=1<<this.F2,s=e.t,t=s-l,u=null==d?b():d;for(h.dlShiftTo(t,u),e.compareTo(u)>=0&&(e[e.t++]=1,e.subTo(u,e)),a.ONE.dlShiftTo(l,u),u.subTo(h,h);h.t<l;)h[h.t++]=0;for(;--t>=0;){var v=e[--s]==m?this.DM:Math.floor(e[s]*o+(e[s-1]+q)*p);if((e[s]+=h.am(0,v,e,t,0,l))<v)for(h.dlShiftTo(t,u),e.subTo(u,e);e[s]<--v;)e.subTo(u,e)}null!=d&&(e.drShiftTo(l,d),i!=j&&a.ZERO.subTo(d,d)),e.t=l,e.clamp(),k>0&&e.rShiftTo(k,e),0>i&&a.ZERO.subTo(e,e)}}}function B(c){var d=b();return this.abs().divRemTo(c,null,d),this.s<0&&d.compareTo(a.ZERO)>0&&c.subTo(d,d),d}function C(a){this.m=a}function D(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function E(a){return a}function F(a){a.divRemTo(this.m,null,a)}function G(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function H(a,b){a.squareTo(b),this.reduce(b)}function I(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function J(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function K(c){var d=b();return c.abs().dlShiftTo(this.m.t,d),d.divRemTo(this.m,null,d),c.s<0&&d.compareTo(a.ZERO)>0&&this.m.subTo(d,d),d}function L(a){var c=b();return a.copyTo(c),this.reduce(c),c}function M(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function N(a,b){a.squareTo(b),this.reduce(b)}function O(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function P(){return 0==(this.t>0?1&this[0]:this.s)}function Q(c,d){if(c>4294967295||1>c)return a.ONE;var e=b(),f=b(),g=d.convert(this),h=r(c)-1;for(g.copyTo(e);--h>=0;)if(d.sqrTo(e,f),(c&1<<h)>0)d.mulTo(f,g,e);else{var i=e;e=f,f=i}return d.revert(e)}function R(a,b){var c;return c=256>a||b.isEven()?new C(b):new J(b),this.exp(a,c)}function S(){var a=b();return this.copyTo(a),a}function T(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function U(){return 0==this.t?this.s:this[0]<<24>>24}function V(){return 0==this.t?this.s:this[0]<<16>>16}function W(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function X(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function Y(a){if(null==a&&(a=10),0==this.signum()||2>a||a>36)return"0";var c=this.chunkSize(a),d=Math.pow(a,c),e=k(d),f=b(),g=b(),h="";for(this.divRemTo(e,f,g);f.signum()>0;)h=(d+g.intValue()).toString(a).substr(1)+h,f.divRemTo(e,f,g);return g.intValue().toString(a)+h}function Z(b,c){this.fromInt(0),null==c&&(c=10);for(var d=this.chunkSize(c),e=Math.pow(c,d),f=!1,h=0,i=0,j=0;j<b.length;++j){var k=g(b,j);0>k?"-"==b.charAt(j)&&0==this.signum()&&(f=!0):(i=c*i+k,++h>=d&&(this.dMultiply(e),this.dAddOffset(i,0),h=0,i=0))}h>0&&(this.dMultiply(Math.pow(c,h)),this.dAddOffset(i,0)),f&&a.ZERO.subTo(this,this)}function $(b,c,d){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,d),this.testBit(b-1)||this.bitwiseTo(a.ONE.shiftLeft(b-1),ga,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(a.ONE.shiftLeft(b-1),this);else{var e=new Array,f=7&b;e.length=(b>>3)+1,c.nextBytes(e),f>0?e[0]&=(1<<f)-1:e[0]=0,this.fromString(e,256)}}function _(){var a=this.t,b=new Array;b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(a-->0)for(d<this.DB&&(c=this[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)8>d?(c=(this[a]&(1<<d)-1)<<8-d,c|=this[--a]>>(d+=this.DB-8)):(c=this[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(e>0||c!=this.s)&&(b[e++]=c);return b}function aa(a){return 0==this.compareTo(a)}function ba(a){return this.compareTo(a)<0?this:a}function ca(a){return this.compareTo(a)>0?this:a}function da(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;f>d;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()}function ea(a,b){return a&b}function fa(a){var c=b();return this.bitwiseTo(a,ea,c),c}function ga(a,b){return a|b}function ha(a){var c=b();return this.bitwiseTo(a,ga,c),c}function ia(a,b){return a^b}function ja(a){var c=b();return this.bitwiseTo(a,ia,c),c}function ka(a,b){return a&~b}function la(a){var c=b();return this.bitwiseTo(a,ka,c),c}function ma(){for(var a=b(),c=0;c<this.t;++c)a[c]=this.DM&~this[c];return a.t=this.t,a.s=~this.s,a}function na(a){var c=b();return 0>a?this.rShiftTo(-a,c):this.lShiftTo(a,c),c}function oa(a){var c=b();return 0>a?this.lShiftTo(-a,c):this.rShiftTo(a,c),c}function pa(a){if(0==a)return-1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&&++b,b}function qa(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+pa(this[a]);return this.s<0?this.t*this.DB:-1}function ra(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function sa(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=ra(this[c]^b);return a}function ta(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)}function ua(b,c){var d=a.ONE.shiftLeft(b);return this.bitwiseTo(d,c,d),d}function va(a){return this.changeBit(a,ga)}function wa(a){return this.changeBit(a,ka)}function xa(a){return this.changeBit(a,ia)}function ya(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0,d>0?b[c++]=d:-1>d&&(b[c++]=this.DV+d),b.t=c,b.clamp()}function za(a){var c=b();return this.addTo(a,c),c}function Aa(a){var c=b();return this.subTo(a,c),c}function Ba(a){var c=b();return this.multiplyTo(a,c),c}function Ca(){var a=b();return this.squareTo(a),a}function Da(a){var c=b();return this.divRemTo(a,c,null),c}function Ea(a){var c=b();return this.divRemTo(a,null,c),c}function Fa(a){var c=b(),d=b();return this.divRemTo(a,c,d),new Array(c,d)}function Ga(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Ha(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}}function Ia(){}function Ja(a){return a}function Ka(a,b,c){a.multiplyTo(b,c)}function La(a,b){a.squareTo(b)}function Ma(a){return this.exp(a,new Ia)}function Na(a,b,c){var d=Math.min(this.t+a.t,b);for(c.s=0,c.t=d;d>0;)c[--d]=0;var e;for(e=c.t-this.t;e>d;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(e=Math.min(a.t,b);e>d;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()}function Oa(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;--d>=0;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)}function Pa(c){this.r2=b(),this.q3=b(),a.ONE.dlShiftTo(2*c.t,this.r2),this.mu=this.r2.divide(c),this.m=c}function Qa(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var c=b();return a.copyTo(c),this.reduce(c),c}function Ra(a){return a}function Sa(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function Ta(a,b){a.squareTo(b),this.reduce(b)}function Ua(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function Va(a,c){var d,e,f=a.bitLength(),g=k(1);if(0>=f)return g;d=18>f?1:48>f?3:144>f?4:768>f?5:6,e=8>f?new C(c):c.isEven()?new Pa(c):new J(c);var h=new Array,i=3,j=d-1,l=(1<<d)-1;if(h[1]=e.convert(this),d>1){var m=b();for(e.sqrTo(h[1],m);l>=i;)h[i]=b(),e.mulTo(m,h[i-2],h[i]),i+=2}var n,o,p=a.t-1,q=!0,s=b();for(f=r(a[p])-1;p>=0;){for(f>=j?n=a[p]>>f-j&l:(n=(a[p]&(1<<f+1)-1)<<j-f,p>0&&(n|=a[p-1]>>this.DB+f-j)),i=d;0==(1&n);)n>>=1,--i;if((f-=i)<0&&(f+=this.DB,--p),q)h[n].copyTo(g),q=!1;else{for(;i>1;)e.sqrTo(g,s),e.sqrTo(s,g),i-=2;i>0?e.sqrTo(g,s):(o=g,g=s,s=o),e.mulTo(s,h[n],g)}for(;p>=0&&0==(a[p]&1<<f);)e.sqrTo(g,s),o=g,g=s,s=o,--f<0&&(f=this.DB-1,--p)}return e.revert(g)}function Wa(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(b.compareTo(c)<0){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(0>f)return b;for(f>e&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));b.signum()>0;)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c}function Xa(a){if(0>=a)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(0==b)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a;return c}function Ya(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return a.ZERO;for(var d=b.clone(),e=this.clone(),f=k(1),g=k(0),h=k(0),i=k(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),c?(f.isEven()&&g.isEven()||(f.addTo(this,f),g.subTo(b,g)),f.rShiftTo(1,f)):g.isEven()||g.subTo(b,g),g.rShiftTo(1,g);for(;e.isEven();)e.rShiftTo(1,e),c?(h.isEven()&&i.isEven()||(h.addTo(this,h),i.subTo(b,i)),h.rShiftTo(1,h)):i.isEven()||i.subTo(b,i),i.rShiftTo(1,i);d.compareTo(e)>=0?(d.subTo(e,d),c&&f.subTo(h,f),g.subTo(i,g)):(e.subTo(d,e),c&&h.subTo(f,h),i.subTo(g,i))}return 0!=e.compareTo(a.ONE)?a.ZERO:i.compareTo(b)>=0?i.subtract(b):i.signum()<0?(i.addTo(b,i),i.signum()<0?i.add(b):i):i}function Za(a){var b,c=this.abs();if(1==c.t&&c[0]<=dc[dc.length-1]){for(b=0;b<dc.length;++b)if(c[0]==dc[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<dc.length;){for(var d=dc[b],e=b+1;e<dc.length&&ec>d;)d*=dc[e++];for(d=c.modInt(d);e>b;)if(d%dc[b++]==0)return!1}return c.millerRabin(a)}function $a(c){var d=this.subtract(a.ONE),e=d.getLowestSetBit();if(0>=e)return!1;var f=d.shiftRight(e);c=c+1>>1,c>dc.length&&(c=dc.length);for(var g=b(),h=0;c>h;++h){g.fromInt(dc[Math.floor(Gb.Util.random()*dc.length)]);var i=g.modPow(f,this);if(0!=i.compareTo(a.ONE)&&0!=i.compareTo(d)){for(var j=1;j++<e&&0!=i.compareTo(d);)if(i=i.modPowInt(2,this),0==i.compareTo(a.ONE))return!1;if(0!=i.compareTo(d))return!1}}return!0}function _a(){this.i=0,this.j=0,this.S=new Array}function ab(a){var b,c,d;for(b=0;256>b;++b)this.S[b]=b;for(c=0,b=0;256>b;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function bb(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function cb(){return new _a}function db(a){gc[hc++]^=255&a,gc[hc++]^=a>>8&255,gc[hc++]^=a>>16&255,gc[hc++]^=a>>24&255,hc>=ic&&(hc-=ic)}function eb(){db((new Date).getTime())}function fb(){if(null==fc){for(eb(),fc=cb(),fc.init(gc),hc=0;hc<gc.length;++hc)gc[hc]=0;hc=0}return fc.next()}function gb(a){var b;for(b=0;b<a.length;++b)a[b]=fb()}function hb(){}function ib(b,c){return new a(b,c)}function jb(b,c){if(c<b.length+11)return null;for(var d=new Array,e=b.length-1;e>=0&&c>0;){var f=b.charCodeAt(e--);128>f?d[--c]=f:f>127&&2048>f?(d[--c]=63&f|128,d[--c]=f>>6|192):(d[--c]=63&f|128,d[--c]=f>>6&63|128,d[--c]=f>>12|224)}d[--c]=0;for(var g=new hb,h=new Array;c>2;){for(h[0]=0;0==h[0];)g.nextBytes(h);d[--c]=h[0]}return d[--c]=2,d[--c]=0,new a(d)}function kb(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function lb(a,b){this.n=ib(a,16),this.e=parseInt(b,16)}function mb(a){return a.modPowInt(this.e,this.n)}function nb(a){var b=jb(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPrivate(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}function ob(a,b){for(var c=a.toByteArray(),d=0;d<c.length&&0==c[d];)++d;if(c.length-d!=b-1||2!=c[d])return null;for(++d;0!=c[d];)if(++d>=c.length)return null;for(var e="";++d<c.length;){var f=255&c[d];128>f?e+=String.fromCharCode(f):f>191&&224>f?(e+=String.fromCharCode((31&f)<<6|63&c[d+1]),++d):(e+=String.fromCharCode((15&f)<<12|(63&c[d+1])<<6|63&c[d+2]),d+=2)}return e}function pb(a,b,c){this.n=ib(a,16),this.e=parseInt(b,16),this.d=ib(c,16)}function qb(a,b,c,d,e,f,g,h){this.n=ib(a,16),this.e=parseInt(b,16),this.d=ib(c,16),this.p=ib(d,16),this.q=ib(e,16),this.dmp1=ib(f,16),this.dmq1=ib(g,16),this.coeff=ib(h,16)}function rb(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);for(var b=a.mod(this.p).modPow(this.dmp1,this.p),c=a.mod(this.q).modPow(this.dmq1,this.q);b.compareTo(c)<0;)b=b.add(this.p);return b.subtract(c).multiply(this.coeff).mod(this.p).multiply(this.q).add(c)}function sb(a){var b=ib(a,16),c=this.doPublic(b);return null==c?null:ob(c,this.n.bitLength()+7>>3)}function tb(a,b,c){var d=0,e=0,f=b.split("\n"),g=2*a.measureText("e").width;return f.forEach(function(b){if(c){var f,h,i,j,k,l=b.split(" "),m=l.length,n="";for(i=0;m>i;i++)if(f=l[i]+(i===m-1?"":" "),h=n+f,j=a.measureText(h).width,c>j)n=h;else if(j==c)n="",e+=g;else{for(k=0;k<f.length;k++)if(h=n+f.substr(0,k+1),a.measureText(h).width>c){n=f.substring(k,f.length),e+=g;break}for(;n.length>0&&a.measureText(n).width>c;)for(k=0;k<n.length;k++)if(h=n.substr(0,k+1),a.measureText(h).width>c){n=n.substring(k,n.length),e+=g;break}}}else j=a.measureText(b).width,d=j>d?j:d;e+=g}),d=c?c:d,{w:d,h:e}}function ub(a,b,c,d){var e,f=a.animate,g=d._now,h=d._shapeDataIndex,i=c._animates;if(i||(i=c._animates={}),h.length)for(var j=0;j<h.length;j++){e=h[j];var k=i[e];k||(k=i[e]={}),i=k}else e=h;var l=i[e];l||(l=i[e]={},f.forEach(function(e){var f,h=e.attr,i=l[h];e={attr:h,to:e.to,type:e.type||"number",delay:e.delay||0,dur:e.dur||1e3,interval:e.interval||0,finish:e.finish,repeat:e.repeat||1,reverse:null==e.reverse?!0:e.reverse,onDone:e.onDone,easing:e.easing,trigger:null==e.to,start:g,time:0,total:0,count:0,started:!1,stopped:!1,current:null},Array.isArray(e.dur)&&(e.groupDur=e.dur.slice(0,e.dur.length-1),e.dur=e.dur[e.dur.length-1],e.groupDurTotal=e.groupDur.reduce(function(a,b,c){return e.groupDur[c]=a+b},0),e.groupIndex=0,e.groupTime=0,e.groupStart=g),null==e.finish&&(e.finish=e.delay+e.dur+e.interval),i?Array.isArray(i)?(i.push(e),i=i[i.length-2]):l[h]=[i,e]:(f=Xc(c,b,a,h,d),l[h]=e),i&&(f=i.to,"group_set"===i.type&&(f=f[f.length-1])),e.from=f,e.trigger||(e.started=!0,Db(e),Eb(e))})),f=l,Object.keys(f).forEach(function(e){var h=f[e];if(Array.isArray(h)){var i=h[h.length-1];i.count+1===i.repeat?h.forEach(function(e){vb(e,a,b,c,d,!0)}):i.count+1<i.repeat&&(i.total>=i.finish&&h.forEach(function(a){a.trigger||(a.started=!0),a.stopped=!1,a.time=0,a.start=g,a.total=0,"group_set"===a.type&&(a.groupIndex=0,a.groupTime=0,a.groupStart=g)}),h.forEach(function(e){vb(e,a,b,c,d,!1)}))}else vb(h,a,b,c,d,!0)})}function vb(a,b,c,d,e,f){if(a.trigger){var g=Xc(d,c,b,a.attr,e,null,!1);if(!a.started){if(g===a.from)return;a.started=!0,a.start=e._now,a.to=g,Db(a),Eb(a)}a.started&&g!==a.to&&(a.start=e._now,a.from=a.current,a.to=g,a.time=0,a.total=0,a.count=0,Db(a),Eb(a))}if(a.started&&!a.stopped){var h=e._now,i=h-a.start;if(i>=a.delay&&(a.total=i,i-=a.delay,a.time=i>a.dur?a.dur:i,"group_set"===a.type&&(a.groupTime=h-a.groupStart,a.groupStart===a.start&&(a.groupTime-=a.delay),a.groupTime>=a.groupDur[a.groupIndex]&&a.groupIndex++,a.groupTime>=a.groupDurTotal&&(a.groupIndex=0,a.groupTime=a.groupTime-a.groupDurTotal,a.groupStart=h)),a.total>=a.finish))if(a.count++,"group_set"===a.type,a.count>=a.repeat)a.time=a.dur,a.stopped=!0,a.trigger&&(a.from=a.to,a.to=null,a.start=null,a.time=0,a.total=0,a.count=0,a.started=!1,a.stopped=!1),a.onDone&&a.onDone.call(c,d,e);else if(f&&(a.time=0,a.start=h,a.total=0,a.reverse)){var j=a.from;a.from=a.to,a.to=j,Eb(a)}e&&!e._invalidate&&(e._invalidate=!0)}}function wb(a){if(!gd[a.id]){if(id=!0,gd[a.id]=a,null==a.from&&a.attr&&a.source){var b;a.from=(b=a.attr.match(/^S[:@](.*)/i))?a.source.getStyle(b[1]):(b=a.attr.match(/^C[:@](.*)/i))?a.source.getClient(b[1]):Gb.Util.getValue(a.source,a.attr)}Db(a),Eb(a)}return a.resume(),a}function xb(a,b){return gd[a.id]&&(null==b&&(b=!0),b&&Cb(a,a.to),a.onStop&&a.onStop(),a.time=0,a.total=0,a.start=null,a.count=0,a.started=!1,a.stopped=!1,a.paused=!1,a.pausedTime=null,a.pausedTotal=0,a._oldSpeed=null,a._speedTotal=0,a._speedTime=null,a._percent=0,a._percentSet=null,a._percentDiff=0,delete gd[a.id]),a}function yb(a){null==a&&(a=!0),Object.keys(gd).forEach(function(b){var c=gd[b];c&&(a&&Cb(c,c.to),c.onStop&&c.onStop())}),gd={}}function zb(){Object.keys(gd).forEach(function(a){var b=gd[a];b&&b.pause()})}function Ab(){Object.keys(gd).forEach(function(a){var b=gd[a];b&&b.resume()})}function Bb(a){Object.keys(gd).forEach(function(b){var c=gd[b];if(c&&(null==c.start&&(c._speedTime=c.start=a),null!=c._percentSet&&(c._percentDiff+=(c._percentSet-c._percent)*c.finish),!c.paused||(c.pausedTime||(c.pausedTime=a),null!=c._percentSet))){if(null==c._percentSet&&c.pausedTime&&(c.pausedTotal+=(a-c.pausedTime)*(c._oldSpeed||c._speed),c.pausedTime=null),c._oldSpeed&&!c.pausedTime&&(c._speedTotal=(a-c._speedTime)*c._oldSpeed-c.pausedTotal+c._percentDiff+c._speedTotal,c._percentDiff=0,c.pausedTotal=0,c._speedTime=a,c._oldSpeed=null),c.total=(a-c._speedTime)*c._speed-c.pausedTotal+c._percentDiff+c._speedTotal,null!=c._percentSet&&c.pausedTime&&(c.total-=(a-c.pausedTime)*(c._oldSpeed||c._speed)),c._percent=c.total>=c.finish?1:c.total/c.finish,c.total>c.delay){c.time=c.total-c.delay;var d=!1;if(c.time>=c.dur&&(c.time=c.dur,c.total>=c.finish&&(d=!0)),!c.stopped&&Cb(c,Fb(c)),c.stopped=d,c.total>=c.finish)if(c.count++,c.count>=c.repeat)xb(c,!1),c.onDone&&c.onDone();else if(c.time=0,c.total=0,c.start=null,c.stopped=!1,c.reverse){var e=c.from;c.from=c.to,c.to=e,Eb(c)}}c.paused||!id&&(id=!0),null!=c._percentSet&&(c._percentSet=null)}})}function Cb(a,b){if(a.started||(a.started=!0,a.onPlay&&a.onPlay()),a.filter&&(b=a.filter(b)),a.attr&&a.source){var c;(c=a.attr.match(/^S[:@](.*)/i))?a.source.setStyle(c[1],b):(c=a.attr.match(/^C[:@](.*)/i))?a.source.setClient(c[1],b):Gb.Util.setValue(a.source,a.attr,b)}a.onUpdate&&a.onUpdate(b)}function Db(a){var b=a.type,c=a.from,d=a.to;"number"===b?(a.from=c||0,a.to=d||0):"point"===b?(c?c.length&&(a.from={x:c[0],y:c[1]}):a.from="scale"===a.attr?{x:1,y:1}:{x:0,y:0},d?d.length&&(a.to={x:d[0],y:d[1]}):a.to="scale"===a.attr?{x:1,y:1}:{x:0,y:0}):"rect"===b?(c?c.length&&(a.from={x:c[0],y:c[1],w:c[2],h:c[3]}):a.from={x:0,y:0,w:0,h:0},d?d.length&&(a.to={x:d[0],y:d[1],w:d[2],h:d[3]}):a.to={x:0,y:0,w:0,h:0}):"color"===b&&(a.from=rd(c),a.to=rd(d)),a.current=a.from}function Eb(a){var b=a.type,c=a.from,d=a.to;"number"===b?a.delta=d-c:"point"===b?a.delta={x:d.x-c.x,y:d.y-c.y}:"rect"===b?a.delta={x:d.x-c.x,y:d.y-c.y,w:d.w-c.w,h:d.h-c.h}:"color"===b&&(a.delta={r:d.r-c.r,g:d.g-c.g,b:d.b-c.b,a:d.a-c.a})}function Fb(a,b){var c=a.type,d=a.delta,e=a.from,f=a.time,g=a.dur,h=jd[a.easing||"easeNone"];return h||(h=jd.easeNone),"number"===c?b=h(f,e,d,g):"point"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g)}:"rect"===c?b={x:h(f,e.x,d.x,g),y:h(f,e.y,d.y,g),w:h(f,e.w,d.w,g),h:h(f,e.h,d.h,g)}:"color"===c?b="rgba("+Math.floor(h(f,e.r,d.r,g))+","+Math.floor(h(f,e.g,d.g,g))+","+Math.floor(h(f,e.b,d.b,g))+","+Math.floor(h(f,e.a,d.a,g))+")":"set"===c?a.time&&(b=a.to):"group_set"===c&&(b=a.to[a.groupIndex]),a.current=b,b}window.twaver&&(window.twaver.animateLoopId&&cancelAnimationFrame(window.twaver.animateLoopId),window.twaver.animateLoopId=null),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.indexOf(a,b)===b});var Gb={};Gb._isInitializing=!1;var Hb={isDeserializing:!1,isCalculatingBus:!1,images:{},registerImage:function(a,b,c,d,e){Hb.images[a]=new Gb.ImageAsset(a,b,c,d,e),xd(a)},getRegisteredImageNames:function(){return Object.keys(Hb.images)},unregisterImage:function(a){delete Hb.images[a]},getImageAsset:function(a){if("string"==typeof a){var b=Hb.images[a];return b}},showVersion:function(a){Hb.isCtrlDown(a)&&a.shiftKey&&76==a.keyCode&&alert("TWaver HTML5 "+Gb.Util.getVersion()+"\n"+Ib)},callLater:function(a,b,c,d){return setTimeout(function(){a.apply(b,c)},d||Dd.CALL_LATER_DELAY)},isEmptyObject:function(a){for(var b in a)return!1;return!0},xml:function(a){if(window.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");var b=new ActiveXObject("Microsoft.XmlDOM");return b.async=!1,b.loadXml(a),b},num:function(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)},getter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1),c=/ble$/.test(a)||/ed$/.test(a)?"is":"get";return c+b},setter:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return"set"+b},_id:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],id:function(){for(var a=[],b=0;32>b;b++)a[b]=this._id[Math.floor(16*Gb.Util.random())];return a[12]="4",a[16]=this._id[3&a[16]|8],a.join("")},keys:function(a){var b=new md;for(var c in a)b.add(c);return b},es:["toString","toLocaleString","valueOf"],ip:function(a,b){var c="_"+b;a[Hb.getter(b)]=function(){return this[c]},a[Hb.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},validateLicense:function(a){Ib=a,lc()},ibool:function(a,b){var c="_"+b,d=b.charAt(0).toUpperCase()+b.slice(1);a["is"+d]=function(){return this[c]},a[Hb.setter(b)]=function(a){var d=this[c];this[c]=a,this.firePropertyChange(b,d,a)}},getValue:function(a,b,c){var d=b.charAt(0).toUpperCase()+b.slice(1),e="get"+d,f="is"+d;return c?"boolean"===c?a[f]():a[e]():a[e]?a[e]():a[f]?a[f]():a[b]},setValue:function(a,b,c){a["set"+b.charAt(0).toUpperCase()+b.slice(1)](c)},clone:function(a){if(!a)return null;var b={};for(var c in a)b[c]=a[c];return b},cloneRect:function(a){return a?{x:a.x,y:a.y,width:a.width,height:a.height}:null},classCache:{},getClass:function(a){var b=Hb.classCache[a];if(!b){var c=a.split("."),d=c.length;b=window;for(var e=0;d>e;e++)b=b[c[e]],b||"twaver"===c[e]&&(b=Gb);Hb.classCache[a]=b}return b},newInstance:function(a){var b=Hb.getClass(a)||window[a];if(!b)return null;var c=arguments.length,d=arguments;if(1===c)return new b;if(2===c)return new b(d[1]);if(3===c)return new b(d[1],d[2]);if(4===c)return new b(d[1],d[2],d[3]);if(5===c)return new b(d[1],d[2],d[3],d[4]);if(6===c)return new b(d[1],d[2],d[3],d[4],d[5]);if(7===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6]);if(8===c)return new b(d[1],d[2],d[3],d[4],d[5],d[6],d[7]);throw"don't support args more than 7"},addMethod:function(a,b){var c=a.prototype;for(var d in b)c[d]=b[d]},ext:function(a,b,c){var d;if("string"==typeof a&&(d=a,a=Hb.getClass(a)),b){var e=function(){};e.prototype=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.superClass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}if(d&&(a.prototype.getClassName=function(){return d}),c){var f=a.prototype;for(var g in c)Pb.ext(g,f,c);for(var h=Hb.es.length,i=0;h>i;i++)g=Hb.es[i],c.hasOwnProperty(g)&&!c.propertyIsEnumerable(g)&&(f[g]=c[g])}},setViewBounds:function(a,b){if(a)if(a.adjustBounds)a.adjustBounds(b);else{var c=a.style;!c&&a.getView()&&(c=a.getView().style),c&&(c.position="absolute",c.left=b.x+"px",c.top=b.y+"px",c.width=b.width+"px",c.height=b.height+"px")}},getImageSrc:function(a){var b=Hb.getImageAsset(a);return b?b.getSrc()?b.getSrc():b.getImage().getAttribute("src"):a},nextColorCount:0,nextColor:function(){return Hb.nextColorCount>=Dd.COLORS.length&&(Hb.nextColorCount=0),Dd.COLORS[Hb.nextColorCount++]},isCtrlDown:function(a){return a.ctrlKey||a.metaKey},isShiftDown:function(a){return a.shiftKey},isAltDown:function(a){return a.altKey},setText:function(a,b,c){c?Ob.isFirefox?a.textContent=b:a.innerText=b:a.innerHTML=b},fillDescendant:function(a,b){b.add(a),a.hasChildren()&&a.getChildren().forEach(function(a){Hb.fillDescendant(a,b)})}},Ib=(Date,"l=1.0\ntype=1\ngis=1\n3d=0\nstart=2017-09-20\nend=2018-01-01\nnote=This license applies to the evaluation version of TWaver. The License is limited to noncommercial use. Noncommercial use relates only to educational, research, personal or evaluation purposes. Any other use is commercial use. You may not use the Software in connection with any business activities.And You are not permitted to modify the software or attempt to decipher, decompile, disassemble or reverse engineer this Software.\nsignature=09a0fe6db4f94641fff748c963550fca8129892b7592d27af2c5083ebe831f1391cf65119c0d6ddb3da650dcebe957097ae3973ee42ebeca0df5b985fb72a8aa876e3a92336656799af97eaab4169bacfbc28b05a6f056bb5c11c5801814f81f212f7d0fa7dafd76af2395a9b8dd8117c3a2c1c4eb25b6358f1374f988475d3b2d7538342bcebac3757a282cb569aaf67960f137270d5ce5e93a3bbb9c1f83bd98a3a888f35e7c2a02bf045c57e04cd83a1d1a3d78ff4b954468ccb8df6a98093459dce2a8fe8a5d759c190f3d4ffe78ed9fd14576ad4e54226bad755fed3aa2b9e079884a71b7ba3bfbf91057b8324a6ba6128540b2d2e6730b5163314d27420cc71013482a7db97409fe80b9aeb5bfbebd0300c276a94b8f327158dba22f839bd841355fca03acacfc0027dd8ba46121aa205dbe1211e781c35736e6838158c4a2a821af6d98507e91970291bc0ab136b6900494c031c471fd374b5a60be7d682a3d076057e0ceb7adadc5ef4803d8d3c4b9f850d8ba2b8fad2f1c8db4582431a144bb07f66b650492ea10386195ba1993e6b94a6a31402dfa9cd62ac2c64415e2e4f30f81de10431d6990d4955a90d5c986f678f020fab84afc3833ca0c9f25fa3ed3ab36d16aaffdfc6e6e15b645c70295767c1c7093fe29a7a6a4891f46593bd7bc4ce6622a0a4694988b198c5e5fbaf76ed70a720ed07d307358a6618c300011a01bcebb56e13e8645b54c1f6ab6a61abc3aa70992231ed66b1a5572cdc6450af35e44e7cdcbcd956961fa1a933f9b7d5b4530da587dcc794a0e7a0861e4d9199164430bab5efaf2e2aa9bf86923ab4d72e606d39a86102445f90a0e97f2fc55654b6b8cbbfa8ebe0acced36a3944d1200cc90dd90dafd7b7a3aa6fe08");"function"==typeof define?define(function(){return Gb}):"object"==typeof exports&&(module.exports=Gb),window&&(window.twaver=Gb,window._twaver=Hb),Gb.animate={},Gb.network={},Gb.network.interaction={},Gb.controls={},Gb.charts={},Gb.layout={};var Jb,Kb,Lb=window.navigator,Mb=window.document,Nb=window.Image;window.document||(Kb=!0,Jb=function(){},Nb=Jb.Image,Lb={userAgent:""},Mb={});var Ob=function(){var a={},b=Lb.userAgent.toLowerCase();return a.isOpera=/opera/.test(b),a.isIE=/msie/.test(b)||/trident/.test(b)||/edge/.test(b),a.isFirefox=/firefox/i.test(b),a.isChrome=/chrome/i.test(b),a.isSafari=!a.isChrome&&/safari/i.test(b),a.isIPhone=/iphone/.test(b),a.isIPod=/ipod/.test(b),a.isIPad=/ipad/.test(b),a.isAndroid=/android/i.test(b),a.isWebOS=/webos/i.test(b),a.isMSTouchable=a.isIE&&(Lb.msMaxTouchPoints&&Lb.msMaxTouchPoints>1||Lb.maxTouchPoints&&Lb.maxTouchPoints>1),a.isTouchable="ontouchend"in Mb||a.isMSTouchable,a}();Hb.ua=Ob;var Pb={__accessor:function(a,b){for(var c=b.__accessor,d=c.length,e=0;d>e;e++)Hb.ip(a,c[e])},__bool:function(a,b){for(var c=b.__bool,d=c.length,e=0;d>e;e++)Hb.ibool(a,c[e])},__client:function(a,b){a.getClient=function(a){return this._clientMap[a]},a.setClient=function(a,b){var c=this._clientMap[a];return null==b?delete this._clientMap[a]:this._clientMap[a]=b,this.firePropertyChange("C:"+a,c,b)&&this.onClientChanged(a,c,b),this},a.getClientProperties=function(){return Hb.keys(this._clientMap)},a.getClientMap=function(){return this._clientMap},a.onClientChanged=function(a,b,c){}},__style:function(a,b){a.getStyle=function(a){var b=this._styleMap[a];return null==b?Ed._m[a]:b},a.setStyle=function(a,b){var c=this._styleMap[a];return null==b?delete this._styleMap[a]:this._styleMap[a]=b,this.firePropertyChange("S:"+a,c,b)&&this.onStyleChanged(a,c,b),this},a.getStyleProperties=function(){return Hb.keys(this._styleMap);

},a.onStyleChanged=function(a,b,c){}},__new:function(a,b){a.newInstance=function(){var a=Hb.getClass(this.getClassName());if(!a)return null;var b=arguments.length,c=arguments;if(0===b)return new a;if(1===b)return new a(c[0]);if(2===b)return new a(c[0],c[1]);if(3===b)return new a(c[0],c[1],c[2]);if(4===b)return new a(c[0],c[1],c[2],c[3]);if(5===b)return new a(c[0],c[1],c[2],c[3],c[4]);if(6===b)return new a(c[0],c[1],c[2],c[3],c[4],c[5]);if(7===b)return new a(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);throw"don't support args more than 7"}},__property:function(a,b){a.getValue=function(a,b){return"accessor"===this._propertyType?Hb.getValue(a,this._propertyName):"style"===this._propertyType&&a.getStyle?a.getStyle(this._propertyName):"client"===this._propertyType&&a.getClient?a.getClient(this._propertyName):"field"===this._propertyType?a[this._propertyName]:null},a.setValue=function(a,b,c){if("accessor"===this._propertyType)a[Hb.setter(this._propertyName)](b);else{if("style"===this._propertyType&&a.setStyle)return a.setStyle(this._propertyName,b);if("client"===this._propertyType&&a.setClient)return a.setClient(this._propertyName,b);"field"===this._propertyType&&(a[this._propertyName]=b)}}},map:{__accessor:1,__bool:1,__client:1,__style:1,__new:1,__tree:1,__property:1},ext:function(a,b,c){1===Pb.map[a]?Pb[a](b,c):b[a]=c[a]}};Hb.extend=Pb;var Qb=Hb.Matrix=function(a,b,c,d,e,f){this.setMatrix(a,b,c,d,e,f)};Qb.identity=function(){return new Qb(1,0,0,1,0,0)},Qb.prototype.setMatrix=function(a,b,c,d,e,f){this._m11=a,this._m12=b,this._m21=c,this._m22=d,this._offsetX=e,this._offsetY=f,this._type=0,0!=this._m21||0!=this._m12?this._type=4:((1!=this._m11||1!=this._m22)&&(this._type=2),(0!=this._offsetX||0!=this._offsetY)&&(this._type|=1),0==(3&this._type)&&(this._type=0))},Qb.prototype.transform=function(){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!a||!Hb.num(a.x)||!Hb.num(a.y))throw"arguments should contain x, y";switch(this._type){case 0:return{x:a.x,y:a.y};case 1:return{x:this._offsetX+a.x,y:this._offsetY+a.y};case 2:return{x:a.x*this._m11,y:a.y*this._m22};case 3:return{x:a.x*this._m11+this._offsetX,y:a.y*this._m22+this._offsetY}}return{x:this._m11*a.x+a.y*this._m21+this._offsetX,y:this._m22*a.y+a.x*this._m12+this._offsetY}},Qb.prototype.translate=function(a,b){this.multiply(new Qb(1,0,0,1,a,b))},Qb.prototype.scale=function(a,b){this.multiply(new Qb(a,0,0,b,0,0))},Qb.prototype.rotate=function(a,b,c){a=a*Math.PI/180;var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;this.multiply(new Qb(e,d,-d,e,f,g))},Qb.prototype.skew=function(a,b){this.multiply(new Qb(1,Math.tan(b*Math.PI/180),Math.tan(a*Math.PI/180),1,0,0))},Qb.prototype.multiply=function(a){var b=this,c=a,d=b._type,e=c._type;if(0!=e)if(0==d)b.setMatrix(c._m11,c._m12,c._m21,c._m22,c._offsetX,c._offsetY);else if(1==e)b._offsetX+=c._offsetX,b._offsetY+=c._offsetY,4!=d&&(b._type|=1);else if(1==d){var f=b._offsetX,g=b._offsetY;b.setMatrix(c._m11,c._m12,c._m21,c._m22,c._offsetX,c._offsetY),b._offsetX=f*c._m11+g*c._m21+c._offsetX,b._offsetY=f*c._m12+g*c._m22+c._offsetY,b._type=4==e?4:3}else switch(d<<4|e){case 34:return b._m11*=c._m11,void(b._m22*=c._m22);case 35:return b._m11*=c._m11,b._m22*=c._m22,b._offsetX=c._offsetX,b._offsetY=c._offsetY,void(b._type=3);case 36:case 52:case 66:case 67:case 68:return void b.setMatrix(b._m11*c._m11+b._m12*c._m21,b._m11*c._m12+b._m12*c._m22,b._m21*c._m11+b._m22*c._m21,b._m21*c._m12+b._m22*c._m22,b._offsetX*c._m11+b._offsetY*c._m21+c._offsetX,b._offsetX*c._m12+b._offsetY*c._m22+c._offsetY);case 50:return b._m11*=c._m11,b._m22*=c._m22,b._offsetX*=c._m11,void(b._offsetY*=c._m22);case 51:return b._m11*=c._m11,b._m22*=c._m22,b._offsetX=c._m11*b._offsetX+c._offsetX,void(b._offsetY=c._m22*b._offsetY+c._offsetY);default:console.log("Matrix multiply hit an invalid case: "+combinedType)}};var Rb={getDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},getCenterPoint:function(a,b){return a&&b?{x:(a.x+b.x)/2,y:(a.y+b.y)/2}:null==b&&a.width?{x:a.x+a.width/2,y:a.y+a.height/2}:void 0},isPointInPolygon:function(a,b){a=a._as?a._as:a;var c=0,d=0,e=!1,f=a.length;for(c=0,d=f-1;f>c;d=c++){var g=a[c],h=a[d];g.y>b.y!=h.y>b.y&&b.x<(h.x-g.x)*(b.y-g.y)/(h.y-g.y)+g.x&&(e=!e)}return e},unionRect:function(a,b){if(a&&!b)return Hb.cloneRect(a);if(!a&&b)return Hb.cloneRect(b);if(a&&b){var c=Math.min(a.x,b.x),d=Math.min(a.y,b.y),e=Math.max(a.x+a.width,b.x+b.width)-c,f=Math.max(a.y+a.height,b.y+b.height)-d;return a.x=c,a.y=d,a.width=e,a.height=f,a}return null},intersects:function(a,b){if(!a||!b)return!1;var c=b.width,d=b.height,e=a.width,f=a.height;if(0>=e||0>=f||0>=c||0>=d)return!1;var g=b.x,h=b.y,i=a.x,j=a.y;return e+=i,f+=j,c+=g,d+=h,(i>e||e>g)&&(j>f||f>h)&&(g>c||c>i)&&(h>d||d>j)},intersection:function(a,b){if(!a||!b)return!1;var c=b.x,d=b.y,e=a.x,f=a.y,g=c;g+=b.width;var h=d;h+=b.height;var i=e;i+=a.width;var j=f;return j+=a.height,e>c&&(c=e),f>d&&(d=f),g>i&&(g=i),h>j&&(h=j),g-=c,h-=d,0===g||0===h?null:{x:c,y:d,width:g,height:h}},contains:function(a,b){var c=b.x,d=b.y,e=b.width,f=b.height,g=a.width,h=a.height;if(0>(g|h|e|f))return!1;var i=a.x,j=a.y;if(i>c||j>d)return!1;if(g+=i,e+=c,c>=e){if(g>=i||e>g)return!1}else if(g>=i&&e>g)return!1;if(h+=j,f+=d,d>=f){if(h>=j||f>h)return!1}else if(h>=j&&f>h)return!1;return!0},getLinePoints:function(a){if(!a)return null;var b=new md;return a.forEach(function(a){b.addAll(a)}),b},getLineRect:function(a){var b=Rb.getLinePoints(a);return Rb.getRect(b)},getRect:function(a,b){if(!a)return null;a._as&&(a=a._as);var c=a.length;if(0>=c)return null;var d=a[0];b=b||{x:null,y:null,width:0,height:0};for(var e=0;c>e;e++)if(d=a[e],d instanceof md)Rb.getRect(d,b);else{null==b.x&&(b.x=d.x,b.y=d.y);var f=Math.min(b.x,d.x),g=Math.min(b.y,d.y),h=Math.max(b.x+b.width,d.x),i=Math.max(b.y+b.height,d.y);b.x=f,b.y=g,b.width=h-f,b.height=i-g}return b},addPadding:function(a,b,c,d){d=d||-1;var e=b.getStyle(c)*d;0!=e&&Rb.grow(a,e,e),e=b.getStyle(c+".left")*d,0!=e&&(a.x-=e,a.width+=e),e=b.getStyle(c+".right")*d,0!=e&&(a.width+=e),e=b.getStyle(c+".top")*d,0!=e&&(a.y-=e,a.height+=e),e=b.getStyle(c+".bottom")*d,0!=e&&(a.height+=e),a.width<0&&(a.width=-a.width,a.x-=a.width),a.height<0&&(a.height=-a.height,a.y-=a.height)},grow:function(a,b,c){if(null==a)return null;null==c&&(c=b);var d=a.width+b+b;if(!(0>d)){var e=a.height+c+c;if(!(0>e))return a.x-=b,a.y-=c,a.width=d,a.height=e,a}},containsPoint:function(a,b,c){return arguments.length<3&&(c=b.y,b=b.x),!a||b<a.x||c<a.y||b>a.x+a.width||c>a.y+a.height?!1:!0},getHotSpot:function(a,b,c,d,e){if("oval"===e){var f=.35;return{x:a+.5*c+c*f,y:b+d/2-Math.sqrt(.25-f*f)*d}}if("circle"===e){var g=a+c/2,h=b+d/2,i=Math.min(c,d)/2;a=g-i,b=h-i,c=2*i,d=2*i;var j=c/2,k=d/2,l=j*k/Math.sqrt(j*j+k*k);return{x:a+c/2+l,y:b+d/2-l}}var m={x:a+c,y:b};return c>3&&(m.x-=3),d>3&&(m.y+=3),m},getCircleRect:function(a){var b=Math.min(a.width,a.height)/2;return{x:a.x+a.width/2-b,y:a.y+a.height/2-b,width:2*b,height:2*b}},getEllipsePoint:function(a,b){if(!a||!b)return null;var c=a.x+a.width/2,d=a.y+a.height/2,e=b.x-c,f=b.y-d,g=a.width/2,h=a.height/2,i=Math.sqrt(1/(1/g/g+f*f/e/e/h/h));0>e&&(i=-i);var j;return j=0==e?f>0?h:-h:i*f/e,{x:c+i,y:d+j}},createMatrix:function(a,b,c){var d=Math.sin(a),e=Math.cos(a),f=b*(1-e)+c*d,g=c*(1-e)-b*d;return new Qb(e,d,-d,e,f,g)},calculatePointInfoAlongLineBySegments:function(a,b,c,d,e){return Rb.calculatePointInfoAlongLine(Rb.getPointObject(a,b),c,d,e)},calculatePointInfoAlongLine:function(a,b,c,d){if(b=void 0===b?!0:b,c=c||0,d=d||0,!a||a.size()<2)throw"must more than two points";if(!b){var e=Rb.reversePath(a);return Rb.calculatePointInfoAlongLine(e,!0,c,d)}a._as&&(a=a._as);var f,g,h,i,j,k=0,l=0,m=a.length;for(i=0;m>i;i++)if(j=a[i],0!=i){if(0>=c){h=Rb.calculatePointInfoOnStraightLine(Rb._getPoint(g),Rb._getControlPoint(j),c,d),f=h;break}if(l=Rb._getLength(j,g),k+l>c){h=Rb.getPathInfo(j,g,c-k,d,l),f=h;break}k+=l,g=j}else g=j;if(null==f){var n,o;g=a[m-1],o=Rb._getPoint(g),g instanceof md&&(g=g._as),n=g instanceof Array?Rb._getControlPoint(g):Rb._getPoint(a[m-2]);var p=Math.atan2(o.y-n.y,o.x-n.x);h=Rb.transformPoint(o,p,c-k,d),h.angle=p,f=h}return f},reversePath:function(a){var b,c=new md,d=null;a._as&&(a=a._as);for(var e=a.length-1;e>=0;e--)b=a[e],c.add(Rb._getReversePath(b,d)),d=b;return c},_getPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-1]:a},_getControlPoint:function(a){return a._as&&(a=a._as),a instanceof Array?a[a.length-2]:a},_getReversePath:function(a,b){var c=Rb._getPoint(a);return b&&b._as&&(b=b._as),null!=b&&b instanceof Array?new md(2==b.length?[b[0],c]:[b[1],b[0],c]):c},_getLength:function(a,b){var c=Rb._getPoint(b),d=Rb._getPoint(a);if(a instanceof md&&(a=a._as),a instanceof Array)return Rb.calculateCurveLength(c,a,1);var e=d.y-c.y,f=d.x-c.x;return Math.sqrt(f*f+e*e)},getPathInfo:function(a,b,c,d,e){var f,g=Rb._getPoint(b),h=Rb._getPoint(a);if(a instanceof md&&(a=a._as),a instanceof Array){0>e&&(e=Rb._getLength(a,b));var i=c/e,j=Rb.calculatePointInfoOnCurveLine(g,a,i);g=j.point,f=j.angle,c=0}else f=Math.atan2(h.y-g.y,h.x-g.x);return Rb.transformPoint(g,f,c,d)},transformPoint:function(a,b,c,d){var e={x:c,y:d},f=Rb.createMatrix(b,0,0);return e=f.transform(e),e.x+=a.x,e.y+=a.y,{point:e,angle:b}},calculatePointInfoOnStraightLine:function(a,b,c,d){var e=Math.atan2(b.y-a.y,b.x-a.x);return Rb.transformPoint(a,e,c,d)},calculatePointInfoOnCurveLine:function(a,b,c){if(0>c||c>1)throw"Illegal arguments";return b._as&&(b=b._as),2==b.length?Rb._calculatePointInfoOnCurveLine2(a,b[0],b[1],c):Rb._calculatePointInfoOnCurveLine3(a,b[0],b[1],b[2],c)},_calculatePointInfoOnCurveLine2:function(a,b,c,d){var e=2*(a.x+c.x-2*b.x)*d+2*b.x-2*a.x,f=2*(a.y+c.y-2*b.y)*d+2*b.y-2*a.y,g=Math.atan2(f,e),h=(a.x+c.x-2*b.x)*d*d+(2*b.x-2*a.x)*d+a.x,i=(a.y+c.y-2*b.y)*d*d+(2*b.y-2*a.y)*d+a.y;return{point:{x:h,y:i},angle:g}},_calculatePointInfoOnCurveLine3:function(a,b,c,d,e){var f,g,h;f=1-e,g=f*f*f,h=e*e*e;var i=g*a.x+3*e*f*f*b.x+3*e*e*f*c.x+h*d.x,j=g*a.y+3*e*f*f*b.y+3*e*e*f*c.y+h*d.y;return{point:{x:i,y:j},angle:Math.atan2(Rb._bezeSpeedY(a,b,c,d,e),Rb._bezeSpeedX(a,b,c,d,e))}},calculateCurveLength:function(a,b,c){return b._as&&(b=b._as),2==b.length?Rb._calculateCurveLength(a,b[0],b[1],c):Rb._calculateBezierCurveLength(a,b[0],b[1],b[2],c)},_calculateCurveLength:function(a,b,c,d){if(0>=d||d>1)return 0;var e=Math.floor(d*(Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))+Math.sqrt((c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y)))/2),f=0;0>=e&&(e=1);for(var g,h,i=d/e,j=0,k=0;e>k;k++)j=i*k,g=2*(a.x+c.x-2*b.x)*j+2*b.x-2*a.x,h=2*(a.y+c.y-2*b.y)*j+2*b.y-2*a.y,g*=i,h*=i,f+=Math.sqrt(g*g+h*h);return f},_calculateBezierCurveLength:function(a,b,c,d,e){if(0>=e||e>1)return 0;var f=1e4,g=Math.floor(f*e);if(1==(1&g)&&g++,0==g)return 0;var h,i=Math.floor(g/2),j=0,k=0,l=e/g;for(h=0;i>h;h++)j+=Rb._bezeSpeed(a,b,c,d,(2*h+1)*l);for(h=1;i>h;h++)k+=Rb._bezeSpeed(a,b,c,d,2*h*l);return(Rb._bezeSpeed(a,b,c,d,0)+Rb._bezeSpeed(a,b,c,d,1)+2*k+4*j)*l/3},_bezeSpeedX:function(a,b,c,d,e){var f=1-e;return-3*a.x*f*f+3*b.x*f*f-6*b.x*f*e+6*c.x*f*e-3*c.x*e*e+3*d.x*e*e},_bezeSpeedY:function(a,b,c,d,e){var f=1-e;return-3*a.y*f*f+3*b.y*f*f-6*b.y*f*e+6*c.y*f*e-3*c.y*e*e+3*d.y*e*e},_bezeSpeed:function(a,b,c,d,e){var f=Rb._bezeSpeedX(a,b,c,d,e),g=Rb._bezeSpeedY(a,b,c,d,e);return Math.sqrt(f*f+g*g)},getPointObject:function(a,b){if(b&&0!=b.size()){var c=new md;b=b._as,a=a._as;var d,e,f=0,g=b.length,h=a.length;for(d=0;g>d&&(e=b[d],f!=h);d++)"cubicto"===e?h-2>f&&c.add([a[f++],a[f++],a[f++]]):"quadto"===e?h-1>f&&c.add([a[f++],a[f++]]):h>f&&c.add(a[f++]);for(;h>f;f++)c.add(a[f]);return c}return a},calculateLineLength:function(a,b){if(!a||a.size()<2)return 0;if(b)return Rb.calculateLineLength(Rb.getPointObject(a,b));a=a._as;var c,d,e,f,g,h,i,j=a.length,k=0;for(c=0;j>c;c++)f=a[c],0!=c?(e=f,e instanceof md&&(e=e._as),e instanceof Array?(g=Rb.calculateCurveLength(d,e,1),d=e[e.length-1]):(i=f.y-d.y,h=f.x-d.x,g=Math.sqrt(h*h+i*i),d=e),k+=g):d=f;return k},toDegrees:function(a){return 180*a/Math.PI},toRadians:function(a){return a/180*Math.PI},getRadiansBetweenLines:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},getAngle:function(a,b){return a.x===b.x?b.y===a.y?0:b.y>a.y?Math.PI/2:-Math.PI/2:Math.atan((b.y-a.y)/(b.x-a.x))}};Hb.math=Rb;var Sb={getPoints:function(a){var b=new md;return a.forEach(function(a){b.add({x:a.x,y:a.y}),b.add({x:a.x+a.width,y:a.y+a.height}),b.add({x:a.x+a.width,y:a.y}),b.add({x:a.x,y:a.y+a.height})}),b},rectangle:function(a){var b;return a.forEach(function(a){b=Rb.unionRect(b,a)}),b},oval:function(a){var b=Sb.rectangle(a),c=0,d=b.height/b.width,e=d*d,f=b.x+b.width/2,g=b.y+b.height/2,h=Sb.getPoints(a);h.forEach(function(a){var b=a.x-f,d=a.y-g,h=b*b+d*d/e;h>c&&(c=h)}),c=Math.sqrt(c);var i=d*c;return{x:f-c,y:g-i,width:2*c,height:2*i}},circle:function(a){var b=Sb.rectangle(a),c=0,d=b.x+b.width/2,e=b.y+b.height/2,f=Sb.getPoints(a);return f.forEach(function(a){var b=a.x-d,f=a.y-e,g=b*b+f*f;g>c&&(c=g)}),c=Math.sqrt(c),{x:d-c,y:e-c,width:2*c,height:2*c}},roundrect:function(a){var b=Sb.rectangle(a),c=Math.min(b.width,b.height)/16;return Rb.grow(b,c,c),b},star:function(a){var b=Sb.rectangle(a);return Rb.grow(b,b.width,b.height),b},triangle:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width*=2,b.y-=b.height,b.height*=2,b},hexagon:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width*=2,b},pentagon:function(a){var b=Sb.rectangle(a);return b.x-=b.width/6,b.width+=b.width/3,b.y-=b.height/4,b.height+=b.height/4,b},diamond:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width+=b.width,b.y-=b.height/2,b.height+=b.height,b},trapezoidal:function(a){var b=Sb.rectangle(a);return b.x-=b.width/2,b.width+=b.width,b.y-=b.height/2,b.height+=b.height,b}};Hb.group=Sb;var Tb={"topleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y-b.height}},"topleft.topright":function(a,b){return{x:a.x,y:a.y-b.height}},"top.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y-b.height}},"topright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y-b.height}},"topright.topright":function(a,b){return{x:a.x+a.width,y:a.y-b.height}},topleft:function(a,b){return{x:a.x-b.width/2,y:a.y-b.height/2}},top:function(a,b){return{x:a.x-b.width/2+a.width/2,y:a.y-b.height/2}},topright:function(a,b){return{x:a.x-b.width/2+a.width,y:a.y-b.height/2}},"topleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y}},"topleft.bottomright":function(a,b){return{x:a.x,y:a.y}},"top.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y}},"topright.bottomleft":function(a,b){return{x:a.x-b.width+a.width,y:a.y}},"topright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y}},"left.left":function(a,b){return{x:a.x-b.width,y:a.y+a.height/2-b.height/2}},left:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height/2-b.height/2}},"left.right":function(a,b){return{x:a.x,y:a.y+a.height/2-b.height/2}},center:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height/2-b.height/2}},"right.left":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height/2-b.height/2}},right:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height/2-b.height/2}},"right.right":function(a,b){return{x:a.x+a.width,y:a.y+a.height/2-b.height/2}},"bottomleft.topleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height-b.height}},"bottomleft.topright":function(a,b){return{x:a.x,y:a.y+a.height-b.height}},"bottom.top":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height}},"bottomright.topleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height-b.height}},"bottomright.topright":function(a,b){return{x:a.x+a.width,y:a.y+a.height-b.height}},bottomleft:function(a,b){return{x:a.x-b.width/2,y:a.y+a.height-b.height/2}},bottom:function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height-b.height/2}},bottomright:function(a,b){return{x:a.x+a.width-b.width/2,y:a.y+a.height-b.height/2}},"bottomleft.bottomleft":function(a,b){return{x:a.x-b.width,y:a.y+a.height}},"bottomleft.bottomright":function(a,b){return{x:a.x,y:a.y+a.height}},"bottom.bottom":function(a,b){return{x:a.x+a.width/2-b.width/2,y:a.y+a.height}},"bottomright.bottomleft":function(a,b){return{x:a.x+a.width-b.width,y:a.y+a.height}},"bottomright.bottomright":function(a,b){return{x:a.x+a.width,y:a.y+a.height}},get:function(a,b,c){if(!b)throw"refRect can not be null";c||(c={width:0,height:0});var d=Tb[a];if(d)return d(b,c);throw"Can not resolve '"+a+"' position"}};Hb.position=Tb;var Ub={preventDefault:function(a){Dd.KEEP_DEFAULT_FUNCTION(a)||(a.preventDefault?a.preventDefault():a.preventManipulation?a.preventManipulation():a.returnValue=!1)},insertAfter:function(a,b){return b?b.parentNode.insertBefore(a,b.nextSibling):a.parentNode.insertBefore(a,a.parentNode.firstChild),a},forEach:function(a,b,c){if(Ub.isVisible(a)){for(var d=a.childNodes.length,e=0;d>e;e++)Ub.forEach(a.childNodes[e],b,c);c?b.call(c,a):b(a)}},setVisible:function(a,b){a.style.display=b?"block":"none"},isVisible:function(a){return"style"in a&&"none"!==a.style.display},release:function(a){for(var b=a.childNodes.length,c=0;b>c;c++)Ub.release(a.childNodes[c]);b>0&&Ub.clear(a),a._pool&&a._pool.release(a)},clear:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},setZoom:function(a,b){var c=a.style;if(c.setProperty)if(Ob.isFirefox)c.setProperty("-moz-transform","scale("+b+")",null),c.setProperty("-moz-transform-origin","0 0",null);else if(Ob.isOpera)c.setProperty("-o-transform","scale("+b+")",null),c.setProperty("-o-transform-origin","0 0",null);else if(Ob.isChrome||Ob.isSafari){c.setProperty("-webkit-transform","scale("+b+")",null),c.setProperty("-webkit-transform-origin","0 0",null);var d=null;a._webkitInvaildateDiv?d=a._webkitInvaildateDiv:(d=Mb.createElement("div"),a._webkitInvaildateDiv=d),d.parentNode&&d.parentNode==a?a.removeChild(d):a.appendChild(d)}else Ob.isIE?(c.setProperty("-ms-transform","scale("+b+")",null),c.setProperty("-ms-transform-origin","0 0",null)):(c.setProperty("transform","scale("+b+")",null),c.setProperty("transform-origin","0 0",null))},setRotate:function(a,b){var c=a.style;if(c.setProperty)if(Ob.isFirefox)c.setProperty("-moz-transform","scale("+b+")",null),c.setProperty("-moz-transform-origin","0 0",null);else if(Ob.isOpera)c.setProperty("-o-transform","scale("+b+")",null),c.setProperty("-o-transform-origin","0 0",null);else if(Ob.isChrome||Ob.isSafari){c.setProperty("-webkit-transform","scale("+b+")",null),c.setProperty("-webkit-transform-origin","0 0",null);var d=null;a._webkitInvaildateDiv?d=a._webkitInvaildateDiv:(d=Mb.createElement("div"),a._webkitInvaildateDiv=d),d.parentNode&&d.parentNode==a?a.removeChild(d):a.appendChild(d)}else Ob.isIE?(c.setProperty("-ms-transform","scale("+b+")",null),c.setProperty("-ms-transform-origin","0 0",null)):(c.setProperty("transform","scale("+b+")",null),c.setProperty("transform-origin","0 0",null))},setCSSStyle:function(a,b,c){a.style.setProperty(b,c,null)},removeCSSStyle:function(a,b){a.style.removeProperty(b)},getCSSStyle:function(a,b){return a.style.getPropertyValue(b)},setBorderRaidus:function(a,b){Ob.isFirefox?a.style.MozBorderRadius=b:a.style.borderRadius=b},createSelect:function(a,b){var c,d,e,f=Mb.createElement("select");if(Array.isArray(a))for(c=0;c<a.length;c++)d=a[c],e=Mb.createElement("option"),e.innerHTML=d,e.setAttribute("value",d),d===b&&e.setAttribute("selected","true"),f.appendChild(e);else for(c=0;c<a.values.length;c++)d=a.values[c],e=Mb.createElement("option"),e.innerHTML=a.map[d],e.setAttribute("value",d),d===b&&e.setAttribute("selected","true"),f.appendChild(e);return f},createImg:function(a){var b=Mb.createElement("img");return b.style.position="absolute","string"==typeof a&&b.setAttribute("src",a),b},createView:function(a,b){var c=Mb.createElement("div");return c.style.position=Dd.VIEW_POSITION,c.style.fontSize=Dd.VIEW_FONT_SIZE,c.style.fontFamily=Dd.VIEW_FONT_FAMILY,c.style.cursor="default",c.style.outline="none",c.style.textAlign="left",c.style.msTouchAction="none",c.style.touchAction="none",c.tabIndex=0,b||(c.onmousedown=Ub.preventDefault),c.style.setProperty&&(c.style.setProperty("-khtml-user-select","none",null),c.style.setProperty("-webkit-user-select","none",null),c.style.setProperty("-moz-user-select","none",null),c.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null)),a&&(c.style.overflow=a),c},createDiv:function(){var a=Mb.createElement("div");return a.style.position="absolute",a.style.msTouchAction="none",a.style.touchAction="none",a},createCanvas:function(a,b){if(a=a||0,b=b||0,Kb)return new Jb(a,b);var c=Mb.createElement("canvas");return c.style.position="absolute",c.style.msTouchAction="none",c.style.touchAction="none",c.width=a,c.height=b,c},setCanvas:function(a,b,c,d,e){2===arguments.length&&(c=b.y,d=b.width,e=b.height,b=b.x),a.style.left=b+"px",a.style.top=c+"px",a.setAttribute("width",d),a.setAttribute("height",e),a._viewRect={x:b,y:c,width:d,height:e};var f=a.getContext("2d");return 0!==f.shadowBlur&&(f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=0,f.shadowColor="rgba(0,0,0,0.0)"),f.clearRect(0,0,d,e),f.translate(-b,-c),f},setImg:function(a,b,c){a.setAttribute("src",b),a.style.left=c.x+"px",a.style.top=c.y+"px",a.style.width=c.width+"px",a.style.height=c.height+"px",a._viewRect=Hb.clone(c)},setDiv:function(a,b,c,d,e){d=Hb.num(d)?d:0,a.style.left=b.x-d+"px",a.style.top=b.y-d+"px",a.style.width=b.width+"px",a.style.height=b.height+"px",a._viewRect=Hb.clone(b),a.style.backgroundColor=c?c:"",a.style.border=d>0?d+"px "+e+" solid":""},changeTypeForMS:function(a){var b=a;if(0===a.indexOf("MSPointer")||0===a.indexOf("pointer")){var c;0===a.indexOf("MSPointer")?(c=a.substring(9,10).toLowerCase(),c+=a.substring(10)):c=a.substring(7,8),window.MSPointerEvent?b="MSPointer"+c.substring(0,1).toUpperCase()+c.substring(1):window.PointerEvent&&(b="pointer"+c)}return b},addEventListener:function(a,b,c,d){a=this.changeTypeForMS(a);var e="_"+a+"_";if(!d[e]){var f=function(a){f.instance[f.method](a)};f.method=b,f.instance=d,d[e]=f,c.addEventListener(a,f,!1)}},removeEventListener:function(a,b,c){a=this.changeTypeForMS(a);var d="_"+a+"_",e=c[d];e&&(b.removeEventListener(a,e,!1),delete c[d])},isValidEvent:function(a,b){if(!b)return!1;if(b.target===a)if(Ob.isFirefox){if(a.clientHeight<a.scrollHeight&&b.layerX<25)return!1;if(a.clientWidth<a.scrollWidth&&b.layerY<25)return!1}else if(b.offsetX>a.clientWidth||b.offsetY>a.clientHeight)return!1;return!0},getLogicalPoint:function(a,b,c,d){c=c?c:1;var e,f=a.getBoundingClientRect();if(Ob.isTouchable&&b.changedTouches&&b.changedTouches.length>0){var g=b.changedTouches[0],h=Ob.isAndroid?0:yc.scrollLeft(),i=Ob.isAndroid?0:yc.scrollTop();e={x:(g.clientX+a.scrollLeft-f.left-h)/c,y:(g.clientY+a.scrollTop-f.top-i)/c}}else{if(!Ub.isValidEvent(a,b))return null;e={x:(b.clientX-f.left+a.scrollLeft)/c,y:(b.clientY-f.top+a.scrollTop)/c}}return e},handle_mousedown:function(a,b){Ub.target&&Ub.handle_mouseup(b),window.addEventListener("mousemove",Ub.handle_mousemove,!1),window.addEventListener("mouseup",Ub.handle_mouseup,!1),Ub.target=a},handle_mousemove:function(a){Ub.target.handle_mousemove&&Ub.target.handle_mousemove(a),Ub.target.handleMouseMove&&Ub.target.handleMouseMove(a)},handle_mouseup:function(a){Ub.target.handle_mouseup&&Ub.target.handle_mouseup(a),Ub.target.handleMouseUp&&Ub.target.handleMouseUp(a),window.removeEventListener("mousemove",Ub.handle_mousemove,!1),window.removeEventListener("mouseup",Ub.handle_mouseup,!1),delete Ub.target},getClientPoint:function(a){return{x:a.clientX,y:a.clientY}},windowWidth:function(){return"number"==typeof window.innerWidth?window.innerWidth:Mb.documentElement&&Mb.documentElement.clientWidth?Mb.documentElement.clientWidth:Mb.body&&Mb.body.clientWidth?Mb.body.clientWidth:0},windowHeight:function(){return"number"==typeof window.innerHeight?window.innerHeight:Mb.documentElement&&Mb.documentElement.clientHeight?Mb.documentElement.clientHeight:Mb.body&&Mb.body.clientHeight?Mb.body.clientHeight:0}};Hb.html=Ub;var Vb={cache:{},g:Ub.createCanvas().getContext("2d"),getTextSize:function(a,b){Vb.g.font=a?a:Dd.FONT;var c=Vb.cache[Vb.g.font];c||(c=2*Vb.g.measureText("e").width+4,Vb.cache[Vb.g.font]=c),b=b||"",b=String(b);for(var d,e=b.split("\n"),f=e.length,g=0,h=f-1;h>=0;h--)d=Vb.g.measureText(e[h]).width,d>g&&(g=d);return{width:g+4,height:c*f}},getSubStringInLength:function(a,b,c){var d=this,e=function(a,b,c,f,g){if(a>=b)return f.substring(0,a+1);var h=Math.floor((a+b)/2),i=f.substring(0,h+1),j=d.getTextSize(c,i).width;if(j>g)return e(a,h-1,c,f,g);var k=h+1,l=f.substring(0,k+1),m=d.getTextSize(c,l).width;return m>g?i:e(k,b,c,f,g)},f=this.getTextSize(a,b).width;return f>c?e(0,b.length-1,a,b,c):b},getCollapseTextInLength:function(a,b,c){var d=this.getTextSize(a,b).width;if(d>c){for(var e=0,f="",g=b,h=d;h>c;){var i=this.getSubStringInLength(a,g,c);f=f+i+"\n",e+=i.length,g=b.substring(e),h=this.getTextSize(a,g).width}return f+g}return b},drawText:function(a,b,c,d,e,f){b=b||"",b=String(b),d||(d=Dd.FONT);var g="center";f&&(g=f),a.font=d,a.fillStyle=e,a.textAlign=g,a.textBaseline="middle";var h,i,j=b.split("\n"),k=j.length,l=0;c?void 0===c.width?(h=c.x,i=c.y):(l=c.height/k,"left"==g?h=c.x:"center"==g&&(h=c.x+c.width/2),i=c.y+l/2):(h=0,i=0),Ob.isOpera&&(i-=2);for(var m=0;k>m;m++)"right"==g&&(a.textAlign="left",h=c.x+c.width-Vb.getTextSize(d,j[m]).width),a.fillText(j[m],h,i),i+=l},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;if(Math.abs(e)>2*Math.PI&&(e=2*Math.PI),m=Math.ceil(Math.abs(e)/(Math.PI/4)),i=e/m,j=-i,k=-d,m>0){n=b+Math.cos(d)*f,o=c+Math.sin(-d)*g,h?a.lineTo(n,o):a.moveTo(n,o);for(var t=0;m>t;t++)k+=j,l=k-j/2,p=b+Math.cos(k)*f,q=c+Math.sin(k)*g,r=b+Math.cos(l)*(f/Math.cos(j/2)),s=c+Math.sin(l)*(g/Math.cos(j/2)),a.quadraticCurveTo(r,s,p,q)}},dashedLine:function(a,b,c,d,e,f,g){var h=f-d,i=g-e,j=Math.sqrt(h*h+i*i);if(0!=j){h/=j,i/=j;for(var k=j,l=-c.offset,m=c.drawing,n=c.patternIndex;k>l;)l+=b[n],l>=k&&(c.offset=b[n]-(l-k),c.patternIndex=n,c.drawing=m,l=k),m?a.lineTo(d+l*h,e+l*i):a.moveTo(d+l*h,e+l*i),m=!m,n=(n+1)%b.length}},drawLinePoints:function(a,b,c,d,e){var f,g,h,i,j,k,l=0,m=0,n=b.size();if(k=c&&c.length>0?new tc(a,c[0],c.length>1?c[1]:c[0]):a,d)for(m=0,j=d.size();j>m;m++)if(f=d.get(m),"moveto"===f&&n>l)g=b.get(l++),k.moveTo(g.x,g.y);else if("lineto"===f&&n>l)g=b.get(l++),k.lineTo(g.x,g.y);else if("cubicto"===f&&n-2>l)g=b.get(l++),h=b.get(l++),i=b.get(l++),k.bezierCurveTo(g.x,g.y,h.x,h.y,i.x,i.y);else{if(!("quadto"===f&&n-1>l))throw"Can not resolve segment '"+f+"'";g=b.get(l++),h=b.get(l++),k.quadraticCurveTo(g.x,g.y,h.x,h.y)}else this._drawLine(b,k);e&&k.closePath()},_drawLine:function(a,b){var c,d,e,f,g,h=0,i=a.size();for(c=a.get(0),b.moveTo(c.x,c.y),h=1;i>h;h++)g=a.get(h),g.size?(f=g.size(),2===f?(c=g.get(0),d=g.get(1),b.quadraticCurveTo(c.x,c.y,d.x,d.y)):3===f&&(c=g.get(0),d=g.get(1),e=g.get(2),b.bezierCurveTo(c.x,c.y,d.x,d.y,e.x,e.y))):b.lineTo(g.x,g.y)},drawRoundRect:function(a,b,c,d,e,f,g,h,i){6===arguments.length&&(g=f,h=f,i=f);var j=b+d,k=c+e,l=e>d?2*d:2*e;f=l>f?f:l,g=l>g?g:l,h=l>h?h:l,i=l>i?i:l;var m=.292893218813453*i,n=.585786437626905*i;a.moveTo(j,k-i),a.quadraticCurveTo(j,k-n,j-m,k-m),a.quadraticCurveTo(j-n,k,j-i,k),m=.292893218813453*h,n=.585786437626905*h,a.lineTo(b+h,k),a.quadraticCurveTo(b+n,k,b+m,k-m),a.quadraticCurveTo(b,k-n,b,k-h),m=.292893218813453*f,n=.585786437626905*f,a.lineTo(b,c+f),a.quadraticCurveTo(b,c+n,b+m,c+m),a.quadraticCurveTo(b+n,c,b+f,c),m=.292893218813453*g,n=.585786437626905*g,a.lineTo(j-g,c),a.quadraticCurveTo(j-n,c,j-m,c+m),a.quadraticCurveTo(j,c+n,j,c+g),a.lineTo(j,k-i)},drawVector:function(a,b,c,d,e,f,g){var h;4===arguments.length?(e=d.y,f=d.width,g=d.height,d=d.x):5===arguments.length&&"roundrect"===b&&(h={},h.topLeft=e,h.topRight=e,h.bottomLeft=e,h.bottomRight=e,e=d.y,f=d.width,g=d.height,d=d.x);var i=Vb["_"+b];i&&(a.beginPath(),c&&c.length>0&&(a=new tc(a,c[0],c.length>1?c[1]:c[0])),5===arguments.length&&"roundrect"===b?i(a,{x:d,y:e,width:f,height:g},h):i(a,d,e,f,g))},_rectangle:function(a,b,c,d,e){a.rect(b,c,d,e)},_circle:function(a,b,c,d,e){var f=b+d/2,g=c+e/2,h=Math.min(d,e)/2;a instanceof tc?Vb.drawArc(a,f,g,0,2*Math.PI,h,h,!1):a.arc(f,g,h,0,2*Math.PI,!0)},_oval:function(a,b,c,d,e){if(a instanceof tc)Vb.drawArc(a,b+d/2,c+e/2,0,2*Math.PI,d/2,e/2,!1);else{var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)}},_roundrect:function(a,b,c,d,e){if(3===arguments.length){var f=c;c=b.y,d=b.width,e=b.height,b=b.x,f.topLeft?Vb.drawRoundRect(a,b,c,d,e,f.topLeft):Vb.drawRoundRect(a,b,c,d,e,Math.min(Math.min(d,e)/4,10))}else Vb.drawRoundRect(a,b,c,d,e,Math.min(Math.min(d,e)/4,10))},_star:function(a,b,c,d,e){var f=2*d,g=2*e,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(b+.306*d,c+.579*e),a.lineTo(h-f/6,i+g/4),a.lineTo(b+d/2,c+.733*e),a.lineTo(h+f/6,i+g/4),a.lineTo(b+.693*d,c+.579*e),a.lineTo(h+f/4,i-g/12),a.lineTo(b+.611*d,c+.332*e),a.lineTo(h+0,i-g/4),a.lineTo(b+.388*d,c+.332*e),a.closePath()},_triangle:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b+d,c+e),a.lineTo(b,c+e),a.closePath()},_hexagon:function(a,b,c,d,e){a.moveTo(b,c+e/2),a.lineTo(b+d/4,c+e),a.lineTo(b+3*d/4,+c+e),a.lineTo(b+d,c+e/2),a.lineTo(b+3*d/4,c),a.lineTo(b+d/4,c),a.closePath()},_pentagon:function(a,b,c,d,e){var f=2*d,g=2*e,h=b+d/2,i=c+e/2;a.moveTo(h-f/4,i-g/12),a.lineTo(h-f/6,i+g/4),a.lineTo(h+f/6,i+g/4),a.lineTo(h+f/4,i-g/12),a.lineTo(h+0,i-g/4),a.closePath()},_trapezoidal:function(a,b,c,d,e){a.moveTo(b+d/4,c),a.lineTo(b,c+e),a.lineTo(b+d,c+e),a.lineTo(b+3*d/4,c),a.closePath()},_diamond:function(a,b,c,d,e){a.moveTo(b+d/2,c),a.lineTo(b,c+e/2),a.lineTo(b+d/2,c+e),a.lineTo(b+d,c+e/2),a.closePath()},fill:function(a,b,c,d,e,f,g,h){var i=Wb[c];a.fillStyle=i?5===arguments.length?i(a,b,d,e.x,e.y,e.width,e.height):i(a,b,d,e,f,g,h):b},createRadialGradient:function(a,b,c,d,e,f,g,h,i){var j=a.createRadialGradient(d+f*h,e+g*i,Math.min(f,g)/24,d+f/2,e+g/2,Math.max(f,g)/2);return j.addColorStop(0,c),j.addColorStop(1,b),j},drawPath:function(a,b,c,d,e,f,g,h){var i=a._element,j=a.getBodyRect();d&&Rb.addPadding(j,i,c+".padding",1);var k=Hb.clone(j),l=i.getStyle(c+".outline.width");l>0&&Rb.grow(k,l/2,l/2);var m=a.setShadow(a,b,k);0!=i.getAngle()&&(i instanceof Nd||(j=i.getOriginalRect()),Gb.Util.rotateCanvas(m,j,i.getAngle()));var n,o=i.getStyle(c+".fill");if(o){n=a._innerColor&&!uc.hasDefault(a._element)?a._innerColor:i.getStyle(c+".fill.color");var p=i.getStyle(c+".gradient");p?Vb.fill(m,n,p,i.getStyle(c+".gradient.color"),j):m.fillStyle=n}var q=i.getStyle(c+".shape"),r=i.getStyle("group.shape.roundrect.radius");return o&&(m.beginPath(),f?Vb.drawLinePoints(m,f,null,g,h):"roundrect"===q&&"group"===c?Vb.drawVector(m,q,null,j,r):Vb.drawVector(m,q,null,j),m.fill()),l>0&&(m.lineWidth=l,m.lineCap=i.getStyle(c+".cap"),m.lineJoin=i.getStyle(c+".join"),m.strokeStyle=i.getStyle(c+".outline.color"),m.beginPath(),f?Vb.drawLinePoints(m,f,e,g,h):"roundrect"===q&&"group"===c?Vb.drawVector(m,q,e,j,r):Vb.drawVector(m,q,e,j),m.stroke()),k},draw3DRect:function(a,b,c,d,e,f,g){if(0!==c){arguments.length<=4&&(g=d.height,f=d.width,e=d.y,d=d.x);var h=c>0;c=Math.abs(c);var i,j;if(a.lineWidth=1,a.lineCap="square",1===c)i=Vb.brighter(b),j=Vb.darker(b),a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke();else for(var k=2*c,l=50/k,m=0;k>m;m++)i=Vb.brighter(b,50-m*l),j=Vb.darker(b,50-m*l),d+=.5,e+=.5,f-=1,g-=1,a.strokeStyle=h?i:j,a.beginPath(),a.moveTo(d,e),a.lineTo(d,e+g),a.moveTo(d,e),a.lineTo(d+f,e),a.closePath(),a.stroke(),a.strokeStyle=h?j:i,a.beginPath(),a.moveTo(d,e+g),a.lineTo(d+f,e+g),a.moveTo(d+f,e),a.lineTo(d+f,e+g),a.closePath(),a.stroke()}},brighter:function(a,b){return b||(b=50),Vb.adjustBrightness2(a,b)},darker:function(a,b){return b||(b=50),Vb.adjustBrightness2(a,-b)},adjustBrightness2:function(a,b){var c,d,e;

if(0===b)return a;var f=rd(a);return 0>b?(b=(100+b)/100,c=Math.ceil(f.r*b),d=Math.ceil(f.g*b),e=Math.ceil(f.b*b)):(b/=100,c=f.r,d=f.g,e=f.b,c+=(255-c)*b,d+=(255-d)*b,e+=(255-e)*b,c=Math.min(Math.ceil(c),255),d=Math.min(Math.ceil(d),255),e=Math.min(Math.ceil(e),255)),"rgba("+c+","+d+","+e+",1)"},getColorArray:function(a){return qd.clearRect(0,0,1,1),qd.fillStyle=a,qd.fillRect(0,0,1,1),qd.getImageData(0,0,1,1).data},hit:function(a,b,c,d){if(!a)return!1;var e=a._viewRect;if(!e)return!1;if(b-=e.x,c-=e.y,0>b||0>c||b>=e.width||c>=e.height)return!1;try{for(var f=a.getContext("2d").getImageData(b,c,1,1),g=f.data,h=0,i=g.length;i>h;h+=4)if(0!==g[h+3])return!0}catch(j){return!0}return!1},intersects:function(a,b){if(!a)return!1;if(b=Rb.intersection(b,a._viewRect),!b)return!1;b.x-=a._viewRect.x,b.y-=a._viewRect.y;try{for(var c=a.getContext("2d").getImageData(b.x,b.y,b.width,b.height),d=c.data,e=0,f=d.length;f>e;e+=4)if(0!==d[e+3])return!0}catch(g){}return!1},strokeRect:function(a,b,c,d){b&&(a.beginPath(),a.strokeStyle=c?c:Gb.Util.randomColor(),a.lineWidth=d?d:2,a.strokeRect(b.x,b.y,b.width,b.height),a.stroke())}};Hb.g=Vb;var Wb={"linear.southwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e+g,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.southeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.northwest":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e+g,d,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.northeast":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(1,c),h},"linear.west":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,c),h.addColorStop(1,b),h},"linear.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(1,c),h},"radial.center":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.5,.5)},"radial.southwest":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.25,.75)},"radial.southeast":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.75,.75)},"radial.northwest":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.25,.25)},"radial.northeast":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.75,.25)},"radial.north":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.5,.25)},"radial.south":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.5,.75)},"radial.west":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.25,.5)},"radial.east":function(a,b,c,d,e,f,g){return Vb.createRadialGradient(a,b,c,d,e,f,g,.75,.5)},"spread.horizontal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.vertical":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.diagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d+f,e,d,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.antidiagonal":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e,d+f,e+g);return h.addColorStop(0,b),h.addColorStop(.5,c),h.addColorStop(1,b),h},"spread.north":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.south":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d,e-g/4,d,e+g+g/4);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h},"spread.west":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,b),h.addColorStop(1/3,c),h.addColorStop(2/3,b),h.addColorStop(1,c),h},"spread.east":function(a,b,c,d,e,f,g){var h=a.createLinearGradient(d-f/4,e,d+f+f/4,e);return h.addColorStop(0,c),h.addColorStop(1/3,b),h.addColorStop(2/3,c),h.addColorStop(1,b),h}};Gb.Util={getVersion:function(){return"5.7.6"},registerImage:function(a,b,c,d,e){Hb.registerImage(a,b,c,d,e)},registerImageByUrl:function(a,b,c,d){if(b&&a&&a.indexOf(".json")>0){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var a=JSON.parse(e.responseText);Gb.Util.registerImage(b,a),c&&c.invalidateElementUIs(),d&&d()}},e.open("GET",a,!0),e.send()}else{var f=new Nb;f.src=a,f.onload=function(){Gb.Util.registerImage(b,f,f.width,f.height),f.onload=null,c&&c.invalidateElementUIs(),d&&d()}}},getRegisteredImageNames:function(){return Hb.getRegisteredImageNames()},unregisterImage:function(a){Hb.unregisterImage(a)},getImageAsset:function(a){return Hb.getImageAsset(a)},validateLicense:function(a){Hb.validateLicense(a)},getLicense:function(){return Ib},isPermissionGIS:function(){return sc()},moveElements:function(a,b,c,d,e,f){if((0!==b||0!==c)&&a&&!a.isEmpty()){var g,h,i=Gb.animate.AnimateManager;i.endAnimate(),a=uc.filterMovingElements(a),d&&(g=new md,h=new md),a.forEach(function(a){a instanceof Ld&&(d?(g.add(a),h.add({x:a.getX()+b,y:a.getY()+c})):a.translate(b,c))}),d?i.start(new Gb.animate.AnimateLocation(g,h,e)):e&&e()}},isTypeOf:function(a,b){if(a===b)return!0;for(var c=a.superClass;c;){if(c===b.prototype)return!0;c=c.constructor.superClass}return!1},setFocus:function(a){if(Mb.activeElement!==a){var b,c,d,e=Mb.documentElement,f=Mb.body;e&&(Ob.isIE||Ob.isOpera||e.scrollLeft||e.scrollTop)?(b=e.scrollLeft,c=e.scrollTop,d=e):f&&(b=f.scrollLeft,c=f.scrollTop,d=f),a.focus(),d&&(d.scrollLeft=b,d.scrollTop=c)}},isOpera:Ob.isOpera,isIE:Ob.isIE,isFirefox:Ob.isFirefox,isChrome:Ob.isChrome,isSafari:Ob.isSafari,isIPhone:Ob.isIPhone,isIPod:Ob.isIPod,isIPad:Ob.isIPad,isAndroid:Ob.isAndroid,isWebOS:Ob.isWebOS,isTouchable:Ob.isTouchable,ext:function(a,b,c){Hb.ext(a,b,c)},getValue:function(a,b,c){return Hb.getValue(a,b,c)},setValue:function(a,b,c){Hb.setValue(a,b,c)},grow:function(a,b,c){Rb.grow(a,b,c)},containsPoint:function(a,b,c){return Rb.containsPoint.apply(null,arguments)},intersects:function(a,b){return Rb.intersects(a,b)},getRect:function(a){return Rb.getRect(a)},unionRect:function(a,b){return Rb.unionRect(a,b)},createDiv:function(){return Ub.createDiv()},createCanvas:function(){return Ub.createCanvas()},setCanvas:function(a,b,c,d,e){return Ub.setCanvas.apply(null,arguments)},drawVector:function(a,b,c,d,e,f,g){Vb.drawVector.apply(null,arguments)},fill:function(a,b,c,d,e,f,g,h){Vb.fill.apply(null,arguments)},getClass:function(a){return Hb.getClass(a)},getAllClassNames:function(){var a,b=[];for(a in Hb.classCache)b.push(a);return b},newInstance:function(a){return Hb.newInstance.apply(null,arguments)},isDeserializing:function(){return Hb.isDeserializing},addEventListener:function(a,b,c,d){Ub.addEventListener(a,b,c,d)},removeEventListener:function(a,b,c){Ub.removeEventListener(a,b,c)},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l,m){nd.drawArrow.apply(null,arguments)},calculatePointAngleAlongLine:function(a,b,c,d,e){return Rb.calculatePointInfoAlongLineBySegments(a,b,c,d,e)},getSubNetwork:function(a){return uc.getSubNetwork(a)},transformPoint:function(a,b,c,d){return Rb.transformPoint(a,b,c,d)},getToolTipDiv:function(){return Ac.getToolTipDiv()},showToolTip:function(a,b){Ac.showToolTip(a,b)},hideToolTip:function(){Ac.hideToolTip()},resetToolTip:function(){Ac.resetToolTip()},setCSSStyle:function(a,b,c){Ub.setCSSStyle(a,b,c)},removeCSSStyle:function(a,b){Ub.removeCSSStyle(a,b)},getCSSStyle:function(a,b){return Ub.getCSSStyle(a,b)},toDegrees:function(a){return Rb.toDegrees(a)},toRadians:function(a){return Rb.toDegrees(a)},getRadiansBetweenLines:function(a,b){return Rb.getRadiansBetweenLines(a,b)},getElementsBounds:function(a,b){var c=null;return a.forEach(function(a){if(a.getRect){var d,e;b&&(e=b.getElementUI(a),e&&(d=e.getViewRect())),d||(d=a.getRect()),c=c?Gb.Util.unionRect(c,d):d}}),c},getPointIndex:function(a,b,c){if(c||(c=10),a)for(var d=a.size();d--;d>=0)if(Rb.getDistance(a.get(d),b)<=c)return d;return-1},registerVectorShape:function(a,b){Hb.g["_"+a]=b},rotateCanvas:function(a,b,c){a.translate(b.x+b.width/2,b.y+b.height/2),a.rotate(c*Math.PI/180),a.translate(-(b.x+b.width/2),-(b.y+b.height/2))},registerShape:function(a,b){ed(a,b)},registerDraw:function(a,b){dd(a,b)},getFilterColor:function(a,b){return sd(a,b)},registerGifImage:function(a,b){},parseVectorData:function(a){return Dc(a)},getSharedLinks:function(a,b){var c=a.getLinks(),d=b.getLinks();if(c&&0!=c.size()&&d&&0!=d.size()){var e=c.size()>d.size()?c:d;return e.toList(function(c){return c.getFromNode()==a&&c.getToNode()==b||c.getFromNode()==b&&c.getToNode()==a})}return null},isSharedLinks:function(a,b){var c=!1,d=a.getLinks(),e=b.getLinks();if(d&&0!=d.size()&&e&&0!=e.size()){var f=d.size()>e.size()?d:e;f.forEach(function(d){return d.getFromNode()==a&&d.getToNode()==b||d.getFromNode()==b&&d.getToNode()==a?(c=!0,!1):!0})}return c},playAnimate:function(a){return wb(a)},pauseAnimate:function(a){a.pause()},resumeAnimate:function(a){a.resume()},stopAnimate:function(a,b){xb(a,b)},pauseAllAnimates:function(){zb()},resumeAllAnimates:function(){Ab()},stopAllAnimates:function(a){yb(a)},randomColor:function(){return"#"+("00000"+(16777216*this.random()<<0).toString(16)).substr(-6)},random:function(){return Math.random()},getHSVColor:function(a,b,c){var d,e,f,g,h,i,j,k;switch(a&&void 0===b&&void 0===c&&(b=a.s,c=a.v,a=a.h),g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b),g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}var l="#"+toHex(255*d)+toHex(255*e)+toHex(255*f);return l},toHex:function(a){var b=parseInt(a).toString(16);return 1==b.length&&(b="0"+b),b},makeHighRes:function(a){var b=a.getContext("2d"),c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;if(c!==d){var f=a.width,g=a.height;a.width=Math.round(f*e),a.height=Math.round(g*e),a.style.width=f+"px",a.style.height=g+"px",b.scale(e,e)}},newFunction:function(){var a=arguments,b=a.length;return 1===b?Hb.newInstance("Function",a[0]):2===b?Hb.newInstance("Function",a[0],a[1]):3===b?Hb.newInstance("Function",a[0],a[1],a[2]):4===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3]):5===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4]):6===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4],a[5]):7===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4],a[5],a[6]):8===b?Hb.newInstance("Function",a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7]):null}},Hb.ext("twaver.Util",Object,{});var Xb,Yb=0xdeadbeefcafe,Zb=15715070==(16777215&Yb);Zb&&"Microsoft Internet Explorer"==Lb.appName?(a.prototype.am=d,Xb=30):Zb&&"Netscape"!=Lb.appName?(a.prototype.am=c,Xb=26):(a.prototype.am=e,Xb=28),a.prototype.DB=Xb,a.prototype.DM=(1<<Xb)-1,a.prototype.DV=1<<Xb;var $b=52;a.prototype.FV=Math.pow(2,$b),a.prototype.F1=$b-Xb,a.prototype.F2=2*Xb-$b;var _b,ac,bc="0123456789abcdefghijklmnopqrstuvwxyz",cc=new Array;for(_b="0".charCodeAt(0),ac=0;9>=ac;++ac)cc[_b++]=ac;for(_b="a".charCodeAt(0),ac=10;36>ac;++ac)cc[_b++]=ac;for(_b="A".charCodeAt(0),ac=10;36>ac;++ac)cc[_b++]=ac;C.prototype.convert=D,C.prototype.revert=E,C.prototype.reduce=F,C.prototype.mulTo=G,C.prototype.sqrTo=H,J.prototype.convert=K,J.prototype.revert=L,J.prototype.reduce=M,J.prototype.mulTo=O,J.prototype.sqrTo=N,a.prototype.copyTo=h,a.prototype.fromInt=j,a.prototype.fromString=l,a.prototype.clamp=m,a.prototype.dlShiftTo=t,a.prototype.drShiftTo=u,a.prototype.lShiftTo=v,a.prototype.rShiftTo=w,a.prototype.subTo=x,a.prototype.multiplyTo=y,a.prototype.squareTo=z,a.prototype.divRemTo=A,a.prototype.invDigit=I,a.prototype.isEven=P,a.prototype.exp=Q,a.prototype.toString=n,a.prototype.negate=o,a.prototype.abs=p,a.prototype.compareTo=q,a.prototype.bitLength=s,a.prototype.mod=B,a.prototype.modPowInt=R,a.ZERO=k(0),a.ONE=k(1),Ia.prototype.convert=Ja,Ia.prototype.revert=Ja,Ia.prototype.mulTo=Ka,Ia.prototype.sqrTo=La,Pa.prototype.convert=Qa,Pa.prototype.revert=Ra,Pa.prototype.reduce=Sa,Pa.prototype.mulTo=Ua,Pa.prototype.sqrTo=Ta;var dc=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ec=(1<<26)/dc[dc.length-1];a.prototype.chunkSize=W,a.prototype.toRadix=Y,a.prototype.fromRadix=Z,a.prototype.fromNumber=$,a.prototype.bitwiseTo=da,a.prototype.changeBit=ua,a.prototype.addTo=ya,a.prototype.dMultiply=Ga,a.prototype.dAddOffset=Ha,a.prototype.multiplyLowerTo=Na,a.prototype.multiplyUpperTo=Oa,a.prototype.modInt=Xa,a.prototype.millerRabin=$a,a.prototype.clone=S,a.prototype.intValue=T,a.prototype.byteValue=U,a.prototype.shortValue=V,a.prototype.signum=X,a.prototype.toByteArray=_,a.prototype.equals=aa,a.prototype.min=ba,a.prototype.max=ca,a.prototype.and=fa,a.prototype.or=ha,a.prototype.xor=ja,a.prototype.andNot=la,a.prototype.not=ma,a.prototype.shiftLeft=na,a.prototype.shiftRight=oa,a.prototype.getLowestSetBit=qa,a.prototype.bitCount=sa,a.prototype.testBit=ta,a.prototype.setBit=va,a.prototype.clearBit=wa,a.prototype.flipBit=xa,a.prototype.add=za,a.prototype.subtract=Aa,a.prototype.multiply=Ba,a.prototype.divide=Da,a.prototype.remainder=Ea,a.prototype.divideAndRemainder=Fa,a.prototype.modPow=Va,a.prototype.modInverse=Ya,a.prototype.pow=Ma,a.prototype.gcd=Wa,a.prototype.isProbablePrime=Za,a.prototype.square=Ca,_a.prototype.init=ab,_a.prototype.next=bb;var fc,gc,hc,ic=256;if(null==gc){gc=new Array,hc=0;var jc;if("Netscape"==Lb.appName&&Lb.appVersion<"5"&&window.crypto){var kc=window.crypto.random(32);for(jc=0;jc<kc.length;++jc)gc[hc++]=255&kc.charCodeAt(jc)}for(;ic>hc;)jc=Math.floor(65536*Gb.Util.random()),gc[hc++]=jc>>>8,gc[hc++]=255&jc;hc=0,eb()}hb.prototype.nextBytes=gb;kb.prototype.doPublic=mb,kb.prototype.setPublic=lb,kb.prototype.encrypt=nb,kb.prototype.doPrivate=rb,kb.prototype.setPrivate=pb,kb.prototype.setPrivateEx=qb,kb.prototype.decrypt=sb;var lc=function(){mc.v(Ib)},mc={},nc="6a384c1259bdb5e731ec96b3174683f48a2c56a85e52e7a5bb20b58711ce50c1a294bd5e1d1752e766085e9ae94bae6d217c25dbb5fcdb86a8a9a7e180fa066723d00fcb85fcf7c9d29f8cc8859f53244a49c0bc30dcc45156daf8843ce1d24fe8ebc9a3c186bb26e9d0714041aef160304c1db8cc5728cf4acb39d29755f319",oc="10001",pc="b881f568eb43e7a60c256a8a90e08b7c7638fd66ce3cded9005c72e283ca4f2b8601e2edc687d7f898348a05723b515d9edeb626af7b499a56ddaea93b0c2047";mc.cross=function(a){if(a){for(var b="",c=0;c<a.length;)c+1<a.length?(b+=a[c+1],b+=a[c]):b+=a[c],c+=2;return b}return null},mc.reverse=function(a){if(a){for(var b="",c=a.length;c>0;c--)b+=a[c-1];return b}return null},mc.v=function(a){if(a){var b=mc;if(b.start=null,b.beginDate=null,b.end=null,b.endDate=null,b.gis=null,b["3D"]=null,b["3d"]=null,b.l=null,b.__li__=null,a.indexOf("signature=")>0){var c=a.split("signature="),d=c[0],e=c[1],f=new kb;f.setPublic(nc,oc);for(var g=e,h=g.length,i=256,j=0,k="",l="";h>j;)k=g.substr(j,i),l+=f.decrypt(k),j+=i;if(l===d)return b.i(a),!0}}return!1},mc.i=function(a){var b=mc;b.__li__=a;var c,d,e,f,g,h=a.split("\n");for(c=h.length-1;c>=0;c--)d=h[c],g=d.split("="),e=g[0],f=g[1],b[e]=f;void 0!=b.start&&(b.beginDate=new Date(Date.parse(b.start.replace(/-/g,"/")))),void 0!=b.end&&(b.endDate=new Date(Date.parse(b.end.replace(/-/g,"/"))));var i=b.gis;void 0!=i&&(i=parseInt(i)),i&&(b._isPermissionGIS=!0);var j=b["3D"]||b["3d"];void 0!=j&&(j=parseInt(j)),j&&(b._isPermission3D=!0),b["3D"]&&(b._isPermission3D=!0),void 0!=b.l&&(b.version=b.l)};var qc=function(a){return void 0!==a.__li__&&!a._isPermission3D},rc=function(a){if(!qc(a))return!0;var b=new Date;return null!=a.beginDate&&a.beginDate.getTime()-b.getTime()>=0||null!=a.endDate&&a.endDate.getTime()-b.getTime()<=0},sc=function(){return rc(mc)?!1:mc._isPermissionGIS};mc.$z=function(a){var b=new kb;b.setPublic(nc,oc);for(var c=a,d=c.length,e=256,f=0,g="",h="";d>f;)g=c.substr(f,e),h+=b.decrypt(g),f+=e;return h},mc.twm=function(a){var b=mc,c=b.$z("4cd18113d0c7046bfe51f7a3fbd41c2b7cf14dd785d6ea7cec9da17710d3acfb8ce0cb9cf10839f4bd51e88819de19cdc0db09278584396156fcb65abe0353ac49d01326b30efa0ea98a07da9f8ceeb7572fc1b37b5965ba6103ccba4913b62e36e49425c6ff21a2f008830c59cff8f29058769f858c8a9f0bab3eaea7fb8a9e"),d=this.type,e=this.markText,f=b.$z("648be38cd61c870e95ffc1ea0676af40736c1365015abc326e891a4de67b4de3d4b05da70b9aebedc83ec26ecf71eb74c72f42f6d9a4be2d507d2f67d2860b7b66e3ba1d565e15923f2db335ff922eef17c01b59818b583d5656412d6cc9d9ba70001c2c88e3efd492c6b13a07fda5f325b333138a2036f4696542ec137cc341");if(a[f]=b.__li__,"3"!==d||rc(mc)||void 0!==e){void 0==a.__liLabel&&(a.__liLabel=Mb.createElement("div")),void 0===b.startDate&&(b.startDate=new Date);var g=(new Date).getTime()-b.startDate.getTime();if(!(3e5>g)){var h=rc(b)&&g>3e5,i=e;if(h?i=b.$z("0dd629dbd0ce341ecdd447e35ddc3135a0b46916f7571a687f38ae665cf0ae095fee885e14329caa75112d8787508da17285b0897845d8ccae73e6a2727dd19f1ca335fe139d0e60d240f9ececc78f81c2c5667f51aeed4135b9c4bb436b8acb7cd418eeeb404bc4f3bcdedb481ac0edff7644435ce2b9f2bda78c892bd56d73"):"2"!=d||void 0!==i&&""!=i?"1"!=d||e||(i=c):i=b.$z("644d54bf9c59afbd8a742a9e7e2731f23f149ccb7f04c3547548c50ac2d77faea108b55f1f6261e99869f1c06b84e8abdefdf45b5170048531421f3d528123972ba2f03d70f37c33f1341dc12f986e0089e42bab517e2a05b455d12d90991bbba9bc45c715a81943062ea5fa5408c8b1b9270d260cc5a67b38ecc4178ce512fc"),void 0!==i){var j=a,k=j.__liLabel;if(k.innerHTML=i,j._rootCanvas)k.type=d,k.mark=e,k.expired=h,j._xyz=k;else{var l=0,m=0;k.style.position="absolute";var n=j.getView().style;void 0!=e&&null!=e&&""!=e||"2"==d?(l=10-j.getView().scrollLeft,m=10-j.getView().scrollTop):(l=n.width.replace("px","")/2-50-j.getView().scrollLeft,m=n.height.replace("px","")/2-j.getView().scrollTop),k.style.right=l+"px",k.style.bottom=m+"px",k.style.fontSize="120%",h&&(j.getView().style.opacity=.1,k.style.color="red",k.style.fontSize="150%"),j.getView().appendChild(k)}}}}},Hb.validateLicense(Ib);var tc=function(a,b,c){this.g=a,this.onLength=b,this.offLength=c,this.isLine=!0,this.overflow=0,this.dashLength=b+c,this.pen={x:0,y:0}};Hb.ext(tc,Object,{_curveaccuracy:6,moveTo:function(a,b){this.pen={x:a,y:b},this.g.moveTo(a,b),this.start||(this.start={x:a,y:b})},lineTo:function(a,b){var c=a-this.pen.x,d=b-this.pen.y,e=Math.atan2(d,c),f=Math.cos(e),g=Math.sin(e),h=this.lineLength(this.pen.x,this.pen.y,a,b);if(this.overflow){if(this.overflow>h)return this.isLine?this._lineTo(a,b):this.moveTo(a,b),void(this.overflow-=h);if(this.isLine?this._lineTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow):this.moveTo(this.pen.x+f*this.overflow,this.pen.y+g*this.overflow),h-=this.overflow,this.overflow=0,this.isLine=!this.isLine,!h)return}var i=Math.floor(h/this.dashLength);if(i){for(var j=f*this.onLength,k=g*this.onLength,l=f*this.offLength,m=g*this.offLength,n=0;i>n;n++)this.isLine?(this._lineTo(this.pen.x+j,this.pen.y+k),this.moveTo(this.pen.x+l,this.pen.y+m)):(this.moveTo(this.pen.x+l,this.pen.y+m),this._lineTo(this.pen.x+j,this.pen.y+k));h-=this.dashLength*i}this.isLine?h>this.onLength?(this._lineTo(this.pen.x+f*this.onLength,this.pen.y+g*this.onLength),this.moveTo(a,b),this.overflow=this.offLength-(h-this.onLength),this.isLine=!1):(this._lineTo(a,b),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-h,this.moveTo(a,b))):h>this.offLength?(this.moveTo(this.pen.x+f*this.offLength,this.pen.y+g*this.offLength),this._lineTo(a,b),this.overflow=this.onLength-(h-this.offLength),this.isLine=!0):(this.moveTo(a,b),h==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-h)},quadraticCurveTo:function(a,b,c,d){var e,f=this.pen.x,g=this.pen.y,h=this.curveLength(f,g,a,b,c,d),i=0,j=0;if(this.overflow){if(this.overflow>h)return this.isLine?this._curveTo(a,b,c,d):this.moveTo(c,d),void(this.overflow-=h);if(i=this.overflow/h,e=this.curveSliceUpTo(f,g,a,b,c,d,i),this.isLine?this._curveTo(e[2],e[3],e[4],e[5]):this.moveTo(e[4],e[5]),this.overflow=0,this.isLine=!this.isLine,!h)return}var k=h-h*i,l=Math.floor(k/this.dashLength),m=this.onLength/h,n=this.offLength/h;if(l)for(var o=0;l>o;o++)this.isLine?(j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5]),i=j,j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5])):(j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5]),i=j,j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5])),i=j;k=h-h*i,this.isLine?k>this.onLength?(j=i+m,e=this.curveSlice(f,g,a,b,c,d,i,j),this._curveTo(e[2],e[3],e[4],e[5]),this.moveTo(c,d),this.overflow=this.offLength-(k-this.onLength),this.isLine=!1):(e=this.curveSliceFrom(f,g,a,b,c,d,i),this._curveTo(e[2],e[3],e[4],e[5]),h==this.onLength?(this.overflow=0,this.isLine=!this.isLine):(this.overflow=this.onLength-k,this.moveTo(c,d))):k>this.offLength?(j=i+n,e=this.curveSlice(f,g,a,b,c,d,i,j),this.moveTo(e[4],e[5]),e=this.curveSliceFrom(f,g,a,b,c,d,j),this._curveTo(e[2],e[3],e[4],e[5]),this.overflow=this.onLength-(k-this.offLength),this.isLine=!0):(this.moveTo(c,d),k==this.offLength?(this.overflow=0,this.isLine=!this.isLine):this.overflow=this.offLength-k)},bezierCurveTo:function(a,b,c,d,e,f){this.pen={x:e,y:f};var g=[this.onLength,this.offLength];this.g.setLineDash&&this.g.setLineDash(g),this.g.lineDash=g,this.g.bezierCurveTo(a,b,c,d,e,f)},rect:function(a,b,c,d){this.pen={x:a,y:b},this.moveTo(a,b),this.lineTo(a,b+d),this.lineTo(a+c,b+d),this.lineTo(a+c,b),this.lineTo(a,b)},closePath:function(){this.lineTo(this.start.x,this.start.y)},lineLength:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},curveLength:function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o=0,p=a,q=b,r=g>0?g:this._curveaccuracy,s=1;r>=s;s++)j=s/r,k=1-j,l=k*k,m=2*j*k,n=j*j,h=l*a+m*c+n*e,i=l*b+m*d+n*f,o+=this.lineLength(p,q,h,i),p=h,q=i;return o},curveSlice:function(a,b,c,d,e,f,g,h){if(0==g)return this.curveSliceUpTo(a,b,c,d,e,f,h);if(1==h)return this.curveSliceFrom(a,b,c,d,e,f,g);var i=this.curveSliceUpTo(a,b,c,d,e,f,h);return i.push(g/h),this.curveSliceFrom.apply(this,i)},curveSliceUpTo:function(a,b,c,d,e,f,g){if(1!=g){var h=c+(e-c)*g,i=d+(f-d)*g;c=a+(c-a)*g,d=b+(d-b)*g,e=c+(h-c)*g,f=d+(i-d)*g}return[a,b,c,d,e,f]},curveSliceFrom:function(a,b,c,d,e,f,g){if(1!=g){var h=a+(c-a)*g,i=b+(d-b)*g;c+=(e-c)*g,d+=(f-d)*g,a=h+(c-h)*g,b=i+(d-i)*g}return[a,b,c,d,e,f]},_lineTo:function(a,b){(a!=this.pen.x||b!=this.pen.y)&&(this.pen={x:a,y:b},this.g.lineTo(a,b))},_curveTo:function(a,b,c,d){(a!=c||b!=d||c!=this.pen.x||d!=this.pen.y)&&(this.pen={x:c,y:d},this.g.quadraticCurveTo(a,b,c,d))}}),Hb.DashedLine=tc;var uc={DEFAULTS:{"default":1,"default.vector":1,"vector.default":1},VECTORS:{vector:1,"default.vector":1,"vector.default":1},hasDefault:function(a){if(a instanceof Ld){var b=a.getStyle("body.type");return 1===uc.DEFAULTS[b]}return!0},hasVector:function(a){if(a instanceof Ld){var b=a.getStyle("body.type");return 1===uc.VECTORS[b]}return!1},hasAgentLinks:function(a){for(var b=a.getChildrenSize(),c=0;b>c;c++){var d=a.getChildAt(c);if(d instanceof Ld&&uc.hasAgentLinks(d))return!0}return a.hasAgentLinks()},getParents:function(a,b,c){c||(c=!0);for(var d=new md,e=a._parent;null!=e&&e!==b;)d.add(e,0),e=e._parent;return c&&null!=e&&e===b&&d.add(e,0),d},getSubNetwork:function(a){if(!a)return null;if(a instanceof Gb.Link){var b=a._fromAgent,c=a._toAgent;if(!b||!c)return null;var d=uc.getSubNetwork(b),e=uc.getSubNetwork(c);return d===e?d:null}var f=a._parent;if(!f)return null;for(;f instanceof Gb.Link&&!f.ISubNetwork;)f=f._parent;return f.ISubNetwork?f:uc.getSubNetwork(f)},figureSameSubNetworkAgent:function(a){if(!a)return null;for(var b=a._parent;b instanceof Nd;){if(!(b._parent instanceof Nd))return b.isExpanded()?a:b;b.isExpanded()||(a=b),b=b._parent}return a},figureSpanSubNetworkAgent:function(a,b){if(!a||!b)return null;var c=uc.getSubNetwork(a),d=uc.getSubNetwork(b);if(c!=d){for(;null!=d&&c!=d;)d=uc.getSubNetwork(d);if(c===d)return a;var e=new md;e.add(a,0);for(var f=a._parent;f instanceof Ld&&!b.isDescendantOf(f);)e.add(f,0),f=f._parent;for(var g=e.size(),h=0;g>h;h++){var i=e.get(h);if(i instanceof Nd&&!i.isExpanded())return i;if(i.ISubNetwork)return i}return a}return a},figureFromAgent:function(a){if(a.isLooped())return a.getFromNode();var b=uc.figureSameSubNetworkAgent(a.getFromNode()),c=uc.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getFromNode():uc.figureSpanSubNetworkAgent(b,c)},figureToAgent:function(a){if(a.isLooped())return a.getToNode();var b=uc.figureSameSubNetworkAgent(a.getFromNode()),c=uc.figureSameSubNetworkAgent(a.getToNode());return b===c?a.getToNode():uc.figureSpanSubNetworkAgent(c,b)},getBundleLinks:function(a,b){if(!a||!b)return null;var c,d,e,f;if(a===b){if(f=a.getLoopedLinks(),!f)return null;f=new md(f)}else{var g=a.getAgentLinks(),h=b.getAgentLinks();if(!g||!h)return null;for(d=g.size(),c=0;d>c;c++)e=g.get(c),h.contains(e)&&(f||(f=new md),f.add(e))}if(null!=f)for(c=0;c<f.size();c++)e=f.get(c),e.getStyle("link.bundle.enable")||(e._setBundleLinks(null),f.removeAt(c),c--);return f},resetBundleLinks:function(a,b){var c=uc.getBundleLinks(a,b);if(c&&0!==c.size()){var d=null;if(1===c.size())return d=c.get(0),void d._setBundleLinks(null);var e,f,g=new md;for(e=0;e<c.size();e++)d=c.get(e),f=d.getStyle("link.bundle.id"),g.indexOf(f)<0&&g.add(f);g.sort();var h,i,j=new md;for(i=0;i<g.size();i++){f=g.get(i);var k=new md;for(e=0;e<c.size();e++)d=c.get(e),f===d.getStyle("link.bundle.id")&&k.add(d);h=new Gb.BundleLinks(k,j),j.add(h)}for(i=0;i<j.size();i++)for(h=j.get(i),e=0;e<h.getLinks().size();e++)d=h.getLinks().get(e),d._setBundleLinks(h)}},moveElements:function(a,b,c,d){for(var e=uc.filterMovingElements(a,d),f=e.size(),g=0;f>g;g++)e.get(g).translate(b,c)},filterMovingElements:function(a,b){for(var c=new md,d=a.size(),e=0;d>e;e++){var f=a.get(e);if(f instanceof Ld&&(!b||b(f))){for(var g=!0,h=c.toArray(),i=0;i<h.length;i++){var j=h[i];g&&j instanceof Gb.Follower&&f instanceof Gb.Follower&&f.isLoopedHostOn(j)?g=!1:j instanceof Gb.Follower&&j.isHostOn(f)?c.remove(j):g&&f instanceof Gb.Follower&&j instanceof Ld&&f.isHostOn(j)?g=!1:uc.isDescendantOfGroup(j,f)?c.remove(j):g&&uc.isDescendantOfGroup(f,j)&&(g=!1)}g&&c.add(f)}}return c},isDescendantOfGroup:function(a,b){if(!(a&&b instanceof Nd))return!1;if(!b.hasChildren())return!1;for(a=a._parent;a instanceof Nd;){if(a===b)return!0;a=a._parent}return!1}};Hb.element=uc;var vc={between:function(a,b,c){return c>=a&&b>=c?!0:c>=b&&a>=c?!0:!1},considerEast:function(a,b,c){return b?vc.between(b.x,c.x,a.x)?c.x>b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerWest:function(a,b,c){return b?vc.between(b.x,c.x,a.x)?c.x<b.x:Math.abs(b.x-a.x)>Math.abs(c.x-a.x):!0},considerNorth:function(a,b,c){return b?vc.between(b.y,c.y,a.y)?c.y<b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},considerSouth:function(a,b,c){return b?vc.between(b.y,c.y,a.y)?c.y>b.y:Math.abs(b.y-a.y)>Math.abs(c.y-a.y):!0},getHorizontalPoint:function(a,b,c){return vc.between(b.x,c.x,a.x)?{x:a.x,y:b.y}:Math.abs(a.x-b.x)<Math.abs(a.x-c.x)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getVerticalPoint:function(a,b,c){return vc.between(b.y,c.y,a.y)?{x:b.x,y:a.y}:Math.abs(a.y-b.y)<Math.abs(a.y-c.y)?{x:b.x,y:b.y}:{x:c.x,y:c.y}},getPoint:function(a,b,c,d,e){var f=Math.abs(d.x-c.x)>Math.abs(d.y-c.y);if("south"===e)return f&&vc.considerSouth(b,a,c)?vc.getHorizontalPoint(b,c,d):null;if("north"===e)return f&&vc.considerNorth(b,a,c)?vc.getHorizontalPoint(b,c,d):null;if("west"===e)return!f&&vc.considerWest(b,a,c)?vc.getVerticalPoint(b,c,d):null;if("east"===e)return!f&&vc.considerEast(b,a,c)?vc.getVerticalPoint(b,c,d):null;if("nearby"===e){var g;return g=f?vc.getHorizontalPoint(b,c,d):vc.getVerticalPoint(b,c,d),!a||Rb.getDistance(a,b)>Rb.getDistance(g,b)?g:null}return null},getBusPoint:function(a,b,c){var d,e=a.size();if(e>0){for(var f=a.get(0),g=1;e>g;g++){var h=a.get(g),i=vc.getPoint(d,b,f,h,c);i&&(d=i),f=h}d||(d={x:f.x,y:f.y})}return d}};Hb.bus=vc;var wc={createFromPoint:function(a,b){var c=a._element;if(!c.getFromAgent())return{x:0,y:0};var d,e=c.getStyle("link.from.position"),f=c.getStyle("link.from.xoffset"),g=c.getStyle("link.from.yoffset"),h=c.getStyle("link.from.percent");if(h&&h instanceof Array&&2===h.length&&h[0]<=1&&h[0]>=0&&h[1]<=1&&h[1]>=0){var i=c.getFromAgent(),j=i.getSize(),k=i.getRect().x+j.width*h[0],l=i.getRect().y+j.height*h[1];return{x:k,y:l}}if(a._network._edgeDetect){var i=c.getFromAgent(),m=c.getToAgent(),n=i.getImage(),o=Hb.images[n],p=i.getCenterLocation(),q=m.getCenterLocation(),r=this._getPointAngleDegree(q.x,q.y,p.x,p.y),s={x:0,y:0};if(o){var t=o._image;if(t&&bd(t)||t&&Gb.Util.getImageAsset(n)._cache)return bd(t)?o._edgeData||(o._edgeData=o._createEdgeData(t,i._width,i._height)):"object"==typeof t&&(o._edgeData||(o._edgeData=o._createEdgeData(Gb.Util.getImageAsset(n)._cache,i.getWidth(),i.getHeight()))),s.x=o._edgeData[r].x+i.getRect().x,s.y=o._edgeData[r].y+i.getRect().y,s}}if(!Hb.isCalculatingBus){if(Hb.isCalculatingBus=!0,c.getFromAgent()instanceof Gb.Bus){var u=c.getFromAgent();if(uc.hasVector(u)){var v=b?b._getElementZoomRect(a,u.getRect()):u.getRect(),w=u.getStyle("vector.shape");if("oval"===w)d=Rb.getEllipsePoint(v,wc.createToPoint(a));else if("circle"===w)d=Rb.getEllipsePoint(Rb.getCircleRect(v),wc.createToPoint(a));else if("rectangle"===w||"roundrect"===w){var x=new md;x.add({x:u.x,y:u.y}),x.add({x:u.x+u.width,y:u.y}),x.add({x:u.x+u.width,y:u.y+u.height}),x.add({x:u.x,y:u.y+u.height}),x.add({x:u.x,y:u.y}),x=b?b._getShapeNodeZoomPoints(a,x):x,d=vc.getBusPoint(x,wc.createToPoint(a),u.getStyle("bus.style"))}}else{var x=b?b._getShapeNodeZoomPoints(a,u.getPoints()):u.getPoints();d=vc.getBusPoint(x,wc.createToPoint(a),u.getStyle("bus.style"))}}Hb.isCalculatingBus=!1}return d?(d.x+=f,d.y+=g):d=a._network.getPosition(e,c.getFromAgent(),null,f,g,!0),d},createToPoint:function(a,b){var c=a._element;if(!c.getToAgent())return{x:0,y:0};var d,e=c.getStyle("link.to.position"),f=c.getStyle("link.to.xoffset"),g=c.getStyle("link.to.yoffset"),h=c.getStyle("link.to.percent");if(h&&h instanceof Array&&2===h.length&&h[0]<=1&&h[0]>=0&&h[1]<=1&&h[1]>=0){var i=c.getToAgent(),j=i.getSize(),k=i.getRect().x+j.width*h[0],l=i.getRect().y+j.height*h[1];return{x:k,y:l}}if(a._network._edgeDetect){var m=c.getFromAgent(),i=c.getToAgent(),n=i.getImage(),o=Hb.images[n],p=m.getLocation(),q=i.getCenterLocation(),r=this._getPointAngleDegree(p.x,p.y,q.x,q.y),s={x:0,y:0};if(o){var t=o._image;if(t&&bd(t)||t&&Gb.Util.getImageAsset(n)._cache)return bd(t)?o._edgeData||(o._edgeData=o._createEdgeData(t,i.getWidth(),i.getHeight())):"object"==typeof t&&(o._edgeData||(o._edgeData=o._createEdgeData(Gb.Util.getImageAsset(n)._cache,i.getWidth(),i.getHeight()))),s.x=o._edgeData[r].x+i.getRect().x,s.y=o._edgeData[r].y+i.getRect().y,s}}if(!Hb.isCalculatingBus){if(Hb.isCalculatingBus=!0,c.getToAgent()instanceof Gb.Bus){var u=c.getToAgent();if(uc.hasVector(u)){var v=b?b._getElementZoomRect(a,u.getRect()):u.getRect(),w=u.getStyle("vector.shape");if("oval"===w)d=Rb.getEllipsePoint(v,wc.createFromPoint(a));else if("circle"===w)d=Rb.getEllipsePoint(Rb.getCircleRect(v),wc.createFromPoint(a));else if("rectangle"===w||"roundrect"===w){var x=new md;x.add({x:u.x,y:u.y
}),x.add({x:u.x+u.width,y:u.y}),x.add({x:u.x+u.width,y:u.y+u.height}),x.add({x:u.x,y:u.y+u.height}),x.add({x:u.x,y:u.y}),x=b?b._getShapeNodeZoomPoints(a,x):x,d=vc.getBusPoint(x,wc.createFromPoint(a),u.getStyle("bus.style"))}}else{var x=b?b._getShapeNodeZoomPoints(a,u.getPoints()):u.getPoints();d=vc.getBusPoint(x,wc.createFromPoint(a),u.getStyle("bus.style"))}}Hb.isCalculatingBus=!1}return d?(d.x+=f,d.y+=g):d=a._network.getPosition(e,c.getToAgent(),null,f,g,!0),d},fillLoopedPoints:function(a,b,c){var d,e=wc.getBundleGap(a,!0),f=e,g=a.getStyle("link.looped.type"),h=a.getStyle("link.looped.direction");if("north"===h)return"arc"===g?wc.drawArc(b.x+b.width/2,b.y,0,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y},c.add({x:d.x+f,y:d.y}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width/2,y:b.y-e};if("northeast"===h)return"arc"===g?wc.drawArc(b.x+b.width,b.y,1.5*Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x+f,y:d.y+f}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+.707*e,y:b.y-.707*e};if("east"===h)return"arc"===g?wc.drawArc(b.x+b.width,b.y+b.height/2,1.5*Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+e,y:d.y-f}),c.add({x:d.x+e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x+b.width+e,y:b.y+b.height/2};if("southeast"===h)return"arc"===g?wc.drawArc(b.x+b.width,b.y+b.height,Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x+b.width,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x+f,y:d.y-f}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x-f,y:d.y})),{x:b.x+b.width+.707*e,y:b.y+b.height+.707*e};if("south"===h)return"arc"===g?wc.drawArc(b.x+b.width/2,b.y+b.height,Math.PI,Math.PI,e,e,!1,c):(d={x:b.x+b.width/2,y:b.y+b.height},c.add({x:d.x-f,y:d.y}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x+b.width/2,y:b.y+b.height+e};if("southwest"===h)return"arc"===g?wc.drawArc(b.x,b.y+b.height,.5*Math.PI,1.5*Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-f,y:d.y-f}),c.add({x:d.x-f,y:d.y+e}),c.add({x:d.x+f,y:d.y+e}),c.add({x:d.x+f,y:d.y})),{x:b.x-.707*e,y:b.y+b.height+.707*e};if("west"===h)return"arc"===g?wc.drawArc(b.x,b.y+b.height/2,.5*Math.PI,Math.PI,e,e,!1,c):(d={x:b.x,y:b.y+b.height/2},c.add({x:d.x,y:d.y-f}),c.add({x:d.x-e,y:d.y-f}),c.add({x:d.x-e,y:d.y+f}),c.add({x:d.x,y:d.y+f})),{x:b.x-e,y:b.y+b.height/2};if("northwest"===h)return"arc"===g?wc.drawArc(b.x,b.y,0,1.5*Math.PI,e,e,!1,c):(d={x:b.x,y:b.y},c.add({x:d.x,y:d.y+f}),c.add({x:d.x-f,y:d.y+f}),c.add({x:d.x-f,y:d.y-e}),c.add({x:d.x+f,y:d.y-e}),c.add({x:d.x+f,y:d.y})),{x:b.x-.707*e,y:b.y-.707*e};throw"Can not resolve link looped direction '"+h+"'"},drawArc:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s;if(Math.abs(d)>2*Math.PI&&(d=2*Math.PI),m=Math.ceil(Math.abs(d)/(Math.PI/4)),i=d/m,j=-i,k=-c,m>0){n=a+Math.cos(c)*e,o=b+Math.sin(-c)*f,h.add({x:n,y:o});for(var t=0;m>t;t++){k+=j,l=k-j/2,p=a+Math.cos(k)*e,q=b+Math.sin(k)*f,r=a+Math.cos(l)*(e/Math.cos(j/2)),s=b+Math.sin(l)*(f/Math.cos(j/2));var u=new md;u.add({x:r,y:s}),u.add({x:p,y:q}),h.add(u)}}},fillBundlePoints:function(a,b,c,d,e,f){{var g;a._element.getBundleCount(),a._element.getBundleIndex(),a.getStyle("link.bundle.expanded")}if("parallel"!==b&&0===(g=wc.getBundleGap(a,!1)))return e.add(c),e.add(d),Rb.getCenterPoint(c,d);void 0===g&&(g=wc.getBundleGap(a,!1));var h=wc.getBundleOffset(a),i=Rb.getDistance(c,d);if(f){var j=f.getSizeZoom();h*=j,g*=j}("arc"===b||"triangle"===b)&&e.add({x:0,y:0}),"arc"===b&&e.add({x:0,y:g}),e.add({x:h,y:g}),e.add({x:i-h,y:g}),"arc"===b&&e.add({x:i,y:g}),("arc"===b||"triangle"===b)&&e.add({x:i,y:0});for(var k=Math.atan2(d.y-c.y,d.x-c.x),l=Rb.createMatrix(k,0,0),m=0,n=e.size();n>m;m++){var o=e.get(m);o=l.transform(o),o.x+=c.x,o.y+=c.y,e.set(m,o)}if("arc"===b){var p=Rb.getCenterPoint(e.get(2),e.get(3)),q=new md;return q.add(e.get(1)),q.add(e.get(2)),e.set(1,q),q=new md,q.add(e.get(4)),q.add(e.get(5)),e.set(4,q),e.removeAt(5),e.removeAt(2),p}return wc.calculateCenterPoint(e)},calculateCenterPoint:function(a){var b=a.size();if(null==a||1>b)return{x:0,y:0};if(b%2===0){var c=b/2,d=a.get(c-1),e=a.get(c);return{x:(d.x+e.x)/2,y:(d.y+e.y)/2}}return a.get((b-1)/2)},getBundleOffset:function(a){var b=Rb.getDistance(a.getFromPoint(),a.getToPoint()),c=a.getStyle("link.bundle.offset");return b>2*c?c:b/2},getBundleGap:function(a,b){var c=a._element;if(!c.getBundleLinks())return b?c.getStyle("link.looped.gap"):0;for(var d=b?"link.looped.gap":"link.bundle.gap",e=null,f=0,g=0,h=c.getBundleLinks().getSiblings(),i=0,j=c.getStyle("link.bundle.independent"),k=c.getStyle("link.bundle.group.gap"),l=0,m=h.size();m>l;l++){var n=h.get(l);if(!j||n===c.getBundleLinks()){for(var o=0,p=n.getLinks().size();p>o;o++){var q=n.getLinks().get(o);if(j===q.getStyle("link.bundle.independent")&&a._network.isVisible(q)){if(null==e)e=q,i=q.getStyle(d);else{var r=q.getStyle(d);g+=i/2+r/2,i=r}q===c&&(f=g+k/2)}}g+=k}}if(b)return g-f+i;var s=f-g/2;return null!=e&&c.getFromAgent()!==e.getFromAgent()&&(s=-s),s},isTargetPriority:function(a,b,c){if(a){if(b.height<c.height)return b.height+c.height<Math.max(b.y+b.height,c.y+c.height)-Math.min(b.y,c.y)+b.height/2}else if(b.width<c.width)return b.width+c.width<Math.max(b.x+b.width,c.x+c.width)-Math.min(b.x,c.x)+b.width/2;return!0},calculateOrthogonalAndFlexionalLinkPoints:function(a,b,c,d){var e=wc.isHorizontal(a,b,c,d),f=new md;if(wc.isFlexionalTypeLink(a))wc.flexional(e,b,c,f,d.getStyle("link.extend"));else{wc.orthogonal(a,b,c,f,e,d);var g=wc.isSplitByPercent(a,d),h=g?wc.calculateSplitValueByPercent(a,e,b,c,d.getStyle("link.split.percent")):d.getStyle("link.split.value");0===h&&(e=!e)}var i;0===f.size()?wc.isTargetPriority(e,b,c)?(i={x:c.x+c.width/2,y:c.y+c.height/2},f.add(wc.rectanglePerimeter(b,!0,i)),f.add(wc.rectanglePerimeter(c,!1,f.get(f.size()-1)))):(i={x:b.x+b.width/2,y:b.y+b.height/2},i=wc.rectanglePerimeter(c,!1,i),f.add(wc.rectanglePerimeter(b,!0,i)),f.add(i)):(i=f.get(0),f.add(wc.rectanglePerimeter(b,!0,i),0),f.add(wc.rectanglePerimeter(c,!1,f.get(f.size()-1))));var j=f.size();if(2>j)return f;for(var k=f.get(0),l=1;j-1>l;l++){var m=f.get(l);m.x===k.x&&m.y===k.y&&(f.remove(m),j--,l--),k=m}return f},isHorizontal:function(a,b,c,d){if(a){if("flexional.horizontal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"extend.left"===a||"extend.right"===a)return!0;if("flexional.vertical"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.bottom"===a)return!1}var e=wc.calculateXGap(b,c),f=wc.calculateYGap(b,c);return e>=f},flexional:function(a,b,c,d,e){a?wc.flexionalHorizontal(b,c,d,e):wc.flexionalVertical(b,c,d,e)},isSplitByPercent:function(a,b){return b.getStyle("link.split.by.percent")},isExtendTypeLink:function(a){return a&&("extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a)},isFlexionalTypeLink:function(a){return a&&("flexional"===a||"flexional.horizontal"===a||"flexional.vertical"===a)},calculateControlPoint:function(a,b,c,d,e){if("orthogonal.H.V"===a||"orthogonal.V.H"===a)return{x:d.x+d.width/2,y:d.y+d.height/2};var f;if(wc.isExtendTypeLink(a)){var g=Math.min(c.y,d.y),h=Math.min(c.x,d.x),i=Math.max(c.y+c.height,d.y+d.height),j=Math.max(c.x+c.width,d.x+d.width);if(f=e.getStyle("link.extend"),"extend.top"===a)return{x:(h+j)/2,y:g-f};if("extend.left"===a)return{x:h-f,y:(g+i)/2};if("extend.bottom"===a)return{x:(h+j)/2,y:i+f};if("extend.right"===a)return{x:j+f,y:(g+i)/2}}var k=wc.isSplitByPercent(a,e);if(f=k?wc.calculateSplitValueByPercent(a,b,c,d,e.getStyle("link.split.percent")):e.getStyle("link.split.value"),f===Number.NEGATIVE_INFINITY||f===Number.POSITIVE_INFINITY)return{x:d.x+d.width/2,y:d.y+d.height/2};if(0===f)return{x:c.x+c.width/2,y:c.y+c.height/2};if(b){var l=c.x+c.x+c.width<d.x+d.x+d.width;return{x:wc.calculateSplitLocation(l,f,c.x,c.width),y:c.y+c.height/2}}var m=c.y+c.y+c.height<d.y+d.y+d.height;return{x:c.x+c.width/2,y:wc.calculateSplitLocation(m,f,c.y,c.height)}},calculateGap:function(a,b,c,d){var e=Math.max(b,d)-Math.min(a,c);return e-(b-a+d-c)},calculateXGap:function(a,b){var c=Math.max(a.x+a.width,b.x+b.width)-Math.min(a.x,b.x);return c-a.width-b.width},calculateYGap:function(a,b){var c=Math.max(a.y+a.height,b.y+b.height)-Math.min(a.y,b.y);return c-a.height-b.height},calculateSplitValueByPercent:function(a,b,c,d,e){var f=wc.calculateSplitGapByPercent(e,b,c,d);return f*e},calculateSplitGapByPercent:function(a,b,c,d,e){return b?wc._calculateSplitGapByPercent(a,c.x,c.x+c.width,d.x,d.x+d.width):wc._calculateSplitGapByPercent(a,c.y,c.y+c.height,d.y,d.y+d.height)},_calculateSplitGapByPercent:function(a,b,c,d,e){var f=wc.calculateGap(b,c,d,e),g=d+e>b+c;if(f>0){if(1===a)return f+(e-d)/2;if(a>=0&&1>a)return f;if(0>a)return g?d-b:c-e}return Math.abs(g&&a>0||!g&&0>a?c-e:b-d)},calculateSplitPercentByControlPoint:function(a,b,c,d){return b?wc.calculateSplitPercent(a.x,c.x,c.x+c.width,d.x,d.x+d.width):wc.calculateSplitPercent(a.y,c.y,c.y+c.height,d.y,d.y+d.height)},calculateSplitPercent:function(a,b,c,d,e){if(a>=b&&c>=a)return 0;var f=wc.calculateGap(b,c,d,e);if(f>0&&a>=d&&e>=a)return 1;var g=d+e>b+c;if(f>0){if(a>Math.min(c,e)&&a<Math.max(b,d))return Math.abs(a-(g?c:b))/f;if(g){if(b>a)return(a-b)/(d-b)}else if(a>c)return(c-a)/(c-e)}return a>c?(g?a-c:c-a)/Math.abs(c-e):(g?a-b:b-a)/Math.abs(b-d)},calculateSplitLocation:function(a,b,c,d){return a===b>0?c+d+Math.abs(b):c-Math.abs(b)},calculateAngle:function(a,b){if(0!==a&&0!==b)return Math.atan2(a,b);if(0===a){if(b>0)return 0;if(0>b)return Math.PI}return a>0?Math.PI/2:-Math.PI/2},drawCorner:function(a,b){var c=a.size();if(!(3>c)){var d=b.getStyle("link.corner");if("none"!==d){for(var e,f,g,h,i=b.getStyle("link.xradius"),j=b.getStyle("link.yradius"),k=a.get(0),l=a.get(1),m=2;c>m;m++){var n=a.get(m),o=l.x-k.x,p=l.y-k.y,q=n.x-l.x,r=n.y-l.y,s=0===p;if(0===o&&0===r||0===p&&0===q)if(s?(e=Math.min(2===m?Math.abs(o):Math.abs(o)/2,i),f=Math.min(m===c-1?Math.abs(r):Math.abs(r)/2,j),g={x:l.x-(o>0?e:-e),y:l.y},h={x:l.x,y:l.y+(r>0?f:-f)}):(e=Math.min(m===c-1?Math.abs(q):Math.abs(q)/2,i),f=Math.min(2===m?Math.abs(p):Math.abs(p)/2,j),g={x:l.x,y:l.y-(p>0?f:-f)},h={x:l.x+(q>0?e:-e),y:l.y}),a.remove(l),m--,c--,(g.x!==k.x||g.y!==k.y)&&(a.add(g,m),m++,c++),"bevel"===d)a.add(h,m),m++,c++;else if("round"===d){var t=new md;t.add(l),t.add(h),a.add(t,m),m++,c++}k=l,l=n}h&&h.x===l.x&&h.y===l.y&&a.remove(l)}}},orthogonal:function(a,b,c,d,e,f){var g=f.getStyle("link.control.point"),h=null==g;if(g){var i=Rb.unionRect(b,c);Rb.containsPoint(i,g)||(e=wc.calculateIsHorizontalByControlPoint(g.x,g.y,i.y,i.x,i.y+i.height,i.x+i.width))}else g=wc.calculateControlPoint(a,e,b,c,f);e?wc.sideToSide(b,c,g,d,h):wc.topToBottom(b,c,g,d,h)},calculateIsHorizontalByControlPoint:function(a,b,c,d,e,f){return c>b&&c-b>d-a&&c-b>a-f||b>e&&b-e>d-a&&b-e>a-f?!1:!0},contains:function(a,b,c){return b>=a.x&&b<=a.x+a.width&&c>=a.y&&c<=a.y+a.height},topToBottom:function(a,b,c,d,e){var f=Math.max(a.y,b.y),g=Math.min(a.y+a.height,b.y+b.height),h=c?c.y:g+(f-g)/2,i=a.x+a.width/2,j=b.x+b.width/2;if(!e&&c&&(c.x>=a.x&&c.x<=a.x+a.width&&(i=c.x),c.x>=b.x&&c.x<=b.x+b.width&&(j=c.x)),wc.contains(b,i,h)||wc.contains(a,i,h)||d.add({x:i,y:h}),wc.contains(b,j,h)||wc.contains(a,j,h)||d.add({x:j,y:h}),0===d.size())if(c)wc.contains(b,c.x,h)||wc.contains(a,c.x,h)||d.add({x:c.x,y:h});else{var k=Math.max(a.x,b.x),l=Math.min(a.x+a.width,b.x+b.width);d.add({x:k+(l-k)/2,y:h})}},sideToSide:function(a,b,c,d,e){var f=Math.max(a.x,b.x),g=Math.min(a.x+a.width,b.x+b.width),h=c?c.x:g+(f-g)/2,i=a.y+a.height/2,j=b.y+b.height/2;if(!e&&c&&(c.y>=a.y&&c.y<=a.y+a.height&&(i=c.y),c.y>=b.y&&c.y<=b.y+b.height&&(j=c.y)),wc.contains(b,h,i)||wc.contains(a,h,i)||d.add({x:h,y:i}),wc.contains(b,h,j)||wc.contains(a,h,j)||d.add({x:h,y:j}),0===d.size())if(c)wc.contains(b,h,c.y)||wc.contains(a,h,c.y)||d.add({x:h,y:c.y});else{var k=Math.max(a.y,b.y),l=Math.min(a.y+a.height,b.y+b.height);d.add({x:h,y:k+(l-k)/2})}},flexionalHorizontal:function(a,b,c,d){var e=b.x+b.width<a.x,f=a.x+a.width<b.x,g=e?a.x:a.x+a.width,h=a.y+a.height/2,i=f?b.x:b.x+b.width,j=b.y+b.height/2,k=d,l=e?-k:k,m={x:g+l,y:h};l=f?-k:k;var n={x:i+l,y:j};if(e===f){var o=e?Math.min(g,i)-d:Math.max(g,i)+d;c.add({x:o,y:h}),c.add({x:o,y:j})}else if(m.x<n.x===e){var p=h+(j-h)/2;c.add(m),c.add({x:m.x,y:p}),c.add({x:n.x,y:p}),c.add(n)}else c.add(m),c.add(n)},flexionalVertical:function(a,b,c,d){var e=b.y+b.height<a.y,f=a.y+a.height<b.y,g=a.x+a.width/2,h=e?a.y:a.y+a.height,i=b.x+b.width/2,j=f?b.y:b.y+b.height,k=d,l=e?-k:k,m={x:g,y:h+l};l=f?-k:k;var n={x:i,y:j+l};if(e===f){var o=e?Math.min(h,j)-d:Math.max(h,j)+d;c.add({x:g,y:o}),c.add({x:i,y:o})}else if(m.y<n.y===e){var p=g+(i-g)/2;c.add(m),c.add({x:p,y:m.y}),c.add({x:p,y:n.y}),c.add(n)}else c.add(m),c.add(n)},rectanglePerimeter:function(a,b,c){var d=a.x+a.width/2,e=a.y+a.height/2,f=c.x-d,g=c.y-e,h=Math.atan2(g,f),i={x:0,y:0},j=Math.PI,k=Math.PI/2,l=k-h,m=Math.atan2(a.height,a.width);return-j+m>h||h>j-m?(i.x=a.x,i.y=e-a.width*Math.tan(h)/2):-m>h?(i.y=a.y,i.x=d-a.height*Math.tan(l)/2):m>h?(i.x=a.x+a.width,i.y=e+a.width*Math.tan(h)/2):(i.y=a.y+a.height,i.x=d+a.height*Math.tan(l)/2),c.x>=a.x&&c.x<=a.x+a.width?i.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(i.y=c.y),c.x<a.x?i.x=a.x:c.x>a.x+a.width&&(i.x=a.x+a.width),c.y<a.y?i.y=a.y:c.y>a.y+a.height&&(i.y=a.y+a.height),i},isSplitTypeLink:function(a){return a&&("orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.vertical"===a)},isOrthogonalOrFlexionalLink:function(a){if(a instanceof Gb.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return wc.isOrthogonalOrFlexionalType(b)},isOrthogonalLink:function(a){if(a instanceof Gb.ShapeLink)return!1;if(a.isLooped())return!1;var b=a.getStyle("link.type");return wc.isOrthogonalType(b)},isOrthogonalOrFlexionalType:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a||"flexional"===a||"flexional.horizontal"===a||"flexional.vertical"===a},isOrthogonalType:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.H.V"===a||"orthogonal.vertical"===a||"orthogonal.V.H"===a||"extend.top"===a||"extend.left"===a||"extend.bottom"===a||"extend.right"===a},hasControlPoint:function(a){return"orthogonal"===a||"orthogonal.horizontal"===a||"orthogonal.vertical"===a||"extend.bottom"===a||"extend.left"===a||"extend.right"===a||"extend.top"===a},getControlPoint:function(a,b,c){if(!a)throw"link can't be null";var d=a.getStyle("link.type");if(!wc.hasControlPoint(d))return null;var e=a.getStyle("link.control.point");if(e)return e;var f,g;if(null==b?(f=a.getFromAgent().getRect(),g=a.getToAgent().getRect()):(f=wc.getLinkSourceBounds(b,c),g=wc.getLinkTargetBounds(b,c)),null==f||null==g)return null;var h=wc.isHorizontal(d,f,g,a);return wc.calculateControlPoint(a.getStyle("link.type"),h,f,g,a)},getSplitValueByControlPoint:function(a,b,c,d,e){if("extend.top"===b)return Math.min(c.y,d.y)-a.y;if("extend.left"===b)return Math.min(c.x,d.x)-a.x;if("extend.bottom"===b)return a.y-Math.max(c.y+c.height,d.y+d.height);if("extend.right"===b)return a.x-Math.max(c.x+c.width,d.x+d.width);var f;if(e){var g=c.x+c.x+c.width<d.x+d.x+d.width;return f=g?a.x-c.x+c.width:c.x-a.x,f>0?f:f>-c.width?0:f+c.width}var h=c.y+c.y+c.height<d.y+d.y+d.height;return f=h?a.y-c.y-c.height:c.y-a.y,f>0?f:f>-c.height?0:f+c.height},isHorizontalByControlPoint:function(a,b,c,d,e){var f=Rb.unionRect(c,d);return Rb.containsPoint(f,a)?wc.isHorizontal(b,c,d,e):wc.calculateIsHorizontalByControlPoint(a.x,a.y,f.y,f.x,f.y+f.height,f.x+f.width)},setParamsByControlPoint:function(a,b,c,d,e){var f=wc.isHorizontalByControlPoint(a,d,b,c,e),g=e.getStyle("link.control.point");if((g||"orthogonal"===d||"orthogonal.horizontal"===d||"orthogonal.vertical"===d)&&e.setStyle("link.type",f?"orthogonal.horizontal":"orthogonal.vertical"),g)return void e.setStyle("link.control.point",a);var h=wc.getSplitValueByControlPoint(a,d,b,c,f);if(wc.isExtendTypeLink(d))return void e.setStyle("link.extend",h);var i=wc.isSplitByPercent(d,e);return i?0===h?void e.setStyle("link.split.percent",0):void e.setStyle("link.split.percent",wc.calculateSplitPercentByControlPoint(a,f,b,c)):void e.setStyle("link.split.value",h)},getLinkNodeBounds:function(a,b,c,d,e,f){if(f){var g=f.getLocationZoom();f.getSizeZoom(a)}if(null==a)return null;var h;if(d)f?(h=a.getZoomBodyRect(),h.x+=b,h.y+=c):(h=a.getBodyRect(),h.x+=b,h.y+=c);else{var i=a.getNetwork().getPosition(e,a,null,b,c);h=f?{x:i.x*g,y:i.y*g,width:1,height:1}:{x:i.x,y:i.y,width:1,height:1}}return h},getLinkSourceBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getFromAgent());if(null==d)return null;var e=c.getStyle("link.from.position"),f=c.getStyle("link.from.xoffset"),g=c.getStyle("link.from.yoffset"),h=c.getStyle("link.from.at.edge");return wc.getLinkNodeBounds(d,f,g,h,e,b)},getLinkTargetBounds:function(a,b){var c=a._element,d=a.getNetwork().getElementUI(c.getToAgent());if(null==d)return null;var e=c.getStyle("link.to.position"),f=c.getStyle("link.to.xoffset"),g=c.getStyle("link.to.yoffset"),h=c.getStyle("link.to.at.edge");return wc.getLinkNodeBounds(d,f,g,h,e,b)},orthogonalAndFlexional:function(a,b,c){var d=wc.getLinkSourceBounds(a,c);if(null==d)return null;var e=wc.getLinkTargetBounds(a,c);if(null==e)return null;var f=wc.calculateOrthogonalAndFlexionalLinkPoints(b,d,e,a._element);return wc.offsetLink(a,f),a.setHotSpot(wc.calculateCenterPoint(f)),"flexional"!==b&&wc.drawCorner(f,a._element),f},offsetLink:function(a,b){var c=a._element,d=c.isBundleAgent();if(!d){var e=wc.getBundleGap(a,!1);if(0!==e)for(var f,g,h=!1,i=!1,j=b.get(0),k=Hb.clone(j),l=1,m=b.size();m>l;l++){var n=b.get(l),o=n.x-k.x,p=n.y-k.y;k=Hb.clone(n),g=wc.calculateAngle(o,p),0===o?((g-f)%Math.PI===0&&(g-f)%(2*Math.PI)!==0&&(h=!h,h&&(p=-p)),(g-f)%Math.PI!==0&&(j.x+=0>p?e:-e),n.x+=0>p?e:-e):0===p&&((g-f)%Math.PI===0&&(g-f)%(2*Math.PI)!==0&&(i=!i,i&&(o=-o)),f&&(g-f)%Math.PI===0||(j.y-=0>o?e:-e),n.y-=0>o?e:-e),f=g,j=n}}},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360}};Hb.link=wc;var xc={findMoveToBottomDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),xc.findMoveToBottomDatas(a,b,e.getChildren())},findMoveToTopDatas:function(a,b,c){for(var d=0;d<c.size();d++){var e=c.get(c.size()-1-d);a.contains(e)&&b.add(e)}for(d=0;d<c.size();d++)e=c.get(d),xc.findMoveToTopDatas(a,b,e.getChildren())},findMoveUpDatas:function(a,b,c){for(var d=!1,e=0;e<c.size();e++){var f=c.get(e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),xc.findMoveUpDatas(a,b,f.getChildren())},findMoveDownDatas:function(a,b,c){for(var d=!1,e=0;e<c.size();e++){var f=c.get(c.size()-1-e);a.contains(f)?d&&b.add(f):d=!0}for(e=0;e<c.size();e++)f=c.get(e),xc.findMoveDownDatas(a,b,f.getChildren())},doLayout:function(a,b){b=b||{},b.type=b.type||"round",b.animate=b.animate||!0,b.elements=b.elements||new Gb.List,b.repulsion=b.repulsion||1,b.expandGroup=b.expandGroup||!1;var c=new Gb.layout.AutoLayouter(a.getElementBox());c.getElements=function(){}}};Hb.box=xc;var yc={scrollLeft:function(){return yc._filterResults(window.pageXOffset?window.pageXOffset:0,Mb.documentElement?Mb.documentElement.scrollLeft:0,Mb.body?Mb.body.scrollLeft:0)},scrollTop:function(){return yc._filterResults(window.pageYOffset?window.pageYOffset:0,Mb.documentElement?Mb.documentElement.scrollTop:0,Mb.body?Mb.body.scrollTop:0)},_filterResults:function(a,b,c){var d=a?a:0;return b&&(!d||d>b)&&(d=b),c&&(!d||d>c)?c:d},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&a.touches.length>1},getDistance:function(a){if(!yc.isMultiTouch(a))return 0;var b=a.touches[0],c=a.touches[1];return Math.sqrt(Math.pow(b.clientX-c.clientX,2)+Math.pow(b.clientY-c.clientY,2))},getCenterLocation:function(a){if(!yc.isMultiTouch(a))return 0;var b=a.touches[0],c=a.touches[1];return{x:(b.clientX+c.clientX)/2,y:(b.clientY+c.clientY)/2}}};Hb.touch=yc;var zc={_string:function(a,b,c,d){var e=c._stringPool.get();e.style.whiteSpace="nowrap",e.style.verticalAlign="middle",e.style.padding="0px 2px",Hb.setText(e,a,d),e.setAttribute("title",a),b.appendChild(e)},_boolean:function(a,b,c){var d=c._booleanPool.get();b._editInfo?(d._editInfo=b._editInfo,delete b._editInfo,d.disabled=!1):d.disabled=!0,d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d.checked=a,b.appendChild(d),""===b.style.textAlign&&(b.style.textAlign="center")},_color:function(a,b,c){var d=c._colorPool.get();d.style.width="100%",d.style.height="100%",d.style.backgroundColor=a,d.setAttribute("title",a),b.appendChild(d)},_listPoints:function(a,b,c,d){var e=c._stringPool.get();e.style.whiteSpace="nowrap",e.style.verticalAlign="middle",e.style.padding="0px 2px";var f=a._as||a,g="";f.forEach(function(a,b){g+=b==f.length-1?"["+a.x+","+a.y+"]":"["+a.x+","+a.y+"],"}),a=g,Hb.setText(e,a,d),e.setAttribute("title",a),b.appendChild(e)},render:function(a,b,c,d,e){if(null!=b){var f=zc["_"+a];f?f(b,c,d,e):"boolean"==typeof b?zc._boolean(b,c,d,e):b instanceof Gb.List?zc._listPoints(b,c,d,e):zc._string(b,c,d,e)}}};Hb.render=zc;var Ac={toolTipDiv:null,getToolTipDiv:function(){if(!Ac.toolTipDiv){Ac.toolTipDiv=Mb.createElement("div");var a=Dd,b=Ac.toolTipDiv.style;b.position="absolute",b.color=a.TOOLTIP_COLOR,b.background=a.TOOLTIP_BACKGROUND,b.fontSize=a.TOOLTIP_FONT_SIZE,b.padding=a.TOOLTIP_PADDING,b.border=a.TOOLTIP_BORDER,b.borderRadius=a.TOOLTIP_BORDER_RADIUS,b.boxShadow=a.TOOLTIP_BOX_SHADOW,b.zIndex=a.TOOLTIP_ZINDEX,b.setProperty&&b.setProperty("-webkit-box-shadow",a.TOOLTIP_BOX_SHADOW,null)}return Ac.toolTipDiv},isToolTipVisible:function(){return Ac.getToolTipDiv().parentNode?!0:!1},hideToolTip:function(){if(Ac._clearTimeout(),Ac._clearDismiss(),Ac.isToolTipVisible()){var a=Ac.getToolTipDiv();a.parentNode&&a.parentNode.removeChild(a)}},showToolTip:function(a,b,c){return a&&b?void(Ac.isToolTipVisible()||Ac._reshow_timeout?Ac._showToolTip(a,b,c):(Ac._clearTimeout(),Ac._show_timeout=setTimeout(function(){Ac._showToolTip(a,b,c)},Dd.TOOLTIP_INITIAL_DELAY))):void Ac.hideToolTip()},_showToolTip:function(a,b,c){var d,e,f;if(a.target?(d=a.clientX,e=a.clientY):(d=a.x,e=a.y),f=Ac.getToolTipDiv(),Ub.clear(f),b instanceof Element){var g=b.cloneNode(!0);f.appendChild(g)}else f.innerHTML=b;f.style.left=d+Dd.TOOLTIP_XOFFSET+"px",f.style.top=e+Dd.TOOLTIP_YOFFSET+"px",f.parentNode||Mb.body.appendChild(f),c&&c(f),Ac._clearDismiss(),Ac._dismiss_timeout=setTimeout(Ac.hideToolTip,Dd.TOOLTIP_DISMISS_DELAY),Ac._clearReshow(),Ac._reshow_timeout=setTimeout(Ac._clearReshow,Dd.TOOLTIP_RESHOW_DELAY)},_clearDismiss:function(){Ac._dismiss_timeout&&(clearTimeout(Ac._dismiss_timeout),Ac._dismiss_timeout=null)},_clearReshow:function(){Ac._reshow_timeout&&(clearTimeout(Ac._reshow_timeout),Ac._reshow_timeout=null)},_clearTimeout:function(){Ac._show_timeout&&(clearTimeout(Ac._show_timeout),Ac._show_timeout=null)},resetToolTip:function(){Ac.hideToolTip(),Ac.toolTipDiv=null}};Hb.popup=Ac;var Bc={handleClicked:function(a,b,c){if(!a.isSelectingElement()&&(Ob.isTouchable||0===b.button))if(c){var d=Cc(c);d&&d.onClick&&d.onClick(c,a),a.onClickElement(c,b),a.fireInteractionEvent({kind:"clickElement",event:b,element:c})}else a.onClickBackground(b),a.fireInteractionEvent({kind:"clickBackground",event:b})},handleDoubleClicked:function(a,b,c){if((Ob.isTouchable||0===b.button)&&!a.isEditingElement()){if(c){var d=Cc(c);d&&d.onDoubleClick&&d.onDoubleClick(c,a),a.onDoubleClickElement(c,b),a.fireInteractionEvent({kind:"doubleClickElement",event:b,element:c})}else a.onDoubleClickBackground(b),a.fireInteractionEvent({kind:"doubleClickBackground",event:b});c?c instanceof Gb.Link&&a.isDoubleClickToLinkBundle()?c.ISubNetwork&&a.isDoubleClickToSubNetwork()&&!Hb.isCtrlDown(b)?(a.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&a.setCurrentSubNetwork(c,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:c})}):c.reverseBundleExpanded()&&a.fireInteractionEvent({kind:"bundleLink",event:b,element:c}):c.ISubNetwork&&a.isDoubleClickToSubNetwork()?(a.isDoubleClickToEmptySubNetwork()||c.getChildrenSize()>0)&&a.setCurrentSubNetwork(c,a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"enterSubNetwork",event:b,element:c})}):c instanceof Nd&&a.isDoubleClickToGroupExpand()&&(c.reverseExpanded(),a.fireInteractionEvent({kind:"expandGroup",event:b,element:c})):a.isDoubleClickToUpSubNetwork()&&a.upSubNetwork(a.isSubNetworkAnimate(),function(){a.fireInteractionEvent({kind:"upSubNetwork",event:b})})}},handleKeyDown:function(a,b){Hb.isCtrlDown(b)&&65==b.keyCode?(a.isKeyboardSelectEnabled()&&a.selectAll().size()>0&&a.fireInteractionEvent({kind:"selectAll"}),Ub.preventDefault(b)):46==b.keyCode?(a.isKeyboardRemoveEnabled()&&a.removeSelection()&&a.fireInteractionEvent({kind:"removeElement"}),Ub.preventDefault(b)):Hb.showVersion(b)},handleLongClicked:function(a,b,c){if(Ob.isTouchable||0===b.button)if(c){var d=Cc(c);d&&d.onLongClick&&d.onLongClick(c,a),a.onLongClickElement(c,b),a.fireInteractionEvent({kind:"longClickElement",event:b,element:c})}else a.onLongClickBackground(b),a.fireInteractionEvent({kind:"longClickBackground",event:b})}},Cc=function(a){if(a&&a._image){if("object"==typeof a._image)return a._image;var b=Hb.getImageAsset(a._image);if(b)return b._image}return null};Hb.interaction=Bc;var Dc=function(a){return a.trim()[0].match(/[mlhvcsqta]/i)?Jc(a):Fc(a)},Ec={},Fc=function(a){var b=Ec[a];return b?b:(Ec[a]=b=[],a.trim().split(" ").forEach(function(a){a=a.split(","),b.push(2===a.length?{x:parseFloat(a[0]),y:parseFloat(a[1])}:a[0])}),b)},Gc={},Hc=/[mlhvcsqtaz][\d.,\-\s]*/gi,Ic=/-?(\d)+(\.(\d)+)?/g,Jc=function(a){var b,c=Gc[a];return c?c:(b=a.trim().match(Hc),Gc[a]=c=[],b&&b.forEach(function(a){var b,d=a[0],e=a.match(Ic),f=e&&e.length;if(c.push(a={c:d}),f)switch(e.forEach(function(a,b){e[b]=parseFloat(a)}),d){case"M":case"m":case"L":case"l":for(b=0;f>b;b+=2)0!==b&&c.push(a={c:"M"===d||"L"===d?"L":"l"}),a.x=e[b],a.y=e[b+1];break;case"H":case"h":for(b=0;f>b;b++)0!==b&&c.push(a={c:d}),a.x=e[b];break;case"V":case"v":for(b=0;f>b;b++)0!==b&&c.push(a={c:d}),a.y=e[b];break;case"C":case"c":for(b=0;f>b;b+=6)0!==b&&c.push(a={c:d}),a.x1=e[b],a.y1=e[b+1],a.x2=e[b+2],a.y2=e[b+3],a.x=e[b+4],a.y=e[b+5];break;case"S":case"s":for(b=0;f>b;b+=4)0!==b&&c.push(a={c:d}),a.x2=e[b],a.y2=e[b+1],a.x=e[b+2],a.y=e[b+3];break;case"Q":case"q":for(b=0;f>b;b+=4)0!==b&&c.push(a={c:d}),a.x1=e[b],a.y1=e[b+1],a.x=e[b+2],a.y=e[b+3];break;case"T":case"t":for(b=0;f>b;b+=2)0!==b&&c.push(a={c:d}),a.x=e[b],a.y=e[b+1]}}),c)},Kc=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.transform&&Lc(a.transform);return o&&o.length&&(c=Qb.identity(),o.forEach(function(a){var b=a[0];"matrix"===b?c.multiply(new Qb(a[1],a[2],a[3],a[4],a[5],a[6])):"translate"===b?c.translate(a[1]||0,a[2]||0):"scale"===b?c.scale(a[1]||1,a[2]||a[1]||1):"rotate"===b?c.rotate(a[1]||0,a[2]||0,a[3]||0):"skewX"===b?c.skew(a[1]||0,0):"skewY"===b&&c.skew(0,a[1]||0)})),"linear"===a.type?(f=a.x1||0,g=a.y1||0,h=a.x2||0,i=a.y2||0,c&&(d=c.transform(f,g),f=d.x,g=d.y,d=c.transform(h,i),h=d.x,i=d.y),e=b.createLinearGradient(f,g,h,i)):"radial"===a.type&&(j=a.fx||0,k=a.fy||0,l=a.cx||0,m=a.cy||0,n=a.r||0,null==a.fx&&(j=l),null==a.fy&&(k=m),c&&(d=c.transform(j,k),j=d.x,k=d.y,d=c.transform(l,m),l=d.x,m=d.y,n=Math.max(c._m11,c._m22)*n),e=b.createRadialGradient(j,k,0,l,m,n)),e&&a.stop&&a.stop.length&&a.stop.forEach(function(a){e.addColorStop(parseFloat(a.offset),sd(a.color,b._color))}),e},Lc=function(a){return a.replace(/[\s\r\t\n]+/gm," ").trim().replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/).map(function(a){return a.replace(")","").trim().split(/\s*\(\s*|\s+,?\s*|,\s*/).map(function(a,b){return 0===b?a:parseFloat(a)})})},Mc=Gb.Util.drawImage=function(a,b,c,d,e,f,g){var h,i,j,k,l=1;"object"!=typeof b&&(i=b,h=Hb.images[b],b=h&&h.getImage()),bd(b)?a.drawImage(h?h.getImage(c,d.width,d.height):b,d.x,d.y,d.width,d.height):b&&"object"==typeof b&&(a._data=e,a._view=f,i?(j=d.width/(b.w&&Xc(e,b,b,"w")||e.getWidth()),k=d.height/(b.h&&Xc(e,b,b,"h")||e.getHeight()),f&&(l=f.getSizeZoom?f.getSizeZoom()*f.getGraphicsZoom():f.getZoom()),!h._cache||Math.max(j*l,k*l)>1?Nc(a,b,c,d,e,f,g):a.drawImage(c?h.getImage(c,d.width,d.height):h._cache,d.x,d.y,d.width,d.height)):Nc(a,b,c,d,e,f,g),a._data=null,a._view=null)},Nc=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=e&&e.getStyle("image.state");if(p=a._vector,w=a._color,q=a._fill,r=a._pattern,s=a._lineWidth,t=a._alpha,u=a._sx,v=a._sy,m=b,Xc(e,m,m,"visible",f)!==!1){for(a._color=c,h=Xc(e,m,m,"v",f),i=h&&h.length,y=m.w&&Xc(e,m,m,"w")||e.getWidth(),z=m.h&&Xc(e,m,m,"h")||e.getHeight(),n=d.width/y,o=d.height/z,g===!0?(a._fill=null,a._pattern=null,a._lineWidth=null,a._alpha=null):(a._sx=n,a._sy=o),a.save(),a.translate(d.x+d.width/2,d.y+d.height/2),(1!==n||1!==o)&&a.scale(n,o),m.origin&&a.translate((m.origin.x-.5)*y,(m.origin.y-.5)*z),a._vector=m,m.clip&&(a.beginPath(),m.clip===!0?a.rect(-(m.origin?m.origin.x:.5)*y,-(m.origin?m.origin.y:.5)*z,y,z):m.clip.length?m.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(m.clip),a.clip()),Sc(e,m,m,a,f),j=0,i=h.length;i>j;j++)l=h[j],a._shapeData=l,f&&(f._shapeDataIndex=j,l.animate&&ub(l,m,e,f)),x=Xc(e,m,l,"state",f),Xc(e,m,l,"visible",f)===!1||x&&!(Array.isArray(x)?x.indexOf(A)>=0:x===A)||(k=Pc[l.shape],k&&(a.save(),"vector"===l.shape||"g"===l.shape?k(a,l,e,f):Sc(e,m,l,a,f,function(){k(a,l,e,f)}),a.restore())),f&&(f._shapeDataIndex=null),a._shapeData=null;a.restore(),a._vector=p,a._shapeData=null,a._color=w,a._fill=q,a._pattern=r,a._lineWidth=s,a._alpha=t,a._sx=u,a._sy=v}},Oc=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o=a._vector,p=o.origin,q=o.w&&Xc(d,o,o,"w")||d.getWidth(),r=o.h&&Xc(d,o,o,"h")||d.getHeight();if("string"==typeof b?(n=Hb.images[b],n&&(h=n.getWidth(),i=n.getHeight())):(h=b.w&&Xc(d,b,b,"w"),i=b.h&&Xc(d,b,b,"h")),h&&i&&c)for(j=c.w/h*a._sx,k=c.h/i*a._sy,f=c.x-q/2*(a._sx-1),g=c.y-r/2*(a._sy-1),p&&(f-=(p.x-.5)*q*(a._sx-1),g-=(p.y-.5)*r*(a._sy-1)),(1!==a._sx||1!==a._sy)&&(a.scale(1/a._sx,1/a._sy),f+=((p?p.x:.5)*q+c.x)*(a._sx-1),g+=((p?p.x:.5)*r+c.y)*(a._sy-1)),c={x:0,y:0,width:h,height:i},l=0;j>l;l++)for(m=0;k>m;m++)c.x=l*h+f,c.y=m*i+g,Mc(a,b,null,c,d,e,!0)},Pc={line:function(a,b,c,d){var e,f,g,h,i=Xc(c,a._vector,b,"p1",d),j=Xc(c,a._vector,b,"p2",d);i?(e=Yc(i.length?i[0]:i.x,a),f=Zc(i.length?i[1]:i.y,a)):(e=Xc(c,a._vector,b,"x1",d,!0),f=Xc(c,a._vector,b,"y1",d,!1)),j?(g=Yc(j.length?j[0]:j.x,a),h=Zc(j.length?j[1]:j.y,a)):(g=Xc(c,a._vector,b,"x2",d,!0),h=Xc(c,a._vector,b,"y2",d,!1)),a.moveTo(e,f),a.lineTo(g,h)},rect:function(a,b,c,d){var e,f,g,h,i=Xc(c,a._vector,b,"rect",d),j=Xc(c,a._vector,b,"r",d);i?(Array.isArray(i)?(e=i[0],f=i[1],g=i[2],h=i[3]):(e=i.x,f=i.y,g=i.w,h=i.h),e=Yc(e,a),f=Zc(f,a),g=Yc(g,a),h=Zc(h,a)):(e=Xc(c,a._vector,b,"x",d,!0),f=Xc(c,a._vector,b,"y",d,!1),g=Xc(c,a._vector,b,"w",d,!0),h=Xc(c,a._vector,b,"h",d,!1)),a.drawRoundRect(e,f,g,h,j),(a._gradientFunc||a._pattern)&&(a._rect={x:e,y:f,w:g,h:h})},circle:function(a,b,c,d){var e=Xc(c,a._vector,b,"cx",d,!0),f=Xc(c,a._vector,b,"cy",d,!1),g=a._vector.w&&Xc(c,a._vector,a._vector,"w")||c.getWidth(),h=a._vector.h&&Xc(c,a._vector,a._vector,"h")||c.getHeight(),i=$c(Xc(c,a._vector,b,"r",d),Math.min(g,h),b,a._vector),j=Xc(c,a._vector,b,"startAngle",d),k=Xc(c,a._vector,b,"endAngle",d),l=Xc(c,a._vector,b,"anticlockwise",d),m=Xc(c,a._vector,b,"close",d);null==j&&(j=0),null==k&&(k=360),null==l&&(l=!1),m&&a.moveTo(e,f),a.arc(e,f,i,j/180*Math.PI,k/180*Math.PI,l),m&&a.closePath(),(a._gradientFunc||a._pattern)&&(a._rect={x:e-i,y:f-i,w:2*i,h:2*i})},ellipse:function(a,b,c,d){var e=Xc(c,a._vector,b,"cx",d,!0),f=Xc(c,a._vector,b,"cy",d,!1),g=Xc(c,a._vector,b,"rx",d,!0),h=Xc(c,a._vector,b,"ry",d,!1),i=Xc(c,a._vector,b,"startAngle",d),j=Xc(c,a._vector,b,"endAngle",d),k=Xc(c,a._vector,b,"anticlockwise",d),l=Xc(c,a._vector,b,"close",d);

null==i&&(i=0),null==j&&(j=360),null==k&&(k=!1),l&&a.moveTo(e,f),a.ellipse(e,f,g,h,0,i/180*Math.PI,j/180*Math.PI,k),l&&a.closePath(),(a._gradientFunc||a._pattern)&&(a._rect={x:e-g,y:f-h,w:2*g,h:2*h})},path:function(a,b,c,d){var e=Xc(c,a._vector,b,"data",d);a.drawPath(e)},text:function(a,b,c,d){var e=Xc(c,a._vector,b,"text",d),f=Xc(c,a._vector,b,"x",d,!0),g=Xc(c,a._vector,b,"y",d,!1),h=Xc(c,a._vector,b,"w",d,!0);if(null!=e){e=String(e);var i=e.split("\n"),j=2*a.measureText("e").width,k=tb(a,e,h);g-=(k.h/j-1)/2*j,i.forEach(function(b){if(h){var c,d,e,i,k,l=b.split(" "),m=l.length,n="";for(e=0;m>e;e++)if(c=l[e]+(e===m-1?"":" "),d=n+c,i=a.measureText(d).width,h>i)n=d;else if(i==h)a.fillText(n,f,g),n="",g+=j;else{for(k=0;k<c.length;k++)if(d=n+c.substr(0,k+1),a.measureText(d).width>h){a.fillText(d.substring(0,d.length-1),f,g),n=c.substring(k,c.length),g+=j;break}for(;n.length>0&&a.measureText(n).width>h;)for(k=0;k<n.length;k++)if(d=n.substr(0,k+1),a.measureText(d).width>h){a.fillText(n.substr(0,k),f,g),n=n.substring(k,n.length),g+=j;break}}a.fillText(n,f,g)}else a.fillText(b,f,g);g+=j})}},draw:function(a,b,c,d){var e,f,g=b.draw;"string"==typeof g&&((e=g.match(Vc))?(f="with(data) { "+e[1]+" }",g=Gb.Util.newFunction("g","data","view",f)):g=cd[g]),"function"==typeof g&&g.call(a._vector,a,c,d)},vector:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=a._vector,s=Xc(c,r,b,"name",d),t=Xc(c,r,b,"x",d,!0),u=Xc(c,r,b,"y",d,!1),v=Xc(c,r,b,"w",d),w=Xc(c,r,b,"h",d);if("string"==typeof s?(l=Hb.images[s],k=l&&l._image):k=s,k)if(bd(k))null!=v&&null!=w?a.drawImage(k,t,u,Yc(v,a),Zc(w,a)):a.drawImage(k,t,u);else{for(m=Xc(c,k,k,"v",d),n=m&&m.length,o=k.w&&Xc(c,k,k,"w"),p=k.h&&Xc(c,k,k,"h"),null!=v&&null!=w?(v=Yc(v,a),w=Zc(w,a)):(v=o,w=p),a.save(),h=a._lineWidth,i=a._fill,j=a._alpha,Sc(c,k,k,a,d),Sc(c,r,b,a,d),a.translate(t,u),a.scale(v/o,w/p),k.origin&&a.translate((k.origin.x-.5)*o,(k.origin.y-.5)*p),k.clip&&(a.beginPath(),k.clip===!0?a.rect(-(k.origin?k.origin.x:.5)*o,-(k.origin?k.origin.y:.5)*p,o,p):k.clip.length?k.clip.forEach(function(b){a.drawShape(b)}):a.drawShape(k.clip),a.clip()),q=a._shapeData,a._vector=k,e=0;n>e;e++)f=m[e],a._shapeData=f,d&&(d._shapeDataIndex.length?d._shapeDataIndex.push(e):d._shapeDataIndex=[d._shapeDataIndex,e],f.animate&&ub(f,r,c,d)),Xc(c,k,f,"visible",d)!==!1&&(g=Pc[f.shape],g&&(a.save(),"vector"===f.shape||"g"===f.shape?g(a,f,c,d):Sc(c,k,f,a,d,function(){g(a,f,c,d)}),a.restore())),d&&d._shapeDataIndex.pop();a._vector=r,a._shapeData=q,a._lineWidth=h,a._fill=i,a._alpha=j,a.restore()}},g:function(a,b,c,d){var e,f,g,h,i,j=Xc(c,a._vector,b,"v",d);j&&j.length&&(a.save(),f=a._lineWidth,g=a._fill,h=a._alpha,i=a._shapeData,Sc(c,a._vector,b,a,d),j.forEach(function(b){Xc(c,a._vector,b,"visible",d)!==!1&&(e=Pc[b.shape],e&&(a.save(),a._shapeData=b,"vector"===b.shape||"g"===b.shape?e(a,b,c,d):Sc(c,a._vector,b,a,d,function(){e(a,b,c,d)}),a.restore()))}),a._lineWidth=f,a._fill=g,a._alpha=h,a._shapeData=i,a.restore())}};Pc.image=Pc.vector;var Qc=Object.keys(Pc),Rc={M:function(a,b){return a.moveTo(b.x,b.y),a._path_start=b,a._rect&&ad(a._rect,b.x,b.y),b},m:function(a,b,c){return c&&(b={x:c.x+b.x,y:c.y+b.y}),a.moveTo(b.x,b.y),a._path_start=b,a._rect&&ad(a._rect,b.x,b.y),b},Z:function(a){return a.closePath(),a._path_start},z:function(a){return a.closePath(),a._path_start},L:function(a,b){return a.lineTo(b.x,b.y),a._rect&&ad(a._rect,b.x,b.y),b},l:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},H:function(a,b,c){var d={x:b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},h:function(a,b,c){var d={x:c.x+b.x,y:c.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},V:function(a,b,c){var d={x:c.x,y:b.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},v:function(a,b,c){var d={x:c.x,y:c.y+b.y};return a.lineTo(d.x,d.y),a._rect&&ad(a._rect,d.x,d.y),d},Q:function(a,b){return a._preQ_x=b.x1,a._preQ_y=b.y1,a.quadraticCurveTo(b.x1,b.y1,b.x,b.y),a._rect&&(ad(a._rect,b.x1,b.y1),ad(a._rect,b.x,b.y)),b},q:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=c.x+b.x1,f=a._preQ_y=c.y+b.y1;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,d.x,d.y)),d},T:function(a,b,c){var d=a._preQ_x=2*c.x-a._preQ_x,e=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(d,e,b.x,b.y),a._rect&&(ad(a._rect,d,e),ad(a._rect,b.x,b.y)),b},t:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=a._preQ_x=2*c.x-a._preQ_x,f=a._preQ_y=2*c.y-a._preQ_y;return a.quadraticCurveTo(e,f,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,d.x,d.y)),d},C:function(a,b){return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(b.x1,b.y1,b.x2,b.y2,b.x,b.y),a._rect&&(ad(a._rect,b.x1,b.y1),ad(a._rect,b.x2,b.y2),ad(a._rect,b.x,b.y)),b},c:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=c.x+b.x1,f=c.y+b.y1,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,g,h),ad(a._rect,d.x,d.y)),d},S:function(a,b,c){var d=2*c.x-a._preC_x,e=2*c.y-a._preC_y;return a._preC_x=b.x2,a._preC_y=b.y2,a.bezierCurveTo(d,e,b.x2,b.y2,b.x,b.y),a._rect&&(ad(a._rect,d,e),ad(a._rect,b.x2,b.y2),ad(a._rect,b.x,b.y)),b},s:function(a,b,c){var d={x:c.x+b.x,y:c.y+b.y},e=2*c.x-a._preC_x,f=2*c.y-a._preC_y,g=a._preC_x=c.x+b.x2,h=a._preC_y=c.y+b.y2;return a.bezierCurveTo(e,f,g,h,d.x,d.y),a._rect&&(ad(a._rect,e,f),ad(a._rect,g,h),ad(a._rect,d.x,d.y)),d}},Sc=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t=Xc(a,b,c,"line",e),u=Xc(a,b,c,"fill",e),v=Xc(a,b,c,"fillRule",e)||"nonzero",w=Xc(a,b,c,"gradient",e),x=Xc(a,b,c,"gradientColor",e),y=Xc(a,b,c,"pattern",e),z=Xc(a,b,c,"font",e),A=Xc(a,b,c,"textAlign",e)||"center",B=Xc(a,b,c,"textBaseline",e)||"middle",C=Xc(a,b,c,"translate",e),D=Xc(a,b,c,"rotate",e),E=Xc(a,b,c,"rotateOrigin",e),F=Xc(a,b,c,"scale",e),G=Xc(a,b,c,"transform",e),H=Xc(a,b,c,"alpha",e),I=d._lineWidth,J=d._fill,K=d._pattern,L=d._alpha,M=d._gradientFunc;if(t?(g=t.color,h=t.width,i=t.cap,j=t.join,k=t.miterLimit,l=t.dash,m=t.dashOffset):(g=Xc(a,b,c,"lineColor",e),h=Xc(a,b,c,"lineWidth",e),i=Xc(a,b,c,"lineCap",e),j=Xc(a,b,c,"lineJoin",e),k=Xc(a,b,c,"miterLimit",e),l=Xc(a,b,c,"lineDash",e),m=Xc(a,b,c,"lineDashOffset",e)),null!=g&&(d.strokeStyle=sd(g,d._color)),null!=h&&(d.lineWidth=d._lineWidth=e&&e.getSizeZoom&&!e.zoomManager.sizeChange?h/e.getSizeZoom():h),null!=i&&(d.lineCap=i),null!=j&&(d.lineJoin=j),null!=k&&(d.miterLimit=k),null!=l&&(d.lineDash=l,d.setLineDash(l)),null!=m&&(d.lineDashOffset=m),y?d._pattern=y:(u&&(d.fillStyle=d._fill=sd(u,d._color)),w&&("string"==typeof w?o=Wb[w]:(o=Wb[w.type],w.color&&(x=w.color),o||(w=Kc(w,d))),d._gradientFunc=o)),null!=z&&(d.font=z),null!=A&&(d.textAlign=A),null!=B&&(d.textBaseline=B),Tc(a,b,c,d,e),null!=G)"string"==typeof G&&(G=Lc(G)),G.length&&G.forEach(function(a){var b=a[0];"matrix"===b?d.transform(a[1],a[2],a[3],a[4],a[5],a[6]):"translate"===b?d.translate(a[1]||0,a[2]||0):"scale"===b?d.scale(a[1]||1,a[2]||a[1]||1):"rotate"===b?a.length>2?(d.translate(a[2],a[3]),d.rotate(a[1]),d.translate(-a[2],-a[3])):d.rotate(a[1]):"skewX"===b?d.transform(1,0,Math.tan(a[1]*Math.PI/180),1,0,0):"skewY"===b&&d.transform(1,Math.tan(a[1]*Math.PI/180),0,1,0,0)});else{if(null!=C&&(Array.isArray(C)?(r=C[0],s=C[1]):"object"==typeof C?(r=C.x,s=C.y):(r=C,s=0),r=Yc(r,d),s=Zc(s,d),(0!==r||0!==s)&&d.translate(r,s)),null!=D&&D%360!==0){var N,O;E&&(Array.isArray(E)?(N=E[0],O=E[1]):"object"==typeof E?(N=E.x,O=E.y):N=O=E,N=Yc(N,d),O=Zc(O,d),(0!==N||0!==O)&&d.translate(N,O)),d.rotate(D*Math.PI/180),E&&(0!==N||0!==O)&&d.translate(-N,-O)}null!=F&&(Array.isArray(F)?(p=F[0],q=F[1]):"object"==typeof F?(p=F.x,q=F.y):p=q=F,(1!==p||1!==q)&&d.scale(p,q))}null!=H&&(d.globalAlpha=d._alpha=null!=L?L*H:H),f&&(d.beginPath(),f(),n=d._rect||c.rect,d._pattern?(d._lineWidth>0&&d.stroke(),d.clip(),Oc(d,d._pattern,n,a,e)):(o&&n&&(w=o(d,sd(u||"#000000",d._color),sd(x||"#FFFFFF",d._color),n.x,n.y,n.w,n.h)),w&&(d.fillStyle=d._fill=w),d._fill&&d.fill(v),d._lineWidth>0&&d.stroke()),d._lineWidth=I,d._fill=J,d._pattern=K,d._alpha=L,d._gradientFunc=M,d._rect=null)},Tc=function(a,b,c,d,e){var f,g,h,i,j=Xc(a,b,c,"shadow",e);j?(f=j.offsetX,g=j.offsetY,h=j.blur,i=j.color):(f=Xc(a,b,c,"shadowOffsetX",e),g=Xc(a,b,c,"shadowOffsetY",e),h=Xc(a,b,c,"shadowBlur",e),i=Xc(a,b,c,"shadowColor",e)),null!=f&&(d.shadowOffsetX=f),null!=g&&(d.shadowOffsetY=g),null!=h&&(d.shadowBlur=h),null!=i&&(d.shadowColor=i)},Uc=/<%=([\s\S]+?)%>/,Vc=/<%([\s\S]+?)%>/,Wc=new RegExp([Uc.source,Vc.source].join("|")),Xc=function(a,b,c,d,e,f,g){var h,i,j,k,l,m=c[d],n=typeof m;if("string"===n&&(h=m.match(Wc))?(i="with(data) { "+(h[1]?"return "+h[1]:h[2])+" }",j=Gb.Util.newFunction("data","view",i),m=j.call(b,a,e)):"function"===n&&(m=m.call(b,a,e)),f===!0?(k=b.w&&Xc(a,b,b,"w")||a.getWidth(),(c.rel===!0||void 0===c.rel&&b.rel)&&1>=m&&m>=-1?m*=k:"string"==typeof m&&(m=parseInt(m)/100*k),m=m||0):f===!1&&(l=b.h&&Xc(a,b,b,"h")||a.getHeight(),(c.rel===!0||void 0===c.rel&&b.rel)&&1>=m&&m>=-1?m*=l:"string"==typeof m&&(m=parseInt(m)/100*l),m=m||0),g!==!1&&e&&a&&c.animate&&a._animates){var o,p=a._animates,q=e._shapeDataIndex;if(q.length)for(var r=0;r<q.length;r++)o=q[r],p=p[o];else o=q;var s=p[o],t=s[d];if(t)if(Array.isArray(t))for(var r=t.length-1;r>=0;r--){var u=t[r];if((u.stopped||u.time>0)&&u.started)return Fb(u,m)}else if(t.started)return Fb(t,m)}return m},Yc=function(a,b){if(!a)return 0;var c=b._vector.w&&Xc(b._data,b._vector,b._vector,"w")||b._data.getWidth();return(b._shapeData&&b._shapeData.rel===!0||(!b._shapeData||void 0===b._shapeData.rel)&&b._vector.rel)&&1>=a&&a>=-1?a*c:"string"==typeof a?parseInt(a)/100*c:a},Zc=function(a,b){if(!a)return 0;var c=b._vector.h&&Xc(b._data,b._vector,b._vector,"h")||b._data.getHeight();return(b._shapeData&&b._shapeData.rel===!0||(!b._shapeData||void 0===b._shapeData.rel)&&b._vector.rel)&&1>=a&&a>=-1?a*c:"string"==typeof a?parseInt(a)/100*c:a},$c=function(a,b,c,d){return a?(c.rel===!0||void 0===c.rel&&d.rel)&&1>=a&&a>=-1?a*b:"string"==typeof a?parseInt(a)/100*b:a:0},_c=(window.CanvasRenderingContext2D||Jb.Context2d).prototype;_c.drawShape=function(a){var b=this,c=b._vector,d=b._shapeData,e=b._data,f=b._view,g=Pc[a.shape];g&&(b.save(),b._shapeData=a,"vector"===a.shape||"g"===a.shape?g(b,a,e,f):Sc(e,c,a,b,f,function(){g(b,a,e,f)}),b._shapeData=d,b.restore())},_c.drawPath=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this;if("string"==typeof a&&(a=Dc(a)),j=a?a.length:0,!(1>=j)){if((n._gradientFunc||n._pattern)&&(n._rect=k={x:0,y:0,w:0,h:0}),b=a&&a[0]&&a[0].c,b||(c=a&&a[0]&&null!=a[0].x,d="z"===a[j-1]||"Z"===a[j-1],d&&j--),b){for(e=0;j>e;e++)g=a[e],h=Rc[g.c],h&&(f=h(n,g,f));n._path_start=null,n._preC_x=null,n._preC_y=null,n._preQ_x=null,n._preQ_y=null}else if(c){for(i=a[0],l=Yc(i.x,n),m=Zc(i.y,n),n.moveTo(l,m),k&&ad(k,l,m),e=1;j>e;e++)i=a[e],l=Yc(i.x,n),m=Zc(i.y,n),n.lineTo(l,m),k&&ad(k,l,m);d&&n.closePath()}else{for(l=Yc(a[0],n),m=Zc(a[1],n),n.moveTo(l,m),k&&ad(k,l,m),e=2;j>e;e+=2)l=Yc(a[e],n),m=Zc(a[e+1],n),n.lineTo(l,m),k&&ad(k,l,m);d&&n.closePath()}return a}};var ad=function(a,b,c){var d=Math.min(a.x,b),e=Math.max(a.x+a.w,b),f=Math.min(a.y,c),g=Math.max(a.y+a.h,c);a.x=d,a.y=f,a.w=e-d,a.h=g-f};_c._fillPath=function(a,b){var c=this;c.beginPath(),c.fillStyle=a,c.drawPath(b),c.fill()},_c._fillRect=function(a,b,c,d,e){var f=this;f.beginPath(),f.fillStyle=a,f.rect(b,c,d,e),f.fill()},_c.ellipse||(_c.ellipse=function(a,b,c,d){var e=this,f=.5522848,g=c*f,h=d*f,i=a+c,j=b+d,k=a-c,l=b-d;e.moveTo(k,b),e.bezierCurveTo(k,b-h,a-g,l,a,l),e.bezierCurveTo(a+g,l,i,b-h,i,b),e.bezierCurveTo(i,b+h,a+g,j,a,j),e.bezierCurveTo(a-g,j,k,b+h,k,b)}),_c.drawRoundRect=function(a,b,c,d,e){var f=this;if(!e)return void f.rect(a,b,c,d);var g,h,i,j;if(Array.isArray(e))if(1===e.length)g=h=i=j=e[0];else if(2===e.length)g=h=e[0],i=j=e[1];else{if(4!==e.length)return void f.rect(a,b,c,d);g=e[0],h=e[1],i=e[2],j=e[3]}else g=h=i=j=e;var k=a+c,l=b+d,m=d>c?2*c:2*d;g=m>g?g:m,h=m>h?h:m,i=m>i?i:m,j=m>j?j:m;var n=.292893218813453*j,o=.585786437626905*j;f.moveTo(k,l-j),f.quadraticCurveTo(k,l-o,k-n,l-n),f.quadraticCurveTo(k-o,l,k-j,l),n=.292893218813453*i,o=.585786437626905*i,f.lineTo(a+i,l),f.quadraticCurveTo(a+o,l,a+n,l-n),f.quadraticCurveTo(a,l-o,a,l-i),n=.292893218813453*g,o=.585786437626905*g,f.lineTo(a,b+g),f.quadraticCurveTo(a,b+o,a+n,b+n),f.quadraticCurveTo(a+o,b,a+g,b),n=.292893218813453*h,o=.585786437626905*h,f.lineTo(k-h,b),f.quadraticCurveTo(k-o,b,k-n,b+n),f.quadraticCurveTo(k,b+o,k,b+h),f.lineTo(k,l-j)};var bd=function(a){return Jb?a instanceof Jb||a instanceof Nb:a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement},cd={},dd=function(a,b){"function"==typeof b&&(cd[a]=b)},ed=function(a,b){"function"==typeof b&&Qc.indexOf(a)<0&&(Pc[a]=b)};!function(){for(var a=["webkit","moz"],b=0;b<a.length&&!window.requestAnimationFrame;++b){var c=a[b];window.requestAnimationFrame=window[c+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var d=0;window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(d+16,b);return setTimeout(function(){a(d=c)},c-b)},window.cancelAnimationFrame=clearTimeout}}();var fd=Gb.Animate=function(a){var b=this;b.type=null==a.type?"number":a.type,b.delay=null==a.delay?0:a.delay,b.dur=null==a.dur?1e3:a.dur,b.interval=null==a.interval?0:a.interval,b.finish=null==a.finish?b.delay+b.dur+b.interval:a.finish,null==a.finish?b.finish=b.delay+b.dur+b.interval:(b.finish=a.finish,b.interval=b.finish-b.delay-b.dur),b.repeat=null==a.repeat?1:a.repeat,b.reverse=null==a.reverse?!0:a.reverse,b.easing=null==a.easing?"easeNone":a.easing,b.onUpdate=a.onUpdate,b.onDone=a.onDone,b.onStop=a.onStop,b.onPlay=a.onPlay,b.attr=a.attr,b.source=a.source,b.filter=a.filter,b.from=a.from,b.to=a.to,b.start=null,b.time=0,b.total=0,b.count=0,b.started=!1,b.stopped=!1,b.paused=!1,b.pausedTime=null,b.pausedTotal=0,b._speed=1,b._oldSpeed=null,b._speedTotal=0,b._speedTime=null,b._percent=0,b._percentSet=null,b._percentDiff=0,b.id=hd++};Hb.ext("twaver.Animate",Object,{play:function(){return wb(this)},stop:function(a){return xb(this,a)},pause:function(){this.stopped||(this.paused=!0)},resume:function(){this.paused&&(this.paused=!1,id=!0)},isPaused:function(){return this.paused},percent:function(a){return null==a?this._percentSet||this._percent:(this._percentSet=0>a?0:a>100?100:a,this.paused&&(id=!0),this.started||(this.play(),this.pause()),this)},speed:function(a){return null==a?this._speed:(a=0>a?1:a,a!==this.speed&&(this.stopped||(this._oldSpeed=this._speed),this._speed=a),this)},clone:function(){return new fd(this)},chain:function(a){var b,c=this;return c.next=a,a.pre=c,c.onDone?(b=c.onDone,c.onDone=function(){b.call(c),a.play()}):c.onDone=function(){a.play()},c}});var gd={},hd=1,id=!1;!function Nf(a){Gb.animateLoopId=requestAnimationFrame(Nf),id&&(id=!1,Bb(a))}(0);var jd={easeNone:function(a,b,c,d){return c*a/d+b},easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeBoth:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInStrong:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOutStrong:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeBothStrong:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b},elasticIn:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},elasticOut:function(a,b,c,d,e,f){var g;return 0===a?b:1===(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},elasticBoth:function(a,b,c,d,e,f){var g;return 0===a?b:2===(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},backIn:function(a,b,c,d,e){return void 0===e&&(e=1.70158),a===d&&(a-=.001),c*(a/=d)*a*((e+1)*a-e)+b},backOut:function(a,b,c,d,e){return"undefined"==typeof e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},backBoth:function(a,b,c,d,e){return"undefined"==typeof e&&(e=5.70158),(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},bounceIn:function(a,b,c,d){return c-jd.bounceOut(d-a,0,c,d)+b},bounceOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},bounceBoth:function(a,b,c,d){return d/2>a?.5*jd.bounceIn(2*a,0,c,d)+b:.5*jd.bounceOut(2*a-d,0,c,d)+.5*c+b}},kd={draw:function(a,b){var c=null==b.getCurrentSubNetwork()?b.getElementBox():b.getCurrentSubNetwork(),d=c.getStyle("background.type");"image"==d?this.drawImage(a,c,b):"vector"==d?this.drawVector(a,c,b):"image.vector"==d?(this.drawImage(a,c,b),this.drawVector(a,c,b)):"vector.image"==d&&(this.drawVector(a,c,b),this.drawImage(a,c,b))},drawImage:function(a,b,c){var d=b.getStyle("background.image"),e=Hb.getImageAsset(d),f=c.getGraphicsZoom?c.getGraphicsZoom():c.getZoom();if(null!=e){var g=b.getStyle("background.image.scope"),h=c.getScopeRect(g),i=c._dragToPan?0:-h.x/f,j=c._dragToPan?0:-h.y/f;("rootcanvas"==g||"viewport"==g)&&(h.x=i,h.y=j),"rootcanvas"==g&&(h.width=Math.max(e.getWidth(),h.width/f),h.height=Math.max(e.getHeight(),h.height/f)),"none"==b.getStyle("background.image.stretch")&&(h.width=e.getWidth(),h.height=e.getHeight());var k=b.getStyle("background.image.padding");if(k&&Rb.grow(h,k,k),"tile"==b.getStyle("background.image.stretch")){if(bd(e.getImage()))for(var l=0;l<h.width;l+=e.getWidth())for(var m=0;m<h.height;m+=e.getHeight())a.drawImage(e.getImage(),l,m)}else("fill"==b.getStyle("background.image.stretch")||"none"==b.getStyle("background.image.stretch"))&&Mc(a,e.getImage(),null,h,b,c)}},drawVector:function(a,b,c){var d=b.getStyle("background.vector.scope"),e=c.getScopeRect(d),f=c.getGraphicsZoom?c.getGraphicsZoom():c.getZoom(),g=c._dragToPan?0:-e.x/f,h=c._dragToPan?0:-e.y/f;("rootcanvas"==d||"viewport"==d)&&(e.x=g,e.y=h),"rootcanvas"==d&&(e.width=e.width/f,e.height=e.height/f);var i=b.getStyle("background.outline.width"),j=(b.getStyle("background.outline.color"),b.getStyle("background.vector.fill")),k=b.getStyle("background.vector.fill.color"),l=b.getStyle("background.vector.padding"),m=b.getStyle("background.vector.shape"),n=b.getStyle("background.vector.pattern");l&&Rb.grow(e,l,l);var o=b.getStyle("background.vector.gradient");j&&(o?Vb.fill(a,k,o,b.getStyle("background.vector.gradient.color"),e):a.fillStyle=k,Vb.drawVector(a,m,n,e),a.fill()),i>0&&(a.lineWidth=i,a.strokeStyle=b.getStyle("background.outline.color"),Vb.drawVector(a,m,n,e),a.stroke())}},ld=Gb.UndoManager=function(a){var b=this;b._list=[],b._cursor=-1,b._suspended=!1,b._dispatcher=new Gb.EventDispatcher,b._box=a,b._enabled=!1,b._limit=100};ld._IGNORE_PROPERTIES={alarmState:1,propagateSeverity:1,enablePropagation:1,children:1,fromAgent:1,toAgent:1,bundleLinks:1},Hb.ext("twaver.UndoManager",Object,{setEnabled:function(a){var b=this,c=b._box;b._enabled!=a&&(a?(c.addDataBoxChangeListener(b._handleDataBoxChange,b,!0),c.addDataPropertyChangeListener(b._handleDataPropertyChange,b,!0)):(c.removeDataBoxChangeListener(b._handleDataBoxChange,b),c.removeDataPropertyChangeListener(b._handleDataPropertyChange,b))),b._enabled=a},isEnabled:function(){return this._enabled},undo:function(){var a,b,c,d=this,e=d._list;if(d.canUndo()){if(a=e[d._cursor--],d._suspended=!0,a.length)for(c=a.length,b=c-1;b>=0;b--)a[b].undo();else a.undo();d._suspended=!1,d._fire({kind:"undo",action:a})}},redo:function(){var a,b=this,c=b._list;b.canRedo()&&(a=c[++b._cursor],b._suspended=!0,a.length?a.forEach(function(a){a.redo()}):a.redo(),b._suspended=!1,b._fire({kind:"redo",action:a}))},canUndo:function(){return this._cursor>=0},canRedo:function(){return this._cursor<this._list.length-1},_add:function(a){var b=this,c=b._batch,d=b._list;c?c.push(a):(b._cursor!==d.length-1&&d.splice(b._cursor+1,d.length),0!==b._limit&&d.length===b._limit&&d.splice(0,1),d.push(a),b._cursor=d.length-1,b._fire({kind:"add",action:a}))},_handleDataBoxChange:function(a){if(!this._suspended){var b=this,c=b._box,d=a.kind,e=a.data;"add"===d?b._add({undo:function(){var a=this;a.parent=e.getParent(),a.host=e.getHost&&e.getHost(),e.getFromNode&&(a.fromNode=e.getFromNode(),a.toNode=e.getToNode()),c.remove(e)},redo:function(){var a=this;a.parent&&e.setParent(a.parent),e.getHost&&a.host&&e.setHost(a.host),e.getFromNode&&(a.fromNode&&e.setFromNode(a.fromNode),a.toNode&&e.setToNode(a.toNode)),c.add(e)}}):"remove"===d&&b._add({undo:function(){c.add(e)},redo:function(){c.remove(e)}})}},_handleDataPropertyChange:function(a){if(!this._suspended){var b=this,c=a.property,d=c.substr(0,2),e=a.source,f=a.oldValue,g=a.newValue;"C:"===d?(c=c.substr(2),b._add({undo:function(){e.setClient(c,f)},redo:function(){e.setClient(c,g)}})):"S:"===d?(c=c.substr(2),b._add({undo:function(){e.setStyle(c,f)},redo:function(){e.setStyle(c,g)}})):ld._IGNORE_PROPERTIES[c]||b._add({undo:function(){e[Hb.setter(c)](f)},redo:function(){e[Hb.setter(c)](g)}})}},size:function(){return this._list.length},getCursor:function(){return this._cursor},_fire:function(a){this._dispatcher.fire(a)},on:function(a,b,c){this._dispatcher.add(a,b,c)},off:function(a,b){this._dispatcher.remove(a,b)},isSuspended:function(){return this._suspended},setSuspended:function(a){this._suspended=a},getLimit:function(){return this._limit},setLimit:function(a){var b,c,d=this,e=d._list;return 0>a&&(a=0),a!==d._limit&&(b=e.length-a,a>0&&b>0&&(c=d._cursor+1,d._cursor-=b,d._cursor<-1&&(d._cursor=-1),c>0&&e.splice(0,c),b-=c,b>0&&e.splice(e.length-b,b)),d._limit=a,d._fire({kind:"change"})),d},clear:function(){var a=this;return a._list=[],a._cursor=-1,a._fire({kind:"clear"}),a},batch:function(a,b){var c=this;return c.startBatch(),a.call(b),c.endBatch(),c},startBatch:function(){var a=this;return a._batch||(a._batch=[]),a},endBatch:function(){var a,b=this;return b._batch&&(a=b._batch,b._batch=null,a.length&&b._add(a)),b}}),Gb.Pool=function(a,b){this.func="string"==typeof a?function(){return Mb.createElement(a)}:a,this.tagName=a,null!=b&&(this.redundancy=b)},Hb.ext("twaver.Pool",Object,{redundancy:2,currentIndex:-1,get:function(){if(this.currentIndex++,this.currentIndex===this.size()){var a=this.func();return a._pool=this,a.style.margin="0px",a.style.padding="0px",this.list||(this.list=new md),this.list.add(a),a}return this.list.get(this.currentIndex)},release:function(a){this.list&&this.list.remove(a)>=0&&(delete a._selectData,delete a._expandData,delete a._checkData,delete a._editInfo,delete a.keepDefault,a.style.margin="0px",a.style.padding="0px",a.style.backgroundColor="",a.removeAttribute("title"),"img"===this.tagName&&a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height"),a.removeAttribute("src")),this.list.add(a),this.currentIndex--)},reset:function(){this.currentIndex=-1},clear:function(){if(this.list)for(;this.redundancy+this.currentIndex<this.list.size()-1;)delete this.list.removeAt(this.list.size()-1)._pool},size:function(){return this.list?this.list.size():0}});var md=function(){if(this._as=[],1===arguments.length){var a=arguments[0];if(a instanceof md&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this._as.push(a[c]);else a===!1?(this._duplicatable=!1,this._map={}):null!=a&&this._as.push(a)}else if(arguments.length>1)for(b=arguments.length,c=0;b>c;c++)this._as.push(arguments[c])};Gb.List=md,Hb.ext("twaver.List",Object,{_duplicatable:!0,size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(a,b){if(!this._duplicatable){if(this._map[a._id])return;this._map[a._id]=!0}return void 0===b?this._as.push(a):this._as.splice(b,0,a)},addAll:function(a){if(a instanceof md&&(a=a._as),a instanceof Array)for(var b=a.length,c=0;b>c;c++)this.add(a[c]);else this.add(a)},get:function(a){return this._as[a]},remove:function(a){if(!this._duplicatable&&!this._map[a&&a._id])return-1;var b=this._as.indexOf(a);return b>=0&&b<this._as.length&&this.removeAt(b),b},removeAt:function(a){var b=this._as.splice(a,1)[0];return!this._duplicatable&&b&&delete this._map[b._id],b},set:function(a,b){var c=this._as[a];if(c===b)return b;if(!this._duplicatable){if(this._map[b._id])throw"duplicate item:"+b;delete this._map[c._id],this._map[b._id]=!0}return this._as[a]=b,c},clear:function(){return this._duplicatable||(this._map={}),this._as.splice(0,this._as.length)},contains:function(a){return this._duplicatable?this.indexOf(a)>=0:!!this._map[a&&a._id]},indexOf:function(a){return this._as.indexOf(a)},forEach:function(a,b){for(var c=this._as.length,d=0;c>d;d++){var e=this._as[d];b?a.call(b,e):a(e)}},forEachReverse:function(a,b){for(var c=this._as.length,d=c-1;d>=0;d--){var e=this._as[d];b?a.call(b,e):a(e)}},toArray:function(a,b){if(a){for(var c=[],d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.push(f):a(f)&&c.push(f)}return c}return this._as.concat()},toList:function(a,b){if(a){for(var c=new md,d=this._as.length,e=0;d>e;e++){var f=this._as[e];b?a.call(b,f)&&c.add(f):a(f)&&c.add(f)}return c}return new md(this)},sort:function(a){return a?this._as.sort(a):this._as.sort(),this},toString:function(){return this._as.toString()}});var nd={shapeMap:{},init:function(){nd.register("arrow.standard",nd.createStandardArrow()),nd.register("arrow.delta",nd.createDeltaArrow()),nd.register("arrow.diamond",nd.createDiamondArrow()),nd.register("arrow.short",nd.createShortArrow()),nd.register("arrow.slant",nd.createSlantArrow()),nd.register("arrow.doubledelta",nd.createDoubleDeltaArrow()),nd.register("arrow.tee",nd.createTeeArrow()),nd.register("arrow.box",nd.createBoxArrow()),nd.register("arrow.dot",nd.createDotArrow()),nd.register("arrow.tail",nd.createTailArrow())},createStandardArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-0.75,y:0}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),{points:a}},createDeltaArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),{points:a}},createDoubleDeltaArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-1,y:5/9}),a.add({x:-0.5,y:0}),a.add({x:-0.5,y:-5/9}),a.add({x:0,y:0}),a.add({x:-0.5,y:5/9}),a.add({x:-0.5,y:0}),a.add({x:-1,y:-5/9}),{points:a}},createTeeArrow:function(){var a=new md;return a.add({x:-1/9,y:-5/9}),a.add({x:-1/9,y:5/9}),a.add({x:0,y:5/9}),a.add({x:0,y:-5/9}),a.add({x:-1/9,y:-5/9}),{points:a}},createBoxArrow:function(){var a=new md;return a.add({x:-10/9,y:-5/9}),a.add({x:-10/9,y:5/9}),a.add({x:0,y:5/9}),a.add({x:0,y:-5/9}),a.add({x:-10/9,y:-5/9}),{points:a}},createDotArrow:function(){var a={},b=new Gb.List;return b.add({x:-0.5,y:0}),a.points=b,a.draw=function(a,b){if(a&&b&&b.points&&!(b.points.size()<=0)){var c=b.points._as,d=c[0],e=Math.min(b.width,b.height)/2;a.save(),a.beginPath(),a.arc(d.x,d.y,e,0,2*Math.PI,!1),a.closePath(),a.restore()}},a},createTailArrow:function(){for(var a={},b=new Gb.List,c=30,d=-c/2;c/2>d;d++)b.add({x:-d/9,y:0});return a.points=b,a.draw=function(a,b){if(a&&b&&b.points&&!(b.points.size()<=0))for(var c=b.points._as,d=b.shadow,e=b.shadowColor,f=b.shadowXOffset,g=b.shadowYOffset,h=b.shadowBlur,e=b.shadowColor,i=c.length-4,j=Math.min(b.width,b.height)/2,k=0;i>k;k++){var l=k/i,m=c[k],n=.4*j;a.save(),a.restore(),a.beginPath(),a.globalAlpha=l*l,d&&(a.shadowOffsetX=f,a.shadowOffsetY=g,a.shadowBlur=h,a.shadowColor=e),a.arc(m.x,m.y,n,0,2*Math.PI,!1),a.closePath(),a.fill()}},a},createDiamondArrow:function(){var a=new md;return a.add({x:-7/12,y:5/9}),a.add({x:-14/12,y:0}),a.add({x:-7/12,y:-5/9}),a.add({x:0,y:0}),a.add({x:-7/12,y:5/9}),{points:a}},createShortArrow:function(){var a=new md;return a.add({x:-8/12,y:6/9}),a.add({x:-5/12,y:0}),a.add({x:-8/12,y:-6/9}),a.add({x:0,y:0}),a.add({x:-8/12,y:6/9}),{points:a}},createSlantArrow:function(){var a=new md;return a.add({x:-1,y:-5/9}),a.add({x:-6.5/12,y:0}),a.add({x:-0.75,y:4/9}),a.add({x:0,y:0}),a.add({x:-1,y:-5/9}),{points:a}},register:function(a,b){nd.shapeMap[a]=b},getShape:function(a){if(a)return nd.shapeMap[a];throw"shape type can't be null"},getArrowRect:function(a,b,c,d,e,f,g,h,i){var j=nd.getShape(d);if(j&&j.points&&!(j.points&&j.points.size()<=0)){if(g>0&&1>g){var k;k=a.getLineLength?a.getLineLength():a._element.getLineLength(),g*=k}else a.getLineLength&&(g+=nd.calculateArrowXOffsetAtEdge(b,a,c,i));var l,m,n,o=Rb.calculatePointInfoAlongLine(b,c,g,h),p=o.point,q=o.angle,r=j.points._as,s=r.length,t=new md;for(n=new Qb(e,0,0,f,p.x,p.y),l=0;s>l;l++)t.add(n.transform(r[l]));for(n=Rb.createMatrix(q+Math.PI,p.x,p.y),l=0;s>l;l++)m=t.get(l),m instanceof md&&(m=m._as),m instanceof Array?(m[0]=n.transform(m[0]),m[1]=n.transform(m[1])):t.set(l,n.transform(m));return Rb.getLineRect(t)}},drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l,m){i=i||0,j=j||0,k=k||0;var n=m._element.getStyle("arrow.from.shadow"),o=m._element.getStyle("arrow.from.shadow.color"),p=m._element.getStyle("arrow.from.shadow.xoffset"),q=m._element.getStyle("arrow.from.shadow.yoffset"),r=m._element.getStyle("arrow.from.shadow.blur"),s=k>=0&&l;if(g||s){var t=nd.getShape(f);if(t&&t.points&&!(t.points&&t.points.size()<=0)){var u=Rb.calculatePointInfoAlongLine(d,e,i,j),v=u.point,w=u.angle;g&&(a.fillStyle=h),a.beginPath(),s&&(a.lineWidth=k,a.strokeStyle=l),nd._drawArrow(a,t,w,v,b,c,l,o,n,p,q,r),n&&(a.shadowOffsetX=p,a.shadowOffsetY=q,a.shadowBlur=r,a.shadowColor=o),g&&a.fill(),s&&a.stroke()}}},_drawArrow:function(a,b,c,d,e,f,g,h,i,j,k,l){if(b.draw){for(var m=new Gb.List,n=0;n<b.points._as.length;n++)m.add(b.points.get(n));m.add({x:-1,y:-0.5}),m.add({x:-1,y:.5}),m.add({x:0,y:.5}),m.add({x:0,y:-0.5}),m=m._as;var n,o,p,q=m.length,r=new md;p=new Qb(e,0,0,f,d.x,d.y);for(var n=0;q>n;n++)r.add(p.transform(m[n]));r=r._as,p=Rb.createMatrix(c+Math.PI,d.x,d.y);for(var s=new md,n=0;q>n;n++)s.add(p.transform(r[n]));b.draw&&b.draw(a,{points:s,width:e,height:f,shadowColor:h,shadow:i,shadowXOffset:j,shadowYOffset:k,shadowBlur:l})}else{var n,o,p,m=b.points._as,q=m.length,r=new md;for(p=new Qb(e,0,0,f,d.x,d.y),n=0;q>n;n++)r.add(p.transform(m[n]));r=r._as,p=Rb.createMatrix(c+Math.PI,d.x,d.y);var t=r[0];for(t=p.transform(t),a.moveTo(t.x,t.y),n=1;q>n;n++)o=r[n],o instanceof md&&(o=o._as),o instanceof Array?(o[0]=p.transform(o[0]),o[1]=p.transform(o[1]),a.quadraticCurveTo(o[0].x,o[0].y,o[1].x,o[1].y)):(o=p.transform(o),a.lineTo(o.x,o.y))}},drawLinkArrow:function(a,b,c,d){if(!(c.size()<2)){var e=a._element.isBundleAgent?a._element.isBundleAgent():!1;a._element.getStyle(e?"arrow.agent.from":"arrow.from")&&nd._drawFromArrow(a,b,c,d),a._element.getStyle(e?"arrow.agent.to":"arrow.to")&&nd._drawToArrow(a,b,c,d)}},_drawFromArrow:function(a,b,c,d){{var e=a._element,f=e.isBundleAgent?e.isBundleAgent():!1,g=e.getStyle(f?"arrow.agent.from.fill":"arrow.from.fill"),h=e.getStyle(f?"arrow.agent.from.outline.width":"arrow.from.outline.width");e.getStyle(f?"arrow.agent.from.shadow.color":"arrow.from.shadow.color")}if(g||h>=0){var i=e.getStyle(f?"arrow.agent.from.width":"arrow.from.width"),j=e.getStyle(f?"arrow.agent.from.height":"arrow.from.height"),k=e.getStyle(f?"arrow.agent.from.xoffset":"arrow.from.xoffset");if(k>0&&1>k){var l;l=a.getLineLength?a.getLineLength():a._element.getLineLength(),k*=l}else a.getLineLength&&(k+=nd.calculateArrowXOffsetAtEdge(c,a,!0,d));var m=e.getStyle(f?"arrow.agent.from.yoffset":"arrow.from.yoffset"),n=e.getStyle(f?"arrow.agent.from.shape":"arrow.from.shape");nd.drawArrow(b,i,j,c,!0,n,g,e.getStyle(f?"arrow.agent.from.color":"arrow.from.color"),k,m,h,e.getStyle(f?"arrow.agent.from.outline.color":"arrow.from.outline.color"),a)}},_drawToArrow:function(a,b,c,d){var e=a._element,f=e.isBundleAgent?e.isBundleAgent():!1,g=e.getStyle(f?"arrow.agent.to.fill":"arrow.to.fill"),h=e.getStyle(f?"arrow.agent.to.outline.width":"arrow.to.outline.width");

if(g||h>=0){var i=e.getStyle(f?"arrow.agent.to.width":"arrow.to.width"),j=e.getStyle(f?"arrow.agent.to.height":"arrow.to.height"),k=e.getStyle(f?"arrow.agent.to.xoffset":"arrow.to.xoffset");if(k>0&&1>k){var l;l=a.getLineLength?a.getLineLength():a._element.getLineLength(),k*=l}else a.getLineLength&&(k+=nd.calculateArrowXOffsetAtEdge(c,a,!1,d));var m=e.getStyle(f?"arrow.agent.to.yoffset":"arrow.to.yoffset"),n=e.getStyle(f?"arrow.agent.to.shape":"arrow.to.shape");nd.drawArrow(b,i,j,c,!1,n,g,e.getStyle(f?"arrow.agent.to.color":"arrow.to.color"),k,m,h,e.getStyle(f?"arrow.agent.to.outline.color":"arrow.to.outline.color"),a)}},calculateArrowXOffsetAtEdge:function(a,b,c,d){if(null==a||a.size()<2)return 0;var e=b._element,f=e.getStyle(c?"arrow.from.at.edge":"arrow.to.at.edge");if(!f)return 0;var g=b._network.getElementUI(c?e.getFromAgent():e.getToAgent());if(!g)return 0;if(d)var h=g.getZoomBodyRect();else var h=g._bodyRect;if(null==h)return 0;for(var i=Rb._getPoint(a.get(c?0:a.size()-1)),j=0,k=b.getLineLength();nd._containsByInt(h,Math.floor(i.x),Math.floor(i.y),!1)&&k>j;)i=Rb.calculatePointInfoAlongLine(a,c,j++).point;return j},_containsByInt:function(a,b,c,d){return d=void 0===d?!0:d,d?b>=Math.floor(a.x)&&b<=Math.floor(a.x+a.width)&&c>=Math.floor(a.y)&&c<=Math.floor(a.y+a.height):b>Math.floor(a.x)&&b<Math.floor(a.x+a.width)&&c>Math.floor(a.y)&&c<Math.floor(a.y+a.height)}};nd.init(),Hb.arrow=nd,Gb.EventDispatcher=function(){this._f=0},Hb.ext("twaver.EventDispatcher",null,{contains:function(a,b){if(this._ls)for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),a===c.l&&b===c.s)return!0;return!1},add:function(a,b,c){var d={l:a,s:b,a:c};this._ls||(this._ls=new md),this._f?(this._addPendings||(this._addPendings=new md),this._addPendings.add(d)):d.a?this._ls.add(d,0):this._ls.add(d)},remove:function(a,b){this._ls&&(this._f?(this._removePendings||(this._removePendings=new md),this._removePendings.add({l:a,s:b})):this._remove(a,b))},_remove:function(a,b){for(var c,d=0,e=this._ls.size();e>d;d++)if(c=this._ls.get(d),c.l===a&&c.s===b)return void this._ls.removeAt(d)},fire:function(a){if(this._ls){var b,c,d=this._ls.size();for(this._f++,b=0;d>b;b++)c=this._ls.get(b),c.s?c.l.call(c.s,a):c.l(a);if(this._f--,!this._f){if(this._removePendings){for(d=this._removePendings.size(),b=0;d>b;b++)c=this._removePendings.get(b),this._remove(c.l,c.s);delete this._removePendings}if(this._addPendings){for(d=this._addPendings.size(),b=0;d>b;b++)c=this._addPendings.get(b),c.a?this._ls.add(c,0):this._ls.add(c);delete this._addPendings}}}}}),Gb.ImageAsset=function(a,b,c,d,e){this._name=a,this._width=c,this._height=d,this._svg=e,this._edgeData,"string"==typeof b?this._src=b:"function"==typeof b?this._func=b:bd(b)?this._image=b:"object"==typeof b&&(this._image=b,this._width=b.w||b.width,this._height=b.h||b.height,b.cache!==!1&&yd(b)&&(wd(a,b),this._cache=Bd(b)))},Hb.ext("twaver.ImageAsset",Object,{getName:function(){return this._name},getSrc:function(){return this._src},isSvg:function(){return this._svg},getImage:function(a,b,c){if(!a||!this._image)return this._image;this._map||(this._map={});var d;d=this._svg&&3===arguments.length?a+","+b+","+c:a;var e=this._map[d];return e?e:(e=td(this._cache||this._image,rd(a),this._svg?b||this.getWidth():this.getWidth(),this._svg?c||this.getHeight():this.getHeight()),this._map[d]=e,e)},getWidth:function(){return this._width},getHeight:function(){return this._height},getFunction:function(){return this._func},_createEdgeData:function(a,b,c){var d=300,e=d/b;b>c&&(e=d/c);var f=Math.floor(b*e),g=Math.floor(c*e);this.tempCanvas||(this.tempCanvas=Mb.createElement("canvas"),this.ctx=this.tempCanvas.getContext("2d")),this.tempCanvas.width=f,this.tempCanvas.height=g,this.ctx.clearRect(0,0,f,g),this.ctx.drawImage(a,0,0,f,g);for(var h=this.ctx.getImageData(0,0,f,g),i=!0,j=[],k=0,b=f,c=g;c>k;k++)for(var l=0;b>l;l++){var m=4*(k*b+l),n=this._isTransparentPoint(h.data,m),o=i!=n||!n&&(0==l||l==b-1);if(o){var p=n?1:0;j.push({x:l-p,y:k})}i=n}i=!0;for(var l=0,b=f,c=g;b>l;l++)for(var k=0;c>k;k++){var m=4*(k*b+l),n=this._isTransparentPoint(h.data,m),o=i!=n||!n&&(0==k||k==c-1);if(o){var p=n?1:0;j.push({x:l,y:k-p})}i=n}for(var q=b/2,r=c/2,s=[],t=0;360>t;t++)s.push({x:q,y:r,dist:0});for(var t=0,u=j.length;u>t;t++){var v=j[t],w=this._getPointAngleDegree(v.x,v.y,q,r),x=this._getPointDist(v.x,v.y,q,r);s[w].dist<x&&(s[w]={x:v.x,y:v.y,dist:x})}for(var t=0,u=s.length;u>t;t++){var o=s[t];o.x=o.x/e,o.y=o.y/e,delete o.dist}return s},_isTransparentPoint:function(a,b){return a[b]+a[b+1]+a[b+2]+a[b+3]==0},_getPointAngleDegree:function(a,b,c,d){var e=c-a,f=d-b,g=Math.atan2(f,e);return g=g/Math.PI*180,g=parseInt(g)+180,g%=360},_getPointDist:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)}});var od={},pd=Ub.createCanvas();pd.width=1,pd.height=1;var qd=pd.getContext("2d"),rd=function(a){a=a||"black";var b,c=od[a];return c||(qd.clearRect(0,0,1,1),qd.fillStyle=a,qd.fillRect(0,0,1,1),b=qd.getImageData(0,0,1,1).data,c=od[a]={r:b[0],g:b[1],b:b[2],a:b[3]}),c},sd=function(a,b){if(!b)return a;if(b=rd(b),a=rd(a),Dd.PIXEL_FILTER_FUNCTION){var c=Dd.PIXEL_FILTER_FUNCTION(a,b);return"rgba("+c.r+","+c.g+","+c.b+","+a.a+")"}return null},td=function(a,b,c,d){var e=Ub.createCanvas(c,d),f=e.getContext("2d");f.drawImage(a,0,0,c,d);try{for(var g=f.getImageData(0,0,c,d),h=g.data,i=0,j=h.length;j>i;i+=4){var k={r:h[i+0],g:h[i+1],b:h[i+2]},l=Dd.PIXEL_FILTER_FUNCTION(k,b);h[i+0]=l.r,h[i+1]=l.g,h[i+2]=l.b}f.putImageData(g,0,0)}catch(m){return a}return e},ud={},vd=function(a,b){if(a){var c=typeof a;"string"===c&&(a.match(Wc)||Hb.images[a]||(ud[a]||(ud[a]=[])).push(b))}},wd=function(a,b){b.pattern&&vd(b.pattern,a),b.v&&b.v.forEach(function(b){b.pattern&&vd(b.pattern,a)})},xd=function(a){var b=ud[a];b&&(b.forEach(function(a){var b=Hb.images[a];b._cache=Bd(b._image)}),delete ud[a])},yd=function(a){return a.w&&a.h?zd(a):!1},zd=function(a){return!Object.keys(a).some(function(b){if(/^on/.test(b))return!1;var c=a[b],d=Ad(c);return d||"v"!==b||(d=c.some(function(a){if("draw"===a.shape)return!0;if("vector"===a.shape){var b=Hb.images[a.name];if(b&&!b._cache)return!0}var c=Object.keys(a).some(function(b){return"state"===b||"animate"===b?!0:Ad(a[b])});return c?!0:"g"===a.shape&&a.v&&a.v.length?!zd(a):!1})),d})},Ad=function(a){var b=typeof a;return"string"===b&&a.match(Wc)||"function"===b},Bd=function(a){var b=Ub.createCanvas(a.w,a.h),c=b.getContext("2d");return Gb.Util.makeHighRes(b),Nc(c,a,null,{x:0,y:0,width:a.w,height:a.h}),b},Cd=Gb.imageUtil={IMAGE_LOAD_COMPLETED:"IMAGE_LOAD_COMPLETED",_dispatcher:new Gb.EventDispatcher,addEventListener:function(a,b,c){Cd._dispatcher.add(a,b,c)},removeEventListener:function(a,b){Cd._dispatcher.remove(a,b)},images:{},registerImageByUrl:function(a,b,c){if(b=b||Cd.getImageType(a),c=c||Cd.getImageName(a),!Cd.images[c]){Cd.images[c]=a;var d=new Nb;d.src=a,d.onload=function(){Hb.registerImage(c,d,d.width,d.height,b===!0),d.onload=null,delete Cd.images[c];var e={type:Cd.IMAGE_LOAD_COMPLETED,url:a,svg:b,name:c};Cd._dispatcher.fire(e)}}},getImageName:function(a){if("string"!=typeof a)return null;var b=a.lastIndexOf("/"),c=a;return b>=0&&(c=a.substring(b+1)),b=c.lastIndexOf("."),b>=0&&(c=c.substring(0,b)),c},getImageType:function(a){if("string"!=typeof a)return null;var b=a.lastIndexOf("/"),c=a;return b>=0&&(c=a.substring(b+1)),b=c.lastIndexOf("."),b>=0&&(c=c.substring(b+1)),c}},Dd={COLORS:["#6495ED","#FFFF00","#00FFFF","#FF0000","#7FFF00","#E0A580","#5FC0CB","#FA00F0","#A1BC50","#FFD700","#4169E1","#E5A5F5","#1E90FF","#696969","#FF6347","#00BFEF","#FFD700","#80E090","#5F9EA0","#A000FF","#7FAF00","#228BA2","#FF00FF","#7FFFD4","#800000","#0000CD","#20B2AA","#D2691E","#6495BD","#DC143C","#F0A8AF","#008B8B","#800080","#B8860B","#4B0082","#00FF00","#FFA500","#FF4500","#FFFF00","#9ACD32","#00008B","#FF1493","#ADFF2F","#4682B4","#00C0B1"],CALL_LATER_DELAY:17,SCROLL_BAR_WIDTH:17,SELECT_COLOR:"#C2CFF1",FOCUS_ON_CLICK:!0,VIEW_POSITION:"absolute",VIEW_FONT_SIZE:"12px",VIEW_FONT_FAMILY:"arial, tahoma, helvetica, sans-serif",TOOLTIP_BACKGROUND:"lightyellow",TOOLTIP_FONT_SIZE:"12px",TOOLTIP_COLOR:"black",TOOLTIP_PADDING:"4px 8px",TOOLTIP_BORDER:"1px solid gray",TOOLTIP_BORDER_RADIUS:"6px",TOOLTIP_XOFFSET:12,TOOLTIP_YOFFSET:12,TOOLTIP_BOX_SHADOW:"0px 0px 3px #AAA",TOOLTIP_ZINDEX:1e5,TOOLTIP_INITIAL_DELAY:750,TOOLTIP_RESHOW_DELAY:500,TOOLTIP_DISMISS_DELAY:4e3,ZOOM_MAX:5,ZOOM_MIN:.1,ZOOM_INCREMENT:1.3,ZOOM_ANIMATE:!0,COLUMN_INNER_TEXT:!0,COLUMN_WIDTH:80,COLUMN_HORIZONTAL_ALIGN:"",COLUMN_PROPERTY_TYPE:"accessor",COLUMN_VALUE_TYPE:"string",COLUMN_EDITABLE:!1,COLUMN_SORTABLE:!0,COLUMN_VISIBLE:!0,COLUMN_RESIZABLE:!0,COLUMN_MOVABLE:!0,COLUMN_RENDER_CELL:null,COLUMN_RENDER_HEADER:null,COLUMN_RENDER_EDITOR:null,PROPERTY_INNER_TEXT:!0,PROPERTY_HORIZONTAL_ALIGN:"",PROPERTY_PROPERTY_TYPE:"accessor",PROPERTY_VALUE_TYPE:"string",PROPERTY_EDITABLE:!1,PROPERTY_CATEGORY_NAME:null,PROPERTY_RENDER_NAME:null,PROPERTY_RENDER_VALUE:null,PROPERTY_RENDER_EDITOR:null,TAB_WIDTH:100,TAB_CLOSABLE:!1,TAB_RESIZABLE:!0,TAB_MOVABLE:!0,TAB_DISABLED:!1,TAB_VISIBLE:!0,ACCORDION_EXPAND_ICON:"expand_icon",ACCORDION_COLLAPSE_ICON:"collapse_icon",ACCORDION_TITLE_HEIGHT:20,ACCORDION_TITLE_BACKGROUND:"#EBEBEB",ACCORDION_BORDER_BOTTOM_COLOR:"lightgray",ACCORDION_ICON_POSITION:"left",TITLEPANE_TITLE_HEIGHT:20,TITLEPANE_TITLE_BACKGROUND:"#DDD",TITLEPANE_TITLE_HORIZONTAL_ALIGN:"left",BORDERPANE_HGAP:0,BORDERPANE_VGAP:0,CHARTPANE_TITLE_HEIGHT:20,CHARTPANE_TITLE_HORIZONTAL_ALIGN:"center",CHARTPANE_LEGEND_ORIENTATION:"bottom",CHARTPANE_LEGEND_WIDTH:80,LEGENDPANE_ICON_WIDTH:10,LEGENDPANE_ICON_HEIGHT:10,LEGENDPANE_ICON_RADIUS:0,LEGENDPANE_ROW_HEIGHT:20,LEGENDPANE_ORIENTATION:"horizontal",LEGENDPANE_HIDDEN_COLOR:"#BABBBC",LEGENDPANE_SELECT_BACKGROUND_COLOR:"#00007D",LEGENDPANE_SELECT_FOREGROUND_COLOR:"#FFFFFF",CHART_TOOLTIP_ENABLED:!0,CHART_SELECT_TOLERANCE:0,CHART_XGAP:6,CHART_YGAP:6,CHART_XZOOM_ENABLED:!0,CHART_YZOOM_ENABLED:!0,CHART_XTRANSLATE_ENABLED:!0,CHART_YTRANSLATE_ENABLED:!0,CHART_DOUBLE_CLICK_TO_RESET:!0,CHART_VALUE_VISIBLE:!0,CHART_VALUE_FONT:null,CHART_BACKGROUND_VISIBLE:!1,CHART_BACKGROUND_FILL:!0,CHART_BACKGROUND_FILL_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_OUTLINE_WIDTH:1,CHART_BACKGROUND_OUTLINE_COLOR:"rgba(50,50,50,0.11)",CHART_BACKGROUND_GRADIENT:"linear.north",CHART_BACKGROUND_GRADIENT_COLOR:"#FFFFFF",PIECHART_TYPE:"oval",PIECHART_START_ANGLE:0,PIECHART_SELECT_OFFSET:5,PIECHART_SHADOW_OFFSET:1,PIECHART_SHADOW_COLOR:"#C2CFF1",PIECHART_LINE_RATE:.5,PIECHART_DONUT_RATE:.5,PIECHART_VALUE_POSITION:.5,BARCHART_TYPE:"default",BARCHART_UPPER_LIMIT:null,BARCHART_LOWER_LIMIT:0,BARCHART_XAXIS_LINE_COLOR:"#808080",BARCHART_XAXIS_LINE_WIDTH:1,BARCHART_XAXIS_TEXT_COLOR:"#000000",BARCHART_XAXIS_TEXT_FONT:null,BARCHART_YAXIS_LINE_COLOR:"#808080",BARCHART_YAXIS_LINE_WIDTH:1,BARCHART_YAXIS_TEXT_COLOR:"#000000",BARCHART_YAXIS_TEXT_FONT:null,BARCHART_XSCALE_TEXT_FONT:null,BARCHART_XSCALE_TEXT_COLOR:"#000000",BARCHART_XSCALE_TEXT_ORIENTATION:"horizontal",BARCHART_YSCALE_TEXT_VISIBLE:!0,BARCHART_YSCALE_TEXT_COLOR:"#000000",BARCHART_YSCALE_TEXT_FONT:null,BARCHART_YSCALE_LINE_COLOR:"#808080",BARCHART_YSCALE_LINE_WIDTH:.3,BARCHART_YSCALE_VALUE_GAP:0,BARCHART_YSCALE_PIXEL_GAP:20,BARCHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_INTERRUPTABLE:!0,LINECHART_UPPER_LIMIT:null,LINECHART_LOWER_LIMIT:null,LINECHART_XAXIS_LINE_COLOR:"#808080",LINECHART_XAXIS_LINE_WIDTH:1,LINECHART_XAXIS_TEXT_COLOR:"#000000",LINECHART_XAXIS_TEXT_FONT:null,LINECHART_YAXIS_LINE_COLOR:"#808080",LINECHART_YAXIS_LINE_WIDTH:1,LINECHART_YAXIS_TEXT_COLOR:"#000000",LINECHART_YAXIS_TEXT_FONT:null,LINECHART_XSCALE_TEXT_FONT:null,LINECHART_XSCALE_TEXT_COLOR:"#000000",LINECHART_XSCALE_TEXT_ORIENTATION:"horizontal",LINECHART_XSCALE_LINE_COLOR:"#808080",LINECHART_XSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_TEXT_VISIBLE:!0,LINECHART_YSCALE_TEXT_COLOR:"#000000",LINECHART_YSCALE_TEXT_FONT:null,LINECHART_YSCALE_LINE_COLOR:"#808080",LINECHART_YSCALE_LINE_WIDTH:.3,LINECHART_YSCALE_VALUE_GAP:0,LINECHART_YSCALE_PIXEL_GAP:20,LINECHART_YSCALE_MIN_TEXT_VISIBLE:!1,LINECHART_VALUESPANCOUNT:1,BUBBLECHART_UPPER_LIMIT:null,BUBBLECHART_LOWER_LIMIT:null,BUBBLECHART_XAXIS_UPPER_LIMIT:null,BUBBLECHART_XAXIS_LOWER_LIMIT:null,BUBBLECHART_XAXIS_LINE_COLOR:"#808080",BUBBLECHART_XAXIS_LINE_WIDTH:1,BUBBLECHART_XAXIS_TEXT_COLOR:"#000000",BUBBLECHART_XAXIS_TEXT_FONT:null,BUBBLECHART_YAXIS_LINE_COLOR:"#808080",BUBBLECHART_YAXIS_LINE_WIDTH:1,BUBBLECHART_YAXIS_TEXT_COLOR:"#000000",BUBBLECHART_YAXIS_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_FONT:null,BUBBLECHART_XSCALE_TEXT_COLOR:"#000000",BUBBLECHART_XSCALE_TEXT_ORIENTATION:"horizontal",BUBBLECHART_XSCALE_LINE_COLOR:"#808080",BUBBLECHART_XSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_TEXT_VISIBLE:!0,BUBBLECHART_YSCALE_TEXT_COLOR:"#000000",BUBBLECHART_YSCALE_TEXT_FONT:null,BUBBLECHART_YSCALE_LINE_COLOR:"#808080",BUBBLECHART_YSCALE_LINE_WIDTH:.3,BUBBLECHART_YSCALE_VALUE_GAP:0,BUBBLECHART_YSCALE_PIXEL_GAP:20,BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE:!1,BUBBLECHART_SELECT_SHADOW_COLOR:"#000000",BUBBLECHART_SELECT_SHADOW_OFFSET:3,RADARCHART_AXIS_TEXT_FONT:null,RADARCHART_AXIS_TEXT_COLOR:"#000000",RADARCHART_AXIS_TEXT_VISIBLE:!0,RADARCHART_SCALE_TEXT_FONT:null,RADARCHART_SCALE_TEXT_COLOR:"#000000",RADARCHART_SCALE_TEXT_VISIBLE:!0,RADARCHART_AXIS_VISIBLE:!0,RADARCHART_AXIS_LINE_COLOR:"#808080",RADARCHART_AXIS_LINE_WIDTH:3,RADARCHART_AXIS_START_ANGLE:0,RADARCHART_RING_VISIBLE:!0,RADARCHART_RING_TYPE:"line",RADARCHART_RING_LINE_COLOR:"#808080",RADARCHART_RING_LINE_WIDTH:1,RADARCHART_SCALE_COUNT:5,RADARCHART_SCALE_MAXVALUE:1,RADARCHART_SCALE_MINVALUE:0,RADARCHART_ANCHOR_VISIBLE:!0,RADARCHART_AREA_FILL:!0,RADARCHART_AREA_FILL_ALPHA:.2,RADARCHART_AREA_SELECT_FILL_ALPHA:.5,DIALCHART_UPPER_LIMIT:100,DIALCHART_LOWER_LIMIT:0,DIALCHART_START_ANGLE:0,DIALCHART_END_ANGLE:360,DIALCHART_INNER_RADIUS:.8,DIALCHART_COLOR_RANGE_FILL_COLOR:"#808080",DIALCHART_OUTLINE_WIDTH:0,DIALCHART_OUTLINE_COLOR:"#808080",DIALCHART_SCALE_INSIDE:!0,DIALCHART_MAJOR_SCALE_COUNT:11,DIALCHART_MAJOR_SCALE_LINE_WIDTH:2,DIALCHART_MAJOR_SCALE_LINE_LENGTH:8,DIALCHART_MAJOR_SCALE_LINE_COLOR:"#000000",DIALCHART_MINOR_SCALE_COUNT:4,DIALCHART_MINOR_SCALE_LINE_WIDTH:1,DIALCHART_MINOR_SCALE_LINE_LENGTH:4,DIALCHART_MINOR_SCALE_LINE_COLOR:"#000000",DIALCHART_SCALE_TEXT_VISIBLE:!0,DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE:!0,DIALCHART_SCALE_TEXT_FONT:null,DIALCHART_SCALE_TEXT_COLOR:"#000000",DIALCHART_PIVOT_RADIUS:10,DIALCHART_PIVOT_FILL:!0,DIALCHART_PIVOT_FILL_COLOR:"#808080",DIALCHART_PIVOT_OUTLINE_WIDTH:0,DIALCHART_PIVOT_OUTLINE_COLOR:"#808080",DIALCHART_VALUE_POSITION:.5,DIALCHART_INNER_DARKER_RADIUS:10,DIALCHART_OUTER_BRIGHTER_RADIUS:10,DIALCHART_SELECT_SHADOW_COLOR:"#000000",DIALCHART_SELECT_SHADOW_OFFSET:3,TABPANE_TAB_GAP:1,TABPANE_TAB_RADIUS:0,TABPANE_TAB_HEIGHT:24,TABPANE_TAB_ORIENTATION:"top",TABPANE_RESIZE_TOLERANCE:3,TABPANE_TAB_BACKGROUND:"#EBEBEB",TABPANE_DISABLED_COLOR:"#BABBBC",TABPANE_SELECT_BACKGROUND:"white",TABPANE_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABPANE_INSERT_BACKGROUND:"orange",TABPANE_HORIZONTAL_ALIGN:"center",TABPANE_CLOSE_ICON:"close_icon",TABPANE_SELECT_NEXT_ON_CLOSE:!0,TABPANE_SELECT_NEXT_ON_INVISIBLE:!0,LISTBASE_INNER_TEXT:!0,LIST_ROW_HEIGHT:19,LIST_INDENT:2,LIST_ROW_LINE_WIDTH:0,LIST_ROW_LINE_COLOR:"#DDD",LIST_MAKE_VISIBLE_ON_SELECTED:!0,LIST_KEYBOARD_REMOVE_ENABLED:!0,LIST_KEYBOARD_SELECT_ENABLED:!0,TREE_ROW_HEIGHT:19,TREE_INDENT:16,TREE_ROW_LINE_WIDTH:0,TREE_ROW_LINE_COLOR:"#DDD",TREE_MAKE_VISIBLE_ON_SELECTED:!0,TREE_KEYBOARD_REMOVE_ENABLED:!0,TREE_KEYBOARD_SELECT_ENABLED:!0,TREE_EXPAND_ICON:"expand_icon",TREE_COLLAPSE_ICON:"collapse_icon",TREE_LINE_TYPE:"none",TREE_LINE_THICKNESS:2,TREE_LINE_COLOR:"#000000",TREE_LINE_ALPHA:1,TREE_LINE_DASH:[4,2],TABLE_ROW_HEIGHT:19,TABLE_ROW_LINE_WIDTH:1,TABLE_ROW_LINE_COLOR:"#DDD",TABLE_COLUMN_LINE_WIDTH:1,TABLE_COLUMN_LINE_COLOR:"#DDD",TABLE_MAKE_VISIBLE_ON_SELECTED:!0,TABLE_KEYBOARD_REMOVE_ENABLED:!0,TABLE_KEYBOARD_SELECT_ENABLED:!0,TABLE_EDITABLE:!1,TABLEHEADER_HEIGHT:24,TABLEHEADER_RESIZE_TOLERANCE:3,TABLEHEADER_BACKGROUND:"#EBEBEB",TABLEHEADER_MOVE_BACKGROUND:"rgba(184,211,240,0.7)",TABLEHEADER_INSERT_BACKGROUND:"orange",TABLEHEADER_COLUMN_LINE_COLOR:"#DDD",TABLEHEADER_SORT_DESC_ICON:"sort_desc",TABLEHEADER_SORT_ASC_ICON:"sort_asc",TABLEHEADER_SORT_ICON_POSITION:"98% 50%",TREETABLE_ROW_HEIGHT:19,TREETABLE_INDENT:16,TREETABLE_ROW_LINE_WIDTH:1,TREETABLE_ROW_LINE_COLOR:"#DDD",TREETABLE_COLUMN_LINE_WIDTH:1,TREETABLE_COLUMN_LINE_COLOR:"#DDD",TREETABLE_MAKE_VISIBLE_ON_SELECTED:!0,TREETABLE_KEYBOARD_REMOVE_ENABLED:!0,TREETABLE_KEYBOARD_SELECT_ENABLED:!0,TREETABLE_EXPAND_ICON:"expand_icon",TREETABLE_COLLAPSE_ICON:"collapse_icon",TREETABLE_EDITABLE:!1,PROPERTYSHEET_AUTO_ADJUSTABLE:!0,PROPERTYSHEET_INDENT:16,PROPERTYSHEET_ROW_HEIGHT:19,PROPERTYSHEET_ROW_LINE_WIDTH:1,PROPERTYSHEET_COLUMN_LINE_WIDTH:1,PROPERTYSHEET_BORDER_COLOR:"#EBEBEB",PROPERTYSHEET_EXPAND_ICON:"expand_icon",PROPERTYSHEET_COLLAPSE_ICON:"collapse_icon",PROPERTYSHEET_PROPERTY_NAME_WIDTH:100,PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN:"",PROPERTYSHEET_SUM_WIDTH:200,PROPERTYSHEET_RESIZE_TOLERANCE:3,PROPERTYSHEET_EDITABLE:!1,PROPERTYSHEET_CATEGORIZABLE:!0,PROPERTYSHEET_EXPAND_CATEGORY:!0,POPUPMENU_SUBNENU_ENABLE_ICON:"submenu_enable_icon",POPUPMENU_SUBNENU_DISABLE_ICON:"submenu_disable_icon",POPUPMENU_CHECKBOX_SELECTED_ICON:"checkbox_selected_icon",POPUPMENU_CHECKBOX_UNSELECTED_ICON:"checkbox_unselected_icon",POPUPMENU_RADIOBUTTON_SELECTED_ICON:"radiobutton_selected_icon",POPUPMENU_RADIOBUTTON_UNSELECTED_ICON:"radiobutton_unselected_icon",SPLITPANE_ORIENTATION:"horizontal",SPLITPANE_POSITION:.5,SPLITPANE_DIVIDER_WIDTH:6,SPLITPANE_DIVIDER_BACKGROUND:"#CCCCFF",SPLITPANE_DIVIDER_OPACITY:.5,SPLITPANE_MASK_BACKGROUND:"",SPLITPANE_UP_EXPAND_ICON:"up_expand_icon",SPLITPANE_DOWN_EXPAND_ICON:"down_expand_icon",SPLITPANE_LEFT_EXPAND_ICON:"left_expand_icon",SPLITPANE_RIGHT_EXPAND_ICON:"right_expand_icon",NODE_WIDTH:50,NODE_HEIGHT:50,IMAGE_NODE:"node_image",IMAGE_GROUP:"group_image",IMAGE_SUBNETWORK:"subnetwork_image",ICON_DATABOX:"databox_icon",ICON_DATA:"data_icon",ICON_NODE:"node_icon",ICON_LINK:"link_icon",ICON_GROUP:"group_icon",ICON_SUBNETWORK:"subnetwork_icon",ICON_GRID:"grid_icon",ICON_BUS:"bus_icon",ICON_SHAPENODE:"shapenode_icon",ICON_SHAPELINK:"shapelink_icon",ICON_LINKSUBNETWORK:"linksubnetwork_icon",ICON_SHAPESUBNETWORK:"shapesubnetwork_icon",LAYER_DEFAULT_ID:"default",LAYER_DEFAULT_NAME:"default",ATTACHMENT_POINTER_LENGTH:10,ATTACHMENT_POINTER_WIDTH:8,ATTACHMENT_CORNER_RADIUS:5,ATTACHMENT_CONTENT_WIDTH:30,ATTACHMENT_CONTENT_HEIGHT:20,ATTACHMENT_POSITION:"topright.topright",ATTACHMENT_XOFFSET:0,ATTACHMENT_YOFFSET:0,ATTACHMENT_PADDING:0,ATTACHMENT_PADDING_LEFT:0,ATTACHMENT_PADDING_RIGHT:0,ATTACHMENT_PADDING_TOP:0,ATTACHMENT_PADDING_BOTTOM:0,ATTACHMENT_DIRECTION:"right",ATTACHMENT_FILL:!1,ATTACHMENT_FILL_COLOR:"#000000",ATTACHMENT_GRADIENT:null,ATTACHMENT_GRADIENT_COLOR:"#FFFFFF",ATTACHMENT_OUTLINE_WIDTH:-1,ATTACHMENT_OUTLINE_COLOR:"#000000",ATTACHMENT_CAP:"butt",ATTACHMENT_JOIN:"miter",ATTACHMENT_SHADOWABLE:!0,NETWORK_TOOLTIP_ENABLED:!0,NETWORK_SELECT_MODE:"mix",NETWORK_MAKE_VISIBLE_ON_SELECTED:!0,NETWORK_NO_AGENT_LINK_VISIBLE:!1,NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE:!1,NETWORK_SUBNETWORK_ANIMATE:!0,NETWORK_SENDTOTOP_ON_SELECTED:!0,NETWORK_KEYBOARD_REMOVE_ENABLED:!0,NETWORK_KEYBOARD_SELECT_ENABLED:!0,NETWORK_RECT_SELECT_ENABLED:!0,NETWORK_DOUBLECLICK_TO_SUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_UPSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK:!0,NETWORK_DOUBLECLICK_TO_LINKBUNDLE:!0,NETWORK_DOUBLECLICK_TO_GROUPEXPAND:!0,NETWORK_SELECT_OUTLINE_COLOR:"#2877A8",NETWORK_SELECT_OUTLINE_WIDTH:1,NETWORK_SELECT_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_OUTLINE_COLOR:"#2877A8",NETWORK_LAZYMOVE_OUTLINE_WIDTH:1,NETWORK_LAZYMOVE_FILL_COLOR:"rgba(184,211,240,0.4)",NETWORK_LAZYMOVE_FILL:!0,NETWORK_LAZYMOVE_ANIMATE:!0,NETWORK_RESIZE_POINT_SIZE:3,NETWORK_RESIZE_POINT_FILL_COLOR:"#FFFFFF",NETWORK_RESIZE_POINT_OUTLINE_COLOR:"#000000",NETWORK_RESIZE_POINT_OUTLINE_WIDTH:1,NETWORK_RESIZE_LINE_COLOR:"#000000",NETWORK_RESIZE_LINE_WIDTH:1,NETWORK_RESIZE_ANIMATE:!0,NETWORK_EDIT_POINT_SIZE:3,NETWORK_EDIT_POINT_FILL_COLOR:"#FFFF00",NETWORK_EDIT_POINT_OUTLINE_COLOR:"#000000",NETWORK_EDIT_POINT_OUTLINE_WIDTH:1,NETWORK_EDIT_LINE_COLOR:"rgba(184,211,240,0.7)",NETWORK_EDIT_LINE_WIDTH:2,NETWORK_ROTATE_POINT_SIZE:5,NETWORK_ROTATE_POINT_FILL_COLOR:"#FFFF00",NETWORK_ROTATE_POINT_OFFSET:15,NETWORK_ROTATE_POINT_OUTLINE_WIDTH:1,NETWORK_ROTATE_POINT_OUTLINE_COLOR:"rgba(0,0,0,1)",NETWORK_ROTATE_SCALE_FILL_COLOR:"rgb(227,166,103)",NETWORK_ROTATE_SCALE_FONT_COLOR:"#FFFFFF",NETWORK_ROTATE_SCALE_WIDTH:30,NETWORK_ROTATE_SCALE_HEIGHT:20,NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION:!0,NETWORK_LINK_FLOW_STEPPING:3,NETWORK_LINK_FLOW_COLOR:"#FF0000",NETWORK_LINK_FLOW_INTERVAL:600,NETWORK_SELECTION_TOLERANCE:2,NETWORK_TRANSPARENT_SELECTION_ENABLE:!1,SHOW_ALARM_IN_ATTACHMENT_DIV:!0,SHOW_LABEL_IN_ATTACHMENT_DIV:!1,SHOW_LABEL2_IN_ATTACHMENT_DIV:!1,SHOW_ICON_IN_ATTACHMENT_DIV:!1,SHOW_EDIT_IN_ATTACHMENT_DIV:!1,OVERVIEW_FILL_COLOR:"rgba(184,211,240,0.4)",OVERVIEW_OUTLINE_COLOR:"#B8D3F0",OVERVIEW_OUTLINE_WIDTH:1,OVERVIEW_SELECT_COLOR:"#0000FF",OVERVIEW_SELECT_WIDTH:1,OVERVIEW_PADDING:1,OVERVIEW_ANIMATE:!0,OVERVIEW_MAX_PACKING_WIDTH:-1,OVERVIEW_MAX_PACKING_HEIGHT:-1,TOUCH_MOVE_THRESHOLD:5,TOUCH_RECT_SELECT_THRESHOLD:20,TOUCH_ZOOM_THRESHOLD:30,LINK_BUNDLE_AGENT_FUNCTION:null,IS_LINK_ADJUSTED_TO_BOTTOM:!1,GROUP_EXPAND_ALIGN:"center",ELEMENTUI_FUNCTION:function(a,b){var c=b.getElementUIClass();return c?new c(a,b):null},CANVASUI_FUNCTION:function(a,b){var c=b.getCanvasUIClass();return c?new c(a,b):null},VECTORUI_FUNCTION:function(a,b){var c=b.getVectorUIClass();return c?new c(a,b):null},KEEP_DEFAULT_FUNCTION:function(a){return a.target.keepDefault||a.target.getAttribute("keepDefault")?!0:a.target.parentNode&&(a.target.parentNode.keepDefault||a.target.parentNode.getAttribute("keepDefault"))?!0:a.shiftKey?!0:!1},SORT_FUNCTION:function(a,b){if(a===b)return 0;if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c,d=typeof a,e=typeof b;return"string"===d&&"string"===e&&(c=a.localeCompare(b)),"number"===d&&"number"===e&&(c=a-b),void 0===c&&(c=(""+a).localeCompare(""+b)),c>0?1:0>c?-1:0},CENTER_LOCATION:!1,PIXEL_FILTER_FUNCTION:function(a,b){if(!b)return a;var c=.3*a.r+.59*a.g+.11*a.b;return{r:Math.floor(b.r*c/255),g:Math.floor(b.g*c/255),b:Math.floor(b.b*c/255)}}};!function(){var a=Dd;if(window.OverrideTWaverDefaults)for(var b in OverrideTWaverDefaults)a[b]=OverrideTWaverDefaults[b];a.FONT=a.VIEW_FONT_SIZE&&a.VIEW_FONT_FAMILY?a.VIEW_FONT_SIZE+" "+a.VIEW_FONT_FAMILY:Mb.createElement("canvas").getContext("2d").font,a.CHART_VALUE_FONT||(a.CHART_VALUE_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_XSCALE_TEXT_FONT||(a.BARCHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_YSCALE_TEXT_FONT||(a.BARCHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BARCHART_XAXIS_TEXT_FONT||(a.BARCHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BARCHART_YAXIS_TEXT_FONT||(a.BARCHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.LINECHART_XSCALE_TEXT_FONT||(a.LINECHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.LINECHART_YSCALE_TEXT_FONT||(a.LINECHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.LINECHART_XAXIS_TEXT_FONT||(a.LINECHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.LINECHART_YAXIS_TEXT_FONT||(a.LINECHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_XAXIS_TEXT_FONT||(a.BUBBLECHART_XAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_YAXIS_TEXT_FONT||(a.BUBBLECHART_YAXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_XSCALE_TEXT_FONT||(a.BUBBLECHART_XSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.BUBBLECHART_YSCALE_TEXT_FONT||(a.BUBBLECHART_YSCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.RADARCHART_AXIS_TEXT_FONT||(a.RADARCHART_AXIS_TEXT_FONT="12px "+a.VIEW_FONT_FAMILY),a.RADARCHART_SCALE_TEXT_FONT||(a.RADARCHART_SCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY),a.DIALCHART_SCALE_TEXT_FONT||(a.DIALCHART_SCALE_TEXT_FONT="10px "+a.VIEW_FONT_FAMILY)}(),Gb.Defaults=Dd,Hb.ext("twaver.Defaults",Object,{}),Gb.Colors={orange:"#EC6C00",orange_light:"#EF8200",orange_dark:"#EA5404",gray_light:"#666666",gray_dark:"#242424",green_light:"#57AB9A",green_dark:"#238475",blue_light:"#61B6D8",blue_dark:"#0089C1"},Gb.SerializationSettings=function(){var a=Gb.SerializationSettings;this.isDataBoxSerializable=a.isDataBoxSerializable,this.isLayerBoxSerializable=a.isLayerBoxSerializable,this.isStyleSerializable=a.isStyleSerializable,this.isClientSerializable=a.isClientSerializable,this.isImageSerializable=a.isImageSerializable,this._pm=Hb.clone(a._pm),this._sm=Hb.clone(a._sm),this._cm=Hb.clone(a._cm)},function(){var a=Gb.SerializationSettings;a.isDataBoxSerializable=!0,a.isLayerBoxSerializable=!0,a.isStyleSerializable=!0,a.isClientSerializable=!0,a.isImageSerializable=!0,a._pm={},a._sm={},a._cm={},a.setPropertyType=function(b,c){a._pm[b]=c},a.getPropertyType=function(b){return a._pm[b]},a.setStyleType=function(b,c){a._sm[b]=c},a.getStyleType=function(b){return a._sm[b]},a.setClientType=function(b,c){a._cm[b]=c},a.getClientType=function(b){return a._cm[b]}}(),Hb.ext("twaver.SerializationSettings",Object,{setPropertyType:function(a,b){this._pm[a]=b},getPropertyType:function(a){return this._pm[a]},setStyleType:function(a,b){this._sm[a]=b},getStyleType:function(a){return this._sm[a]},setClientType:function(a,b){this._cm[a]=b},getClientType:function(a){return this._cm[a]}});var Ed=Gb.Styles={_m:{},setStyle:function(a,b){null==b?delete Ed._m[a]:Ed._m[a]=b},getStyle:function(a){return Ed._m[a]},getStyleProperties:function(){return Hb.keys(Gb.Styles._m)}};!function(){var a=function(a,b){Gb.SerializationSettings.setPropertyType(a,b)};a("name","cdata"),a("name2","cdata"),a("icon","string"),a("toolTip","cdata"),a("parent","data"),a("layerId","string"),a("alarmState","alarmstate"),a("image","string"),a("imageUrl","string"),a("location","point"),a("width","number"),a("height","number"),a("expanded","boolean"),a("host","data"),a("fromNode","data"),a("toNode","data"),a("points","list.point"),a("segments","list.string"),a("angle","number"),a("visible","boolean"),a=function(a,b,c){null==c&&(c=null!=b?typeof b:"string"),Gb.Styles.setStyle(a,b),Gb.SerializationSettings.setStyleType(a,c)},a("chart.color",null),a("chart.value",0),a("chart.values",null,"list.number"),a("chart.value.color","#000000"),a("chart.value.font",null),a("chart.line.width",2),a("chart.marker.size",6),a("chart.marker.shape","circle"),a("chart.bubble.shape","circle"),a("chart.names",null,"list.string"),a("chart.xaxis.values",null,"list.number"),a("chart.yaxis.values",null,"list.number"),a("dialchart.rear.extension",0),a("dialchart.base.width",5),a("dialchart.top.width",0),a("dialchart.radius",.8),a("inner.color",null),a("outer.shape","rectangle"),a("outer.color",null),a("outer.width",2),a("outer.padding",1),a("outer.padding.left",0),a("outer.padding.right",0),a("outer.padding.top",0),a("outer.padding.bottom",0),a("outer.cap","butt"),a("outer.join","miter"),a("outer.style","border"),a("shadow.color",null),a("shadow.xoffset",3),a("shadow.yoffset",3),a("shadow.blur",6),a("select.style","shadow"),a("select.color","rgba(0, 0, 0, 0.7)"),a("select.shape","rectangle"),a("select.width",2),a("select.padding",2),a("select.padding.left",0),a("select.padding.right",0),a("select.padding.top",0),a("select.padding.bottom",0),a("select.cap","butt"),a("select.join","miter"),a("whole.alpha",1),a("body.type","default"),a("network.label",null,"cdata"),a("image.padding",0),a("image.padding.left",0),a("image.padding.right",0),a("image.padding.top",0),a("image.padding.bottom",0),a("image.state",null),a("vector.shape","rectangle"),a("vector.fill",!0),a("vector.fill.color","#CCCCFF"),a("vector.outline.width",-1),a("vector.outline.pattern",null,"array.number"),a("vector.outline.color","#5B5B5B"),a("vector.gradient","none"),a("vector.gradient.color","#FFFFFF"),a("vector.padding",0),a("vector.padding.left",0),a("vector.padding.right",0),a("vector.padding.top",0),a("vector.padding.bottom",0),a("vector.cap","butt"),a("vector.join","miter"),a("vector.deep",0),a("group.shape","rectangle"),a("group.fill",!0),a("group.fill.color","#CCCCFF"),a("group.outline.width",-1),a("group.outline.color","#5B5B5B"),a("group.gradient","none"),a("group.gradient.color","#FFFFFF"),a("group.padding",5),a("group.padding.left",0),a("group.padding.right",0),a("group.padding.top",0),a("group.padding.bottom",0),a("group.cap","butt"),a("group.join","miter"),a("group.deep",1),a("group.shape.roundrect.radius",-1),a("group.expend.image",null),a("group.expend.image.vector",!1),a("label.alpha",1),a("label.color","#000000"),a("label.font",null),a("label.position","bottom.bottom"),a("label.direction","below"),a("label.corner.radius",0),a("label.pointer.length",0),a("label.pointer.width",8),a("label.xoffset",0),a("label.yoffset",2),a("label.padding",0),a("label.padding.left",0),a("label.padding.right",0),a("label.padding.top",0),a("label.padding.bottom",0),a("label.fill",!1),a("label.fill.color","#C0C0C0"),a("label.gradient","none"),a("label.gradient.color","#FFFFFF"),a("label.outline.width",-1),a("label.outline.color","#000000"),a("label.cap","butt"),a("label.join","miter"),a("label.shadowable",!0),a("label.align","center"),a("label.rotate.angle",0),a("label.maxlength",0),a("link.label.rotatable",!1),a("label2.alpha",1),a("label2.color","#000000"),a("label2.font",null),a("label2.position","top.top"),a("label2.direction","below"),a("label2.corner.radius",0),a("label2.pointer.length",0),a("label2.pointer.width",8),a("label2.xoffset",0),a("label2.yoffset",-2),a("label2.padding",0),a("label2.padding.left",0),a("label2.padding.right",0),a("label2.padding.top",0),a("label2.padding.bottom",0),a("label2.fill",!1),a("label2.fill.color","#C0C0C0"),a("label2.gradient","none"),a("label2.gradient.color","#FFFFFF"),a("label2.outline.width",-1),a("label2.outline.color","#000000"),a("label2.cap","butt"),a("label2.join","miter"),a("label2.shadowable",!0),a("label2.align","center"),a("label2.rotate.angle",0),a("label2.maxlength",0),a("link.label2.rotatable",!1),a("icons.names",null,"array.string"),a("icons.colors",null,"array.string"),a("icons.position",null,"array.string"),a("icons.orientation",null,"array.string"),a("icons.xoffset",[0],"array.number"),a("icons.yoffset",[0],"array.number"),a("icons.xgap",[1],"array.number"),a("icons.ygap",[1],"array.number"),a("alarm.alpha",1),a("alarm.color","#000000"),a("alarm.font",null),a("alarm.position","hotspot"),a("alarm.direction","aboveright"),a("alarm.corner.radius",5),a("alarm.pointer.length",10),a("alarm.pointer.width",8),a("alarm.xoffset",0),a("alarm.yoffset",0),a("alarm.padding",0),a("alarm.padding.left",0),a("alarm.padding.right",0),a("alarm.padding.top",0),a("alarm.padding.bottom",0),a("alarm.gradient","none"),a("alarm.gradient.color","#FFFFFF"),a("alarm.outline.width",-1),a("alarm.outline.color","#000000"),a("alarm.cap","butt"),a("alarm.join","miter"),a("alarm.shadowable",!0),a("link.color","#658DC1"),a("link.width",3),a("link.cap","butt"),a("link.join","miter"),a("link.type","arc"),a("link.pattern",null,"array.number"),a("link.extend",20),a("link.control.point",null,"point"),a("link.bundle.id",0),a("link.bundle.enable",!0),a("link.bundle.expanded",!0),a("link.bundle.independent",!1),a("link.bundle.offset",20),a("link.bundle.gap",12),a("link.bundle.group.gap",0),a("link.looped.gap",6),a("link.looped.direction","northwest"),a("link.looped.type","arc"),a("link.from.position","center"),a("link.from.xoffset",0),a("link.from.yoffset",0),a("link.from.percent",null),a("link.from.at.edge",!0),a("link.to.position","center"),a("link.to.xoffset",0),a("link.to.yoffset",0),a("link.to.percent",null),a("link.to.at.edge",!0),a("link.split.by.percent",!0),a("link.split.percent",.5),a("link.split.value",20),a("link.corner","round"),a("link.xradius",8),a("link.yradius",8),a("link.flow",!1),a("link.flow.converse",!1),a("link.flow.offset",0),
a("link.handler.alpha",1),a("link.handler.color","#000000"),a("link.handler.font",null),a("link.handler.position","topleft.topleft"),a("link.handler.direction","below"),a("link.handler.corner.radius",0),a("link.handler.pointer.length",0),a("link.handler.pointer.width",8),a("link.handler.xoffset",0),a("link.handler.yoffset",0),a("link.handler.padding",0),a("link.handler.padding.left",0),a("link.handler.padding.right",0),a("link.handler.padding.top",0),a("link.handler.padding.bottom",0),a("link.handler.fill",!1),a("link.handler.fill.color","#C0C0C0"),a("link.handler.gradient","none"),a("link.handler.gradient.color","#FFFFFF"),a("link.handler.outline.width",-1),a("link.handler.outline.color","#000000"),a("link.handler.cap","butt"),a("link.handler.join","miter"),a("link.handler.shadowable",!0),a("link.agent",!1),a("link.agent.color","#658DC1"),a("link.agent.width",3),a("link.agent.cap","butt"),a("link.agent.join","miter"),a("link.agent.type","arc"),a("link.agent.pattern",null,"array.number"),a("link.agent.extend",20),a("link.agent.control.point",null,"point"),a("link.agent.from.position","center"),a("link.agent.from.xoffset",0),a("link.agent.from.yoffset",0),a("link.agent.from.percent",null),a("link.agent.from.at.edge",!0),a("link.agent.to.position","center"),a("link.agent.to.xoffset",0),a("link.agent.to.yoffset",0),a("link.agent.to.percent",null),a("link.agent.to.at.edge",!0),a("link.agent.split.by.percent",!0),a("link.agent.split.percent",.5),a("link.agent.split.value",20),a("link.agent.corner","round"),a("link.agent.xradius",8),a("link.agent.yradius",8),a("link.agent.flow",!1),a("link.agent.flow.converse",!1),a("link.agent.flow.offset",0),a("follower.row.index",0),a("follower.column.index",0),a("follower.row.span",1),a("follower.column.span",1),a("follower.padding",0),a("follower.padding.left",0),a("follower.padding.right",0),a("follower.padding.top",0),a("follower.padding.bottom",0),a("follower.fill.cell",!0),a("follower.cell.position","center"),a("glow.blur",20),a("grid.row.count",1),a("grid.column.count",1),a("grid.row.percents",null,"array.number"),a("grid.column.percents",null,"array.number"),a("grid.border",1),a("grid.border.left",0),a("grid.border.right",0),a("grid.border.top",0),a("grid.border.bottom",0),a("grid.padding",1),a("grid.padding.left",0),a("grid.padding.right",0),a("grid.padding.top",0),a("grid.padding.bottom",0),a("grid.fill",!0),a("grid.fill.color","#C0C0C0"),a("grid.deep",1),a("grid.cell.deep",-1),a("shapelink.type","lineto"),a("shapenode.closed",!1),a("shapenode.pattern",null,"array.number"),a("bus.style","nearby"),a("arrow.from",!1),a("arrow.from.fill",!0),a("arrow.from.shape","arrow.standard"),a("arrow.from.color","#000000"),a("arrow.from.xoffset",0),a("arrow.from.yoffset",0),a("arrow.from.width",12),a("arrow.from.height",9),a("arrow.from.outline.color","#000000"),a("arrow.from.outline.width",-1),a("arrow.from.at.edge",!0),a("arrow.from.shadow",!1),a("arrow.from.shadow.color","#000000"),a("arrow.from.shadow.xoffset",0),a("arrow.from.shadow.yoffset",0),a("arrow.from.shadow.blur",16),a("arrow.to",!1),a("arrow.to.fill",!0),a("arrow.to.shape","arrow.standard"),a("arrow.to.color","#000000"),a("arrow.to.xoffset",0),a("arrow.to.yoffset",0),a("arrow.to.width",12),a("arrow.to.height",9),a("arrow.to.outline.color","#000000"),a("arrow.to.outline.width",-1),a("arrow.to.at.edge",!0),a("arrow.agent.from",!1),a("arrow.agent.from.fill",!0),a("arrow.agent.from.shape","arrow.standard"),a("arrow.agent.from.color","#000000"),a("arrow.agent.from.xoffset",0),a("arrow.agent.from.yoffset",0),a("arrow.agent.from.width",12),a("arrow.agent.from.height",9),a("arrow.agent.from.outline.color","#000000"),a("arrow.agent.from.outline.width",-1),a("arrow.agent.from.at.edge",!0),a("arrow.agent.from.shadow",!1),a("arrow.agent.from.shadow.color","#000000"),a("arrow.agent.from.shadow.xoffset",0),a("arrow.agent.from.shadow.yoffset",0),a("arrow.agent.from.shadow.blur",16),a("arrow.agent.to",!1),a("arrow.agent.to.fill",!0),a("arrow.agent.to.shape","arrow.standard"),a("arrow.agent.to.color","#000000"),a("arrow.agent.to.xoffset",0),a("arrow.agent.to.yoffset",0),a("arrow.agent.to.width",12),a("arrow.agent.to.height",9),a("arrow.agent.to.outline.color","#000000"),a("arrow.agent.to.outline.width",-1),a("arrow.agent.to.at.edge",!0),a("background.image",null),a("background.image.scope","viewport"),a("background.type","none"),a("background.outline.width",-1),a("background.outline.color",null),a("background.vector.padding",0),a("background.image.padding",0),a("background.image.stretch","fill"),a("background.vector.scope","viewport"),a("background.vector.fill",null),a("background.vector.fill.color",null),a("background.vector.gradient",!1),a("background.vector.gradient.color",null),a("background.vector.shape","rectangle"),a("background.outline.pattern",null,"array.number"),a("attachment.label.style","html"),a("attachment.label2.style","html"),a("attachment.alarm.style","html"),a("attachment.htmllabel.hyperlink",!1),a("attachment.htmllabel2.hyperlink",!1)}(),Hb.ext("twaver.Styles",Object,{}),Gb.PropertyChangeDispatcher=function(){this._dispatcher=new Gb.EventDispatcher},Hb.ext("twaver.PropertyChangeDispatcher",Object,{addPropertyChangeListener:function(a,b,c){this._dispatcher.add(a,b,c)},removePropertyChangeListener:function(a,b){this._dispatcher.remove(a,b)},firePropertyChange:function(a,b,c){if(b==c)return!1;var d={property:a,oldValue:b,newValue:c,source:this};return this._dispatcher.fire(d),this.onPropertyChanged(d),!0},onPropertyChanged:function(a){}}),Gb.animate.Animate=function(){},Hb.ext("twaver.animate.Animate",Object,{current:0,step:8,delay:4,finishFunction:null,shouldBeFinished:!1,getCurrentDelay:function(){return this.delay*this.current+1},action:function(a){}}),Gb.animate.AnimateProperty=function(a,b,c){this.objects=a,this.newValues=b,this.finishFunction=c,this.oldValues=new md;for(var d=this.objects.size(),e=0;d>e;e++){var f=this.objects.get(e);this.oldValues.add(this.getPropertyValue(f))}},Hb.ext("twaver.animate.AnimateProperty",Gb.animate.Animate,{action:function(a){for(var b=this.objects.size(),c=0;b>c;c++){var d=this.objects.get(c),e=this.oldValues.get(c),f=this.newValues.get(c);this.currentAction(d,e,f,a)}},getPropertyValue:function(a){},currentAction:function(a,b,c,d){}}),Gb.animate.AnimateBounds=function(a,b,c){this.node=a,this.newBounds=b,this.oldBounds=a.getRect(),this.finishFunction=c},Hb.ext("twaver.animate.AnimateBounds",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){var b=this.oldBounds,c=this.newBounds;this.node.setLocation(b.x+(c.x-b.x)*a,b.y+(c.y-b.y)*a),this.node.setSize(b.width+(c.width-b.width)*a,b.height+(c.height-b.height)*a)}}),Gb.animate.AnimateCenterLocation=function(a,b,c){Gb.animate.AnimateCenterLocation.superClass.constructor.call(this,a,b,c)},Hb.ext("twaver.animate.AnimateCenterLocation",Gb.animate.AnimateProperty,{getPropertyValue:function(a){return a.getCenterLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setCenterLocation(e,f)}}),Gb.animate.AnimateLocation=function(a,b,c){Gb.animate.AnimateLocation.superClass.constructor.call(this,a,b,c)},Hb.ext("twaver.animate.AnimateLocation",Gb.animate.AnimateProperty,{getPropertyValue:function(a){return a.getLocation()},currentAction:function(a,b,c,d){var e=b.x+(c.x-b.x)*d,f=b.y+(c.y-b.y)*d;a.setLocation(e,f)}}),Gb.animate.AnimateScrollPosition=function(a,b,c){this.view=a,this.oldHorizontalOffset=a.scrollLeft,this.oldVerticalOffset=a.scrollTop,this.newHorizontalOffset=b,this.newVerticalOffset=c},Hb.ext("twaver.animate.AnimateScrollPosition",Gb.animate.Animate,{action:function(a){this.view.scrollLeft=this.oldHorizontalOffset+(this.newHorizontalOffset-this.oldHorizontalOffset)*a,this.view.scrollTop=this.oldVerticalOffset+(this.newVerticalOffset-this.oldVerticalOffset)*a}}),Gb.animate.AnimateZoom=function(a,b,c){this.view=a,this.oldZoom=a.getZoom(),this.newZoom=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setZoom(this.oldZoom+(this.newZoom-this.oldZoom)*a,!1)}}),Gb.animate.AnimateXZoom=function(a,b,c){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateXZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1)}}),Gb.animate.AnimateYZoom=function(a,b,c){this.view=a,this.oldYZoom=a.getYZoom(),this.newYZoom=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateYZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),Gb.animate.AnimateXYZoom=function(a,b,c,d){this.view=a,this.oldXZoom=a.getXZoom(),this.newXZoom=b,this.oldYZoom=a.getYZoom(),this.newYZoom=c,this.finishFunction=d},Hb.ext("twaver.animate.AnimateXYZoom",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){this.view.setXZoom(this.oldXZoom+(this.newXZoom-this.oldXZoom)*a,!1),this.view.setYZoom(this.oldYZoom+(this.newYZoom-this.oldYZoom)*a,!1)}}),Gb.animate.AnimateSubNetwork=function(a,b,c){this.network=a,this.subNetwork=b,this.finishFunction=c},Hb.ext("twaver.animate.AnimateSubNetwork",Gb.animate.Animate,{shouldBeFinished:!0,action:function(a){a>.5?(this.network.getView().style.opacity=2*a-1,this.network._setCurrentSubNetwork(this.subNetwork)):this.network.getView().style.opacity=1-2*a}}),Gb.animate.AnimateManager={timer:null,animate:null,start:function(a,b){var c=Gb.animate.AnimateManager;a.current<0&&(a.current=0),b?Hb.callLater(c.startImpl,null,[a],b):c.startImpl(a)},startImpl:function(a){var b=Gb.animate.AnimateManager;b.animate&&b.endAnimate(),b.animate=a,b.timer=setTimeout(b.tick,a.getCurrentDelay())},tick:function(){var a=Gb.animate.AnimateManager,b=a.animate;if(b){if(b.current<0)return void b.current++;b.current<b.step&&(b.current++,b.action(b.current/b.step),a.timer=setTimeout(a.tick,b.getCurrentDelay())),b.current>=b.step&&a.endAnimate()}},endAnimate:function(){var a=Gb.animate.AnimateManager;if(a.animate){a.animate.shouldBeFinished&&a.animate.current<a.animate.step&&(a.animate.current=a.animate.step,a.animate.action(a.animate.current/a.animate.step));var b=a.animate.finishFunction;a.animate=null,a.timer&&(clearTimeout(a.timer),a.timer=null),b&&b()}else a.timer&&(clearTimeout(a.timer),a.timer=null)}},Gb.DataBox=function(a){Gb.DataBox.superClass.constructor.apply(this,arguments),1===arguments.length&&(this._name=a),this._dataList=new md,this._dataMap={},this._rootList=new md,this._rootMap={},this._clientMap={},this._dataBoxChangeDispatcher=new Gb.EventDispatcher,this._dataPropertyChangeDispatcher=new Gb.EventDispatcher,this._hierarchyChangeDispatcher=new Gb.EventDispatcher,this._selectionModel=new Gb.SelectionModel(this)},Hb.ext("twaver.DataBox",Gb.PropertyChangeDispatcher,{IClient:!0,__client:1,__new:1,_limit:-1,_name:"DataBox",_icon:Dd.ICON_DATABOX,__accessor:["name","icon","toolTip"],getSelectionModel:function(){return this._selectionModel},size:function(){return this._dataList.size()},isEmpty:function(){return this._dataList.isEmpty()},getLimit:function(){return this._limit},setLimit:function(a){var b=this._limit;this._limit=a,this.firePropertyChange("limit",b,a),this._checkLimit()},_checkLimit:function(){this._limit>=0&&this.size()>this._limit&&this.removeFirst(this.size()-this._limit)},removeFirst:function(a){for(0===arguments.length&&(a=1);a>0&&this._dataList.size()>0;){var b=this._dataList.get(0);this.remove(b),a--}},getSiblings:function(a){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var b=a.getParent();return b?b.getChildren():this._rootList},getRoots:function(){return this._rootList},getSiblingIndex:function(a){return a.getParent()?a.getParent().getChildren().indexOf(a):this._rootList.indexOf(a)},getDatas:function(){return this._dataList},getDataAt:function(a){return this._dataList.get(a)},toDatas:function(a,b){return this._dataList.toList(a,b)},forEach:function(a,b){this._dataList.forEach(a,b)},forEachReverse:function(a,b){this._dataList.forEachReverse(a,b)},forEachByDepthFirst:function(a,b,c){if(b)this._depthFirst(a,b,c);else for(var d=this._rootList.size(),e=0;d>e;e++){var f=this._rootList.get(e);if(this._depthFirst(a,f,c)===!1)return}},_depthFirst:function(a,b,c){for(var d=b.getChildrenSize(),e=0;d>e;e++){var f=b.getChildAt(e);if(this._depthFirst(a,f,c)===!1)return!1}if(c){if(a.call(c,b)===!1)return!1}else if(a(b)===!1)return!1},forEachByBreadthFirst:function(a,b,c){var d=new md;for(b?d.add(b):this._rootList.forEach(d.add,d);d.size()>0;)if(b=d.removeAt(0),b.getChildren().forEach(d.add,d),c){if(a.call(c,b)===!1)return}else if(a(b)===!1)return},add:function(a,b){if(a){1===arguments.length&&(b=-1);var c=a.getId();if(this._dataMap.hasOwnProperty(c))throw"Data with ID '"+c+"' already exists";this._dataBoxChangeDispatcher.fire({kind:"preAdd",data:a}),this._dataMap[c]=a,this._dataList.add(a),a.getParent()||(this._rootMap[c]=a,b>=0?this._rootList.add(a,b):this._rootList.add(a)),a.addPropertyChangeListener(this.handleDataPropertyChange,this,!0),this._dataBoxChangeDispatcher.fire({kind:"add",data:a}),this._checkLimit()}},addByDescendant:function(a){this.add(a),a.getChildren().size()>0&&a.getChildren().forEach(function(a){this.addByDescendant(a)},this)},remove:function(a){this.removeById(a.getId())},removeSelection:function(){this._selectionModel.toSelection().forEach(function(a){this.remove(a)},this)},removeById:function(a){var b=this.getDataById(a);b&&(this._dataBoxChangeDispatcher.fire({kind:"preRemove",data:b}),b instanceof Gb.Link&&(b.setFromNode(null),b.setToNode(null)),b instanceof Ld&&b.getLinks()&&b.getLinks().toList().forEach(function(a){this.remove(a)},this),b instanceof Ld&&b.getFollowers()&&b.getFollowers().toList().forEach(function(a){a.setHost(null)}),b instanceof Gb.Follower&&b.getHost()&&b.setHost(null),b.toChildren().forEach(function(a){this.remove(a)},this),b.getParent()&&b.getParent().removeChild(b),this._dataList.remove(b),delete this._dataMap[a],this._rootMap[a]&&(delete this._rootMap[a],this._rootList.remove(b)),this._dataBoxChangeDispatcher.fire({kind:"remove",data:b}),b.removePropertyChangeListener(this.handleDataPropertyChange,this))},clear:function(){if(this._dataList.size()>0){this._dataList.forEach(function(a){a.removePropertyChangeListener(this.handleDataPropertyChange,this)},this);var a=this._dataList.toList();this._dataList.clear(),this._dataMap={},this._rootList.clear(),this._rootMap={},this._dataBoxChangeDispatcher.fire({kind:"clear",datas:a})}},getDataById:function(a){return this._dataMap[a]},containsById:function(a){return this._dataMap.hasOwnProperty(a)},contains:function(a){return a?this._dataMap[a._id]===a:!1},moveTo:function(a,b){if(!this.contains(a))throw a+" dosen't belong to this dataBox";var c=this.getSiblings(a),d=c.indexOf(a);d===b||0>d||b>=0&&b<=c.size()&&(c.remove(a),b>c.size()&&b--,c.add(a,b),this._hierarchyChangeDispatcher.fire({data:a,oldIndex:d,newIndex:b}))},moveUp:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)-1)},moveDown:function(a){var b=this.getSiblings(a);this.moveTo(a,b.indexOf(a)+1)},moveToTop:function(a){this.moveTo(a,0)},moveToBottom:function(a){var b=this.getSiblings(a);this.moveTo(a,b.size())},moveSelectionUp:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveUpDatas(a,b,this._rootList),b.forEach(this.moveUp,this)},moveSelectionDown:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveDownDatas(a,b,this._rootList),b.forEach(this.moveDown,this)},moveSelectionToTop:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveToTopDatas(a,b,this._rootList),b.forEach(this.moveToTop,this)},moveSelectionToBottom:function(a){a||(a=this._selectionModel);var b=new md;xc.findMoveToBottomDatas(a,b,this._rootList),b.forEach(this.moveToBottom,this)},handleDataPropertyChange:function(a){var b=a.source;if("parent"===a.property){var c=b.getId();b.getParent()?this._rootMap[c]&&(delete this._rootMap[c],this._rootList.remove(b)):this._rootMap[c]||(this._rootMap[c]=b,this._rootList.add(b))}this.onDataPropertyChanged(b,a),this._dataPropertyChangeDispatcher.fire(a)},onDataPropertyChanged:function(a,b){},addDataBoxChangeListener:function(a,b,c){this._dataBoxChangeDispatcher.add(a,b,c)},removeDataBoxChangeListener:function(a,b){this._dataBoxChangeDispatcher.remove(a,b)},addDataPropertyChangeListener:function(a,b,c){this._dataPropertyChangeDispatcher.add(a,b,c)},removeDataPropertyChangeListener:function(a,b){this._dataPropertyChangeDispatcher.remove(a,b)},addHierarchyChangeListener:function(a,b,c){this._hierarchyChangeDispatcher.add(a,b,c)},removeHierarchyChangeListener:function(a,b){this._hierarchyChangeDispatcher.remove(a,b)},getRandomData:function(a){if(a){for(var b=new Gb.List,c=0;c<this._dataList.size()-1;c++){var d=this._dataList.get(c);d instanceof a&&b.add(d)}if(0==b.size())return null}var e=a?b.get(parseInt(Gb.Util.random()*b.size())):this._dataList.get(parseInt(Gb.Util.random()*this._dataList.size()));return e}}),Gb.ElementBox=function(a){Gb.ElementBox.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new Gb.AlarmBox(this),this._layerBox=new Gb.LayerBox(this),this._alarmStatePropagator=new Gb.AlarmStatePropagator(this),this._alarmStatePropagator.setEnable(!0),this._indexChangeDispatcher=new Gb.EventDispatcher,this._undoManager=new Gb.UndoManager(this)},Gb.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},Hb.ext("twaver.ElementBox",Gb.DataBox,{IStyle:!0,__style:1,_name:"ElementBox",add:function(a,b){if(a){if(!a.IElement)throw"Only IElement can be added into ElementBox";Gb.ElementBox.superClass.add.apply(this,arguments),this.adjustElementIndex(a)}},onDataPropertyChanged:function(a,b){Gb.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[b.property]&&this.adjustElementIndex(a),Gb.ElementBox.superClass.onDataPropertyChanged.apply(this,arguments)},addIndexChangeListener:function(a,b,c){this._indexChangeDispatcher.add(a,b,c)},removeIndexChangeListener:function(a,b){this._indexChangeDispatcher.remove(a,b)},sendToTop:function(a){if(this.contains(a)){if(a!==this.getDatas().get(this.size()-1)){var b=this.getDatas().indexOf(a);this.getDatas().removeAt(b),this.getDatas().add(a),this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:this.size()-1})}a instanceof Gb.Link&&(a.getFromAgent()&&!a.getFromAgent().isAdjustedToBottom()&&this.sendToTop(a.getFromAgent()),a.getToAgent()&&!a.getToAgent().isAdjustedToBottom()&&this.sendToTop(a.getToAgent())),a instanceof Ld&&a.getFollowers()&&a.getFollowers().forEach(function(b){b.isRelatedTo(a)||a instanceof Gb.Follower&&b.isLoopedHostOn(a)||this.sendToTop(b)},this),a.ISubNetwork||a instanceof Nd&&!a.isExpanded()||a.getChildren().forEach(function(a){a instanceof Gb.Link||this.sendToTop(a)},this)}},sendToBottom:function(a,b){if(a!==b&&this.contains(a)&&(!b||this.contains(b))){var c=this.getDatas().remove(a),d=0;b&&(d=this.getDatas().indexOf(b)),this.getDatas().add(a,d),c!=d&&(this._indexChangeDispatcher.fire({element:a,oldIndex:c,newIndex:d}),!a.getParent()||a.getParent().ISubNetwork||a.getParent()instanceof Gb.Link||this.sendToBottom(a.getParent(),a))}},fireIndexChange:function(a,b,c){this._indexChangeDispatcher.fire({element:a,oldIndex:b,newIndex:c})},adjustElementIndex:function(a){this.contains(a)&&(a.isAdjustedToBottom()?(this.sendToBottom(a),a.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(a))},forEachByLayer:function(a,b,c){var d=this.size(),e=this.getDatas();if(b)for(var f=0;d>f;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}else this._layerBox.forEachByDepthFirst(function(b){for(var f=0;d>f;f++){var g=e.get(f);if(this._layerBox.getLayerByElement(g)===b)if(c){if(a.call(c,g)===!1)return}else if(a(g)===!1)return}},null,this)},forEachByLayerReverse:function(a,b,c){var d=new md;this.forEachByLayer(function(a){d.add(a,0)},b),d.forEach(a,c)},getLayerBox:function(){return this._layerBox},getAlarmBox:function(){return this._alarmBox},getAlarmStatePropagator:function(){return this._alarmStatePropagator},startBatch:function(a,b){Gb._isInitializing=!0,Gb._bundleLinks={},Gb._links={},a.call(b);var c,d;for(var e in Gb._links)c=Gb._links[e],c._checkAgentNodeImpl();for(var e in Gb._bundleLinks)d=Gb._bundleLinks[e],uc.resetBundleLinks(d[0],d[1]);Gb._bundleLinks=null,Gb._links=null,Gb._isInitializing=!1},getUndoManager:function(){return this._undoManager}}),Gb.SelectionModel=function(a){Gb.SelectionModel.superClass.constructor.apply(this,arguments),this._selectionMode="multipleSelection",this._selectionList=new md,this._selectionChangeDispatcher=new Gb.EventDispatcher,this._selectionMap={},this._setDataBox(a)},Hb.ext("twaver.SelectionModel",Gb.PropertyChangeDispatcher,{getSelectionMode:function(){return this._selectionMode},setSelectionMode:function(a){if(this._selectionMode!==a&&("noneSelection"===a||"singleSelection"===a||"multipleSelection"===a)){this.clearSelection();var b=this._selectionMode;this._selectionMode=a,this.firePropertyChange("selectionMode",b,this._selectionMode)}},getDataBox:function(){return this._dataBox},_setDataBox:function(a){if(!a)throw"dataBox can not be null";if(this._dataBox!==a){this._dataBox&&(this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this));var b=this._dataBox;this._dataBox=a,this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this.firePropertyChange("dataBox",b,this._dataBox)}},dispose:function(){this.clearSelection(),this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this)},handleDataBoxChange:function(a){if("remove"===a.kind){var b=a.data;this.contains(b)&&(this._selectionList.remove(b),delete this._selectionMap[b.getId()],this.fireSelectionChange("remove",new md(b)))}else"clear"===a.kind&&this.clearSelection()},getFilterFunction:function(){return this._filterFunction},setFilterFunction:function(a){if(this._filterFunction!==a){this.clearSelection();var b=this._filterFunction;this._filterFunction=a,this.firePropertyChange("filterFunction",b,this._filterFunction)}},fireSelectionChange:function(a,b,c){c&&(this._selectionList.forEach(function(a){c.contains(a)?c.remove(a):c.add(a)}),b=c.toList()),this._selectionChangeDispatcher.fire({kind:a,datas:new md(b)})},addSelectionChangeListener:function(a,b,c){this._selectionChangeDispatcher.add(a,b,c)},removeSelectionChangeListener:function(a,b){this._selectionChangeDispatcher.remove(a,b)},_filterList:function(a,b){for(var c=new md(a),d=0;d<c.size();d++){var e=c.get(d);(this._filterFunction&&!this._filterFunction(e)||b&&this.contains(e)||!b&&!this.contains(e)||!this._dataBox.contains(e))&&(c.removeAt(d),d--)}return c},appendSelection:function(a){if("noneSelection"!==this._selectionMode){var b=this._filterList(a,!0);if(!b.isEmpty()){var c=null;"singleSelection"===this._selectionMode&&(c=new md(this._selectionList),this._selectionList.clear(),this._selectionMap={},b=new md(b.get(b.size()-1)));for(var d=0;d<b.size();d++){var e=b.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("append",b,c)}}},removeSelection:function(a){var b=this._filterList(a);if(0!==b.size()){for(var c=0;c<b.size();c++){var d=b.get(c);this._selectionList.remove(d),delete this._selectionMap[d.getId()]}this.fireSelectionChange("remove",b)}},toSelection:function(a,b){return this._selectionList.toList(a,b)},getSelection:function(){return this._selectionList},setSelection:function(a){if("noneSelection"!==this._selectionMode&&(0!==this._selectionList.size()||null!=a)){var b=new md(this._selectionList);this._selectionList.clear(),this._selectionMap={};var c=this._filterList(a,!0);"singleSelection"===this._selectionMode&&c.size()>1&&(c=new md(c.get(c.size()-1)));for(var d=0;d<c.size();d++){var e=c.get(d);this._selectionList.add(e),this._selectionMap[e.getId()]=e}this.fireSelectionChange("set",null,b)}},clearSelection:function(){if(this._selectionList.size()>0){var a=this._selectionList.toList();this._selectionList.clear(),this._selectionMap={},this.fireSelectionChange("clear",a)}},selectAll:function(){if("noneSelection"!==this._selectionMode){var a=this._dataBox.toDatas(),b=0,c=null;if(this._filterFunction)for(b=0;b<a.size();b++)c=a.get(b),this._filterFunction(c)||(a.removeAt(b),b--);var d=new md(this._selectionList);for(this._selectionList.clear(),this._selectionMap={},"singleSelection"===this._selectionMode&&a.size()>1&&(a=new md(a.get(a.size()-1))),b=0;b<a.size();b++)c=a.get(b),this._selectionList.add(c),this._selectionMap[c.getId()]=c;this.fireSelectionChange("all",null,d)}},size:function(){return this._selectionList.size()},contains:function(a){return a?null!=this._selectionMap[a.getId()]:!1},getLastData:function(){return this._selectionList.size()>0?this._selectionList.get(this._selectionList.size()-1):null},getFirstData:function(){return this._selectionList.size()>0?this._selectionList.get(0):null},isSelectable:function(a){return a?"noneSelection"===this._selectionMode?!1:this._filterFunction&&!this._filterFunction(a)?!1:!0:!1}}),Gb.QuickFinder=function(a,b,c,d,e){if(this._map={},!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=Hb.getter(b)),this._valueFunction=d||this.getValue,this._filterFunction=e||this.isInterested,this._dataBox.forEach(this._addData,this),this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this,!0),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this,!0)},Hb.ext("twaver.QuickFinder",Object,{_NULL_:"twaver-null-key",getValueFunction:function(){return this._valueFunction},getFilterFunction:function(){return this._filterFunction},handleDataBoxChange:function(a){"add"===a.kind?this._addData(a.data):"remove"===a.kind?this._removeData(a.data):"clear"===a.kind&&(this._map={})},handleDataPropertyChange:function(a){if(this._filterFunction.call(this,a.source)){if("accessor"===this._propertyType&&this._propertyName===a.property);else if("style"===this._propertyType&&a.source.IStyle&&"S:"+this._propertyName===a.property);else if("client"!==this._propertyType||"C:"+this._propertyName!==a.property)return;var b=this._getMap(a.oldValue);b&&b.remove(a.source),this._addData(a.source)}},_getMap:function(a){return a=null==a?this._NULL_:a,this._map[a]},find:function(a){var b=this._getMap(a);return b?b.toList():new md},findFirst:function(a){var b=this._getMap(a);return!b||b.isEmpty()?null:b.get(0)},_addData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c||(c=new md,b=null==b?this._NULL_:b,this._map[b]=c),c.add(a)}},_removeData:function(a){if(this._filterFunction.call(this,a)){var b=this._valueFunction.call(this,a),c=this._getMap(b);c&&(c.remove(a),c.isEmpty()&&(b=null==b?this._NULL_:b,delete this._map[b]))}},dispose:function(){this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this),delete this._dataBox},getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isInterested:function(a){return("style"!==this._propertyType||a.IStyle)&&("accessor"!==this._propertyType||this._valueFunction!==this.getValue||a[this._getter])?!0:!1},getValue:function(a){return"accessor"===this._propertyType?a[this._getter]():"style"===this._propertyType&&a.getStyle?a.getStyle(this._propertyName):"client"===this._propertyType&&a.getClient?a.getClient(this._propertyName):null}}),Gb.PropertyPropagator=function(a,b,c){if(!a)throw"dataBox can not be null";if(!b)throw"propertyName can not be null";this._dataBox=a,this._propertyName=b,this._propertyType=c||"accessor","accessor"===this._propertyType&&(this._getter=Hb.getter(b),this._setter=Hb.setter(b)),this._enable=!1,this._isPropagating=!1},Hb.ext("twaver.PropertyPropagator",Object,{getDataBox:function(){return this._dataBox},getPropertyType:function(){return this._propertyType},getPropertyName:function(){return this._propertyName},isEnable:function(){return this._enable},setEnable:function(a){this._enable!==a&&(this._enable=a,this._enable?(this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this._dataBox.forEach(function(a){this.propagate(a)},this)):(this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange,this)))},handleDataBoxChange:function(a){a.data&&this.propagate(a.data)},handleDataPropertyChange:function(a){if(this.isInterestedProperty(a))this.propagate(a.source);else if("parent"===a.property){var b=a.oldValue;b&&this.propagate(b),this.propagate(a.source)}},isInterestedProperty:function(a){return"accessor"===this._propertyType&&this._propertyName===a.property?!0:"style"===this._propertyType&&a.IElement&&"S:"+this._propertyName===a.property?!0:"client"===this._propertyType&&"C:"+this._propertyName===a.property?!0:!1},propagate:function(a){a&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(a),this._isPropagating=!1)},propagateToTop:function(a){for(this.propagateToParent(null,a);a&&a.getParent();)this.propagateToParent(a,a.getParent()),a=a.getParent()},propagateToParent:function(a,b){}}),Gb.AlarmStatePropagator=function(a){Gb.AlarmStatePropagator.superClass.constructor.call(this,a,"alarmState")},Hb.ext("twaver.AlarmStatePropagator",Gb.PropertyPropagator,{handleDataPropertyChange:function(a){"enablePropagation"===a.property?this.propagate(a.source):Gb.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this,a)},propagateToParent:function(a,b){var c=null;b.getChildren().forEach(function(a){var b=a.getAlarmState().getHighestOverallAlarmSeverity();Gb.AlarmSeverity.compare(b,c)>0&&(c=b)}),b.getAlarmState().setPropagateSeverity(c)}}),Gb.AlarmSeverity=function(a,b,c,d,e){this.value=a,this.name=b,this.nickName=c,this.color=d,this.displayName=e},Hb.ext("twaver.AlarmSeverity",Object,{toString:function(){return this.displayName?this.displayName:this.name}}),function(){var a=Gb.AlarmSeverity;a.severities=new md,a._vm={},a._nm={},a._cp=function(a,b){if(a&&b){var c=a.value-b.value;return c>0?1:0>c?-1:0}return a&&!b?1:!a&&b?-1:0},a.forEach=function(b,c){a.severities.forEach(b,c)},a.getSortFunction=function(){return a._cp},a.setSortFunction=function(b){a._cp=b,a.severities.sort(b)},a.add=function(b,c,d,e,f){var g=new a(b,c,d,e,f);return a._vm[b]=g,a._nm[c]=g,a.severities.add(g),a.severities.sort(a._cp),g},a.remove=function(b){var c=a._nm[b];return c&&(delete a._nm[b],delete a._vm[c.value],a.severities.remove(c)),c},a.CRITICAL=a.add(500,"Critical","C","#FF0000"),a.MAJOR=a.add(400,"Major","M","#FFA000"),a.MINOR=a.add(300,"Minor","m","#FFFF00"),a.WARNING=a.add(200,"Warning","W","#00FFFF"),a.INDETERMINATE=a.add(100,"Indeterminate","N","#C800FF"),a.CLEARED=a.add(0,"Cleared","R","#00FF00"),a.isClearedAlarmSeverity=function(a){return a?0===a.value:!1},a.getByName=function(b){return a._nm[b]},a.getByValue=function(b){return a._vm[b]},a.clear=function(){a.severities.clear(),a._vm={},a._nm={}},a.compare=function(b,c){return a._cp(b,c)}}(),Gb.AlarmState=function(a){this._e=a,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0},Hb.ext("twaver.AlarmState",Object,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._e.firePropertyChange("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){
return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var a=null;for(var b in this._am)b=Gb.AlarmSeverity.getByName(b),Gb.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getAcknowledgedAlarmCount(b)&&(a=a&&Gb.AlarmSeverity.compare(a,b)>0?a:b);this._haa=a},_c2:function(){var a=null;for(var b in this._nm)b=Gb.AlarmSeverity.getByName(b),Gb.AlarmSeverity.isClearedAlarmSeverity(b)||0!==this.getNewAlarmCount(b)&&(a=a&&Gb.AlarmSeverity.compare(a,b)>0?a:b);this._hna=a},_c3:function(){if(!this._hna)return void(this._hls=!1);for(var a in this._nm)if(a=Gb.AlarmSeverity.getByName(a),!Gb.AlarmSeverity.isClearedAlarmSeverity(a)&&0!==this.getNewAlarmCount(a)&&Gb.AlarmSeverity.compare(this._hna,a)>0)return void(this._hls=!0);this._hls=!1},_c4:function(){var a=this._haa,b=this._hna,c=this._ps;this._hoa=a,Gb.AlarmSeverity.compare(b,this._hoa)>0&&(this._hoa=b),Gb.AlarmSeverity.compare(c,this._hoa)>0&&(this._hoa=c)},_c5:function(){var a=this._haa,b=this._hna;this._hta=a,Gb.AlarmSeverity.compare(b,this._hta)>0&&(this._hta=b)},increaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];null==c&&(c=0),c+=b,this._am[a.name]=c,this._f()}},increaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];null==c&&(c=0),c+=b,this._nm[a.name]=c,this._f()}},decreaseAcknowledgedAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._am[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._am[a.name]=c,this._f()}},decreaseNewAlarm:function(a,b){if(null==b&&(b=1),0!==b){var c=this._nm[a.name];if(null==c&&(c=0),c-=b,0>c)throw"Alarm count can not be negative";this._nm[a.name]=c,this._f()}},acknowledgeAlarm:function(a){this.decreaseNewAlarm(a,1),this.increaseAcknowledgedAlarm(a,1)},acknowledgeAllAlarms:function(a){if(a){var b=this.getNewAlarmCount(a);this.decreaseNewAlarm(a,b),this.increaseAcknowledgedAlarm(a,b)}else for(var c in this._nm)this.acknowledgeAllAlarms(Gb.AlarmSeverity.getByName(c))},_c6:function(){this._aac=0;for(var a in this._am)a=Gb.AlarmSeverity.getByName(a),this._aac+=this.getAcknowledgedAlarmCount(a)},getAcknowledgedAlarmCount:function(a){if(a){var b=this._am[a.name];return null==b?0:b}return this._aac},getAlarmCount:function(a){return this.getAcknowledgedAlarmCount(a)+this.getNewAlarmCount(a)},_c7:function(){this._nac=0;for(var a in this._nm)a=Gb.AlarmSeverity.getByName(a),this._nac+=this.getNewAlarmCount(a)},getNewAlarmCount:function(a){if(a){var b=this._nm[a.name];return null==b?0:b}return this._nac},setNewAlarmCount:function(a,b){this._nm[a.name]=b,this._f()},removeAllNewAlarms:function(a){a?delete this._nm[a]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(a,b){this._am[a.name]=b,this._f()},removeAllAcknowledgedAlarms:function(a){a?delete this._am[a.name]:this._am={},this._f()},isEmpty:function(){return null==this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(a){if(this._ep||(a=null),this._ps!==a){var b=this._ps;this._ps=a,this._f(),this._e.firePropertyChange("propagateSeverity",b,a)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(a){var b=this._ep;this._ep=a,this._e.firePropertyChange("enablePropagation",b,a)&&(a||this.setPropagateSeverity(null))}}),Gb.AlarmBox=function(a){if(!a)throw"elementBox can not be null.";Gb.AlarmBox.superClass.constructor.call(this),this._elementBox=a,this._alarmElementMapping=new Gb.AlarmElementMapping(this,a),this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange,this,!0),this.addDataBoxChangeListener(this.handleAlarmBoxChange,this,!0),this.addDataPropertyChangeListener(this.handleAlarmPropertyChange,this,!0)},Hb.ext("twaver.AlarmBox",Gb.DataBox,{__accessor:["removeAlarmWhenElementIsRemoved"],_name:"AlarmBox",_removeAlarmWhenAlarmIsCleared:!1,_removeAlarmWhenElementIsRemoved:!0,getElementBox:function(){return this._elementBox},isRemoveAlarmWhenAlarmIsCleared:function(){return this._removeAlarmWhenAlarmIsCleared},setRemoveAlarmWhenAlarmIsCleared:function(a){var b=this._removeAlarmWhenAlarmIsCleared;this._removeAlarmWhenAlarmIsCleared=a,this.firePropertyChange("removeAlarmWhenAlarmIsCleared",b,a),a&&this.toDatas(function(a){return a.isCleared()}).forEach(this.remove,this)},getAlarmElementMapping:function(){return this._alarmElementMapping},setAlarmElementMapping:function(a){if(!a)throw"alarmElementMapping can not be null";if(this._alarmElementMapping!==a){var b=this._alarmElementMapping;this.getDatas().forEach(this._decreaseAlarmState,this),this._alarmElementMapping=a,this.getDatas().forEach(this._increaseAlarmState,this),this.firePropertyChange("alarmElementMapping",b,a)}},handleElementBoxChange:function(a){"add"===a.kind?this.handleElementAdded(a.data):"remove"===a.kind?(this.handleElementRemoved(a.data),this._removeAlarmWhenElementIsRemoved&&this.removeAlarmsByElement(a.data)):"clear"===a.kind&&(a.datas.forEach(this.handleElementRemoved,this),this._removeAlarmWhenElementIsRemoved&&this.clear())},handleAlarmBoxChange:function(a){"add"===a.kind?this._increaseAlarmState(a.data):"remove"===a.kind?this._decreaseAlarmState(a.data):"clear"===a.kind&&a.datas.forEach(this._decreaseAlarmState,this)},handleAlarmPropertyChange:function(a){var b=a.source;b.isCleared()||("alarmSeverity"===a.property?this.handleAlarmSeverityChange(b,a):"acked"===a.property&&this.handleAckedChange(b,a)),"cleared"===a.property&&(b.isCleared()?(this._decreaseAlarmState(b,!0),this._removeAlarmWhenAlarmIsCleared&&this.remove(b)):this._increaseAlarmState(b,!0))},handleAckedChange:function(a,b){if(a.getAlarmSeverity()){var c=this.getCorrespondingElements(a);if(c)for(var d=0;d<c.size();d++){var e=c.get(d);b.oldValue?e.getAlarmState().decreaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().decreaseNewAlarm(a.getAlarmSeverity()),b.newValue?e.getAlarmState().increaseAcknowledgedAlarm(a.getAlarmSeverity()):e.getAlarmState().increaseNewAlarm(a.getAlarmSeverity())}}},handleAlarmSeverityChange:function(a,b){var c=b.oldValue,d=b.newValue,e=this.getCorrespondingElements(a);if(e)for(var f=0;f<e.size();f++){var g=e.get(f);c&&(a.isAcked()?g.getAlarmState().decreaseAcknowledgedAlarm(c):g.getAlarmState().decreaseNewAlarm(c)),d&&(a.isAcked()?g.getAlarmState().increaseAcknowledgedAlarm(d):g.getAlarmState().increaseNewAlarm(d))}},getCorrespondingAlarms:function(a){return this._alarmElementMapping.getCorrespondingAlarms(a)},getCorrespondingElements:function(a){return this._alarmElementMapping.getCorrespondingElements(a)},handleElementAdded:function(a){var b=this.getCorrespondingAlarms(a);if(b)for(var c=0;c<b.size();c++){var d=b.get(c);if(!d.isCleared()){var e=d.getAlarmSeverity();e&&(d.isAcked()?a.getAlarmState().increaseAcknowledgedAlarm(e):a.getAlarmState().increaseNewAlarm(e))}}},_increaseAlarmState:function(a,b){if(!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().increaseAcknowledgedAlarm(c):f.getAlarmState().increaseNewAlarm(c)}}}},_decreaseAlarmState:function(a,b){if(!a.isCleared()||b){var c=a.getAlarmSeverity();if(c){var d=this.getCorrespondingElements(a);if(d)for(var e=0;e<d.size();e++){var f=d.get(e);a.isAcked()?f.getAlarmState().decreaseAcknowledgedAlarm(c):f.getAlarmState().decreaseNewAlarm(c)}}}},handleElementRemoved:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(function(b){!b.isCleared()&&b.getAlarmSeverity()&&(b.isAcked()?a.getAlarmState().decreaseAcknowledgedAlarm(b.getAlarmSeverity()):a.getAlarmState().decreaseNewAlarm(b.getAlarmSeverity()))})},removeAlarmsByElement:function(a){var b=this.getCorrespondingAlarms(a);b&&b.forEach(this.remove,this)},add:function(a,b){if(!a.IAlarm)throw"Only IAlarm can be added into AlarmBox";this._removeAlarmWhenAlarmIsCleared&&a.isCleared()||Gb.AlarmBox.superClass.add.apply(this,arguments)}}),Gb.AlarmElementMapping=function(a,b){if(!b)throw"ElementBox can not be null";if(!a)throw"AlarmBox can not be null";this._elementBox=b,this._alarmBox=a,this._alarmsFinder=new Gb.QuickFinder(a,"elementId")},Hb.ext("twaver.AlarmElementMapping",Object,{getCorrespondingAlarms:function(a){return this._alarmsFinder.find(a.getId())},getCorrespondingElements:function(a){var b=this._elementBox.getDataById(a.getElementId());return new md(b)},dispose:function(){this._alarmsFinder.dispose(),delete this._elementBox,delete this._alarmBox,delete this._alarmsFinder}}),Gb.AlarmStateStatistics=function(a){Gb.AlarmStateStatistics.superClass.constructor.apply(this,arguments),this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.elementMap={},this.setElementBox(a)},Hb.ext("twaver.AlarmStateStatistics",Gb.PropertyChangeDispatcher,{getElementBox:function(){return this._elementBox},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._elementBox!==a){var b=this._elementBox;b&&(b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removeDataBoxChangeListener(this.handleElementBoxChange,this),this.severtiyMap={},this.elementMap={}),this._elementBox=a,this.reset(),a.addDataPropertyChangeListener(this.handleElementPropertyChange,this),a.addDataBoxChangeListener(this.handleElementBoxChange,this),this.firePropertyChange("elementBox",b,a)}},dispose:function(){this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange,this),delete this._elementBox},handleElementPropertyChange:function(a){"alarmState"===a.property&&(this.increase(a.source),this.fireAlarmStateChange())},handleElementBoxChange:function(a){"add"===a.kind?(this.increase(a.data),this.fireAlarmStateChange()):"remove"===a.kind?(this.decrease(a.data),this.fireAlarmStateChange()):"clear"===a.kind&&(this.severtiyMap={},this.elementMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,Gb.AlarmSeverity.forEach(function(a){var b=this.getSumInfo(a);this.sumAcked+=b.ackedCount,this.sumNew+=b.newCount,this.sumTotal+=b.totalCount},this),this.firePropertyChange("alarmState",!1,!0)},getNewAlarmCount:function(a){if(!a)return this.sumNew;var b=this.getSumInfo(a);return b.newCount},getAcknowledgedAlarmCount:function(a){if(!a)return this.sumAcked;var b=this.getSumInfo(a);return b.ackedCount},getTotalAlarmCount:function(a){if(!a)return this.sumTotal;var b=this.getSumInfo(a);return b.totalCount},getSumInfo:function(a){var b=this.severtiyMap[a.name];return b||(b={},b.newCount=0,b.ackedCount=0,b.totalCount=0,this.severtiyMap[a.name]=b),b},decrease:function(a){var b=this.elementMap[a.getId()];b&&(delete this.elementMap[a.getId()],Gb.AlarmSeverity.forEach(function(a){var c=b[a.name],d=this.getSumInfo(a);d.newCount=d.newCount-c.newCount,d.ackedCount=d.ackedCount-c.ackedCount,d.totalCount=d.totalCount-c.totalCount},this))},increase:function(a){if(this.decrease(a),!this._filterFunction||this._filterFunction(a)){var b={};this.elementMap[a.getId()]=b,Gb.AlarmSeverity.forEach(function(c){var d={};d.newCount=a.getAlarmState().getNewAlarmCount(c),d.ackedCount=a.getAlarmState().getAcknowledgedAlarmCount(c),d.totalCount=a.getAlarmState().getAlarmCount(c),b[c.name]=d;var e=this.getSumInfo(c);e.newCount=e.newCount+d.newCount,e.ackedCount=e.ackedCount+d.ackedCount,e.totalCount=e.totalCount+d.totalCount},this)}},reset:function(){this.severtiyMap={},this.elementMap={},this._elementBox.forEach(this.increase,this),this.fireAlarmStateChange()},setFilterFunction:function(a){var b=this._filterFunction;this._filterFunction=a,this.reset(),this.firePropertyChange("filterFunction",b,a)},getFilterFunction:function(){return _filterFunction}}),Gb.LayerBox=function(a){Gb.LayerBox.superClass.constructor.call(this),this._elementBox=a,this._defaultLayer=new Gb.Layer(Dd.LAYER_DEFAULT_ID,Dd.LAYER_DEFAULT_NAME),this.add(this._defaultLayer)},Hb.ext("twaver.LayerBox",Gb.DataBox,{_name:"LayerBox",getElementBox:function(){return this._elementBox},getDefaultLayer:function(){return this._defaultLayer},add:function(a,b){if(!a.ILayer)throw"Only ILayer can be added into LayerBox";Gb.LayerBox.superClass.add.apply(this,arguments)},removeById:function(a){if(a===this._defaultLayer.getId())throw"Cannot remove default layer";Gb.LayerBox.superClass.removeById.call(this,a)},getLayerByElement:function(a){if(!a)return null;if(a._layerId===Dd.LAYER_DEFAULT_ID)return this._defaultLayer;var b=this.getDataById(a.getLayerId());return b?b:this._defaultLayer},clear:function(){this.toDatas().forEach(function(a){a!=this._defaultLayer&&this.removeById(a.getId())},this)}}),Gb.BundleLinks=function(a,b){this._links=a,this._siblings=b;var c,d,e=Ed._m["link.bundle.expanded"];for(c=0;c<a.size();c++){d=a.get(c);var f=d.getStyle("link.bundle.expanded");if(null!=f){e=f;break}}if(null==e&&(e=!0),Dd.LINK_BUNDLE_AGENT_FUNCTION){var g=Dd.LINK_BUNDLE_AGENT_FUNCTION(a);null==g?g=a.get(0):g!=a.get(0)&&(a.remove(g),a.add(g,0))}for(c=0;c<a.size();c++)a.get(c).setStyle("link.bundle.expanded",e)},Hb.ext("twaver.BundleLinks",Object,{getLinks:function(){return this._links},getSiblings:function(){return this._siblings},forEachSiblingLink:function(a,b){this._siblings.forEach(function(c){c.getLinks().forEach(a,b)})}});var Fd={bitsToNum:function(a){return a.reduce(function(a,b){return 2*a+b},0)},byteToBitArr:function(a){for(var b=[],c=7;c>=0;c--)b.push(!!(a&1<<c));return b},lzwDecode:function(a,b){for(var c,d,e=0,f=function(a){for(var c=0,d=0;a>d;d++)b.charCodeAt(e>>3)&1<<(7&e)&&(c|=1<<d),e++;return c},g=[],h=1<<a,i=h+1,j=a+1,k=[],l=function(){k=[],j=a+1;for(var b=0;h>b;b++)k[b]=[b];k[h]=[],k[i]=null};;)if(d=c,c=f(j),c!==h){if(c===i)break;if(c<k.length)d!==h&&k.push(k[d].concat(k[c][0]));else{if(c!==k.length)throw new Error("Invalid LZW code.");k.push(k[d].concat(k[d][0]))}g.push.apply(g,k[c]),k.length===1<<j&&12>j&&j++}else l();return g}},Gd=function(a){this.data=a,this.len=this.data.length,this.pos=0};Hb.ext(Gd,Object,{readByte:function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&this.data.charCodeAt(this.pos++)},readBytes:function(a){for(var b=[],c=0;a>c;c++)b.push(this.readByte());return b},read:function(a){for(var b="",c=0;a>c;c++)b+=String.fromCharCode(this.readByte());return b},readUnsigned:function(){var a=this.readBytes(2);return(a[1]<<8)+a[0]}});var Hd=function(a){var b,c=a,d=null,e=null,f=null,g=0,h=null,i=null,j=null;this.frames=[],this.size={};var k=this,l=Mb.createElement("canvas");this.loaded=!1;var m=function(){d=null,e=null,h=f,f=null,i=null};this.doParse=function(){Id(c,t)};var n=function(a){b=a,k.size.width=b.width,k.size.height=b.height},o=function(a){p(),m(),d=a.transparencyGiven?a.transparencyIndex:null,e=a.delayTime,f=a.disposalMethod},p=function(){i&&k.frames.push({data:i.getImageData(0,0,b.width,b.height),delay:e})},q=function(a){i||(i=l.getContext("2d"));var c=k.frames.length,e=a.lctFlag?a.lct:b.gct;c>0&&(3===h?i.putImageData(k.frames[g].data,0,0):g=c-1,2===h&&(j||i.clearRect(j.leftPos,j.topPos,j.width,j.height)));var f=i.getImageData(a.leftPos,a.topPos,a.width,a.height);a.pixels.forEach(function(a,b){a!==d&&(f.data[4*b+0]=e[a][0],f.data[4*b+1]=e[a][1],f.data[4*b+2]=e[a][2],f.data[4*b+3]=255)}),i.putImageData(f,a.leftPos,a.topPos),j=a},r=function(){},s=function(a){return function(b){a(b)}},t={hdr:s(n),gce:s(o),com:s(r),app:{NETSCAPE:s(r)},img:s(q),eof:function(a){p(),k.loaded=!0}}},Id=function(a,b){b||(b={});var c=function(b){for(var c=[],d=0;b>d;d++)c.push(a.readBytes(3));return c},d=function(){var b,c;c="";do b=a.readByte(),c+=a.read(b);while(0!==b);return c},e=function(){var d={};if(d.sig=a.read(3),d.ver=a.read(3),"GIF"!==d.sig)throw new Error("Not a GIF file.");d.width=a.readUnsigned(),d.height=a.readUnsigned();var e=Fd.byteToBitArr(a.readByte());d.gctFlag=e.shift(),d.colorRes=Fd.bitsToNum(e.splice(0,3)),d.sorted=e.shift(),d.gctSize=Fd.bitsToNum(e.splice(0,3)),d.bgColor=a.readByte(),d.pixelAspectRatio=a.readByte(),d.gctFlag&&(d.gct=c(1<<d.gctSize+1)),b.hdr&&b.hdr(d)},f=function(c){var e=function(c){var d=(a.readByte(),Fd.byteToBitArr(a.readByte()));c.reserved=d.splice(0,3),c.disposalMethod=Fd.bitsToNum(d.splice(0,3)),c.userInput=d.shift(),c.transparencyGiven=d.shift(),c.delayTime=a.readUnsigned(),c.transparencyIndex=a.readByte(),c.terminator=a.readByte(),b.gce&&b.gce(c)},f=function(a){a.comment=d(),b.com&&b.com(a)},g=function(c){a.readByte();c.ptHeader=a.readBytes(12),c.ptData=d(),b.pte&&b.pte(c)},h=function(c){{var e=function(c){a.readByte();c.unknown=a.readByte(),c.iterations=a.readUnsigned(),c.terminator=a.readByte(),b.app&&b.app.NETSCAPE&&b.app.NETSCAPE(c)},f=function(a){a.appData=d(),b.app&&b.app[a.identifier]&&b.app[a.identifier](a)};a.readByte()}switch(c.identifier=a.read(8),c.authCode=a.read(3),c.identifier){case"NETSCAPE":e(c);break;default:f(c)}},i=function(a){a.data=d(),b.unknown&&b.unknown(a)};switch(c.label=a.readByte(),c.label){case 249:c.extType="gce",e(c);break;case 254:c.extType="com",f(c);break;case 1:c.extType="pte",g(c);break;case 255:c.extType="app",h(c);break;default:c.extType="unknown",i(c)}},g=function(e){var f=function(a,b){for(var c=new Array(a.length),d=a.length/b,e=function(d,e){var f=a.slice(e*b,(e+1)*b);c.splice.apply(c,[d*b,b].concat(f))},f=[0,4,2,1],g=[8,8,4,2],h=0,i=0;4>i;i++)for(var j=f[i];d>j;j+=g[i])e(j,h),h++;return c};e.leftPos=a.readUnsigned(),e.topPos=a.readUnsigned(),e.width=a.readUnsigned(),e.height=a.readUnsigned();var g=Fd.byteToBitArr(a.readByte());e.lctFlag=g.shift(),e.interlaced=g.shift(),e.sorted=g.shift(),e.reserved=g.splice(0,2),e.lctSize=Fd.bitsToNum(g.splice(0,3)),e.lctFlag&&(e.lct=c(1<<e.lctSize+1)),e.lzwMinCodeSize=a.readByte();var h=d();e.pixels=Fd.lzwDecode(e.lzwMinCodeSize,h),e.interlaced&&(e.pixels=f(e.pixels,e.width)),b.img&&b.img(e)},h=function(){var c={};switch(c.sentinel=a.readByte(),String.fromCharCode(c.sentinel)){case"!":c.type="ext",f(c);break;case",":c.type="img",g(c);break;case";":c.type="eof",b.eof&&b.eof(c);break;default:throw new Error("Unknown block: 0x"+c.sentinel.toString(16))}"eof"!==c.type&&setTimeout(h,0)},i=function(){e(),setTimeout(h,0)};i()},Jd=function(a,b,c){var d=Mb.createElement("canvas");return Kd(d,b.width,b.height),d.getContext("2d").clearRect(0,0,b.width,b.height),d.getContext("2d").putImageData(a[c].data,0,0),d},Kd=function(a,b,c){a.width=b,a.height=c,a.style.width=b+"px",a.style.height=c+"px"};Gb.Data=function(a){if(Gb.Data.superClass.constructor.apply(this,arguments),this._childList=new md,this._childMap={},this._clientMap={},void 0===a||null===a)this._id=Hb.id();else if("string"==typeof a||"number"==typeof a||"boolean"==typeof a)this._id=a;else{for(var b in a)if("clients"===b)for(var c in a.clients)this._clientMap[c]=a.clients[c];else if("styles"===b)for(var d in a.styles)this._styleMap[d]=a.styles[d];else null!=a[b]&&("id"===b?this._id=a[b]:this[Hb.setter(b)]&&this[Hb.setter(b)](a[b]));null==this._id&&(this._id=Hb.id())}},Hb.ext("twaver.Data",Gb.PropertyChangeDispatcher,{IData:!0,IClient:!0,__client:1,__new:1,_parent:null,__accessor:["name","name2","icon","toolTip"],_icon:Dd.ICON_DATA,_dragBoundsFunc:null,getId:function(){return this._id},getChildren:function(){return this._childList},getChildrenSize:function(){return this._childList.size()},toChildren:function(a,b){return this._childList.toList(a,b)},addChild:function(a,b){return void 0===b&&(b=this._childList.size()),a&&a!==this?this._childMap[a.getId()]?!1:this.isDescendantOf(a)?!1:(a.getParent()&&a.getParent().removeChild(a),(0>b||b>this._childList.size())&&(b=this._childList.size()),this._childList.add(a,b),this._childMap[a._id]=a,a.setParent(this),this.firePropertyChange("children",null,a),this.onChildAdded(a,b),!0):!1},onChildAdded:function(a,b){},removeChild:function(a){if(!a)return!1;if(!this._childMap[a._id])return!1;var b=this._childList.remove(a);return delete this._childMap[a._id],this.firePropertyChange("children",a,null),a.setParent(null),this.onChildRemoved(a,b),!0},onChildRemoved:function(a,b){},getChildAt:function(a){return this._childList.get(a)},clearChildren:function(){if(0===this._childList.size())return!1;for(var a=this._childList.toArray(),b=a.length,c=0;b>c;c++)this.removeChild(a[c]);return this.onChildrenCleared(a),!0},onChildrenCleared:function(a){},getParent:function(){return this._parent},setParent:function(a){if(!(this._isUpdatingParent||this._parent===a||this===a||a&&a.isDescendantOf(this))){var b=this._parent;this._parent=a,this._isUpdatingParent=!0,b&&b.removeChild(this),a&&a.addChild(this),delete this._isUpdatingParent,this.firePropertyChange("parent",b,a),this.onParentChanged(b,a)}},onParentChanged:function(a,b){},hasChildren:function(){return this._childList.size()>0},isRelatedTo:function(a){return a?this.isDescendantOf(a)||a.isDescendantOf(this):!1},isParentOf:function(a){return a?null!=this._childMap[a._id]:!1},isDescendantOf:function(a){if(!a)return!1;if(!a.hasChildren())return!1;for(var b=this._parent;b;){if(a===b)return!0;b=b.getParent()}return!1},getDragBoundsFunc:function(){return this._dragBoundsFunc},setDragBoundsFunc:function(a){this._dragBoundsFunc=a},toString:function(){return this.getName()?this.getName():this._id}}),Gb.Alarm=function(a,b,c,d,e){Gb.Alarm.superClass.constructor.call(this,a),this._elementId=b,this._alarmSeverity=c,this._acked=d||!1,this._cleared=e||!1},Hb.ext("twaver.Alarm",Gb.Data,{IAlarm:!0,getElementId:function(){return this._elementId},__accessor:["acked","cleared","alarmSeverity"]}),Gb.Layer=function(a){Gb.Layer.superClass.constructor.call(this,a)},Hb.ext("twaver.Layer",Gb.Data,{ILayer:!0,__accessor:["visible","movable","editable","rotatable"],_visible:!0,_movable:!0,_editable:!0,_rotatable:!0,_name:"Default"}),Gb.Element=function(a){this._styleMap=this._styleMap||{},this._alarmState=new Gb.AlarmState(this),Gb.Element.superClass.constructor.call(this,a)},Hb.ext("twaver.Element",Gb.Data,{IElement:!0,IStyle:!0,__accessor:["layerId"],__bool:["visible","movable"],__style:1,_layerId:Dd.LAYER_DEFAULT_ID,_visible:!0,_movable:!0,getAlarmState:function(){return this._alarmState},isAdjustedToBottom:function(){return!1},getElementUIClass:function(){return null},getCanvasUIClass:function(){return null},getVectorUIClass:function(){return null},s:function(a,b){return void 0===b?this.getStyle(a):(this.setStyle(a,b),this)},c:function(a,b){return void 0===b?this.getClient(a):(this.setClient(a,b),this)}}),Gb.Dummy=function(a){Gb.Dummy.superClass.constructor.call(this,a)},Hb.ext("twaver.Dummy",Gb.Element,{IDummy:!0});var Ld=function(a){this._location={x:0,y:0},Ld.superClass.constructor.call(this,a)};Gb.Node=Ld,Ld.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},Hb.ext("twaver.Node",Gb.Element,{_icon:Dd.ICON_NODE,_image:Dd.IMAGE_NODE,_imageUrl:null,_angle:0,getLoopedLinks:function(){return this._loopedLinks},getLinks:function(){return this._links},getAgentLinks:function(){return this._agentLinks},getFollowers:function(){return this._followers},_addFollower:function(a){this._followers||(this._followers=new md),this._followers.add(a)},_removeFollower:function(a){this._followers.remove(a),this._followers.isEmpty()&&delete this._followers},getFromLinks:function(){return this._fromLinks},getToLinks:function(){return this._toLinks},_addFromLink:function(a){this._links||(this._links=new md(!1)),this._fromLinks||(this._fromLinks=new md(!1)),this._links.add(a),this._toLinks&&this._toLinks.contains(a)&&(this._loopedLinks||(this._loopedLinks=new md(!1)),this._loopedLinks.add(a)),this._fromLinks.add(a)},_addToLink:function(a){this._links||(this._links=new md(!1)),this._toLinks||(this._toLinks=new md(!1)),this._links.add(a),this._fromLinks&&this._fromLinks.contains(a)&&(this._loopedLinks||(this._loopedLinks=new md(!1)),this._loopedLinks.add(a)),this._toLinks.add(a)},_removeFromLink:function(a){this._links&&this._links.remove(a),this._fromLinks&&this._fromLinks.remove(a),this._loopedLinks&&this._loopedLinks.remove(a)},_removeToLink:function(a){this._links&&this._links.remove(a),this._toLinks&&this._toLinks.remove(a),this._loopedLinks&&this._loopedLinks.remove(a)},hasAgentLinks:function(){return null!=this._agentLinks&&!this._agentLinks.isEmpty()},getFromAgentLinks:function(){return this._fromAgentLinks},getToAgentLinks:function(){return this._toAgentLinks},_addFromAgentLink:function(a){this._fromAgentLinks||(this._fromAgentLinks=new md(!1)),this._agentLinks||(this._agentLinks=new md(!1)),this._fromAgentLinks.add(a),this._agentLinks.add(a)},_addToAgentLink:function(a){this._toAgentLinks||(this._toAgentLinks=new md(!1)),this._agentLinks||(this._agentLinks=new md(!1)),this._toAgentLinks.add(a),this._agentLinks.add(a)},_removeFromAgentLink:function(a){this._fromAgentLinks&&this._fromAgentLinks.remove(a),this._agentLinks&&this._agentLinks.remove(a)},_removeToAgentLink:function(a){this._toAgentLinks&&this._toAgentLinks.remove(a),this._agentLinks&&this._agentLinks.remove(a)},getImage:function(){return this._image},setImage:function(a){var b=this._image,c=this.getWidth(),d=this.getHeight();this._image=a,this.firePropertyChange("image",b,a),this.firePropertyChange("width",c,this.getWidth()),this.firePropertyChange("height",d,this.getHeight())},getImageUrl:function(){return this._imageUrl},setImageUrl:function(a){if(this._imageUrl!=a){var b=this._imageUrl;this._imageUrl=a,Cd.images[a]||Gb.imageUtil.registerImageByUrl(a,"svg"===Gb.imageUtil.getImageType(a),a),this.setImage(a),this.firePropertyChange("imageUrl",b,a)}},getX:function(){return this._location.x},getY:function(){return this._location.y},setX:function(a){this.setLocation(a,this._location.y)},setY:function(a){this.setLocation(this._location.x,a)},getLocation:function(){return this._location},setLocation:function(a,b){var c;if(c=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],Hb.num(c.x)&&Hb.num(c.y)&&(c.x!==this._location.x||c.y!==this._location.y)){this._dragBoundsFunc&&(c=this._dragBoundsFunc(c));var d=this._location;this._location=c,this.firePropertyChange("location",d,c)}},getCenterLocation:function(){return Dd.CENTER_LOCATION?this._location:{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},setCenterLocation:function(a,b){var c;c=2===arguments.length?{x:arguments[0],y:arguments[1]}:Hb.clone(arguments[0]),Hb.num(c.x)&&Hb.num(c.y)&&(Dd.CENTER_LOCATION||(c.x-=this.getWidth()/2,c.y-=this.getHeight()/2),this.setLocation(c))},translate:function(a,b){this.setLocation(this.getX()+a,this.getY()+b)},getWidth:function(){if(Hb.num(this._width)&&this._width>=0)return this._width;if("object"!=typeof this._image){var a=Hb.getImageAsset(this._image);if(a){var b=a.getWidth();return Hb.num(b)&&b>=0?b:(a=a._image,Xc(this,a,a,"w"))}}else if(this._image)return this._image.w;return Dd.NODE_WIDTH},setWidth:function(a){var b=this._width;this._width=a,this.firePropertyChange("width",b,a)},getHeight:function(){if(Hb.num(this._height)&&this._height>=0)return this._height;if("object"!=typeof this._image){var a=Hb.getImageAsset(this._image);if(a){var b=a.getHeight();return Hb.num(b)&&b>=0?b:(a=a._image,Xc(this,a,a,"h"))}}else if(this._image)return this._image.h;return Dd.NODE_HEIGHT},setHeight:function(a){var b=this._height;this._height=a,this.firePropertyChange("height",b,a)},setSize:function(){2===arguments.length?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getRect:function(){var a=this.getOriginalRect();if(0===this._angle)return a;for(var b=Rb.createMatrix(this._angle*Math.PI/180,a.x+a.width/2,a.y+a.height/2),c=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}],d=0,e=c.length;e>d;d++)c[d]=b.transform(c[d]);var f=Rb.getRect(c);return f},getOriginalRect:function(){var a=this,b=a.getWidth(),c=a.getHeight();return Dd.CENTER_LOCATION?{x:a._location.x-b/2,y:a._location.y-c/2,width:b,height:c}:{x:a.getX(),y:a.getY(),width:b,height:c}},getAngle:function(){return this._angle},setAngle:function(a){var b=this._angle;this._angle=a%360,this.firePropertyChange("angle",b,this._angle)},onParentChanged:function(a,b){Ld.superClass.onParentChanged.call(this,a,b),this._checkLinkAgent()},_checkLinkAgent:function(){if(Gb._isInitializing){if(this._links)for(var a=this._links.size(),b=0;a>b;b++)this._links.get(b)._checkAgentNode()}else Gb.ElementBox.prototype.startBatch(function(){if(this._links)for(var a=this._links.size(),b=0;a>b;b++)this._links.get(b)._checkAgentNode()},this)},onPropertyChanged:function(a){if(Ld.superClass.onPropertyChanged.call(this,a),this._followers)for(var b=this._followers.toList(),c=b.size(),d=0;c>d;d++)b.get(d).handleHostPropertyChange(a);this.getParent()instanceof Nd&&Ld.IS_INTERESTED_NODE_PROPERTY[a.property]&&this.getParent().updateLocationFromChildren()},getElementUIClass:function(){return Gb.network.NodeUI},getCanvasUIClass:function(){return Gb.canvas.NodeUI},getVectorUIClass:function(){return Gb.vector.NodeUI}});var Md=function(a){Md.superClass.constructor.call(this,a)};Gb.HTMLNode=Md,Hb.ext("twaver.HTMLNode",Gb.Node,{getElementUIClass:function(){return Gb.network.HTMLNodeUI},getCanvasUIClass:function(){return Gb.canvas.HTMLNodeUI},getVectorUIClass:function(){return Gb.vector.HTMLNodeUI}}),Gb.Link=function(a,b,c){Gb.Link.superClass.constructor.call(this,a instanceof Ld?null:a),a instanceof Ld&&(c=b,b=a),b&&this.setFromNode(b),c&&this.setToNode(c)},Gb.Link.IS_INTERESTED_BUNDLE_STYLE={"link.bundle.enable":1,"link.bundle.id":1,"link.bundle.independent":1},Hb.ext("twaver.Link",Gb.Element,{_fromNode:null,_toNode:null,_fromAgent:null,_toAgent:null,_icon:Dd.ICON_LINK,getFromNode:function(){return this._fromNode},getToNode:function(){return this._toNode},getFromAgent:function(){return this._fromAgent},getToAgent:function(){return this._toAgent},setFromNode:function(a){if(this._fromNode!==a){var b=this._fromNode;this._fromNode=a,b&&b._removeFromLink(this),this._fromNode&&this._fromNode._addFromLink(this),this._checkAgentNode(),this.firePropertyChange("fromNode",b,a)}},setToNode:function(a){if(this._toNode!==a){var b=this._toNode;this._toNode=a,b&&b._removeToLink(this),this._toNode&&this._toNode._addToLink(this),this._checkAgentNode(),this.firePropertyChange("toNode",b,a)}},isLooped:function(){return this._fromNode===this._toNode&&null!=this._fromNode&&null!=this._toNode},_checkAgentNode:function(){Gb._isInitializing?Gb._links[this._id]||(Gb._links[this._id]=this):this._checkAgentNodeImpl()},_checkAgentNodeImpl:function(){var a,b,c=uc.figureFromAgent(this),d=this;this._fromAgent!=c&&(a=this._fromAgent,this._fromAgent&&this._fromAgent._removeFromAgentLink(this),this._fromAgent=c,this._fromAgent&&this._fromAgent._addFromAgentLink(this),this.firePropertyChange("fromAgent",a,this._fromAgent),Gb._isInitializing?(a&&this._toAgent&&(b=a._id+":"+this._toAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[a,this._toAgent])),this._fromAgent&&this._toAgent&&(b=this._fromAgent._id+":"+this._toAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[this._fromAgent,this._toAgent]))):(uc.resetBundleLinks(a,d._toAgent),uc.resetBundleLinks(d._fromAgent,d._toAgent)));var e=uc.figureToAgent(this);this._toAgent!=e&&(a=this._toAgent,this._toAgent&&this._toAgent._removeToAgentLink(this),this._toAgent=e,this._toAgent&&this._toAgent._addToAgentLink(this),this.firePropertyChange("toAgent",a,this._toAgent),Gb._isInitializing?(a&&this._fromAgent&&(b=a._id+":"+this._fromAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[a,this._fromAgent])),this._toAgent&&this._fromAgent&&(b=this._toAgent._id+":"+this._fromAgent._id,Gb._bundleLinks[b]||(Gb._bundleLinks[b]=[this._toAgent,this._fromAgent]))):(uc.resetBundleLinks(a,d._fromAgent),uc.resetBundleLinks(d._toAgent,d._fromAgent)))},_setBundleLinks:function(a){this._bundleLinks=a,this.firePropertyChange("bundleLinks",!0,!1)},getBundleLinks:function(){return this._bundleLinks},getBundleCount:function(){return this._bundleLinks?this._bundleLinks.getLinks().size():1;

},getBundleIndex:function(){return this._bundleLinks?this._bundleLinks.getLinks().indexOf(this):0},reverseBundleExpanded:function(){if(this._bundleLinks&&this._bundleLinks.getLinks().size()>0){var a,b,c=this._bundleLinks.getLinks(),d=!this.getStyle("link.bundle.expanded");for(a=0;a<c.size();a++)b=c.get(a),b.setStyle("link.bundle.expanded",d);var e=this._bundleLinks.getSiblings();for(a=0;a<e.size();a++){var f=e.get(a);if(f!=this._bundleLinks){c=f.getLinks();for(var g=0;g<c.size();g++)b=c.get(g),b.firePropertyChange("bundleLinks",null,f)}}return!0}return!1},isBundleAgent:function(){return null!=this._bundleLinks&&this._bundleLinks.getLinks().size()>1&&this===this._bundleLinks.getLinks().get(0)&&!this.getStyle("link.bundle.expanded")},onStyleChanged:function(a,b,c){Gb.Link.superClass.onStyleChanged.call(this,a,b,c),Gb.Link.IS_INTERESTED_BUNDLE_STYLE[a]&&uc.resetBundleLinks(this._toAgent,this._fromAgent)},getElementUIClass:function(){return Gb.network.LinkUI},getCanvasUIClass:function(){return Gb.canvas.LinkUI},getVectorUIClass:function(){return Gb.vector.LinkUI},isAdjustedToBottom:function(){return Dd.IS_LINK_ADJUSTED_TO_BOTTOM}}),Gb.HTMLLink=function(a,b,c){Gb.HTMLLink.superClass.constructor.call(this,a,b,c)},Gb.Util.ext("twaver.HTMLLink",Gb.Link,{getElementUIClass:function(){return Gb.network.HTMLLinkUI},getCanvasUIClass:function(){return Gb.canvas.HTMLLinkUI},getVectorUIClass:function(){return Gb.vector.HTMLLinkUI}}),Gb.Follower=function(a){this._isUpdatingFollower=!1,this._isUpdatingLocation=!1,Gb.Follower.superClass.constructor.call(this,a)},Gb.Follower.IS_INTERESTED_HOST_GRID_PROPERTY={location:1,width:1,height:1,"S:grid.row.count":1,"S:grid.column.count":1,"S:grid.row.percents":1,"S:grid.column.percents":1,"S:grid.border":1,"S:grid.border.left":1,"S:grid.border.right":1,"S:grid.border.top":1,"S:grid.border.bottom":1,"S:grid.padding":1,"S:grid.padding.left":1,"S:grid.padding.right":1,"S:grid.padding.top":1,"S:grid.padding.bottom":1},Gb.Follower.IS_INTERESTED_FOLLOWER_STYLE={"follower.row.index":1,"follower.column.index":1,"follower.row.span":1,"follower.column.span":1,"follower.padding":1,"follower.padding.left":1,"follower.padding.right":1,"follower.padding.top":1,"follower.padding.bottom":1},Hb.ext("twaver.Follower",Ld,{_host:null,getHost:function(){return this._host},setHost:function(a){if(this!==a&&this._host!==a){var b=this._host;b&&b._removeFollower(this),this._host=a,this._host&&this._host._addFollower(this),this.firePropertyChange("host",b,a),this.onHostChanged(b,a)}},onStyleChanged:function(a,b,c){Gb.Follower.superClass.onStyleChanged.call(this,a,b,c),Gb.Follower.IS_INTERESTED_FOLLOWER_STYLE[a]&&this.updateFollower(null)},setLocation:function(){this._isUpdatingLocation||(this._isUpdatingLocation=!0,Gb.Follower.superClass.setLocation.apply(this,arguments),this._isUpdatingLocation=!1)},onHostChanged:function(a,b){this.updateFollower(null)},handleHostPropertyChange:function(a){this.updateFollower(a)},updateFollower:function(a){this._isUpdatingFollower||Hb.isDeserializing||(this._isUpdatingFollower=!0,this.updateFollowerImpl(a),this._isUpdatingFollower=!1)},updateFollowerImpl:function(a){var b=this.getHost();if(b instanceof Gb.Grid){if(!a||Gb.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[a.property]){var c=this.getStyle("follower.row.index"),d=this.getStyle("follower.column.index"),e=b.getCellRect(c,d);if(!e)return;var f=this.getStyle("follower.row.span"),g=this.getStyle("follower.column.span");if(1!=f||1!=g){var h=b.getCellRect(c+f-1,d+g-1);h&&(e=Rb.unionRect(e,h))}if(Rb.addPadding(e,this,"follower.padding"),this.getStyle("follower.fill.cell"))this.setLocation(e.x,e.y),this.setWidth(e.width),this.setHeight(e.height);else{var i=this.getStyle("follower.cell.position");e=Tb.get(i,e,this.getRect()),this.setLocation(e.x,e.y)}}}else if(null!=a&&"location"===a.property){var j=a.oldValue,k=a.newValue,l=this.getLocation();this.setLocation(l.x+(k.x-j.x),l.y+(k.y-j.y))}},isHostOn:function(a){if(!a)return!1;for(var b={},c=this._host;c&&c!=this&&!b[c.getId()];){if(c===a)return!0;b[c.getId()]=c,c=c instanceof Gb.Follower?c.getHost():null}return!1},isLoopedHostOn:function(a){return this.isHostOn(a)&&a.isHostOn(this)}});var Nd=function(a){this._isUpdatingLocationFromChildren=!1,this._isAdjusting=!1,this._expanded=!1,Nd.superClass.constructor.call(this,a)};Gb.Group=Nd,Hb.ext("twaver.Group",Gb.Follower,{_image:Dd.IMAGE_GROUP,_icon:Dd.ICON_GROUP,isAdjustedToBottom:function(){return this.isExpanded()&&uc.hasAgentLinks(this)},onChildAdded:function(a,b){Nd.superClass.onChildAdded.apply(this,arguments),this.updateLocationFromChildren()},onChildRemoved:function(a,b){Nd.superClass.onChildRemoved.apply(this,arguments),this.updateLocationFromChildren()},updateLocationFromChildren:function(){if(!this._isAdjusting&&!Hb.isDeserializing){for(var a,b,c=0,d=this.getChildrenSize();d>c;c++)b=this.getChildAt(c),b instanceof Ld&&(a=Rb.unionRect(a,this.getChildRect(b)));a&&(this._isUpdatingLocationFromChildren=!0,"lefttop"===Dd.GROUP_EXPAND_ALIGN?this.setLocation(a.x-this.getWidth()/2,a.y-this.getHeight()/2):this.setLocation(a.x+a.width/2-this.getWidth()/2,a.y+a.height/2-this.getHeight()/2),this._isUpdatingLocationFromChildren=!1)}},getChildRect:function(a){var b;return a instanceof Ld&&(a instanceof Nd?(a.isExpanded()&&a.getChildren().forEach(function(c){b=Rb.unionRect(b,a.getChildRect(c))}),b||(b=a.getRect())):b=a.getRect()),b},setLocation:function(){if(!this._isAdjusting){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Hb.isDeserializing&&!this._isUpdatingLocationFromChildren){this._isAdjusting=!0;var b=a.x-this.getX(),c=a.y-this.getY();uc.moveElements(this.getChildren(),b,c),this._isAdjusting=!1}Nd.superClass.setLocation.call(this,a)}},reverseExpanded:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._expanded},setExpanded:function(a){if(this._expanded!==a){var b=this._expanded;this._expanded=a,this.firePropertyChange("expanded",b,this._expanded),this._checkLinkAgent()}},_checkLinkAgent:function(){Nd.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Ld&&c._checkLinkAgent()}},getElementUIClass:function(){return Gb.network.GroupUI},getCanvasUIClass:function(){return Gb.canvas.GroupUI},getVectorUIClass:function(){return Gb.vector.GroupUI}}),Gb.SubNetwork=function(a){Gb.SubNetwork.superClass.constructor.call(this,a)},Hb.ext("twaver.SubNetwork",Gb.Follower,{ISubNetwork:!0,_image:Dd.IMAGE_SUBNETWORK,_icon:Dd.ICON_SUBNETWORK,_checkLinkAgent:function(){Gb.SubNetwork.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Ld&&c._checkLinkAgent()}}}),Gb.Grid=function(a){Gb.Grid.superClass.constructor.call(this,a)},Hb.ext("twaver.Grid",Gb.Follower,{_icon:Dd.ICON_GRID,_image:null,getCellObject:function(a,b){1===arguments.length&&(b=a.y,a=a.x);for(var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count"),e=0;c>e;e++)for(var f=0;d>f;f++){var g=this.getCellRect(e,f);if(Rb.containsPoint(g,a,b))return{rowIndex:e,columnIndex:f,rect:g}}return null},getCellRect:function(a,b){var c=this.getStyle("grid.row.count"),d=this.getStyle("grid.column.count");if(0>=c||0>=d)return null;if(0>a||a>=c)return null;if(0>b||b>=d)return null;var e=this.getRect();Rb.addPadding(e,this,"grid.border");var f=0,g=this.getStyle("grid.row.percents"),h=this.getStyle("grid.column.percents");if(g&&g.length===c){var i=0;for(f=0;a>f;f++)i+=e.height*g[f];e.y+=i,e.height=e.height*g[a]}else e.height=e.height/c,e.y+=e.height*a;if(h&&h.length===d){var j=0;for(f=0;b>f;f++)j+=e.width*h[f];e.x+=j,e.width=e.width*h[b]}else e.width=e.width/d,e.x+=e.width*b;return Rb.addPadding(e,this,"grid.padding"),e},getElementUIClass:function(){return Gb.network.GridUI},getCanvasUIClass:function(){return Gb.canvas.GridUI},getVectorUIClass:function(){return Gb.vector.GridUI}}),Gb.ShapeNode=function(a){this._isUpdatingShapeNode=!1,this._points=new md,Gb.ShapeNode.superClass.constructor.call(this,a)},Hb.ext("twaver.ShapeNode",Gb.Follower,{_icon:Dd.ICON_SHAPENODE,__accessor:["segments"],getElementUIClass:function(){return Gb.network.ShapeNodeUI},getCanvasUIClass:function(){return Gb.canvas.ShapeNodeUI},getVectorUIClass:function(){return Gb.vector.ShapeNodeUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new md);var b=new md(this._points);this._points=a,this.firePointsChange(b,this._points)},getSegments:function(){return this._segments},setSegments:function(a){a||(a=new md);var b=new md(this._segments);this._segments=a,this._reCalculateLineLength(),this.firePropertyChange("segments",b,this._segments)},addPoint:function(a,b){var c=new md(this._points);this._points.add(a,b),this.firePointsChange(c,this._points)},setPoint:function(a,b){var c=new md(this._points);this._points.set(a,b),this.firePointsChange(c,this._points)},removePoint:function(a){var b=new md(this._points);this._points.remove(a),this.firePointsChange(b,this._points)},removeAt:function(a){var b=new md(this._points);this._points.removeAt(a),this.firePointsChange(b,this._points)},setWidth:function(a){if(1>a&&(a=1),!this._isUpdatingShapeNode&&!Hb.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=new md(this._points),c=0;c<this._points.size();c++){var d=this._points.get(c);d.x=(d.x-this.getX())*a/this.getWidth()+this.getX()}this.firePointsChange(b,this._points),this._isUpdatingShapeNode=!1}Gb.ShapeNode.superClass.setWidth.apply(this,arguments)},setHeight:function(a){if(1>a&&(a=1),!this._isUpdatingShapeNode&&!Hb.isDeserializing){this._isUpdatingShapeNode=!0;for(var b=new md(this._points),c=0;c<this._points.size();c++){var d=this._points.get(c);d.y=(d.y-this.getY())*a/this.getHeight()+this.getY()}this.firePointsChange(b,this._points),this._isUpdatingShapeNode=!1}Gb.ShapeNode.superClass.setHeight.apply(this,arguments)},setLocation:function(){if(!this._isUpdatingShapeNode&&!Hb.isDeserializing){var a;if(a=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],!Hb.num(a.x)||!Hb.num(a.y))return;var b=a.x-this.getX(),c=a.y-this.getY();if(0===b&&0===c)return;this._isUpdatingShapeNode=!0;for(var d=new md(this._points),e=0;e<this._points.size();e++){var f=this._points.get(e);f.x+=b,f.y+=c}this.firePointsChange(d,this._points),this._isUpdatingShapeNode=!1}Gb.ShapeNode.superClass.setLocation.apply(this,arguments)},firePointsChange:function(a,b){if(!this._isUpdatingShapeNode&&!Hb.isDeserializing){var c=Rb.getRect(b);c?(this._isUpdatingShapeNode=!0,Dd.CENTER_LOCATION?this.setLocation(c.x+c.width/2,c.y+c.height/2):this.setLocation(c.x,c.y),this.setWidth(c.width),this.setHeight(c.height),this._isUpdatingShapeNode=!1):(this._isUpdatingShapeNode=!0,this.setWidth(0),this.setHeight(0),this._isUpdatingShapeNode=!1)}this._reCalculateLineLength(),this.firePropertyChange("points",a,b)},_reCalculateLineLength:function(){this._lineLength=null!=this._points&&this._points.size()>0?Rb.calculateLineLength(this._points,this._segments):0},getLineLength:function(){return this._lineLength}}),Gb.Bus=function(a){this._styleMap={},this._styleMap["vector.fill"]=!1,this._styleMap["shapenode.closed"]=!1,Gb.Bus.superClass.constructor.call(this,a)},Hb.ext("twaver.Bus",Gb.ShapeNode,{_icon:Dd.ICON_BUS,firePointsChange:function(a,b){var c=b.size();if(!Hb.isDeserializing&&c>=2)for(var d=b.get(0),e=1;c>e;e++){var f=b.get(e);Math.abs(f.x-d.x)>Math.abs(f.y-d.y)?f.y=d.y:f.x=d.x,d=f}Gb.Bus.superClass.firePointsChange.apply(this,arguments)}}),Gb.ShapeLink=function(a,b,c){this._points=new md,this._styleMap={},this._styleMap["link.bundle.enable"]=!1,Gb.ShapeLink.superClass.constructor.call(this,a,b,c)},Hb.ext("twaver.ShapeLink",Gb.Link,{_icon:Dd.ICON_SHAPELINK,getElementUIClass:function(){return Gb.network.ShapeLinkUI},getCanvasUIClass:function(){return Gb.canvas.ShapeLinkUI},getVectorUIClass:function(){return Gb.vector.ShapeLinkUI},getPoints:function(){return this._points},setPoints:function(a){a||(a=new md);var b=new md(this._points);this._points=a,this.firePointsChange(b,this._points)},addPoint:function(a,b){var c=new md(this._points);this._points.add(a,b),this.firePointsChange(c,this._points)},setPoint:function(a,b){var c=new md(this._points);this._points.set(a,b),this.firePointsChange(c,this._points)},removePoint:function(a){var b=new md(this._points);this._points.remove(a),this.firePointsChange(b,this._points)},removeAt:function(a){var b=new md(this._points);this._points.removeAt(a),this.firePointsChange(b,this._points)},firePointsChange:function(a,b){this.firePropertyChange("points",a,b)}}),Gb.ShapeSubNetwork=function(a){Gb.ShapeSubNetwork.superClass.constructor.call(this,a)},Hb.ext("twaver.ShapeSubNetwork",Gb.ShapeNode,{ISubNetwork:!0,_icon:Dd.ICON_SHAPESUBNETWORK,_checkLinkAgent:function(){Gb.ShapeSubNetwork.superClass._checkLinkAgent.call(this);for(var a=this.getChildrenSize(),b=0;a>b;b++){var c=this.getChildAt(b);c instanceof Ld&&c._checkLinkAgent()}}}),Gb.LinkSubNetwork=function(){Gb.LinkSubNetwork.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.LinkSubNetwork",Gb.Link,{ISubNetwork:!0,_icon:Dd.ICON_LINKSUBNETWORK}),Gb.ShapeLinkSubNetwork=function(){Gb.ShapeLinkSubNetwork.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.ShapeLinkSubNetwork",Gb.ShapeLink,{ISubNetwork:!0,_icon:Dd.ICON_LINKSUBNETWORK}),Gb.RotatableNode=function(a){Gb.RotatableNode.superClass.constructor.call(this,a)},Hb.ext("twaver.RotatableNode",Gb.Follower,{getWidth:function(){return 0==this._angle?this._getOrignalWidth():this._getRotateRect().width},setWidth:function(a){},getHeight:function(){return 0==this._angle?this._getOrignalHeight():this._getRotateRect().height},setHeight:function(a){},getElementUIClass:function(){return Gb.network.RotatableNodeUI},getCanvasUIClass:function(){return Gb.canvas.RotatableNodeUI},getVectorUIClass:function(){return Gb.vector.RotatableNodeUI},_getRotateRect:function(){for(var a=this._getOrignalWidth(),b=this._getOrignalHeight(),c=Rb.createMatrix(this._angle*Math.PI/180,a/2,b/2),d=[{x:0,y:0},{x:a,y:0},{x:a,y:b},{x:0,y:b}],e=0,f=d.length;f>e;e++)d[e]=c.transform(d[e]);return Rb.getRect(d)},_getOrignalWidth:function(){return Gb.RotatableNode.superClass.getWidth.call(this)},_getOrignalHeight:function(){return Gb.RotatableNode.superClass.getHeight.call(this)}}),Gb.controls.ControlBase=function(){Gb.controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new md},Hb.ext("twaver.controls.ControlBase",Gb.PropertyChangeDispatcher,{_autoAdjustBounds:!1,addPool:function(a){this._pools.contains(a)||this._pools.add(a)},removePool:function(a){this._pools.remove(a)},adjustBounds:function(a){var b=this._view.style;b.position="absolute",b.left=a.x+"px",b.top=a.y+"px",b.width=a.width+"px",b.height=a.height+"px",this._autoAdjustBounds===!0&&(b.left="0px",b.top="0px",b.right="0px",b.bottom="0px"),this.invalidate&&this.invalidate()},setAutoAdjustBounds:function(a){a===!0?Ub.addEventListener("resize","_handleResize",window,this):Ub.removeEventListener("resize",window,this),this._autoAdjustBounds=a},isAutoAdjustBounds:function(){return this._autoAdjustBounds},_handleResize:function(a){this.adjustBounds({x:0,y:0,width:Mb.documentElement.clientWidth,height:Mb.documentElement.clientHeight})},getView:function(){return this._view},invalidate:function(a){this._invalidate||(this._invalidate=!0,Hb.callLater(this.validate,this,null,a))},validate:function(){this._invalidate&&(this._invalidate=!1,0===this._view.offsetWidth&&0===this._view.offsetHeight&&null!==this._reinvalidateCount?(void 0===this._reinvalidateCount&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl())},validateImpl:function(){}}),Gb.controls.ViewBase=function(){Gb.controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new Gb.EventDispatcher,this._viewDispatcher=new Gb.EventDispatcher},Hb.ext("twaver.controls.ViewBase",Gb.controls.ControlBase,{__bool:["focusOnClick"],_focusOnClick:Dd.FOCUS_ON_CLICK,getSelectionModel:function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},isShareSelectionModel:function(){return null==this._selectionModel},setShareSelectionModel:function(a){var b=null==this._selectionModel;b!==a&&(a?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new Gb.SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",b,a))},onShareSelectionModelChanged:function(){},removeSelection:function(){if(0===this.getSelectionModel().size())return null;var a=this.getSelectionModel().toSelection();return this._box._undoManager._enabled&&this._box._undoManager.startBatch(),a.forEach(function(a){this._box.remove(a)},this),this._box._undoManager._enabled&&this._box._undoManager.endBatch(),a},selectAll:function(){var a=new md;return this._box.forEach(function(b){this.isVisible(b)&&a.add(b)},this),this.getSelectionModel().setSelection(a),a},isSelected:function(a){return this.getSelectionModel().contains(a)},isSelectable:function(a){return this.getSelectionModel().isSelectable(a)},getLabel:function(a){return a.getName()},getToolTip:function(a){return a.getToolTip()},getIcon:function(a){return a.getIcon()},getSelectColor:function(a){return Dd.SELECT_COLOR},addViewListener:function(a,b,c){this._viewDispatcher.add(a,b,c)},removeViewListener:function(a,b){this._viewDispatcher.remove(a,b)},fireViewEvent:function(a){this._viewDispatcher.fire(a)},addInteractionListener:function(a,b,c){this._interactionDispatcher.add(a,b,c)},removeInteractionListener:function(a,b){this._interactionDispatcher.remove(a,b)},fireInteractionEvent:function(a){this._interactionDispatcher.fire(a)},invalidate:function(a){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),Hb.callLater(this.validate,this,null,a))},validate:function(){this._invalidate&&(this._invalidate=!1,Kb||0!==this._view.offsetWidth||0!==this._view.offsetHeight||null===this._reinvalidateCount?(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating):(void 0===this._reinvalidateCount&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()))}}),Gb.controls.View=function(){Gb.controls.View.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.View",Gb.controls.ViewBase,{_zoom:1,_maxZoom:Dd.ZOOM_MAX,_minZoom:Dd.ZOOM_MIN,getRootDiv:function(){return this._rootDiv},isValidEvent:function(a){return Ub.isValidEvent(this._view,a)},getAlarmFillColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b)return b.color}return null},getInnerColor:function(a){if(a.IElement){var b=a.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:a.getStyle("inner.color")}return null},getOuterColor:function(a){if(a.IElement){var b=a.getAlarmState().getPropagateSeverity();return b?b.color:a.getStyle("outer.color")}return null},zoomOverview:function(a){var b=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(b,a)},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,this.getZoom(),this._rootDiv)},centerByLogicalPoint:function(a,b,c){c&&Gb.animate.AnimateManager.endAnimate();var d=this._view.scrollWidth-this._view.clientWidth,e=this._view.scrollHeight-this._view.clientHeight,f=(a-this._view.clientWidth/this._zoom/2)*this._zoom,g=(b-this._view.clientHeight/this._zoom/2)*this._zoom;0>f&&(f=0),0>g&&(g=0),f>d&&(f=d),g>e&&(g=e),c?Gb.animate.AnimateManager.start(new Gb.animate.AnimateScrollPosition(this._view,f,g)):(this._view.scrollLeft=f,this._view.scrollTop=g)},panByOffset:function(a,b){a*=this.getZoom(),b*=this.getZoom();var c=this._view.scrollLeft+a,d=this._view.scrollTop+b,e=this._view.scrollWidth-this._view.clientWidth,f=this._view.scrollHeight-this._view.clientHeight;0>c&&(c=0),c>e&&(c=e),0>d&&(d=0),d>f&&(d=f);var g={x:(c-this._view.scrollLeft)/this.getZoom(),y:(d-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=c,this._view.scrollTop=d,g},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(!(0>a)){var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getZoom()>a&&this.setZoom(a)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(!(0>a)){var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getZoom()<a&&this.setZoom(a,!1)}},getZoom:function(){return this._zoom},onZoomChanged:function(a,b){},zoomIn:function(a){this.setZoom(this._zoom*Dd.ZOOM_INCREMENT,a)},zoomOut:function(a){this.setZoom(this._zoom/Dd.ZOOM_INCREMENT,a)},zoomReset:function(a){this.setZoom(1,a)},checkZoom:function(a){return a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a},setZoom:function(a,b){if(Hb.num(a)&&!(0>=a)&&(a=this.checkZoom(a),a!==this._zoom))if(null==b&&(b=Dd.ZOOM_ANIMATE),b)Gb.animate.AnimateManager.start(new Gb.animate.AnimateZoom(this,a));else{var c=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,d=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,e=this._zoom;this._zoom=a,Ub.setZoom(this._rootDiv,a),this.firePropertyChange("zoom",e,a),this.onZoomChanged(e,a),this.centerByLogicalPoint(c,d,!1)}},setTouchZoom:function(a){this.setZoom(a,!1)}}),function(){var a=function(a,b,c,d){var e=new Nb;e.src=d,Gb.Util.registerImage(a,e,b,c)};a("subnetwork_image",64,46,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC"),a("bus_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC"),a("data_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg=="),a("databox_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII="),a("grid_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg=="),a("group_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg=="),a("group_image",32,29,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC"),a("link_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg=="),a("linksubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII="),a("node_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg=="),a("node_image",30,32,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII="),
a("shapelink_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII="),a("shapenode_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC"),a("shapesubnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII="),a("subnetwork_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII="),a=function(a,b,c,d){Gb.Util.registerImage(a,d,b,c)},a("expand_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw=="),a("collapse_icon",16,18,"data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7"),a("close_icon",11,11,"data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs="),a("sort_desc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs="),a("sort_asc",9,5,"data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs="),a("submenu_enable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAA7SURBVHjafI9BDgAgDMKqH3c/ryd1iTqOpARARQUYJG0/AWboB2yoAgTG8jtvtXvMSUdVEdXIeN2cAwDPLmAjfDYS7AAAAABJRU5ErkJggg=="),a("submenu_disable_icon",8,8,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABKSURBVHjafM9BDoAgDETRD1cTz0W9luDZxhUBCjpJkzZ9m0ESkrhLzW0fJ9JjpT4Zl+juBXmwoB0ACH/gOtNhX2B6AjDUtF3NdwAU6zx4LEQe5AAAAABJRU5ErkJggg=="),a("checkbox_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAflJREFUeNqkk09oE1EQxn+7btyIYBRCbayFtlhEtLeAin+KouDNo548eJHCQkFQC1K0Bw8VqT1EVIqo0IMUvejNg6AIIglSsdSCiA0WolaIOWi3+2fGw242CRFBHPjg8d7MfPO+mTEcxzkNDAF5/s1KwE0cxylWKhX1fV89r44gget6bVhd9bRcLqvjOEULyGezWTwvAMAwjIRCRAnD8I/0nZ05gLwZOTYeVBXQOIGgqgk+flrk3MUxVBWRyMeMw5oCG2eREFVBVZibf8+x4ydZLH9GVRISq5W5uXwhDKPSvnz9xolTZ/A29GNZFiJ1kjhBnVFVEw0a7MrQ8HlqbMZwXeYXlpL7ti/Usbz8Hd8PEBGmHzxk9kMVfI+BrWt4PHM/0abtC67r8vTZC4qlWY4c2s/Azh2MTxQwpIPduzZx99Z1bNtu1yBiFp6/fMXr4ht+/NzI+MQNBg/sxdccPbmAqcI1UqkUEresTQMR5ejhQbb19XJ25BJzC8Lbd3dIp22mCtPY9tokuDmB2VyBqtDb082VyxdYv26JXysrTF4dY0uuI3lvoKWCaOoMA1SF7q4u7t2eZObREw7u25MMTbPF8VGCqHNRB4IgQFXY3t/H6MhwLFirGYZBfeItoFSr1fKZTAbVaPbT6fRf19A0TarVKkDJ+N91/j0A8Y5o3Yt7KRAAAAAASUVORK5CYII="),a("checkbox_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAiUlEQVR42qXM3QYFIRiF4d3dJpIhI5FKJCOSSHe7f9gn4ztZo3Wwzt6HvTbHfhdCeD8Nvw27Ad57OI4xUsA5BwMpJQpYa2Eg50wBYwwMlFIocJ4nDFzXRQGtNQzUWilwHAcMtNYooJSCgd47BaSUMDDGoIAQAgbmnBTgnMPAWosCcP3fDdjZNvABvRhVEQglsV8AAAAASUVORK5CYII="),a("radiobutton_selected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNrUUz9rwkAUv0syBVxMm01L2lIdilOg4BcQ7eKcIV/AqZAxo1/B2a/QoSSTH6AQCoFMJUSig5C0EiPEv8G+Z604eJNTHxz37vf73Y977+7obrcjlwRHLoyLDYTThWmav6AgKDA9wrg6UF8wvO12O8RFt9s9bwACwvP8U6lUajWbzbYsy/eIR1Hk27b9GgSBlef5O7OEzWZzC5ufNU17gc01gEQcmCOGHGqYJaxWq1qj0WhzHFfwfZ84jrPHVVUliqIUkPM87wOg4KzBcrm8liTpbr1ek8FgQNI03eOz2Yzouk6QQw3zBFmWUewDxnQ6JUmSHHsDRz9qmD0A8ns8HgcortfrRxxzxJBDDfMEi8XC7ff7b4Zh3FSr1UKlUtnjlFI0mCOHGqZBHMd+GIbWZDIROp1OCxqH74HA9Q17vZ7luq4liqJ/uoee/oVyufxX/wPctwqpfKAieB9OsVj8xMVoNDpv8D8/048AAwDskrF8QGeJUgAAAABJRU5ErkJggg=="),a("radiobutton_unselected_icon",16,16,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATVJREFUeNrUU71qhEAQ9q8S0mhip3C5kCpcFcgjiJfmal/BKr2lr2DtK1wR9BkCaYRUQTzUQtDE5sB/MTOJAQs3jVUGhp2Z75vPnV2XHseRWmMMtdJWC3DzxDTNnyLHbWC5A7+coA/wt77vT5hYlrUsAASKZdkHWZb3mqYdJEm6wXqWZYHneccwDN1hGF6II3Rddw3Nj7quP0HzDko8OsZYQww5RIGmaXaqqh4YhrnA3cwda4ghh3gGdV1fiaK4bdt28cAQQw5RoCxLGr/2lyGHOAKAn0mShDAnteSIIYcoUFWV7zjOM5DPuJPfxik+I4Yc4gh5ngdRFLlpmnKGYew3YFiH6zvZtu36vu/yPB/Me+j5W1AU5XstiuIW7vseQmmCMvg/XgVBeMckjuNlgf/5mL4EGAAhHbltcqEYDQAAAABJRU5ErkJggg=="),a("right_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjJGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjNGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE5MUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE5MkZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqPQWR4AAABJSURBVHjaYvT08vrPwMAgCsQM27ZufcMABUxQ+jWI8PL2FkGXwJBElkCRRJeAS2KTAEvikhDFJiGKzSi4f5iwCSLrwPA5QIABAAmgFhOOHdKvAAAAAElFTkSuQmCC"),a("left_expand_icon",6,11,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAALCAYAAABcUvyWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0ZBRTFFQjZGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0ZBRTFFQjdGQjA1MTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3RkFFMUVCNEZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3RkFFMUVCNUZCMDUxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PmpWGHAAAABISURBVHjaYvz//z8DDHh5e4tAma+ZsAmCCCZsgiDAfOr0aQxBuA50QZgEhiBMQhSXBAM2SaZtW7e+wSYJ1oFNEu5BdEmAAAMAvV8Xc/cw3YgAAAAASUVORK5CYII="),a("up_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEZGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOTBGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpCMzYzQTE4REZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpCMzYzQTE4RUZBRkYxMUU1QTkzQ0IwMDAxMkFFRkI2OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnCNygcAAABGSURBVHjaYvz//z8DDHh5e4tAma+BWBTE2LZ16xuYPBMOhXAaSRyiGItCBmwaGD29vHApRAaiyM7ApxAuz0SEQrgGgAADALOxFSETkKKwAAAAAElFTkSuQmCC"),a("down_expand_icon",11,6,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0xpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QjM2M0ExOENGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QjM2M0ExOEJGQUZGMTFFNUE5M0NCMDAwMTJBRUZCNjkiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIgc3RSZWY6ZG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOjQ5ZTRmZmE2LTQzNmYtMTE3OS04NThhLTk1ZGZjOWRiNmNiOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtPgXX8AAAA7SURBVHjaYvH08vrPQCRgAmJRItWKMsEYhBSCTd62desbAhrA4iB1TDAGDg2iyPIwZ2DTIIomzgAQYAAmahUFv1Iq6AAAAABJRU5ErkJggg==")}(),Pb.__tree=function(a,b){a._rootVisible=!0,a._initTree=function(a){this._rootData=null,this._expandMap={},this._levelMap={}},a.validateModel=function(){this._rowDatas.clear(),this._levelMap={},this._dataRowMap={},this._currentLevel=0,this._rootData?this._rootVisible?this.isVisible(this._rootData)&&this._buildData(this._rootData):this._buildChildren(this._rootData):this._buildChildren(),delete this._currentLevel},a._buildData=function(a){this._dataRowMap[a.getId()]=this._rowDatas.size(),this._rowDatas.add(a),this._levelMap[a.getId()]=this._currentLevel,this.isExpanded(a)&&(this._currentLevel++,this._buildChildren(a),this._currentLevel--)},a._buildChildren=function(a){var b=a?a.getChildren():this._box.getRoots(),c=this.getCurrentSortFunction();c&&this.isChildrenSortable(a)?b.toList(this.isVisible,this).sort(c).forEach(function(a){this._buildData(a)},this):b.forEach(function(a){this.isVisible(a)&&this._buildData(a)},this)},a.getLevel=function(a){return this._levelMap[a.getId()]},a.getToggleImage=function(a){return a.getChildrenSize()>0?this.isExpanded(a)?this._expandIcon:this._collapseIcon:null},a.isCheckable=function(a){return this.isCheckMode()},a.isCheckMode=function(){return 1===Pb.__tree._checkMap[this._checkMode]},a.isChildrenSortable=function(a){return!0},a.handleDataBoxChange=function(a){"remove"===a.kind?delete this._expandMap[a.data.getId()]:"clear"===a.kind&&(this._expandMap={}),this.invalidateModel()},a.isExpanded=function(a){return 1===this._expandMap[a.getId()]},a.expand=function(a){if(!this.isExpanded(a)){for(var b=a.getParent();null!=b&&b!==this._rootData;)this._expandMap[b.getId()]=1,b=b.getParent();this._expandMap[a.getId()]=1,this.invalidateModel()}},a.collapse=function(a){this.isExpanded(a)&&(delete this._expandMap[a.getId()],this.invalidateModel())},a.expandAll=function(){this._box.forEach(function(a){this._expandMap[a.getId()]=1},this),this.invalidateModel()},a.collapseAll=function(){this._expandMap={},this.invalidateModel()},a._handleClick=function(a){if(this.isFocusOnClick()&&Gb.Util.setFocus(this._view),!this._isValidating){var b;if(a.target._expandData&&!a.target.ableExpand)b=a.target._expandData,this.isExpanded(b)?(this.collapse(b),this.fireInteractionEvent({kind:"collapse",data:b})):(this.expand(b),this.fireInteractionEvent({kind:"expand",data:b}));else if(a.target._selectData||a.target.parentNode._selectData){if(this._handlePressSelection(a.target._selectData||a.target.parentNode._selectData,a),this.isCheckMode()){var c=this.getRowIndexAt(a);c>=0&&this.__handleClick(a)}}else this._treeColumn?(b=this.getDataAt(a),b&&(this.isCheckMode()?a.target._checkData||this.__handleClick(a):this._handlePressSelection(b,a))):this.isCheckMode()&&!a.target._checkData&&this.__handleClick(a);if(this._currentEditor&&!this._isCommitting&&(this._isCommitting=!0,this.commitEditValue(this._currentEditor._editInfo,this._currentEditor)),this.updateCurrentEditor){var d=this;setTimeout(function(){d.updateCurrentEditor(a)},0)}}},a.__handleClick=function(a){var b=this.getDataAt(a);if(b){var c=this.getRowIndexByData(b);if(this._focusedRow!==c){var d=this._rowDatas.get(this._focusedRow);this._focusedRow=c,d&&this.invalidateData(d),this.invalidateData(b)}}},a._handleDoubleClick=function(a){if(this.isFocusOnClick()&&Gb.Util.setFocus(this._view),!this._isValidating){var b;a.target.ableExpand&&a.target._expandData&&(b=a.target._expandData,this.isExpanded(b)?(this.collapse(b),this.fireInteractionEvent({kind:"collapse",data:b})):(this.expand(b),this.fireInteractionEvent({kind:"expand",data:b})))}},a.handleChange=function(a){if(!(this._isCommitting||this._isCanceling||this._isValidating)){var b=a.target._checkData;if(b){var c,d=this.isSelected(b),e=this.getSelectionModel();if("default"===this._checkMode)d?e.removeSelection(b):e.appendSelection(b);else if("children"===this._checkMode)c=new md(b),c.addAll(b.getChildren());else if("descendant"===this._checkMode)c=new md,Hb.fillDescendant(b,c);else if("descendantAncestor"===this._checkMode&&(c=new md,Hb.fillDescendant(b,c),!d))for(var f=b.getParent();f;)c.add(f),f=f.getParent();d?e.removeSelection(c):e.appendSelection(c)}a.target._editInfo&&this.commitEditValue&&(this._isCommitting=!0,this.commitEditValue(a.target._editInfo,a.target))}},a.onLabelRendered=function(a,b,c,d,e,f){},a.onToggleImageRendered=function(a){},a._renderTree=function(a,b,c,d){var e=this._levelMap[b.getId()],f=this.getToggleImage(b),g=this.getLineType(),h=this._indent,i=this.__spanPool.get();i.style.display="inline-block",i.style.position="relative",i.style.verticalAlign="top",i.style.margin="0px 1px 0px 1px",i.style.width=(e+1)*h+"px",a.appendChild(i);var j=b,k=j.getParent(),l=0;if("dotted"===g||"solid"===g){if(null==k){var m=this.getIcon(b);this._addLine(i,b,m,!0)}for(;null!==k;){var n=k.getChildren(),o=j===n.get(n.size()-1),m=this.getIcon(j);j.setClient("isLast",o),0==l&&this._addLine(i,b,m,o),l++,j=k,k=k.getParent()}}if(f){var p=this.__imagePool.get();p.setAttribute("src",Hb.getImageSrc(f)),p.style.verticalAlign="middle",p._expandData=b,p.style.position="absolute",p.style.right="0px";var q=this;p.onload=function(){p.style.top=q.getRowHeight()/2-p.height/2+"px"},i.appendChild(p),this.onToggleImageRendered(p)}var r=this.isCheckable(b),s="disabled"===this.getUncheckableStyle();if(r||s){var t=this._addCheckBox(a,b,d);t.disabled=!r}var m=this.getIcon(b);if(m){var u=this.isCheckMode()||this._treeColumn?null:b;this._addIcon(a,b,m,u)}var v=this.getLabel(b);v&&(i=this.__textPool.get(),i.style.whiteSpace="nowrap",i.style.verticalAlign="middle",i.style.padding="1px 2px 1px 2px",Hb.setText(i,v,this._treeColumn?this._treeColumn.isInnerText():this._innerText),f&&(i._expandData=b,i.ableExpand=!0),this.isCheckMode()||this._treeColumn?this._focusedRow===c&&(i.style.backgroundColor=this.getSelectColor(b)):(i._selectData=b,i.style.backgroundColor=d?this.getSelectColor(b):""),this.onLabelRendered(i,b,v,c,e,d),a.appendChild(i),a.title=this.getToolTip(b))}},Pb.__tree._checkMap={"default":1,children:1,descendant:1,descendantAncestor:1},Gb.Column=function(a){Gb.Column.superClass.constructor.call(this,a)},Hb.ext("twaver.Column",Gb.Data,{IColumn:!0,__property:1,__accessor:["width","horizontalAlign","valueType","propertyType","propertyName","editable","visible","sortable","resizable","movable","sortDirection","sortFunction","enumInfo"],__bool:["innerText"],_innerText:Dd.COLUMN_INNER_TEXT,_width:Dd.COLUMN_WIDTH,_horizontalAlign:Dd.COLUMN_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Dd.COLUMN_PROPERTY_TYPE,_valueType:Dd.COLUMN_VALUE_TYPE,_editable:Dd.COLUMN_EDITABLE,_sortable:Dd.COLUMN_SORTABLE,_visible:Dd.COLUMN_VISIBLE,_resizable:Dd.COLUMN_RESIZABLE,_movable:Dd.COLUMN_MOVABLE,_sortDirection:"asc",_sortFunction:Dd.SORT_FUNCTION,_enumInfo:null,renderCell:Dd.COLUMN_RENDER_CELL,renderHeader:Dd.COLUMN_RENDER_HEADER,renderEditor:Dd.COLUMN_RENDER_EDITOR,setParent:function(a){throw"parent not supported"},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0;

}}),Gb.ColumnBox=function(a){Gb.ColumnBox.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.ColumnBox",Gb.DataBox,{_name:"ColumnBox",add:function(a,b){if(!a.IColumn)throw"Only IColumn can be added into ColumnBox";Gb.ColumnBox.superClass.add.apply(this,arguments)}}),Gb.Property=function(a){Gb.Property.superClass.constructor.call(this,a)},Hb.ext("twaver.Property",Gb.Data,{IProperty:!0,__property:1,__accessor:["horizontalAlign","valueType","editable","propertyType","propertyName","categoryName","enumInfo"],__bool:["innerText"],_innerText:Dd.PROPERTY_INNER_TEXT,_horizontalAlign:Dd.PROPERTY_HORIZONTAL_ALIGN,_propertyName:null,_propertyType:Dd.PROPERTY_PROPERTY_TYPE,_valueType:Dd.PROPERTY_VALUE_TYPE,_editable:Dd.PROPERTY_EDITABLE,_categoryName:Dd.PROPERTY_CATEGORY_NAME,_enumInfo:null,renderName:Dd.PROPERTY_RENDER_NAME,renderValue:Dd.PROPERTY_RENDER_VALUE,isVisible:null,renderEditor:Dd.PROPERTY_RENDER_EDITOR,setParent:function(a){throw"parent not supported"},setPropertyName:function(a){var b=this._propertyName;this._propertyName=a,this.firePropertyChange("propertyName",b,a)},setPropertyType:function(a){var b=this._propertyType;this._propertyType=a,this.firePropertyChange("propertyType",b,a)},getEnumInfo:function(){return"object"==typeof this._enumInfo?this._enumInfo:"function"==typeof this._enumInfo?1===arguments.length?this._enumInfo(arguments[0]):this._enumInfo():void 0}}),Gb.PropertyBox=function(a){Gb.PropertyBox.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.PropertyBox",Gb.DataBox,{_name:"PropertyBox",add:function(a,b){if(!a.IProperty)throw"Only IProperty can be added into PropertyBox";Gb.PropertyBox.superClass.add.apply(this,arguments)}}),Gb.Tab=function(a){Gb.Tab.superClass.constructor.call(this,a)},Hb.ext("twaver.Tab",Gb.Data,{ITab:!0,__accessor:["view","width","closable","resizable","movable","disabled","visible"],_icon:null,_width:Dd.TAB_WIDTH,_closable:Dd.TAB_CLOSABLE,_resizable:Dd.TAB_RESIZABLE,_movable:Dd.TAB_MOVABLE,_disabled:Dd.TAB_DISABLED,_visible:Dd.TAB_VISIBLE,setParent:function(a){throw"parent not supported"}}),Gb.TabBox=function(a){Gb.TabBox.superClass.constructor.apply(this,arguments),this.getSelectionModel().setSelectionMode("singleSelection")},Hb.ext("twaver.TabBox",Gb.DataBox,{_name:"TabBox",add:function(a,b){if(!a.ITab)throw"Only ITab can be added into TabBox";Gb.TabBox.superClass.add.apply(this,arguments)}}),Gb.controls.ListBase=function(a){Gb.controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new md,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new Gb.Pool("div",20),this.__imagePool=new Gb.Pool("img",20),this.__canvasPool=new Gb.Pool("canvas",20),this.__spanPool=new Gb.Pool("span",20),this.__textPool=new Gb.Pool("span",20),this.__checkBoxPool=new Gb.Pool("input",20),this.__linePool=new Gb.Pool("canvas",20),this._pools.add(this.__divPool),this._pools.add(this.__linePool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=Ub.createView("auto",!0),this._rootDiv=Ub.createDiv(),this._dataDiv=Ub.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new Gb.DataBox);var b=this;b.handleChange&&b._view.addEventListener("change",function(a){b.handleChange(a)},!1),Ob.isTouchable?Ob.isMSTouchable?new Gb.controls.ListBaseMSTouchInteraction(this):(new Gb.controls.ListBaseTouchInteraction(this),new Gb.controls.ListBaseInteraction(this)):new Gb.controls.ListBaseInteraction(this)},Hb.ext("twaver.controls.ListBase",Gb.controls.View,{__bool:["innerText"],_innerText:Dd.LISTBASE_INNER_TEXT,getDataDiv:function(){return this._dataDiv},getStartRowIndex:function(){return this._startRowIndex},getEndRowIndex:function(){return this._endRowIndex},getRowDatas:function(){return this._rowDatas},getRowIndexByData:function(a){return this._dataRowMap[a.getId()]},getRowIndexById:function(a){return this._dataRowMap[a]},getRowSize:function(){return this._rowDatas.size()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)}},onPropertyChanged:function(a){"zoom"===a.property?this.invalidate():this.invalidateModel()},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},invalidateData:function(a){this._invalidateDisplay||(this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[a.getId()]=a,this.invalidate())},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},Ub.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var c;if(this._invalidateDatas){for(c in this._invalidateDatas){var d=this._renderMap[c];d&&(Ub.release(d),this._dataDiv.removeChild(d),delete this._renderMap[c])}this._invalidateDatas=null}var e=this._view.scrollTop/this._zoom,f=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(e/this._rowHeight)-2,this._endRowIndex=Math.ceil((e+f)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());for(var g=this._rowHeight-this._rowLineWidth-2+"px",h=this._rowLineWidth+"px",i=this._startRowIndex;i<this._endRowIndex;i++){var j=this._rowDatas.get(i);c=j.getId();var k=this._renderMap[c];if(!k){k=this.__divPool.get();var l=k.style;l.position="absolute",l.whiteSpace="nowrap",l.lineHeight=g,l.top=i*this._rowHeight+"px",l.borderStyle="solid",l.borderWidth="0px",l.borderBottomWidth=h,l.borderBottomColor=this._rowLineColor,l.opacity=j.getStyle?j.getStyle("whole.alpha"):1,this._dataDiv.appendChild(k),this._renderMap[c]=k;var m=this.isSelected(j);this.renderData(k,j,i,m),this.onDataRendered(k,j,i,m)}}this._dataDiv.style.width=this.calculateSumWidth()+"px","0px"===this._dataDiv.style.height&&(this._dataDiv.style.height="1px"),Hb.keys(this._renderMap).forEach(function(a){var b=this.getRowIndexById(a);if(b<this._startRowIndex||b>=this._endRowIndex){var c=this._renderMap[a];Ub.release(c),this._dataDiv.removeChild(c),delete this._renderMap[a]}},this),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b),this.adjustRowSize(),this.onValidated()},adjustRowSize:function(){var a,b,c=this._rowHeight-this._rowLineWidth+"px",d=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(a in this._renderMap)b=this._renderMap[a],b.style.height=c,b.style.width=d},onValidated:function(){},onDataRendered:function(a,b,c,d){},calculateSumWidth:function(){return 0},_addCheckBox:function(a,b,c){var d=this.__checkBoxPool.get();return d.keepDefault=!0,d.type="checkbox",d.style.margin="0px 2px",d.style.verticalAlign="middle",d._checkData=b,d.checked=c,d.disabled=!1,a.appendChild(d),d},_addIcon:function(a,b,c,d){var e,f=Hb.getImageAsset(c),g=this.getInnerColor(b),h=this.getOuterColor(b),i=this.getAlarmFillColor(b);if(f&&f.getImage()){var j=f.getWidth(),k=f.getHeight();e=this.__canvasPool.get(),e.style.verticalAlign="middle",e.setAttribute("width",j),e.setAttribute("height",k);var l=e.getContext("2d");l.clearRect(0,0,j,k);var m={x:0,y:0,width:j,height:k};Mc(l,c,g,m,b,this),h&&(l.lineWidth=2,l.strokeStyle=h,l.beginPath(),l.rect(0,0,j,k),l.closePath(),l.stroke()),i&&(l.fillStyle=Vb.createRadialGradient(l,i,"white",1,k-9,8,8,.75,.25),l.beginPath(),l.arc(5,k-5,4,0,2*Math.PI,!0),l.closePath(),l.fill())}else e=this.__imagePool.get(),e.style.verticalAlign="middle",e.setAttribute("src",Hb.getImageSrc(c));e.style.margin="0px 1px 0px 1px",e._selectData=d,a.appendChild(e)},_addLine:function(a,b,c,d){{var e,f,g=this.__linePool.get(),h=Hb.getImageAsset(c),i=this.getToggleImage(b),j=this._levelMap[b.getId()],k=this._indent,l=k,m=k,n=0;this.isCheckable(b),"disabled"===this.getUncheckableStyle()}n=2,h&&(l=h.getWidth(),m=h.getHeight()),e=(j+n-1)*k+l,f=this.getRowHeight(),a.style.width=(j+n-1)*k+l+"px",a.style.height=f+m+"px";{var o=this.getLineType(),p=this.getLineColor(),q=this.getLineAlpha(),r=this.getLineThickness(),s=this.getLineDash();Hb.getImageSrc(i)}g.style.verticalAlign="top",g.style.margin="0px 0px 0px 0px",g.style.zIndex=-1,g.setAttribute("width",e),g.setAttribute("height",f);var t=g.getContext("2d");t.lineWidth=r,t.strokeStyle=p,t.globalAlpha=q,"dotted"===o&&t.setLineDash(s);var u=2*(j+n);if(d){var v=b,w=v.getParent();t.clearRect(0,0,e,f);null===w&&0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((j+n+1)*e/u,f/2+m/2),t.lineTo((j+n+1)*e/u,f),t.stroke());for(var x=2*j-1;x>=1;x-=2){if(v.getClient("isLast")){if(v=w,w=v.getParent(),(x+1)/2!=j)continue}else v=w,w=v.getParent();x==2*j-1?(t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f/2),t.stroke(),t.moveTo((x+n)*e/u,f/2),t.lineTo((x+n+1)*e/u,f/2),t.stroke(),0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((x+n+2)*e/u,f/2+m/2),t.lineTo((x+n+2)*e/u,f),t.stroke())):(t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f),t.stroke())}}else{var v=b,w=v.getParent();t.clearRect(0,0,e,f);for(var x=2*j-1;x>=1;x-=2){if(v.getClient("isLast")){if(v=w,w=v.getParent(),(x+1)/2!=j)continue}else v=w,w=v.getParent();t.moveTo((x+n)*e/u,0),t.lineTo((x+n)*e/u,f),t.stroke(),x==2*j-1&&(t.moveTo((x+n)*e/u,f/2),t.lineTo((x+n+1)*e/u,f/2),t.stroke(),0!==b.getChildrenSize()&&this.isExpanded(b)&&(t.moveTo((x+n+2)*e/u,f/2+m/2),t.lineTo((x+n+2)*e/u,f),t.stroke()))}}return a.appendChild(g),g},isVisible:function(a){return this._box.contains(a)?this._visibleFunction?this._visibleFunction(a):!0:!1},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){"parent"===a.property?this.invalidateModel():this.invalidateData(a.source)},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){a.datas.forEach(function(a){this.invalidateData(a)},this),this.onSelectionChanged(a)},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowDatas.size()?c:-1},getDataAt:function(a){var b=this.getRowIndexAt(a);return b>=0?this._rowDatas.get(b):null},getCurrentSortFunction:function(){return this._sortFunction},validateModel:function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var a=this.getCurrentSortFunction();a&&this._rowDatas.sort(a);for(var b=this._rowDatas.size(),c=0;b>c;c++)this._dataRowMap[this._rowDatas.get(c).getId()]=c},_buildChildren:function(a){a.forEach(function(a){this._rowDatas.add(a),this._buildChildren(a.getChildren())},this)},_handlePressSelection:function(a,b){var c=this.getSelectionModel();if(Hb.isCtrlDown(b))c.contains(a)?c.removeSelection(a):c.appendSelection(a);else if(b.shiftKey&&c.getLastData()){var d=c.getLastData(),e=this.getRowIndexByData(d),f=this.getRowIndexByData(a),g=new md;for(g.add(this.getRowDatas().get(e));e!==f;)e+=f>e?1:-1,g.add(this.getRowDatas().get(e));c.setSelection(g)}else 1===c.size()&&c.contains(a)||c.setSelection(a);this.fireInteractionEvent({kind:2===b.detail?"doubleClick":"click",data:a})},_handleDoubleClick:function(a){var b=this.getDataAt(a);this.fireInteractionEvent({kind:2===a.detail?"doubleClick":"click",data:b})},_handleClick:function(a){this.isFocusOnClick()&&Gb.Util.setFocus(this._view);var b=this.getDataAt(a);if(b){if(this.isCheckMode()&&!a.target._checkData){var c=this.getRowIndexByData(b);if(this._focusedRow!==c){var d=this._rowDatas.get(this._focusedRow);this._focusedRow=c,d&&this.invalidateData(d),this.invalidateData(b)}}this.isCheckMode()||this._handlePressSelection(b,a)}if(this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor){var e=this;setTimeout(function(){e.updateCurrentEditor(a)},0)}},handleChange:function(a){if(!this._isCanceling&&!this._isValidating){var b=a.target._checkData;if(b){var c=this.isSelected(b),d=this.getSelectionModel();c?d.removeSelection(b):d.appendSelection(b)}a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)}},scrollToData:function(a){if(a){var b=this.getRowIndexById(a.getId());if(!(0>b)){var c=b*this._rowHeight*this._zoom,d=c+this._rowHeight*this._zoom,e=this._view.scrollTop;this._view.scrollTop>c&&(e=c),this._view.scrollTop+this._view.clientHeight<d&&(e=d-this._view.clientHeight),this._view.scrollTop!=e&&(this._view.scrollTop=e,this.invalidate())}}},makeVisible:function(a){this.isVisible(a)&&(this.expand&&this.expand(a),Hb.callLater(this.scrollToData,this,[a],2*Dd.CALL_LATER_DELAY))},onSelectionChanged:function(a){this._makeVisibleOnSelected&&("append"===a.kind||"set"===a.kind||"all"===a.kind)&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(a){a.getParent()&&this.expand(a.getParent())},this),Hb.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],2*Dd.CALL_LATER_DELAY))},onShareSelectionModelChanged:function(){this.invalidateModel()}}),Gb.controls.TableBase=function(a){this._columnBox=new Gb.ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),Gb.controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new Gb.Pool("div",20),this._stringPool=new Gb.Pool("span",20),this._booleanPool=new Gb.Pool("input",20),this._colorPool=new Gb.Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool)},Hb.ext("twaver.controls.TableBase",Gb.controls.ListBase,{getColumnBox:function(){return this._columnBox},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){a.source!==this._sortColumn||"sortDirection"!==a.property&&"sortFunction"!==a.property&&"sortable"!==a.property?this.invalidateDisplay():this.invalidateModel()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},renderData:function(a,b,c,d){for(var e,f=this._columnBox.getRoots(),g=f.size(),h=0,i=this._rowHeight-this._rowLineWidth+"px",j=0;g>j;j++){var k=f.get(j),l=k.getWidth();0>l&&(l=0);var m=Math.min(this._columnLineWidth,l);if(k.isVisible()){var n=this._cellPool.get();e=n.style,e.position="absolute",e.whiteSpace="nowrap",e.verticalAlign="middle",e.textAlign=k.getHorizontalAlign(),e.overflow="hidden",e.textOverflow="ellipsis",e.left=h+"px",e.width=l-m+"px",e.height=i,e.borderStyle="solid",e.borderWidth="0px",e.borderRightWidth=m+"px",e.borderRightColor=this._columnLineColor,0===j?(e.borderLeftWidth=m+"px",e.borderLeftColor=this._columnLineColor):e.borderLeftWidth="0px",a.appendChild(n);var o={data:b,value:this.getValue(b,k),div:n,view:this,column:k,rowIndex:c,selected:d};this.renderCell(o),this.onCellRendered(o),h+=l}}e=a.style,e.width=h+"px",e.height=i,e.backgroundColor=this.isCheckMode()&&this._focusedRow===c||!this.isCheckMode()&&d?this.getSelectColor(b):""},adjustRowSize:function(){},onCellRendered:function(a){},calculateSumWidth:function(){for(var a=this._columnBox.getRoots(),b=a.size(),c=0,d=0;b>d;d++){var e=a.get(d),f=e.getWidth();0>f&&(f=0),c+=f}return c},getCurrentSortFunction:function(){var a=this._sortColumn;if(a){var b=a.getSortFunction();if(b){var c=this,d="asc"===a.getSortDirection()?1:-1;return function(e,f){var g=c.getValue(e,a),h=c.getValue(f,a);return b.call(c,g,h,e,f)*d}}}return this._sortFunction},renderCell:function(a){var b=a.column;if(b.renderCell)return void b.renderCell(a);var c=a.value,d=b.getEnumInfo(a.rowIndex);d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.div._editInfo=a),zc.render(b.getValueType(),c,a.div,a.view,b.isInnerText())},getValue:function(a,b){return b.getValue(a,this)},setValue:function(a,b,c){b.setValue(a,c,this)},getColumnAt:function(a){var b=this.getLogicalPoint(a);if(!b)return null;for(var c=this._columnBox.getRoots(),d=0,e=c.size(),f=0;e>d;d++){var g=c.get(d),h=g.getWidth();if(0>h&&(h=0),b.x>f&&b.x<f+h)return g;f+=h}return null},isCellEditable:function(a,b){return this.isEditable()&&b.isEditable()},commitEditValue:function(a,b){if(!this._isCanceling){var c;c="checkbox"===b.type?b.checked:b.value;var d=a.column,e=d.getValueType();if("int"===e&&"string"==typeof c)c=parseInt(c);else if("number"===e&&"string"==typeof c)c=parseFloat(c);else if("list.points"===e){for(var f=c.replace(/\]/g,"").replace(/\[/g,"").split(","),g=new Gb.List,h=0;h<f.length;h+=2)h+1>=f.length||g.add({x:parseInt(f[h]),y:parseInt(f[h+1])});c=g}if(this.setValue(a.data,d,c),this._currentEditor){var i=this._currentEditor.parentNode,j=this._currentEditor;delete this._currentEditor,i&&i.removeChild(j),Gb.Util.setFocus(this._view)}delete this._isCommitting}},cancelEditing:function(){if(this._currentEditor){this._isCanceling=!0;var a=this._currentEditor.parentNode,b=this._currentEditor;delete this._currentEditor,a&&a.removeChild(b),Gb.Util.setFocus(this._view),delete this._isCanceling}},renderEditor:function(a){},onEditorRendered:function(a){},getEditorValue:function(a){var b=a.column.getValueType(),c=a.value,d="";if("list.points"===b){var e=c._as?c._as:c;e.forEach(function(a,b){d+=b==e.length-1?"["+a.x+","+a.y+"]":"["+a.x+","+a.y+"],"})}else d=c;return d},updateCurrentEditor:function(a){var b=a.target;if(b!==this._currentEditor&&b.parentNode!==this._currentEditor){for(var c;b&&b!==this._view&&!(c=b._editInfo);)b=b.parentNode;if(c&&b===c.div){var d=this.renderEditor&&this.renderEditor(c);d?(this._currentEditor=d.view,null!=c.value&&(this._currentEditor.value=this.getEditorValue(c))):c.enumInfo?this._currentEditor=Ub.createSelect(c.enumInfo,c.value):(this._currentEditor=Mb.createElement("input"),null!=c.value&&(this._currentEditor.value=this.getEditorValue(c)));var e=this;if(c.column&&c.column.renderEditor){var d="function"==typeof c.column.renderEditor?c.column.renderEditor(e,c):c.column.renderEditor;d&&(e._currentEditor=d)}if(this._currentEditor){if(d&&d.onKeyDown){var f=d.onKeyDown;f&&Array.isArray(f)&&e._currentEditor.addEventListener("keydown",function(a){for(var b=0;b<f.length;b++)if(f[b].combKey){var c=null;switch(f[b].combKey){case"ctrlKey":c=a.ctrlKey;break;case"shiftKey":c=a.shiftKey;break;case"altKey":c=a.altKey}a.keyCode===f[b].keyCode&&c&&f[b].handlerEvent&&f[b].handlerEvent(a)}else a.keyCode===f[b].keyCode&&f[b].handlerEvent&&f[b].handlerEvent(a)})}else this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;13===a.keyCode&&a.shiftKey||(13===a.keyCode?b.commitEditValue(a.target._editInfo,a.target):27===a.keyCode&&b.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;b._isCanceling||b.commitEditValue(a.target._editInfo,a.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=c,!this._currentEditor.parentNode){var g=this._currentEditor.style;g.position="absolute",g.margin="0px",g.border="0px",g.padding="0px",g.left=c.div.style.left,g.top=c.div.parentNode.style.top,g.width=c.div.style.width,g.height=c.div.style.height,this._rootDiv.appendChild(this._currentEditor)}Gb.Util.setFocus(this._currentEditor)}}}},onColumnSorted:function(a){},getCurrentEditor:function(){return this._currentEditor}}),Gb.controls.List=function(a){Gb.controls.List.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.List",Gb.controls.ListBase,{__accessor:["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],__bool:["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_rowHeight:Dd.LIST_ROW_HEIGHT,_indent:Dd.LIST_INDENT,_rowLineWidth:Dd.LIST_ROW_LINE_WIDTH,_rowLineColor:Dd.LIST_ROW_LINE_COLOR,_makeVisibleOnSelected:Dd.LIST_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.LIST_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.LIST_KEYBOARD_SELECT_ENABLED,isCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},isCheckable:function(a){return this._checkMode===!0},renderData:function(a,b,c,d){var e;this._indent>0&&(e=this.__spanPool.get(),e.style.width=this._indent+"px",e.style.display="inline-block",a.appendChild(e));var f=this.isCheckable(b);f&&this._addCheckBox(a,b,d);var g=this.getIcon(b);g&&this._addIcon(a,b,g);var h=this.getLabel(b);if(h){e=this.__textPool.get();var i=e.style;i.whiteSpace="nowrap",i.verticalAlign="middle",i.padding="1px 2px 1px 2px",i.display="inline-block",Hb.setText(e,h,this._innerText),this.onLabelRendered(e,b,h,c,d),a.appendChild(e)}a.style.backgroundColor=this.isCheckMode()?this._focusedRow===c?this.getSelectColor(b):"":d?this.getSelectColor(b):""},onLabelRendered:function(a,b,c,d,e){}}),Gb.controls.ListBaseInteraction=function(a){this.listBase=a,this.view=a._view,this.clickTimer=0,this.doubleClickInterval=300;var b=this;this.view.addEventListener("scroll",function(a){b.handleScroll(a)},!1),this.view.addEventListener("mouseup",function(a){b.handleMouseUp(a)},!1),this.view.addEventListener("keydown",function(a){b.handleKeyDown(a)},!1)},Hb.ext("twaver.controls.ListBaseInteraction",Object,{handleMouseUp:function(a){var b=this.listBase,c=this;a.target!==b._currentEditor&&a.target.parentNode!==b._currentEditor&&(c.clickTimer?(clearTimeout(c.clickTimer),c.clickTimer=0,b._handleDoubleClick(a)):(b._handleClick(a),c.clickTimer=setTimeout(function(){clearTimeout(c.clickTimer),c.clickTimer=0},300)))},handleKeyDown:function(a){var b=this.listBase;if(!b._currentEditor)if(Hb.isCtrlDown(a)&&65==a.keyCode)b.isKeyboardSelectEnabled()&&b.selectAll().size()>0&&b.fireInteractionEvent({kind:"selectAll"}),Ub.preventDefault(a);else if(46==a.keyCode)b.isKeyboardRemoveEnabled()&&b.removeSelection()&&b.fireInteractionEvent({kind:"removeElement"}),Ub.preventDefault(a);else if(b.isCheckMode()||38!==a.keyCode&&40!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode)Hb.showVersion(a);else{var c=b.getSelectionModel().getLastData();if(c)if(38===a.keyCode||40===a.keyCode){var d=b.getRowDatas(),e=b.getRowIndexByData(c);e>=0&&(38===a.keyCode?0!==e&&(c=d.get(e-1),b.getSelectionModel().setSelection(c)):e!==d.size()-1&&(c=d.get(e+1),b.getSelectionModel().setSelection(c)))}else!b.expand||37!==a.keyCode&&39!==a.keyCode||c.hasChildren()&&(37===a.keyCode?b.collapse(c):b.expand(c));else b.getRowDatas().size()>0&&(c=b.getRowDatas().get(0),b.getSelectionModel().setSelection(c))}},handleScroll:function(a){this.listBase.invalidate()}}),Gb.controls.ListBaseTouchInteraction=function(a){this.listBase=a,this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.ListBaseTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.startPoint=this.lastPoint=this.listBase.getLogicalPoint(a),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.listBase._zoom)},handleTouchmove:function(a){Ub.preventDefault(a);var b=this.listBase.getLogicalPoint(a);if(!(Rb.getDistance(this.startPoint,b)<20))if(this.moved||(this.moved=!0),yc.isSingleTouch(a)){if(this.lastPoint){var c=this.lastPoint.x-b.x,d=this.lastPoint.y-b.y,e=this.listBase.panByOffset(c,d);this.listBase.invalidate(),this.lastPoint.x-=c-e.x,this.lastPoint.y-=d-e.y}}else if(this.distance){var f=yc.getDistance(a)/this.distance;this.listBase.setZoom(this.zoom*f,!1)}},handleTouchend:function(a){Ub.preventDefault(a),this.moved||a.target===this.listBase._currentEditor||a.target.parentNode===this.listBase._currentEditor||this.listBase._handleClick(a),delete this.startPoint,delete this.lastPoint,delete this.moved,delete this.distance,delete this.zoom,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)}}),Gb.controls.ListBaseMSTouchInteraction=function(a){Gb.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this,arguments),this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=Gb.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown},Hb.ext("twaver.controls.ListBaseMSTouchInteraction",Gb.controls.ListBaseInteraction,{handleMouseDown:function(a){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),this._pointerMap[a.pointerId]||null==this.listBase.getLogicalPoint(a)||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),1==this._pointerIdArray.length?(this._startTouchPoint=this.listBase.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.listBase.getZoom())},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.listBase.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.listBase.getLogicalPoint(a);if(null==c)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.listBase.panByOffset(d,e);this.listBase.invalidate(),this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(this._startTouchPoint&&1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.listBase.getLogicalPoint(a);if(b){var c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.controls.Tree=function(a){this._interactionDispatcher=new Gb.EventDispatcher,this._initTree(a),Gb.controls.Tree.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.Tree",Gb.controls.ListBase,{__tree:1,__accessor:["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_checkMode:!1,_indent:Dd.TREE_INDENT,_rowHeight:Dd.TREE_ROW_HEIGHT,_rowLineWidth:Dd.TREE_ROW_LINE_WIDTH,_rowLineColor:Dd.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected:Dd.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon:Dd.TREE_EXPAND_ICON,_collapseIcon:Dd.TREE_COLLAPSE_ICON,_uncheckableStyle:"none",_lineType:Dd.TREE_LINE_TYPE,_lineColor:Dd.TREE_LINE_COLOR,_lineThickness:Dd.TREE_LINE_THICKNESS,_lineAlpha:Dd.TREE_LINE_ALPHA,_lineDash:Dd.TREE_LINE_DASH,getCheckMode:function(){return this._checkMode},setCheckMode:function(a){delete this._focusedRow;var b=this._checkMode;this._checkMode=a,this.firePropertyChange("checkMode",b,a)},renderData:function(a,b,c,d){this._renderTree(a,b,c,d)},getToolTip:function(a){return a.getToolTip()||a.getName()}}),Gb.controls.Table=function(a){this._checkColumn=new Gb.Column,this._checkColumn.setName("check"),this._checkColumn.setEditable(!0),this._checkColumn.setWidth(40),this._checkColumn.setHorizontalAlign("center"),this._checkColumn.renderCell=this.renderCheckCell;var b=this;this._checkColumn.getValue=function(a,c){return b.isSelected(a)},Gb.controls.Table.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.controls.Table",Gb.controls.TableBase,{__accessor:["rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","sortFunction","visibleFunction","sortColumn"],__bool:["editable","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Dd.TABLE_EDITABLE,_rowHeight:Dd.TABLE_ROW_HEIGHT,_rowLineWidth:Dd.TABLE_ROW_LINE_WIDTH,_rowLineColor:Dd.TABLE_ROW_LINE_COLOR,_columnLineWidth:Dd.TABLE_COLUMN_LINE_WIDTH,_columnLineColor:Dd.TABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Dd.TABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.TABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.TABLE_KEYBOARD_SELECT_ENABLED,getCheckColumn:function(){return this._checkColumn},isCheckMode:function(){return this._columnBox.contains(this._checkColumn)},setCheckMode:function(a){a!==this.isCheckMode()&&(delete this._focusedRow,a?this._columnBox.add(this._checkColumn,0):this._columnBox.remove(this._checkColumn),this.firePropertyChange("checkMode",!a,a))},renderCheckCell:function(a){var b=a.view._booleanPool.get();b.disabled=!1,b.type="checkbox",b.style.margin="0px 2px",b.style.verticalAlign="middle",b.checked=a.selected;var c=a.div;c.appendChild(b),""===c.style.textAlign&&(c.style.textAlign="center"),b._checkData=a.data}}),Gb.controls.TableHeader=function(a){Gb.controls.TableHeader.superClass.constructor.apply(this,arguments),this._invalidateScroll=!1,this._invalidateDisplay=!1,this._divPool=new Gb.Pool("div"),this._imagePool=new Gb.Pool("img"),this._textPool=new Gb.Pool("span"),this._resizePool=new Gb.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._imagePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this._table=a,this._tableView=a.getView(),this._columnBox=a.getColumnBox(),this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this);var b=this;a.getView().addEventListener("scroll",function(a){b.invalidateScroll()},!1),a.addPropertyChangeListener(function(a){b.invalidateDisplay()},this),this._view=Ub.createView("hidden"),this._view.tabIndex=-1,this._view.style.background=Dd.TABLEHEADER_BACKGROUND,this._rootDiv=Ub.createDiv(),this._view.appendChild(this._rootDiv),
this.invalidateDisplay(),Ob.isTouchable&&new Gb.controls.TableHeaderTouchInteraction(this),new Gb.controls.TableHeaderInteraction(this)},Hb.ext("twaver.controls.TableHeader",Gb.controls.ControlBase,{__accessor:["height","moveBackground","insertBackground","columnLineColor","resizeTolerance","sortDescIcon","sortAscIcon","sortIconPosition"],_height:Dd.TABLEHEADER_HEIGHT,_moveBackground:Dd.TABLEHEADER_MOVE_BACKGROUND,_insertBackground:Dd.TABLEHEADER_INSERT_BACKGROUND,_columnLineColor:Dd.TABLEHEADER_COLUMN_LINE_COLOR,_resizeTolerance:Dd.TABLEHEADER_RESIZE_TOLERANCE,_sortDescIcon:Dd.TABLEHEADER_SORT_DESC_ICON,_sortAscIcon:Dd.TABLEHEADER_SORT_ASC_ICON,_sortIconPosition:Dd.TABLEHEADER_SORT_ICON_POSITION,getRootDiv:function(){return this._rootDiv},handleColumnBoxChange:function(a){this.invalidateDisplay()},handleColumnPropertyChange:function(a){this.invalidateDisplay()},handleColumnHierarchyChange:function(a){this.invalidateDisplay()},onPropertyChanged:function(a){this.invalidateDisplay()},invalidateScroll:function(){this._invalidateScroll||(this._invalidateScroll=!0,this.invalidate())},invalidateDisplay:function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateScroll=!0,this.invalidate())},validate:function(){this._invalidate&&(this._invalidate=!1,this._invalidateDisplay&&(this._invalidateDisplay=!1,this.validateDisplay()),this._invalidateScroll&&(this._invalidateScroll=!1,this._rootDiv.style.left=-this._tableView.scrollLeft+"px"))},validateDisplay:function(){Ub.release(this._rootDiv);for(var a=this._table.getZoom(),b=this.getHeight()+"px",c=this.getHeight()-2+"px",d=this._table.getColumnBox().getRoots(),e=d.size(),f=0,g=this._table._columnLineWidth*a,h=0;e>h;h++){var i=d.get(h);if(i.isVisible()){var j=i.getWidth()*a;0>j&&(j=0);var k=Math.min(g,j),l=this._divPool.get();l._column=i;var m=l.style;m.position="absolute",m.whiteSpace="nowrap",m.lineHeight=c,m.overflow="hidden",m.textOverflow="ellipsis",m.backgroundPosition=this._sortIconPosition?this._sortIconPosition:"",m.backgroundRepeat="no-repeat",m.backgroundImage="",m.textAlign=i.getHorizontalAlign(),m.borderStyle="solid",m.borderWidth="0px",m.borderRightWidth=k+"px",m.borderRightColor=this._columnLineColor,0===h?(m.borderLeftWidth=k+"px",m.borderLeftColor=this._columnLineColor):m.borderLeftWidth="0px",m.left=f+"px",m.width=j-k+"px",m.height=b,l._x=f,l._width=j-k,this._rootDiv.insertBefore(l,this._rootDiv.firstChild),this.renderColumn(l,i),this.onColumnRendered(l,i),f+=j,i.isResizable()&&(l=this._resizePool.get(),l._resizeColumn=i,m=l.style,m.position="absolute",m.backgroundColor="white",m.opacity=0,m.left=f-k-this._resizeTolerance+"px",m.width=k+2*this._resizeTolerance+"px",m.height=b,this._rootDiv.appendChild(l))}}this._pools.forEach(function(a){a.clear()}),this._rootDiv.style.width=f+"px",this._rootDiv.style.height=b},renderColumn:function(a,b){if(b.renderHeader)b.renderHeader(a);else{var c=this._textPool.get();if(c.style.whiteSpace="nowrap",c.style.verticalAlign="middle",c.style.padding="1px 2px 1px 2px",c.innerHTML=b.getName()?b.getName():b.getPropertyName(),c.setAttribute("title",c.innerHTML),a.appendChild(c),Ob.isOpera){var d=a.cloneNode(!1);d.style.left="0px",d.style.top="0px",d.style.opacity=0,a.appendChild(d)}}if(this._table.getSortColumn()===b&&b.isSortable()){var e="asc"===b.getSortDirection()?this._sortAscIcon:this._sortDescIcon,f=Hb.getImageSrc(e);if(this._sortIconPosition&&""!==this._sortIconPosition)a.style.backgroundImage="url("+f+")";else{var g=this._imagePool.get();g.setAttribute("src",f),g.style.verticalAlign="middle",a.appendChild(g)}}},onColumnRendered:function(a,b){}}),Gb.controls.TableHeaderInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view;var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.TableHeaderInteraction",Object,{handleMouseDown:function(a){if(0===a.button){if(this.movableDiv)return void this.handleMouseUp(a);this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this._startClient=Ub.getClientPoint(a),this.lastX=this.getX(a),this._startLogicalX=this.lastX,Ub.handle_mousedown(this,a)}},changeCursor:function(a){var b="";if(a.target._resizeColumn)b="ew-resize";else{var c=this.getColumnAt(a);c&&(c.isMovable()||c.isSortable())&&(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(null==this.lastX)return void this.changeCursor(a);if(Ub.target===this){var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeColumn){if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();10>c&&(c=10,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleMouseUp:function(a){if(0===a.button){var b;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else if(b=this.getColumnAt(a),b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?("desc"===d&&this.table.setSortColumn(null),b.setSortDirection("asc"===d?"desc":"asc")):this.table.setSortColumn(b),this.table.onColumnSorted(this.table.getSortColumn())}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX,delete this._startClient,delete this._startLogicalX},getColumnAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){for(var b=this._startLogicalX+a.clientX-this._startClient.x+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1,h=0;d>h;h++){var i=c.get(h);if(i===this.movableDiv._column&&(g=!0),i.isVisible()){var j=i.getWidth()*e;if(0>=j)continue;if(b>=f&&f+j>=b){var k=f+j/2>b;!g||i===this.movableDiv._column&&k||h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),Gb.controls.TableHeaderTouchInteraction=function(a){this.header=a,this.table=a._table,this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.TableHeaderTouchInteraction",Object,{handleTouchstart:function(a){return Ub.preventDefault(a),this.movableDiv?void this.handleTouchend(a):(this.resizeColumn=a.target._resizeColumn,this.resizeColumn||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),void Ub.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(a){if(Ub.preventDefault(a),null!=this.lastX){var b;if(this.resizeColumn){if(b=this.getX(a),null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeColumn.getWidth()+(b-this.lastX)/this.table.getZoom();0>c&&(c=0,this.stopX=b),this.resizeColumn.setWidth(c),this.lastX=b}else if(this.movableDiv){b=this.getX(a);var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.header.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.header.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.columnInfo=this.getColumnInfoAt(a),this.columnInfo&&(this.insertDiv.style.left=this.columnInfo.position)}}},handleTouchend:function(a){Ub.preventDefault(a);var b;if(this.resizeColumn);else if(this.movableDiv&&this.columnInfo){b=this.movableDiv._column;var c=this.columnInfo.index;this.table.getColumnBox().moveTo(b,c)}else if(b=this.getColumnAt(a),b&&b.isSortable()){var d=b.getSortDirection();this.table.getSortColumn()===b?("desc"===d&&this.table.setSortColumn(null),b.setSortDirection("asc"===d?"desc":"asc")):this.table.setSortColumn(b)}this.clear(),Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.columnInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeColumn,delete this.stopX,delete this.lastX},getColumnAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._column);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getColumnInfoAt:function(a){for(var b=this.getX(a)+this.table.getView().scrollLeft,c=this.table.getColumnBox().getRoots(),d=c.size(),e=this.table.getZoom(),f=0,g=!1,h=0;d>h;h++){var i=c.get(h);if(i===this.movableDiv._column&&(g=!0),i.isVisible()){var j=i.getWidth()*e;if(0>=j)continue;if(b>=f&&f+j>=b){var k=f+j/2>b;!g||i===this.movableDiv._column&&k||h--;var l=k?Math.max(0,h):Math.min(h+1,d),m=k?f:f+j;return m=Math.max(0,m-1),{index:l,column:i,position:m+"px"}}f+=j}}return this.columnInfo}}),Gb.controls.TablePane=function(a,b){Gb.controls.TablePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._table=a,this._tableHeader=b?b:new Gb.controls.TableHeader(a),this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._tableHeader.getView()),this._view.appendChild(this._table.getView());var c=this;this._tableHeader.addPropertyChangeListener(function(a){"height"===a.property&&c.invalidate()})},Hb.ext("twaver.controls.TablePane",Gb.controls.ControlBase,{onPropertyChanged:function(a){this.invalidate()},getTable:function(){return this._table},getTableHeader:function(){return this._tableHeader},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._tableHeader.getHeight();this._tableHeader.adjustBounds({x:0,y:0,width:a,height:c}),this._table.adjustBounds({x:0,y:c,width:a,height:Math.max(0,b-c)})}}),Gb.controls.TreeTable=function(a){this._treeColumn=new Gb.Column,this._treeColumn.setName("tree"),this._treeColumn.setWidth(120),this._treeColumn.renderCell=this.renderTreeCell,this._treeColumn.getValue=this.getTreeValue,this._treeColumn.setValue=this.setTreeValue,this._initTree(a),Gb.controls.TreeTable.superClass.constructor.apply(this,arguments),this._columnBox.add(this._treeColumn)},Hb.ext("twaver.controls.TreeTable",Gb.controls.TableBase,{__tree:1,__accessor:["sortFunction","visibleFunction","checkMode","rootData","sortColumn","indent","rowHeight","rowLineWidth","rowLineColor","columnLineWidth","columnLineColor","expandIcon","collapseIcon","uncheckableStyle","lineType","lineColor","lineThickness","lineAlpha","lineDash"],__bool:["editable","rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],_editable:Dd.TREETABLE_EDITABLE,_indent:Dd.TREETABLE_INDENT,_rowHeight:Dd.TREETABLE_ROW_HEIGHT,_rowLineWidth:Dd.TREETABLE_ROW_LINE_WIDTH,_rowLineColor:Dd.TREETABLE_ROW_LINE_COLOR,_columnLineWidth:Dd.TREETABLE_COLUMN_LINE_WIDTH,_columnLineColor:Dd.TREETABLE_COLUMN_LINE_COLOR,_makeVisibleOnSelected:Dd.TREETABLE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.TREETABLE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.TREETABLE_KEYBOARD_SELECT_ENABLED,_expandIcon:Dd.TREETABLE_EXPAND_ICON,_collapseIcon:Dd.TREETABLE_COLLAPSE_ICON,_lineType:Dd.TREE_LINE_TYPE,_lineColor:Dd.TREE_LINE_COLOR,_lineThickness:Dd.TREE_LINE_THICKNESS,_lineAlpha:Dd.TREE_LINE_ALPHA,_lineDash:Dd.TREE_LINE_DASH,getTreeColumn:function(){return this._treeColumn},renderTreeCell:function(a){a.view._renderTree(a.div,a.data,a.rowIndex,a.selected)},getTreeValue:function(a,b){return b.getLabel(a)},setTreeValue:function(a,b,c){a.setName(b)}}),Gb.controls.PropertySheet=function(a){Gb.controls.PropertySheet.superClass.constructor.apply(this,arguments),this._currentRowIndex=-1,this._currentEditor=null,this._currentData=null,this._invalidate=!1,this._resizeDiv=Ub.createDiv(),this._resizeDiv.style.backgroundColor="white",this._resizeDiv.style.opacity=0,this._resizeDiv.style.top="0px",this._categoryList=new md,this._categoryMap={},this._rowList=new md,this._propertyBox=new Gb.PropertyBox,this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox,this),this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox,this),this.__divPool=new Gb.Pool("div",2),this.__cellPool=new Gb.Pool("div",2),this.__imagePool=new Gb.Pool("img",2),this.__textPool=new Gb.Pool("span",2),this._stringPool=new Gb.Pool("span",2),this._booleanPool=new Gb.Pool("input",2),this._colorPool=new Gb.Pool("div",2),this._pools.add(this.__divPool),this._pools.add(this.__cellPool),this._pools.add(this.__imagePool),this._pools.add(this.__textPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this._view=Ub.createView("auto"),this._rootDiv=Ub.createDiv(),this._dataDiv=Ub.createDiv(),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(a?a:new Gb.DataBox);var b=this;this._view.addEventListener("change",function(a){b.handleChange(a)},!1),Ob.isTouchable?Ob.isMSTouchable?new Gb.controls.PropertySheetMSTouchInteraction(this):(new Gb.controls.PropertySheetTouchInteraction(this),new Gb.controls.PropertySheetInteraction(this)):new Gb.controls.PropertySheetInteraction(this)},Hb.ext("twaver.controls.PropertySheet",Gb.controls.View,{__accessor:["indent","rowHeight","sumWidth","propertyNameWidth","propertyNameHorizontalAlign","autoAdjustable","rowLineWidth","columnLineWidth","borderColor","categorizable","resizeTolerance","editable","selectColor","expandIcon","collapseIcon","sortFunction","visibleFunction"],_autoAdjustable:Dd.PROPERTYSHEET_AUTO_ADJUSTABLE,_selectColor:Dd.SELECT_COLOR,_categorizable:Dd.PROPERTYSHEET_CATEGORIZABLE,_editable:Dd.PROPERTYSHEET_EDITABLE,_propertyNameWidth:Dd.PROPERTYSHEET_PROPERTY_NAME_WIDTH,_propertyNameHorizontalAlign:Dd.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN,_sumWidth:Dd.PROPERTYSHEET_SUM_WIDTH,_indent:Dd.PROPERTYSHEET_INDENT,_rowHeight:Dd.PROPERTYSHEET_ROW_HEIGHT,_rowLineWidth:Dd.PROPERTYSHEET_ROW_LINE_WIDTH,_columnLineWidth:Dd.PROPERTYSHEET_COLUMN_LINE_WIDTH,_borderColor:Dd.PROPERTYSHEET_BORDER_COLOR,_expandIcon:Dd.PROPERTYSHEET_EXPAND_ICON,_collapseIcon:Dd.PROPERTYSHEET_COLLAPSE_ICON,_resizeTolerance:Dd.PROPERTYSHEET_RESIZE_TOLERANCE,getPropertyBox:function(){return this._propertyBox},getCurrentData:function(){return this._currentData},getDataDiv:function(){return this._dataDiv},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidate(),this.firePropertyChange("dataBox",b,this._box)}},invalidatePropertyBox:function(){this._isValidating||this.invalidate()},onPropertyChanged:function(a){"zoom"!==a.property&&this.invalidate()},isVisible:function(a){return a.isVisible&&!a.isVisible(this._currentData,this)?!1:this._visibleFunction?this._visibleFunction(a):!0},handlePropertyChange:function(a){this._currentData===a.source&&this.invalidate()},handleSelectionChange:function(a){this._currentData!==this.getSelectionModel().getLastData()&&(this._currentRowIndex=-1,this.invalidate())},isExpanded:function(a){if(!a)return!0;var b=this._categoryMap[a];return b?b.isExpanded:Dd.PROPERTYSHEET_EXPAND_CATEGORY},expand:function(a){if(a){var b=this._categoryMap[a];b&&!b.isExpanded&&(b.isExpanded=!0,this.invalidate())}},expandAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!0)}this.invalidate()},collapse:function(a){if(a){var b=this._categoryMap[a];b&&b.isExpanded&&(b.isExpanded=!1,this.invalidate())}},collapseAll:function(){for(var a in this._categoryMap){var b=this._categoryMap[a];b&&(b.isExpanded=!1)}this.invalidate()},getCategoryName:function(a){if(!this.isCategorizable())return"null";var b=a.getCategoryName();return b?b:"null"},validateModel:function(){this._rowList.clear(),this._categoryList.clear();var a,b,c,d,e,f={},g=new md,h=this._currentData?this._propertyBox.getRoots():new md;for(d=h.size(),a=0;d>a;a++)e=h.get(a),this.isVisible(e)&&(g.add(e),c=this.getCategoryName(e),f[c]||(this._categoryList.add(c),f[c]={isExpanded:this.isExpanded(c),properties:new md}));for(this._sortFunction&&g.sort(this._sortFunction),this._categoryMap=f,d=g.size(),a=0;a<this._categoryList.size();a++){c=this._categoryList.get(a),"null"!==c&&this._rowList.add(c);var i=f[c];if(i.isExpanded)for(b=0;d>b;b++)e=g.get(b),this.getCategoryName(e)===c&&(i.properties.add(e),this._rowList.add({view:this,data:this._currentData,property:e,value:this._currentData?this.getValue(this._currentData,e):null}))}},adjustWidth:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight;a<=this._indent||0>=b||(a-=this._indent,this._rowList.size()*this._rowHeight>b&&(a-=Dd.SCROLL_BAR_WIDTH,0>=a)||(this._propertyNameWidth=0===this._sumWidth||this._propertyNameWidth>this._sumWidth?a/2:a*(this._propertyNameWidth/this._sumWidth),this._sumWidth=a,this._view.style.overflowX="hidden",this._view.style.overflowY="auto"))},validateDisplay:function(){var a=this._rowList.size(),b=this._borderColor,c=this._indent,d=this._rowHeight,e=this._propertyNameWidth,f=Math.max(0,this._sumWidth-e),g=this._rowLineWidth,h=this._columnLineWidth,i=d-g+"px",j=d-g-2+"px",k=c+"px",l=e-h+"px",m=f-h+"px",n=e+f+"px",o=g+"px",p=h+"px",q=e+"px",r=this._dataDiv,s=r.style;s.height=a*d+"px",s.width=c+e+f+"px";var t=this.__divPool.get();s=t.style,s.position="absolute",s.left="0px",s.top="0px",s.width=k,s.height=r.style.height,s.borderWidth="0px",s.backgroundColor=b,r.appendChild(t);for(var u=0;a>u;u++){var v=this._rowList.get(u),w=u*d+"px",x=this.__divPool.get();if(v.rowDiv=x,s=x.style,s.position="absolute",s.whiteSpace="nowrap",s.overflow="hidden",s.textOverflow="ellipsis",s.left=k,s.top=w,s.width=n,s.height=i,s.lineHeight=j,s.borderStyle="solid",s.borderWidth="0px",s.borderBottomWidth=o,s.borderBottomColor=b,r.appendChild(x),"string"==typeof v){s.backgroundColor=b,t=this.__divPool.get(),s=t.style,s.position="absolute",s.left="0px",s.top=w,s.width=k,s.height=i,s.lineHeight=j,s.borderWidth="0px",r.appendChild(t);var y=this.__imagePool.get(),z=this.isExpanded(v)?this._expandIcon:this._collapseIcon;y.setAttribute("src",Hb.getImageSrc(z)),s=y.style,s.verticalAlign="middle",y._expandData=v,t.appendChild(y),this.renderCategory(x,v),this.onCategoryRendered(x,v)}else{var A=v.property,B=this.__cellPool.get();v.nameRender=B,s=B.style,this._currentRowIndex===u&&(s.backgroundColor=this.getSelectColor()),s.position="absolute",s.verticalAlign="middle",s.textAlign=this._propertyNameHorizontalAlign,s.overflow="hidden",s.textOverflow="ellipsis",s.whiteSpace="nowrap",s.left="0px",s.top="0px",s.width=l,s.height=i,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=p,s.borderRightColor=b,x.appendChild(B),this.renderName(v),this.onNameRendered(v),B=this.__cellPool.get(),v.valueRender=B,s=B.style,s.position="absolute",s.verticalAlign="middle",s.textAlign=A.getHorizontalAlign(),s.whiteSpace="nowrap",s.overflow="hidden",s.textOverflow="ellipsis",s.left=q,s.top="0px",s.width=m,s.height=i,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=p,s.borderRightColor=b,x.appendChild(B),this.renderValue(v),this.onValueRendered(v)}}s=this._resizeDiv.style,s.left=c+e-h-this._resizeTolerance+"px",s.width=h+2*this._resizeTolerance+"px",s.height=r.style.height,r.appendChild(this._resizeDiv)},renderCategory:function(a,b){var c=this.__textPool.get(),d=c.style;d.fontWeight="bold",d.whiteSpace="nowrap",d.overflow="hidden",d.textOverflow="ellipsis",d.verticalAlign="middle",d.padding="1px 2px 1px 2px",c.innerHTML=b,c.setAttribute("title",b),a.appendChild(c)},onCategoryRendered:function(a,b){},renderName:function(a){if(a.property.renderName)return void a.property.renderName(a);var b=this.__textPool.get(),c=b.style;c.fontWeight="",c.whiteSpace="nowrap",c.verticalAlign="middle",c.padding="1px 2px 1px 2px";var d=a.property.getName();d||(d=a.property.getPropertyName()),b.innerHTML=d,b.setAttribute("title",d),a.nameRender.appendChild(b)},onNameRendered:function(a){},renderValue:function(a){var b=a.property;if(b.renderValue)return void b.renderValue(a);var c=a.value,d=b.getEnumInfo(this._currentData);d&&!Array.isArray(d)&&(c=d.map[c]),a.view.isCellEditable(a.data,b)&&(a.enumInfo=d,a.valueRender._editInfo=a),a.valueRender.innerHTML="",zc.render(b.getValueType(),c,a.valueRender,a.view,b.isInnerText())},onValueRendered:function(a){},renderEditor:function(a){},onEditorRendered:function(a){},updateCurrentData:function(){this._currentData=this.getSelectionModel().getLastData()},validateImpl:function(){var a=this._view.scrollLeft,b=this._view.scrollTop;Ub.release(this._dataDiv),this.updateCurrentData(),this.validateModel(),this.isAutoAdjustable()&&this.adjustWidth(),this.validateDisplay(),this._pools.forEach(function(a){a.clear()}),this._view.scrollLeft!==a&&(this._view.scrollLeft=a),this._view.scrollTop!==b&&(this._view.scrollTop=b)},getValue:function(a,b){return a?b.getValue(a,this):null},setValue:function(a,b,c){a&&b.setValue(a,c,this)},isCellEditable:function(a,b){return a?this.isEditable()&&b.isEditable():!1},getRowIndexAt:function(a){var b=this.getLogicalPoint(a);if(!b)return-1;var c=parseInt(b.y/this._rowHeight);return c>=0&&c<this._rowList.size()?c:-1},handleChange:function(a){this._isCommitting||this._isCanceling||this._isValidating||a.target._editInfo&&this.commitEditValue&&this.commitEditValue(a.target._editInfo,a.target)},commitEditValue:function(a,b){var c;c="checkbox"===b.type?b.checked:b.value;var d=a.property,e=d.getValueType();if("int"===e&&"string"==typeof c)c=parseInt(c);else if("number"===e&&"string"==typeof c)c=parseFloat(c);else if("array.string"===e)c=c.split(",");else if("array.number"===e){c=c.split(",");for(var f=0,g=c.length;g>f;f++)c[f]=parseFloat(c[f])}else if("list.points"===e){for(var h=c.replace(/\]/g,"").replace(/\[/g,"").split(","),i=new Gb.List,f=0;f<h.length;f+=2)f+1>=h.length||i.add({x:parseInt(h[f]),y:parseInt(h[f+1])});c=i}if(b._rowInfo&&(b._rowInfo.value=c,this.renderValue(b._rowInfo)),this.setValue(a.data,d,c),Gb.Util.setFocus(this._view),this._currentEditor){var j=this._currentEditor.parentNode;j&&j.removeChild(this._currentEditor),delete this._currentEditor}delete this._isCommitting},cancelEditing:function(){if(this._currentEditor){var a=this._currentEditor.parentNode;a&&a.removeChild(this._currentEditor),delete this._currentEditor,delete this._isCanceling}},getEditorValue:function(a){var b=a.valueRender._editInfo,c=b.property.getValueType(),d=a.valueRender._editInfo.value,e="";if("list.points"===c){var f=d._as?d._as:d;f.forEach(function(a,b){e+=b==f.length-1?"["+a.x+","+a.y+"]":"["+a.x+","+a.y+"],"})}else e=d;return e},updateCurrentRowIndex:function(a){var b=this._rowList.size();(0>a||a>=b)&&(a=-1);var c,d=this._currentRowIndex;if(a!==d&&(d>=0&&b>d&&(c=this._rowList.get(d),c.nameRender&&(c.nameRender.style.backgroundColor="")),this._currentRowIndex=a),a>=0&&(c=this._rowList.get(a),c.nameRender&&(c.nameRender.style.backgroundColor=this.getSelectColor(),!this._currentEditor&&c.valueRender&&c.valueRender._editInfo))){var e=c.valueRender._editInfo,f=this.renderEditor&&this.renderEditor(c);f?(this._currentEditor=f.view,null!=e.value&&(this._currentEditor.value=this.getEditorValue(c))):e.enumInfo?this._currentEditor=Ub.createSelect(e.enumInfo,e.value):(this._currentEditor=Mb.createElement("input"),null!=e.value&&(this._currentEditor.value=this.getEditorValue(c)));var g=this;if(c.property&&c.property.renderEditor){var f="function"==typeof c.property.renderEditor?c.property.renderEditor(g,c):c.property.renderEditor;f&&(g._currentEditor=f)}if(this._currentEditor){if(f&&f.onKeyDown){var h=f.onKeyDown;h&&Array.isArray(h)&&g._currentEditor.addEventListener("keydown",function(a){for(var b=0;b<h.length;b++)if(h[b].combKey){var c=null;switch(h[b].combKey){case"ctrlKey":c=a.ctrlKey;break;case"shiftKey":c=a.shiftKey;break;case"altKey":c=a.altKey}a.keyCode===h[b].keyCode&&c&&h[b].handlerEvent&&h[b].handlerEvent(a)}else a.keyCode===h[b].keyCode&&h[b].handlerEvent&&h[b].handlerEvent(a)})}else this._currentEditor.addEventListener("keydown",function(a){var b=a.target._editInfo.view;if(13!==a.keyCode||!a.shiftKey)if(13===a.keyCode){if(b._isCommitting)return;b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target)}else 27===a.keyCode&&(b._isCanceling=!0,b.cancelEditing())},!1);if(this._currentEditor.addEventListener("blur",function(a){var b=a.target._editInfo.view;b._isCommitting||b._isCanceling||(b._isCommitting=!0,b.commitEditValue(a.target._editInfo,a.target))},!1),this._currentEditor.keepDefault=!0,this._currentEditor._rowInfo=c,this._currentEditor._editInfo=e,!this._currentEditor.parentNode){var i=this._currentEditor.style;i.position="absolute",i.margin="0px",i.border="0px",i.padding="0px",i.left=this._indent+this._propertyNameWidth+"px",i.top=c.rowDiv.style.top,i.width=c.valueRender.style.width,i.height=c.valueRender.style.height,this._rootDiv.appendChild(this._currentEditor)}Gb.Util.setFocus(this._currentEditor),this.onEditorRendered&&this.onEditorRendered(c)}}}}),Gb.controls.PropertySheetInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv;var b=this;this.view.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.PropertySheetInteraction",Object,{minGap:10,handleMouseDown:function(a){if(a.target!==this.sheet._currentEditor&&a.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Gb.Util.setFocus(this.view),!this.sheet._isValidating))if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv)this.lastX=this.getX(a),Ub.handle_mousedown(this,a);else{this.sheet._currentEditor&&!this.sheet._isCommitting&&(this.sheet._isCommitting=!0,this.sheet.commitEditValue(this.sheet._currentEditor._editInfo,this.sheet._currentEditor));var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}},handleMouseMove:function(a){if(null==this.lastX&&!Ub.target)return void this.changeCursor(a);if(Ub.target===this&&null!=this.lastX){var b=this.getX(a);if(null!=this.stopLeft){if(b<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b}},handleMouseUp:function(a){0===a.button&&(this.view.style.cursor="default",delete this.stopLeft,delete this.stopRight,delete this.lastX)},changeCursor:function(a){this.view.style.cursor=a.target===this.resizeDiv?"ew-resize":"default"},getX:function(a){return a.clientX/this.sheet.getZoom()}}),Gb.controls.PropertySheetTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.PropertySheetTouchInteraction",Object,{minGap:10,handleTouchstart:function(a){Ub.preventDefault(a),a.target!==this.sheet._currentEditor&&a.target.parentNode!==this.sheet._currentEditor&&(this.sheet.isFocusOnClick()&&Gb.Util.setFocus(this.view),this.sheet._isValidating||(a.target===this.resizeDiv&&(this.lastX=this.getX(a)),this.lastPoint=this.sheet.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.sheet.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)))},handleTouchmove:function(a){if(Ub.preventDefault(a),this.moved||(this.moved=!0),null!=this.lastX){var b=this.getX(a);if(null!=this.stopLeft){if(b<this.stopLeft)return;delete this.stopLeft}if(null!=this.stopRight){if(b>this.stopRight)return;delete this.stopRight}var c=this.sheet.getPropertyNameWidth()+(b-this.lastX);c<this.minGap?(c=this.minGap,this.stopLeft=b):c>this.sheet.getSumWidth()-this.minGap&&(c=this.sheet.getSumWidth()-this.minGap,this.stopRight=b),this.sheet.setPropertyNameWidth(c),this.lastX=b}else if(yc.isSingleTouch(a)){if(this.lastPoint){var d=this.sheet.getLogicalPoint(a),e=this.lastPoint.x-d.x,f=this.lastPoint.y-d.y,g=this.sheet.panByOffset(e,f);this.lastPoint.x-=e-g.x,this.lastPoint.y-=f-g.y}}else if(this.distance){var h=yc.getDistance(a)/this.distance;this.sheet.setZoom(this.zoom*h,!1)}},handleTouchend:function(a){if(Ub.preventDefault(a),!this.moved)if(a.target._expandData){var b=a.target._expandData;this.sheet.isExpanded(b)?this.sheet.collapse(b):this.sheet.expand(b)}else if(a.target===this.resizeDiv);else{var c=this.sheet.getRowIndexAt(a);this.sheet.updateCurrentRowIndex(c)}delete this.stopLeft,delete this.stopRight,delete this.lastX,delete this.lastPoint,delete this.distance,delete this.zoom,delete this.moved,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)},getX:function(a){var b=a.changedTouches[0];return b.clientX}}),Gb.controls.PropertySheetMSTouchInteraction=function(a){this.sheet=a,this.view=a._view,this.resizeDiv=a._resizeDiv,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this),this.superHandleMouseDown=Gb.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown},Hb.ext("twaver.controls.PropertySheetMSTouchInteraction",Gb.controls.PropertySheetInteraction,{handleMouseDown:function(a){},handleTouchstart:function(a){a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},
this._pointerIdArray=[]),this._pointerMap[a.pointerId]||null==this.sheet.getLogicalPoint(a)||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length&&a.pointerType==a.MSPOINTER_TYPE_MOUSE&&this.superHandleMouseDown(a),1==this._pointerIdArray.length?(this._startTouchPoint=this.sheet.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.sheet.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.sheet.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE&&this._startTouchPoint){var c=this.sheet.getLogicalPoint(a);if(null==c)return;var d=this._startTouchPoint.x-c.x,e=this._startTouchPoint.y-c.y,f=this.sheet.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}},handleTouchend:function(a){if(1==this._pointerIdArray.length&&a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.sheet.getLogicalPoint(a),c=new Date;c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20&&this.superHandleMouseDown(a)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.controls.SplitPane=function(a,b,c,d){Gb.controls.SplitPane.superClass.constructor.apply(this,arguments),this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,this._dividerDiv=Ub.createDiv(),this._dividerDiv.tabIndex=-1,this._isPercentPosition=!0,this._view.appendChild(this._dividerDiv),a&&this.setFirstView(a),b&&this.setNextView(b),c&&this.setOrientation(c),d>1&&(this._isPercentPosition=!1),null!=d&&this.setPosition(d,this._isPercentPosition),this.setDividerDraggable(!0),this.setExpandable(!1),this.invalidate(),Ob.isTouchable&&new Gb.controls.SplitPaneTouchInteraction(this),new Gb.controls.SplitPaneInteraction(this)},Hb.ext("twaver.controls.SplitPane",Gb.controls.ControlBase,{__accessor:["orientation","dividerWidth","dividerBackground","dividerOpacity","maskBackground","upExpandIcon","downExpandIcon","leftExpandIcon","rightExpandIcon"],__bool:["dividerDraggable","expandable"],_position:Dd.SPLITPANE_POSITION,_orientation:Dd.SPLITPANE_ORIENTATION,_dividerWidth:Dd.SPLITPANE_DIVIDER_WIDTH,_dividerBackground:Dd.SPLITPANE_DIVIDER_BACKGROUND,_dividerOpacity:Dd.SPLITPANE_DIVIDER_OPACITY,_maskBackground:Dd.SPLITPANE_MASK_BACKGROUND,_upExpandIcon:Dd.SPLITPANE_UP_EXPAND_ICON,_downExpandIcon:Dd.SPLITPANE_DOWN_EXPAND_ICON,_leftExpandIcon:Dd.SPLITPANE_LEFT_EXPAND_ICON,_rightExpandIcon:Dd.SPLITPANE_RIGHT_EXPAND_ICON,onPropertyChanged:function(a){this.invalidate()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(a,b){if(b&&0>a&&(a=0),a!==this._position){var c=this._position;this._position=a,this.firePropertyChange("position",c,a),null==this.lastDividerLocation&&(this.lastDividerLocation=a)}},setFirstView:function(a){if(this._firstView!==a){var b=this._firstView;b&&this._view.removeChild(b.getView?b.getView():b),this._firstView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("firstView",b,a)}},getFirstView:function(){return this._firstView},setNextView:function(a){if(this._nextView!==a){var b=this._nextView;b&&this._view.removeChild(b.getView?b.getView():b),this._nextView=a,a&&(a.getView?this._view.insertBefore(a.getView(),this._dividerDiv):this._view.insertBefore(a,this._dividerDiv)),this.firePropertyChange("nextView",b,a)}},getNextView:function(){return this._nextView},validateImpl:function(){var a,b=this._position,c=this._view.offsetWidth,d=this._view.offsetHeight,e=this._dividerWidth;if(e>=8||0===e?this._coverDiv&&(this._dividerDiv.removeChild(this._coverDiv),delete this._coverDiv):this._coverDiv||(this._coverDiv=Ub.createDiv(),this._coverDiv.tabIndex=-1,this._dividerDiv.appendChild(this._coverDiv)),"horizontal"===this._orientation){if(e>c&&(e=c),this._isPercentPosition)var f=(c-e)*b;else var f=b;var g=c-e-f+1;Hb.setViewBounds(this._firstView,{x:0,y:0,width:f,height:d}),Hb.setViewBounds(this._nextView,{x:f+e,y:0,width:g,height:d}),Hb.setViewBounds(this._dividerDiv,{x:f,y:0,width:e,height:d}),this._dividerDiv.position=f,this._coverDiv&&Hb.setViewBounds(this._coverDiv,{x:e/2-4,y:0,width:8,height:d}),this._expandable&&(this._expandCvs1||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:0,y:0,width:e,height:11}),this._expandCvs1=Hb.html.createImg(Hb.getImageSrc(this._leftExpandIcon)),this._expandCvs1.style.left=e/2-3+"px",a.appendChild(this._expandCvs1),this._dividerDiv.appendChild(a)),this._expandCvs2||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:0,y:15,width:e,height:11}),this._expandCvs2=Hb.html.createImg(Hb.getImageSrc(this._rightExpandIcon)),this._expandCvs2.style.left=e/2-3+"px",a.appendChild(this._expandCvs2),this._dividerDiv.appendChild(a)))}else{if(e>d&&(e=d),this._isPercentPosition)var h=(d-e)*b;else var h=b;var i=d-e-h;Hb.setViewBounds(this._firstView,{x:0,y:0,width:c,height:h}),Hb.setViewBounds(this._nextView,{x:0,y:h+e,width:c,height:i}),Hb.setViewBounds(this._dividerDiv,{x:0,y:h,width:c,height:e}),this._dividerDiv.position=h,this._coverDiv&&Hb.setViewBounds(this._coverDiv,{x:0,y:e/2-4,width:c,height:8}),this._expandable&&(this._expandCvs1||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:0,y:0,width:11,height:e}),this._expandCvs1=Hb.html.createImg(Hb.getImageSrc(this._upExpandIcon)),this._expandCvs1.style.top=e/2-3+"px",a.appendChild(this._expandCvs1),this._dividerDiv.appendChild(a)),this._expandCvs2||(a=Hb.html.createDiv(),a.tabIndex=-1,Hb.setViewBounds(a,{x:15,y:0,width:11,height:e}),this._expandCvs2=Hb.html.createImg(Hb.getImageSrc(this._downExpandIcon)),this._expandCvs2.style.top=e/2-3+"px",a.appendChild(this._expandCvs2),this._dividerDiv.appendChild(a)))}var j=this._dividerDiv.style;j.background=this._dividerBackground}}),Gb.controls.SplitPaneInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,this.isPercentPosition=a._isPercentPosition;var b=this;this.view.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.SplitPaneInteraction",Object,{handleMouseDown:function(a){if(this.splitPane.isExpandable()){var b,c,d=this.splitPane._dividerWidth;if(a.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(a.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.splitPane.isDividerDraggable())if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=Ub.createDiv();var e=this.resizeDiv.style;e.left=this.dividerDiv.style.left,e.top=this.dividerDiv.style.top,e.width=this.dividerDiv.style.width,e.height=this.dividerDiv.style.height,e.opacity=this.splitPane.getDividerOpacity(),e.background=this.splitPane.getDividerBackground(),this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?a.clientX:a.clientY,this.resizeDiv.maskDiv=Ub.createDiv(),e=this.resizeDiv.maskDiv.style,e.left="0px",e.top="0px",e.width=this.view.clientWidth+"px",e.height=this.view.clientHeight+"px",e.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv),Ub.handle_mousedown(this,a),a.preventDefault()}},handleMouseMove:function(a){if((!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable())if(this.resizeDiv||Ub.target)this.resizeDiv&&Ub.target===this&&("horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition+"px");else{var b="horizontal"===this.splitPane._orientation?"ew-resize":"ns-resize";this.view.style.cursor=a.target===this.dividerDiv||a.target===this.splitPane._coverDiv?b:"default"}},handleMouseUp:function(a){(!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)&&this.splitPane.isDividerDraggable()&&0===a.button&&this.clear(a)},clear:function(a){if(this.resizeDiv){var b,c=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var d=this.view.clientWidth;c>d&&(c=d),b=this.dividerDiv.position+a.clientX-this.resizeDiv.lastPosition,this.splitPane.setPosition(this.isPercentPosition?b/(d-c):b)}else{var e=this.view.clientHeight;c>e&&(c=e),b=this.dividerDiv.position+a.clientY-this.resizeDiv.lastPosition,this.splitPane.setPosition(this.isPercentPosition?b/(e-c):b)}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Gb.controls.SplitPaneTouchInteraction=function(a){this.splitPane=a,this.view=a._view,this.dividerDiv=a._dividerDiv,this.isPercentPosition=a._isPercentPosition,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.SplitPaneTouchInteraction",Object,{handleTouchstart:function(a){if(Ub.preventDefault(a),this.splitPane.isExpandable()){var b,c,d=this.splitPane._dividerWidth;if(a.target===this.splitPane._expandCvs1)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(0):this.splitPane.lastDividerLocation<this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())));if(a.target===this.splitPane._expandCvs2)return void("horizontal"===this.splitPane._orientation?(b=this.view.clientWidth,d>b&&(d=b),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())):(c=this.view.clientHeight,d>c&&(d=c),this.splitPane.lastDividerLocation===this.splitPane.getPosition()?this.splitPane.setPosition(1):this.splitPane.lastDividerLocation>this.splitPane.getPosition()&&(this.splitPane.setPosition(this.splitPane.lastDividerLocation),this.splitPane.lastDividerLocation=this.splitPane.getPosition())))}if(this.resizeDiv)this.clear(a);else if(a.target===this.dividerDiv||a.target===this.splitPane._coverDiv){this.resizeDiv=Ub.createDiv();var e=this.resizeDiv.style;e.left=this.dividerDiv.style.left,e.top=this.dividerDiv.style.top,e.width=this.dividerDiv.style.width,e.height=this.dividerDiv.style.height,e.opacity=this.splitPane.getDividerOpacity(),e.background=this.splitPane.getDividerBackground();var f=a.changedTouches[0];this.resizeDiv.lastPosition="horizontal"===this.splitPane._orientation?f.clientX:f.clientY,this.resizeDiv.maskDiv=Ub.createDiv();var e=this.resizeDiv.maskDiv.style;e.left="0px",e.top="0px",e.width=this.view.clientWidth+"px",e.height=this.view.clientHeight+"px",e.background=this.splitPane.getMaskBackground(),this.view.appendChild(this.resizeDiv.maskDiv),this.view.appendChild(this.resizeDiv)}Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(Ub.preventDefault(a),!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)if(this.resizeDiv){var b=a.changedTouches[0];"horizontal"===this.splitPane._orientation?this.resizeDiv.style.left=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition+"px":this.resizeDiv.style.top=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition+"px"}else;},handleTouchend:function(a){(!this.splitPane.isExpandable()||a.target!==this.splitPane._expandCvs1&&a.target!==this.splitPane._expandCvs2)&&(Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this),this.clear(a))},clear:function(a){var b=a.changedTouches[0];if(this.resizeDiv){var c=this.splitPane._dividerWidth;if("horizontal"===this.splitPane._orientation){var d=this.view.clientWidth;c>d&&(c=d);var e=this.dividerDiv.position+b.clientX-this.resizeDiv.lastPosition;this.splitPane.setPosition(this.isPercentPosition?e/(d-c):e)}else{var f=this.view.clientHeight;c>f&&(c=f);var e=this.dividerDiv.position+b.clientY-this.resizeDiv.lastPosition;this.splitPane.setPosition(this.isPercentPosition?e/(f-c):e)}this.splitPane.lastDividerLocation=this.splitPane.getPosition(),this.view.removeChild(this.resizeDiv.maskDiv),this.view.removeChild(this.resizeDiv),delete this.resizeDiv}}}),Gb.controls.TabPane=function(){Gb.controls.TabPane.superClass.constructor.apply(this,arguments),this._tabBox=new Gb.TabBox,this._tabBox.addDataBoxChangeListener(this.handleTabChange,this),this._tabBox.addDataPropertyChangeListener(this.handleTabChange,this),this._tabBox.addHierarchyChangeListener(this.handleTabChange,this),this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange,this),this._view=Ub.createView("hidden",!0),this._tabDiv=Ub.createDiv(),this._tabDiv.onmousedown=Ub.preventDefault,this._tabDiv.onkeydown=Ub.preventDefault,this._contentDiv=Ub.createDiv(),this._view.appendChild(this._tabDiv),this._view.appendChild(this._contentDiv),this._divPool=new Gb.Pool("div"),this._iconPool=new Gb.Pool("img"),this._closePool=new Gb.Pool("img"),this._textPool=new Gb.Pool("span"),this._resizePool=new Gb.Pool("div"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._closePool),this._pools.add(this._textPool),this._pools.add(this._resizePool),this.invalidateTab(),Ob.isTouchable&&new Gb.controls.TabPaneTouchInteraction(this),new Gb.controls.TabPaneInteraction(this)},Hb.ext("twaver.controls.TabPane",Gb.controls.ControlBase,{__accessor:["tabGap","tabRadius","tabHeight","horizontalAlign","tabOrientation","resizeTolerance","tabBackground","selectBackground","moveBackground","insertBackground","closeIcon","disabledColor"],__bool:["selectNextOnClose","selectNextOnInVisible"],_tabGap:Dd.TABPANE_TAB_GAP,_tabRadius:Dd.TABPANE_TAB_RADIUS,_tabHeight:Dd.TABPANE_TAB_HEIGHT,_resizeTolerance:Dd.TABPANE_RESIZE_TOLERANCE,_tabOrientation:Dd.TABPANE_TAB_ORIENTATION,_tabBackground:Dd.TABPANE_TAB_BACKGROUND,_disabledColor:Dd.TABPANE_DISABLED_COLOR,_selectBackground:Dd.TABPANE_SELECT_BACKGROUND,_moveBackground:Dd.TABPANE_MOVE_BACKGROUND,_insertBackground:Dd.TABPANE_INSERT_BACKGROUND,_horizontalAlign:Dd.TABPANE_HORIZONTAL_ALIGN,_closeIcon:Dd.TABPANE_CLOSE_ICON,_selectNextOnClose:Dd.TABPANE_SELECT_NEXT_ON_CLOSE,_selectNextOnInVisible:Dd.TABPANE_SELECT_NEXT_ON_INVISIBLE,onPropertyChanged:function(a){this.invalidateTab()},getTabBox:function(){return this._tabBox},getTabDiv:function(){return this._tabDiv},getContentDiv:function(){return this._contentDiv},handleTabChange:function(a){if(this._selectNextOnInVisible&&"visible"===a.property&&!a.newValue&&this._tabBox.getSelectionModel().contains(a.source)){for(var b,c,d=a.source,e=this._tabBox.getRoots().indexOf(d),f=this._tabBox.getRoots(),g=f.size(),h=e;g-1>h;)if(b=f.get(++h),b.isVisible()&&!b.isDisabled()){c=b;break}if(!c)for(h=e;h>0;)if(b=f.get(--h),b.isVisible()&&!b.isDisabled()){c=b;break}this._tabBox.getSelectionModel().setSelection(c)}this.invalidateTab()},invalidateTab:function(a){this._invalidateTab||(this._invalidateTab=!0,this.invalidate(a))},validateImpl:function(){this._invalidateTab&&(this._invalidateTab=!1,this.validateTab());var a,b=this._view.offsetWidth,c=this._view.offsetHeight;"top"===this._tabOrientation?(this._tabDiv.style.top="0px",a={x:0,y:this._tabHeight,width:b,height:Math.max(0,c-this._tabHeight)}):(this._tabDiv.style.top=c-this._tabHeight+"px",a={x:0,y:0,width:b,height:Math.max(0,c-this._tabHeight)}),this._currentView&&Hb.setViewBounds(this._currentView,a)},getCurrentTab:function(){return this._currentTab},getCurrentView:function(){return this._currentView},onViewRemoved:function(a){},onViewAdded:function(a){},validateTab:function(){this._currentTab=this._tabBox.getSelectionModel().getLastData();var a=this._currentTab?this._currentTab.getView():null;if(a!==this._currentView){var b,c;this._currentView&&(b=this._currentView.getView?this._currentView.getView():this._currentView,b.style.visibility="hidden",this.onViewRemoved(this._currentView)),a&&(c=a.getView?a.getView():a,c.style.visibility="inherit",c.parentNode||this._contentDiv.appendChild(c),this.onViewAdded(a)),this._currentView=a}Ub.release(this._tabDiv);for(var d=this._tabBox.getRoots(),e=this._tabHeight+"px",f=this._tabHeight-2+"px",g=this._tabRadius+"px",h=d.size(),i=0,j=0;h>j;j++){var k=d.get(j);if(k.isVisible()){var l=this._currentTab===k,m=k.getWidth();0>m&&(m=0);var n=Math.min(this._tabGap,m),o=this._divPool.get();o._tab=k;var p=o.style;p.position="absolute",p.whiteSpace="nowrap",p.lineHeight=f,p.overflow="hidden",p.textOverflow="ellipsis",p.background=l?this._selectBackground:this._tabBackground,p.textAlign=this._horizontalAlign,"top"===this._tabOrientation?(p.borderTopLeftRadius=g,p.borderTopRightRadius=g,p.borderBottomLeftRadius="0px",p.borderBottomRightRadius="0px"):(p.borderTopLeftRadius="0px",p.borderTopRightRadius="0px",p.borderBottomLeftRadius=g,p.borderBottomRightRadius=g),p.left=i+"px",p.width=m-n+"px",p.height=e,o._x=i,o._width=m-n,this.renderTab(o,k),this.onTabRendered(o,k),this._tabDiv.insertBefore(o,this._tabDiv.firstChild),i+=m,k.isResizable()&&(o=this._resizePool.get(),o._resizeTab=k,p=o.style,p.position="absolute",p.backgroundColor="white",p.opacity=0,p.left=i-n-this._resizeTolerance+"px",p.width=n+2*this._resizeTolerance+"px",p.height=e,this._tabDiv.appendChild(o))}}this._tabDiv.style.left="0px",this._tabDiv.style.width=i+"px",this._tabDiv.style.height=this._tabHeight+"px",this._pools.forEach(function(a){a.clear()})},renderTab:function(a,b){if(b.renderTab)b.renderTab(a);else{var c=b.getIcon();if(c){var d=this._iconPool.get();d.setAttribute("src",Hb.getImageSrc(c)),d.style.paddingLeft="4px",d.style.verticalAlign="middle",a.appendChild(d)}var e=b.getName();if(e){var f=this._textPool.get();f.style.whiteSpace="nowrap",f.style.verticalAlign="middle",f.style.padding="2px 4px",f.innerHTML=e,a.appendChild(f)}if(Ob.isOpera){var g=a.cloneNode(!1);g.style.left="0px",g.style.top="0px",g.style.opacity=0,a.appendChild(g)}}if(b.isClosable()){var h=this._tabRadius/4+2,d=this._closePool.get();d._closeTab=b,d.setAttribute("src",Hb.getImageSrc(this._closeIcon)),d.style.position="absolute",d.style.top=h+"px",d.style.right=h+"px",a.appendChild(d)}a.style.color=b.isDisabled()?this.getDisabledColor():""},onTabRendered:function(a,b){}}),Gb.controls.TabPaneInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv();var b=this;this.view.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1),this.view.addEventListener("mousemove",function(a){b.handleMouseMove(a)},!1)},Hb.ext("twaver.controls.TabPaneInteraction",Object,{handleMouseDown:function(a){if(0===a.button){if(this.movableDiv)return void this.handleMouseUp(a);this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.changeCursor(a),this.lastX=this.getX(a),this._startClient=Ub.getClientPoint(a),this._startLogicalX=this.lastX,Ub.handle_mousedown(this,a)}},changeCursor:function(a){var b="";if(a.target._resizeTab)b="ew-resize";else{var c=this.getTabAt(a);!c||c.isDisabled()&&!c.isMovable()||(b="pointer")}this.view.style.cursor=b},handleMouseMove:function(a){if(null==this.lastX)return void this.changeCursor(a);if(Ub.target===this){var b=this._startLogicalX+a.clientX-this._startClient.x;if(this.resizeTab){if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);10>c&&(c=10,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}}},handleMouseUp:function(a){if(0===a.button){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear()}},clear:function(){this.view.style.cursor="",this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX,delete this._startLogicalX,delete this._startClient},getTabAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){for(var b=this._startLogicalX+a.clientX-this._startClient.x,c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1,g=0;d>g;g++){var h=c.get(g);if(h===this.movableDiv._tab&&(f=!0),h.isVisible()){var i=h.getWidth();if(0>=i)continue;if(b>=e&&e+i>=b){var j=e+i/2>b;!f||h===this.movableDiv._tab&&j||g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),Gb.controls.TabPaneTouchInteraction=function(a){this.tabPane=a,this.view=a.getTabDiv(),Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.controls.TabPaneTouchInteraction",Object,{handleTouchstart:function(a){return Ub.preventDefault(a),this.movableDiv?void this.handleTouchend(a):(this.resizeTab=a.target._resizeTab,this.resizeTab||(this.movableDiv=this.getMovableDivAt(a)),this.lastX=this.getX(a),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),void Ub.addEventListener("touchend","handleTouchend",this.view,this))},handleTouchmove:function(a){if(null!=this.lastX)if(this.resizeTab){var b=this.getX(a);if(null!=this.stopX){if(b<this.stopX)return;delete this.stopX}var c=this.resizeTab.getWidth()+(b-this.lastX);0>c&&(c=0,this.stopX=b),this.resizeTab.setWidth(c),this.lastX=b}else if(this.movableDiv){var b=this.getX(a),d=b-this.lastX;if(!this.cloneDiv){if(Math.abs(d)<3)return;this.cloneDiv=this.movableDiv.cloneNode(!0),this.cloneDiv._x=this.movableDiv._x,this.cloneDiv.style.background=this.tabPane.getMoveBackground(),this.insertDiv=Ub.createDiv(),this.insertDiv.style.width="1px",this.insertDiv.style.height=this.cloneDiv.style.height,this.insertDiv.style.background=this.tabPane.getInsertBackground(),this.movableDiv.parentNode.appendChild(this.cloneDiv),this.movableDiv.parentNode.appendChild(this.insertDiv)}var e=this.cloneDiv._x+d;this.cloneDiv.style.left=e+"px",this.cloneDiv._x=e,this.lastX=b,this.tabInfo=this.getTabInfoAt(a),this.tabInfo&&(this.insertDiv.style.left=this.tabInfo.position)}},handleTouchend:function(a){if(this.resizeTab);else if(this.movableDiv&&this.tabInfo){var b=this.movableDiv._tab,c=this.tabInfo.index;this.tabPane.getTabBox().moveTo(b,c)}else{var d=this.tabPane.getTabBox(),b=a.target._closeTab;if(b)if(this.tabPane.isSelectNextOnClose()&&this.tabPane.getCurrentTab()===b){var e=d.getRoots(),c=e.indexOf(b);d.remove(b),e.size()>0&&(c>=e.size()&&(c=e.size()-1),d.getSelectionModel().setSelection(e.get(c)))}else d.remove(b);else{var b=this.getTabAt(a);b&&!b.isDisabled()&&d.getSelectionModel().setSelection(b)}}this.clear(),Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)},clear:function(){this.cloneDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.cloneDiv),this.insertDiv&&this.movableDiv&&this.movableDiv.parentNode.removeChild(this.insertDiv),delete this.movableDiv,delete this.tabInfo,delete this.insertDiv,delete this.cloneDiv,delete this.resizeTab,delete this.stopX,delete this.lastX},getTabAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b},getMovableDivAt:function(a){a=a.target;for(var b;a&&a!==this.view&&!(b=a._tab);)a=a.parentNode;return b&&b.isMovable()?a:null},getX:function(a){var b=Ub.getLogicalPoint(this.view,a);return b?b.x:null},getTabInfoAt:function(a){for(var b=this.getX(a),c=this.tabPane.getTabBox().getRoots(),d=c.size(),e=0,f=!1,g=0;d>g;g++){var h=c.get(g);if(h===this.movableDiv._tab&&(f=!0),h.isVisible()){var i=h.getWidth();if(0>=i)continue;if(b>=e&&e+i>=b){var j=e+i/2>b;!f||h===this.movableDiv._tab&&j||g--;var k=j?Math.max(0,g):Math.min(g+1,d),l=j?e:e+i;return l=Math.max(0,l-1),{index:k,tab:h,position:l+"px"}}e+=i}}return this.tabInfo}}),Gb.controls.TitlePane=function(a,b,c){Gb.controls.TitlePane.superClass.constructor.apply(this,arguments),this.invalidate(),this._titleDiv=Ub.createDiv(),this._titleDiv.tabIndex=-1,this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.fontWeight="bold",this._titleDiv.style.textOverflow="ellipsis",this._titleDiv.style.overflow="hidden",this._titleDiv.style.whiteSpace="nowrap",this._titleDiv.onmousedown=Ub.preventDefault,this._span=Mb.createElement("span"),this._span.style.verticalAlign="middle",this._span.style.paddingLeft="4px",this._span.style.paddingRight="4px",this._img=Mb.createElement("img"),this._img.style.verticalAlign="middle",this._img.style.paddingLeft="4px",this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,this._view.appendChild(this._titleDiv),b&&this.setTitle(b),a&&this.setContent(a),c&&this.setIcon(c)},Hb.ext("twaver.controls.TitlePane",Gb.controls.ControlBase,{__accessor:["icon","title","titleHeight","titleHorizontalAlign","titleBackground"],_titleHeight:Dd.TITLEPANE_TITLE_HEIGHT,_titleBackground:Dd.TITLEPANE_TITLE_BACKGROUND,_titleHorizontalAlign:Dd.TITLEPANE_TITLE_HORIZONTAL_ALIGN,onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getContent:function(){return this._content},setContent:function(a){if(this._content!==a){var b=this._content;b&&this._view.removeChild(b.getView?b.getView():b),this._content=a,a&&this._view.appendChild(a.getView?a.getView():a),this.firePropertyChange("content",b,a)}},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=this._titleDiv.style;c.textAlign=this._titleHorizontalAlign,c.lineHeight=this._titleHeight-2+"px",c.background=this._titleBackground,Ub.clear(this._titleDiv),this._icon&&(this._img.setAttribute("src",Hb.getImageSrc(this._icon)),this._titleDiv.appendChild(this._img)),this._title&&(this._span.innerHTML=this._title,this._span.setAttribute("title",this._title),this._titleDiv.appendChild(this._span));var c=this._titleDiv.style;c.left="0px",c.top="0px",c.width=a+"px",c.height=this._titleHeight+"px",Hb.setViewBounds(this._content,{x:0,y:this._titleHeight,width:a,height:Math.max(b-this._titleHeight,0)})}}),Gb.controls.Accordion=function(){Gb.controls.Accordion.superClass.constructor.apply(this,arguments),this._titleMap={},this._titleList=new md,this._currentTitle=null,this._currentView=null,this._view=Ub.createView("hidden",!0),this.invalidate();var a=this;this._view.addEventListener("mousedown",function(b){a.handleMouseDown(b)},!1)},Hb.ext("twaver.controls.Accordion",Gb.controls.ControlBase,{__accessor:["expandIcon","collapseIcon","titleHeight","titleBackground","borderBottomColor","iconPosition"],_expandIcon:Dd.ACCORDION_EXPAND_ICON,_collapseIcon:Dd.ACCORDION_COLLAPSE_ICON,_titleHeight:Dd.ACCORDION_TITLE_HEIGHT,_titleBackground:Dd.ACCORDION_TITLE_BACKGROUND,_borderBottomColor:Dd.ACCORDION_BORDER_BOTTOM_COLOR,_iconPosition:Dd.ACCORDION_ICON_POSITION,onPropertyChanged:function(a){this.invalidate()},handleMouseDown:function(a){if(0===a.button){var b=a.target._title;b||(b=a.target.parentNode._title),b&&(this._currentTitle===b?this.collapse():this.expand(b))}},getTitles:function(){return this._titleList},getCurrentTitle:function(){return this._currentTitle},add:function(a,b){if(this._titleMap[a])throw"Title ' + title + ' already exists";var c=Ub.createDiv();c._title=a,c.onmousedown=Ub.preventDefault,c.style.cursor="pointer",c.style.textAlign="left",c.style.textOverflow="ellipsis",c.style.whiteSpace="nowrap",c.style.overflow="hidden",c.style.borderBottomWidth="1px",c.style.borderBottomStyle="solid";var d=Mb.createElement("img");d.style.verticalAlign="middle",d.style.paddingLeft="4px";var e=Mb.createElement("span");if(e.style.verticalAlign="middle",e.style.paddingLeft="4px",e.innerHTML=a,e.setAttribute("title",a),this._view.appendChild(c),c.appendChild(d),c.appendChild(e),"right"==this._iconPosition){var f=d.style,g=(this._titleHeight-8)/2;f.marginTop=g+"px",f.right="15px",f.position="absolute"}this._titleMap[a]={content:b,titleDiv:c,span:e,img:d},this._titleList.add(a),this.invalidate();

},remove:function(a){var b=this._titleMap[a];b&&this._view.removeChild(b.titleDiv),delete this._titleMap[a],this._titleList.remove(a),this.invalidate()},clear:function(){var a=this;Object.keys(a._titleMap).forEach(function(b){a._view.removeChild(a._titleMap[b].titleDiv)}),a._titleMap={},a._titleList.clear(),a.invalidate()},expand:function(a){this._titleMap[a]&&this._currentTitle!==a&&(this._currentTitle=a,this.onExpanded(a),this.invalidate())},onExpanded:function(a){},collapse:function(){this._currentTitle&&(this.onCollapsed(this._currentTitle),this._currentTitle=null,this.invalidate())},onCollapsed:function(a){},validateImpl:function(){var a=this._currentView;this._currentView=null;for(var b=this._view.offsetWidth,c=this._view.offsetHeight,d=this._titleList.size(),e=0,f=0;d>f;f++){var g=this._titleList.get(f),h=this._titleMap[g],i=h.titleDiv.style;i.lineHeight=this._titleHeight-3+"px",i.background=this._titleBackground,i.borderBottomColor=this._borderBottomColor,i.left="0px",i.top=e+"px",i.width=b+"px",i.height=this._titleHeight-1+"px";var j=this._currentTitle===g,k=j?this._expandIcon:this._collapseIcon;if(h.img.setAttribute("src",Hb.getImageSrc(k)),j){var l=Math.max(0,c-d*this._titleHeight);h.content&&(this._currentView=h.content.getView?h.content.getView():h.content,Hb.setViewBounds(h.content,{x:0,y:e+this._titleHeight,width:b,height:l}),h.content.style.overflowY="auto"),e+=this._titleHeight+l}else e+=this._titleHeight}this._currentView&&this._currentView!==a&&this._view.appendChild(this._currentView),a&&a!==this._currentView&&this._view.removeChild(a)}}),Gb.controls.BorderPane=function(a,b,c,d,e){Gb.controls.BorderPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._view=Ub.createView("hidden",!0),this._view.tabIndex=-1,a&&this.setCenter(a),b&&this.setTop(b),c&&this.setRight(c),d&&this.setBottom(d),e&&this.setLeft(e)},Hb.ext("twaver.controls.BorderPane",Gb.controls.ControlBase,{__accessor:["hGap","vGap","topHeight","bottomHeight","leftWidth","rightWidth"],_hGap:Dd.BORDERPANE_HGAP,_vGap:Dd.BORDERPANE_VGAP,_topHeight:0,_bottomHeight:0,_leftWidth:0,_rightWidth:0,onPropertyChanged:function(a){this.invalidate()},getCenter:function(){return this._center},setCenter:function(a){this._setContent("center",a)},getTop:function(){return this._top},setTop:function(a){this._setContent("top",a)},getRight:function(){return this._right},setRight:function(a){this._setContent("right",a)},getBottom:function(){return this._bottom},setBottom:function(a){this._setContent("bottom",a)},getLeft:function(){return this._left},setLeft:function(a){this._setContent("left",a)},_setContent:function(a,b){var c=this["_"+a];if(c!==b){if(c){var d=c.getView?c.getView():c;this._view.contains(d)&&this._view.removeChild(d)}this["_"+a]=b,b&&this._view.appendChild(b.getView?b.getView():b),this.firePropertyChange(a,c,b)}},validateImpl:function(){var a=this._view.offsetWidth,b=this._view.offsetHeight,c=0,d=0,e=a,f=b,g=0,h=0,i=0,j=0;this._top&&(g=this._topHeight||(this._top.getView?this._top.getView().offsetHeight:this._top.offsetHeight),d=g+this._vGap),this._bottom&&(h=this._bottomHeight||(this._bottom.getView?this._bottom.getView().offsetHeight:this._bottom.offsetHeight),f=b-h-this._vGap),this._left&&(i=this._leftWidth||(this._left.getView?this._left.getView().offsetWidth:this._left.offsetWidth),c=i+this._hGap),this._right&&(j=this._rightWidth||(this._right.getView?this._right.getView().offsetWidth:this._right.offsetWidth),e=a-j-this._hGap);var k=Math.max(0,e-c),l=Math.max(0,f-d);this._top&&Hb.setViewBounds(this._top,{x:0,y:0,width:a,height:g}),this._bottom&&Hb.setViewBounds(this._bottom,{x:0,y:f,width:a,height:h}),this._left&&Hb.setViewBounds(this._left,{x:0,y:d,width:i,height:l}),this._right&&Hb.setViewBounds(this._right,{x:e,y:d,width:j,height:l}),this._center&&Hb.setViewBounds(this._center,{x:c,y:d,width:k,height:l})}}),Gb.controls.PopupMenu=function(a){this._view=Ub.createDiv(),this._view.style.zIndex=100001,this._items=[],this._itemsMap={},this.setContextView(a);var b=this._view,c=this;b.addEventListener("mouseover",function(a){c._mouseOver=!0},!1),b.addEventListener("mouseout",function(a){c._mouseOver=!1},!1),b.oncontextmenu=function(a){a.preventDefault()},Ub.addEventListener("mousedown","_handleClick",b,this)},Hb.ext("twaver.controls.PopupMenu",Object,{_width:200,_xOffset:0,_yOffset:0,_menuItemHeight:25,_background:"#F9F9F9",_border:"2px outset white",_disabledColor:"#BABBBC",_focusColor:"white",_focusBackground:"#C2CFF1",_color:"black",_subMenuEnableIcon:Dd.POPUPMENU_SUBNENU_ENABLE_ICON,_subMenuDisableIcon:Dd.POPUPMENU_SUBNENU_DISABLE_ICON,_checkboxSelectedIcon:Dd.POPUPMENU_CHECKBOX_SELECTED_ICON,_checkboxUnselectedIcon:Dd.POPUPMENU_CHECKBOX_UNSELECTED_ICON,_radiobuttonSelectedIcon:Dd.POPUPMENU_RADIOBUTTON_SELECTED_ICON,_radiobuttonUnselectedIcon:Dd.POPUPMENU_RADIOBUTTON_UNSELECTED_ICON,getView:function(){return this._view},getContextView:function(){return this._contextView},setContextView:function(a){if(this._removeContextmenuListener(),this._contextView=a,a){var b=a.getView?a.getView():a;Ob.isTouchable?(b.addEventListener("touchstart",this._getTouchStartListener(),!1),b.addEventListener("touchmove",this._getTouchMoveListener(),!1),b.addEventListener("touchend",this._getTouchEndListener(),!1),Ub.addEventListener("contextmenu","_handleContextmenu",b,this)):Ub.addEventListener("contextmenu","_handleContextmenu",b,this)}},getMenuItems:function(){return this._items},setMenuItems:function(a){if(this._items=[],this._itemsMap={},a)for(var b=0,c=a.length;c>b;b++)this.addMenuItem(a[b])},addMenuItem:function(a){a.separator!==!0&&(this._itemsMap[a.id||a.label]=a),this._items.push(a)},getMenuItem:function(a){return this._itemsMap[a]},addSeparator:function(){this.addMenuItem({separator:!0})},getMenuItemById:function(a){return this._itemsMap[a]},isVisible:function(a){return a.visible!==!1},isEnabled:function(a){return a.enabled!==!1},show:function(a){this.hide();var b,c,d=this._view,e=this._view.style;if(Ob.isTouchable?(b=a.changedTouches&&a.changedTouches[0].clientX||a.clientX,c=a.changedTouches&&a.changedTouches[0].clientY||a.clientY):(b=a.clientX,c=a.clientY),Ub.clear(d),this.renderMenu(d,this._items),0!==this._height){Ob.isTouchable&&Ub.addEventListener("touchstart","_handleBodyClicked",Mb.body,this),Ub.addEventListener("mousedown","_handleBodyClicked",Mb.body,this);var f=Ub.windowWidth()-this._width-10,g=Ub.windowHeight()-this._height-10;b=b>f?f:b,c=c>g?g:c,b=0>b?0:b,c=0>c?0:c,e.left=b+yc.scrollLeft()+this._xOffset+"px",e.top=c+yc.scrollTop()+this._yOffset+"px",Mb.body.appendChild(d)}},_showMenuItem:function(a,b){this._hideMenuItem(b);var c=Mb.createElement("div");b.menuItem.childrenDiv=c;var d=c.style;d.color="#000000",d.position="absolute";var e=this._width,f=b.offsetTop,g=b.menuItem.items;if(this._itemsShow=!0,b._itemsShow=!0,Ub.clear(c),this.renderMenu(c,g),0!==this._height){var h=Ub.windowWidth()-this._width-10,i=Ub.windowHeight()-10,j=this._getPosition(this._view);e=j.left+this._width>h?-this._width:e,f=j.top+f+g.length*this._menuItemHeight>i?f-(g.length-1)*this._menuItemHeight:f,d.left=e+"px",d.top=f+"px",b.appendChild(c)}},hide:function(){Mb.body.contains(this._view)&&Mb.body.removeChild(this._view),delete this._mouseOver,delete this._itemsShow,Ob.isTouchable&&Ub.removeEventListener("touchstart",Mb.body,this),Ub.removeEventListener("mousedown",Mb.body,this)},_hideMenuItem:function(a){var b=a.menuItem.childrenDiv;b&&a.contains(b)&&a.removeChild(b),this._itemsShow=!1,a._itemsShow=!1},dispose:function(){this._removeContextmenuListener(),this.hide()},onMenuShowing:function(a){return!0},onAction:function(a){},renderMenu:function(a,b){var c=a.style;c.background=this._background,c.border=this._border,c.width=this._width+"px",this._height=0,delete this._separator,a.menuItems=b;for(var d,e=0,f=b.length;f>e;e++)if(d=b[e],this.isVisible(d))if(d.separator===!0)this._separator=!0;else{var g=Mb.createElement("div");this.isEnabled(d)&&this._addMouseoverListener(g,d),g._itemsShow=!1,g.menuItem=d,a.appendChild(g),this.renderMenuItem(g,d),this.onMenuItemRendered(g,d),this._separator=!1,this._height+=this._menuItemHeight}},renderMenuItem:function(a,b){var c=a.style;c.height=this._menuItemHeight+"px",this._separator&&(c.borderTop="1px solid gray"),this.isEnabled(b)||(c.color=this._disabledColor);var d=Mb.createElement("span");c=d.style,c.position="absolute",c.width="25px",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.textAlign="center",a.appendChild(d);var e;if("check"===b.type?e=b.selected?this._checkboxSelectedIcon:this._checkboxUnselectedIcon:"radio"===b.type?e=b.selected?this._radiobuttonSelectedIcon:this._radiobuttonUnselectedIcon:b.icon&&(e=b.icon),e){var f=new Nb;f.src=Hb.getImageSrc(e),f.style.verticalAlign="middle",d.appendChild(f)}var g=Mb.createElement("label");if(Hb.setText(g,b.label,!0),c=g.style,c.position="absolute",c.height=this._menuItemHeight+"px",c.lineHeight=this._menuItemHeight+"px",c.left="25px",a.appendChild(g),b.items&&a.parentNode){var h=Mb.createElement("img");c=h.style,this.isEnabled(b)?h.setAttribute("src",Hb.getImageSrc(this._subMenuEnableIcon)):h.setAttribute("src",Hb.getImageSrc(this._subMenuDisableIcon));var i=(this._menuItemHeight-8)/2;c.marginTop=i+"px",c.right="5px",c.position="absolute",a.appendChild(h)}},onMenuItemRendered:function(a,b){},_addMouseoverListener:function(a,b){{var c=this;this._contextView}Ob.isTouchable&&(a.addEventListener("touchstart",function(d){a.style.background=c._focusBackground,a.style.color=c._focusColor,this===d.relatedTarget||this.contains(d.relatedTarget)||b.items&&!c._itemsShow&&a.parentNode==c._view&&c._showMenuItem(d,a)},!1),a.addEventListener("touchend",function(d){if(a.style.background=c._background,a.style.color=c._color,this!==d.relatedTarget&&!this.contains(d.relatedTarget)&&b.items&&a.parentNode===c._view){var e=d.clientX,f=d.clientY,g=b.childrenDiv,h=c._getPosition(g);(e<h.left+2||e>h.left+g.offsetWidth-2||f<h.top+2||f>h.top+g.offsetHeight-2)&&c._hideMenuItem(a)}},!1)),a.addEventListener("mouseenter",function(d){a.style.background=c._focusBackground,a.style.color=c._focusColor,this===d.relatedTarget||this.contains(d.relatedTarget)||b.items&&!this._itemsShow&&this.parentNode&&c._showMenuItem(d,this)},!1),a.addEventListener("mouseleave",function(a){if(this.style.background=c._background,this.style.color=c._color,this!==a.relatedTarget&&!this.contains(a.relatedTarget)&&b.items&&this.parentNode){var d=a.clientX,e=a.clientY,f=b.childrenDiv,g=c._getPosition(f);(d<g.left+2||d>g.left+f.offsetWidth-2||e<g.top+2||e>g.top+f.offsetHeight-2)&&c._hideMenuItem(this)}},!1)},_getPosition:function(a){for(var b=0,c=0;a;)c+=a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;return{left:c,top:b}},_removeContextmenuListener:function(){var a=this._contextView;a&&(a=a.getView?a.getView():a,Ob.isTouchable?(a.removeEventListener("touchstart",this._getTouchStartListener(),!1),a.removeEventListener("touchmove",this._getTouchMoveListener(),!1),a.removeEventListener("touchend",this._getTouchEndListener(),!1),Ub.removeEventListener("contextmenu",a,this)):Ub.removeEventListener("contextmenu",a,this))},_handleContextmenu:function(a){this.onMenuShowing(a)===!0&&this.show(a),a.preventDefault()},_handleBodyClicked:function(a){if(Ob.isTouchable){for(var b=a.target;b&&b!==this._view;)b=b.parentElement;b!==this._view&&this.hide()}else this._mouseOver||this.hide()},_handleClick:function(a){if(0===a.button){for(var b=a.target;!b.menuItem&&b.parentElement;)b=b.parentElement;var c=b?b.menuItem:null;c&&this.isEnabled(c)&&("check"===c.type&&(c.selected=!c.selected),"radio"===c.type&&(c.groupName?(c.selected=!0,this._items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1),a.items&&a.items.forEach(function(a){c!==a&&a.groupName===c.groupName&&(a.selected=!1)})})):c.selected=!c.selected),c.action&&c.action(c),this.onAction(c),c.items&&c.items.length>0||this.hide())}},_getTouchStartListener:function(){if(!this._touchStartListener){var a=this;this._touchStartListener=function(b){a._touchMoved=!1,a._lastTouch=new Date}}return this._touchStartListener},_getTouchMoveListener:function(){if(!this._touchMoveListener){var a=this;this._touchMoveListener=function(b){a._touchMoved=!0}}return this._touchMoveListener},_getTouchEndListener:function(){if(!this._touchEndListener){var a=this;this._touchEndListener=function(b){!a._touchMoved&&(new Date).getTime()-a._lastTouch.getTime()>1e3&&a._handleContextmenu(b)}}return this._touchEndListener},getWidth:function(){return this._width},setWidth:function(a){this._width=a},getMenuItemHeight:function(){return this._menuItemHeight},setMenuItemHeight:function(a){this._menuItemHeight=a},getBackground:function(){return this._background},setBackground:function(a){this._background=a},getBorder:function(){return this._border},setBorder:function(a){this._border=a},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(a){this._disabledColor=a},getFocusColor:function(){return this._focusColor},setFocusColor:function(a){this._focusColor=a},getFocusBackground:function(){return this._focusBackground},setFocusBackground:function(a){this._focusBackground=a},getColor:function(){return this._color},setColor:function(a){this._color=a},getSubMenuEnableIcon:function(){return this._subMenuEnableIcon},setSubMenuEnableIcon:function(a){this._subMenuEnableIcon=a},getSubMenuDisableIcon:function(){return this._subMenuDisableIcon},setSubMenuDisableIcon:function(a){this._subMenuDisableIcon=a},getCheckboxSelectedIcon:function(){return this._checkboxSelectedIcon},setCheckboxSelectedIcon:function(a){this._checkboxSelectedIcon=a},getCheckboxUnselectedIcon:function(){return this._checkboxUnselectedIcon},setCheckboxUnselectedIcon:function(a){this._checkboxUnselectedIcon=a},getRadiobuttonSelectedIcon:function(){return this._radiobuttonSelectedIcon},setRadiobuttonSelectedIcon:function(a){this._radiobuttonSelectedIcon=a},getRadiobuttonUnselectedIcon:function(){return this._radiobuttonUnselectedIcon},setRadiobuttonUnselectedIcon:function(a){this._radiobuttonUnselectedIcon=a},getXOffset:function(){return this._xOffset},setXOffset:function(a){this._xOffset=a},getYOffset:function(){return this._yOffset},setYOffset:function(a){this._yOffset=a}}),Gb.charts.IS_INVALIDATE_PROPERTY={xZoom:1,xTranslate:1,yZoom:1,yTranslate:1},Gb.charts.ChartBase=function(a){Gb.charts.ChartBase.superClass.constructor.apply(this,arguments),this._uniqueColors={},this._nonDataColors={},this._publishedDatas=new md,this._view=Ub.createView("hidden"),this._canvas=Ub.createCanvas(),this._view.appendChild(this._canvas),this.setDataBox(a?a:new Gb.ElementBox),this.invalidate(),Ob.isTouchable?Ob.isMSTouchable?new Gb.charts.ChartMSTouchInteraction(this):(new Gb.charts.ChartTouchInteraction(this),new Gb.charts.ChartInteraction(this)):new Gb.charts.ChartInteraction(this),this.setToolTipEnabled(Dd.CHART_TOOLTIP_ENABLED)},Hb.ext("twaver.charts.ChartBase",Gb.controls.ViewBase,{__accessor:["xGap","yGap","xTranslate","yTranslate","valueVisible","sortFunction","visibleFunction","xTranslateEnabled","yTranslateEnabled","xZoomEnabled","yZoomEnabled","selectTolerance","backgroundVisible","backgroundFill","backgroundFillColor","backgroundOutlineWidth","backgroundOutlineColor","backgroundGradient","backgroundGradientColor","outerZoom"],__bool:["doubleClickToReset","focusOnClick"],_backgroundVisible:Dd.CHART_BACKGROUND_VISIBLE,_backgroundFill:Dd.CHART_BACKGROUND_FILL,_backgroundFillColor:Dd.CHART_BACKGROUND_FILL_COLOR,_backgroundOutlineWidth:Dd.CHART_BACKGROUND_OUTLINE_WIDTH,_backgroundOutlineColor:Dd.CHART_BACKGROUND_OUTLINE_COLOR,_backgroundGradient:Dd.CHART_BACKGROUND_GRADIENT,_backgroundGradientColor:Dd.CHART_BACKGROUND_GRADIENT_COLOR,_selectTolerance:Dd.CHART_SELECT_TOLERANCE,_doubleClickToReset:Dd.CHART_DOUBLE_CLICK_TO_RESET,_focusOnClick:Dd.FOCUS_ON_CLICK,_sortFunction:null,_visibleFunction:null,_canvasWidth:0,_canvasHeight:0,_outerZoomL:1,_xGap:Dd.CHART_XGAP,_yGap:Dd.CHART_YGAP,_xTranslate:0,_yTranslate:0,_xTranslateEnabled:Dd.CHART_XTRANSLATE_ENABLED,_yTranslateEnabled:Dd.CHART_YTRANSLATE_ENABLED,_xZoom:1,_yZoom:1,_maxZoom:Dd.ZOOM_MAX,_minZoom:Dd.ZOOM_MIN,_xZoomEnabled:Dd.CHART_XZOOM_ENABLED,_yZoomEnabled:Dd.CHART_YZOOM_ENABLED,_valueVisible:Dd.CHART_VALUE_VISIBLE,_valueFont:Dd.CHART_VALUE_FONT,isToolTipEnabled:function(){return this._toolTipListener?!0:!1},setToolTipEnabled:function(a){if(a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){Ac.showToolTip(a,b.getToolTip(a))},this._canvas.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._canvas.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},getToolTip:function(a){if(this._toolTipInfos){var b=this.getLogicalPoint(a);b.x-=this._xTranslate,b.y-=this._yTranslate;for(var c=this._toolTipInfos.size(),d=c-1;d>=0;d--){var e=this._toolTipInfos.get(d);if(e.rect&&Rb.containsPoint(e.rect,b))return this.getToolTipByData(e.data,e)}}else{var f=this.tryGetDataAt(a);if(f)return this.getToolTipByData(f,{value:this.getValue(f)})}return null},getToolTipByData:function(a,b){return void 0!==b.value?this.formatValueText(b.value,a):null},addToolTipInfo:function(a,b,c,d,e,f,g){this._toolTipInfos&&this._toolTipInfos.add({data:f,rect:{x:a,y:b,width:c,height:d},value:e,index:g})},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._canvas,a,this._outerZoom)},getTextSize:function(a,b){var c=Vb.getTextSize(a,b);return c.width&&(c.width+=4),c},getUniqueColor:function(a,b){if(null==a)return null;var c;if(!b&&(c=this._nonDataColors[a]))return c;var d=Vb.getColorArray(a);if(!b)return c=255!=d[3]?a:"rgba("+d[0]+","+d[1]+","+d[2]+",0.99)",this._nonDataColors[a]=c,c;var e="rgb("+d[0]+","+d[1]+","+d[2]+")";if(void 0===this._uniqueColors[e]||this._uniqueColors[e]===b);else{var f=1,g=-1,h=1;for(Ob.isOpera&&(d=[d[0],d[1],d[2]]);;){if(d[0]+=f,d[0]>=255?(d[0]=255,f=-1):d[0]<=0&&(d[0]=0,f=1),e="rgb("+d[0]+","+d[1]+","+d[2]+")",void 0===this._uniqueColors[e]||this._uniqueColors[e]===b)break;if(d[1]+=g,d[1]>=255?(d[1]=255,g=-1):d[1]<=0&&(d[1]=0,g=1),e="rgb("+d[0]+","+d[1]+","+d[2]+")",void 0===this._uniqueColors[e]||this._uniqueColors[e]===b)break;if(d[2]+=h,d[2]>=255?(d[2]=255,h=-1):d[2]<=0&&(d[2]=0,h=1),e="rgb("+d[0]+","+d[1]+","+d[2]+")",void 0===this._uniqueColors[e]||this._uniqueColors[e]===b)break}}return this._uniqueColors[e]=b,e},tryGetDataAt:function(a,b){if((null==b||0>b)&&(b=this._selectTolerance),a.target&&(a=Ub.getLogicalPoint(this._canvas,arguments[0],this._outerZoom)),!a)return null;var c=a.x-b,d=a.y-b,e=2*b+1,f=2*b+1;try{for(var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data,h=0,i=g.length;i>h;h+=4)if(255===g[h+3]){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null},_getPoint:function(){var a,b;if(2===arguments.length)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=Ub.getLogicalPoint(this._canvas,arguments[0],this._outerZoom);if(!c)return null;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;return{x:a,y:b}},getDataAt:function(){var a=this._getPoint.apply(this,arguments),b=a.x,c=a.y;if(0>b||0>c||b>this._canvasWidth||c>this._canvasHeight)return null;try{var d=this._canvas.getContext("2d").getImageData(b,c,1,1).data;if(255===d[3]){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null},getBackgroundRect:function(){return this._backgroundRect},drawBackground:function(a,b){this._backgroundRect=Hb.clone(b),null!=b&&b.width>0&&b.height>0&&this._backgroundVisible&&(this._backgroundFill&&Vb.fill(a,this.getUniqueColor(this._backgroundFillColor),this._backgroundGradient,this.getUniqueColor(this._backgroundGradientColor),b),this._backgroundOutlineWidth>0&&(a.lineWidth=this._backgroundOutlineWidth,a.strokeStyle=this._backgroundOutlineColor),a.beginPath(),a.rect(b.x,b.y,b.width,b.height),a.closePath(),this._backgroundFill&&a.fill(),this._backgroundOutlineWidth>0&&a.stroke())},getName:function(a){return a.getName()},getColor:function(a){return a.getStyle?a.getStyle("chart.color"):a.getClient("chart.color")},getValue:function(a){return a.getStyle?a.getStyle("chart.value"):0},getValueColor:function(a){return a.getStyle?a.getStyle("chart.value.color"):Gb.Styles.getStyle("chart.value.color")},setValueFont:function(a){if(a!==this._valueFont){var b=a;this._valueFont=a,this.firePropertyChange("valueFont",b,a)}},getValueFont:function(a){if(a){var b=a.getStyle?a.getStyle("chart.value.font"):Gb.Styles.getStyle("chart.value.font");if(b)return b}return this._valueFont},formatValueText:function(a,b){return a},getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this.canvasHeight},getCanvas:function(){return this._canvas},isVisible:function(a){return this._internalVisibleFunction&&!this._internalVisibleFunction(a)?!1:this._visibleFunction?this._visibleFunction(a):!0},onPropertyChanged:function(a){Gb.charts.IS_INVALIDATE_PROPERTY[a.property]?this.invalidate():this.invalidateModel()},getDataBox:function(){return this._box},setDataBox:function(a){if(!a)throw"DataBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleDataBoxChange,this),b.removeDataPropertyChangeListener(this.handlePropertyChange,this),b.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",b,this._box)}},handleDataBoxChange:function(a){this.invalidateModel()},handlePropertyChange:function(a){this.invalidateModel()},handleHierarchyChange:function(a){this.invalidateModel()},handleSelectionChange:function(a){this.invalidateModel()},getUnfilteredDatas:function(){return this._unfilteredDatas?this._unfilteredDatas:this._publishedDatas},getPublishedDatas:function(){return this._publishedDatas},createPublishedDatas:function(){return this._unfilteredDatas=new md,this._buildChildren(this._box.getRoots(),this._unfilteredDatas),this._sortFunction&&this._unfilteredDatas.sort(this._sortFunction),this._unfilteredDatas.toList(this.isVisible,this)},_buildChildren:function(a,b){a.forEach(function(a){b.add(a),this._buildChildren(a.getChildren(),b)},this)},invalidateModel:function(){this._invalidateModel||(this._invalidateModel=!0,this.invalidate())},validateImpl:function(){this._invalidateModel&&(this._invalidateModel=!1,this._uniqueColors={},this._nonDataColors={},this._publishedDatas=this.createPublishedDatas(),this._publishedDatas.forEach(function(a){a.IStyle?a.getStyle("chart.color")||a.setStyle("chart.color",Hb.nextColor()):a.getClient("chart.color")||a.setClient("chart.color",Hb.nextColor())}),this.validateModel());var a=this._canvas.getContext("2d");this._canvasWidth=this._view.clientWidth,this._canvasHeight=this._view.clientHeight,this._canvas.setAttribute("width",this._canvasWidth),this._canvas.setAttribute("height",this._canvasHeight),a.clearRect(0,0,this._canvasWidth,this._canvasHeight),Gb.Util.makeHighRes(this._canvas),this._canvasWidth>0&&this._canvasHeight>0&&(a.translate(this._xTranslate,this._yTranslate),this._valueTexts=this._valueVisible?new md:null,this.validateDisplay(a,this._canvasWidth*this._xZoom,this._canvasHeight*this._yZoom),delete this._valueTexts,a.translate(-this._xTranslate,-this._yTranslate))},adjustBounds:function(a){Gb.charts.ChartBase.superClass.adjustBounds.apply(this,arguments)},validateModel:function(){},validateDisplay:function(a,b,c){},drawLine:function(a,b,c,d,e,f,g){c>0&&(a.lineWidth=c,a.strokeStyle=this.getUniqueColor(b),a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke())},drawValueTexts:function(a){this._valueTexts&&this._valueTexts.forEach(function(b){Vb.drawText(a,b.text,b,b.font,b.color)})},drawVerticalText:function(a,b,c,d,e){e=this.getUniqueColor(e),a.translate(c.x,c.y),a.rotate(-Math.PI/2),Vb.drawText(a,b,null,d,e),a.rotate(Math.PI/2),a.translate(-c.x,-c.y)},_getValueTextInfo:function(a,b){if(this._valueTexts){var c=this.formatValueText(b,a);if(c&&""!==c){var d=this.getValueColor(a),e={text:c,font:this.getValueFont(a),color:this.getUniqueColor(d,a)};return this._valueTexts.add(e),e}}return null},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){if(!(0>a)){var b=this._maxZoom;this._maxZoom=a,this.firePropertyChange("maxZoom",b,a),this.getXZoom()>a&&this.setXZoom(a,!1),this.getYZoom()>a&&this.setYZoom(a,!1)}},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){if(!(0>a)){var b=this._minZoom;this._minZoom=a,this.firePropertyChange("minZoom",b,a),this.getXZoom()<a&&this.setXZoom(a),this.getYZoom()<a&&this.setYZoom(a)}},zoomIn:function(a){null==a&&(a=Dd.ZOOM_ANIMATE),a?Gb.animate.AnimateManager.start(new Gb.animate.AnimateXYZoom(this,this._xZoom*Dd.ZOOM_INCREMENT,this._yZoom*Dd.ZOOM_INCREMENT)):(this.xZoomIn(!1),this.yZoomIn(!1))},zoomOut:function(a){null==a&&(a=Dd.ZOOM_ANIMATE),a?Gb.animate.AnimateManager.start(new Gb.animate.AnimateXYZoom(this,this._xZoom/Dd.ZOOM_INCREMENT,this._yZoom/Dd.ZOOM_INCREMENT)):(this.xZoomOut(!1),this.yZoomOut(!1))},zoomReset:function(a){null==a&&(a=Dd.ZOOM_ANIMATE),a?Gb.animate.AnimateManager.start(new Gb.animate.AnimateXYZoom(this,1,1)):(this.xZoomReset(!1),this.yZoomReset(!1))},getXZoom:function(){return this._xZoom},onXZoomChanged:function(a,b){},xZoomIn:function(a){this.setXZoom(this._xZoom*Dd.ZOOM_INCREMENT,a)},xZoomOut:function(a){this.setXZoom(this._xZoom/Dd.ZOOM_INCREMENT,a)},xZoomReset:function(a){this.setXZoom(1,a)},setXZoom:function(a,b){if(Hb.num(a)&&!(0>=a)&&(a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a!==this.xZoom))if(null==b&&(b=Dd.ZOOM_ANIMATE),b)Gb.animate.AnimateManager.start(new Gb.animate.AnimateXZoom(this,a));else{var c=this._xZoom,d=this._xTranslate-(this._canvasWidth/2-this._xTranslate)/c*(a-c);this._xZoom=a,this.firePropertyChange("xZoom",c,a),this.onXZoomChanged(c,a),this.setXTranslate(d)}},getYZoom:function(){return this._yZoom},onYZoomChanged:function(a,b){},yZoomIn:function(a){this.setYZoom(this._yZoom*Dd.ZOOM_INCREMENT,a)},yZoomOut:function(a){this.setYZoom(this._yZoom/Dd.ZOOM_INCREMENT,a)},yZoomReset:function(a){this.setYZoom(1,a)},setYZoom:function(a,b){if(Hb.num(a)&&!(0>=a)&&(a<this._minZoom&&(a=this._minZoom),a>this._maxZoom&&(a=this._maxZoom),a!==this.YZoom))if(null==b&&(b=Dd.ZOOM_ANIMATE),b)Gb.animate.AnimateManager.start(new Gb.animate.AnimateYZoom(this,a));else{var c=this._yZoom,d=this._yTranslate-(this._canvasHeight/2-this._yTranslate)/c*(a-c);this._yZoom=a,this.firePropertyChange("yZoom",c,a),this.onYZoomChanged(c,a),this.setYTranslate(d)}}}),Gb.charts.ScaleChart=function(a){Gb.charts.ScaleChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.ScaleChart",Gb.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","xAxisText","xAxisLineColor","xAxisLineWidth","xAxisTextColor","xAxisTextFont","yAxisText","yAxisLineColor","yAxisLineWidth","yAxisTextColor","yAxisTextFont","xScaleTexts","xScaleTextFont","xScaleTextColor","xScaleTextOrientation","yScaleTextVisible","yScaleTextColor","yScaleTextFont","yScaleLineColor","yScaleLineWidth","yScaleValueGap","yScalePixelGap","yScaleMinTextVisible","valueSpanCount"],_reset:function(){this._map={},this._max=0,this._min=0,this._columnCount=this._xScaleTexts?this._xScaleTexts.size():0,null!=this._upperLimit&&(this._max=this._upperLimit),null!=this._lowerLimit&&(this._min=this._lowerLimit)},getMin:function(){return this._min},getMax:function(){return this._max},getRange:function(){return this._range},getColumnCount:function(){return this._columnCount},getColumnWidth:function(){return this._columnWidth},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},formatYScaleText:function(a){return a.toFixed(2)},_initRange:function(){null==this._lowerLimit&&(this._min>=this._max&&(this._min=this._max-.1*Math.abs(this._max)),this._min=this._min-.1*(this._max-this._min)),this._range=this._max-this._min},_initValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.values.forEach(function(a){b.proportions.add(null==a?null:0==this._range?0:a/this._range)},this)},this)},_commonValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a)};this._initInfo&&this._initInfo(a,c),this._map[a.getId()]=c,(null==this._upperLimit||null==this._lowerLimit)&&b.forEach(function(a){null!=a&&(null==this._upperLimit&&a>this._max&&(this._max=a),null==this._lowerLimit&&a<this._min&&(this._min=a))},this)},this),this._initRange(),this._initValuesProportion()},validateDisplay:function(a,b,c){var d=0;this._xAxisText&&(d=this.getTextSize(this._xAxisTextFont,this._xAxisText).height);var e=0;this._xScaleTexts&&this._xScaleTexts.forEach(function(a){var b=this.getTextSize(this._xScaleTextFont,a),c="vertical"===this._xScaleTextOrientation?b.width:b.height;c>e&&(e=c)},this);var f=c-this._yGap-d-e,g=f-this._yGap,h=null==this._upperLimit?.9*g:g,i=0;this._yAxisText&&(i=this.getTextSize(this._yAxisTextFont,this._yAxisText).height);var j,k;this._yScaleValueGap>0?(j=Math.max(this._yScaleValueGap/this._range*h,1),k=this._yScaleValueGap):(j=Math.max(this._yScalePixelGap,1),k=this._range*(j/h));var l,m,n=0,o=new md;if(this._yScaleTextVisible){l=this._yScaleMinTextVisible?0:j;for(var p=this._min+(this._yScaleMinTextVisible?0:k);g+1>=l;){if(m=this.formatYScaleText(p)){var q=this.getTextSize(this._yScaleTextFont,m);q.width>n&&(n=q.width),o.add({text:m,size:q,cursor:l})}l+=j,p+=k}}var r={x:this._xGap+i+n,y:this._yGap,width:b-this._xGap-i-n-this._xGap,height:c-this._yGap-e-d-this._yGap};if(this.drawBackground(a,r),this._columnWidth=this._columnCount>0?r.width/(3*this._columnCount+1)*2:r.width/2,0===this._columnWidth&&(this._columnWidth=1),this._yScaleLineWidth>0)for(l=0;g+1>=l;)this.drawLine(a,this._yScaleLineColor,this._yScaleLineWidth,r.x,f-l,r.x+r.width,f-l),l+=j;this._xAxisText&&Vb.drawText(a,this._xAxisText,{x:r.x+r.width/2,y:f+e+d/2},this._xAxisTextFont,this.getUniqueColor(this._xAxisTextColor)),this._yAxisText&&this.drawVerticalText(a,this._yAxisText,{x:this._xGap+i/2,y:g/2+this._yGap},this._yAxisTextFont,this.getUniqueColor(this._yAxisTextColor)),this.drawLine(a,this._yAxisLineColor,this._yAxisLineWidth,r.x,r.y+r.height,r.x,r.y);var s=this.getUniqueColor(this._yScaleTextColor);o.forEach(function(b){var c={x:this._xGap+i+n-b.size.width/2,y:f-b.cursor};Vb.drawText(a,b.text,c,this._yScaleTextFont,s)},this);var t=r.y+r.height+e/2;s=this.getUniqueColor(this._xScaleTextColor);for(var u=this._xScaleLineWidth>0?this.getUniqueColor(this._xScaleLineColor):null,v=0;v<this._columnCount;v++){var w=r.x+this._columnWidth*(1+1.5*v);if(this._xScaleTexts&&v<this._xScaleTexts.size()&&(m=this._xScaleTexts.get(v))){var x={x:w,y:t};"vertical"===this._xScaleTextOrientation?this.drawVerticalText(a,m,x,this._yScaleTextFont,s):this._valueSpanCount?v%this._valueSpanCount==0&&Vb.drawText(a,m,x,this._xScaleTextFont,s):Vb.drawText(a,m,x,this._xScaleTextFont,s)}"default"!==this._type&&u&&(this._valueSpanCount?v%this._valueSpanCount==0&&this.drawLine(a,u,this._xScaleLineWidth,w,r.y+r.height,w,r.y):this.drawLine(a,u,this._xScaleLineWidth,w,r.y+r.height,w,r.y))}var y=f+this._min/k*j;this._publishedDatas.size()>0&&this._columnCount>0&&this.drawContent(a,r,h,y),this.drawLine(a,this._xAxisLineColor,this._xAxisLineWidth,r.x,r.y+r.height,r.x+r.width,r.y+r.height);

}}),Gb.charts.PieChart=function(a){this._sum=0,this._map={},Gb.charts.PieChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.PieChart",Gb.charts.ChartBase,{__accessor:["type","selectOffset","startAngle","shadowColor","shadowOffset","lineRate","donutRate","valuePosition"],_type:Dd.PIECHART_TYPE,_lineRate:Dd.PIECHART_LINE_RATE,_donutRate:Dd.PIECHART_DONUT_RATE,_startAngle:Dd.PIECHART_START_ANGLE,_shadowColor:Dd.PIECHART_SHADOW_COLOR,_shadowOffset:Dd.PIECHART_SHADOW_OFFSET,_selectOffset:Dd.PIECHART_SELECT_OFFSET,_valuePosition:Dd.PIECHART_VALUE_POSITION,getSum:function(){return this._sum},validateModel:function(){this._sum=0,this._map={},this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)},this._sum+=b},this);var a=this._startAngle;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.proportion=0===this._sum?0:c.value/this._sum,"line"!==this._type&&(c.startAngle=a,c.arc=c.proportion*Math.PI*2,a+=c.arc)},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),Rb.grow(d,-4,-4),!(d.width<=0||d.height<=0)){var e=this._shadowOffset;if(e>0&&(a.shadowOffsetX=e,a.shadowOffsetY=e,a.shadowBlur=1.5*e,a.shadowColor=this._shadowColor),"oval"===this._type||"circle"===this._type){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;"circle"===this._type&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(0!==c.arc){var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}a.fillStyle=c.color,a.beginPath(),a.moveTo(f+d,g-e),Vb.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.closePath(),a.fill();var k=this._getValueTextInfo(b,c.value);if(k){var j=c.startAngle+c.arc/2;k.x=f+d+Math.cos(j)*h*this._valuePosition,k.y=g-e-Math.sin(j)*i*this._valuePosition}}},this)}else if("donut"===this._type||"ovalDonut"===this._type){var f=d.x+d.width/2,g=d.y+d.height/2,h=d.width/2,i=d.height/2;"donut"===this._type&&(h=i=Math.min(h,i)),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];if(0!==c.arc){var d=0,e=0;if(this.isSelected(b)){var j=c.startAngle+c.arc/2;d=Math.cos(j)*this._selectOffset,e=Math.sin(j)*this._selectOffset*i/h}var k=f+Math.cos(c.startAngle)*h*this._donutRate,l=g-Math.sin(c.startAngle)*i*this._donutRate,m=f+Math.cos(c.startAngle+c.arc)*h*this._donutRate,n=g-Math.sin(c.startAngle+c.arc)*i*this._donutRate;a.fillStyle=c.color,a.beginPath(),a.moveTo(k+d,l-e),Vb.drawArc(a,f+d,g-e,c.startAngle,c.arc,h,i,!0),a.lineTo(m+d,n-e),Vb.drawArc(a,f+d,g-e,c.startAngle+c.arc,-c.arc,h*this._donutRate,i*this._donutRate,!0),a.closePath(),a.fill();var o=this._getValueTextInfo(b,c.value);if(o){var j=c.startAngle+c.arc/2,p=this._donutRate+(1-this._donutRate)*this._valuePosition;o.x=f+d+Math.cos(j)*h*p,o.y=g-e-Math.sin(j)*i*p}}},this)}else if("line"===this._type){var j=d.height*this._lineRate;d.y=d.y+d.height/2-j/2,d.height=j;var k=d.x;this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],e=d.width*c.proportion;if(0!==e){a.beginPath(),a.fillStyle=c.color;var f=this.isSelected(b)?-this._selectOffset:0;a.rect(k,d.y+f,e,d.height),a.closePath(),a.fill();var g=this._getValueTextInfo(b,c.value);g&&(g.x=k+e/2,g.y=d.y+d.height+f-d.height*this._valuePosition),k+=e}},this)}this._shadowOffset>0&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0),this.drawValueTexts(a)}}}),Gb.charts.BarChart=function(a){Gb.charts.BarChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.BarChart",Gb.charts.ScaleChart,{__accessor:["type"],_upperLimit:Dd.BARCHART_UPPER_LIMIT,_lowerLimit:Dd.BARCHART_LOWER_LIMIT,_type:Dd.BARCHART_TYPE,_xAxisText:null,_xAxisTextColor:Dd.BARCHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Dd.BARCHART_XAXIS_TEXT_FONT,_xAxisLineColor:Dd.BARCHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Dd.BARCHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Dd.BARCHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Dd.BARCHART_YAXIS_TEXT_FONT,_yAxisLineColor:Dd.BARCHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Dd.BARCHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Dd.BARCHART_XSCALE_TEXT_FONT,_xScaleTextColor:Dd.BARCHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Dd.BARCHART_XSCALE_TEXT_ORIENTATION,_yScaleTextVisible:Dd.BARCHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Dd.BARCHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Dd.BARCHART_YSCALE_TEXT_FONT,_yScaleLineColor:Dd.BARCHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Dd.BARCHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Dd.BARCHART_YSCALE_VALUE_GAP,_yScalePixelGap:Dd.BARCHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Dd.BARCHART_YSCALE_MIN_TEXT_VISIBLE,validateModel:function(){var a=this._type+"ValidateModel";this[a]&&(this._reset(),this[a]())},defaultValidateModel:function(){this._columnCount=this._publishedDatas.size(),this._publishedDatas.forEach(function(a){var b=this.getValue(a);null==this._upperLimit&&b>this._max&&(this._max=b),null==this._lowerLimit&&b<this._min&&(this._min=b),this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a)}},this),this._initRange(),this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.proportion=0==this._range?0:b.value/this._range},this)},layerValidateModel:function(){this._commonValidateModel()},groupValidateModel:function(){this._commonValidateModel()},stackValidateModel:function(){if(this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this),null==this._upperLimit||null==this._lowerLimit)for(var a=0;a<this._columnCount;a++){var b=0,c=0;this._publishedDatas.forEach(function(d){var e=this._map[d.getId()];if(e.values.size()>a){var f=e.values.get(a);null!=f&&(f>=0?b+=f:c+=f)}},this),null==this._upperLimit&&b>this._max&&(this._max=b),null==this._lowerLimit&&c<this._min&&(this._min=c)}this._initRange(),this._initValuesProportion()},percentValidateModel:function(){this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a));b.size()>this._columnCount&&(this._columnCount=b.size());var c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a)};this._map[a.getId()]=c},this);for(var a=new md,b=0;b<this._columnCount;b++){var c=0;this._publishedDatas.forEach(function(a){var d=this._map[a.getId()];if(d.values.size()>b){var e=d.values.get(b);null!=e&&(c+=e)}},this),a.add(c)}for(var b=0;b<this._columnCount;b++)this._publishedDatas.forEach(function(c){var d=this._map[c.getId()],e=a.get(b);if(0!==e&&d.values.size()>b){var f=d.values.get(b);if(null!=f)return void d.proportions.add(f/e)}d.proportions.add(null)},this);this._min=0,this._max=1,this._range=1},drawRect:function(a,b,c,d,e,f,g){a.fillStyle=b,c&&this._selectInfos.add({x:d,y:e,w:f,h:g,color:this.getUniqueColor(Vb.darker(b))}),a.beginPath(),a.rect(d,e,f,g),a.closePath(),a.fill()},drawContent:function(a,b,c,d){this._selectInfos=new md,this._toolTipInfos=this.isToolTipEnabled()?new md:null,"default"===this._type?this.drawDefaultContent(a,b,c,d):"group"===this._type?this.drawGroupContent(a,b,c,d):"percent"===this._type?this.drawPercentContent(a,b,c,d):"stack"===this._type?this.drawStackContent(a,b,c,d):"layer"===this._type&&this.drawLayerContent(a,b,c,d),this.drawValueTexts(a),this._selectInfos.forEach(function(b){a.lineWidth=2,a.strokeStyle=b.color,a.beginPath(),a.rect(b.x,b.y,b.w,b.h),a.closePath(),a.stroke()},this),delete this._selectInfos},drawDefaultContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnWidth,g=0;e>g;g++){var h=this._publishedDatas.get(g),i=this._map[h.getId()],j=b.x+f*(.5+1.5*g),k=Math.abs(c*i.proportion),l=i.proportion>0?d-k:d;this.drawRect(a,i.color,this.isSelected(h),j,l,f,k),this.addToolTipInfo(j,l,f,k,i.value,h);var m=this._getValueTextInfo(h,i.value);if(m){var n=this.getTextSize(m.font,m.text);m.x=j+f/2,m.y=l-n.height/2+1}}},drawPercentContent:function(a,b,c,d){this.drawStackContent(a,b,c,d)},drawStackContent:function(a,b,c,d){for(var e=this._columnCount,f=this._columnWidth,g=0;e>g;g++){var h=d,i=b.x+f*(.5+1.5*g);this._publishedDatas.forEach(function(b){var d=this._map[b.getId()];if(g<d.proportions.size()){var e=d.proportions.get(g);if(null!=e){var j=c*e;h-=j,this.drawRect(a,d.color,this.isSelected(b),i,h,f,j),this.addToolTipInfo(i,h,f,j,d.values.get(g),b);var k=this._getValueTextInfo(b,d.values.get(g));k&&(k.x=i+f/2,k.y=h+j/2)}}},this)}},drawLayerContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=3*g/8/e,i=0;f>i;i++){var j=b.x+g*(.5+1.5*i),k=0;this._publishedDatas.forEach(function(b){var f=this._map[b.getId()];if(i<f.proportions.size()){var l=f.proportions.get(i);if(null!=l){var m=c*l,n=d-m,o=j+g/2-g/8-h*(e-k),p=2*(g/8+h*(e-k));this.drawRect(a,f.color,this.isSelected(b),o,n,p,m),this.addToolTipInfo(o,n,p,m,f.values.get(i),b);var q=this._getValueTextInfo(b,f.values.get(i));if(q){var r=this.getTextSize(q.font,q.text);q.x=o+p/2,q.y=n-r.height/2+1}}}k++},this)}},drawGroupContent:function(a,b,c,d){for(var e=this._publishedDatas.size(),f=this._columnCount,g=this._columnWidth,h=g/e,i=0;f>i;i++){var j=b.x+g*(.5+1.5*i),k=0;this._publishedDatas.forEach(function(b){var e=this._map[b.getId()];if(i<e.proportions.size()){var f=e.proportions.get(i);if(null!=f){var g=c*f,l=d-g;this.drawRect(a,e.color,this.isSelected(b),j+h*k,l,h,g),this.addToolTipInfo(j+h*k,l,h,g,e.values.get(i),b);var m=this._getValueTextInfo(b,e.values.get(i));if(m){var n=this.getTextSize(m.font,m.text);m.x=j+h*k+h/2,m.y=l-n.height/2+1}}}k++},this)}}}),Gb.charts.LineChart=function(a){Gb.charts.LineChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Hb.ext("twaver.charts.LineChart",Gb.charts.ScaleChart,{__accessor:["xScaleLineColor","xScaleLineWidth","interruptable"],_interruptable:Dd.LINECHART_INTERRUPTABLE,_upperLimit:Dd.LINECHART_UPPER_LIMIT,_lowerLimit:Dd.LINECHART_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Dd.LINECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Dd.LINECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Dd.LINECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Dd.LINECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Dd.LINECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Dd.LINECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Dd.LINECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Dd.LINECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Dd.LINECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Dd.LINECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Dd.LINECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Dd.LINECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Dd.LINECHART_XSCALE_LINE_WIDTH,_valueSpanCount:Dd.LINECHART_VALUESPANCOUNT,_yScaleTextVisible:Dd.LINECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Dd.LINECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Dd.LINECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Dd.LINECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Dd.LINECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Dd.LINECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Dd.LINECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Dd.LINECHART_YSCALE_MIN_TEXT_VISIBLE,getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):Gb.Styles.getStyle("chart.line.width")},getMarkerShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):Gb.Styles.getStyle("chart.marker.shape")},getMarkerSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):Gb.Styles.getStyle("chart.marker.size")},_initInfo:function(a,b){b.markerShape=this.getMarkerShape(a),b.markerSize=this.getMarkerSize(a),b.lineWidth=this.getLineWidth(a),this.isSelected(a)&&(b.lineWidth+=2)},validateModel:function(){this._reset(),this._commonValidateModel()},getPointIndexAt:function(){var a=this._getPoint.apply(this,arguments),b=this.tryGetDataAt(a);if(!b)return-1;for(var c,d=this._map[b.getId()],e=d.points,f=d.markerSize,g=0,h=e.size();h>g;g++)if(c=e.get(g),c&&Rb.getDistance(a,c)<=f)return g;return-1},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new md:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.markerSize>0?new md:null;a.strokeStyle=f.color,a.lineWidth=f.lineWidth,a.beginPath();var h=f.proportions,i=null,j=h.size(),k=new md;f.points=k;for(var l=0;j>l;l++){var m=h.get(l);if(null!=m){var n={x:b.x+this._columnWidth*(1+1.5*l),y:d-c*m};k.add(n),null==i?a.moveTo(n.x,n.y):a.lineTo(n.x,n.y);var o=f.values.get(l),p=this._getValueTextInfo(e,o);if(p){var q=this.getTextSize(p.font,p.text);p.x=n.x,p.y=n.y-q.height/2+2}g&&g.add({point:n,value:o,data:e,index:l}),i=n}else this._interruptable&&(i=null,k.add(null))}if(a.stroke(),g){var r=f.markerSize/2;g.forEach(function(b){a.fillStyle=f.color;var c=b.point.x-r,d=b.point.y-r,e=f.markerSize,g=f.markerSize;Vb.drawVector(a,f.markerShape,null,c,d,e,g),a.fill(),this.addToolTipInfo(c,d,e,g,b.value,b.data,b.index)},this)}},this),this.drawValueTexts(a)}}),Gb.charts.BubbleChart=function(a){Gb.charts.BubbleChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.BubbleChart",Gb.charts.ScaleChart,{__accessor:["xAxisUpperLimit","xAxisLowerLimit","xScaleLineColor","xScaleLineWidth","selectShadowColor","selectShadowOffset"],_upperLimit:Dd.BUBBLECHART_UPPER_LIMIT,_lowerLimit:Dd.BUBBLECHART_LOWER_LIMIT,_xAxisUpperLimit:Dd.BUBBLECHART_XAXIS_UPPER_LIMIT,_xAxisLowerLimit:Dd.BUBBLECHART_XAXIS_LOWER_LIMIT,_xAxisText:null,_xAxisTextColor:Dd.BUBBLECHART_XAXIS_TEXT_COLOR,_xAxisTextFont:Dd.BUBBLECHART_XAXIS_TEXT_FONT,_xAxisLineColor:Dd.BUBBLECHART_XAXIS_LINE_COLOR,_xAxisLineWidth:Dd.BUBBLECHART_XAXIS_LINE_WIDTH,_yAxisText:null,_yAxisTextColor:Dd.BUBBLECHART_YAXIS_TEXT_COLOR,_yAxisTextFont:Dd.BUBBLECHART_YAXIS_TEXT_FONT,_yAxisLineColor:Dd.BUBBLECHART_YAXIS_LINE_COLOR,_yAxisLineWidth:Dd.BUBBLECHART_YAXIS_LINE_WIDTH,_xScaleTexts:null,_xScaleTextFont:Dd.BUBBLECHART_XSCALE_TEXT_FONT,_xScaleTextColor:Dd.BUBBLECHART_XSCALE_TEXT_COLOR,_xScaleTextOrientation:Dd.BUBBLECHART_XSCALE_TEXT_ORIENTATION,_xScaleLineColor:Dd.BUBBLECHART_XSCALE_LINE_COLOR,_xScaleLineWidth:Dd.BUBBLECHART_XSCALE_LINE_WIDTH,_yScaleTextVisible:Dd.BUBBLECHART_YSCALE_TEXT_VISIBLE,_yScaleTextColor:Dd.BUBBLECHART_YSCALE_TEXT_COLOR,_yScaleTextFont:Dd.BUBBLECHART_YSCALE_TEXT_FONT,_yScaleLineColor:Dd.BUBBLECHART_YSCALE_LINE_COLOR,_yScaleLineWidth:Dd.BUBBLECHART_YSCALE_LINE_WIDTH,_yScaleValueGap:Dd.BUBBLECHART_YSCALE_VALUE_GAP,_yScalePixelGap:Dd.BUBBLECHART_YSCALE_PIXEL_GAP,_yScaleMinTextVisible:Dd.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE,_selectShadowColor:Dd.BUBBLECHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Dd.BUBBLECHART_SELECT_SHADOW_OFFSET,_resetX:function(){this._xMax=0,this._xMin=0,null!=this._xAxisUpperLimit&&(this._xMax=this._xAxisUpperLimit),null!=this._xAxisLowerLimit&&(this._xMin=this._xAxisLowerLimit)},getXMin:function(){return this._xMin},getXMax:function(){return this._xMax},getXRange:function(){return this._xRange},getShape:function(a){return a.getStyle?a.getStyle("chart.bubble.shape"):Gb.Styles.getStyle("chart.bubble.shape")},getSize:function(a,b){return b},getNames:function(a){return a.getStyle?a.getStyle("chart.names"):Gb.Styles.getStyle("chart.names")},getXAxisValues:function(a){return a.getStyle?a.getStyle("chart.xaxis.values"):Gb.Styles.getStyle("chart.xaxis.values")},getYAxisValues:function(a){return a.getStyle?a.getStyle("chart.yaxis.values"):Gb.Styles.getStyle("chart.yaxis.values")},_initXRange:function(){null==this._xAxisLowerLimit&&(this._xMin>=this._xMax&&(this._xMin=this._xMax-.1*Math.abs(this._xMax)),this._xMin=this._xMin-.1*(this._xMax-this._xMin)),this._xRange=this._xMax-this._xMin},_initXYValuesProportion:function(){this._publishedDatas.forEach(function(a){var b=this._map[a.getId()];b.xAxisValues.forEach(function(a){b.xAxisProportions.add(null==a?null:0==this._xRange?0:a/this._xRange)},this),b.yAxisValues.forEach(function(a){b.yAxisProportions.add(null==a?null:0==this._range?0:a/this._range)},this)},this)},validateModel:function(){this._reset(),this._resetX(),this._columnCount=null==this._xScaleTexts?0:this._xScaleTexts.size(),this._publishedDatas.forEach(function(a){var b=new md(this.getYAxisValues(a)),c=new md(this.getXAxisValues(a)),d=new md(this.getValues(a));d.size()>this._columnCount&&(this._columnCount=d.size());var e={data:a,values:d,yAxisValues:b,xAxisValues:c,yAxisProportions:new md,xAxisProportions:new md,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getShape(a)};this._map[a.getId()]=e,(null==this._upperLimit||null==this._lowerLimit)&&b.forEach(function(a){null!=a&&(null==this._upperLimit&&a>this._max&&(this._max=a),null==this._lowerLimit&&a<this._min&&(this._min=a))},this),(null==this._upperLimit||null==this._lowerLimit)&&c.forEach(function(a){null!=a&&(null==this._xAxisUpperLimit&&a>this._xMax&&(this._xMax=a),null==this._xAxisLowerLimit&&a<this._xMin&&(this._xMin=a))},this)},this),this._initRange(),this._initXRange(),this._initXYValuesProportion()},drawContent:function(a,b,c,d){this._toolTipInfos=this.isToolTipEnabled()?new md:null,this._publishedDatas.forEach(function(e){var f=this._map[e.getId()],g=f.yAxisProportions,h=f.xAxisProportions,i=f.values,j=f.yAxisProportions.size(),k=this._selectShadowOffset;this.isSelected(e)&&k>0?(a.shadowOffsetX=k,a.shadowOffsetY=k,a.shadowBlur=2*k,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=f.color),a.fillStyle=f.color;for(var l=0;j>l;l++){var m=g.get(l),n=h.get(l);if(null!=m){var o={x:b.x+b.width*n,y:d-c*m},p=i.get(l),q=this.getSize(e,p),k=q/2,r=o.x-k,s=o.y-k,t=q,u=q;Vb.drawVector(a,f.anchorShape,null,r,s,t,u),a.fill(),this.addToolTipInfo(r,s,t,u,p,e,l);var v=this._getValueTextInfo(e,p);if(v){var q=this.getTextSize(v.font,v.text);v.x=o.x,v.y=o.y}}}},this),this.drawValueTexts(a)}}),Gb.charts.DialChart=function(a){Gb.charts.DialChart.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.charts.DialChart",Gb.charts.ChartBase,{__accessor:["upperLimit","lowerLimit","startAngle","endAngle","innerRadius","colorRangeFillColor","outlineWidth","outlineColor","majorScaleCount","majorScaleLineWidth","majorScaleLineLength","majorScaleLineColor","minorScaleCount","minorScaleLineWidth","minorScaleLineLength","minorScaleLineColor","scaleTextVisible","scaleUpperLimitTextVisible","scaleLowerLimitTextVisible","scaleTextFont","scaleTextColor","pivotRadius","pivotFillColor","pivotOutlineWidth","pivotOutlineColor","pivotGradient","pivotGradientColor","valuePosition","colorRangeList","innerDarkerRadius","outerBrighterRadius","selectShadowColor","selectShadowOffset"],__bool:["scaleInside","pivotFill"],_upperLimit:Dd.DIALCHART_UPPER_LIMIT,_lowerLimit:Dd.DIALCHART_LOWER_LIMIT,_startAngle:Dd.DIALCHART_START_ANGLE,_endAngle:Dd.DIALCHART_END_ANGLE,_innerRadius:Dd.DIALCHART_INNER_RADIUS,_colorRangeFillColor:Dd.DIALCHART_COLOR_RANGE_FILL_COLOR,_outlineWidth:Dd.DIALCHART_OUTLINE_WIDTH,_outlineColor:Dd.DIALCHART_OUTLINE_COLOR,_scaleInside:Dd.DIALCHART_SCALE_INSIDE,_majorScaleCount:Dd.DIALCHART_MAJOR_SCALE_COUNT,_majorScaleLineWidth:Dd.DIALCHART_MAJOR_SCALE_LINE_WIDTH,_majorScaleLineLength:Dd.DIALCHART_MAJOR_SCALE_LINE_LENGTH,_majorScaleLineColor:Dd.DIALCHART_MAJOR_SCALE_LINE_COLOR,_minorScaleCount:Dd.DIALCHART_MINOR_SCALE_COUNT,_minorScaleLineWidth:Dd.DIALCHART_MINOR_SCALE_LINE_WIDTH,_minorScaleLineLength:Dd.DIALCHART_MINOR_SCALE_LINE_LENGTH,_minorScaleLineColor:Dd.DIALCHART_MINOR_SCALE_LINE_COLOR,_scaleTextVisible:Dd.DIALCHART_SCALE_TEXT_VISIBLE,_scaleUpperLimitTextVisible:Dd.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE,_scaleLowerLimitTextVisible:Dd.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE,_scaleTextFont:Dd.DIALCHART_SCALE_TEXT_FONT,_scaleTextColor:Dd.DIALCHART_SCALE_TEXT_COLOR,_pivotRadius:Dd.DIALCHART_PIVOT_RADIUS,_pivotFill:Dd.DIALCHART_PIVOT_FILL,_pivotFillColor:Dd.DIALCHART_PIVOT_FILL_COLOR,_pivotOutlineWidth:Dd.DIALCHART_PIVOT_OUTLINE_WIDTH,_pivotOutlineColor:Dd.DIALCHART_PIVOT_OUTLINE_COLOR,_pivotGradient:Dd.DIALCHART_PIVOT_GRADIENT,_pivotGradientColor:Dd.DIALCHART_PIVOT_GRADIENT_COLOR,_valuePosition:Dd.DIALCHART_VALUE_POSITION,_innerDarkerRadius:Dd.DIALCHART_INNER_DARKER_RADIUS,_outerBrighterRadius:Dd.DIALCHART_OUTER_BRIGHTER_RADIUS,_selectShadowColor:Dd.DIALCHART_SELECT_SHADOW_COLOR,_selectShadowOffset:Dd.DIALCHART_SELECT_SHADOW_OFFSET,formatScaleText:function(a){return a.toFixed(2)},validateModel:function(){this._map={},this._valueRange=this._upperLimit-this._lowerLimit;var a=this._startAngle;0!=a&&(a=(a%360+360)%360,0==a&&(a=360)),this._positiveStartAngle=a;var b=this._endAngle;0!=b&&(b=(b%360+360)%360,0==b&&(b=360)),this._positiveEndAngle=b,this._whole=360==Math.abs(a-b),this._startAngleByRadian=a*Math.PI/180,this._endAngleByRadian=b*Math.PI/180,this._clockwise=this._startAngleByRadian>this._endAngleByRadian,this._angleRange=Math.abs(this._startAngleByRadian-this._endAngleByRadian),this._publishedDatas.forEach(function(a){var b=this.getValue(a);this._map[a.getId()]={data:a,value:b,color:this.getUniqueColor(this.getColor(a),a),angle:this._startAngleByRadian+(this._clockwise?-1:1)*b/this._valueRange*this._angleRange}},this)},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),this._startAngleByRadian!=this._endAngleByRadian){var e,f,g=this._lowerLimit,h=this._majorScaleCount>1?this._valueRange/(this._majorScaleCount-1):0,i=0,j=0,k=null,l=null;if(this._scaleTextVisible)for(k=new md,e=0;e<this._majorScaleCount;e++)0==e&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible?(f=null,k.add({text:"",size:{width:0,height:0}})):(l=this.formatScaleText(g),f=this.getTextSize(this._scaleTextFont,l),k.add({text:l,size:f})),this._scaleInside||null==f||(f.width>i&&(i=f.width),f.height>j&&(j=f.height)),g+=h;if(this._angleRange<=Math.PI&&(i=Math.max(i,this._pivotRadius),j=Math.max(j,this._pivotRadius)),Rb.grow(d,-i,-j),this._calcluateCenterAndRadius(d),a.lineWidth=0,null==this._colorRangeList||0==this._colorRangeList.size())this._drawArcGroup(a,this._startAngleByRadian,this._endAngleByRadian,this.getUniqueColor(this._colorRangeFillColor)),this._drawArcOutLine(a,this._startAngleByRadian,this._endAngleByRadian,!0,!0);else{var m=this._angleRange/this._colorRangeList.size(),n=this._startAngleByRadian;for(e=0;e<this._colorRangeList.size();e++){var o=this.getUniqueColor(this._colorRangeList.get(e)),p=n+(this._clockwise?-1:1)*m;this._drawArcGroup(a,n,p,o),this._drawArcOutLine(a,n,n+(this._clockwise?-1:1)*m,0==e,e==this._colorRangeList.size()-1),n+=(this._clockwise?-1:1)*m}}var q,r,s,t,u,v,w,x,y=this._startAngleByRadian,z=this._majorScaleCount>1?this._angleRange/(this._majorScaleCount-1):0;for(v=this._scaleInside?this._innerRadiusByPixel:this._outerRadius,w=v+this._majorScaleLineLength*(this._scaleInside?1:-1),x=v+this._minorScaleLineLength*(this._scaleInside?1:-1),e=0;e<this._majorScaleCount;e++){if(r=this._center.x+Math.cos(y)*v,s=this._center.y+Math.sin(-y)*v,t=this._center.x+Math.cos(y)*w,u=this._center.y+Math.sin(-y)*w,a.lineWidth=this._majorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._majorScaleLineColor),a.beginPath(),a.moveTo(r,s),a.lineTo(t,u),a.closePath(),a.stroke(),this._scaleTextVisible)if(0==e&&!this._scaleLowerLimitTextVisible||e==this._majorScaleCount-1&&!this._scaleUpperLimitTextVisible);else{var A=k.get(e);if(A){var B=this.getScaleTextPosition(y/Math.PI*180,r,s,A.size.width,A.size.height);A.x=B.x,A.y=B.y}}if(this._whole||!this._whole&&e<this._majorScaleCount-1){var C=y,D=this._minorScaleCount>0?z/(this._minorScaleCount+1):0;for(q=0;q<this._minorScaleCount;q++)C+=(this._clockwise?-1:1)*D,r=this._center.x+Math.cos(C)*v,s=this._center.y+Math.sin(-C)*v,t=this._center.x+Math.cos(C)*x,u=this._center.y+Math.sin(-C)*x,a.lineWidth=this._minorScaleLineWidth,a.strokeStyle=this.getUniqueColor(this._minorScaleLineColor),a.beginPath(),a.moveTo(r,s),a.lineTo(t,u),a.closePath(),a.stroke()}y+=(this._clockwise?-1:1)*z}this._pivotFill&&Vb.fill(a,this.getUniqueColor(this._pivotFillColor),this._pivotGradient,this._pivotGradientColor,this._center.x-this._pivotRadius,this._center.y-this._pivotRadius,2*this._pivotRadius,2*this._pivotRadius),a.lineWidth=this._pivotOutlineWidth,a.strokeStyle=this.getUniqueColor(this._pivotOutlineColor),a.beginPath(),a.arc(this._center.x,this._center.y,this._pivotRadius,0,2*Math.PI,!0),a.closePath(),this._pivotFill&&a.fill(),k&&k.forEach(function(b){b&&Vb.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this),this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=this._getDataStyle("dialchart.rear.extension",b),e=this._getDataStyle("dialchart.base.width",b),f=this._getDataStyle("dialchart.top.width",b),g=this._getDataStyle("dialchart.radius",b);g>=-1&&1>=g&&(g*=this._innerRadiusByPixel),a.fillStyle=c.color,a.lineWidth=0;var h=Rb.createMatrix(-c.angle,this._center.x,this._center.y),i=h.transform(this._center.x+g,this._center.y+f/2),j=h.transform(this._center.x+g,this._center.y-f/2),k=h.transform(this._center.x-d,this._center.y-e/2),l=h.transform(this._center.x-d,this._center.y+e/2),m=this._selectShadowOffset;this.isSelected(b)&&m>0?(a.shadowOffsetX=m,a.shadowOffsetY=m,a.shadowBlur=2*m,a.shadowColor=this._selectShadowColor):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.shadowColor=c.color),a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(j.x,j.y),a.lineTo(k.x,k.y),a.lineTo(l.x,l.y),a.lineTo(i.x,i.y),a.closePath(),a.fill();var n=this._getValueTextInfo(b,c.value);if(n){var o=h.transform(this._center.x+g*this._valuePosition,this._center.y);n.x=o.x,n.y=o.y}},this),this.drawValueTexts(a)}},_getDataStyle:function(a,b){return b.getStyle?b.getStyle(a):b.getClient(a)},_calcluateCenterAndRadius:function(a){{var b=this._clockwise?this._positiveEndAngle:this._positiveStartAngle,c=this._clockwise?this._positiveStartAngle:this._positiveEndAngle;Math.abs(this._positiveEndAngle-this._positiveStartAngle)}b>=0&&90>b?c>=0&&90>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):c>90&&180>=c?(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height+this._outerRadius)/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):b>=90&&180>b?c>=90&&180>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height+this._outerRadius)/2}):c>180&&270>=c?(this._outerRadius=Math.min(a.width,a.height/2),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+a.height/2}):(this._center={x:a.x+a.width/2,y:a.y+a.height/2},this._outerRadius=Math.min(a.width,a.height)/2):b>=180&&270>b?c>=180&&270>=c?(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width+this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width/2,a.height),this._center={x:a.x+a.width/2,y:a.y+(a.height-this._outerRadius)/2}):(this._outerRadius=Math.min(a.width,a.height),this._center={x:a.x+(a.width-this._outerRadius)/2,y:a.y+(a.height-this._outerRadius)/2}),this._innerRadiusByPixel=this._innerRadius>1?this._innerRadius:this._outerRadius*this._innerRadius,this._innerDarkerRadiusByPixel=this._innerDarkerRadius>1?this._innerDarkerRadius:this._outerRadius*this._innerDarkerRadius,this._outerBrighterRadiusByPixel=this._outerBrighterRadius>1?this._outerBrighterRadius:this._outerRadius*this._outerBrighterRadius},_drawArcOutLine:function(a,b,c,d,e){if(!(this._outlineWidth<=0)){var f=Math.abs(b-c),g=this._center.x+Math.cos(b)*this._innerRadiusByPixel,h=this._center.y+Math.sin(-b)*this._innerRadiusByPixel,i=this._center.x+Math.cos(b)*this._outerRadius,j=this._center.y+Math.sin(-b)*this._outerRadius,k=this._center.x+Math.cos(c)*this._innerRadiusByPixel,l=this._center.y+Math.sin(-c)*this._innerRadiusByPixel,m=this._center.x+Math.cos(c)*this._outerRadius,n=this._center.y+Math.sin(-c)*this._outerRadius;this._clockwise?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,c,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(g,h),a.stroke(),a.beginPath(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,b,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(m,n),a.stroke()):(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,b,f,this._outerRadius,this._outerRadius,!1),a.stroke(),!this._whole&&e?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(k,l),a.stroke(),a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor),a.beginPath(),a.moveTo(this._center.x,this._center.y),Vb.drawArc(a,this._center.x,this._center.y,c,-f,this._innerRadiusByPixel,this._innerRadiusByPixel,!1),a.stroke(),!this._whole&&d?(a.lineWidth=this._outlineWidth,a.strokeStyle=this.getUniqueColor(this._outlineColor)):a.lineWidth=0,a.lineTo(i,j),a.stroke())}},_drawArcGroup:function(a,b,c,d){0!=this._outerBrighterRadiusByPixel&&this._drawArc(a,b,c,this._outerRadius-this._outerBrighterRadiusByPixel,this._outerRadius,Vb.brighter(d)),this._drawArc(a,b,c,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,this._outerRadius-this._outerBrighterRadiusByPixel,d),0!=this._innerDarkerRadiusByPixel&&this._drawArc(a,b,c,this._innerRadiusByPixel,this._innerRadiusByPixel+this._innerDarkerRadiusByPixel,Vb.darker(d,20))},_drawArc:function(a,b,c,d,e,f){var g=Math.abs(b-c);a.lineWidth=0,a.fillStyle=f;{var h=this._center.x+Math.cos(b)*d,i=this._center.y+Math.sin(-b)*d,j=(this._center.x+Math.cos(b)*e,this._center.y+Math.sin(-b)*e,this._center.x+Math.cos(c)*d),k=this._center.y+Math.sin(-c)*d;this._center.x+Math.cos(c)*e,this._center.y+Math.sin(-c)*e}a.beginPath(),this._clockwise?(a.moveTo(j,k),Vb.drawArc(a,this._center.x,this._center.y,c,g,e,e,!0),a.lineTo(h,i),Vb.drawArc(a,this._center.x,this._center.y,b,-g,d,d,!0),a.closePath()):(a.moveTo(h,i),Vb.drawArc(a,this._center.x,this._center.y,b,g,e,e,!0),a.lineTo(j,k),Vb.drawArc(a,this._center.x,this._center.y,c,-g,d,d,!0),a.closePath()),a.fill()},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f=this._scaleInside?{x:b-d/2,y:c}:{x:b+d/2,y:c}),180==a&&(f=this._scaleInside?{x:b+d/2,y:c}:{x:b-d/2,y:c}),90==a&&(f=this._scaleInside?{x:b,y:c+e/2}:{x:b,y:c-e/2}),270==a&&(f=this._scaleInside?{x:b,y:c-e/2}:{x:b,y:c+e/2}),a>270&&360>a&&(f=this._scaleInside?{x:b-d/2,y:c-e/2}:{x:b+d/2,y:c+e/2}),a>180&&270>a&&(f=this._scaleInside?{x:b+d/2,y:c-e/2}:{x:b-d/2,y:c+e/2}),a>90&&180>a&&(f=this._scaleInside?{x:b+d/2,y:c+e/2}:{x:b-d/2,y:c-e/2}),a>0&&90>a&&(f=this._scaleInside?{x:b-d/2,y:c+e/2}:{x:b+d/2,y:c-e/2}),f}}),Gb.charts.RadarChart=function(a){Gb.charts.RadarChart.superClass.constructor.apply(this,arguments),this._selectTolerance=2},Hb.ext("twaver.charts.RadarChart",Gb.charts.ChartBase,{__accessor:["axisTextVisible","axisTextFont","axisTextColor","scaleTextVisible","scaleTextFont","scaleTextColor","axisVisible","axisLineColor","axisLineWidth","axisStartAngle","ringVisible","ringType","ringLineColor","ringLineWidth","scaleCount","scaleMaxValue","scaleMinValue","anchorVisible","areaFillAlpha","areaSelectFillAlpha","axisList"],__bool:["areaFill"],_axisTextVisible:Dd.RADARCHART_AXIS_TEXT_VISIBLE,_axisTextFont:Dd.RADARCHART_AXIS_TEXT_FONT,_axisTextColor:Dd.RADARCHART_AXIS_TEXT_COLOR,_scaleTextVisible:Dd.RADARCHART_SCALE_TEXT_VISIBLE,
_scaleTextFont:Dd.RADARCHART_SCALE_TEXT_FONT,_scaleTextColor:Dd.RADARCHART_SCALE_TEXT_COLOR,_axisVisible:Dd.RADARCHART_AXIS_VISIBLE,_axisLineColor:Dd.RADARCHART_AXIS_LINE_COLOR,_axisLineWidth:Dd.RADARCHART_AXIS_LINE_WIDTH,_axisStartAngle:Dd.RADARCHART_AXIS_START_ANGLE,_ringVisible:Dd.RADARCHART_RING_VISIBLE,_ringType:Dd.RADARCHART_RING_TYPE,_ringLineColor:Dd.RADARCHART_RING_LINE_COLOR,_ringLineWidth:Dd.RADARCHART_RING_LINE_WIDTH,_scaleCount:Dd.RADARCHART_SCALE_COUNT,_scaleMaxValue:Dd.RADARCHART_SCALE_MAXVALUE,_scaleMinValue:Dd.RADARCHART_SCALE_MINVALUE,_anchorVisible:Dd.RADARCHART_ANCHOR_VISIBLE,_areaFill:Dd.RADARCHART_AREA_FILL,_areaFillAlpha:Dd.RADARCHART_AREA_FILL_ALPHA,_areaSelectFillAlpha:Dd.RADARCHART_AREA_SELECT_FILL_ALPHA,getAxisCount:function(){return this._axisCount},formatScaleText:function(a,b){return a.toFixed(2)},getAnchorSize:function(a){return a.getStyle?a.getStyle("chart.marker.size"):Gb.Styles.getStyle("chart.marker.size")},getAnchorShape:function(a){return a.getStyle?a.getStyle("chart.marker.shape"):Gb.Styles.getStyle("chart.marker.shape")},getLineWidth:function(a){return a.getStyle?a.getStyle("chart.line.width"):Gb.Styles.getStyle("chart.line.width")},getValues:function(a){return a.getStyle?a.getStyle("chart.values"):null},tryGetDataAt:function(a,b){if((null==b||0>b)&&(b=this._selectTolerance),a.target&&(a=Ub.getLogicalPoint(this._canvas,arguments[0],1)),!a)return null;if(!this._areaFill){var c=a.x-b,d=a.y-b,e=2*b+1,f=2*b+1;try{for(var g=this._canvas.getContext("2d").getImageData(c,d,e,f).data,h=0,i=g.length;i>h;h+=4)if(255===g[h+3]){var j="rgb("+g[h]+","+g[h+1]+","+g[h+2]+")",k=this._uniqueColors[j];if(k)return k}}catch(l){}return null}if(!this._center)return null;a={x:a.x-this._xTranslate,y:a.y-this._yTranslate};for(var h=this._publishedDatas.size()-1;h>=0;h--){var k=this._publishedDatas.get(h),m=this._map[k.getId()],n=Rb.isPointInPolygon(m.points,a);if(n)return k}return null},getDataAt:function(){var a,b;if(2===arguments.length)a=arguments[0],b=arguments[1];else if(arguments[0].target){var c=Ub.getLogicalPoint(this._canvas,arguments[0],1);if(!c)return;a=c.x,b=c.y}else a=arguments[0].x,b=arguments[0].y;if(0>a||0>b||a>this._canvasWidth||b>this._canvasHeight)return null;if(!this._areaFill){try{var d=this._canvas.getContext("2d").getImageData(a,b,1,1).data;if(255===d[3]){var e="rgb("+d[0]+","+d[1]+","+d[2]+")",f=this._uniqueColors[e];if(f)return f}}catch(g){}return null}for(var h=this._publishedDatas.size()-1;h>=0;h--){var f=this._publishedDatas.get(h),i=this._map[f.getId()],j=Rb.isPointInPolygon(i.points,{x:a-this._xTranslate,y:b-this._yTranslate});if(j)return f}return null},validateModel:function(){if(this._map={},this._axisTexts=new md,this._axisMaxValues=new md,this._axisMinValues=new md,this._axisRangeValues=new md,this._axisCount=null==this._axisList?0:this._axisList.size(),0!=this._axisCount){this._averageAngleByRadian=2*Math.PI/this._axisCount,this._averageAngle=360/this._axisCount,this._axisList.forEach(function(a){if("string"==typeof a)this._axisTexts.add(a),this._axisMaxValues.add(this._scaleMaxValue),this._axisMinValues.add(this._scaleMinValue),this._axisRangeValues.add(this._scaleMaxValue-this._scaleMinValue);else{this._axisTexts.add(a.text);var b=isNaN(a.max)?this._scaleMaxValue:a.max,c=isNaN(a.min)?this._scaleMinValue:a.min;this._axisMaxValues.add(b),this._axisMinValues.add(c),this._axisRangeValues.add(b-c)}},this),this._publishedDatas.forEach(function(a){var b=new md(this.getValues(a)),c={data:a,values:b,proportions:new md,color:this.getUniqueColor(this.getColor(a),a),anchorShape:this.getAnchorShape(a),anchorSize:this.getAnchorSize(a),lineWidth:this.getLineWidth(a),points:new md};this.isSelected(a)&&(c.lineWidth+=2),this._map[a.getId()]=c},this);for(var a=0;a<this._axisCount;a++)this._publishedDatas.forEach(function(b){var c=this._map[b.getId()],d=0;if(c.values.size()>a){var e=c.values.get(a),f=this._axisMinValues.get(a),g=this._axisRangeValues.get(a);g>0&&(d=(e-f)/g)}c.proportions.add(d)},this)}},validateDisplay:function(a,b,c){var d={x:this._xGap,y:this._yGap,width:b-2*this._xGap,height:c-2*this._yGap};if(this.drawBackground(a,d),!(d.width<=0||d.height<=0||this._axisCount<3)){var e=0,f=0,g=0,h=null,i=null,j=null,k=null;if(this._axisTextVisible)for(k=new md,g=0;g<this._axisCount;g++)j=this._axisTexts.get(g),h=this.getTextSize(this._axisTextFont,j),k.add({text:j,size:h}),h.width>e&&(e=h.width),h.height>f&&(f=h.height);var l=d.width/2-e>d.height/2-f?d.height/2-2*f:d.width/2-e,m={x:d.x+d.width/2,y:d.y+d.height/2};this._center={x:m.x+this._xTranslate,y:m.y+this._yTranslate};var n=null;this._scaleTextVisible&&(n=new md);var o=this._axisStartAngle/180*Math.PI;for(g=0;g<this._axisCount;g++){var p=180*o/Math.PI,q=m.x+Math.cos(o)*l,r=m.y+Math.sin(-o)*l,s=null;n&&(s=new md,n.add(s)),this._ringVisible&&this._ringLineWidth>0&&(a.lineWidth=this._ringLineWidth,a.strokeStyle=this._ringLineColor);for(var t=1;t<=this._scaleCount;t++){var u=t/this._scaleCount,v=l*u,w=m.x+Math.cos(o)*v,x=m.y+Math.sin(-o)*v;if(this._ringVisible&&this._ringLineWidth>0){var y=m.x+Math.cos(o+this._averageAngleByRadian)*v,z=m.y+Math.sin(-o-this._averageAngleByRadian)*v;"line"==this._ringType?this.drawLine(a,this._ringLineColor,this._ringLineWidth,w,x,y,z):"arc"==this._ringType&&(a.beginPath(),a.moveTo(m.x,m.y),Vb.drawArc(a,m.x,m.y,o,this._averageAngleByRadian,v,v,!0),a.closePath(),a.stroke())}s&&(j=this.formatScaleText(this._axisMinValues.get(g)+this._axisRangeValues.get(g)*u,g),h=this.getTextSize(this._scaleTextFont,j),i=this.getScaleTextPosition(p,w,x,h.width,h.height),s.add({text:j,x:i.x,y:i.y}))}if(this._axisVisible&&this.drawLine(a,this._axisLineColor,this._axisLineWidth,m.x,m.y,q,r),k){var A=k.get(g);i=this.getAxisTextPosition(p,q,r,A.size.width,A.size.height),A.x=i.x,A.y=i.y}o+=this._averageAngleByRadian}this._publishedDatas.forEach(function(b){var c=this._map[b.getId()];c.points.clear();var d=c.anchorSize>0?new md:null,e=c.proportions;if(a.lineWidth=0,a.globalAlpha=this.isSelected(b)?this._areaSelectFillAlpha:this._areaFillAlpha,this._areaFill&&(a.fillStyle=c.color),this._drawItem(a,e,m,l,d,c),this._areaFill&&a.fill(),a.lineWidth=c.lineWidth,a.strokeStyle=c.color,a.globalAlpha=1,this._drawItem(a,e,m,l),a.lineWidth=0,null!=d&&d.size()>0){var f=c.anchorSize/2;d.forEach(function(b){a.fillStyle=c.color,Vb.drawVector(a,c.anchorShape,null,b.x-f,b.y-f,c.anchorSize,c.anchorSize),a.fill()})}},this),n&&n.forEach(function(b){b.forEach(function(b){Vb.drawText(a,b.text,b,this._scaleTextFont,this._scaleTextColor)},this)},this),k&&k.forEach(function(b){Vb.drawText(a,b.text,b,this._axisTextFont,this._axisTextColor)},this)}},_drawItem:function(a,b,c,d,e,f){var g=this._axisStartAngle/180*Math.PI,h=null;a.beginPath();for(var i=0;i<this._axisCount;i++){var j=b.get(i),k={x:c.x+Math.cos(g)*d*j,y:c.y+Math.sin(-g)*d*j};null==h?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),null!=e&&this._anchorVisible&&e.add(k),f&&f.points.add(k),0==i&&(h=k),g+=this._averageAngleByRadian}null!=h&&a.lineTo(h.x,h.y),a.closePath(),a.stroke()},getAxisTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f={x:b+d/2,y:c}),180==a&&(f={x:b-d/2,y:c}),90==a&&(f={x:b,y:c-e/2}),270==a&&(f={x:b,y:c+e/2}),a>270&&360>a&&(f={x:b+d/2,y:c+e/2}),a>180&&270>a&&(f={x:b-d/2,y:c+e/2}),a>90&&180>a&&(f={x:b-d/2,y:c-e/2}),a>0&&90>a&&(f={x:b+d/2,y:c-e/2}),f},getScaleTextPosition:function(a,b,c,d,e){a=(a%360+360)%360;var f={x:b,y:c};return 0==a&&(f={x:b,y:c+e/2}),180==a&&(f={x:b-d/2,y:c+e/2}),90==a&&(f={x:b+d/2,y:c}),270==a&&(f={x:b+d/2,y:c}),a>270&&360>a&&(f={x:b+d/2,y:c-e/2}),a>180&&270>a&&(f={x:b-d/2,y:c-e/2}),a>90&&180>a&&(f={x:b-d/2,y:c+e/2}),a>0&&90>a&&(f={x:b+d/2,y:c+e/2}),f}}),Gb.charts.LegendPane=function(a){Gb.charts.LegendPane.superClass.constructor.apply(this,arguments),this._divPool=new Gb.Pool("div"),this._iconPool=new Gb.Pool("div"),this._textPool=new Gb.Pool("span"),this._pools.add(this._divPool),this._pools.add(this._iconPool),this._pools.add(this._textPool),this._chart=a,this._chart.addViewListener(this.handleViewChange,this),this._view=Ub.createView("hidden"),this._view.style.verticalAlign="middle",this._legendDiv=Ub.createDiv(),this._legendDiv.style.whiteSpace="nowrap",this._legendDiv.style.verticalAlign="middle",this._legendDiv.style.position="",this._view.appendChild(this._legendDiv),this._hiddenMap={};var b=this;this._chart._internalVisibleFunction=function(a){return!b.isHidden(a)},Ob.isTouchable&&new Gb.charts.LegendPaneTouchInteraction(this),new Gb.charts.LegendPaneInteraction(this)},Hb.ext("twaver.charts.LegendPane",Gb.controls.ControlBase,{__accessor:["iconWidth","iconHeight","iconRadius","rowHeight","orientation","hiddenColor","selectBackgroundColor","selectForegroundColor"],_iconWidth:Dd.LEGENDPANE_ICON_WIDTH,_iconHeight:Dd.LEGENDPANE_ICON_HEIGHT,_iconRadius:Dd.LEGENDPANE_ICON_RADIUS,_rowHeight:Dd.LEGENDPANE_ROW_HEIGHT,_orientation:Dd.LEGENDPANE_ORIENTATION,_hiddenColor:Dd.LEGENDPANE_HIDDEN_COLOR,_selectBackgroundColor:Dd.LEGENDPANE_SELECT_BACKGROUND_COLOR,_selectForegroundColor:Dd.LEGENDPANE_SELECT_FOREGROUND_COLOR,onPropertyChanged:function(a){this.invalidate()},getChart:function(){return this._chart},isHidden:function(a){return null!=this._hiddenMap[a.getId()]},handleViewChange:function(a){"validateEnd"===a.kind&&(this._invalidate=!0,this.validate())},validate:function(){if(this._invalidate){this._invalidate=!1,Ub.release(this._legendDiv),Hb.keys(this._hiddenMap).forEach(function(a){this._chart.getDataBox().containsById(a)||delete this._hiddenMap[a]},this);for(var a=new md(this._chart.getUnfilteredDatas()),b=0;b<a.size();b++){var c=a.get(b);this._chart.isVisible(c)||this.isHidden(c)||(a.removeAt(b),b--)}var d=a.size(),e=this._view.style,f="horizontal"===this._orientation;for(f?(e.textAlign="center",e.height=this._rowHeight+"px"):(e.textAlign="",e.height=this._rowHeight*d+"px"),e.lineHeight=this._rowHeight-2+"px",b=0;d>b;b++){var c=a.get(b),g=this._divPool.get();g._data=c,g.style.cursor="pointer",g.style.height=this._rowHeight+"px",g.style.display=f?"inline-block":"block",this._legendDiv.appendChild(g),this.renderLegend(g,c),this.onLegendRendered(g,c)}this._pools.forEach(function(a){a.clear()})}},renderLegend:function(a,b){var c=!this.isHidden(b),d=this._chart.isSelected(b),e=this._iconPool.get(),f=e.style;f.display="inline-block",f.verticalAlign="middle",f.marginLeft="4px",f.width=this.getIconWidth()+"px",f.height=this.getIconHeight()+"px",f.backgroundColor=c?this._chart.getColor(b):this.getHiddenColor(),a.appendChild(e);var g=this._textPool.get();f=g.style,f.paddingLeft="2px",f.paddingRight="4px",f.display="inline-block",f.verticalAlign="middle",f.color=c?d?this._selectForegroundColor:"":this.getHiddenColor(),g.innerHTML=this._chart.getName(b),a.appendChild(g),a.style.backgroundColor=c&&d?this._selectBackgroundColor:""},onLegendRendered:function(a,b){}}),Gb.charts.ChartPane=function(a,b,c,d){Gb.charts.ChartPane.superClass.constructor.apply(this,arguments),this.invalidate(),this._chart=a,this._legendPane=new Gb.charts.LegendPane(a),this._titleDiv=Ub.createDiv(),this._titleDiv.style.verticalAlign="middle",this._titleDiv.style.whiteSpace="nowrap",this._view=Ub.createView("hidden"),this._view.appendChild(this._titleDiv),this._view.appendChild(this._legendPane.getView()),this._view.appendChild(this._chart.getView());var e=this;this._legendPane.addPropertyChangeListener(function(a){("rowHeight"===a.property||"orientation"===a.porperty)&&e.invalidate()}),arguments.length>1&&this.setTitle(b),arguments.length>2&&this.setLegendOrientation(c),arguments.length>3&&this.setLegendWidth(d)},Hb.ext("twaver.charts.ChartPane",Gb.controls.ControlBase,{__accessor:["title","titleHorizontalAlign","titleHeight","legendWidth"],_title:null,_titleHeight:Dd.CHARTPANE_TITLE_HEIGHT,_titleHorizontalAlign:Dd.CHARTPANE_TITLE_HORIZONTAL_ALIGN,_legendOrientation:Dd.CHARTPANE_LEGEND_ORIENTATION,_legendWidth:Dd.CHARTPANE_LEGEND_WIDTH,getLegendOrientation:function(){return this._legendOrientation},setLegendOrientation:function(a){if(this._legendOrientation!==a){var b=this._legendOrientation;this._legendOrientation=a,this.firePropertyChange("orientation",b,a),this._adjustLegendOrientation()}},_adjustLegendOrientation:function(){this._legendPane.setOrientation("left"===this._legendOrientation||"right"===this._legendOrientation?"vertical":"horizontal")},onPropertyChanged:function(a){this.invalidate()},getTitleDiv:function(){return this._titleDiv},getChart:function(){return this._chart},getLegendPane:function(){return this._legendPane},validateImpl:function(){this._adjustLegendOrientation();var a,b=this._view.offsetWidth,c=this._view.offsetHeight,d=this._legendPane.getRowHeight();this._title&&""!==this._title?(a=this._titleHeight,this._titleDiv.innerHTML=this._title):(a=0,this._titleDiv.innerHTML=""),this._titleDiv.innerHTML=this._title?this._title:"",this._titleDiv.style.textAlign=this._titleHorizontalAlign,this._titleDiv.style.lineHeight=this._titleHeight-2+"px";var e=this._titleDiv.style;e.left="0px",e.top="0px",e.width=b+"px",e.height=a+"px";var f,g;"bottom"===this._legendOrientation?(f={x:0,y:a,width:b,height:Math.max(c-a-d,0)},g={x:0,y:Math.max(c-d,0),width:b,height:d}):"right"===this._legendOrientation?(f={x:0,y:a,width:Math.max(b-this._legendWidth,0),height:Math.max(c-a,0)},g={x:Math.max(b-this._legendWidth,0),y:a,width:this._legendWidth,height:Math.max(c-a,0)}):"top"===this._legendOrientation?(f={x:0,y:a+d,width:b,height:Math.max(c-a-d,0)},g={x:0,y:a,width:b,height:d}):"left"===this._legendOrientation&&(f={x:this._legendWidth,y:a,width:Math.max(b-this._legendWidth,0),height:Math.max(c-a,0)},g={x:0,y:a,width:this._legendWidth,height:Math.max(c-a,0)}),f&&this._chart.adjustBounds(f),g&&this._legendPane.adjustBounds(g)}}),Gb.charts.ChartInteraction=function(a){this.chart=a,this.canvas=a._canvas;var b=this;this.canvas.addEventListener("mousedown",function(a){0===a.button&&b.handleMouseDown(a),a.preventDefault()},!1);var c=Ob.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(c,function(a){b.handleMouseWheel(a)},!1)},Hb.ext("twaver.charts.ChartInteraction",Object,{handleMouseDown:function(a){this.chart.isFocusOnClick()&&Gb.Util.setFocus(this.canvas),this.lastPoint=this.chart.getLogicalPoint(a);var b=this.chart.tryGetDataAt(a);2===a.detail&&null==b?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0)):(this._startLogical=this.lastPoint,this._startClient=Ub.getClientPoint(a),Ub.handle_mousedown(this,a))},handleMouseMove:function(a){if(this.lastPoint){var b={x:this._startLogical.x+a.clientX-this._startClient.x,y:this._startLogical.y+a.clientY-this._startClient.y};!this.startPan&&Rb.getDistance(this.lastPoint,b)>3&&(this.startPan=!0,this.lastPoint=b),this.startPan&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.lastPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.lastPoint.y),this.lastPoint=b)}},handleMouseUp:function(a){if(!this.startPan&&1===a.detail){var b=this.chart.tryGetDataAt(a),c=this.chart.getSelectionModel();b?Hb.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):Hb.isCtrlDown(a)||c.clearSelection()}delete this.lastPoint,delete this.startPan,delete this._startClient,delete this._startLogical},handleMouseWheel:function(a){Ub.preventDefault(a);var b=Ob.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>b&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))}}),Gb.charts.ChartTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,Ub.addEventListener("touchstart","handleTouchstart",this.canvas,this)},Hb.ext("twaver.charts.ChartTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.chart.isFocusOnClick()&&Gb.Util.setFocus(this.canvas),this.endPoint=this.chart.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.canvas,this),Ub.addEventListener("touchend","handleTouchend",this.canvas,this)},handleTouchmove:function(a){if(Ub.preventDefault(a),this.endPoint){var b=this.chart.getLogicalPoint(a);if(!this.moved&&Rb.getDistance(this.endPoint,b)>10&&(this.moved=!0,this.lastPoint=b),this.moved)if(yc.isSingleTouch(a))this.endPoint&&(this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this.endPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this.endPoint.y),this.endPoint=b);else if(this.distance){var c=yc.getDistance(a)/this.distance,d=this.xZoom*c,e=this.yZoom*c;this.chart.isXZoomEnabled()&&this.chart.setXZoom(d,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(e,!1)}}},handleTouchend:function(a){if(Ub.preventDefault(a),!this.moved){this.endPoint=this.chart.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date);var c=this.chart.tryGetDataAt(a);if(b&&null==c)this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0));else{var d=this.chart.getSelectionModel();c?d.contains(c)||d.setSelection(c):d.clearSelection()}}delete this.endPoint,delete this.distance,delete this.xZoom,delete this.yZoom,delete this.moved,Ub.removeEventListener("touchmove",this.canvas,this),Ub.removeEventListener("touchend",this.canvas,this)}}),Gb.charts.ChartMSTouchInteraction=function(a){this.chart=a,this.canvas=a._canvas,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.canvas,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.canvas,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.canvas,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.canvas,this);var b=Ob.isFirefox?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(b,function(a){self.handleMouseWheel(a)},!1)},Hb.ext("twaver.charts.ChartMSTouchInteraction",Object,{handleTouchstart:function(a){this.chart.isFocusOnClick()&&Gb.Util.setFocus(this.canvas);var b=this.chart.getLogicalPoint(a);a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&b&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a);var c=this.chart.tryGetDataAt(a);if(1==this._pointerIdArray.length&&b){var d=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=10;d&&null==c?this.chart.isDoubleClickToReset()&&(this.chart.zoomReset(!1),this.chart.setXTranslate(0),this.chart.setYTranslate(0),this._startTouchPoint=null,this._startTouchTime=null,this._startClientPoint=null):(this._startTouchPoint=b,this._startTouchTime=new Date,this._startClientPoint={x:a.clientX,y:a.clientY},Ub.handle_mousedown(this,a))}else 2==this._pointerIdArray.length&&(this.xZoom=this.chart.getXZoom(),this.yZoom=this.chart.getYZoom(),this._distance=this._getDistance())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=3)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance,c=this.xZoom*b,d=this.yZoom*b;this.chart.isXZoomEnabled()&&this.chart.setXZoom(c,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(d,!1)}},handleTouchend:function(a){var b=this.chart.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b&&!this.moved){var c=this.chart.tryGetDataAt(a),d=this._startTouchPoint&&this._startTouchTime&&(new Date).getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=10,e=this.chart.getSelectionModel();c&&d?Hb.isCtrlDown(a)?e.contains(c)?e.removeSelection(c):e.appendSelection(c):e.contains(c)||e.setSelection(c):Hb.isCtrlDown(a)||e.clearSelection()}this.moved=!1,this._pointerMap={},this._pointerIdArray=[]},handleMouseWheel:function(a){Ub.preventDefault(a);var b=Ob.isFirefox?-a.detail:a.wheelDelta;b>0?(this.chart.isXZoomEnabled()&&this.chart.setXZoom(1.1*this.chart.getXZoom(),!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(1.1*this.chart.getYZoom(),!1)):0>b&&(this.chart.isXZoomEnabled()&&this.chart.setXZoom(this.chart.getXZoom()/1.1,!1),this.chart.isYZoomEnabled()&&this.chart.setYZoom(this.chart.getYZoom()/1.1,!1))},handle_mousemove:function(a){if(1==this._pointerIdArray.length&&this._startTouchPoint&&this._startClientPoint){var b={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.chart.getXZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.chart.getYZoom()};Rb.getDistance(this._startTouchPoint,b)>3&&(this.moved=!0,this.chart.isXTranslateEnabled()&&this.chart.setXTranslate(this.chart.getXTranslate()+b.x-this._startTouchPoint.x),this.chart.isYTranslateEnabled()&&this.chart.setYTranslate(this.chart.getYTranslate()+b.y-this._startTouchPoint.y),this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY)}},handle_mouseup:function(a){this.handleTouchend(a)},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.charts.LegendPaneInteraction=function(a){this.legendPane=a;var b=this;this.legendPane._legendDiv.addEventListener("mousedown",function(a){b.handleMouseDown(a)},!1)},Hb.ext("twaver.charts.LegendPaneInteraction",Object,{handleMouseDown:function(a){if(0===a.button){var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}}),Gb.charts.LegendPaneTouchInteraction=function(a){this.legendPane=a,Ub.addEventListener("touchstart","handleTouchstart",this.legendPane._legendDiv,this)},Hb.ext("twaver.charts.LegendPaneTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a);var b=a.target._data;b||(b=a.target.parentNode._data),b&&(this.legendPane._hiddenMap[b.getId()]?delete this.legendPane._hiddenMap[b.getId()]:this.legendPane._hiddenMap[b.getId()]=b,this.legendPane._chart.invalidateModel())}}),Gb.network.Network=function(a){Gb.network.Network.superClass.constructor.apply(this,arguments),this._elementUIMap={},this._layerMap={},this._layerList=new md,this._view=Ub.createView("auto"),this._rootDiv=Ub.createDiv(),this._topDiv=Ub.createDiv(),this._attachmentDiv=Ub.createDiv(),this._layersDiv=Ub.createDiv(),this._bottomDiv=Ub.createDiv(),this._rootDiv.appendChild(this._bottomDiv),this._rootDiv.appendChild(this._layersDiv),this._rootDiv.appendChild(this._attachmentDiv),this._rootDiv.appendChild(this._topDiv),this._view.appendChild(this._rootDiv),this.setElementBox(a?a:new Gb.ElementBox),Ob.isTouchable?Ob.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1);var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Gb.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.drawBody()})}},this.setToolTipEnabled(Dd.NETWORK_TOOLTIP_ENABLED),this._view.addEventListener("scroll",function(a){mc.twm(b)}),this.addPropertyChangeListener(function(a){"zoom"===a.property&&mc.twm(b)}),Gb.imageUtil.addEventListener(this.invalidateElementUIs,this)},Hb.ext("twaver.network.Network",Gb.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable"],_viewRect:{x:0,y:0,width:0,height:0},_currentSubNetwork:null,_selectMode:Dd.NETWORK_SELECT_MODE,_noAgentLinkVisible:Dd.NETWORK_NO_AGENT_LINK_VISIBLE,_makeVisibleOnSelected:Dd.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Dd.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Dd.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Dd.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_subNetworkAnimate:Dd.NETWORK_SUBNETWORK_ANIMATE,_transparentSelectable:Dd.NETWORK_TRANSPARENT_SELECTABLE,_removeElementUIOnInvisible:Dd.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE,_elementUIFunction:Dd.ELEMENTUI_FUNCTION,_doubleClickToUpSubNetwork:Dd.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Dd.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Dd.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Dd.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Dd.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_sendToTopOnSelected:Dd.NETWORK_SENDTOTOP_ON_SELECTED,_selectOutlineColor:Dd.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Dd.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Dd.NETWORK_SELECT_FILL_COLOR,_lazyMoveOutlineColor:Dd.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Dd.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Dd.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Dd.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Dd.NETWORK_LAZYMOVE_ANIMATE,_editPointSize:Dd.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Dd.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Dd.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Dd.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Dd.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Dd.NETWORK_EDIT_LINE_WIDTH,_resizePointSize:Dd.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Dd.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Dd.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Dd.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Dd.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Dd.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Dd.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Dd.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Dd.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Dd.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Dd.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Dd.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Dd.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Dd.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Dd.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Dd.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Dd.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Dd.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Dd.NETWORK_SELECTION_TOLERANCE,_invalidate:!1,_invalidateElementVisibility:!1,_invalidateElementIndex:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Gb.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,getLabel:function(a){return a.getStyle("network.label")||a.getName()},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){var c=b.getElementAt(a);if(b._preElement!==c)if(b._preElement=c,c){var d=b.getToolTip(c);Ac.showToolTip({x:a.pageX,y:a.pageY},d);var e=Ac.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(Mb.documentElement.scrollLeft||Mb.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(Mb.documentElement.scrollTop||Mb.body.scrollTop)+"px")}}else Ac.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!0),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!0),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getTopDiv:function(){return this._topDiv},getAttachmentDiv:function(){return this._attachmentDiv},getLayersDiv:function(){return this._layersDiv},getBottomDiv:function(){return this._bottomDiv},validateImpl:function(){if(mc.twm(this),this.__lics__){var a=0,b=null,c=null,d=null,e=this._invalidateElementVisibility;if(this._invalidateElementVisibility&&(this._invalidateElementVisibility=!1,this._removeElementUIOnInvisible&&(this._invalidateElementIndex=!0),this.forEachElementUI(function(e){e.validate();var f=e.getElement();if(e.setVisible(this.isVisible(f)),this._removeElementUIOnInvisible){if(b=this.getLayerDivByElement(f),e.isVisible()){if(e.getView().parentNode!==b)for(b.appendChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())}else if(e.getView().parentNode===b)for(b.removeChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.removeChild(d.getView())}else if(!e.getView().parentNode)for(b=this.getLayerDivByElement(f),b.appendChild(e.getView()),c=e.getAttachments(),a=0;a<c.size();a++)d=c.get(a),d.isShowInAttachmentDiv()&&this._attachmentDiv.appendChild(d.getView())},null,this)),this._invalidateElementIndex){this._invalidateElementIndex=!1;var f,g=this;this._box.getLayerBox().forEachByDepthFirst(function(a){var b,c=g._layerMap[a.getId()];g._box.forEachByLayer(function(a){var d=g._elementUIMap[a.getId()];if(d&&d.getView().parentNode===c){b=Ub.insertAfter(d.getView(),b);for(var e=d.getAttachments(),h=0;h<e.size();h++){
var i=e.get(h);i.getView().parentNode===g._attachmentDiv&&(f=Ub.insertAfter(i.getView(),f))}}},a)})}if(e&&!this._invalidateElementVisibility){var h;for(var i in this._elementUIMap){var j=this._elementUIMap[i];j.isVisible()&&(h=Rb.unionRect(h,j.getViewRect()))}if(h=h?{x:0,y:0,width:h.x+h.width,height:h.y+h.height}:{x:0,y:0,width:0,height:0},h.x!==this._viewRect.x||h.y!==this._viewRect.y||h.width!==this._viewRect.width||h.height!==this._viewRect.height){var k=this._viewRect;this._viewRect=h,this._rootDiv.style.left="0px",this._rootDiv.style.top="0px",this._rootDiv.style.width=h.width+"px",this._rootDiv.style.height=h.height+"px",this.firePropertyChange("viewRect",k,h)}}}},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(uc.getSubNetwork(this._currentSubNetwork),a,b)},sendToTop:function(a){if(this.isVisible(a)){for(var b=a;this.isVisible(b.getParent())&&(b=b.getParent()););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},invalidateElementIndex:function(){this._invalidateElementIndex||(this._invalidateElementIndex=!0,this.invalidate())},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},updateLayers:function(){Ub.clear(this._layersDiv),Ub.clear(this._attachmentDiv),this._layerMap={},this._layerList.clear();var a=this;this._box.getLayerBox().forEachByDepthFirst(function(b){var c=Ub.createDiv();Ub.setVisible(c,b.isVisible()),a._layerMap[b.getId()]=c,a._layersDiv.appendChild(c),a._layerList.add(b)}),this._box.forEach(this.createElementUI,this)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){var d=Gb.animate.AnimateManager;if(d.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";d.start(new Gb.animate.AnimateSubNetwork(this,a,c))}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility()}},isVisible:function(a){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(this._visibleFunction&&!this._visibleFunction(a))return!1;if(!this._box.getLayerBox().getLayerByElement(a).isVisible())return!1;if(uc.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof Gb.Link){if(!this.isNoAgentLinkVisible()){if(!a.getFromAgent()||!a.getToAgent())return!1;if(!this.isVisible(a.getFromAgent())||!this.isVisible(a.getToAgent()))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var b=a.getParent();b&&!b.ISubNetwork;){if(b instanceof Nd&&(!b.isExpanded()||!this.isVisible(b)))return!1;b=b.getParent()}return a.IDummy?!1:!0},isMovable:function(a){return this._box.contains(a)?a instanceof Gb.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isMovable():!1},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this._box.getLayerBox().getLayerByElement(a).isEditable():!1},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return null==this._linkableFunction||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Gb.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this.updateLayers(),this.invalidateElementVisibility(),this.firePropertyChange("elementBox",b,this._box)}},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},getElementUI:function(a){return a?this._elementUIMap[a.getId()]:null},getLayerDivByElement:function(a){var b=this._box.getLayerBox().getLayerByElement(a);return b?this._layerMap[b.getId()]:null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];if(b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b)),b){var c=this.getLayerDivByElement(a);b.getView().parentNode!==c&&(c.appendChild(b.getView()),b.getAttachments().forEach(function(a){a.isShowInAttachmentDiv()&&a.getView().parentNode!==this._attachmentDiv&&this._attachmentDiv.appendChild(a.getView())},this)),this.invalidateElementIndex()}},invalidateBundleLink:function(a){if(a instanceof Gb.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},handleLayerBoxChange:function(a){this.updateLayers(),this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){var b=a.source;if("visible"===a.property){var c=this._layerMap[b.getId()];Ub.setVisible(c,b.isVisible())}else"editable"===a.property&&this.invalidateSelectedElementUIs(!0);this.invalidateElementVisibility()},handleLayerHierarchyChange:function(a){var b;this._layerList.clear(),this._box.getLayerBox().forEachByDepthFirst(function(a){var c=this._layerMap[a.getId()];b=Ub.insertAfter(c,b),this._layerList.add(a)},null,this),this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this),this.invalidateElementVisibility();var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b))},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=uc.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Hb.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Nd&&e.setExpanded(!0);var f=b.getUnionBodyBounds();if(f){var g={x:this._view.scrollLeft/this._zoom,y:this._view.scrollTop/this._zoom,width:this._view.clientWidth/this._zoom,height:this._view.clientHeight/this._zoom};Rb.intersects(g,f)||this.isVisible(a)&&Hb.callLater(this.centerByLogicalPoint,this,[f.x+f.width/2,f.y+f.height/2])}}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);if(c){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode===e&&e.removeChild(c.getView()),c.dispose(),delete this._elementUIMap[b.getId()]}b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else"clear"===a.kind&&(this.forEachElementUI(function(a){a.dispose()}),this._elementUIMap={},this.updateLayers(),null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null));this.invalidateElementVisibility()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);if(c&&(c.handlePropertyChange(a),"layerId"===a.property)){var d=this._box.getLayerBox().getLayerByElement(b),e=this._layerMap[d.getId()];c.getView().parentNode!==e&&(e.appendChild(c.getView()),this.invalidateElementIndex())}this.invalidateBundleLink(b),this.invalidateElementVisibility()},handleElementBoxPropertyChange:function(a){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementIndex()},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||this.updateLayers()}},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},getSelectColor:function(a){return a.getStyle("select.color")},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},isRemoveElementUIOnInvisible:function(){return this._removeElementUIOnInvisible},setRemoveElementUIOnInvisible:function(a){var b=this._removeElementUIOnInvisible;this._removeElementUIOnInvisible=a,this.firePropertyChange("removeElementUIOnInvisible",b,a),this.invalidateElementVisibility()},setDefaultInteractions:function(a,b){var c=[new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.MoveInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)];b&&c.push(new Gb.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setPanInteractions:function(){this.setInteractions([new Gb.network.interaction.PanInteraction(this),new Gb.network.interaction.DefaultInteraction(this)])},setEditInteractions:function(a,b){var c=[new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.EditInteraction(this,a),new Gb.network.interaction.MoveInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)];b&&c.push(new Gb.network.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setCreateElementInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateElementInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateLinkInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateShapeLinkInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Gb.network.interaction.CreateShapeNodeInteraction(this,a),new Gb.network.interaction.DefaultInteraction(this)])},setTouchInteractions:function(){var a=[new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.MoveInteraction(this,!1),new Gb.network.interaction.DefaultInteraction(this),new Gb.network.interaction.TouchInteraction(this)];this.setInteractions(a)},setMSTouchInteractions:function(){this.setInteractions([new Gb.network.interaction.MSTouchInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Gb.network.interaction.SelectInteraction(this),new Gb.network.interaction.MoveInteraction(this),new Gb.network.interaction.DefaultInteraction(this),new Gb.network.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Gb.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Ld){var f=this.getElementUI(e);f&&(b=Rb.unionRect(b,f.getViewRect()))}}return b},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getPosition:function(a,b,c,d,e){var f,g=b instanceof Gb.network.ElementUI?b:this.getElementUI(b);if(g)if("from"===a||"to"===a){if(g.getFromPosition&&(f="from"===a?g.getFromPosition(d,e):g.getToPosition(d,e)))return{x:f.x-c.width/2,y:f.y-c.height/2}}else f="hotspot"===a?g.getHotSpot():Tb.get(a,g.getBodyRect(),c);if(!f&&b.getRect&&(f=Tb.get(a,b.getRect(),c)),f)return{x:f.x+d,y:f.y+e};throw"position '"+a+"' object '"+b+"'"},getViewRect:function(){return this._viewRect?Hb.clone(this._viewRect):{x:0,y:0,width:0,height:0}},forEachElementUI:function(a,b,c){b?this._box.forEachReverse(function(d){if(this.getLayerByElement(d)===b){var e=this.getElementUI(d);e&&(c?a.call(c,e):a(e))}},this):this._layerList.forEachReverse(function(b){this.forEachElementUI(a,b,c)},this)},findFirstElement:function(a,b){for(var c=this._layerList.size()-1,d=this._box.size()-1,e=c;e>=0;e--)for(var f=this._layerList.get(e),g=d;g>=0;g--){var h=this._box.getDataAt(g);if(this.getLayerByElement(h)===f)if(b){if(a.call(b,h)===!0)return h}else if(a(h)===!0)return h}return null},getElementAt:function(a,b){if(1===arguments.length&&(b=!0),!this.isValidEvent(a))return null;a=this._getPoint(a),a||console.log("null");var c=a.x,d=a.y,e=this._selectionTolerance;if(e&&e>0){var f={x:c,y:d,width:0,height:0};Rb.grow(f,e,e)}return this.findFirstElement(function(a){if(b&&!this.isSelectable(a))return!1;var e=this.getElementUI(a);return e?f?!!e.intersectsTest(f):!!e.hitTest(c,d):!1},this)},_getPoint:function(a){return a?a.target?this.getLogicalPoint(a):a:null},getElementsAtRect:function(a,b,c,d){var e=new md;return d=void 0===d?!0:d,this.forEachElementUI(function(f){f.isVisible()&&(!c||c(f._element))&&(d&&this.isSelectable(f._element)||!d)&&(b?f.intersectsTest(a)&&e.add(f._element):Rb.contains(a,f.getViewRect())&&e.add(f._element))},null,this),e},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);return c?(a=this._getPoint(a),c.hitTest(a.x,a.y)):null},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Dd.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c){c||(c=Ub.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var d=c.getContext("2d");if(d.clearRect(0,0,a,b),0===this._view.clientWidth||0===this._view.clientHeight)return c;var e=a/this._view.scrollWidth*this._zoom,f=b/this._view.scrollHeight*this._zoom;return d.scale(e,f),Ub.forEach(this._view,function(a){if(("CANVAS"===a.tagName||"IMG"===a.tagName)&&!a._isIgnored){var b=a._viewRect;if(b)try{d.drawImage(a,b.x,b.y,b.width,b.height)}catch(a){}}}),c},toCanvasByRegion:function(a,b,c){c||(c=Ub.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e);var f=c.getContext("2d");return f.clearRect(0,0,d,e),0===this._view.clientWidth||0===this._view.clientHeight?c:(f.save(),f.scale(b,b),Ub.forEach(this._view,function(b){if(("CANVAS"===b.tagName||"IMG"===b.tagName)&&!b._isIgnored){var c=b._viewRect;if(c&&Rb.intersects(c,a))try{f.drawImage(b,c.x-a.x,c.y-a.y,c.width,c.height)}catch(b){}}}),f.restore(),c)},getGroupChildrenRects:function(a){var b=new md;return a.getChildren().forEach(function(a){if(a instanceof Ld){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){},setMovingElement:function(a){if(a!=this._movingElement){var b=this._movingElement;this._movingElement=a,this.firePropertyChange("movingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(a){if(a!=this._editingElement){var b=this._editingElement;this._editingElement=a,this.firePropertyChange("editingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){Gb.imageUtil.removeEventListener(this.invalidateElementUIs,this)}}),Gb.network.Overview=function(a){Gb.network.Overview.superClass.constructor.apply(this,arguments),this._view=Ub.createView(),this._rootDiv=Ub.createDiv(),this._imageCanvas=Ub.createCanvas(),this._imageDiv=Ub.createDiv(),this._maskCanvas=Ub.createCanvas(),this._selectDiv=Ub.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Ub.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this.setNetwork(a),Ob.isTouchable?Ob.isMSTouchable?new Gb.network.OverviewMSTouchInteraction(this):(new Gb.network.OverviewTouchInteraction(this),new Gb.network.OverviewInteraction(this)):new Gb.network.OverviewInteraction(this)},Hb.ext("twaver.network.Overview",Gb.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Dd.OVERVIEW_FILL_COLOR,_outlineColor:Dd.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Dd.OVERVIEW_OUTLINE_WIDTH,_selectColor:Dd.OVERVIEW_SELECT_COLOR,_selectWidth:Dd.OVERVIEW_SELECT_WIDTH,_padding:Dd.OVERVIEW_PADDING,_animate:Dd.OVERVIEW_ANIMATE,_maxPackingWidth:Dd.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Dd.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Ub.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Ub.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Hb.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Hb.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network._view.clientWidth&&0!==this._network._view.clientHeight){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Rb.grow(a,-this._padding,-this._padding);var c=Math.min(a.width/this._network._view.scrollWidth,a.height/this._network._view.scrollHeight);b&&(Ub.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var d=this._network._view.scrollWidth*c,e=this._network._view.scrollHeight*c,f=a.x+(a.width-d)/2,g=a.y+(a.height-e)/2;if(this._isNetworkDirty){var h={x:f,y:g,width:d,height:e};this._network.toCanvas(h.width,h.height,this._imageCanvas),Ub.setDiv(this._imageDiv,h,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var i={x:this._network._view.scrollLeft*c,y:this._network._view.scrollTop*c,width:d*this._network._view.clientWidth/this._network._view.scrollWidth,height:e*this._network._view.clientHeight/this._network._view.scrollHeight},j=Ub.setCanvas(this._maskCanvas,f,g,d,e);j.lineWidth=0,j.fillStyle=this._fillColor,j.beginPath(),Vb.drawVector(j,"rectangle",null,f,g,d,e),j.fill(),j.clearRect(f+i.x,g+i.y,i.width,i.height);var k=this._outlineWidth<0?0:this._outlineWidth;j.lineWidth=k,j.strokeStyle=this._outlineColor,j.beginPath(),Vb.drawVector(j,"rectangle",null,f+i.x+k,g+i.y+k,i.width-2*k,i.height-2*k),k>=0&&j.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;Rb.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network._view.scrollWidth/this._network.getZoom(),(a.y-c.y)/c.height*this._network._view.scrollHeight/this._network.getZoom(),b),this._invalidateMask())}}),Gb.network.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.network.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.network.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(Ub.preventDefault(a),this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),yc.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=yc.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Gb.network.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("mousedown","handleMousedown",this.view,this)},Hb.ext("twaver.network.OverviewInteraction",Object,{handleMousedown:function(a){0===a.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Hb.isCtrlDown(a)&&(this.startPoint=this.endPoint,Ub.setVisible(this.overview._selectDiv,!0)),Ub.addEventListener("mousemove","handleMousemove",this.view,this),Ub.addEventListener("mouseup","handleMouseup",Mb,this))},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f),h=this.network._view.scrollWidth/this.network.getZoom()*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network._view.scrollHeight/this.network.getZoom()*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);this.network.setZoom(g*Math.min(this.network._view.clientWidth/this.network._view.scrollWidth,this.network._view.clientHeight/this.network._view.scrollHeight)*this.network.getZoom(),!1),Hb.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Ub.setVisible(this.overview._selectDiv,!1),Ub.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Ub.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("mousemove",this.view,this),Ub.removeEventListener("mouseup",this.view,this))}}),Gb.network.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Hb.ext("twaver.network.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.network.ElementUI=function(a,b){this._view=Ub.createDiv(),this._bodyView=Ub.createDiv(),this._view.appendChild(this._bodyView),this._network=a,this._element=b,this._attachments=new md,this._bodyBounds=new md,this.invalidate(!0)},Hb.ext("twaver.network.ElementUI",Object,{_invalidateFlag:!1,_invalidateAttachmentsFlag:!1,getElement:function(){return this._element},getNetwork:function(){return this._network},getAttachments:function(){return this._attachments},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);

return b?b:Dd.FONT},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},getHotSpot:function(){return this._hotSpot?Hb.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},getUnionBodyBounds:function(){return Hb.clone(this._unionBodyBounds)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Hb.clone(this._bodyRect)},invalidate:function(a){void 0===a&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateMeasure:function(){},validate:function(){if(this._invalidateFlag){this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this._bodyBounds.clear(),Ub.clear(this._bodyView),this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this.updateMeasure();var a=this._element.getStyle("whole.alpha");this._view.style.opacity=a,this._attachments.forEach(function(b){b.updateMeasure();var c=b.getAlpha();b._view.style.opacity=b.isShowInAttachmentDiv()?c*a:c});var b;this._bodyBounds.forEach(function(a){b=Rb.unionRect(b,a)}),this._unionBodyBounds=Hb.clone(b),this._attachments.forEach(function(a){b=Rb.unionRect(b,a.getViewRect())}),this._viewRect=b}},cleanUp:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e=this[d];e&&!e.parentNode&&(this[d]=null)}},setVisible:function(a){this.isVisible()!==a&&(Ub.setVisible(this._view,a),this._attachments.forEach(function(b){b.isShowInAttachmentDiv()&&Ub.setVisible(b._view,a)}),this.invalidate(!0))},isVisible:function(){return Ub.isVisible(this._view)},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Gb.network.LabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Gb.network.AlarmAttachment(this,Dd.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Gb.network.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this.isEditable()&&this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)?this._editAttachment||(this._editAttachment=new Gb.network.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},isEditable:function(){return!0},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},dispose:function(){this._attachments.forEach(function(a){a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose()}),this._attachments.clear()},addAttachment:function(a){this._attachments.add(a),a.isShowInAttachmentDiv()?this._network.getAttachmentDiv().appendChild(a.getView()):this._view.appendChild(a.getView()),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),a.getView().parentNode&&a.getView().parentNode.removeChild(a.getView()),a.dispose(),this.invalidate(!1)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},addComponent:function(a){this._bodyView.appendChild(a)},getBodyView:function(){return this._bodyView},getView:function(){return this._view},getViewRect:function(){return Hb.clone(this._viewRect)},setShadow:function(a,b,c){var d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;d&&(this._shadowXOffset>0?c.width+=this._shadowXOffset:(c.x+=this._shadowXOffset,c.width+=-this._shadowXOffset),this._shadowYOffset>0?c.height+=this._shadowYOffset:(c.y+=this._shadowYOffset,c.height+=-this._shadowYOffset),Rb.grow(c,this._shadowBlur,this._shadowBlur));var e=Ub.setCanvas(b,c);return d&&(e.shadowOffsetX=this._shadowXOffset,e.shadowOffsetY=this._shadowYOffset,e.shadowBlur=this._shadowBlur,e.shadowColor=this._shadowColor),e},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},hit:function(a,b){return!1},hitCanvas:function(a,b,c){for(var d=c.length,e=0;d>e;e++){var f=c[e],g=this[f];if(Vb.hit(g,a,b,this._network.getSelectionTolerance()))return!0}return!1},hitComponent:function(a,b,c){for(var d=c.length,e=0;d>e;e++){var f=c[e],g=this[f];if(g&&Rb.containsPoint(g._viewRect,a,b))return!0}return!1},hitTest:function(a,b){if(!this.isVisible()||!Rb.containsPoint(this._viewRect,a,b))return null;var c,d,e=this._attachments.size();for(c=e-1;c>=0;c--)if(d=this._attachments.get(c),d.isShowInAttachmentDiv()&&d.hit(a,b))return d;for(c=e-1;c>=0;c--)if(d=this._attachments.get(c),!d.isShowInAttachmentDiv()&&d.hit(a,b))return d;return Rb.containsPoint(this._unionBodyBounds,a,b)&&this.hit(a,b)?this:null},intersects:function(a){return!1},intersectsComponent:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this[e];if(f&&Rb.intersects(f._viewRect,a))return!0}return!1},intersectsCanvas:function(a,b){for(var c=b.length,d=0;c>d;d++){var e=b[d],f=this[e];if(Vb.intersects(f,a))return!0}return!1},intersectsTest:function(a){if(!this.isVisible()||!Rb.intersects(this._viewRect,a))return null;var b,c,d=this._attachments.size();for(b=d-1;b>=0;b--)if(c=this._attachments.get(b),c.isShowInAttachmentDiv()&&c.intersects(a))return c;for(b=d-1;b>=0;b--)if(c=this._attachments.get(b),!c.isShowInAttachmentDiv()&&c.intersects(a))return c;return Rb.intersects(this._unionBodyBounds,a)&&this.intersects(a)?this:null}}),Gb.network.Attachment=function(a,b){this._view=Ub.createDiv(),this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._isShowInAttachmentDiv=b===!0,this._isShowInAttachmentDiv&&Ub.setVisible(this._view,a.isVisible())},Hb.ext("twaver.network.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},isShowInAttachmentDiv:function(){return this._isShowInAttachmentDiv},getView:function(){return this._view},getViewRect:function(){return Hb.clone(this._viewRect)},getAlpha:function(){return 1},updateMeasure:function(){},dispose:function(){},hit:function(a,b){return Rb.containsPoint(this._viewRect,a,b)},intersects:function(a){return Rb.intersects(this._viewRect,a)}}),Gb.network.BasicAttachment=function(a,b){Gb.network.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._attachmentCanvas=Ub.createCanvas(),this._view.insertBefore(this._attachmentCanvas,this._view.firstChild)},Hb.ext("twaver.network.BasicAttachment",Gb.network.Attachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+2*c,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);var l;if("aboveleft"===k)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("aboveright"===k)i.y=j.y-d-i.height,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:l,y:j.y-d}];else if("belowleft"===k)i.y=j.y+d,i.x=j.x-(i.width-c),l=Math.max(j.x-e,i.x+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("belowright"===k)i.y=j.y+d,i.x=j.x-c,l=Math.min(j.x+e,i.x+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:l,y:j.y+d}];else if("leftabove"===k)i.y=j.y+c-i.height,i.x=j.x-d-i.width,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("leftbelow"===k)i.y=j.y-c,i.x=j.x-d-i.width,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:l}];else if("rightabove"===k)i.y=j.y+c-i.height,i.x=j.x+d,l=Math.max(j.y-e,i.y+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("rightbelow"===k)i.y=j.y-c,i.x=j.x+d,l=Math.min(j.y+e,i.y+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:l}];else if("above"===k)i.y=j.y-d-i.height,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y-d},{x:j.x+l,y:j.y-d}];else if("below"===k)i.y=j.y+d,i.x=j.x-i.width/2,l=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-l,y:j.y+d},{x:j.x+l,y:j.y+d}];else if("left"===k)i.y=j.y-i.height/2,i.x=j.x-d-i.width,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+l},{x:j.x-d,y:j.y-l}];else{if("right"!==k)throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,l=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+l},{x:j.x+d,y:j.y-l}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var m=this.getPadding();0!=m&&Rb.grow(i,m,m),m=this.getPaddingLeft(),0!=m&&(i.x-=m,i.width+=m),m=this.getPaddingRight(),0!=m&&(i.width+=m),m=this.getPaddingTop(),0!=m&&(i.y-=m,i.height+=m),m=this.getPaddingBottom(),0!=m&&(i.height+=m),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},updateMeasure:function(){Gb.network.BasicAttachment.superClass.updateMeasure.call(this),this.calculateMeasure();var a=this.isFill(),b=this.getOutlineWidth();this._viewRect=Rb.getRect(this._pointers),this._viewRect=Rb.unionRect(this._viewRect,this._roundRect),b>0&&Rb.grow(this._viewRect,b/2,b/2);var c=this._ui.setShadow(this,this._attachmentCanvas,this._viewRect);if((b>0||a)&&(c.beginPath(),Vb.drawRoundRect(c,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(c.moveTo(this._pointers[0].x,this._pointers[0].y),c.lineTo(this._pointers[1].x,this._pointers[1].y),c.lineTo(this._pointers[2].x,this._pointers[2].y)),c.closePath(),b>0&&(c.lineWidth=b,c.strokeStyle=this.getOutlineColor(),c.lineCap=this.getCap(),c.lineJoin=this.getJoin(),c.stroke()),a)){var d=this.getFillColor(),e=this.getGradient();e?Vb.fill(c,d,e,this.getGradientColor(),this._viewRect):c.fillStyle=d,c.fill()}return c},getRoundRect:function(){return Hb.clone(this._roundRect)},getContentRect:function(){return Hb.clone(this._contentRect)},getContent:function(){return this._content},setContent:function(a){this._content!==a&&(this._content&&this._view.removeChild(this._content),this._content=a,a&&this._view.appendChild(a))},getContentWidth:function(){return Dd.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Dd.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Dd.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Dd.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Dd.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Dd.ATTACHMENT_POSITION},getXOffset:function(){return Dd.ATTACHMENT_XOFFSET},getYOffset:function(){return Dd.ATTACHMENT_YOFFSET},getPadding:function(){return Dd.ATTACHMENT_PADDING},getPaddingLeft:function(){return Dd.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Dd.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Dd.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Dd.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Dd.ATTACHMENT_DIRECTION},isFill:function(){return Dd.ATTACHMENT_FILL},getFillColor:function(){return Dd.ATTACHMENT_FILL_COLOR},getGradient:function(){return Dd.ATTACHMENT_GRADIENT},getGradientColor:function(){return Dd.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Dd.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Dd.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Dd.ATTACHMENT_CAP},getJoin:function(){return Dd.ATTACHMENT_JOIN},isShadowable:function(){return Dd.ATTACHMENT_SHADOWABLE},hit:function(a,b){return Rb.containsPoint(this._viewRect,a,b)?Rb.containsPoint(this._contentRect,a,b)?!0:Vb.hit(this._attachmentCanvas,a,b):!1},intersects:function(a){return Rb.intersects(this._viewRect,a)?Rb.intersects(this._contentRect,a)?!0:Vb.intersects(this._attachmentCanvas,a):!1}}),Gb.network.LabelAttachment=function(a,b){Gb.network.LabelAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.LabelAttachment",Gb.network.BasicAttachment,{updateMeasure:function(){var a,b=this.getFont("label.font"),c=this.getLabel(),d=Hb.g.getTextSize(b,c),e=this.getMaxLength();0!==e&&d.width>e?(a=Hb.g.getCollapseTextInLength(b,c,e),this._textSize=Hb.g.getTextSize(b,a)):(a=c,this._textSize=d);var f=Gb.network.LabelAttachment.superClass.updateMeasure.call(this),g=this._element.getStyle("label.align");Vb.drawText(f,a,this._contentRect,b,this.getStyle("label.color"),g)},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Gb.network.AlarmAttachment=function(a,b){Gb.network.AlarmAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.AlarmAttachment",Gb.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font"),b=this._network.getAlarmLabel(this._element);this._textSize=Vb.getTextSize(a,b),this._fillColor=this._network.getAlarmFillColor(this._element);var c=Gb.network.AlarmAttachment.superClass.updateMeasure.call(this);Vb.drawText(c,b,this._contentRect,a,this.getStyle("alarm.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Gb.network.LinkHandlerAttachment=function(a,b){Gb.network.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.LinkHandlerAttachment",Gb.network.BasicAttachment,{updateMeasure:function(){var a=this.getFont("link.handler.font"),b=this._network.getLinkHandlerLabel(this._element);this._textSize=Vb.getTextSize(a,b);var c=Gb.network.LabelAttachment.superClass.updateMeasure.call(this);Vb.drawText(c,b,this._contentRect,a,this.getStyle("link.handler.color"))},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Gb.network.EditAttachment=function(a,b){Gb.network.EditAttachment.superClass.constructor.call(this,a,b),this._attachmentDiv=Ub.createDiv(),this._view.appendChild(this._attachmentDiv)},Hb.ext("twaver.network.EditAttachment",Gb.network.Attachment,{updateMeasure:function(){Gb.network.EditAttachment.superClass.updateMeasure.call(this),this._viewRect=null,this._element instanceof Ld&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Ld)||this._element instanceof Gb.ShapeNode||this._element instanceof Gb.Grid||this._element instanceof Gb.Group||this._addRotatePoint(this._element),this._element instanceof Gb.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Gb.network.ShapeLinkUI&&this._addShapeLinkPoints(this._ui),this._ui instanceof Gb.network.LinkUI&&this._addLinkControlPoint(this._ui)},_addRotatePoint:function(a){var b=this._network.getRotatePointSize();if(!(0>=b)){var c=a.getOriginalRect();if(!this._rotateDiv){var d=Ub.createDiv();this._attachmentDiv.appendChild(d),this._rotateDiv=d}var e,f=this._network.getRotatePointOutlineWidth(),g=this._network.getRotatePointOutlineColor(),h=this._network.getRotatePointFillColor(),b=this._network.getRotatePointSize(),i=2*b,j={x:c.x+c.width/2-b,y:c.y-this._network.getRotatePointOffset()-i,width:i,height:i};e=0==a.angle?j:this._getRotateRect(j,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2});var k=Rb.unionRect(a.getRect(),e);this._viewRect=Rb.unionRect(k,this._viewRect),Ub.setDiv(this._rotateDiv,j,h,f,g),this._rotateDiv._viewRect=e,Ub.setBorderRaidus(this._rotateDiv,i+"px"),this._rotateAttachments(this._rotateDiv,i/2,f)}},_addResizingPoint:function(a){var b=this._network.getResizePointSize();if(!(0>=b)){var c=a.getOriginalRect(),d=new md([{x:c.x,y:c.y},{x:c.x+c.width/2,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x,y:c.y+c.height/2},{x:c.x+c.width,y:c.y+c.height/2},{x:c.x,y:c.y+c.height},{x:c.x+c.width/2,y:c.y+c.height},{x:c.x+c.width,y:c.y+c.height}]);if(!this._resizeDivs){this._resizeDivs=new Array;for(var e=0;8>e;e++){var f=Ub.createDiv();this._attachmentDiv.appendChild(f),this._resizeDivs[e]=f}}if(this._resizeDivs){this._resizeRects=new Array;for(var e=0;8>e;e++){var g,h=d.get(e),i={x:h.x-b,y:h.y-b,width:2*b,height:2*b};g=0==a.getAngle()?i:this._getRotateRect(i,a.getAngle(),{x:c.x+c.width/2,y:c.y+c.height/2}),this._resizeRects[e]=g}}var j=this._network.getResizePointOutlineWidth(),k=this._network.getResizePointOutlineColor(),l=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,j,k,l,!0)}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>=g)){var h=g+c;Rb.grow(a,h,h),this._viewRect=Rb.unionRect(a,this._viewRect);var i,j,k,l,m=2*g,n=new md;for(i=0,j=b.size();j>i;i++)k=b.get(i),l={x:k.x-g,y:k.y-g,width:m,height:m},n.add(l);var o;if(f)o=this._resizeDivs;else{if(this._controlDivs||(this._controlDivs=new Array),this._controlDivs.length<j)for(i=this._controlDivs.length;j>i;i++){var p=Ub.createDiv();this._attachmentDiv.appendChild(p),this._controlDivs[i]=p}else if(this._controlDivs.length>j){for(i=j;i<this._controlDivs.length;i++)this._attachmentDiv.removeChild(this._controlDivs[i]);this._controlDivs.splice(j)}o=this._controlDivs}for(i=0,j=n.size();j>i;i++)l=n.get(i),Ub.setDiv(o[i],l,e,c,d),Ub.setBorderRaidus(o[i],(f?"0":m)+"px"),this._rotateAttachments(o[i],m/2,c,b.get(i))}},_rotateAttachments:function(a,b,c,d){if(this._element instanceof Ld){var e=this._element.getAngle();if(0==e)return;{var f=this._element.getOriginalRect(),g=a.style.left.split("px")[0],h=a.style.top.split("px")[0];f.x+f.width/2,f.y+f.height/2}d||(d={x:parseFloat(g)+b+c,y:parseFloat(h)+b+c});var i=Rb.createMatrix(e*Math.PI/180,f.x+f.width/2,f.y+f.height/2),j=i.transform(d);a.style.webkitTransform="rotate("+e+"deg)",a.style.mozTransform="rotate("+e+"deg)",a.style.OTransform="rotate("+e+"deg)",a.style.msTransform="rotate("+e+"deg)",a.style.transform="rotate("+e+"deg)",a.style.left=j.x-b-c+"px",a.style.top=j.y-b-c+"px"}},_addShapeLinkPoints:function(a){this._addEditPoints(a._element.getPoints())},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(wc.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new md;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=Rb.getRect(a);if(b){var c=this._network.getEditPointOutlineWidth(),d=this._network.getEditPointOutlineColor(),e=this._network.getEditPointFillColor();this._addPoints(b,a,c,d,e,!1)}},hit:function(a,b){if(!Rb.containsPoint(this._viewRect,a,b))return!1;var c;if(this._resizeDivs)for(c=this._resizeDivs.length-1;c>=0;c--)if(Rb.containsPoint(this._resizeRects[c],a,b))return!0;if(this._rotateDiv&&Rb.containsPoint(this._rotateDiv._viewRect,a,b))return!0;if(this._controlDivs)for(c=this._controlDivs.length-1;c>=0;c--)if(Rb.containsPoint(this._controlDivs[c]._viewRect,a,b))return!0;return!1},intersects:function(a){if(!Rb.intersects(this._viewRect,a))return!1;var b;if(this._resizeDivs)for(b=this._resizeDivs.length-1;b>=0;b--)if(Rb.intersects(this._resizeRects[b],a))return!0;if(this._rotateDiv&&Rb.containsPoint(this._rotateDiv._viewRect,a))return!0;if(this._controlDivs)for(b=this._controlDivs.length-1;b>=0;b--)if(Rb.intersects(this._controlDivs[b]._viewRect,a))return!0;return Rb.intersects(this._viewRect,a)?!1:!1},_getRotateRect:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Gb.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Rb.getRect(g)}}),Gb.network.IconsAttachment=function(a,b){Gb.network.IconsAttachment.superClass.constructor.call(this,a,b),this._iconsCanvas=null},Hb.ext("twaver.network.IconsAttachment",Gb.network.Attachment,{isShadowable:function(){return Dd.ATTACHMENT_SHADOWABLE},updateMeasure:function(){Gb.network.IconsAttachment.superClass.updateMeasure.call(this);var a=this._network.getIconsNames(this._element);if(a&&0!=a.length){var b=this._network.getIconsColors(this._element),c=this._element.getStyle("icons.orientation"),d=this._element.getStyle("icons.position"),e=this._element.getStyle("icons.xoffset");e=e instanceof Array?e[0]:e;var f=this._element.getStyle("icons.yoffset");f=f instanceof Array?f[0]:f;var g=this._element.getStyle("icons.xgap");g=g instanceof Array?g[0]:g;var h=this._element.getStyle("icons.ygap");h=h instanceof Array?h[0]:h;var i=this._getIconsSize(a,c,g,h);if(i){var j=this._network.getPosition(d,this._ui,i,e,f);this._viewRect={x:j.x,y:j.y,width:i.width,height:i.height},"top"===c?j.y+=i.height:"left"===c&&(j.x+=i.width),this._iconsCanvas||(this._iconsCanvas=Ub.createCanvas(),this._view.appendChild(this._iconsCanvas));var k=this._ui.setShadow(this,this._iconsCanvas,Hb.clone(this._viewRect)),l=j.x,m=j.y,n=0;for(var o in a){var p=null,q=null;b&&b.length>n&&(q=b[n++]);var r=Hb.getImageAsset(a[o]);if(null!=r){if("right"===c)p={x:l,y:m,width:r.getWidth(),height:r.getHeight()},l+=p.width+g;else if("left"===c)p={x:l-r.getWidth(),y:m,width:r.getWidth(),height:r.getHeight()},l-=p.width+g;else if("top"===c)p={x:l,y:m-r.getHeight(),width:r.getWidth(),height:r.getHeight()},m-=p.height+h;else{if("bottom"!==c)throw"Can not resolve '"+c+"' orientation";p={x:l,y:m,width:r.getWidth(),height:r.getHeight()},m+=p.height+h}Mc(k,r.getImage(q,p.width,p.height),q,p,this._element,this._network)}}}}},_getIconsSize:function(a,b,c,d){var e=0,f=0,g=null,h=null,i=null;for(var j in a)if(h=Hb.getImageAsset(a[j])){if("right"===b)g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},e+=g.width+c;else if("left"===b)g={x:e-h.getWidth(),y:f,width:h.getWidth(),height:h.getHeight()},e-=g.width+c;else if("top"===b)g={x:e,y:f-h.getHeight(),width:h.getWidth(),height:h.getHeight()},f-=g.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},f+=g.height+d}i=null==i?Hb.clone(g):Rb.unionRect(i,g)}return i?{width:Math.abs(i.width),height:Math.abs(i.height)}:null}}),Gb.network.HTMLBasicAttachment=function(a,b){function c(a,b,c,d,e,f,g){c||(c=this._origin.x),d||(d=this._origin.y),e||(e=this._location.x),f||(f=this._location.y),a=a-c-e,b=b-d-f;var h=Gb.Util.transformPoint({x:c+e,y:d+f},g?this._radian:-this._radian,a,b).point;return h}Gb.network.HTMLBasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0},this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var d=this;this.hit=function(a,b){if(this._radian&&this._origin){var e=c.call(d,a,b);a=e.x,b=e.y}return Gb.Util.containsPoint(this._roundRect,a,b)||Gb.Util.containsPoint(this._pointerRect,a,b)},this.intersects=function(a){var b={x:a.x,y:a.y},e={x:a.x+a.width,y:a.y},f={x:a.x,y:a.y+a.height},g={x:a.x+a.width,y:a.y+a.height};if(this._radian&&this._origin){if(a.width*a.height>50)return!1;b=c.call(d,b.x,b.y),e=c.call(d,e.x,e.y),f=c.call(d,f.x,f.y),g=c.call(d,g.x,g.y)}return a=Gb.Util.getRect([b,e,f,g]),Gb.Util.intersects(this._roundRect,a)||Gb.Util.intersects(this._pointerRect,a)},this.getContentWidth=function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},this.getContentHeight=function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},this._view.appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Gb.Util.ext("twaver.network.HTMLBasicAttachment",Gb.network.BasicAttachment,{calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=Math.min(this.getCornerRadius(),b/2),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset();this._contentRect.width=a,this._contentRect.height=b,this._contentRect.x=c;var i=this._roundRect;i.width=a+2*c,i.height=b;var j;if(d>0){var k=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h);if("aboveleft"===k){i.y=j.y-d-i.height,i.x=j.x-(i.width-c),this._pointers=[j,{x:j.x,y:j.y-d},{x:j.x-Math.min(e,a),y:j.y-d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle=n+" "+n+" transparent transparent",this._triangleDivLocation=this._pointers[2]}else if("aboveright"===k){i.y=j.y-d-i.height,i.x=j.x-c,this._pointers=[j,{x:j.x,y:j.y-d},{x:j.x+Math.min(e,a),y:j.y-d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle=n+" transparent transparent "+n,this._triangleDivLocation=this._pointers[1]}else if("belowleft"===k){i.y=j.y+d,i.x=j.x-(i.width-c),this._pointers=[j,{x:j.x,y:j.y+d},{x:j.x-Math.min(e,a),y:j.y+d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle=" transparent "+n+" "+n+" transparent",this._triangleDivLocation={x:this._pointers[2].x,y:j.y}}else if("belowright"===k){i.y=j.y+d,i.x=j.x-c,this._pointers=[j,{x:j.x,y:j.y+d},{x:j.x+Math.min(e,a),y:j.y+d}];var l=d/2,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle="transparent transparent "+n+" "+n,this._triangleDivLocation=this._pointers[0]}else if("above"===k){i.y=j.y-d-i.height,i.x=j.x-i.width/2,this._pointers=[j,{x:j.x-Math.min(e,a)/2,
y:j.y-d},{x:j.x+Math.min(e,a)/2,y:j.y-d}];var l=d,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px 0px "+m+"px",this._triangleBorderColorStyle=n+" transparent transparent transparent",this._triangleDivLocation=this._pointers[1]}else if("below"===k){i.y=j.y+d,i.x=j.x-i.width/2,this._pointers=[j,{x:j.x-Math.min(e,a)/2,y:j.y+d},{x:j.x+Math.min(e,a)/2,y:j.y+d}];var l=d,m=Math.min(e,a)/2,n=this.getFillColor();this._triangleBorderWidthStyle="0px "+m+"px "+l+"px "+m+"px",this._triangleBorderColorStyle="transparent transparent "+n+" transparent ",this._triangleDivLocation={x:this._pointers[1].x,y:j.y}}else if("left"===k){i.y=j.y-i.height/2,i.x=j.x-i.width-d,this._pointers=[j,{x:j.x-d,y:j.y-Math.min(e,b)/2},{x:j.x-d,y:j.y+Math.min(e,b)/2}];var l=Math.min(e,b)/2,m=d,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px 0px "+l+"px "+m+"px",this._triangleBorderColorStyle="transparent transparent  transparent "+n,this._triangleDivLocation=this._pointers[1]}else{if("right"!==k)throw"Can not resolve '"+k+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,this._pointers=[j,{x:j.x+d,y:j.y-Math.min(e,b)/2},{x:j.x+d,y:j.y+Math.min(e,b)/2}];var l=Math.min(e,b)/2,m=d,n=this.getFillColor();this._triangleBorderWidthStyle=l+"px "+m+"px "+l+"px 0px",this._triangleBorderColorStyle="transparent "+n+" transparent  transparent ",this._triangleDivLocation={x:j.x,y:this._pointers[1].y}}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h),i.x=j.x,i.y=j.y,this._pointers=null;this._location=j},updateMeasure:function(){if(this.calculateMeasure(),this._ui.isShadowable()&&this.isShadowable()?Gb.Util.setCSSStyle(this._roundDiv,"text-shadow",this._ui._shadowXOffset+"px "+this._ui._shadowYOffset+"px "+this._ui._shadowBlur+"px "+this._ui._shadowColor):Gb.Util.removeCSSStyle(this._roundDiv,"text-shadow"),this._pointerRect=Gb.Util.getRect(this._pointers),this._viewRect=Gb.Util.unionRect(this._pointerRect,this._roundRect),Gb.Util.setCSSStyle(this._contentDiv,"left",this._contentRect.x+"px"),Gb.Util.setCSSStyle(this._contentDiv,"top",this._contentRect.y+"px"),Gb.Util.setCSSStyle(this._roundDiv,"left",this._roundRect.x+"px"),Gb.Util.setCSSStyle(this._roundDiv,"top",this._roundRect.y+"px"),Gb.Util.setCSSStyle(this._roundDiv,"width",this._roundRect.width+"px"),Gb.Util.setCSSStyle(this._roundDiv,"height",this._roundRect.height+"px"),Gb.Util.setCSSStyle(this._roundDiv,"background",this.isFill()?this.getFillColor():null),Gb.Util.setCSSStyle(this._roundDiv,"-webkit-border-radius",this.getCornerRadius()+"px"),Gb.Util.setCSSStyle(this._roundDiv,"-moz-border-radius",this.getCornerRadius()+"px"),Gb.Util.setCSSStyle(this._roundDiv,"border-radius",this.getCornerRadius()+"px"),this._pointers?(Gb.Util.setCSSStyle(this._triangleDiv,"left",this._triangleDivLocation.x+"px"),Gb.Util.setCSSStyle(this._triangleDiv,"top",this._triangleDivLocation.y+"px"),Gb.Util.setCSSStyle(this._triangleDiv,"border-width",this._triangleBorderWidthStyle),Gb.Util.setCSSStyle(this._triangleDiv,"border-color",this._triangleBorderColorStyle),this._view.appendChild(this._triangleDiv)):this._triangleDiv.parentNode==this._view&&this._view.removeChild(this._triangleDiv),this._element.getStyle("label.rotatable")&&this.label){var a=this._ui.getFromPoint(),b=this._ui.getToPoint(),c=this._ui.getLinkPoints();c.size()%2==0&&(a=c.get(c.size()/2-1),b=c.get(c.size()/2)),this._radian=a.x>b.x?Gb.Util.getRadiansBetweenLines(b,a):Gb.Util.getRadiansBetweenLines(a,b),this._origin={x:this._contentRect.width/2,y:0};var d="rotate("+Gb.Util.toDegrees(this._radian)+"deg)",e=this._origin.x+"px "+this._origin.y+"px";Gb.Util.isChrome||Gb.Util.isSafari?(Gb.Util.setCSSStyle(this._roundDiv,"-webkit-transform",d),Gb.Util.setCSSStyle(this._roundDiv,"-webkit-transform-origin",e)):Gb.Util.isIE?(Gb.Util.setCSSStyle(this._roundDiv,"-ms-transform",d),Gb.Util.setCSSStyle(this._roundDiv,"-ms-transform-origin",e)):(Gb.Util.setCSSStyle(this._roundDiv,"transform",d),Gb.Util.setCSSStyle(this._roundDiv,"transform-origin",e))}else Gb.Util.removeCSSStyle(this._roundDiv,"-webkit-transform"),Gb.Util.removeCSSStyle(this._roundDiv,"-webkit-transform-origin"),Gb.Util.removeCSSStyle(this._roundDiv,"-ms-transform"),Gb.Util.removeCSSStyle(this._roundDiv,"-ms-transform-origin"),Gb.Util.removeCSSStyle(this._roundDiv,"transform"),Gb.Util.removeCSSStyle(this._roundDiv,"transform-origin"),delete this._origin,delete this._radian}}),Gb.network.HTMLLabelAttachment=function(a,b){Gb.network.HTMLBasicAttachment.call(this,a,b),this.label=!0},Gb.Util.ext("twaver.network.HTMLLabelAttachment",Gb.network.LabelAttachment,{updateMeasure:function(){var a=this.getFont("label.font"),b=this.getLabel();this._contentDiv.innerHTML=b,Gb.Util.setCSSStyle(this._contentDiv,"font",a),Gb.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),Gb.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:Gb.network.HTMLBasicAttachment.prototype.calculateMeasure}),Gb.network.HTMLAlarmAttachment=function(a,b){Gb.network.HTMLBasicAttachment.call(this,a,b),this.alarm=!0},Gb.Util.ext("twaver.network.HTMLAlarmAttachment",Gb.network.AlarmAttachment,{updateMeasure:function(){var a=this.getFont("alarm.font");this._contentDiv.innerHTML=this._network.getAlarmLabel(this._element),Gb.Util.setCSSStyle(this._contentDiv,"font",a),this._fillColor=this._network.getAlarmFillColor(this._element),Gb.network.HTMLBasicAttachment.prototype.updateMeasure.call(this),Gb.Util.removeCSSStyle(this._contentDiv,"font")},calculateMeasure:Gb.network.HTMLBasicAttachment.prototype.calculateMeasure}),Gb.network.NodeUI=function(a,b){Gb.network.NodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.NodeUI",Gb.network.ElementUI,{createBodyRect:function(){return this._element.getRect()},invalidate:function(a){Gb.network.NodeUI.superClass.invalidate.call(this,a);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this)},updateMeasure:function(){Gb.network.NodeUI.superClass.updateMeasure.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Rb.getHotSpot(b.x,b.y,b.width,b.height,a),this.drawBody(),this._outerColor&&this.drawOuterBorder(),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(),this.cleanUp(["_selectCanvas","_nodeCanvas","_nodeImage","_nodeComponent","_vectorCanvas","_outerCanvas"]);var c=this._element.getParent();c instanceof Nd&&this._network.invalidateElementUI(c,!1)},drawBody:function(){var a=this.getStyle("body.type");"default"===a?this.drawDefaultBody():"vector"===a?this.drawVectorBody():"default.vector"===a?(this.drawVectorBody(),this.drawDefaultBody()):"vector.default"===a?(this.drawDefaultBody(),this.drawVectorBody()):this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0})},drawOuterBorder:function(){var a=this._element,b=a.getStyle("outer.width");if(b>0){var c=this.getBodyRect();Rb.addPadding(c,a,"outer.padding",1),this._outerCanvas||(this._outerCanvas=Ub.createCanvas());var d=Hb.clone(c);Rb.grow(d,b/2,b/2);var e=Ub.setCanvas(this._outerCanvas,d);e.lineWidth=b,e.lineCap=a.getStyle("outer.cap"),e.lineJoin=a.getStyle("outer.join"),e.strokeStyle=this._outerColor,Vb.drawVector(e,a.getStyle("outer.shape"),null,c),e.stroke(),this.addComponent(this._outerCanvas),this.addBodyBounds(d)}},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();c=Hb.clone(c);var d=a.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(c,a,"select.padding",1/d),this._selectCanvas||(this._selectCanvas=Ub.createCanvas()),Rb.grow(c,b/2/d,b/2/d);var e=Ub.setCanvas(this._selectCanvas,bounds);e.lineWidth=b/d,e.lineCap=a.getStyle("select.cap"),e.lineJoin=a.getStyle("select.join"),e.strokeStyle=a.getStyle("select.color"),Vb.drawVector(e,a.getStyle("select.shape"),null,c),e.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}},drawDefaultBody:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return this.addBodyBounds(c),void(this._currentImageAsset=null);if(Rb.addPadding(c,this._element,"image.padding",1),b.getImage()){this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var d=Hb.clone(c),e=this.setShadow(this,this._nodeCanvas,d);0!=a.getAngle()&&(c=a.getOriginalRect(),Gb.Util.rotateCanvas(e,c,a.getAngle())),Mc(e,a.getImage(),this.getInnerColor(),c,a,this._network),c=d,this.addComponent(this._nodeCanvas)}else if(b.getSrc())this._nodeImage||(this._nodeImage=Ub.createImg()),Ub.setImg(this._nodeImage,b.getSrc(),c),this.addComponent(this._nodeImage);else{if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this._nodeComponent=this._currentImageAsset!==b?b.getFunction()(this,c):b.getFunction()(this,c,this._nodeComponent),this.addComponent(this._nodeComponent),this._nodeComponent._viewRect=Hb.clone(c)}this.addBodyBounds(c),this._currentImageAsset=b},hit:function(a,b){if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Hb.math.containsPoint(c,a,b))return!0}return this.hitCanvas(a,b,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.hitComponent(a,b,["_nodeImage","_nodeComponent"])},intersects:function(a){if(this._network._transparentSelectionEnable){var b=this.getBodyRect();if(Hb.math.intersects(b,a))return!0}return this.intersectsCanvas(a,["_nodeCanvas","_outerCanvas","_vectorCanvas"])?!0:this.intersectsComponent(a,["_nodeImage","_nodeComponent"])},drawVectorBody:function(){this._vectorCanvas||(this._vectorCanvas=Ub.createCanvas());var a=Vb.drawPath(this,this._vectorCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("vector.deep"),c=this._vectorCanvas.getContext("2d"),d=this.getBodyRect(),e=this.getStyle("vector.fill.color");if(0!==b&&e){var f=this._element.getAngle();0!=f&&(d=this._element.getOriginalRect(),Gb.Util.rotateCanvas(c,d,-f),Gb.Util.rotateCanvas(c,d,f)),"rectangle"===this.getStyle("vector.shape")&&Vb.draw3DRect(c,e,b,d)}this.addBodyBounds(a),this.addComponent(this._vectorCanvas)}}),Gb.network.LinkUI=function(a,b){Gb.network.LinkUI.superClass.constructor.call(this,a,b),this._linkCanvas=Ub.createCanvas()},Hb.ext("twaver.network.LinkUI",Gb.network.ElementUI,{isEditable:function(){return wc.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},hit:function(a,b){return this.hitCanvas(a,b,["_linkCanvas"])},intersects:function(a){return this.intersectsCanvas(a,["_linkCanvas"])},checkAttachments:function(){Gb.network.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Gb.network.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Rb.calculateLineLength(this._linkPoints)),this._linkPoints},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,Gb.network.LinkUI.superClass.invalidate.call(this,a)},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=wc.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=wc.createToPoint(this)),this._toPoint},updateMeasure:function(){Gb.network.LinkUI.superClass.updateMeasure.call(this),this.drawBody()},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type"),d=new md;if(wc.isOrthogonalOrFlexionalLink(this._element))d=wc.orthogonalAndFlexional(this,c);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());null!=e&&(this._hotSpot=wc.fillLoopedPoints(this,e.getBodyRect(),d))}else{if("arc"!==c&&"triangle"!==c&&"parallel"!==c)throw"Can not resolve link type '"+c+"'";this._hotSpot=wc.fillBundlePoints(this,c,a,b,d)}if(this._network._linkPathFunction){var f=this._network._linkPathFunction(this,d);f&&(d=f)}return d},drawLinePoints:function(a,b,c,d,e){if(a.lineWidth=c,a.strokeStyle=d,this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new tc(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset");this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),Vb._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var h=this._element.getStyle("link.flow.color");h=h?h:Dd.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=h,Vb._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Vb.drawLinePoints(a,b,e),a.stroke()},drawBody:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Rb.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Rb.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(c=Rb.unionRect(c,nd.getArrowRect(a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(c=Rb.unionRect(c,nd.getArrowRect(a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"))));var i=this.setShadow(this,this._linkCanvas,c);i.lineCap=b.getStyle("link.cap"),i.lineJoin=b.getStyle("link.join");var j=b.getStyle("link.pattern");g&&this.drawLinePoints(i,a,e,b.getStyle("select.color"),j),this._outerColor&&this.drawLinePoints(i,a,d+2*f,this._outerColor,j),this.drawLinePoints(i,a,d,this._innerColor||b.getStyle("link.color"),j),this.addBodyBounds(c),this.addComponent(this._linkCanvas),nd.drawLinkArrow(this,i,a)}},getControlPoint:function(){return wc.getControlPoint(this._element,this)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(wc.hasControlPoint(b)){var c=wc.getLinkSourceBounds(this),d=wc.getLinkTargetBounds(this);wc.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength}}),Gb.network.HTMLLinkUI=function(a,b){Gb.network.HTMLLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.HTMLLinkUI",Gb.network.LinkUI,{checkAttachments:function(){Gb.network.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.network.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.network.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.network.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Gb.network.GroupUI=function(a,b){Gb.network.GroupUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.GroupUI",Gb.network.NodeUI,{isEditable:function(){return!this._element.isExpanded()},drawBody:function(){this.getBodyRect();this._shapeRect?this.drawExpandedGroup():Gb.network.GroupUI.superClass.drawBody.call(this)},drawExpandedGroup:function(){this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var a=Vb.drawPath(this,this._nodeCanvas,"group",!1,this._element.getStyle("vector.outline.pattern")),b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Vb.draw3DRect(this._nodeCanvas.getContext("2d"),c,b,this._bodyRect),this.addBodyBounds(a),this.addComponent(this._nodeCanvas)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element;if(a.isExpanded()){var b=this.getChildrenRects();if(!b.isEmpty()){var c=a.getStyle("group.shape"),d=Sb[c];if(!d)throw"Can not resolve group shape '"+c+"'";this._shapeRect=d(b)}}return this._shapeRect?(Rb.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Gb.network.GroupUI.superClass.createBodyRect.call(this)}}),Gb.network.GridUI=function(a,b){Gb.network.GridUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.GridUI",Gb.network.NodeUI,{drawDefaultBody:function(){this._element.getImage()?Gb.network.GridUI.superClass.drawDefaultBody.call(this):this.drawGridBody()},drawGridBody:function(){var a=this.getStyle("grid.fill"),b=this.getStyle("grid.deep"),c=this.getStyle("grid.cell.deep");if(a||0!==b||0!==c){var d=this.getBodyRect(),e=this.getDyeColor("grid.fill.color");this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var f=Hb.clone(d),g=this.setShadow(this,this._nodeCanvas,f);if(g.rect(d.x,d.y,d.width,d.height),this.addComponent(this._nodeCanvas),a&&(g.fillStyle=e,g.fill()),0!=b&&Vb.draw3DRect(g,e,b,d.x,d.y,d.width,d.height),0!=c)for(var h=this.getStyle("grid.row.count"),i=this.getStyle("grid.column.count"),j=0;h>j;j++)for(var k=0;i>k;k++){var l=this._element.getCellRect(j,k);null!=l&&Vb.draw3DRect(g,e,c,l.x,l.y,l.width,l.height)}this.addBodyBounds(f)}}}),Gb.network.ShapeNodeUI=function(a,b){Gb.network.ShapeNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.ShapeNodeUI",Gb.network.NodeUI,{drawDefaultBody:function(){if(this._element._points.size()<2)return void this.addBodyBounds({x:this._element.getX(),y:this._element.getY(),width:0,height:0});this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var a=Vb.drawPath(this,this._nodeCanvas,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed"));this.addBodyBounds(a),this.addComponent(this._nodeCanvas),nd.drawLinkArrow(this,this._nodeCanvas.getContext("2d"),Rb.getPointObject(this._element._points,this._element._segments))},drawSelectBorder:function(){var a=this._element,b=a.getStyle("select.width");if(b>0){var c=this.getBodyRect();c=Hb.clone(c);var d=a.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(c,a,"select.padding",1/d);var e=a.getStyle("vector.outline.width");e>0&&Rb.grow(c,e/2,e/2),this._selectCanvas||(this._selectCanvas=Ub.createCanvas()),Rb.grow(c,b/2/d,b/2/d);var f=Ub.setCanvas(this._selectCanvas,c);f.lineWidth=b/d,f.lineCap=a.getStyle("select.cap"),f.lineJoin=a.getStyle("select.join"),f.strokeStyle=a.getStyle("select.color"),Vb.drawVector(f,a.getStyle("select.shape"),null,c),f.stroke(),this.addComponent(this._selectCanvas),this.addBodyBounds(bounds)}}}),Gb.network.ShapeLinkUI=function(a,b){Gb.network.ShapeLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.ShapeLinkUI",Gb.network.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new md,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._element._points),c.add(b);var e=c.size(),f=Math.floor(e/2);if(e%2===0){var g=c.get(f),h=c.get(f-1);this._hotSpot={x:(g.x+h.x)/2,y:(g.y+h.y)/2}}else this._hotSpot=Hb.clone(c.get(f));var i,j,k;if("lineto"===d);else if("quadto"===d){for(i=new md(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-1>j?new md([c.get(j++),c.get(j)]):c.get(j));c=i}else if("cubicto"===d){for(i=new md(c.get(0)),j=1,e=c.size();e>j;j++)i.add(e-2>j?new md([c.get(j++),c.get(j++),c.get(j)]):e-1>j?new md([c.get(j++),c.get(j)]):c.get(j));c=i}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(k=c.get(0),i=new md(k),j=1,e=c.size();e>j;j++)if(e-1>j){var l=Hb.clone(c.get(j)),m=l.x,n=l.y,o=m-k.x,p=n-k.y;Math.abs(o)>Math.abs(p)?(l.x=m,l.y=k.y):(l.x=k.x,l.y=n),k=l,i.add(k)}else i.add(c.get(j));c=i}return c}}),Gb.network.RotatableNodeUI=function(a,b){Gb.network.RotatableNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.network.RotatableNodeUI",Gb.network.NodeUI,{isEditable:function(){return!1},drawDefaultBody:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return this.addBodyBounds(c),void(this._currentImageAsset=null);if(Rb.addPadding(c,this._element,"image.padding",1),b.getImage()){this._nodeCanvas||(this._nodeCanvas=Ub.createCanvas());var d=Hb.clone(c),e=this.setShadow(this,this._nodeCanvas,d),f=this._element._getOrignalWidth(),g=this._element._getOrignalHeight(),h=this._element._getRotateRect();e.save(),e.translate(c.x-h.x+f/2,c.y-h.y+g/2),e.rotate(this._element._angle*Math.PI/180);var c={x:-f/2,y:-g/2,width:f,height:g};Mc(e,b.getImage(this._innerColor,c.width,c.height),this._innerColor,c,a,this._network),e.restore(),this.addComponent(this._nodeCanvas)}else if(b.getSrc());else if(!b.getFunction())throw"ImageAsset '"+a.getImage()+" ' is empty";this.addBodyBounds(c),this._currentImageAsset=b}}),Gb.network.HTMLNodeUI=function(a,b){Gb.network.HTMLNodeUI.superClass.constructor.call(this,a,b)},Gb.Util.ext("twaver.network.HTMLNodeUI",Gb.network.NodeUI,{checkAttachments:function(){Gb.network.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.network.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.network.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.network.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.network.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Gb.network.interaction.BaseInteraction=function(a){this.network=a},Hb.ext("twaver.network.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Ub.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Ub.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint(a),this._startClient=Ub.getClientPoint(a),this._startLogical&&Ub.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Gb.network.interaction.SelectInteraction=function(a){Gb.network.interaction.SelectInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.SelectInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown"),this.end()},handle_mousedown:function(a){if(this._button=a.button,this.network.isValidEvent(a)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!a.shiftKey){var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?Hb.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(Hb.isCtrlDown(a)||c.clearSelection(),this.end(a),this.network.getLogicalPoint(a)&&this.network.isRectSelectEnabled()&&this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(0!==this._button||this.network.isMovingElement()||this.network.isEditingElement())return void this.end(a);this._handle_mousemove(a),this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Ub.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=Rb.getRect([this._startLogical,this._endLogical]);Ub.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())},end:function(a){if(this._startLogical){if(this.mark){if(this._endLogical&&this._startLogical.x!==this._endLogical.x&&this._startLogical.y!==this._endLogical.y){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}var e=this;setTimeout(function(){e.mark&&(e.network.getTopDiv().removeChild(e.mark),e.mark=null)},0),this.network.setSelectingElement(!1)}this._handle_mouseup(a)}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startLogical.x>this._endLogical.x&&this._startLogical.y>this._endLogical.y}}),Gb.network.interaction.MoveInteraction=function(a,b){this.lazyMode=b,this.xoffset=0,this.yoffset=0,Gb.network.interaction.MoveInteraction.superClass.constructor.call(this,a),this.currentKeyEvent=null},Hb.ext("twaver.network.interaction.MoveInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","keydown","mouseleave")},tearDown:function(){this.removeListener("mousedown","keydown","mouseleave"),this.end()},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},handle_mouseleave:function(a){this.end(a)},isParenting:function(){return this._startLogical&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect(),this.parent=null);var d=this;if(a=this.network.getLogicalPoint(a),!b&&this.isParenting()){var e={};e.x=a.x-1,e.y=a.y-1,e.width=2,e.height=2;var f=this.network.getElementsAtRect(e,!0);if(f&&f.size()>0)for(var g=f.size(),h=0;g>h;h++){var i=f.get(h);if(!d.network.getElementBox().getSelectionModel().contains(i)){d.parent=i;break}}}null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),null==c||b?this.parentMark&&(this.network.getTopDiv().removeChild(this.parentMark),this.parentMark=null):(this.parentMark||(this.parentMark=Hb.html.createDiv(),this.network.getTopDiv().appendChild(this.parentMark)),Hb.html.setDiv(this.parentMark,c,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()))},handle_mousedown:function(a){if(0===a.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);this.network.isMovable(b)&&(this.end(a),this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements()||!this._startLogical)return void this.end(a);if(this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a});else{this.mark=Ub.createDiv();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=Rb.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),Ub.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})),this.network.moveSelectedElements(this.xoffset,this.yoffset);this.parentProcess(a,!1)},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))};this.network.moveSelectedElements(this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this._handle_mouseup(a)}}}),Gb.network.interaction.DefaultInteraction=function(a){Gb.network.interaction.DefaultInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.DefaultInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(this.network.isValidEvent(a)){this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);2===a.detail?this.handleDoubleClicked(a,b):this.handleClicked(a,b)}},handleClicked:function(a,b){Bc.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Bc.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Bc.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Cc(c),e=Cc(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),Gb.network.interaction.PanInteraction=function(a){Gb.network.interaction.PanInteraction.superClass.constructor.call(this,a);

},Hb.ext("twaver.network.interaction.PanInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){this._startLogical=this.network.getLogicalPoint(a),this._startLogical&&(this._handle_mousedown(a),this.network.getView().style.cursor="pointer")},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(this._startLogical){this._handle_mousemove(a);{var b=this._startLogical.x-this._endLogical.x,c=this._startLogical.y-this._endLogical.y;this.network.panByOffset(b,c)}this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a)}},_clear:function(a){this._startLogical&&(this._handle_mouseup(a),this.network.getView().style.cursor=this._oldCursor)}}),Gb.network.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,Gb.network.interaction.EditInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.EditInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear()},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.mouseMoved=!1,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null),this.rotateScale&&this.network.getTopDiv().contains(this.rotateScale)&&(this.network.getTopDiv().removeChild(this.rotateScale),this.rotateScale=null)},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},handle_mousedown:function(a){if(0===a.button)if(!Hb.isAltDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?Hb.isAltDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?Hb.isAltDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyMovePointStart":"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint(a);if(b instanceof Gb.ShapeNode){var d=this.getPointIndex(b.getPoints(),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Gb.ShapeLink){var e=new Gb.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:this.lazyMode?"lazeMovePointStart":"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=Hb.clone(this._endLogical);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Gb.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection}),c.clear()});Gb.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else if(this.shapeNode&&this.pointIndex>=0&&b){var e=this.shapeNode.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})}else if(this.shapeLink&&this.pointIndex>=0&&b){var e=this.shapeLink.getPoints().get(this.pointIndex);this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})}else this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.lazyMode||this.clear()},handle_mousemove:function(a){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.showRotateScale());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a)}else if(this.network.isValidEvent(a)){if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var b=this.network.getElementAt(a),c=this.network.getElementUI(b);if(!c||!c.getEditAttachment())return void this.clear();var d=this.network.getLogicalPoint(a);if(b instanceof Ld){if(this.node=b,this._isEditingShapeNode(d)||this._isResizingNode(d))return void this.network.setEditingElement(!0);if(this._isRotatingElement(d))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(b instanceof Gb.ShapeLink){if(this.shapeLink=b,this._isEditingShapeLink(d))return void this.network.setEditingElement(!0)}else if(c instanceof Gb.network.LinkUI){var e=this.network.getEditPointSize();if(wc.isOrthogonalLink(c._element)){this.linkUI=c;var f=this.linkUI.getControlPoint();return void(f&&this._contains(d,f,e)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:2*e,height:2*e};return Rb.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(180*Math.atan2(c.x-a.x,a.y-c.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(a){if(this._handle_mousemove(a),!this.mouseMoved&&Hb.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var d=this.shapeNode.getPoints().get(this.pointIndex),e=Hb.clone(this._endLogical);this.horizontal&&(e.y=d.y),this.vertical&&(e.x=d.x),this.shapeNode.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){if(this._handle_mousemove(a),!this.mouseMoved&&Hb.isCtrlDown(a)){var b=this._endLogical.x-this._startLogical.x,c=this._endLogical.y-this._startLogical.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal,this.mouseMoved=!0}var d=this.shapeLink.getPoints().get(this.pointIndex),e=Hb.clone(this._endLogical);this.horizontal&&(e.y=d.y),this.vertical&&(e.x=d.x),this.shapeLink.setPoint(this.pointIndex,e),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this._handle_mousemove(a),this.linkUI.setControlPoint(Hb.clone(this._endLogical)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),"north"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"west"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"south"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.mark||(this.mark=Ub.createDiv(),this.mark.style.webkitTransform="rotate("+b+"deg)",this.mark.style.mozTransform="rotate("+b+"deg)",this.mark.style.OTransform="rotate("+b+"deg)",this.mark.style.msTransform="rotate("+b+"deg)",this.mark.style.transform="rotate("+b+"deg)",this.network.getTopDiv().appendChild(this.mark)),Ub.setDiv(this.mark,this.resizingRect,null,this.network.getResizeLineWidth(),this.network.getResizeLineColor()),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){var b=this.network.getEditPointSize();if(this.node instanceof Gb.ShapeNode){this.shapeNode=this.node;for(var c=this.shapeNode.getPoints(),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.shapeLink.getPoints(),c=this.network.getEditPointSize(),d=0,e=b.size();e>d;d++){var f=b.get(d);if(this._contains(a,f,c))return this._setCrossCursor(),this.pointIndex=d,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){var f=this.network.getResizePointSize();return this._contains(a,{x:b,y:c},f)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Rb.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(){this.rotateScale||(this.rotateScale=Hb.html.createCanvas());var a,b,c,d,e,f=(new Gb.List,this.network.getRotateScaleWidth()),g=this.network.getRotateScaleHeight(),h=this.network.getRotatePointSize(),i=this.node.getAngle(),j=this.node.getOriginalRect(),k={x:j.x+j.width/2,y:j.y-this.network.getRotatePointOffset()-h},l=this._rotatePoint(k,i,j),m="13px Arial",n=i+"°";this.node.getAngle()>=0&&this.node.getAngle()<=180?(b={x:l.x+h,y:l.y},c={x:b.x+f,y:b.y},d={x:c.x,y:c.y-g},e={x:b.x,y:d.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(b={x:l.x-h,y:l.y},c={x:b.x-f,y:b.y},d={x:c.x,y:c.y-g},e={x:b.x,y:d.y});var o=new Gb.List([b,c,d,e]),a=Hb.math.getRect(o),p=Hb.html.setCanvas(this.rotateScale,a);p.fillStyle=this.network.getRotateScaleFillColor(),p.fillRect(a.x,a.y,a.width,a.height),p.fillStyle=this.network.getRotateScaleFontColor(),p.textBaseline="middle",p.textAlign="center",p.font=m,p.fillText(n,a.x+a.width/2,a.y+a.height/2),this.network.getTopDiv().appendChild(this.rotateScale)},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Gb.network.interaction.MoveLinkInteraction=function(a,b){Gb.network.interaction.MoveLinkInteraction.superClass.constructor.call(this,a),this.xoffset=0,this.yoffset=0},Hb.ext("twaver.network.interaction.MoveLinkInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(a){if(0===a.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);b instanceof Gb.Link&&(this.element=b,this.end(a),this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement())return void this.end(a);if(this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a,element:this.element});else{this.mark=Ub.createCanvas();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=Rb.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),Ub.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var c=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(c,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a,element:this.element}))}},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a,element:this.element}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))},d=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(d,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a,element:this.element}));this._handle_mouseup(a),delete this.element}}}),Gb.network.interaction.CreateElementInteraction=function(a,b){b||(b=Ld),this.elementFunction=Gb.Util.isTypeOf(b,Ld)?function(a){var c=new b;return c instanceof Ld&&c.setCenterLocation(a),c}:b,Gb.network.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.CreateElementInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Gb.network.interaction.CreateLinkInteraction=function(a,b){b||(b=Gb.Link),this.linkFunction=Gb.Util.isTypeOf(b,Gb.Link)?function(a,c){var d=new b;return d instanceof Gb.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Gb.network.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.CreateLinkInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){var a=this;setTimeout(function(){a._fromRectangle&&(a.network.getTopDiv().removeChild(a._fromRectangle),a._fromRectangle=null),a._currentRectangle&&(a.network.getTopDiv().removeChild(a._currentRectangle),a._currentRectangle=null),a._line&&(a.network.getTopDiv().removeChild(a._line),a._line=null)}),this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.updateMark()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.updateMark()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.updateMark()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Ld&&this.network.isLinkable(b)?b:null},updateMark:function(){var a;this.fromNode&&!this._fromRectangle&&this._currentRectangle&&(this._fromRectangle=this._currentRectangle,this._currentRectangle=null),!this.fromNode&&this._fromRectangle&&(this.network.getTopDiv().removeChild(this._fromRectangle),this._fromRectangle=null),this.currentNode&&!this._currentRectangle&&(a=this.network.getElementUI(this.currentNode),this._currentRectangle=Ub.createDiv(),this.network.getTopDiv().appendChild(this._currentRectangle),Ub.setDiv(this._currentRectangle,a._viewRect,null,this.network.getEditLineWidth(),this.network.getEditLineColor())),!this.currentNode&&this._currentRectangle&&(this.network.getTopDiv().removeChild(this._currentRectangle),this._currentRectangle=null),this.updateLine()},updateLine:function(){if(this.currentPoint){var a=this.fromNode.getCenterLocation(),b=a.x,c=a.y,d=this.currentPoint.x,e=this.currentPoint.y;this._line||(this._line=Ub.createCanvas(),this.network.getTopDiv().appendChild(this._line));var f=Ub.setCanvas(this._line,Math.min(b,d),Math.min(c,e),Math.abs(b-d),Math.abs(c-e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),f.moveTo(b,c),f.lineTo(d,e),f.stroke()}else this._line&&(this.network.getTopDiv().removeChild(this._line),this._line=null)}}),Gb.network.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Gb.ShapeNode),this.shapeNodeFunction=Gb.Util.isTypeOf(b,Gb.ShapeNode)?function(a){var c=new b;return c instanceof Gb.ShapeNode&&a&&c.setPoints(a),c}:b,Gb.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a),this.timeStamp=-1},Hb.ext("twaver.network.interaction.CreateShapeNodeInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove")},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear()},clear:function(){this.network.setEditingElement(!1),this.points=null,this.currentPoint=null,this.lastPoint=null,this.horizontal=!1,this.vertical=!1,this.mark&&(this.network.getTopDiv().removeChild(this.mark),this.mark=null)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b){if(2===a.detail||a.timeStamp-this.timeStamp<300){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new md),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this._handle_mousedown(a),this.points.size()>0&&Hb.isCtrlDown(a)&&(this.horizontal&&(b.y=e.y),this.vertical&&(b.x=e.x),this.horizontal=!1,this.vertical=!1),this.lastPoint=b,this.points.add(b),this.updateMark()}this.timeStamp=a.timeStamp}}},handle_mousemove:function(a){if(this.points){if(this.currentPoint=this.network.getLogicalPoint(a),Hb.isCtrlDown(a)){var b=this.currentPoint.x-this.lastPoint.x,c=this.currentPoint.y-this.lastPoint.y;this.horizontal=Math.abs(b)>=Math.abs(c),this.vertical=!this.horizontal}else this.horizontal=!1,this.vertical=!1;this.horizontal&&(this.currentPoint.y=this.lastPoint.y),this.vertical&&(this.currentPoint.x=this.lastPoint.x),this.updateMark()}},updateMark:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){this.mark||(this.mark=Ub.createCanvas(),this.network.getTopDiv().appendChild(this.mark));var b=new md(this.points);b.add(this.currentPoint);var c=Rb.getRect(b),d=this.network.getEditLineWidth();Hb.math.grow(c,d,d);var e=Ub.setCanvas(this.mark,c);e.lineWidth=d,e.strokeStyle=this.network.getEditLineColor(),e.beginPath(),Vb.drawLinePoints(e,b),e.stroke()}}}),Gb.network.interaction.CreateShapeLinkInteraction=function(a,b){Gb.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Gb.ShapeLink),this.linkFunction=Gb.Util.isTypeOf(b,Gb.ShapeLink)?function(a,c,d){var e=new b;return e instanceof Gb.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d&&e.setPoints(d)),e}:b},Hb.ext("twaver.network.interaction.CreateShapeLinkInteraction",Gb.network.interaction.CreateLinkInteraction,{clear:function(){this.network.setEditingElement(!1),this.points=null,this.polyline&&(this.network.getTopDiv().removeChild(this.polyline),this.polyline=null),Gb.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b)if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new md),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b),this.updateMark()}else this.fromNode=this.currentNode,this.fromNode&&(this.polyline||(this.polyline=Ub.createCanvas(),this.network.getTopDiv().appendChild(this.polyline))),this.points=null,this.currentNode=null,this.currentPoint=null,this.updateMark()}},updateLine:function(){if(this.currentPoint&&this.polyline){var a=new md(this.points);a.add(this.fromNode.getCenterLocation(),0),a.add(this.currentPoint);var b=Rb.getRect(a),c=Ub.setCanvas(this.polyline,b);c.lineWidth=this.network.getEditLineWidth(),c.strokeStyle=this.network.getEditLineColor(),c.beginPath(),Vb.drawLinePoints(c,a),c.stroke()}}}),Gb.network.interaction.CreateOrthogonalLinkInteraction=function(a,b,c,d,e,f){Gb.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this,a,b),this.linkType=c||"orthogonal",this.isByControlPoint=d,this.splitPercent=e,this.isSplitByPercent=f,this.link=new Gb.Link,this.link.setStyle("link.type",this.linkType),this.link.setStyle("link.split.by.percent",this.isSplitByPercent),wc.isFlexionalTypeLink(this.linkType)||wc.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle("link.extend")),this.link.setStyle("link.extend",this.splitPercent)):wc.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?this.link.setStyle("link.split.percent",this.splitPercent):this.link.setStyle("link.split.value",this.splitPercent))},Hb.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction",Gb.network.interaction.CreateLinkInteraction,{clear:function(){this.path&&(this.network.getTopDiv().removeChild(this.path),this.path=null),Gb.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)},createLink:function(){var a=Gb.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);if(a.setStyle("link.type",this.linkType),a.setStyle("link.split.by.percent",this.isSplitByPercent),this.isByControlPoint){var b=wc.getControlPoint(a);if(b)return a.SetStyle("link.control.point",b),a}else wc.isFlexionalTypeLink(this.linkType)||wc.isExtendTypeLink(this.linkType)?(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle("link.extend")),a.setStyle("link.extend",this.splitPercent)):wc.isSplitTypeLink(this.linkType)&&(this.splitPercent<0&&(this.splitPercent=Gb.Styles.getStyle(this.isSplitByPercent?"link.split.percent":"link.split.value")),this.isSplitByPercent?a.setStyle("link.split.percent",this.splitPercent):a.setStyle("link.split.value",this.splitPercent));return a},updateLine:function(){if(this.currentPoint){if(!this.fromNode||this.currentNode===this.fromNode)return;var a,b=this.network.getElementUI(this.fromNode);if(!b)return;if(a=b.getBodyRect(),null==a)return;var c;if(this.currentNode&&this.currentNode!==this.fromNode){var d=this.network.getElementUI(this.currentNode);if(!d)return;c=d.getBodyRect()}else c={
x:this.currentPoint.x,y:this.currentPoint.y,width:1,height:1};if(!c)return;var e=wc.calculateOrthogonalAndFlexionalLinkPoints(this.linkType,a,c,this.link);if(wc.drawCorner(e,this.link),e.size()<2)return;this.line||(this.line=Ub.createCanvas(),this.network.getTopDiv().appendChild(this.line));var f=Ub.setCanvas(this.line,Rb.getLineRect(e));f.lineWidth=this.network.getEditLineWidth(),f.strokeStyle=this.network.getEditLineColor(),f.beginPath(),Vb.drawLinePoints(f,e),f.stroke()}else this.line&&(this.network.getTopDiv().removeChild(this.line),this.line=null)}}),Gb.network.interaction.MagnifyInteraction=function(a,b,c,d,e){Gb.network.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Ub.createCanvas(),this.markCanvas._isIgnored=!0},Hb.ext("twaver.network.interaction.MagnifyInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove")},tearDown:function(){this.removeListener("mousemove"),this._clear()},handle_mousemove:function(a){var b=this.network.getLogicalPoint(a);b&&(this.lastPoint||this.network.getView().appendChild(this.markCanvas),this.lastPoint=b,this.updateMark())},updateMark:function(){var a,b=this.network._zoom,c=this.zoom*b,d=this.lastPoint.x*b-this.xRadius,e=this.lastPoint.y*b-this.yRadius,f=2*this.xRadius,g=2*this.yRadius,h={x:this.lastPoint.x-this.xRadius/c,y:this.lastPoint.y-this.yRadius/c,width:f/c,height:g/c},i=this.borderWidth,j=Ub.createCanvas();j.width=f,j.height=g,this.network.toCanvasByRegion(h,c,j),Ub.setCanvas(this.markCanvas,d,e,f,g),a=this.markCanvas.getContext("2d"),a.save(),a.beginPath(),Vb.drawVector(a,this.shape,null,d,e,f,g),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(d,e,f,g),a.fill(),a.drawImage(j,d,e),a.restore(),a.beginPath(),a.lineWidth=i,Vb.drawVector(a,this.shape,null,d+i/2,e+i/2,f-i,g-i),a.strokeStyle=this.borderColor,a.stroke()},_clear:function(a){this.lastPoint&&(this.network.getView().removeChild(this.markCanvas),this.lastPoint=null)},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.updateMark()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.updateMark()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.updateMark()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.updateMark()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.updateMark()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.updateMark()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.updateMark()}}),Gb.network.interaction.TouchInteraction=function(a){Gb.network.interaction.TouchInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.network.interaction.TouchInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("touchstart","handleTouchstart",a,this),Ub.addEventListener("touchmove","handleTouchmove",a,this),Ub.addEventListener("touchend","handleTouchend",a,this),Ub.addEventListener("touchcancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("touchstart",a,this),Ub.removeEventListener("touchmove",a,this),Ub.removeEventListener("touchend",a,this),Ub.removeEventListener("touchcancel",a,this)},handleTouchstart:function(a){if(Ub.preventDefault(a),a.touches&&1==a.touches.length){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b;var d=this;c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Bc.handleLongClicked(d.network,a,c)},1e3)}else a.touches&&2==a.touches.length&&(this._distance=yc.getDistance(a),this._zoom=this.network.getZoom(),this._startTouchPoint={x:a.touches[0].clientX,y:a.touches[0].clientY});this._touchCount=a.touches.length},handleTouchmove:function(a){if(Ub.preventDefault(a),2==this._touchCount&&a.touches&&2==a.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-yc.getDistance(a))>=Dd.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=yc.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=a.touches[0],d=this._startTouchPoint.x-c.clientX,e=this._startTouchPoint.y-c.clientY,f=this.network.panByOffset(d,e);this._startTouchPoint.x-=d-f.x,this._startTouchPoint.y-=e-f.y}else if(1==this._touchCount&&a.touches&&1==a.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var g=this.network.getLogicalPoint(a),h=this.network.getElementAt(g);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==h&&this.network.getMovableSelectedElements().contains(h)){var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=g,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer)))}else{var d=g.x-this._startTouchPoint.x,e=g.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer)}}else{this._moveTouchPoint=this.network.getLogicalPoint(a);var d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;if(Math.abs(d)>=Dd.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Dd.TOUCH_RECT_SELECT_THRESHOLD){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Ub.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer));var i=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]);Ub.setDiv(this.mark,i,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}}},handleTouchend:function(a){if(Ub.preventDefault(a),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1),this.timer&&clearTimeout(this.timer)}else if(this._startTouchPoint){this._zoomFlag=!1;var e=new Date,f=this.network.getLogicalPoint(a),g=this.network.getElementAt(this._startTouchPoint);this._startTouchPoint&&f&&e.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,f)<=20&&(g?this.network.getSelectionModel().contains(g)||this.network.getSelectionModel().setSelection(g):this.network.getSelectionModel().clearSelection(),Bc.handleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer),this._endTouchTime&&e.getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,f)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Bc.handleDoubleClicked(this.network,a,g),this.timer&&clearTimeout(this.timer)):(this._endTouchTime=e,this._endTouchPoint=f))}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Gb.network.interaction.MSTouchInteraction=function(a){Gb.network.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Hb.ext("twaver.network.interaction.MSTouchInteraction",Gb.network.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("MSPointerDown","handleTouchstart",a,this),Ub.addEventListener("MSPointerMove","handleTouchmove",a,this),Ub.addEventListener("MSPointerUp","handleTouchend",a,this),Ub.addEventListener("MSPointerCancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("MSPointerDown",a,this),Ub.removeEventListener("MSPointerMove",a,this),Ub.removeEventListener("MSPointerUp",a,this),Ub.removeEventListener("MSPointerCancel",a,this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY},Bc.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20?(Bc.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Ub.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c);var e=this.network.getSelectionModel();d?Hb.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Hb.isCtrlDown(a)||e.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=this.network.getElementsAtRect(this.mark._viewRect,this.getIntersectMode(),this.network.getRectSelectFilter());if(b&&b.size()>0){var c=this.network.getSelectionModel(),d=c.toSelection();b.forEach(function(a){c.contains(a)?d.remove(a):d.add(a)},this),c.setSelection(d)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this.network.getTopDiv().removeChild(this.mark),this.mark=null,this.network.setSelectingElement(!1)}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var e=-1,f=0;f<this._pointerIdArray.length;f++)if(this._pointerIdArray[f]==a.pointerId){e=f;break}e>=0&&this._pointerIdArray.splice(e,1),delete this._pointerMap[a.pointerId]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){if(this._startTouchPoint&&1==this._pointerIdArray.length){if(this._moveTouchPoint={x:this._startTouchPoint.x+(a.clientX-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(a.clientY-this._startClientPoint.y)/this.network.getZoom()},Rb.getDistance(this._startTouchPoint,this._moveTouchPoint)<3)return;if(null==this._startTouchElement&&this.network.isRectSelectEnabled()){this.mark?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.mark=Ub.createDiv(),this.network.getTopDiv().appendChild(this.mark),this.network.setSelectingElement(!0),this.network.fireInteractionEvent({kind:"selectStart",event:a}));var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]);Ub.setDiv(this.mark,b,this.getIntersectMode()?this.network.getSelectFillColor():null,this.network.getSelectOutlineWidth(),this.network.getSelectOutlineColor())}else{var c=this.network.getElementAt(this._moveTouchPoint),d=this._moveTouchPoint.x-this._startTouchPoint.x,e=this._moveTouchPoint.y-this._startTouchPoint.y;if(null!=this._startTouchElement||this.network.isRectSelectEnabled())(this.network.isMovingElement()||null!=this._startTouchElement&&c==this._startTouchElement&&this.network.getMovableSelectedElements().contains(c))&&(this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})));else{this.network.panByOffset(-d,-e)}this._startClientPoint.x=a.clientX,this._startClientPoint.y=a.clientY}}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}}});var Od={_hitCanvas:null,getHitCanvas:function(a,b){null==this._hitCanvas&&(this._hitCanvas=Ub.createCanvas()),0==arguments.length&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,b,c){void 0!=b&&(a.fillStyle=b,a.fill()),void 0!=c&&(a.strokeStyle=c,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",null!=e&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return 0>=e?g|=this.OUT_LEFT|this.OUT_RIGHT:c>a?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),0>=f?g|=this.OUT_TOP|this.OUT_BOTTOM:d>b?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if(0==(j=this.outcode(c,d,e,f,g,h)))return!0;for(;0!=(i=this.outcode(a,b,e,f,g,h));){if(0!=(i&j))return!1;if(0!=(i&(this.OUT_LEFT|this.OUT_RIGHT))){var k=e;0!=(i&this.OUT_RIGHT)&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;0!=(i&this.OUT_BOTTOM)&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};Gb.canvas={},Gb.canvas.interaction={},Gb.canvas.Network=function(a){Gb.canvas.Network.superClass.constructor.apply(this,arguments),this._rootCanvas=Ub.createCanvas(),this._topCanvas=Ub.createCanvas(),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._visibleMap={},this.viewRect={x:0,y:0,width:0,height:0},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Gb.List,this._topAttachmentList=new Gb.List,this.setElementBox(a?a:new Gb.ElementBox),Kb||(this._view=Ub.createView("hidden"),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),Ob.isTouchable?Ob.isMSTouchable?this.setMSTouchInteractions():this.setTouchInteractions():this.setDefaultInteractions(!1),this.setToolTipEnabled(Gb.Defaults.NETWORK_TOOLTIP_ENABLED));var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Gb.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a);var c=b.getElementUI(a);c.invalidate(!1)})}},Gb.imageUtil.addEventListener(this.invalidateElementUIs,this)},Hb.ext("twaver.canvas.Network",Gb.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","paddingRight","paddingBottom","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","debug","showShadowInEdit"],_currentSubNetwork:null,_subNetworkAnimate:Gb.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!0,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Gb.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Gb.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Gb.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Dd.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Gb.Defaults.CANVASUI_FUNCTION,_doubleClickToUpSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Gb.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Gb.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Gb.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Gb.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Gb.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Gb.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Gb.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Gb.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Gb.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Gb.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Gb.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Gb.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Gb.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Gb.Defaults.NETWORK_RESIZE_ANIMATE,_editPointSize:Gb.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Gb.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Gb.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Gb.Defaults.NETWORK_EDIT_LINE_WIDTH,_rotatePointSize:Gb.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Gb.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Gb.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Dd.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Dd.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Dd.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Dd.NETWORK_ROTATE_SCALE_FONT_COLOR,_limitElementInPositiveLocation:Dd.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION,_linkFlowInterval:Dd.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Dd.NETWORK_SELECTION_TOLERANCE,_invalidateElementVisibility:!1,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_paddingRight:0,_paddingBottom:0,_transparentSelectionEnable:Gb.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_debug:!1,_showShadowInEdit:!1,adjustBounds:function(a){if(Kb)this._rootCanvas=new Jb(a.width,a.height),this._topCanvas=new Jb(a.width,a.height),this.setViewRect(a.x,a.y,a.width,a.height);else{var b=!1,c=this._view.style;if(c.left==a.x+"px"&&c.top==a.y+"px"&&c.width==a.width+"px"&&c.height==a.height+"px"&&(b=!0),Gb.canvas.Network.superClass.adjustBounds.apply(this,arguments),1==b)return;var d=this._view.offsetWidth,e=this._view.offsetHeight;this._rootCanvas.setAttribute("width",d),this._rootCanvas.setAttribute("height",e),this._topCanvas.setAttribute("width",d),this._topCanvas.setAttribute("height",e),this.setViewRect(this.viewRect.x,this.viewRect.y,d,e)}"undefined"==typeof Gb.gis&&(Gb.Util.makeHighRes(this._rootCanvas),Gb.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getBackgroundImage:function(){return this._backgroundImage},setBackgroundImage:function(a){if(this._backgroundImage!=a){var b=this._backgroundImage;this._backgroundImage=a;var c=this._backgroundImage;if(c&&!c._viewRect)if(c.width>0)c._viewRect={x:0,y:0,width:c.width,height:c.height},this.validateCanvasSize(),this.firePropertyChange("backgroundImage",b,c);else{var d=this;c.onload=function(){c._viewRect={x:0,y:0,width:c.width,height:c.height},d.validateCanvasSize(),d.firePropertyChange("backgroundImage",b,c),c.onload=null}}else this.firePropertyChange("backgroundImage",b,c),this.validateCanvasSize()}},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){if(!Kb&&mc.twm(this),1==this._invalidateElementVisibility){this._invalidateElementVisibility=!1;var a,b,c,d=this.getElementBox().getDatas()._as,e=d.length,f={},g=this._visibleFunction,h=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(a=0;e>a;a++)b=d[a],f[b._id]=this.isVisible(b,g,h);if(this._visibleMap)for(a=0;e>a;a++)b=d[a],f[b._id]!==this._visibleMap[b._id]&&(c=this._elementUIMap[b._id],c&&c.invalidate());for(a=0;e>a;a++)b=d[a],c=this._elementUIMap[b._id],c&&c.validate();this._visibleMap=f,this.paintRoot()}this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Gb.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);c&&(c.dispose(),delete this._elementUIMap[b.getId()]),b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}else if("clear"===a.kind){for(var d in this._elementUIMap)this._elementUIMap[d]&&this._elementUIMap[d].dispose&&this._elementUIMap[d].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null)}this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&c.handlePropertyChange(a),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){"editable"===a.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a)},this);var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),this.invalidateElementVisibility()},sendToTop:function(a){if(this._box.contains(a)){for(var b=a;b._parent&&this.isVisible(b._parent)&&(b=b._parent););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},getScopeRect:function(a){var b=this._zoom;if("viewsize"===a)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if("viewport"===a){if(this.viewRect)return Hb.cloneRect(this.viewRect)}else if("rootcanvas"===a)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*b,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*b};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?Hb.clone(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},getUnionBounds:function(){return this._unionBounds},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){1==this.isLimitViewInCanvas()&&(0>a&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),0>b&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;(null==this.viewRect||a!=this.viewRect.x||b!=this.viewRect.y||c!=this.viewRect.width||d!=this.viewRect.height)&&(this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility())},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},dispose:function(){Gb.imageUtil.removeEventListener(this.invalidateElementUIs,this);for(var a in this._elementUIMap){var b=this._elementUIMap[a];b.curInterval&&clearTimeout(b.curInterval)}this.setInteractions(null)},invalidateElementVisibility:function(){this._invalidateElementVisibility||(this._invalidateElementVisibility=!0,this.invalidate())},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(!this.isMovingElement()){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var a=this.getElementBox().getDatas(),b=a.size();if(b>0){for(var c={x:0,y:0,width:0,height:0},d=0;b>d;d++){var e=a.get(d);if(this._visibleMap[e._id]){var f=this._elementUIMap[e._id];f&&(c=Rb.unionRect(c,f._viewRect))}}var g=this.getBackgroundImage();if(g&&(c=Rb.unionRect(c,g._viewRect)),this.realWidth==(c.x+c.width)*this.getZoom()&&this.realHeight==(c.y+c.height)*this.getZoom())return;var h=this.getZoom();this.realWidth=(c.x+c.width)*h+this._paddingRight,this.realHeight=(c.y+c.height)*h+this._paddingBottom,this._unionBounds={x:c.x*h,y:c.y*h,width:c.width*h+this._paddingRight,height:c.height*h+this._paddingRight}}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)}},getElementUI:function(a){return null==a?null:this._elementUIMap[a._id]},createElementUI:function(a){var b=this._elementUIMap[a.getId()];b||(b=this._elementUIFunction(this,a),b&&(this._elementUIMap[a.getId()]=b))},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(a,b){var c=this.getElementUI(a);c&&c.invalidate(b)},invalidateElementUIs:function(a){for(var b in this._elementUIMap){var c=this._elementUIMap[b];c.invalidate(a)}},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a);

},this)},invalidateBundleLink:function(a){if(a instanceof Gb.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(){var a=this._rootCanvas.getContext("2d");if(a.clearRect(0,0,this._rootCanvas.width,this._rootCanvas.height),this.visibleList=new Gb.List,this._topAttachmentList=new Gb.List,null!=this.getElementBox()){kd.draw(a,this);var b=this.getElementBox().getDatas()._as,c=b.length;a.save(),a.scale(this.getZoom(),this.getZoom()),a.translate(-this.viewRect.x/this.getZoom(),-this.viewRect.y/this.getZoom()),this.paintBottom(a);var d={x:this.viewRect.x/this.getZoom(),y:this.viewRect.y/this.getZoom(),width:this.viewRect.width/this.getZoom(),height:this.viewRect.height/this.getZoom()},e=this.getBackgroundImage(),f=this.getBackgroundImageRect();if(e instanceof Nb&&(f?a.drawImage(e,f.x,f.y,f.width,f.height):a.drawImage(e,0,0,e.width,e.height),e._viewRect={x:0,y:0,width:e.width,height:e.height}),"string"==typeof e){var g=Hb.getImageAsset(e),h={x:0,y:0,width:g.getWidth(),height:g.getHeight()};Mc(a,e,null,h,null,this)}var i,j,k,l,m=this._box._layerBox;if(1===m.size())for(i=0;c>i;i++)j=b[i],this._visibleMap[j._id]&&(k=this._elementUIMap[j._id],null!=k&&this._isInView(k,d)?(k.paint(a),k.setAttachmentVisible&&k.setAttachmentVisible(!0),this.visibleList.add(j)):k.setAttachmentVisible&&k.setAttachmentVisible(!1));else m.forEachByDepthFirst(function(e){for(i=0;c>i;i++)j=b[i],m.getLayerByElement(j)===e&&this._visibleMap[j._id]&&(k=this._elementUIMap[j._id],null!=k&&this._isInView(k,d)?(k.paint(a),k.setAttachmentVisible&&k.setAttachmentVisible(!0),this.visibleList.add(j)):k.setAttachmentVisible&&k.setAttachmentVisible(!1))},null,this);for(c=this._topAttachmentList.size(),i=0;c>i;i++)l=this._topAttachmentList.get(i),l.getElementUI().paintAttachment(a,l);if(this._xyz){var c,n=this._xyz,o=n.markText,p=n.type,q=(n.expired,n.innerHTML),r=0,s=0,t=this.viewRect;a.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),a.scale(1/this.getZoom(),1/this.getZoom());{this.getZoom()}void 0!=o&&null!=o&&""!=o||"2"==p?(a.font="15px Arial sans-serif",c=Hb.g.getTextSize(a.font,q),a.fillStyle="red",r=t.width-c.width,s=t.height-20):(a.font="10px Arial sans-serif",c=Hb.g.getTextSize(a.font,q),r=t.width/2-c.width/2,s=t.height/2),a.fillText(q,r,s)}a.restore()}},paintBottom:function(a){},_isInView:function(a,b){return Rb.intersects(b,a._viewRect)},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){for(var b=this.markerList.size(),c=0;b>c;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint:function(a){var b;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=this._view.getBoundingClientRect(),d=a.changedTouches[0],e=Ob.isAndroid?0:yc.scrollLeft(),f=Ob.isAndroid?0:yc.scrollTop();return b={x:(d.clientX+this.viewRect.x-c.left-e)/this._zoom,y:(d.clientY+this.viewRect.y-c.top-f)/this._zoom}}return b=Ob.isFirefox?{x:(a.layerX+this.viewRect.x)/this.getZoom(),y:(a.layerY+this.viewRect.y)/this.getZoom()}:{x:(a.offsetX+this.viewRect.x)/this.getZoom(),y:(a.offsetY+this.viewRect.y)/this.getZoom()}},getElementAt:function(a,b){if(null==this.visibleList)return null;1===arguments.length&&(b=!0);var c,d;if(a.target?c=this.getLogicalPoint(a):a.event?a.event.target&&(c=this.getLogicalPoint(a.event)):c=a,null!=this._topAttachmentList)for(var e=this._topAttachmentList.size(),f=e-1;f>=0;f--){var g=this._topAttachmentList.get(f);if(d=g.getElement(),(!b||this.isSelectable(d))&&g.hit(c.x,c.y))return d}if(null!=this.visibleList)for(var h=this.visibleList.size(),i=h-1;i>=0;i--){var j=this.visibleList.get(i),k=this.getElementUI(j);if((!b||this.isSelectable(j))&&k&&k.hit(c.x,c.y))return j}return null},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return d=a.target?this.getLogicalPoint(a):a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,b,c,d){var e=new Gb.List;if(null==this.visibleList)return e;d=void 0===d?!0:d;for(var f=this.visibleList.size(),g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);i&&(!c||c(i._element))&&(d&&this.isSelectable(i._element)||!d)&&(b?i.intersects(a)&&e.add(h):Rb.contains(a,i.getViewRect())&&e.add(h))}return e},getPosition:function(a,b,c,d,e){var f,g=b instanceof Gb.canvas.ElementUI?b:this.getElementUI(b);if(g)if("from"===a||"to"===a){if(g.getFromPosition&&(f="from"===a?g.getFromPosition(d,e):g.getToPosition(d,e)))return c?{x:f.x-c.width/2,y:f.y-c.height/2}:f}else f="hotspot"===a?g.getHotSpot():Tb.get(a,g.getBodyRect(),c);if(!f&&b.getRect&&(f=Tb.get(a,b.getRect(),c)),f)return{x:f.x+d,y:f.y+e};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){if(Ob.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY),1==this.isHScrollBarVisible()&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)?a instanceof Gb.Link?!1:this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Gb.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Ld){var f=this.getElementUI(e);f&&(b=Rb.unionRect(b,f.getViewRect()))}}return b},isVisible:function(a,b,c){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(3!==arguments.length&&(b=this._visibleFunction),b&&!b(a))return!1;if(!(c||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(uc.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(a instanceof Gb.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,c)||!this.isVisible(a._toAgent,b,c))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var d=a._parent;d&&!d.ISubNetwork;){if(d instanceof Gb.Group&&(!d.isExpanded()||!this.isVisible(d,b,c)))return!1;d=d._parent}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a){return null==this._linkableFunction||this._linkableFunction(a)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a,b){var c=[new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.MoveInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)];b&&c.push(new Gb.canvas.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setTouchInteractions:function(){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.MoveInteraction(this,!1),new Gb.canvas.interaction.ScrollInteraction(this),new Gb.canvas.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Gb.canvas.interaction.ScrollInteraction(this),new Gb.canvas.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.EditInteraction(this,a),new Gb.canvas.interaction.MoveInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setCreateElementInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateElementInteraction(this,a)])},setCreateLinkInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateLinkInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateShapeLinkInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.CreateShapeNodeInteraction(this,a),new Gb.canvas.interaction.ScrollInteraction(this)])},setPanInteractions:function(){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.PanInteraction(this),new Gb.canvas.interaction.ScrollInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Gb.canvas.interaction.DefaultInteraction(this),new Gb.canvas.interaction.SelectInteraction(this),new Gb.canvas.interaction.MoveInteraction(this),new Gb.canvas.interaction.ScrollInteraction(this),new Gb.canvas.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement())return void Ac.hideToolTip();var c=b.getElementAt(a);if(b._preElement!==c)if(b._preElement=c,c){var d=b.getToolTip(c);Ac.showToolTip({x:a.pageX,y:a.pageY},d);var e=Ac.getToolTipDiv(),e=Ac.getToolTipDiv();if(e.children.length>0){var f=b._view.getBoundingClientRect(),g=e.getBoundingClientRect();g.width+g.left>f.width+f.left&&(e.style.left=f.width+f.left-g.width+(Mb.documentElement.scrollLeft||Mb.body.scrollLeft)+"px"),g.height+g.top>f.height+f.top&&(e.style.top=f.height+f.top-g.height+(Mb.documentElement.scrollTop||Mb.body.scrollTop)+"px")}}else Ac.hideToolTip()},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a){a=this.checkZoom(a);var b=this._zoom;if(this._zoom!=a){var c={x:(this.viewRect.x+this.viewRect.width/2)/this.getZoom()*a,y:(this.viewRect.y+this.viewRect.height/2)/this.getZoom()*a};this._zoom=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.setViewRect(c.x-this.viewRect.width/2,c.y-this.viewRect.height/2,this.viewRect.width,this.viewRect.height),this.firePropertyChange("zoom",b,this._zoom)}},getZoom:function(){return this._zoom},setTouchZoom:function(a){this.setZoom(a,!1)},zoomOverview:function(a){if(!(this.realWidth<=0||this.realHeight<=0)){var b=this.realWidth/this.getZoom(),c=this.realHeight/this.getZoom(),d=this.viewRect.width/b,e=this.viewRect.height/c,f=Math.min(d,e);this.setZoom(f)}},zoomReset:function(){this.setZoom(1)},zoomIn:function(){this.setZoom(1.2*this.getZoom())},zoomOut:function(){this.setZoom(this.getZoom()/1.2)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(uc.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){if(Gb.animate.AnimateManager.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var d=new Gb.animate.AnimateSubNetwork(this,a,c);Gb.animate.AnimateManager.start(d)}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var b=this._currentSubNetwork;this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",b,a),this.invalidateElementVisibility(),this.invalidateCanvasSize()}},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=uc.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Hb.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Gb.Group&&e.setExpanded(!0);var f=b.getViewRect();if(f){var g={x:f.x*this.getZoom(),y:f.y*this.getZoom(),width:f.width*this.getZoom(),height:f.height*this.getZoom()};Rb.intersects(this.viewRect,g)||this.isVisible(a)&&Hb.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])}}},centerByLogicalPoint:function(a,b,c){var d=a-this.viewRect.width/2,e=b-this.viewRect.height/2;this.setViewRect(d,e,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Dd.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c,d,e,f){c||(c=Ub.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var g=c.getContext("2d");if(g.translate(-e,-f),g.clearRect(0,0,a,b),kd.draw(g,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;a/this.realWidth*this.getZoom(),b/this.realHeight*this.getZoom();g.scale(d,d);var h=this.getElementBox().getDatas()._as,i=h.length;this._topAttachmentList=new Gb.List;var j,k,l,m,n,o,p=this.getElementBox().getLayerBox(),q=p.getRoots(),r=q.size();if(1===r)for(l=0;i>l;l++)m=h[l],this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));else for(j=0;r>j;j++)for(k=q.get(j),l=0;i>l;l++)m=h[l],p.getLayerByElement(m)===k&&this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));for(i=this._topAttachmentList.size(),l=0;i>l;l++)o=this._topAttachmentList.get(l),o.getElementUI().paintAttachment(g,o);return c},toCanvasByRegion:function(a,b,c){c||(c=Ub.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e),c._viewRect?(c._viewRect.width=d,c._viewRect.height=e):c._viewRect={x:0,y:0,width:d,height:e};var f=c.getContext("2d");if(f.clearRect(0,0,d,e),kd.draw(f,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;f.save(),f.scale(b,b),f.beginPath(),f.translate(-a.x,-a.y);var g=this.getElementBox().getDatas()._as,h=g.length;this._topAttachmentList=new Gb.List;var i=this.getBackgroundImage();if(i&&i._viewRect&&Rb.intersects(a,i._viewRect)){var a=Rb.intersection(a,i._viewRect),j=i._viewRect;try{f.drawImage(i,j.x,j.y,j.width,j.height)}catch(k){}}var l,m,n,o,p,q,r=this.getElementBox().getLayerBox(),s=r.getRoots(),t=s.size();if(1===t)for(n=0;h>n;n++)o=g[n],this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&Rb.intersects(a,p._viewRect)&&p.paint(f));else for(l=0;t>l;l++)for(m=s.get(l),n=0;h>n;n++)o=g[n],r.getLayerByElement(o)===m&&this._visibleMap[o._id]&&(p=this._elementUIMap[o._id],null!=p&&Rb.intersects(a,p._viewRect)&&p.paint(f));for(h=this._topAttachmentList.size(),n=0;h>n;n++)q=this._topAttachmentList.get(n),q.getElementUI().paintAttachment(f,q);return f.restore(),c},getGroupChildrenRects:function(a){var b=new md;return a.getChildren().forEach(function(a){if(a instanceof Ld){var c=this.getElementUI(a);if(c){var d=c.getViewRect();d&&b.add(d)}}},this),b},getBackgroundImageRect:function(){return null},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){},setMovingElement:function(a){if(a!=this._movingElement){var b=this._movingElement;this._movingElement=a,this.firePropertyChange("movingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(a){if(a!=this._editingElement){var b=this._editingElement;this._editingElement=a,this.firePropertyChange("editingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}}}),Gb.canvas.Overview=function(a){Gb.canvas.Overview.superClass.constructor.apply(this,a),this._view=Ub.createView(),this._rootDiv=Ub.createDiv(),this._imageCanvas=Ub.createCanvas(),this._imageDiv=Ub.createDiv(),this._maskCanvas=Ub.createCanvas(),this._selectDiv=Ub.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Ub.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=Ub.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(a),Ob.isTouchable?Ob.isMSTouchable?new Gb.canvas.OverviewMSTouchInteraction(this):(new Gb.canvas.OverviewTouchInteraction(this),new Gb.canvas.OverviewInteraction(this)):new Gb.canvas.OverviewInteraction(this)},Hb.ext("twaver.canvas.Overview",Gb.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Dd.OVERVIEW_FILL_COLOR,_outlineColor:Dd.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Dd.OVERVIEW_OUTLINE_WIDTH,_selectColor:Dd.OVERVIEW_SELECT_COLOR,_selectWidth:Dd.OVERVIEW_SELECT_WIDTH,_padding:Dd.OVERVIEW_PADDING,_animate:Dd.OVERVIEW_ANIMATE,_maxPackingWidth:Dd.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Dd.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Ub.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Ub.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property||"canvasSizeChange"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Hb.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Hb.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Rb.grow(a,-this._padding,-this._padding),b&&(Ub.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var c=this._network.getZoom(),d=this._network._unionBounds;d=Rb.unionRect(d,{x:0,y:0,width:d.x,height:d.y}),d={x:d.x/c,y:d.y/c,width:d.width/c,height:d.height/c};var e={x:this._network.viewRect.x/c,y:this._network.viewRect.y/c,width:this._network.viewRect.width/c,height:this._network.viewRect.height/c},f=Rb.unionRect(d,e),g=Math.min(a.width/f.width,a.height/f.height),h=f.width*g,i=f.height*g,j=f.width*g,k=f.height*g,l=a.x+(a.width-j)/2,m=a.y+(a.height-k)/2;if(this._isNetworkDirty){var n={x:l,y:m,width:j,height:k};this._network.toCanvas(h,i,this._exportImageCanvas,g,f.x*g,f.y*g),this._imageCanvas.setAttribute("width",j),this._imageCanvas.setAttribute("height",k),this._imageCtx.drawImage(this._exportImageCanvas,0,0,h,i),Ub.setDiv(this._imageDiv,n,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var o={x:(e.x-f.x)*g,y:(e.y-f.y)*g,width:e.width*g,height:e.height*g},p=Ub.setCanvas(this._maskCanvas,l,m,j,k);p.lineWidth=0,p.fillStyle=this._fillColor,Vb.drawVector(p,"rectangle",null,l,m,j,k),p.closePath(),p.fill(),p.stroke(),p.clearRect(l+o.x,m+o.y,o.width,o.height),p.lineWidth=this._outlineWidth,p.strokeStyle=this._outlineColor;var q=o.width-2*this._outlineWidth,r=o.height-2*this._outlineWidth;q=Math.min(q,j-2-o.x-this._outlineWidth),r=Math.min(r,k-2-o.y-this._outlineWidth),Vb.drawVector(p,"rectangle",null,l+o.x+this._outlineWidth,m+o.y+this._outlineWidth,q,r),p.closePath(),p.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;Rb.containsPoint(c,a)&&(this._network.centerByLogicalPoint((a.x-c.x)/c.width*this._network.getCanvasSize().width,(a.y-c.y)/c.height*this._network.getCanvasSize().height,b),this._invalidateMask())}}),Gb.canvas.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.canvas.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.network.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),yc.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=yc.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Gb.canvas.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Hb.ext("twaver.canvas.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate)}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.canvas.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("mousedown","handleMousedown",this.view,this)},Hb.ext("twaver.canvas.OverviewInteraction",Object,{handleMousedown:function(a){0===a.button&&(this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Hb.isCtrlDown(a)&&(this.startPoint=this.endPoint,Ub.setVisible(this.overview._selectDiv,!0)),Ub.addEventListener("mousemove","handleMousemove",this.view,this),Ub.addEventListener("mouseup","handleMouseup",Mb,this))},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]);else if(Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f);this.network.setZoom(g*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var h=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network.getCanvasSize().height*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);Hb.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Ub.setVisible(this.overview._selectDiv,!1),Ub.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Ub.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("mousemove",this.view,this),Ub.removeEventListener("mouseup",this.view,this))}}),Gb.canvas.ElementUI=function(a,b){this._network=a,this._element=b,
this._attachments=new Gb.List,this._bodyBounds=new Gb.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Hb.ext("twaver.canvas.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){this.invalidate(!0)},handleSelectionChange:function(a){this.invalidate(!0)},invalidate:function(a){void 0===a&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this._network.invalidateElementVisibility())},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var a;this._bodyBounds.forEach(function(b){a=Rb.unionRect(a,b)}),this._unionBodyBounds=Hb.clone(a),this._attachments.forEach(function(b){a=Rb.unionRect(a,b.getViewRect())}),this._viewRect=a}},validateImpl:function(){},setShadow:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur?b:((c||this._network._showShadowInEdit)&&(b.shadowOffsetX=this._shadowXOffset,b.shadowOffsetY=this._shadowYOffset,b.shadowBlur=this._shadowBlur,b.shadowColor=this._shadowColor),b)},clearShadow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;return c&&(this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset),Rb.grow(b,this._shadowBlur,this._shadowBlur)),b},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(a){this._attachments.add(a)},removeAttachment:function(a){this._attachments.remove(a)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Gb.canvas.LabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Gb.canvas.AlarmAttachment(this,Dd.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Gb.canvas.IconsAttachment(this),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Gb.canvas.EditAttachment(this),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Gb.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore()},paintBody:function(a){},paintAttachments:function(a){a.beginPath();for(var b=this._attachments.size(),c=0;b>c;c++){var d=this._attachments.get(c);1==this._hitTest&&0==d.isShowOnTop()&&this.paintAttachment(a,d),1==this._intersectTest&&this.paintAttachment(a,d),0==this._hitTest&&0==this._intersectTest&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d))}},paintAttachment:function(a,b){a.beginPath(),b.paint(a),this.clearShadow(a)},getViewRect:function(){return Hb.clone(this._viewRect)},getUnionBodyBounds:function(){return Hb.clone(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(){return this._bodyRect||(this._bodyRect=this.createBodyRect()),Hb.clone(this._bodyRect)},getHotSpot:function(){return this._hotSpot?Hb.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(a,b){return!1},intersects:function(a){return Rb.contains(a,this.getViewRect())?!0:!1},hitCanvasRectAtBody:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);if(c.save(),c.translate(-a.x,-a.y),this._element.getImage){var d=Hb.getImageAsset(this._element.getImage());if(d&&d.getImage()instanceof Hd)return 1}this.paintBody(c);try{for(var e=c.getImageData(0,0,a.width,a.height),f=e.data,g=0;g<e.width;g++)for(var h=0;h<e.height;h++){var i=4*(h*e.width+g),j=f[i+3];if(0!==j)return c.restore(),1}}catch(k){if(Od.disposeHitCanvas(),Rb.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),1}}catch(j){Od.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var b=Rb.intersection(a,this._viewRect),c=this.hitCanvasRectAtBody(b);if(1==c)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return 1==d?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==c)},hitCanvasPoint:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this._viewRect,c))return!1;this._hitTest=!0;var e=this.hitCanvasRect(c);return this._hitTest=!1,e},hitTest:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this._viewRect,c))return null;var e=Rb.intersection(c,this._viewRect),f=this.hitCanvasRectAtBody(e);if(1==f)return this;for(var g=this._attachments.size(),h=0;g>h;h++){var i=this._attachments.get(h);if(i.hit(a,b))return i}return 0==f?this:null},dispose:function(){this._attachments.forEach(function(a){a.dispose()}),this._attachments.clear()}}),Gb.canvas.NodeUI=function(a,b){Gb.canvas.NodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.NodeUI",Gb.canvas.ElementUI,{invalidate:function(a){Gb.canvas.NodeUI.superClass.invalidate.call(this,a),this.curInterval&&clearInterval(this.curInterval);var b=this._element.getAgentLinks();b&&b.forEach(function(a){this._network.invalidateElementUI(a,!1)},this);var c=this._element.getParent();c instanceof Gb.Group&&this._network.invalidateElementUI(c,!1)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Gb.canvas.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Rb.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Gb.canvas.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");"default"===a?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===a?this.addBodyBounds(this.getVectorBody()):"default.vector"===a?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===a&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();if(!b)return c;Rb.addPadding(c,this._element,"image.padding",1),this._defaultRect=c;var d=Hb.clone(c);return this.appendShadowBound(this,d),c=d},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width");if(c>0){var d=this.getBodyRect();Rb.addPadding(d,b,a+".padding",1);var e=Hb.clone(d);return Rb.grow(e,c/2,c/2),e}return null},getPathRect:function(a,b){var c=this._element,d=this.getBodyRect();b&&Rb.addPadding(d,c,a+".padding",1);var e=Hb.clone(d),f=c.getStyle(a+".outline.width");return f>0&&Rb.grow(e,f/2,f/2),this.appendShadowBound(this,e),e},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");"default"===b?this.drawDefaultBody(a):"vector"===b?this.drawVectorBody(a):"default.vector"===b?(this.drawVectorBody(a),this.drawDefaultBody(a)):"vector.default"===b&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&this.drawOuterBorder(a),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getBodyRect();Rb.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,Vb.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b=this._element,c=Hb.getImageAsset(b.getImage()),d=this._defaultRect;if(c&&c.getImage()){0!=b.getAngle()&&(a.save(),d=b.getOriginalRect(),Gb.Util.rotateCanvas(a,d,b.getAngle())),this.setShadow(this,a);if(c.getImage()instanceof Hd){var e,f=c.getImage().frames,g=c.getImage().size,h=0;e=Jd(f,g,0),a.drawImage(e,d.x,d.y,d.width,d.height),this.curInterval=setInterval(function(){h=(h+f.length)%f.length,e=Jd(f,g,h),a.drawImage(e,d.x,d.y,d.width,d.height),h++},100)}else Mc(a,b.getImage(),this.getInnerColor(),d,b,this._network);0!=b.getAngle()&&a.restore()}},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getBodyRect();d=Hb.clone(d);var e=b.getStyle("select.physicalZoom")?1:this._network.getZoom();Rb.addPadding(d,b,"select.padding",1/e),Rb.grow(d,c/2/e,c/2/e),a.lineWidth=c/e,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Vb.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color"),d=this.getBodyRect();if(0!==b&&c){var e=this._element.getAngle();0!=e&&(a.save(),d=this._element.getOriginalRect(),Gb.Util.rotateCanvas(a,d,e)),"rectangle"===this.getStyle("vector.shape")&&Vb.draw3DRect(a,c,b,d),0!=e&&a.restore()}},drawPath:function(a,b,c,d,e,f,g){var h=this._element,i=this.getBodyRect();c&&Rb.addPadding(i,h,b+".padding",1);var j=h.getStyle(b+".outline.width");this.setShadow(this,a),0!=h.getAngle()&&(h instanceof Nd||(i=h.getOriginalRect()),a.save(),Gb.Util.rotateCanvas(a,i,h.getAngle()));var k,l=h.getStyle(b+".fill");if(l){k=this._innerColor&&!uc.hasDefault(this._element)?this._innerColor:h.getStyle(b+".fill.color");var m=h.getStyle(b+".gradient");m?Vb.fill(a,k,m,h.getStyle(b+".gradient.color"),i):a.fillStyle=k}var n=h.getStyle(b+".shape"),o=h.getStyle("group.shape.roundrect.radius");0>o&&(o=10),l&&(a.beginPath(),e?Vb.drawLinePoints(a,e,null,f,g):"roundrect"===n&&"group"===b?Vb.drawVector(a,n,null,i,o):Vb.drawVector(a,n,null,i),a.fill()),j>0&&(a.lineWidth=j,a.lineCap=h.getStyle(b+".cap"),a.lineJoin=h.getStyle(b+".join"),a.strokeStyle=h.getStyle(b+".outline.color"),a.beginPath(),e?Vb.drawLinePoints(a,e,d,f,g):"roundrect"===n&&"group"===b?Vb.drawVector(a,n,d,i,o):Vb.drawVector(a,n,d,i),a.stroke()),0!=h.getAngle()&&a.restore()},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),this._network._transparentSelectionEnable){var e=this.getBodyRect();if(Hb.math.intersects(e,c))return!0}return Rb.intersects(this.getViewRect(),c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.canvas.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Hb.math.intersects(c,a))return!0}return Rb.intersects(a,this.getViewRect())?this.hitCanvasRect(a):!1}}),Gb.canvas.LinkUI=function(a,b){Gb.canvas.LinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.LinkUI",Gb.canvas.ElementUI,{isEditable:function(){return wc.isOrthogonalLink(this._element)&&this.getControlPoint()?!0:!1},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Gb.canvas.LinkUI.superClass.invalidate.call(this,a)},validateImpl:function(){this.validateBodyBounds(),Gb.canvas.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Rb.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Rb.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(this._network._debug&&(this._arrowFromRect=nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"))),c=Rb.unionRect(c,nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset")))),b.getStyle("arrow.to")&&(this._network._debug&&(this._arrowToRect=nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"))),c=Rb.unionRect(c,nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset")))),this.appendShadowBound(this,c),this.addBodyBounds(c)}},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this._linkPoints;if(b&&!(b.size()<2)){var c=this._element,d=c.getStyle("link.width"),e=d;if(this._outerColor){var f=c.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===c.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=c.getStyle("select.width");e+=2*h}this.setShadow(this,a),a.lineCap=c.getStyle("link.cap"),a.lineJoin=c.getStyle("link.join");var i=c.getStyle("link.pattern");g&&this.drawLinePoints(a,b,e,c.getStyle("select.color"),i),this._outerColor&&this.drawLinePoints(a,b,d+2*f,this._outerColor,i),this.drawLinePoints(a,b,d,this._innerColor||c.getStyle("link.color"),i),nd.drawLinkArrow(this,a,b)}},drawLinePoints:function(a,b,c,d,e){if(a.lineWidth=c,a.strokeStyle=d,this._element.getStyle("link.flow")===!0&&e&&e.length>1){var f=new tc(a,e[0],e[1]),g=this._element.getStyle("link.flow.offset"),h=Math.floor(g/(e[0]+e[1]));h>2&&(g-=(e[0]+e[1])*h),this._element.getStyle("link.flow.converse")?g<e[0]?f.overflow=e[0]-g:g>=e[0]&&g<=e[0]+e[1]?(f.overflow=e[1]-(g-e[0]),f.overflow&&(f.isLine=!1)):(g-=e[0]+e[1],f.overflow=e[0]-g):g<=e[1]?(f.overflow=g,g&&(f.isLine=!1)):g>e[1]&&g<=e[0]+e[1]?f.overflow=g-e[1]:(g-=e[0]+e[1],g&&(f.isLine=!1),f.overflow=g),this._element._styleMap["link.flow.offset"]=g,a.beginPath(),Vb._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var i=this._element.getStyle("link.flow.color");i=i?i:Dd.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=i,Vb._drawLine(b,f),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Vb.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Rb.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=wc.createFromPoint(this)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=wc.createToPoint(this)),this._toPoint},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=this.getStyle("link.type"),d=new Gb.List;if(wc.isOrthogonalOrFlexionalLink(this._element))d=wc.orthogonalAndFlexional(this,c);else if(this._element.isLooped()){var e=this._network.getElementUI(this._element.getFromAgent());null!=e&&(this._hotSpot=wc.fillLoopedPoints(this,e.getBodyRect(),d))}else{if("arc"!==c&&"triangle"!==c&&"parallel"!==c)throw"Can not resolve link type '"+c+"'";this._hotSpot=wc.fillBundlePoints(this,c,a,b,d)}if(this._network._linkPathFunction){var f=this._network._linkPathFunction(this,d);f&&(d=f)}return d},checkAttachments:function(){Gb.canvas.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Gb.canvas.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return wc.getControlPoint(this._element,this)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(wc.hasControlPoint(b)){var c=wc.getLinkSourceBounds(this),d=wc.getLinkTargetBounds(this);wc.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();return d&&d>0&&Rb.grow(c,d,d),Rb.intersects(this.getViewRect(),c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.canvas.LinkUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(0==Rb.intersects(a,this.getViewRect()))return!1;var c=this.getLinkPoints(),d=c.size();if(2==d)for(var e=0;d>e;e+=2){var f=c.get(e);if(d>e+1){var g=c.get(e+1);if(Od.intersectsLine(f.x,f.y,g.x,g.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Rb.getAngle(this._fromPoint,this._toPoint)),this._angle||0}}),Gb.canvas.GroupUI=function(a,b){Gb.canvas.GroupUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.GroupUI",Gb.canvas.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this.drawExpandedGroup(a):Gb.canvas.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){this.getBodyRect(),this._shapeRect?this.addBodyBounds(this.getPathRect("group",!1)):Gb.canvas.GroupUI.superClass.validateBodyBounds.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Vb.draw3DRect(a,c,b,this._bodyRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var c=this.getChildrenRects();if(!c.isEmpty()){var d=a.getStyle("group.shape"),e=Sb[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(c)}}return this._shapeRect?(Rb.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Gb.canvas.GroupUI.superClass.createBodyRect.call(this)}}),Gb.canvas.ShapeNodeUI=function(a,b){Gb.canvas.ShapeNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.ShapeNodeUI",Gb.canvas.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this.getPathRect("vector",!0)},drawDefaultBody:function(a){this._element._points.size()<2||(this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._element._points,this._element._segments,this._element.getStyle("shapenode.closed")),nd.drawLinkArrow(this,a,Rb.getPointObject(this._element._points,this._element._segments)))},drawSelectBorder:function(a){var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getBodyRect();d=Hb.clone(d);var e=b.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(d,b,"select.padding",1/e),Rb.grow(d,c/2,c/2);var f=b.getStyle("vector.outline.width");f>0&&Rb.grow(d,f/2/e,f/2/e),a.lineWidth=c/e,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Vb.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}}}),Gb.canvas.ShapeLinkUI=function(a,b){Gb.canvas.ShapeLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.ShapeLinkUI",Gb.canvas.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new Gb.List,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._element._points),c.add(b);var e,f,g,h,i,j,k,l=Rb.calculateLineLength(c)/2,m=c.size(),n=0,o=0;for(e=0;m>e;e++)if(h=c.get(e),0!=e){if(g=h,g instanceof md&&(g=g._as),g instanceof Array?(i=Rb.calculateCurveLength(f,g,1),f=g[g.length-1]):(k=h.y-f.y,j=h.x-f.x,i=Math.sqrt(j*j+k*k),f=g),o+=i,l>=n&&o>=l){var p=l-n,q=c.get(e-1);q instanceof md&&(q=q._as,q instanceof Array&&(q=q[q.length-1]));var r=c.get(e),s=Rb.getPathInfo(r,q,p,0,-1).point;this._hotSpot=Hb.clone(s)}n=o}else f=h;var t,u,v;if("lineto"===d);else if("quadto"===d){for(t=new Gb.List(c.get(0)),u=1,pointCount=c.size();u<pointCount;u++)t.add(u<pointCount-1?new Gb.List([c.get(u++),c.get(u)]):c.get(u));c=t}else if("cubicto"===d){for(t=new Gb.List(c.get(0)),u=1,pointCount=c.size();u<pointCount;u++)t.add(u<pointCount-2?new Gb.List([c.get(u++),c.get(u++),c.get(u)]):u<pointCount-1?new Gb.List([c.get(u++),c.get(u)]):c.get(u));c=t}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(v=c.get(0),t=new Gb.List(v),u=1,pointCount=c.size();u<pointCount;u++)if(u<pointCount-1){var h=Hb.clone(c.get(u)),w=h.x,x=h.y,j=w-v.x,k=x-v.y;Math.abs(j)>Math.abs(k)?(h.x=w,h.y=v.y):(h.x=v.x,h.y=x),v=h,t.add(v)}else t.add(c.get(u));c=t}return c}}),Gb.canvas.GridUI=function(a,b){Gb.canvas.GridUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.GridUI",Gb.canvas.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?Gb.canvas.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())Gb.canvas.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=Hb.clone(a);this.appendShadowBound(this,b),this.addBodyBounds(b)}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(b||0!==c||0!==d){a.beginPath();var e=this._element.getRect(),f=this.getDyeColor("grid.fill.color");if(this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),0!=c&&Vb.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath(),0!=d)for(var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),i=0;g>i;i++)for(var j=0;h>j;j++){var k=this._element.getCellRect(i,j);null!=k&&(a.beginPath(),Vb.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),Gb.canvas.RotatableNodeUI=function(a,b){Gb.canvas.RotatableNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.RotatableNodeUI",Gb.canvas.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(Rb.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=Hb.getImageAsset(b.getImage()),d=this.getBodyRect();if(Rb.addPadding(d,this._element,"image.padding",1),c.getImage()){var e=this._element._getOrignalWidth(),f=this._element._getOrignalHeight(),g=this._element._getRotateRect();a.save(),a.translate(d.x-g.x+e/2,d.y-g.y+f/2),a.rotate(this._element._angle*Math.PI/180);var d={x:-e/2,y:-f/2,width:e,height:f};Mc(a,c.getImage(this._innerColor,d.width,d.height),this._innerColor,d,b,this._network),a.restore()}else if(c.getSrc());else if(!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}),Gb.canvas.HTMLNodeUI=function(a,b){Gb.canvas.HTMLNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.HTMLNodeUI",Gb.canvas.NodeUI,{checkAttachments:function(){Gb.canvas.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.canvas.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.canvas.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.canvas.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),Gb.canvas.HTMLLinkUI=function(a,b){Gb.canvas.HTMLLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.HTMLLinkUI",Gb.canvas.LinkUI,{checkAttachments:function(){Gb.canvas.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.canvas.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.canvas.HTMLLabelAttachment(this),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.canvas.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.canvas.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)}}),Gb.canvas.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b},Hb.ext("twaver.canvas.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return Hb.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},hit:function(a,b){return Rb.containsPoint(this._viewRect,a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),!0}}catch(j){Od.disposeHitCanvas()}return c.restore(),!1},dispose:function(){},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e}}),Gb.canvas.BasicAttachment=function(a,b){Gb.canvas.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Hb.ext("twaver.canvas.BasicAttachment",Gb.canvas.Attachment,{paint:function(a){Gb.canvas.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),c=this.getOutlineWidth();if(this.getElementUI().setShadow(this,a),(c>0||b)&&(Vb.drawRoundRect(a,this._roundRect.x,this._roundRect.y,this._roundRect.width,this._roundRect.height,this.getCornerRadius()),this._pointers&&(a.moveTo(this._pointers[0].x,this._pointers[0].y),a.lineTo(this._pointers[1].x,this._pointers[1].y),a.lineTo(this._pointers[2].x,this._pointers[2].y)),a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b)){var d=this.getFillColor(),e=this.getGradient();e?Vb.fill(a,d,e,this.getGradientColor(),this._viewRect):a.fillStyle=d,a.fill()}},validate:function(){Gb.canvas.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();this._viewRect=Rb.getRect(this._pointers),this._viewRect=Rb.unionRect(this._viewRect,this._roundRect),a>0&&Rb.grow(this._viewRect,a/2,a/2),this._viewRect=this._ui.appendShadowBound(this,this._viewRect)},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;

i.width=a+c,i.height=b;var j;if(this._ui._element instanceof Gb.Link){var k,l=this._ui.getLinkPoints();k=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(g)>0&&Math.abs(g)<1?"from"===f?g*=k:"to"===f?g=k*(1-g):(g/=2,g+=.5,g*=k):"from"===f?g=g:"to"===f?g=k-g:g+=k/2;{var m,n=Rb.calculatePointInfoAlongLine(l,!0,g,h),o=n.point;n.angle}m="from"===f?this._ui.getFromPoint():"to"===f?this._ui.getToPoint():this._ui._hotSpot,g=o.x-m.x,h=o.y-m.y}if(d>0){var p=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h,!1);var q;if("aboveleft"===p)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("aboveright"===p)i.y=j.y-d-i.height,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("belowleft"===p)i.y=j.y+d,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("belowright"===p)i.y=j.y+d,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("leftabove"===p)i.y=j.y+c-i.height,i.x=j.x-d-i.width,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("leftbelow"===p)i.y=j.y-c,i.x=j.x-d-i.width,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("rightabove"===p)i.y=j.y+c-i.height,i.x=j.x+d,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("rightbelow"===p)i.y=j.y-c,i.x=j.x+d,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("above"===p)i.y=j.y-d-i.height,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y-d},{x:j.x+q,y:j.y-d}];else if("below"===p)i.y=j.y+d,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y+d},{x:j.x+q,y:j.y+d}];else if("left"===p)i.y=j.y-i.height/2,i.x=j.x-d-i.width,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+q},{x:j.x-d,y:j.y-q}];else{if("right"!==p)throw"Can not resolve '"+p+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+q},{x:j.x+d,y:j.y-q}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h,!1),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var r=this.getPadding();0!=r&&Rb.grow(i,r,r),r=this.getPaddingLeft(),0!=r&&(i.x-=r,i.width+=r),r=this.getPaddingRight(),0!=r&&(i.width+=r),r=this.getPaddingTop(),0!=r&&(i.y-=r,i.height+=r),r=this.getPaddingBottom(),0!=r&&(i.height+=r),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return Gb.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Gb.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Gb.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Gb.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Gb.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Gb.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Gb.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Gb.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Gb.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Gb.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Gb.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Gb.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Gb.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Gb.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Gb.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Gb.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Gb.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Gb.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Gb.Defaults.ATTACHMENT_CAP},getJoin:function(){return Gb.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Hb.clone(this._roundRect)},getContentRect:function(){return Hb.clone(this._contentRect)}}),Gb.canvas.LabelAttachment=function(a,b){Gb.canvas.LabelAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.LabelAttachment",Gb.canvas.BasicAttachment,{paint:function(a){var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this._viewRect.x+this._viewRect.width/2,d=this._viewRect.y+this._viewRect.height/2;a.translate(c,d),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-c,-d)}Gb.canvas.LabelAttachment.superClass.paint.apply(this,arguments);var e=this._element.getStyle("label.align"),f=this._element&&this._element.getStyle("label.rotate.angle");0!==f&&(a.save(),Gb.Util.rotateCanvas(a,this._contentRect,f)),Vb.drawText(a,this.text,this._contentRect,this.font,this.getStyle("label.color"),e),(b||0!==f)&&a.restore()},validate:function(){this.font=this.getFont("label.font");var a=this.getLabel(),b=Hb.g.getTextSize(this.font,a),c=this.getMaxLength();0!==c&&b.width>c?(this.text=Hb.g.getCollapseTextInLength(this.font,a,c),this._textSize=Hb.g.getTextSize(this.font,this.text)):(this.text=a,this._textSize=b),Gb.canvas.LabelAttachment.superClass.validate.call(this);var d=this._viewRect,e=this._element&&this._element.getStyle("label.rotate.angle");if(0!==e){var f=new Gb.List;f.add({x:d.x,y:d.y}),f.add({x:d.x+d.width,y:d.y}),f.add({x:d.x+d.width,y:d.y+d.height}),f.add({x:d.x,y:d.y+d.height}),f=this._rotatePointList(f,e,d);var g=Gb.Util.getRect(f);this._viewRect=g}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Gb.canvas.AlarmAttachment=function(a,b){Gb.canvas.AlarmAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.AlarmAttachment",Gb.canvas.BasicAttachment,{paint:function(a){Gb.canvas.AlarmAttachment.superClass.paint.apply(this,arguments),Vb.drawText(a,this.text,this._contentRect,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Vb.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Gb.canvas.LabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Gb.canvas.LinkHandlerAttachment=function(a,b){Gb.canvas.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.LinkHandlerAttachment",Gb.canvas.BasicAttachment,{paint:function(a){Gb.canvas.LinkHandlerAttachment.superClass.paint.apply(this,arguments),Vb.drawText(a,this.linkHandlerLabel,this._contentRect,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Vb.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Gb.canvas.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Gb.canvas.IconsAttachment=function(a,b){Gb.canvas.IconsAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.IconsAttachment",Gb.canvas.Attachment,{isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Gb.canvas.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element));len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[];var c,d;for(i=0;i<len;i++){var e=a[i],f=this.iconsOrientation[i]||"right",g=this.iconsPosition[i]||"topleft.bottomright",h=this.iconsXgap[i]||1,j=this.iconsYgap[i]||1,k=this.iconsXoffset[i]||0,l=this.iconsYoffset[i]||0;if(this._ui._element instanceof Gb.Link){var m,n=this._ui.getLinkPoints();m=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(k)>0&&Math.abs(k)<1?"from"===g?k*=m:"to"===g?k=m*(1-k):(k/=2,k+=.5,k*=m):"from"===g?k=k:"to"===g?k=m-k:k+=m/2;{var o,p=Rb.calculatePointInfoAlongLine(n,!0,k,l),q=p.point;p.angle}o="from"===g?this._ui.getFromPoint():"to"===g?this._ui.getToPoint():this._ui._hotSpot,k=q.x-o.x,l=q.y-o.y}d=null,c=this._getIconsSize(e,f,h,j),c&&(d=this._network.getPosition(g,this._ui,c,k,l),"top"===f?d.y+=c.height:"left"===f&&(d.x+=c.width)),this.locations.push(d),this.iconsSizes.push(c)}var r=null;for(i=0;i<this.locations.length;i++)d=this.locations[i],c=this.iconsSizes[i],null!=d&&(r=null==r?{x:d.x,y:d.y,width:c.width,height:c.height}:Rb.unionRect(r,{x:d.x,y:d.y,width:c.width,height:c.height}));this._viewRect=r||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b;var s=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(s instanceof Array&&s[i]&&this._viewRect){var t=this._viewRect.x+this._viewRect.width/2,u=this._viewRect.y+this._viewRect.height/2,v=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:t-v/2,y:u-v/2,width:v,height:v}}}},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b,c,d,e=[],f=!1,g=a.length;for(b=0;g>b;b++)c=a[b],Array.isArray(c)?(f=!0,e.push(c)):(d=[c],e.push(d));return f||(e.length=0,e.push(a)),e},_makeArray:function(a,b,c){if(Array.isArray(a))return a;for(var d=[],e=0;b>e;e++)d.push(a||c);return d},paint:function(a){if(Gb.canvas.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var b,c,d,e,f,g,h,i,j,k;for(b=0;b<this.iconsGroups.length;b++)if(c=this.locations[b]){f=c.x,g=c.y,e=this.iconsGroups[b],h=this.colorGroups[b],i=this.iconsOrientation[b],j=this.iconsXgap[b]||1,k=this.iconsYgap[b]||1,d=0;for(var l in e){var m=null,n=null;h&&h.length>d&&(n=h[d++]);var o=Hb.getImageAsset(e[l]);if(null!=o){if("right"===i)m={x:f,y:g,width:o.getWidth(),height:o.getHeight()},f+=m.width+j;else if("left"===i)m={x:f-o.getWidth(),y:g,width:o.getWidth(),height:o.getHeight()},f-=m.width+j;else if("top"===i)m={x:f,y:g-o.getHeight(),width:o.getWidth(),height:o.getHeight()},g-=m.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";m={x:f,y:g,width:o.getWidth(),height:o.getHeight()},g+=m.height+k}var p=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");if(p instanceof Array&&p[b]){a.save();var q=m,f=q.x+q.width/2,g=q.y+q.height/2;a.translate(f,g),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-f,-g),Mc(a,o.getImage(n,m.width,m.height),n,m,this._element,this._network),a.restore()}else Mc(a,o.getImage(n,m.width,m.height),n,m,this._element,this._network);if(this._network._debug){var m=this._viewRect;Vb.strokeRect(a,m,"#FCFC00",1),Vb.strokeRect(a,m,"#FCFC00",1)}}}}}},_getIconsSize:function(a,b,c,d){var e=0,f=0,g=null,h=null,i=null;for(var j in a)if(h=Hb.getImageAsset(a[j])){if("right"===b)g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},e+=g.width+c;else if("left"===b)g={x:e-h.getWidth(),y:f,width:h.getWidth(),height:h.getHeight()},e-=g.width+c;else if("top"===b)g={x:e,y:f-h.getHeight(),width:h.getWidth(),height:h.getHeight()},f-=g.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";g={x:e,y:f,width:h.getWidth(),height:h.getHeight()},f+=g.height+d}i=null==i?Hb.clone(g):Rb.unionRect(i,g)}return i?{width:Math.abs(i.width),height:Math.abs(i.height)}:null}}),Gb.canvas.EditAttachment=function(a,b){Gb.canvas.EditAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.canvas.EditAttachment",Gb.canvas.Attachment,{paint:function(a){Gb.canvas.EditAttachment.superClass.paint.apply(this,arguments),this._viewRect=null,this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(!(0>=b)){var c=2*this.resizePointSize,d=2*this.resizePointSize,e=this._network.getResizePointFillColor(),f=this._network.getResizePointOutlineWidth(),g=this._network.getResizePointOutlineColor(),h=this._element.getAngle(),i=this._element.getOriginalRect();a.lineWidth=f;for(var j=0;b>j;j++){var k=this.resizingPoints.get(j),l={x:k.x-this.resizePointSize,y:k.y-this.resizePointSize,width:2*this.resizePointSize,height:2*this.resizePointSize},m=this._getRotateRect(l,h,{x:i.x+i.width/2,y:i.y+i.height/2});a.save(),Gb.Util.rotateCanvas(a,m,h),Od.rect(a,m.x,m.y,c,d),a.restore()}a.fillStyle=e,a.strokeStyle=g,a.fill(),a.stroke()}},paintEditPoints:function(a){var b=this.editPoints.size();if(!(0>=b)){var c=this._network.getEditPointOutlineColor(),d=this._network.getEditPointFillColor(),e=this._network.getEditPointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;b>f;f++){var g=this.editPoints.get(f);a.beginPath(),Od.circle(a,g.x,g.y,this.editPointSize,d,c),a.closePath()}}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(!(0>=b)){var c=this._network.getRotatePointOutlineColor(),d=this._network.getRotatePointFillColor(),e=this._network.getRotatePointOutlineWidth();a.beginPath(),a.lineWidth=e;for(var f=0;b>f;f++){var g=this.rotatePoints.get(f);a.beginPath(),Od.circle(a,g.x,g.y,this.rotatePointSize,d,c),a.closePath()}}},validate:function(){Gb.canvas.EditAttachment.superClass.validate.call(this),this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Gb.List,this.editPoints=new Gb.List,this.rotatePoints=new Gb.List,this._element instanceof Gb.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Ld)||this._element instanceof Gb.ShapeNode||this._element instanceof Gb.Grid||this._element instanceof Gb.Group||this._addRotatePoint(this._element),this._element instanceof Gb.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Gb.canvas.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Gb.canvas.LinkUI&&this._addLinkControlPoint(this._ui)},_addResizingPoint:function(a){var b=a.getOriginalRect();if(b){var c=this._network.getResizePointSize();if(!(0>=c)){var d=new md([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)}}},_addRotatePoint:function(a){var b=a.getOriginalRect();if(b){var c=this._network.getRotatePointSize();if(!(0>=c)){var d=2*c,e=new Gb.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()-d/2}]),f=a.getAngle();0!=f&&(e=this._rotatePointList(e,f,a.getOriginalRect()));var g=e.get(0),h={x:g.x-d/2,y:g.y-d/2,width:d,height:d},i=this._network.getRotatePointOutlineWidth(),j=this.rotatePointSize+i;Rb.grow(b,j,j);var k=Rb.unionRect(a.getRect(),h);this._viewRect=Rb.unionRect(k,this._viewRect),this.rotatePoints=e}}},_addShapeNodePoint:function(a){this._addEditPoints(a.getPoints())},_addShapeLinkPoints:function(a){this._addEditPoints(a.getPoints())},_addLinkControlPoint:function(a){if(wc.isOrthogonalLink(a._element)){var b=a.getControlPoint();if(b){var c=new Gb.List;c.add(b),this._addEditPoints(c)}}},_addEditPoints:function(a){var b=Rb.getRect(a);if(b){var c=this._network.getEditPointSize();if(!(0>=c)){var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)}}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>g)){var h=g+c;Rb.grow(a,h,h),this._viewRect=Rb.unionRect(a,this._viewRect),1==f?this.resizingPoints=b:this.editPoints=b}},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e},_getRotateRect:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Gb.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Rb.getRect(g)}}),Gb.canvas.HTMLLabelAttachment=function(a,b){Gb.canvas.HTMLLabelAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv();this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.canvas.HTMLLabelAttachment",Gb.canvas.LabelAttachment,{validate:function(){var a=this._element.getStyle("attachment.htmllabel.hyperlink");a?(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var b=(this.getFont("label.font"),this.getLabel());this._contentDiv.innerHTML=b,this._contentDiv.style.visibility="hidden",Gb.canvas.HTMLLabelAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._pointers;a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Vb.strokeRect(a,this._contentRect,"#AAAAAA")},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.canvas.HTMLAlarmAttachment=function(a,b){Gb.canvas.HTMLAlarmAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none");this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.canvas.HTMLAlarmAttachment",Gb.canvas.AlarmAttachment,{validate:function(){var a=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=a,this._contentDiv.style.visibility="hidden",Gb.canvas.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._pointers;a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Vb.strokeRect(a,this._contentRect,"#AAAAAB"),Gb.canvas.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.canvas.interaction.BaseInteraction=function(a){this.network=a},Hb.ext("twaver.canvas.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},convertPointFromView:function(a){var b=a.x*this.network.getZoom()-this.network.getViewRect().x,c=a.y*this.network.getZoom()-this.network.getViewRect().y;return{x:b,y:c}},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.getZoom();return{x:a.x*d-this.network.getViewRect().x+b*d,y:a.y*d-this.network.getViewRect().y+c*d,width:a.width*d,height:a.height*d}},getMarkerPoint:function(a){var b;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY}}return b=Ob.isFirefox?{x:a.layerX,y:a.layerY}:{x:a.offsetX,y:a.offsetY}},paint:function(a){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Ub.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Ub.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint(a),this._startClient=Ub.getClientPoint(a),this._startLogical&&Ub.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Gb.canvas.interaction.SelectInteraction=function(a){Gb.canvas.interaction.SelectInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.SelectInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup"),this.end(),this.network.removeMarker(this)},paint:function(a){if(null!=this.startPoint&&null!=this.endPoint){var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}},handle_mousedown:function(a){if(this.network.isValidEvent(a)&&!this.network.isMovingElement()&&!this.network.isEditingElement()&&!a.shiftKey){var b=this.network.getElementAt(a),c=this.network.getSelectionModel();b?Hb.isCtrlDown(a)?c.contains(b)?c.removeSelection(b):c.appendSelection(b):c.contains(b)||c.setSelection(b):(Hb.isCtrlDown(a)||c.clearSelection(),this.end(a),this.startPoint=this.network.getLogicalPoint(a),this.startPoint&&this.network.isRectSelectEnabled()&&this.addListener("mousemove"))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.end(a);var b=this.network.getLogicalPoint(a);b&&(this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:a}:{kind:"selectBetween",event:a}),this.endPoint=b,this.repaint())},end:function(a){if(this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var b=Rb.getRect([this.startPoint,this.endPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.setSelectingElement(!1),this.removeListener("mousemove"),this.startPoint=null,this.endPoint=null,this.repaint()}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y}}),Gb.canvas.interaction.MoveInteraction=function(a,b){this.lazyMode=b,Gb.canvas.interaction.MoveInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.MoveInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","keydown","mouseout"),
this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","keydown","mouseout"),this.end(),this.network.removeMarker(this)},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup")},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting()){var e={},f=this.network.getLogicalPoint(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0)for(var h=g.size(),i=0;h>i;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}else this.parent=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==c||b?null:c},paint:function(a){if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;a.beginPath();var b=this.dragPoint.x-this.pressPoint.x,c=this.dragPoint.y-this.pressPoint.y,d=this.network.getMovableSelectedElements(),e=d.size(),f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;for(var i=0;e>i;i++){var j=d.get(i),k=this.network.getElementUI(j);if(k){var l=this.convertFromUIToMarkerRect(k.getViewRect(),b,c);Od.rect(a,l.x,l.y,l.width,l.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var f=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,g=this.network.getLazyMoveOutlineWidth(),h=this.network.getLazyMoveOutlineColor();a.strokeStyle=h,a.lineWidth=g,a.fillStyle=f;var l=this.parentRect;Od.rect(a,l.x,l.y,l.width,l.height),a.fill(),a.stroke()}},handle_mousedown:function(a){if(0===a.button&&this.network.isValidEvent(a)&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);this.network.isMovable(b)&&(this.end(a),this.lastPoint=this.network.getLogicalPoint(a),this.lazyMode&&(this.pressPoint=this.lastPoint),this.lastPoint&&this.addListener("mousemove"))}},handle_mouseup:function(a){this.end(a)},handle_mouseout:function(a){this.end(a)},handle_mousemove:function(a){if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.network.hasMovableSelectedElements())return void this.end(a);var b=this.network.getLogicalPoint(a);b&&this.lastPoint&&(this.xoffset=b.x-this.lastPoint.x,this.yoffset=b.y-this.lastPoint.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1||(this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()))},end:function(a){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),b.network.setMovingElement(!1)},d=this.dragPoint.x-this.pressPoint.x,e=this.dragPoint.y-this.pressPoint.y;this.network.moveSelectedElements(d,e,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var b=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(b.parent)},this.network)}this.parentProcess(a,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.removeListener("mousemove"),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null}}),Gb.canvas.interaction.ScrollInteraction=function(a){Gb.canvas.interaction.ScrollInteraction.superClass.constructor.call(this,a),this.hThumbRect=null,this.vThumbRect=null,this.scrollBarVisible=!1},Hb.ext("twaver.canvas.interaction.ScrollInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout"),Ob.isFirefox?Ub.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):Ub.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),Ub.addEventListener("mouseup","handleMouseUp",window,this),Ub.addEventListener("mousemove","handleMouseMove",window,this),this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout"),Ob.isFirefox?Ub.removeEventListener("DOMMouseScroll",this.network.getView(),this):Ub.removeEventListener("mousewheel",this.network.getView(),this),Ub.removeEventListener("mouseup",window,this),Ub.removeEventListener("mousemove",window,this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.network.removeMarker(this)},handleViewRectChange:function(a){("viewRect"==a.property||"canvasSizeChange"==a.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=e.width,g=e.height;if(f>b&&(0>c||c+b>f))return void this.repaint();if(g>a&&(0>d||d+a>g))return void this.repaint();var h=0,i=g>a,j=f>b,k=this.getScrollBarWidth();if(g>a){h=j?a*(a-k)/g:a*a/g;var l=d/(g-a)*(a-h-k);this.vThumbRect={x:b-k,y:l,width:k,height:h}}var m=0;if(f>b){m=i?b*(b-k)/f:b*b/f;var n=c/(f-b)*(b-m-k);this.hThumbRect={x:n,y:a-k,width:m,height:k}}this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mousedown:function(a){if(1!=this.network.isValidEvent(a)){var b=this.getMarkerPoint(a);this.hBarDownPoint=null,this.vBarDownPoint=null,null!=this.vThumbRect&&Rb.containsPoint(this.vThumbRect,b.x,b.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),null!=this.hThumbRect&&Rb.containsPoint(this.hThumbRect,b.x,b.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x)}},handle_mouseover:function(a){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(a){0!=this.scrollBarVisible&&(this.scrollBarVisible=!1,this.repaint())},handleMouseUp:function(a){this.vBarDownPoint=null,this.hBarDownPoint=null,this.repaint()},handleMouseMove:function(a){var b={x:a.screenX,y:a.screenY},c=this.network.getCanvasSize(),d=this.network.getViewRect().height,e=this.network.getViewRect().width,f=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var g=b.x-this.hBarDownPoint.x;return this.hBarDownPoint=b,void this.network.setViewOffSet(g*c.width/(e-f),0)}if(null!=this.vBarDownPoint){var h=b.y-this.vBarDownPoint.y;return this.vBarDownPoint=b,void this.network.setViewOffSet(0,h*c.height/(d-f))}},handleMouseWheel:function(a){var b=!1;a.wheelDelta!==a.wheelDeltaX?(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b)):(a.wheelDelta?a.wheelDelta>0&&(b=!0):a.detail<0&&(b=!0),this.scrollYOffset(b))},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,Vb.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();null!=this.hThumbRect&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),null!=this.vThumbRect&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}}}),Gb.canvas.interaction.DefaultInteraction=function(a){Gb.canvas.interaction.DefaultInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.DefaultInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove","keydown")},tearDown:function(){this.removeListener("mousedown","mousemove","keydown")},handle_mousedown:function(a){if(this.network.isValidEvent(a)){this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network.getView());var b=this.network.getElementAt(a);2===a.detail?this.handleDoubleClicked(a,b):this.handleClicked(a,b)}},handleClicked:function(a,b){Bc.handleClicked(this.network,a,b)},handleDoubleClicked:function(a,b){Bc.handleDoubleClicked(this.network,a,b)},handle_keydown:function(a){Bc.handleKeyDown(this.network,a)},handle_mousemove:function(a){var b=this.network.getElementAt(a),c=this._preElement,d=Cc(c),e=Cc(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this.network),this.network.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this.network),this.network.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this.network),this.network.onMouseMove(b,a),this._preElement=b}}),Gb.canvas.interaction.PanInteraction=function(a){Gb.canvas.interaction.PanInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.PanInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup"),this._oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown","mouseup")},handle_mousedown:function(a){this.network.isValidEvent(a)&&(this.lastPoint=this.getMarkerPoint(a),this.lastPoint&&(this.addListener("mousemove"),this.network.getView().style.cursor="pointer"))},handle_mouseup:function(a){this._clear()},handle_mousemove:function(a){if(this.lastPoint){var b=this.getMarkerPoint(a);if(b){var c=b.x-this.lastPoint.x,d=b.y-this.lastPoint.y;this.network.panByOffset(-c,-d),this.lastPoint=b}}},_clear:function(a){this.lastPoint&&(this.lastPoint=null,this.network.getView().style.cursor=this._oldCursor,this.removeListener("mousemove"))}}),Gb.canvas.interaction.CreateElementInteraction=function(a,b){b||(b=Gb.Node),this.elementFunction=Gb.Util.isTypeOf(b,Gb.Node)?function(a){var c=new b;return c instanceof Gb.Node&&c.setCenterLocation(a),c}:b,Gb.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.CreateElementInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Gb.canvas.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,Gb.canvas.interaction.EditInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.EditInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(1==this.lazyMode&&null!=this.resizingRect){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0);a.save(),Gb.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),Od.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},isKeyDown:function(a){return Hb.isAltDown(a)},handle_mousedown:function(a){if(0===a.button)if(!this.isKeyDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?this.isKeyDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0?this.isKeyDown(a)?(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint(a);if(b instanceof Gb.ShapeNode){var d=this.getPointIndex(b.getPoints(),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Gb.ShapeLink){var e=new Gb.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Gb.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection}),c.clear()});Gb.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink&&this.pointIndex>=0&&b?(this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI&&b&&(this.linkUI.setControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element}))}this._handle_mouseup(a),this.lazyMode||this.clear()},handle_mousemove:function(a){if(this.network.isValidEvent(a)){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.shapeLink&&this.pointIndex>=0)return void this._handleMovingShapeLinkPoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if(this.linkUI)return void this._handleMovingLinkControlPoint(a)}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var b=this.network.getElementAt(a),c=this.network.getElementUI(b);if(!c||!c.getEditAttachment())return void this.clear();var d=this.network.getLogicalPoint(a);if(b instanceof Gb.Node){if(this.node=b,this._isEditingShapeNode(d)||this._isResizingNode(d))return void this.network.setEditingElement(!0);if(this._isRotatingElement(d))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(b instanceof Gb.ShapeLink){if(this.shapeLink=b,this._isEditingShapeLink(d))return void this.network.setEditingElement(!0)}else if(c instanceof Gb.canvas.LinkUI){var e=this.network.getEditPointSize();if(wc.isOrthogonalLink(c._element)){this.linkUI=c;var f=this.linkUI.getControlPoint();return void(f&&this._contains(d,f,e)&&(this._setCrossCursor(),this.network.setEditingElement(!0)))}}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle();return this._isRotating(a,"crosshair",c,d)},_isRotating:function(a,b,c,d){var e=this.network.getRotatePointSize(),f={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()-e},g=this._rotatePoint(f,d,c),h={x:g.x-e,y:g.y-e,width:2*e,height:2*e};return Rb.containsPoint(h,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=b.getCenterLocation();return Math.round(180*Math.atan2(c.x-a.x,a.y-c.y)/Math.PI+180)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeNode.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint(a);this.shapeLink.setPoint(this.pointIndex,b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_handleMovingLinkControlPoint:function(a){this.linkUI.setControlPoint(this.network.getLogicalPoint(a)),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0};if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=this._endLogical.x,g.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),"north"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),k.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=this._endLogical.x,j.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"west"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),n.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),l.x=o.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=this._endLogical.x,h.y=this._endLogical.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y}),"south"===this.resizeDirection){var o={x:this._endLogical.x,y:this._endLogical.y};this._reversPoint(o,f,b),m.y=o.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=this._endLogical.x,i.y=this._endLogical.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y}),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_isEditingShapeNode:function(a){var b=this.network.getEditPointSize();if(this.node instanceof Gb.ShapeNode){this.shapeNode=this.node;for(var c=this.shapeNode.getPoints(),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.network.getEditPointSize(),c=this.shapeLink.getPoints(),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.node.getOriginalRect(),d=this.node.getAngle(),e={x:c.x,y:c.y},f=this._rotatePoint(e,d,c);return this._isResizing(a,f.x,f.y,"northwest","nwse-resize")?!0:(e={x:c.x+c.width/2,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"north","ns-resize")?!0:(e={x:c.x+c.width,y:c.y},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"northeast","nesw-resize")?!0:(e={x:c.x,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"west","ew-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height/2},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"east","ew-resize")?!0:(e={x:c.x,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southwest","nesw-resize")?!0:(e={x:c.x+c.width/2,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"south","ns-resize")?!0:(e={x:c.x+c.width,y:c.y+c.height},f=this._rotatePoint(e,d,c),this._isResizing(a,f.x,f.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){var f=this.network.getResizePointSize();return this._contains(a,{x:b,y:c},f)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Rb.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(a){var b,c,d,e,f,g=(new Gb.List,this.network.getRotateScaleWidth()),h=this.network.getRotateScaleHeight(),i=this.network.getRotatePointSize(),j=this.node.getAngle(),k=this.node.getOriginalRect(),l={x:k.x+k.width/2,y:k.y-this.network.getRotatePointOffset()-i},m=this._rotatePoint(l,j,k),n="13px Arial",o=j+"°";this.node.getAngle()>=0&&this.node.getAngle()<=180?(c={x:m.x+i,y:m.y},d={x:c.x+g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(c={x:m.x-i,y:m.y},d={x:c.x-g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y});var p=new Gb.List([c,d,e,f]),b=Hb.math.getRect(p);a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(b.x,b.y,b.width,b.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=n,a.fillText(o,b.x+b.width/2,b.y+b.height/2)},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Gb.canvas.interaction.CreateLinkInteraction=function(a,b){b||(b=Gb.Link),this.linkFunction=Gb.Util.isTypeOf(b,Gb.Link)?function(a,c){var d=new b;return d instanceof Gb.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Gb.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.CreateLinkInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getViewRect(),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.convertPointFromView(this.fromNode.getCenterLocation()),d=c.x,e=c.y,f=this.currentPoint.x,g=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(d,e),a.lineTo(f,g),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a){return this.getNode(a)},getNode:function(a){var b=this.network.getElementAt(a);return b instanceof Ld&&this.network.isLinkable(b)&&this.network.getElementBox().getSelectionModel().isSelectable(b)?b:null}}),Gb.canvas.interaction.CreateShapeLinkInteraction=function(a,b){Gb.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Gb.ShapeLink),this.linkFunction=Gb.Util.isTypeOf(b,Gb.ShapeLink)?function(a,c,d){var e=new b;return e instanceof Gb.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d&&e.setPoints(d)),e}:b},Hb.ext("twaver.canvas.interaction.CreateShapeLinkInteraction",Gb.canvas.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Gb.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){
var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new Gb.List),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(a){if(this.currentPoint){var b,c=new Gb.List;if(b=this.convertPointFromView(this.fromNode.getCenterLocation()),c.add(b,0),this.points&&this.points.size()>0)for(var d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.currentPoint,c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}}}),Gb.canvas.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Gb.ShapeNode),this.shapeNodeFunction=Gb.Util.isTypeOf(b,Gb.ShapeNode)?function(a){var c=new b;return c instanceof Gb.ShapeNode&&a&&c.setPoints(a),c}:b,Gb.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a),this.timeStamp=-1},Hb.ext("twaver.canvas.interaction.CreateShapeNodeInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){for(var b,c=new Gb.List,d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.convertPointFromView(this.currentPoint),c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint(a);if(b){if(2===a.detail||a.timeStamp-this.timeStamp<300){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Gb.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}this.timeStamp=a.timeStamp,this.repaint()}}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint(a),this.repaint())}}),Gb.canvas.interaction.MagnifyInteraction=function(a,b,c,d,e){Gb.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.zoom=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Ub.createCanvas()},Hb.ext("twaver.canvas.interaction.MagnifyInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.network.removeMarker(this)},paint:function(a){if(this.point){var b=this.network._zoom,c=this.zoom*b,d=this.point.x*b-this.network.viewRect.x-this.xRadius,e=this.point.y*b-this.network.viewRect.y-this.yRadius,f=2*this.xRadius,g=2*this.yRadius,h={x:this.point.x-this.xRadius/c,y:this.point.y-this.yRadius/c,width:f/c,height:g/c},i=this.borderWidth,j=Ub.createCanvas();j.width=f,j.height=g,this.network.toCanvasByRegion(h,c,j),a.save(),a.beginPath(),Vb.drawVector(a,this.shape,null,d,e,f,g),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(d,e,f,g),a.fill(),a.drawImage(j,d,e),a.restore(),a.beginPath(),a.lineWidth=i,Vb.drawVector(a,this.shape,null,d+i/2,e+i/2,f-i,g-i),a.strokeStyle=this.borderColor,a.stroke()}},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a),this.point&&this.repaint()},getZoom:function(){return this.zoom},setZoom:function(a){this.zoom=a,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.network.repaintTopCanvas()}}),Gb.canvas.interaction.TouchInteraction=function(a){Gb.canvas.interaction.TouchInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.canvas.interaction.TouchInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("touchstart","handleTouchstart",a,this),Ub.addEventListener("touchmove","handleTouchmove",a,this),Ub.addEventListener("touchend","handleTouchend",a,this),Ub.addEventListener("touchcancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("touchstart",this.network.getView(),this),Ub.removeEventListener("touchmove",a,this),Ub.removeEventListener("touchend",a,this),Ub.removeEventListener("touchcancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(Ub.preventDefault(a),a.touches&&1==a.touches.length){var b=this.network.getLogicalPoint(a),c=this.network.getElementAt(b);this._startTouchTime=new Date,this._startTouchPoint=b,this._startTouchClient=this.getMarkerPoint(a),c?(this._haveElementUnderTouch=!0,this._startTouchElement=c):(this._haveElementUnderTouch=!1,this._startTouchElement=null),this.timer=setTimeout(function(){Bc.handleLongClicked(self.network,a,c)},1e3)}else a.touches&&2==a.touches.length&&(this._distance=yc.getDistance(a),this._zoom=this.network.getZoom());this._touchCount=a.touches.length},handleTouchmove:function(a){if(Ub.preventDefault(a),2==this._touchCount&&a.touches&&2==a.touches.length)if(this.timer&&clearTimeout(this.timer),Math.abs(this._distance-yc.getDistance(a))>=Dd.TOUCH_ZOOM_THRESHOLD||this._zoomFlag){this._zoomFlag=!0;var b=yc.getDistance(a)/this._distance;this.network.setTouchZoom(this._zoom*b,!1)}else{var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}else if(1==this._touchCount&&a.touches&&1==a.touches.length)if(this._haveElementUnderTouch||!this.network.isRectSelectEnabled()){var f=this.network.getLogicalPoint(a),g=this.network.getElementAt(f);if(this.network.isMovingElement()||null!=this._startTouchElement&&this._startTouchElement==g&&this.network.getMovableSelectedElements().contains(g)){var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&(this._startTouchPoint=f,this.network.moveSelectedElements(d,e),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}),this.timer&&clearTimeout(this.timer)))}else{var d=f.x-this._startTouchPoint.x,e=f.y-this._startTouchPoint.y;(Math.abs(d)>=Dd.TOUCH_MOVE_THRESHOLD||Math.abs(e)>=Dd.TOUCH_MOVE_THRESHOLD)&&this.timer&&clearTimeout(this.timer);var c=this.getMarkerPoint(a),d=this._startTouchClient.x-c.x,e=this._startTouchClient.y-c.y;this.network.panByOffset(d,e),this._startTouchClient=c}}else{var h=this.network.getLogicalPoint(a);if(!h)return;var d=h.x-this._startTouchPoint.x,e=h.y-this._startTouchPoint.y;Math.abs(d)>=Dd.TOUCH_RECT_SELECT_THRESHOLD&&Math.abs(e)>=Dd.TOUCH_RECT_SELECT_THRESHOLD&&(this.network.setSelectingElement(!0),this._moveTouchPoint?this.network.fireInteractionEvent({kind:"selectBetween",event:a}):(this.network.fireInteractionEvent({kind:"selectStart",event:a}),this.timer&&clearTimeout(this.timer)),this._moveTouchPoint=h,this.repaint())}},handleTouchend:function(a){if(Ub.preventDefault(a),this.network.isMovingElement())this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a});else if(this.network.isSelectingElement()){var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}else if(this._startTouchPoint){this._zoomFlag=!1;var f=new Date,g=this.network.getLogicalPoint(a),h=this.network.getElementAt(this._startTouchPoint);g&&f.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,g)<=20&&(h?this.network.getSelectionModel().contains(h)||this.network.getSelectionModel().setSelection(h):this.network.getSelectionModel().clearSelection(),Bc.handleClicked(this.network,a,h),this.timer&&clearTimeout(this.timer),this._endTouchTime&&f.getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,g)<=20?(delete this._endTouchTime,delete this._endTouchPoint,Bc.handleDoubleClicked(this.network,a,h)):(this._endTouchTime=f,this._endTouchPoint=g))}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y}}),Gb.canvas.interaction.MSTouchInteraction=function(a){Gb.canvas.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Hb.ext("twaver.canvas.interaction.MSTouchInteraction",Gb.canvas.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("MSPointerDown","handleTouchstart",a,this),Ub.addEventListener("MSPointerMove","handleTouchmove",a,this),Ub.addEventListener("MSPointerUp","handleTouchend",a,this),Ub.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("MSPointerDown",a,this),Ub.removeEventListener("MSPointerMove",a,this),Ub.removeEventListener("MSPointerUp",a,this),Ub.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY},Bc.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20?(Bc.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Ub.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c);var e=this.network.getSelectionModel();d?Hb.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Hb.isCtrlDown(a)||e.clearSelection()}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint()}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var f=-1,g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._startTouchPoint=null,this._moveTouchPoint=null},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(!(Rb.getDistance(this._startClientPoint,b)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint(a);if(!c)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:a}:{kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}}else{var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}this._startClientPoint=b}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}}});var Pd=function(a,b){Hb.registerImage(a,b),Qd[a]=1},Qd={};Pd("node_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,23.5c0,0.276-0.224,0.5-0.5,0.5h-31C0.224,24,0,23.776,0,23.5v-2C0,21.224,0.224,21,0.5,21h31  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"15.9995",y1:"21",x2:"15.9995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,22.3c0-0.165-0.134-0.3-0.3-0.3H3.3C3.134,22,3,22.135,3,22.3V24h12V22.3z",gradient:{id:"SVGID_2_",type:"linear",x1:"9",y1:"22",x2:"9",y2:"25",stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"}]}},{shape:"path",data:"M31,20H1V1c0-0.553,0.448-1,1-1h28c0.553,0,1,0.447,1,1V20z",gradient:{id:"SVGID_3_",type:"linear",x1:"15.9995",y1:"-0.1221",x2:"15.9995",y2:"19.9471",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:1,w:28,h:18,fill:"#FFFFFF"},{shape:"rect",x:3,y:2,w:26,h:16,gradient:{id:"SVGID_4_",type:"linear",x1:"15.9995",y1:"2.0654",x2:"15.9995",y2:"17.3835",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"9.649,17.034 6.815,17.034 9.935,2.966 12.768,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"12.065,17.034 10.815,17.034 13.935,2.966 15.185,2.966 z",fill:"#FFFFFF"},{shape:"path",data:"14.065,17.034 13.315,17.034 16.435,2.966 17.185,2.966 z",fill:"#FFFFFF"}]}),Pd("group_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,16.5c0,0.276-0.224,0.5-0.5,0.5h-24C7.224,17,7,16.776,7,16.5v-1C7,15.224,7.224,15,7.5,15h24   c0.276,0,0.5,0.224,0.5,0.5V16.5z",gradient:{id:"SVGID_1_",type:"linear",x1:"19.5",y1:"15",x2:"19.5",y2:"17",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M19,16.5c0-0.277-0.224-0.5-0.5-0.5h-8c-0.276,0-0.5,0.223-0.5,0.5V17h9V16.5z",gradient:{id:"SVGID_2_",type:"linear",x1:"14.4995",y1:"15.9209",x2:"14.4995",y2:"17.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,14H8V1c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V14z",gradient:{id:"SVGID_3_",type:"linear",x1:"19.5",y1:"0",x2:"19.5",y2:"14.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:1,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:10,y:2,w:19,h:10,gradient:{id:"SVGID_4_",type:"linear",x1:"19.5",y1:"1.9619",x2:"19.5",y2:"11.9744",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M25,23.5c0,0.276-0.224,0.5-0.5,0.5h-24C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h24   c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:"12.4995",y1:"22",x2:"12.4995",y2:"24",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,23.5c0-0.277-0.224-0.5-0.5-0.5h-8C3.224,23,3,23.223,3,23.5V24h9V23.5z",gradient:{id:"SVGID_6_",type:"linear",x1:"7.5",y1:"22.9209",x2:"7.5",y2:"24.0459",stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M24,21H1V8c0-0.553,0.448-1,1-1h21c0.553,0,1,0.447,1,1V21z",gradient:{id:"SVGID_7_",type:"linear",x1:"12.4995",y1:"7",x2:"12.4995",y2:"21.0005",stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:8,w:21,h:12,fill:"#FFFFFF"},{shape:"rect",x:3,y:9,w:19,h:10,gradient:{id:"SVGID_8_",type:"linear",x1:"12.4995",y1:"8.9619",x2:"12.4995",y2:"18.9749",stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}}]}),Pd("subnetwork_image",{w:32,h:24,origin:{x:0,y:0},v:[{shape:"path",data:"M32,14.499c0,0.276-0.224,0.5-0.5,0.5h-20c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h20c0.276,0,0.5,0.224,0.5,0.5V14.499z",gradient:{id:"SVGID_1_",type:"linear",x1:21.5,y1:12.999,x2:21.5,y2:14.9995,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M22,14.499c0-0.277-0.224-0.5-0.5-0.5h-7c-0.276,0-0.5,0.223-0.5,0.5v0.5h8V14.499z",gradient:{id:"SVGID_2_",type:"linear",x1:18,y1:13.9199,x2:18,y2:15.0449,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M31,11.499c0,0.276-0.224,0.5-0.5,0.5h-18c-0.276,0-0.5-0.224-0.5-0.5v-11c0-0.276,0.224-0.5,0.5-0.5  h18c0.276,0,0.5,0.224,0.5,0.5V11.499z",gradient:{id:"SVGID_3_",type:"linear",x1:21.5,y1:-.9502,x2:21.5,y2:12.5498,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:13,y:.999,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:14,y:1.999,w:15,h:8,gradient:{id:"SVGID_4_",type:"linear",x1:21.5,y1:1.9312,x2:21.5,y2:9.6537,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M21,23.5c0,0.276-0.224,0.5-0.5,0.5h-20C0.224,24,0,23.776,0,23.5v-1C0,22.224,0.224,22,0.5,22h20  c0.276,0,0.5,0.224,0.5,0.5V23.5z",gradient:{id:"SVGID_5_",type:"linear",x1:10.4995,y1:22,x2:10.4995,y2:24,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:22,y:20.5,w:3,h:1.999,gradient:{id:"SVGID_6_",type:"linear",x1:-464.9424,y1:-722.2754,x2:-462.9424,y2:-722.2754,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:28,y:16,w:2,h:3,gradient:{id:"SVGID_7_",type:"linear",x1:29,y1:16,x2:29,y2:19,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M11,23.5c0-0.277-0.224-0.5-0.5-0.5h-7C3.224,23,3,23.223,3,23.5V24h8V23.5z",gradient:{id:"SVGID_8_",type:"linear",x1:7,y1:22.9209,x2:7,y2:24.0459,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M20,20.5c0,0.276-0.224,0.5-0.5,0.5h-18C1.224,21,1,20.776,1,20.5v-11C1,9.224,1.224,9,1.5,9h18  C19.776,9,20,9.224,20,9.5V20.5z",gradient:{id:"SVGID_9_",type:"linear",x1:10.4995,y1:8.0508,x2:10.4995,y2:21.5513,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:10,w:17,h:10,fill:"#FFFFFF"},{shape:"rect",x:3,y:11,w:15,h:8,gradient:{id:"SVGID_10_",type:"linear",x1:10.4995,y1:10.9321,x2:10.4995,y2:18.6551,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#0089C1"}]}},{shape:"path",data:"M32,22.7c0,0.165-0.135,0.3-0.301,0.3h-5.4C26.134,23,26,22.865,26,22.7v-2.4  c0-0.165,0.134-0.3,0.299-0.3h5.4C31.865,20,32,20.135,32,20.3V22.7z",gradient:{id:"SVGID_11_",type:"linear",x1:29,y1:20,x2:29,y2:23,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Pd("bus_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:4,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M7,4c0,0.552-0.448,1-1,1H3C2.448,5,2,4.552,2,4V3c0-0.552,0.448-1,1-1h3c0.552,0,1,0.448,1,1V4z",gradient:{id:"SVGID_1_",type:"linear",x1:4.5,y1:2,x2:4.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:3,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M6,5.5C6,5.776,5.776,6,5.5,6h-2C3.224,6,3,5.776,3,5.5l0,0C3,5.224,3.224,5,3.5,5h2  C5.776,5,6,5.224,6,5.5L6,5.5z",gradient:{id:"SVGID_2_",type:"linear",x1:4.5,y1:6,x2:4.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:12,y:6,w:1,h:1,fill:"#232424"},{shape:"path",data:"M15,4c0,0.552-0.447,1-1,1h-3c-0.553,0-1-0.448-1-1V3c0-0.552,0.447-1,1-1h3c0.553,0,1,0.448,1,1V4z",gradient:{id:"SVGID_3_",type:"linear",x1:12.5,y1:2,x2:12.5,y2:5,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#232424"},{shape:"rect",x:11,y:3,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M14,5.5C14,5.776,13.777,6,13.5,6h-2C11.225,6,11,5.776,11,5.5l0,0C11,5.224,11.225,5,11.5,5h2  C13.777,5,14,5.224,14,5.5L14,5.5z",gradient:{id:"SVGID_4_",type:"linear",x1:12.5,y1:6,x2:12.5,y2:5,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:10,w:1,h:1,fill:"#232424"},{shape:"path",data:"M6,13c0-0.553,0.448-1,1-1h3c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V13z",gradient:{id:"SVGID_5_",type:"linear",x1:-1428.3853,y1:-571.5747,x2:-1428.3853,y2:-568.5747,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#232424"},{shape:"rect",x:7,y:13,w:3,h:1,fill:"#FFFFFF"},{shape:"path",data:"M7,11.5C7,11.223,7.224,11,7.5,11h2c0.277,0,0.5,0.223,0.5,0.5l0,0c0,0.275-0.223,0.5-0.5,0.5h-2  C7.224,12,7,11.775,7,11.5L7,11.5z",gradient:{id:"SVGID_6_",type:"linear",x1:-1428.3862,y1:-567.5737,x2:-1428.3862,y2:-568.5737,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,7.5C15,7.776,14.777,8,14.5,8h-12C2.224,8,2,7.776,2,7.5l0,0C2,7.224,2.224,7,2.5,7h12  C14.777,7,15,7.224,15,7.5L15,7.5z",gradient:{id:"SVGID_7_",type:"linear",x1:8.4995,y1:6.1152,x2:8.4995,y2:7.5558,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M15,9.5c0,0.275-0.223,0.5-0.5,0.5h-12C2.224,10,2,9.775,2,9.5l0,0C2,9.223,2.224,9,2.5,9h12  C14.777,9,15,9.223,15,9.5L15,9.5z",gradient:{id:"SVGID_8_",type:"linear",x1:8.4995,y1:8.1147,x2:8.4995,y2:9.556,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]}),Pd("data_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,12c0,0.553-0.447,1-1,1H7c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12   z",gradient:{id:"SVGID_1_",type:"linear",x1:10.5,y1:6.959,x2:10.5,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:7,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:8,y:9,w:5,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:10.5,y1:8.6997,x2:10.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M15,14.5c0,0.275-0.225,0.5-0.5,0.5h-8C6.224,15,6,14.775,6,14.5l0,0C6,14.223,6.224,14,6.5,14h8   C14.775,14,15,14.223,15,14.5L15,14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:10.5,y1:13.125,x2:10.5,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:14,w:1,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:14.0049,x2:8.4995,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,4H6c0,0-0.152-0.275-0.5-1C5.021,2,5.021,2,4,2C3.057,2,2,2,2,2C1.448,2,1,2.448,1,3v8  c0,0.553,0.448,1,1,1h3v-1H2V3h2.387l1.024,1.998L12,5v1h1V5C13,4.448,12.553,4,12,4z",gradient:{id:"SVGID_5_",type:"linear",x1:6.9995,y1:2.0527,x2:6.9995,y2:11.4757,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M12,5L5.411,4.998L4.387,3H2v8h3v-0.645V7.254V7c0-0.552,0.448-1,1-1h0.324h3.032H12V5z",gradient:{id:"SVGID_6_",type:"linear",x1:6.9995,y1:2.9902,x2:6.9995,y2:11.0032,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Pd("grid_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,14c0,0.553-0.447,1-1,1H3c-0.552,0-1-0.447-1-1V3c0-0.552,0.448-1,1-1h11c0.553,0,1,0.448,1,1V14  z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:2.1255,x2:8.4995,y2:14.909,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:3,w:11,h:11,fill:"#FFFFFF"},{shape:"rect",x:3,y:5,w:11,h:1,gradient:{id:"SVGID_2_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:8,w:11,h:1,gradient:{id:"SVGID_3_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8043,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:3,y:11,w:11,h:1,gradient:{id:"SVGID_4_",type:"linear",x1:8.4995,y1:3.2095,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:11,y:3,w:1,h:11,gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:3.209,x2:11.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:8,y:3,w:1,h:11,gradient:{id:"SVGID_6_",type:"linear",x1:8.4995,y1:3.209,x2:8.4995,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"rect",x:5,y:3,w:1,h:11,gradient:{id:"SVGID_7_",type:"linear",x1:5.5,y1:3.209,x2:5.5,y2:13.8048,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Pd("databox_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,6h-12H2v0.5v7C2,13.776,2.224,14,2.5,14h12c0.276,0,0.5-0.224,0.5-0.5v-7V6H14.5z",gradient:{id:"SVGID_1_",type:"linear",x1:8.4995,y1:6.0625,x2:8.4995,y2:14.063,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M14.776,5.553l-1.553-3.105C13.101,2.201,12.775,2,12.5,2h-8C4.225,2,3.899,2.201,3.776,2.447  L2.224,5.553L2,6h0.5h12H15L14.776,5.553z",gradient:{id:"SVGID_2_",type:"linear",x1:8.5005,y1:3.104,x2:8.5005,y2:-5.6467,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"12,2 9.5,2 7.5,2 5,2 3,6 7.5,6 9.5,6 14,6 z",gradient:{id:"SVGID_3_",type:"linear",x1:8.5005,y1:9.2295,x2:8.5005,y2:5.4586,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M11.5,9c0,0.276-0.224,0.5-0.5,0.5H6C5.724,9.5,5.5,9.276,5.5,9l0,0c0-0.276,0.224-0.5,0.5-0.5h5  C11.276,8.5,11.5,8.724,11.5,9L11.5,9z",fill:"#FFFFFF"}]}),Pd("group_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,8.5C15,8.776,14.776,9,14.5,9h-10C4.224,9,4,8.776,4,8.5v-7C4,1.224,4.224,1,4.5,1h10    C14.776,1,15,1.224,15,1.5V8.5z",gradient:{id:"SVGID_1_",type:"linear",x1:9.5,y1:.9512,x2:9.5,y2:8.9787,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:5,y:2,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:6,y:3,w:7,h:4,gradient:{id:"SVGID_2_",type:"linear",x1:9.5,y1:3.02,x2:9.5,y2:6.9606,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,10.5c0,0.276-0.224,0.5-0.5,0.5h-12C3.224,11,3,10.776,3,10.5l0,0C3,10.224,3.224,10,3.5,10h12    C15.776,10,16,10.224,16,10.5L16,10.5z",gradient:{id:"SVGID_3_",type:"linear",x1:9.5,y1:9.9941,x2:9.5,y2:10.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:6,y:10.001,w:2,h:.999,gradient:{id:"SVGID_4_",type:"linear",x1:7,y1:10.0059,x2:7,y2:10.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M12,12.5c0,0.276-0.224,0.5-0.5,0.5h-10C1.224,13,1,12.776,1,12.5v-7C1,5.224,1.224,5,1.5,5h10    C11.776,5,12,5.224,12,5.5V12.5z",gradient:{id:"SVGID_5_",type:"linear",x1:6.4995,y1:4.9512,x2:6.4995,y2:12.9792,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:6,w:9,h:6,fill:"#FFFFFF"},{shape:"rect",x:3,y:7,w:7,h:4,gradient:{id:"SVGID_6_",type:"linear",x1:6.4995,y1:7.02,x2:6.4995,y2:10.9611,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M13,14.5c0,0.276-0.224,0.5-0.5,0.5h-12C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h12    C12.776,14,13,14.224,13,14.5L13,14.5z",gradient:{id:"SVGID_7_",type:"linear",x1:6.4995,y1:13.9941,x2:6.4995,y2:14.9976,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:3,y:14.001,w:2,h:.999,gradient:{id:"SVGID_8_",type:"linear",x1:4,y1:14.0059,x2:4,y2:14.9472,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}}]}),Pd("link_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:2.5,y:2.5},p2:{x:13.5,y:13.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:11.5371,y1:11.5371,x2:14.2155,y2:14.2155,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:3,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:1.4956,y1:1.4956,x2:4.1473,y2:4.1473,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:3,cy:3,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("linksubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",
data:"M15,7.661c0-1.202-0.642-2.247-1.596-2.835C12.848,3.188,11.314,2,9.486,2  c-1.587,0-2.95,0.902-3.649,2.211C4.573,4.22,3.548,5.194,3.438,6.432C3.389,6.429,3.342,6.417,3.292,6.417  C2.026,6.417,1,7.443,1,8.708C1,9.975,2.026,11,3.292,11h8.371l0,0C13.506,11,15,9.506,15,7.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.959,x2:7.9995,y2:11.0921,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,10C2.58,10,2,9.42,2,8.708c0-0.712,0.58-1.292,1.292-1.292C3.286,7.422,3.332,7.427,3.379,7.43  l0.969,0.058L4.435,6.52C4.5,5.779,5.106,5.216,5.844,5.211l0.595-0.004l0.28-0.524C7.273,3.645,8.334,3,9.486,3  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,6.11,14,6.851,14,7.661C14,8.951,12.951,10,11.661,10H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.292,10h8.37c1.11,0,2.04-0.781,2.276-1.821c-0.131-0.615-0.5-1.158-1.058-1.501l-0.307-0.189  l-0.116-0.341C12.021,4.863,10.828,4,9.486,4C8.334,4,7.273,4.645,6.719,5.682l-0.28,0.524L5.844,6.211  C5.106,6.216,4.5,6.779,4.435,7.52L4.349,8.487L3.379,8.43C3.332,8.427,3.286,8.422,3.292,8.417c-0.535,0-0.994,0.328-1.19,0.792  C2.297,9.672,2.757,10,3.292,10z",gradient:{id:"SVGID_2_",type:"linear",x1:8.019,y1:4.084,x2:8.019,y2:9.8062,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"line",p1:{x:8.01,y:8.01},p2:{x:13.186,y:13.186},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:8,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:6.7881,y1:6.7881,x2:9.9924,y2:9.9924,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:8,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:13,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:11.5791,y1:11.5791,x2:14.3132,y2:14.3132,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:13,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("node_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,11.5c0,0.276-0.224,0.5-0.5,0.5h-13C1.224,12,1,11.776,1,11.5v-9C1,2.224,1.224,2,1.5,2h13  C14.776,2,15,2.224,15,2.5V11.5z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.939,x2:7.9995,y2:11.9739,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:3,w:12,h:8,fill:"#FFFFFF"},{shape:"rect",x:3,y:4,w:10,h:6,gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:4.0513,x2:7.9995,y2:9.865,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.5c0,0.276-0.224,0.5-0.5,0.5h-15C0.224,15,0,14.776,0,14.5v-1C0,13.224,0.224,13,0.5,13h15  c0.276,0,0.5,0.224,0.5,0.5V14.5z",gradient:{id:"SVGID_3_",type:"linear",x1:7.9995,y1:13.0508,x2:7.9995,y2:14.9258,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M9,14.5C9,14.224,8.776,14,8.5,14h-5C3.224,14,3,14.224,3,14.5V15h6V14.5z",gradient:{id:"SVGID_4_",type:"linear",x1:5.9995,y1:14.0508,x2:5.9995,y2:15.9258,stop:[{offset:"0",color:"#69B4A5"},{offset:"0.1",color:"#61AD9C"},{offset:"0.4637",color:"#449981"},{offset:"0.7764",color:"#2C8E73"},{offset:"1",color:"#218A6E"}]}}]}),Pd("shapelink_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"line",p1:{x:7.5,y:2.5},p2:{x:2.5,y:7.5},lineColor:"url(#SVGID_1_)",lineWidth:1},{shape:"line",p1:{x:2.5,y:7.5},p2:{x:8.5,y:13.5},lineColor:"url(#SVGID_2_)",lineWidth:1},{shape:"line",p1:{x:9,y:13.186},p2:{x:13.5,y:6.5},lineColor:"url(#SVGID_3_)",lineWidth:1},{shape:"ellipse",cx:7,cy:3,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:5.5864,y1:1.5864,x2:8.4149,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:7,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5864,y1:6.5864,x2:3.4142,y2:9.4142,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:8,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:6.5869,y1:11.5869,x2:9.4147,y2:14.4147,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:8,cy:13,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:7,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:11.5859,y1:5.5859,x2:14.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:7,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("shapenode_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M14.5,3h-9l-4,4v7h13L9,8.5L14.5,3z M12.086,13H2.5V7.414L5.914,4h6.172l-4.5,4.5L12.086,13z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:3.209,x2:7.9995,y2:13.6621,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:6,cy:3,rx:2,ry:2,gradient:{id:"SVGID_2_",type:"linear",x1:4.5859,y1:1.5859,x2:7.4151,y2:4.4151,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:6,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:13,cy:3,rx:2,ry:2,gradient:{id:"SVGID_3_",type:"linear",x1:11.5869,y1:1.5864,x2:14.4153,y2:4.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:13,cy:3,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:9,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:7.5864,y1:6.5864,x2:10.4149,y2:9.4149,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:9,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:2,cy:7,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:.5859,y1:5.5859,x2:3.4144,y2:8.4144,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:2,cy:7,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12.825,cy:13,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:11.4111,y1:11.5869,x2:14.2396,y2:14.4153,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"ellipse",cx:12.825,cy:13,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("shapesubnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"path",data:"M15,6.661c0-1.202-0.642-2.247-1.596-2.835C12.848,2.188,11.314,1,9.486,1  c-1.587,0-2.95,0.902-3.649,2.211C4.573,3.22,3.548,4.194,3.438,5.432C3.389,5.429,3.342,5.417,3.292,5.417  C2.026,5.417,1,6.443,1,7.708S2.026,10,3.292,10h8.371l0,0C13.506,10,15,8.505,15,6.661z",gradient:{id:"SVGID_1_",type:"linear",x1:7.9995,y1:1.3755,x2:7.9995,y2:9.733,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"M3.292,9C2.58,9,2,8.42,2,7.708s0.58-1.292,1.292-1.292C3.286,6.422,3.332,6.427,3.379,6.43l0.969,0.058  L4.435,5.52C4.5,4.779,5.106,4.216,5.844,4.211l0.595-0.004l0.28-0.524C7.273,2.645,8.334,2,9.486,2  c1.342,0,2.535,0.863,2.971,2.147l0.116,0.341l0.307,0.189C13.581,5.11,14,5.851,14,6.661C14,7.951,12.951,9,11.661,9H3.292z",fill:"#FFFFFF"},{shape:"path",data:"M3.272,9h8.37c1.11,0,2.039-0.689,2.275-1.729c-0.131-0.615-0.499-1.249-1.057-1.593l-0.307-0.189  l-0.116-0.341C12.002,3.863,10.809,3,9.468,3C8.314,3,7.254,3.645,6.7,4.682L6.42,5.207L5.825,5.211  C5.087,5.216,4.481,5.779,4.416,6.52L4.33,7.487L3.36,7.43C3.313,7.427,3.267,7.422,3.272,7.417c-0.535,0-0.994,0.327-1.19,0.792  C2.278,8.672,2.738,9,3.272,9z",gradient:{id:"SVGID_2_",type:"linear",x1:7.9995,y1:3.459,x2:7.9995,y2:8.4597,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M11.516,7.102h-8l2.469,6h8.5L11.516,7.102z M5.024,8.123h5.905l1.938,3.979H6.662L5.024,8.123z",gradient:{id:"SVGID_3_",type:"linear",x1:7.4443,y1:7.1724,x2:10.1111,y2:12.8383,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"path",data:"5,8.112 10.904,8.112 12.842,12.092 6.638,12.092 z",fill:"#FFFFFF"},{shape:"ellipse",cx:5,cy:8,rx:2,ry:2,gradient:{id:"SVGID_4_",type:"linear",x1:3,y1:8,x2:7,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:5,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:12,cy:8,rx:2,ry:2,gradient:{id:"SVGID_5_",type:"linear",x1:10,y1:8,x2:14,y2:8,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:12,cy:8,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:7,cy:12,rx:2,ry:2,gradient:{id:"SVGID_6_",type:"linear",x1:5,y1:12,x2:9,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:7,cy:12,rx:1,ry:1,fill:"#FFFFFF"},{shape:"ellipse",cx:14,cy:12,rx:2,ry:2,gradient:{id:"SVGID_7_",type:"linear",x1:12,y1:12,x2:16,y2:12,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"ellipse",cx:14,cy:12,rx:1,ry:1,fill:"#FFFFFF"}]}),Pd("subnetwork_icon",{w:16,h:16,origin:{x:0,y:0},v:[{shape:"rect",x:10,y:14.001,w:2,h:1,gradient:{id:"SVGID_1_",type:"linear",x1:11,y1:14.0059,x2:11,y2:14.9481,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"rect",x:14,y:10.001,w:1,h:2,gradient:{id:"SVGID_2_",type:"linear",x1:14.5,y1:10.0117,x2:14.5,y2:11.8962,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,6.001c0,0.552-0.447,1-1,1H8c-0.552,0-1-0.448-1-1v-4c0-0.552,0.448-1,1-1h7   c0.553,0,1,0.448,1,1V6.001z",gradient:{id:"SVGID_3_",type:"linear",x1:11.5,y1:.96,x2:11.5,y2:6.2265,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:8,y:2.001,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:9,y:3.001,w:5,h:2,gradient:{id:"SVGID_4_",type:"linear",x1:11.5,y1:2.7007,x2:11.5,y2:5.0337,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M16,8.501c0,0.276-0.225,0.5-0.5,0.5h-8c-0.276,0-0.5-0.224-0.5-0.5l0,0c0-0.276,0.224-0.5,0.5-0.5   h8C15.775,8.001,16,8.225,16,8.501L16,8.501z",gradient:{id:"SVGID_5_",type:"linear",x1:11.5,y1:7.126,x2:11.5,y2:8.5535,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:9,y:8.001,w:1,h:.999,gradient:{id:"SVGID_6_",type:"linear",x1:9.5,y1:8.0063,x2:9.5,y2:8.9477,stop:[{offset:"0",color:"#58AC9A"},{offset:"1",color:"#248576"}]}},{shape:"path",data:"M9,12c0,0.553-0.447,1-1,1H1c-0.552,0-1-0.447-1-1V8c0-0.552,0.448-1,1-1h7c0.553,0,1,0.448,1,1V12z   ",gradient:{id:"SVGID_7_",type:"linear",x1:4.4995,y1:6.959,x2:4.4995,y2:12.2259,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:1,y:8,w:7,h:4,fill:"#FFFFFF"},{shape:"rect",x:2,y:9,w:5,h:2,gradient:{id:"SVGID_8_",type:"linear",x1:4.5,y1:8.6997,x2:4.5,y2:11.0333,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M9,14.5C9,14.776,8.775,15,8.5,15h-8C0.224,15,0,14.776,0,14.5l0,0C0,14.224,0.224,14,0.5,14h8   C8.775,14,9,14.224,9,14.5L9,14.5z",gradient:{id:"SVGID_9_",type:"linear",x1:4.4995,y1:13.125,x2:4.4995,y2:14.5518,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}},{shape:"rect",x:2,y:14,w:1,h:1,gradient:{id:"SVGID_10_",type:"linear",x1:2.5,y1:14.0049,x2:2.5,y2:14.9471,stop:[{offset:"0",color:"#61B7D9"},{offset:"1",color:"#005EAD"}]}},{shape:"path",data:"M16,14.501c0,0.276-0.224,0.5-0.5,0.5h-2c-0.276,0-0.5-0.224-0.5-0.5v-1c0-0.276,0.224-0.5,0.5-0.5  h2c0.276,0,0.5,0.224,0.5,0.5V14.501z",gradient:{id:"SVGID_11_",type:"linear",x1:14.5,y1:13.0117,x2:14.5,y2:14.8962,stop:[{offset:"0",color:"#666767"},{offset:"1",color:"#232424"}]}}]});var Od={_hitCanvas:null,getHitCanvas:function(a,b){null==this._hitCanvas&&(this._hitCanvas=Ub.createCanvas()),0==arguments.length&&(a=2,b=2),this._hitCanvas.setAttribute("width",""+a-1),this._hitCanvas.setAttribute("height",""+b-1),this._hitCanvas.setAttribute("width",""+a),this._hitCanvas.setAttribute("height",""+b);var c=this.getCtx(this._hitCanvas);return c.clearRect(0,0,a,b),this._hitCanvas},disposeHitCanvas:function(){this._hitCanvas=null},getCtx:function(a){return a.getContext("2d")},render:function(a,b,c){void 0!=b&&(a.fillStyle=b,a.fill()),void 0!=c&&(a.strokeStyle=c,a.stroke())},text:function(a,b,c,d,e,f){a.textAlign="center",a.textBaseline="middle",null!=e&&(a.fillStyle=e,a.fillText(b,c,d)),f&&(a.strokeStyle=f,a.strokeText(b,c,d))},circle:function(a,b,c,d,e,f){a.arc(b,c,d,0,2*Math.PI,!0),a.closePath(),this.render(a,e,f)},rect:function(a,b,c,d,e,f,g){a.rect(b,c,d,e),a.closePath(),this.render(a,f,g)},OUT_LEFT:1,OUT_TOP:2,OUT_RIGHT:4,OUT_BOTTOM:8,outcode:function(a,b,c,d,e,f){var g=0;return 0>=e?g|=this.OUT_LEFT|this.OUT_RIGHT:c>a?g|=this.OUT_LEFT:a>c+e&&(g|=this.OUT_RIGHT),0>=f?g|=this.OUT_TOP|this.OUT_BOTTOM:d>b?g|=this.OUT_TOP:b>d+f&&(g|=this.OUT_BOTTOM),g},intersectsLine:function(a,b,c,d,e,f,g,h){var i,j;if(0==(j=this.outcode(c,d,e,f,g,h)))return!0;for(;0!=(i=this.outcode(a,b,e,f,g,h));){if(0!=(i&j))return!1;if(0!=(i&(this.OUT_LEFT|this.OUT_RIGHT))){var k=e;0!=(i&this.OUT_RIGHT)&&(k+=g),b+=(k-a)*(d-b)/(c-a),a=k}else{var l=f;0!=(i&this.OUT_BOTTOM)&&(l+=h),a+=(l-b)*(c-a)/(d-b),b=l}}return!0}};Gb.vector={},Gb.vector.interaction={},Gb.vector.Network=function(a){Gb.vector.Network.superClass.constructor.apply(this,arguments),this.zoomManager=new Gb.vector.PhysicalZoomManager(this),this._view=Ub.createView("hidden"),this._rootCanvas=Ub.createCanvas(),this._topCanvas=Ub.createCanvas(),this._view.appendChild(this._rootCanvas),this._view.appendChild(this._topCanvas),this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0},this._zoom=1,this._elementUIMap={},this._zoomMap={},this._viewRectMap={},this.viewRect={x:0,y:0,width:0,height:0},this.state={zooming:!1,panning:!1,autoLayout:!1},this.hScrollBarVisible=!1,this.vScrollBarVisible=!1,this.markerList=new Gb.List,this._topAttachmentList=new Gb.List,this._hitTestTopAttachmentList=new Gb.List,this.setElementBox(a?a:new Gb.ElementBox),Ob.isTouchable?Ob.isMSTouchable?this.setDefaultInteractions(!1,!1):this.setTouchInteractions():this.setDefaultInteractions(!1,!1);var b=this;this._flowLink=function(){if(!(b.isMovingElement()||b.isSelectingElement()||b.isEditingElement()||b._box._layoutMovingElements)){b._flowLinkQuickFinder||(b._flowLinkQuickFinder=new Gb.QuickFinder(b._box,"link.flow","style"));var a=b._flowLinkQuickFinder.find(!0);a.forEach(function(a){a._styleMap["link.flow.offset"]=b.getLinkFlowOffset(a),b.invalidateElementUI(a)})}},this.setToolTipEnabled(Gb.Defaults.NETWORK_TOOLTIP_ENABLED),this._paintAll=!0,this._dirtyRects=new md,this._invalidateMap={},this._invalidateAll=!0,b._count=0,b._invalidate=!0,function c(a){b._loopId=requestAnimationFrame(c),b._invalidate&&(b._count++,b._now=a,b.validate())}(0),Gb.imageUtil.addEventListener(this.invalidateElementUIs,this),Ub.addEventListener("mousemove","handle_mousemove",this._view,this)},Hb.ext("twaver.vector.Network",Gb.controls.View,{__accessor:["selectMode","makeVisibleOnSelected","movableFunction","editPointSize","editPointFillColor","scrollBarWidth","editPointOutlineWidth","editPointOutlineColor","editLineColor","editLineWidth","resizePointSize","resizePointFillColor","resizePointOutlineWidth","resizePointOutlineColor","resizeLineColor","resizeLineWidth","rotatePointSize","rotatePointFillColor","rotatePointOffset","rotatePointOutlineWidth","rotatePointOutlineColor","rotateScaleFillColor","rotateScaleFontColor","rotateScaleWidth","rotateScaleHeight","selectOutlineColor","selectOutlineWidth","selectFillColor","lazyMoveOutlineColor","lazyMoveOutlineWidth","lazyMoveFillColor","rectSelectFilter","selectionTolerance"],__bool:["doubleClickToUpSubNetwork","doubleClickToSubNetwork","doubleClickToEmptySubNetwork","doubleClickToLinkBundle","doubleClickToGroupExpand","scrollBarVisible","limitViewInCanvas","autoValidateCanvasSize","subNetworkAnimate","lazyMoveAnimate","resizeAnimate","noAgentLinkVisible","keyboardRemoveEnabled","keyboardSelectEnabled","sendToTopOnSelected","lazyMoveFill","editingElement","rotatingElement","movingElement","selectingElement","rectSelectEnabled","limitElementInPositiveLocation","showRotateScale","transparentSelectionEnable","edgeDetect","dragToPan","wheelToZoom","asyncZoomAndViewRect","debug","zoomDivVisible","showShadowInEdit","showAttachOnChg"],_currentSubNetwork:null,_subNetworkAnimate:Gb.Defaults.NETWORK_SUBNETWORK_ANIMATE,_scrollBarWidth:10,_scrollBarVisible:!0,_limitViewInCanvas:!1,_autoValidateCanvasSize:!0,_makeVisibleOnSelected:Gb.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled:Gb.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled:Gb.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED,_rectSelectEnabled:Dd.NETWORK_RECT_SELECT_ENABLED,_rectSelectFilter:null,_elementUIFunction:Gb.Defaults.VECTORUI_FUNCTION,_doubleClickToUpSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK,_doubleClickToSubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK,_doubleClickToEmptySubNetwork:Gb.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK,_doubleClickToLinkBundle:Gb.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE,_doubleClickToGroupExpand:Gb.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND,_selectOutlineColor:Gb.Defaults.NETWORK_SELECT_OUTLINE_COLOR,_selectOutlineWidth:Gb.Defaults.NETWORK_SELECT_OUTLINE_WIDTH,_selectFillColor:Gb.Defaults.NETWORK_SELECT_FILL_COLOR,_sendToTopOnSelected:Gb.Defaults.NETWORK_SENDTOTOP_ON_SELECTED,_lazyMoveOutlineColor:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR,_lazyMoveOutlineWidth:Gb.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH,_lazyMoveFillColor:Gb.Defaults.NETWORK_LAZYMOVE_FILL_COLOR,_lazyMoveFill:Gb.Defaults.NETWORK_LAZYMOVE_FILL,_lazyMoveAnimate:Gb.Defaults.NETWORK_LAZYMOVE_ANIMATE,_resizePointSize:Gb.Defaults.NETWORK_RESIZE_POINT_SIZE,_resizePointFillColor:Gb.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR,_resizePointOutlineColor:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR,_resizePointOutlineWidth:Gb.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH,_resizeLineColor:Gb.Defaults.NETWORK_RESIZE_LINE_COLOR,_resizeLineWidth:Gb.Defaults.NETWORK_RESIZE_LINE_WIDTH,_resizeAnimate:Gb.Defaults.NETWORK_RESIZE_ANIMATE,_rotatePointSize:Gb.Defaults.NETWORK_ROTATE_POINT_SIZE,_rotatePointFillColor:Gb.Defaults.NETWORK_ROTATE_POINT_FILL_COLOR,_rotatePointOffset:Gb.Defaults.NETWORK_ROTATE_POINT_OFFSET,_rotatePointOutlineWidth:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_WIDTH,_rotatePointOutlineColor:Gb.Defaults.NETWORK_ROTATE_POINT_OUTLINE_COLOR,_rotateScaleWidth:Dd.NETWORK_ROTATE_SCALE_WIDTH,_rotateScaleHeight:Dd.NETWORK_ROTATE_SCALE_HEIGHT,_rotateScaleFillColor:Dd.NETWORK_ROTATE_SCALE_FILL_COLOR,_rotateScaleFontColor:Dd.NETWORK_ROTATE_SCALE_FONT_COLOR,_editPointSize:Gb.Defaults.NETWORK_EDIT_POINT_SIZE,_editPointFillColor:Gb.Defaults.NETWORK_EDIT_POINT_FILL_COLOR,_editPointOutlineColor:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR,_editPointOutlineWidth:Gb.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH,_editLineColor:Gb.Defaults.NETWORK_EDIT_LINE_COLOR,_editLineWidth:Gb.Defaults.NETWORK_EDIT_LINE_WIDTH,_limitElementInPositiveLocation:!1,_linkFlowInterval:Dd.NETWORK_LINK_FLOW_INTERVAL,_selectionTolerance:Dd.NETWORK_SELECTION_TOLERANCE,_invalidateViewRectFlag:!1,_repaintTopFlag:!1,_invalidateCanvasSizeFlag:!1,_isEditingElement:!1,_isRotatingElement:!1,_isMovingElement:!1,_isSelectingElement:!1,_hasEditInteraction:!1,_showRotateScale:!0,_transparentSelectionEnable:Gb.Defaults.NETWORK_TRANSPARENT_SELECTION_ENABLE,_edgeDetect:!1,_dragToPan:!0,_wheelToZoom:!0,_asyncZoomAndViewRect:!1,_debug:!1,_zoomDivVisible:!0,_showShadowInEdit:!1,_showAttachOnChg:!0,adjustBounds:function(a){var b=!1,c=this._view.style;if(c.left==a.x+"px"&&c.top==a.y+"px"&&c.width==a.width+"px"&&c.height==a.height+"px"&&(b=!0),Gb.vector.Network.superClass.adjustBounds.apply(this,arguments),1!=b){var d=this._view.offsetWidth,e=this._view.offsetHeight;this._rootCanvas.setAttribute("width",d),this._rootCanvas.setAttribute("height",e),this._topCanvas.setAttribute("width",d),this._topCanvas.setAttribute("height",e),this.setViewRect(this.viewRect.x,this.viewRect.y,d,e),"undefined"==typeof Gb.gis&&(Gb.Util.makeHighRes(this._rootCanvas),Gb.Util.makeHighRes(this._topCanvas)),this.invalidateElementVisibility()}},getLabel:function(a){return a.getStyle("network.label")||a.getName()},getLabel2:function(a){return a.getStyle("network.label")||a.getName2()},setZoomManager:function(a){var b=this.zoomManager;b!=a&&(this.zoomManager=a,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.validateCanvasSize(),this.invalidateElementUIs(),this.firePropertyChange("zoomManager",b,a))},getZoomManager:function(){return this.zoomManager},getRootCanvas:function(){return this._rootCanvas},getTopCanvas:function(){return this._topCanvas},validateImpl:function(){mc.twm(this);var a,b,c,d,e=this.getElementBox().getDatas()._as,f=e.length,g={},h=this._visibleFunction,i=1===this._box._layerBox.size()?this._box._layerBox._defaultLayer:null;for(a=0;f>a;a++)c=e[a],g[c._id]=this.isVisible(c,h,i);var j=this.getGraphicsZoom(),k=null,l={x:this.viewRect.x/j,y:this.viewRect.y/j,width:this.viewRect.width/j,height:this.viewRect.height/j};if(this._invalidateAll){if(this._visibleMap)for(a=0;f>a;a++)c=e[a],g[c._id]!==this._visibleMap[c._id]&&(d=this._elementUIMap[c._id],d&&d.invalidate());for(a=0;f>a;a++)c=e[a],d=this._elementUIMap[c._id],d&&d.validate();this._paintAll=!0}else if(this._paintAll){for(b in this._invalidateMap)d=this._elementUIMap[b],d&&d.invalidate();for(b in this._invalidateMap)d=this._elementUIMap[b],d&&d.validate()}else{for(b in this._invalidateMap)d=this._elementUIMap[b],d&&(this._dirtyRects.add(d.getZoomViewRect(!1)),d.invalidate());for(b in this._invalidateMap)d=this._elementUIMap[b],d&&(d.validate(),this._dirtyRects.add(d.getZoomViewRect(!0)))}this._paintAll?k=l:(this._dirtyRects.forEach(function(a){k=null==k?Hb.cloneRect(a):Rb.unionRect(k,a)}),k?(Rb.grow(k,2,2),k=Rb.intersection(k,l)):k=l),this._visibleMap=g,k&&this.paintRoot(k),this.validateCanvasSize(),1==this._repaintTopFlag&&(this._repaintTopFlag=!1,this.paintTopCanvas())},isLinkFlowEnabled:function(){return this._linkFlowEnabled?!0:!1},setLinkFlowEnabled:function(a){a?(this._linkFlowEnabled||(this._linkFlowEnabled=!0,this.firePropertyChange("linkFlowEnabled",!1,!0)),clearInterval(this._linkFlowTimerId),this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval)):(this._linkFlowEnabled&&(this._linkFlowEnabled=!1,this.firePropertyChange("linkFlowEnabled",!0,!1)),clearInterval(this._linkFlowTimerId),delete this._linkFlowTimerId)},getLinkFlowInterval:function(){return this._linkFlowInterval},setLinkFlowInterval:function(a){var b=this._linkFlowInterval;this._linkFlowInterval=a,this.firePropertyChange("linkFlowInterval",b,a),clearInterval(this._linkFlowTimerId),this.isLinkFlowEnabled()&&(this._linkFlowTimerId=setInterval(this._flowLink,this._linkFlowInterval))},getElementBox:function(){return this._box},setElementBox:function(a){if(!a)throw"ElementBox can not be null";if(this._box!==a){var b=this._box;b&&(b.removeDataBoxChangeListener(this.handleElementBoxChange,this),b.removeDataPropertyChangeListener(this.handleElementPropertyChange,this),b.removePropertyChangeListener(this.handleElementBoxPropertyChange,this),b.removeIndexChangeListener(this.handleIndexChange,this),b.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange,this),b.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange,this),b.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._selectionModel||b.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=a,this._box.addDataBoxChangeListener(this.handleElementBoxChange,this),this._box.addDataPropertyChangeListener(this.handleElementPropertyChange,this),this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange,this),this._box.addIndexChangeListener(this.handleIndexChange,this),this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange,this),this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange,this),this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange,this),this._flowLinkQuickFinder&&(this._flowLinkQuickFinder.dispose(),this._flowLinkQuickFinder=new Gb.QuickFinder(this._box,"link.flow","style")),this._selectionModel?this._selectionModel._setDataBox(a):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.firePropertyChange("elementBox",b,this._box)}},handleElementBoxChange:function(a){var b=a.data;if("add"===a.kind)this.createElementUI(b),this.invalidateBundleLink(b);else if("remove"===a.kind){var c=this.getElementUI(b);c&&(this._dirtyRects.add(c.getZoomViewRect()),c.dispose(),delete this._elementUIMap[b.getId()]),b===this._currentSubNetwork&&null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),delete this._invalidateMap[b._id]}else if("clear"===a.kind){for(var d in this._elementUIMap)this._elementUIMap[d]&&this._elementUIMap[d].dispose&&this._elementUIMap[d].dispose();this._elementUIMap={},null!=this._currentSubNetwork&&this._setCurrentSubNetwork(null),this._paintAll=!0}else"layoutEnd"===a.kind?this.state.layouting=!1:"layouting"===a.kind&&(this.state.layouting=!0);this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementPropertyChange:function(a){var b=a.source,c=this.getElementUI(b);c&&(this.invalidateElementUI(b),c.handlePropertyChange(a)),this.invalidateBundleLink(b),this.invalidateElementVisibility(),this.invalidateCanvasSize()},handleElementBoxPropertyChange:function(){this.invalidateElementVisibility()},handleIndexChange:function(a){this.invalidateElementVisibility()},handleLayerBoxChange:function(){this.invalidateElementVisibility()},handleLayerPropertyChange:function(a){"editable"===a.property&&this.invalidateSelectedElementUIs(!0),this.invalidateElementVisibility()},handleLayerHierarchyChange:function(){this.invalidateElementVisibility()},handleSelectionChange:function(a){var b=this.getSelectionModel().getLastData();b&&("append"===a.kind||"set"===a.kind)&&(this.isMakeVisibleOnSelected()&&this.makeVisible(b),this.isSendToTopOnSelected()&&this.sendToTop(b)),a.datas.forEach(function(b){var c=this.getElementUI(b);c&&c.handleSelectionChange(a),this.invalidateElementUI(b)},this),this.invalidateElementVisibility()},sendToTop:function(a){if(this._box.contains(a)){for(var b=a;b._parent&&this.isVisible(b._parent)&&(b=b._parent););b!==a&&this._box.adjustElementIndex(b),this._box.adjustElementIndex(a)}},getScopeRect:function(a){{var b=this.getGraphicsZoom();this.zoomManager}if("viewsize"===a)return{x:this._unionBounds.x-this.viewRect.x,y:this._unionBounds.y-this.viewRect.y,width:this._unionBounds.width,height:this._unionBounds.height};if("viewport"===a){if(this.viewRect)return Hb.cloneRect(this.viewRect)}else if("rootcanvas"===a)return{x:this.viewRect.x,y:this.viewRect.y,width:(Math.abs(this.viewRect.x-this._unionBounds.x)+this._unionBounds.width)*b,height:(Math.abs(this.viewRect.y-this._unionBounds.y)+this._unionBounds.height)*b};return{x:0,y:0,width:0,height:0}},getViewRect:function(){return this.viewRect?Hb.cloneRect(this.viewRect):{x:0,y:0,width:0,height:0}},getCanvasSize:function(){return{width:this.realWidth,height:this.realHeight}},setViewOffSet:function(a,b){var c=this.viewRect.x,d=this.viewRect.y,e=this.viewRect.width,f=this.viewRect.height;this.setViewRect(c+a,d+b,e,f)},setViewRect:function(a,b,c,d){1==this.isLimitViewInCanvas()&&(0>a&&(a=0),c>this.realWidth?a=0:a+c>this.realWidth&&(a=this.realWidth-c),0>b&&(b=0),d>this.realHeight?b=0:b+d>this.realHeight&&(b=this.realHeight-d));var e=this.viewRect;(null==this.viewRect||a!=this.viewRect.x||b!=this.viewRect.y||c!=this.viewRect.width||d!=this.viewRect.height)&&(this.viewRect={x:a,y:b,width:c,height:d},this.firePropertyChange("viewRect",e,this.viewRect),this.invalidateElementVisibility(),this._paintAll=!0)},isHScrollBarVisible:function(){return this.hScrollBarVisible},setHScrollBarVisible:function(a){this.hScrollBarVisible=a},isVScrollBarVisible:function(){return this.vScrollBarVisible},setVScrollBarVisible:function(a){this.vScrollBarVisible=a},setZoomVisibilityThresholds:function(a){var b=this._visibilityThresholds;this._zoomVisibilityThresholds=a,this.firePropertyChange("zoomVisibilityThresholds",b,a),this.invalidateElementVisibility()},getZoomVisibilityThresholds:function(){return this._zoomVisibilityThresholds||{}},invalidateElementVisibility:function(){this.invalidate()},repaintTopCanvas:function(){this._repaintTopFlag||(this._repaintTopFlag=!0,this.invalidate())},invalidateCanvasSize:function(a){this._invalidateCanvasSizeFlag||(this._invalidateCanvasSizeFlag=!0,this.invalidate())},validateCanvasSize:function(){0!=this._invalidateCanvasSizeFlag&&(this._invalidateCanvasSizeFlag=!1,this._validateCanvasSize())},_validateCanvasSize:function(){if(0==this.isAutoValidateCanvasSize())return this.realWidth=0,this.realHeight=0,void(this._unionBounds={x:0,y:0,width:0,height:0});var a,b=this.getElementBox().getDatas(),c=b.size();if(c>0){for(var d=0;c>d;d++){var e=b.get(d);if(this._visibleMap[e._id]){var f=this._elementUIMap[e._id];f&&(a=a?Rb.unionRect(a,f.getZoomViewRect(!0)):Hb.cloneRect(f.getZoomViewRect(!0)))}}null==a&&(a={x:0,y:0,width:0,height:0});var g=this.getGraphicsZoom();if(this._unionBounds={x:a.x*g,y:a.y*g,width:a.width*g,height:a.height*g},this.realWidth==(a.x+a.width)*g&&this.realHeight==(a.y+a.height)*g)return;this.realWidth=(a.x+a.width)*g,this.realHeight=(a.y+a.height)*g}else this.realWidth=0,this.realHeight=0,this._unionBounds={x:0,y:0,width:0,height:0};this.setViewRect(this.viewRect.x,this.viewRect.y,this.viewRect.width,this.viewRect.height),this.firePropertyChange("canvasSizeChange",null,this.viewRect)},getElementUI:function(a){return null==a?null:this._elementUIMap[a._id]},getUnionBounds:function(){return this._unionBounds},getZoomBodyRect:function(a){var b=this.getElementUI(a);return b?b.getZoomBodyRect():null},getShapeNodeZoomPoints:function(a,b){if(a._points){var c=this.getElementUI(a);if(c)return c._getZoomPoints()}return null},createElementUI:function(a){var b=this._elementUIMap[a.getId()];if(!b){if(b=this._elementUIFunction(this,a),!b){var c=a.getClassName(),d=c.substr(c.indexOf(".")+1)+"UI",e=Gb.vector[d];e&&(b=new e(this,a))}b&&(this._elementUIMap[a.getId()]=b)}return this._invalidateMap&&(this._invalidateMap[a._id]=a),b},getElementUIFunction:function(){return this._elementUIFunction},setElementUIFunction:function(a){if(!a)throw"ElementUIFunction can not be null";if(this._elementUIFunction!==a){var b=this._elementUIFunction;this._elementUIFunction=a,this.firePropertyChange("elementUIFunction",b,a),this._box.isEmpty()||(this._elementUIMap={},this._box.forEach(this.createElementUI,this),this.invalidateElementVisibility(),this.invalidateCanvasSize())}},invalidateElementUI:function(a,b){if(!this._invalidateAll){this._invalidateMap[a._id]=a;{this.getElementUI(a)}if(a instanceof Ld){var c=a.getAgentLinks();null!=c&&c.forEach(this.invalidateElementUI,this);var d=a.getParent();d instanceof Gb.Group&&this.invalidateElementUI(d)}this.invalidateElementVisibility()}},invalidateElementUIs:function(a){this._invalidateAll=!0,this._invalidateMap={},this._visibleMap={},this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.invalidate()},invalidateSelectedElementUIs:function(a){this.getSelectionModel().getSelection().forEach(function(b){this.invalidateElementUI(b,a)},this)},invalidateBundleLink:function(a){if(a instanceof Gb.Link&&a._bundleLinks){var b=this._elementUIMap;a._bundleLinks.forEachSiblingLink(function(c){if(c!==a){var d=b[c._id];d&&d.invalidate(!1)}},this)}},paintRoot:function(a){var b=this._rootCanvas.getContext("2d");b.save();var c=this.getGraphicsZoom();b.beginPath(),b.rect(Math.round(a.x*c-this.viewRect.x),Math.round(a.y*c-this.viewRect.y),Math.round(a.width*c),Math.round(a.height*c)),b.clip(),b.clearRect(Math.round(a.x*c-this.viewRect.x),Math.round(a.y*c-this.viewRect.y),Math.round(a.width*c),Math.round(a.height*c)),this.visibleList=new Gb.List,this._topAttachmentList=new Gb.List,kd.draw(b,this);var d=this.getElementBox().getDatas()._as,e=d.length,f=this.zoomManager;f._zoomGraphicsBegin(b),this.paintBottom(b,a);var g,h,i,j,k=this._box._layerBox,c=this.getGraphicsZoom(),l={x:this.viewRect.x/c,y:this.viewRect.y/c,width:this.viewRect.width/c,height:this.viewRect.height/c};if(this.adjustLinkIndex(),
1===k.size())for(g=0;e>g;g++)h=d[g],this._visibleMap[h._id]?(i=this._elementUIMap[h._id],this._debug&&Vb.strokeRect(b,a,"red"),null!=i&&this._isInView(i,a)&&(i.paint(b),i.setAttachmentVisible&&i.setAttachmentVisible(!0)),null!=i&&Rb.intersects(l,i.getZoomViewRect())?i.setAttachmentVisible&&i.setAttachmentVisible(!0):i.setAttachmentVisible&&i.setAttachmentVisible(!1),this.visibleList.add(h)):(i=this._elementUIMap[h._id],i&&i.setAttachmentVisible&&i.setAttachmentVisible(!1));else k.forEachByDepthFirst(function(c){for(g=0;e>g;g++)h=d[g],k.getLayerByElement(h)===c&&this._visibleMap[h._id]?(i=this._elementUIMap[h._id],null!=i&&this._isInView(i,a)&&(i.paint(b),i.setAttachmentVisible&&i.setAttachmentVisible(!0)),null!=i&&Rb.intersects(l,i.getZoomViewRect())?i.setAttachmentVisible&&i.setAttachmentVisible(!0):i.setAttachmentVisible&&i.setAttachmentVisible(!1),i&&i.validateZIndex&&i.validateZIndex(k.getDatas().indexOf(c)),this.visibleList.add(h)):i=this._elementUIMap[h._id]},null,this);for(e=this._topAttachmentList.size(),g=0;e>g;g++)j=this._topAttachmentList.get(g),j.getElementUI().paintAttachment(b,j);if(this.paintTop(b,a),void 0!==this._xyz){var e,m=this._xyz,n=m.markText,o=m.type,p=(m.expired,m.innerHTML),q=0,r=0,s=this.viewRect;b.translate(this.viewRect.x/this.getZoom(),this.viewRect.y/this.getZoom()),b.scale(1/this.getZoom(),1/this.getZoom());var c=this.getZoom();void 0!=n&&null!=n&&""!=n||"2"==o?(b.font="15px Arial sans-serif",e=Hb.g.getTextSize(b.font,p),b.fillStyle="red",q=s.width-e.width,r=s.height-20):(b.font="10px Arial sans-serif",e=Hb.g.getTextSize(b.font,p),q=s.width/2-e.width/2,r=s.height/2),b.fillText(p,q,r)}b.restore(),this._invalidateMap={},this._invalidateAll=!1,this._paintAll=!1,this._dirtyRects=new md},adjustLinkIndex:function(){var a,b,c=this._box.getDatas()._as,d=this.hasEditInteraction();if(d){for(this._hasAdjustedLinks=!1,i=c.length-1;i>-1;i--)if(a=c[i],a instanceof Gb.Link)if(this.isEditable(a)&&this.getElementUI(a).isEditable()&&this.isSelected(a))b=this._box.getDatas().indexOf(a),this._box.getDatas().removeAt(b),this._box.getDatas().add(a),this._hasAdjustedLinks=!0;else{var e=a.getToNode();b=this._box.getDatas().indexOf(e),this._box.getDatas().removeAt(b),this._box.getDatas().add(e);var f=a.getFromNode();b=this._box.getDatas().indexOf(f),this._box.getDatas().removeAt(b),this._box.getDatas().add(f)}}else if(this._hasAdjustedLinks){for(i=c.length-1;i>-1;i--)if(a=c[i],a instanceof Gb.Link){var e=a.getToNode();b=this._box.getDatas().indexOf(e),this._box.getDatas().removeAt(b),this._box.getDatas().add(e);var f=a.getFromNode();b=this._box.getDatas().indexOf(f),this._box.getDatas().removeAt(b),this._box.getDatas().add(f)}this._hasAdjustedLinks=!1}},paintBottom:function(a,b){},paintTop:function(a,b){},_isInView:function(a,b){return Rb.intersects(b,a.getZoomViewRect())},paintTopCanvas:function(){var a=this._topCanvas.getContext("2d");a.clearRect(0,0,this._topCanvas.width,this._topCanvas.height),this.paintMarker(a)},paintMarker:function(a){for(var b=this.markerList.size(),c=0;b>c;c++){var d=this.markerList.get(c);d.paint(a)}},getLayerByElement:function(a){return this._box.getLayerBox().getLayerByElement(a)},getLogicalPoint2:function(a){return this.zoomManager._getLogicalPoint(a)},getLogicalPoint:function(a){return this.zoomManager._getLogicalPoint(a,!0)},getElementAt:function(a){if(null==this.visibleList)return null;var b;if(a.target?b=this.getLogicalPoint2(a):a.event?a.event.target&&(b=this.getLogicalPoint2(a.event)):b=a,null!=this._hitTestTopAttachmentList)for(var c=this._hitTestTopAttachmentList.size(),d=c-1;d>=0;d--){var e=this._hitTestTopAttachmentList.get(d);if(e.hit(b.x,b.y))return e.getElement()}if(null!=this.visibleList)for(var f=this.visibleList.size(),g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);if(i&&i.hit(b.x,b.y))return h}return null},getElementsAt:function(a){var b=new Gb.List;if(null==this.visibleList)return null;var c;if(a.target?c=this.getLogicalPoint2(a):a.event?a.event.target&&(c=this.getLogicalPoint2(a.event)):c=a,null!=this._hitTestTopAttachmentList)for(var d=this._hitTestTopAttachmentList.size(),e=d-1;e>=0;e--){var f=this._hitTestTopAttachmentList.get(e);f.hit(c.x,c.y)&&b.add(f.getElement())}if(null!=this.visibleList)for(var g=this.visibleList.size(),h=g-1;h>=0;h--){var i=this.visibleList.get(h),j=this.getElementUI(i);j&&j.hit(c.x,c.y)&&b.add(i)}return b},hitTest:function(a){var b=this.getElementAt(a);if(!b)return null;var c=this.getElementUI(b);if(!c)return null;var d;return d=a.target?this.getLogicalPoint2(a):a.event?this.getLogicalPoint2(a.event):a,c.hitTest(d.x,d.y)},getElementsAtRect:function(a,b,c,d){var e=new Gb.List;if(null==this.visibleList)return e;d=void 0===d?!0:d;for(var f=this.visibleList.size(),g=f-1;g>=0;g--){var h=this.visibleList.get(g),i=this.getElementUI(h);i&&(!c||c(i._element))&&(d&&this.isSelectable(i._element)||!d)&&(b?i.intersects(a)&&e.add(h):Rb.contains(a,i.getZoomViewRect(jc))&&e.add(h))}return e},getPosition:function(a,b,c,d,e,f){var g,h=b instanceof Gb.vector.ElementUI?b:this.getElementUI(b);if(h)if("from"===a||"to"===a){if(h.getFromPosition&&(g="from"===a?h.getFromPosition(d,e):h.getToPosition(d,e)))return c?{x:g.x-c.width/2,y:g.y-c.height/2}:g}else g="hotspot"===a?f?h.getZoomHotSpot(this.zoomManager):h.getHotSpot():Tb.get(a,f?h.getZoomBodyRect():h.getBodyRect(),c);if(!g&&b.getRect&&(g=Tb.get(a,b.getRect(),c)),g)return{x:g.x+d,y:g.y+e};throw"position '"+a+"' object '"+b+"'"},isValidEvent:function(a){if(!a)return!1;var b,c;if(a.currentTarget===this._view){if(Ob.isFirefox?(b=a.layerX,c=a.layerY):(b=a.offsetX,c=a.offsetY),1==this.isHScrollBarVisible()&&c>=this.viewRect.height-this.getScrollBarWidth())return!1;if(1==this.isVScrollBarVisible()&&b>=this.viewRect.width-this.getScrollBarWidth())return!1}return!0},addMarker:function(a){this.markerList.add(a),this.repaintTopCanvas()},removeMarker:function(a){this.markerList.remove(a),this.repaintTopCanvas()},clearMarker:function(){this.markerList.clear(),this.repaintTopCanvas()},isMovable:function(a){return this._box.contains(a)&&a.isMovable()?this._movableFunction&&!this._movableFunction(a)?!1:this.getLayerByElement(a).isMovable():!1},hasMovableSelectedElements:function(){for(var a=this.getSelectionModel().getSelection(),b=0;b<a.size();b++){var c=a.get(b);if(this.isMovable(c))return!0}return!1},getMovableSelectedElements:function(){return this.getSelectionModel().toSelection(function(a){return this.isMovable(a)},this)},moveSelectedElements:function(a,b,c,d){if(0!==a||0!==b){var e=this.getMovableSelectedElementsRect();null!=e&&(this._limitElementInPositiveLocation&&(e.x+a<0&&(a=-e.x),e.y+b<0&&(b=-e.y)),Gb.Util.moveElements(this.getMovableSelectedElements(),a,b,c,d,this))}},getMovableSelectedElementsRect:function(){var a=this.getMovableSelectedElements();if(0===a.size())return null;for(var b=null,c=0,d=a.size();d>c;c++){var e=a.get(c);if(e instanceof Ld){var f=this.getElementUI(e);f&&(b=Rb.unionRect(b,f.getViewRect()))}}return b},isVisibleAttachment:function(a){return!this.state.zooming&&!this.state.panning&&!this.state.layouting},isVisible:function(a,b,c){if(!this._box.contains(a))return!1;if(!a.isVisible())return!1;if(3!==arguments.length&&(b=this._visibleFunction),b&&!b(a))return!1;if(!(c||this._box._layerBox.getLayerByElement(a))._visible)return!1;if(uc.getSubNetwork(a)!==this._currentSubNetwork)return!1;if(!this.zoomManager.isElementVisible(a))return!1;if(a instanceof Gb.Link){if(!this._noAgentLinkVisible){if(!a._fromAgent||!a._toAgent)return!1;if(!this.isVisible(a._fromAgent,b,c)||!this.isVisible(a._toAgent,b,c))return!1}if(a.getBundleIndex()>0&&a.getBundleCount()>1&&!a.getStyle("link.bundle.expanded"))return!1}else for(var d=a._parent;d&&!d.ISubNetwork;){if(d instanceof Gb.Group&&(!d.isExpanded()||!this.isVisible(d,b,c)))return!1;d=d._parent}return a.IDummy?!1:!0},getVisibleFunction:function(){return this._visibleFunction},setVisibleFunction:function(a){var b=this._visibleFunction;this._visibleFunction=a,this.firePropertyChange("visibleFunction",b,a),this.invalidateElementVisibility()},isEditable:function(a){return this._box.contains(a)?this._editableFunction&&!this._editableFunction(a)?!1:this.getLayerByElement(a).isEditable():!1},getEditableFunction:function(){return this._editableFunction},setEditableFunction:function(a){var b=this._editableFunction;this._editableFunction=a,this.firePropertyChange("editableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isRotatable:function(a){return this._rotatableFunction&&!this._rotatableFunction(a)?!1:!0},getRotatableFunction:function(){return this._rotatableFunction},setRotatableFunction:function(a){var b=this._rotatableFunction;this._rotatableFunction=a,this.firePropertyChange("rotatableFunction",b,a),this.invalidateSelectedElementUIs(!0)},isLinkable:function(a,b){return null==this._linkableFunction||this._linkableFunction(a,b)},getLinkableFunction:function(){return this._linkableFunction},setLinkableFunction:function(a){var b=this._linkableFunction;this._linkableFunction=a,this.firePropertyChange("linkableFunction",b,a),this.invalidateSelectedElementUIs(!0)},onShareSelectionModelChanged:function(){this.invalidateElementUIs()},getShadowColor:function(a){var b=a.getStyle("shadow.color");return!b&&this.isSelected(a)&&"shadow"===a.getStyle("select.style")?a.getStyle("select.color"):b},getSelectColor:function(a){return a.getStyle("select.color")},getAlarmLabel:function(a){var b=a.getAlarmState().getHighestNewAlarmSeverity();if(b){var c=a.getAlarmState().getNewAlarmCount(b)+b.nickName;return a.getAlarmState().hasLessSevereNewAlarms()&&(c+="+"),c}return null},getLinkHandlerLabel:function(a){return a.isBundleAgent()?"+("+a.getBundleCount()+")":null},setInteractions:function(a){var b=this._interactions;b&&b.forEach(function(a){a.tearDown()}),this._interactions=a,a&&a.forEach(function(a){a.setUp()}),this.invalidateSelectedElementUIs(!0),this.firePropertyChange("interactions",b,a)},getInteractions:function(){return this._interactions},setDefaultInteractions:function(a,b){var c=[new Gb.vector.interaction.DefaultInteraction(this,a)];b&&c.push(new Gb.vector.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setTouchInteractions:function(){this.setInteractions([new Gb.vector.interaction.DefaultInteraction(this,!1),new Gb.vector.interaction.TouchInteraction(this)])},setMSTouchInteractions:function(){this.setInteractions([new Gb.vector.interaction.MSTouchInteraction(this)])},setEditInteractions:function(a,b){var c=[new Gb.vector.interaction.EditInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)];b&&c.push(new Gb.vector.interaction.MoveLinkInteraction(this,a)),this.setInteractions(c)},setCreateElementInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateElementInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setCreateLinkInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateLinkInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setCreateShapeLinkInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateShapeLinkInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setCreateShapeNodeInteractions:function(a){this.setInteractions([new Gb.vector.interaction.CreateShapeNodeInteraction(this,a),new Gb.vector.interaction.DefaultInteraction(this)])},setMagnifyInteractions:function(){this.setInteractions([new Gb.vector.interaction.DefaultInteraction(this),new Gb.vector.interaction.MagnifyInteraction(this)])},hasEditInteraction:function(){return this._hasEditInteraction},setHasEditInteraction:function(a){var b=this._hasEditInteraction;this._hasEditInteraction=a,this.firePropertyChange("hasEditInteraction",b,a)},addElementByInteraction:function(a){a.getParent()||a.setParent(this._currentSubNetwork),this._box.add(a),this.getSelectionModel().setSelection(a),this.fireInteractionEvent({kind:"createElement",element:a})},getToolTip:function(a){if(a){var b=a.getToolTip();return b?b:a.getName()}return null},isToolTipEnabled:function(){return this._toolTipEnabled?!0:!1},setToolTipEnabled:function(a){if(this._toolTipEnabled=a,a){if(!this._toolTipListener){var b=this;this._toolTipListener=function(a){if(b.isMovingElement())return void Ac.hideToolTip();var c=b.getElementAt(a);if(b._preElement!==c){if(b._preElement=c,c){var d=b.getToolTip(c);return void Ac.showToolTip({x:a.pageX,y:a.pageY},d,function(a){var c=b._view.getBoundingClientRect(),d=a.getBoundingClientRect();d.width+d.left>c.width+c.left&&(a.style.left=c.width+c.left-d.width+(Mb.documentElement.scrollLeft||Mb.body.scrollLeft)+"px"),d.height+d.top>c.height+c.top&&(a.style.top=c.height+c.top-d.height+(Mb.documentElement.scrollTop||Mb.body.scrollTop)+"px")})}Ac.hideToolTip()}},this._view.addEventListener("mousemove",this._toolTipListener,!1),this.firePropertyChange("toolTipEnabled",!1,!0)}}else this._toolTipListener&&(Ac.hideToolTip(),this._view.removeEventListener("mousemove",this._toolTipListener,!1),delete this._toolTipListener,this.firePropertyChange("toolTipEnabled",!0,!1))},setZoom:function(a,b){if(a=this.checkZoom(a),this.isAsyncZoomAndViewRect())var c=this._zoomMap[this._currentSubNetwork].zoom;else var c=this._zoom;if(a!=c){var d=this.getViewRect();b||(b={x:d.width/2,y:d.height/2});var e=this.viewRect,f=b.x-(b.x+e.x)*a/c,g=b.y-(b.y+e.y)*a/c;this.isAsyncZoomAndViewRect()?this._zoomMap[this._currentSubNetwork].zoom=a:this._zoom=a,this._paintAll=!0,this.invalidateElementVisibility(),this.invalidateCanvasSize(),this.zoomManager._invalidateZoom(),this.setViewRect(-f,-g,this.viewRect.width,this.viewRect.height),this._asyncZoomAndViewRect?this.firePropertyChange("zoom",c,this._zoomMap[this._currentSubNetwork].zoom):this.firePropertyChange("zoom",c,this._zoom),this.state.zooming=!0;var h=null,i=this;h?clearTimeout(h):h=setTimeout(function(){h=null,i.state.zooming=!1,i.invalidateElementUIs(!0)},100)}},getZoom:function(){if(this.isAsyncZoomAndViewRect()){var a=this._zoomMap[this._currentSubNetwork];return a||(this._zoomMap[this._currentSubNetwork]={zoom:1}),this._zoomMap[this._currentSubNetwork].zoom}return this._zoom},getSizeZoom:function(a){return this.zoomManager.getSizeZoom(a)},getLocationZoom:function(){return this.zoomManager.getLocationZoom()},getGraphicsZoom:function(){return this.zoomManager.getGraphicsZoom()},zoomOverview:function(a){if(!(this._unionBounds.width<=0||this._unionBounds.width<=0)){var b=this.getZoom(),c=this._unionBounds,d=c.width/b,e=c.height/b,f=this.viewRect.width/d,g=this.viewRect.height/e,h=Math.min(f,g);this.setZoom(h);var i=this.getZoom(),j=this.viewRect.width/2-this._unionBounds.width/2*i/b,k=this.viewRect.height/2-this._unionBounds.height/2*i/b;if(this.setViewRect(this._unionBounds.x*i/b-j,this._unionBounds.y*i/b-k,this.viewRect.width,this.viewRect.height),1!=this.getLocationZoom()){var l=null==arguments[1]?5:arguments[1];if(l>0){l--;var m=this;setTimeout(function(){m.zoomOverview(a,l)},25)}}}},zoomReset:function(a){this.setZoom(1,a)},zoomIn:function(a){this.setZoom(1.2*this.getZoom(),a)},zoomOut:function(a){this.setZoom(this.getZoom()/1.2,a)},upSubNetwork:function(a,b){this._currentSubNetwork&&this.setCurrentSubNetwork(uc.getSubNetwork(this._currentSubNetwork),a,b)},getCurrentSubNetwork:function(){return this._currentSubNetwork},setCurrentSubNetwork:function(a,b,c){if(Gb.animate.AnimateManager.endAnimate(),b){if(this._currentSubNetwork===a)return;if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";var d=new Gb.animate.AnimateSubNetwork(this,a,c);Gb.animate.AnimateManager.start(d)}else this._setCurrentSubNetwork(a),c&&c()},_setCurrentSubNetwork:function(a){if(this._currentSubNetwork!==a){if(a&&!this._box.contains(a))throw a+" is not contained in this network's elementBox";if(this.isAsyncZoomAndViewRect()){var b=this._viewRectMap[this._currentSubNetwork];this._viewRectMap[this._currentSubNetwork]=b?this.viewRect:this.viewRect?this.viewRect:{x:0,y:0,width:this.viewRect.width,height:this.viewRect.height}}var c=this._currentSubNetwork;if(this._currentSubNetwork=a,this.firePropertyChange("currentSubNetwork",c,a),this.isAsyncZoomAndViewRect()){this._viewRectMap[this._currentSubNetwork]||(this._viewRectMap[this._currentSubNetwork]={x:0,y:0,width:this.viewRect.width,height:this.viewRect.height});var b=this._viewRectMap[this._currentSubNetwork];this.setViewRect(b.x,b.y,b.width,b.height),this.invalidateElementUIs()}this.invalidateElementVisibility(),this.invalidateCanvasSize(),this._paintAll=!0}},makeVisible:function(a){var b=this.getElementUI(a);if(b){var c=uc.getSubNetwork(a);if(c!==this._currentSubNetwork){var d=this;return void this.setCurrentSubNetwork(c,this.isSubNetworkAnimate(),function(){Hb.callLater(d.makeVisible,d,[a])})}for(var e=a;(e=e.getParent())&&e!==c;)e instanceof Gb.Group&&e.setExpanded(!0);var f=b.getViewRect();if(f){var g,h=b.getZoomViewRect(this.zoomManager);g=f.x==h.x&&f.y==h.y&&f.width==h.width&&f.height==h.height?{x:f.x*this.getGraphicsZoom(),y:f.y*this.getGraphicsZoom(),width:f.width*this.getGraphicsZoom(),height:f.height*this.getGraphicsZoom()}:h,Rb.intersects(this.viewRect,g)||this.isVisible(a)&&Hb.callLater(this.centerByLogicalPoint,this,[g.x+g.width/2,g.y+g.height/2])}}},centerByLogicalPoint:function(a,b,c){var d=a-this.viewRect.width/2,e=b-this.viewRect.height/2;this.setViewRect(d,e,this.viewRect.width,this.viewRect.height)},panByOffset:function(a,b){this.setViewOffSet(a,b)},getIconsNames:function(a){return a.getStyle("icons.names")},getIconsColors:function(a){return a.getStyle("icons.colors")},getLinkFlowStepping:function(a){var b=parseInt(a.getStyle("link.flow.stepping"));return b||(b=Dd.NETWORK_LINK_FLOW_STEPPING),b},getLinkFlowOffset:function(a){var b=a.getStyle("link.flow.offset");return isNaN(b)&&(b=0),b+this.getLinkFlowStepping(a)},toCanvas:function(a,b,c,d,e,f){c||(c=Ub.createCanvas()),c.setAttribute("width",a),c.setAttribute("height",b),c._viewRect?(c._viewRect.width=a,c._viewRect.height=b):c._viewRect={x:0,y:0,width:a,height:b};var g=c.getContext("2d");if(g.translate(-e,-f),g.clearRect(0,0,a,b),kd.draw(g,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;a/this.realWidth*this.getGraphicsZoom(),b/this.realHeight*this.getGraphicsZoom();g.scale(d,d);var h=this.getElementBox().getDatas()._as,i=h.length;this._topAttachmentList=new Gb.List;var j,k,l,m,n,o,p=this.getElementBox().getLayerBox(),q=p.getRoots(),r=q.size();if(this.adjustLinkIndex(),1===r)for(l=0;i>l;l++)m=h[l],this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));else for(j=0;r>j;j++)for(k=q.get(j),l=0;i>l;l++)m=h[l],p.getLayerByElement(m)===k&&this._visibleMap[m._id]&&(n=this._elementUIMap[m._id],null!=n&&n.paint(g));for(i=this._topAttachmentList.size(),l=0;i>l;l++)o=this._topAttachmentList.get(l),o.getElementUI().paintAttachment(g,o);return c},toCanvasByRegion:function(a,b,c){c||(c=Ub.createCanvas());var d=a.width*b,e=a.height*b;c.setAttribute("width",d),c.setAttribute("height",e),c._viewRect?(c._viewRect.width=d,c._viewRect.height=e):c._viewRect={x:0,y:0,width:d,height:e};var f=c.getContext("2d");if(f.clearRect(0,0,d,e),kd.draw(f,this),0===this._view.clientWidth||0===this._view.clientHeight)return c;f.save(),f.scale(b,b),f.beginPath(),f.translate(-a.x,-a.y);var g=this.getElementBox().getDatas()._as,h=g.length;this._topAttachmentList=new Gb.List;var i,j,k,l,m,n,o=this.getElementBox().getLayerBox(),p=o.getRoots(),q=p.size();if(this.adjustLinkIndex(),1===q)for(k=0;h>k;k++)l=g[k],this._visibleMap[l._id]&&(m=this._elementUIMap[l._id],null!=m&&Rb.intersects(a,m.getZoomViewRect())&&m.paint(f));else for(i=0;q>i;i++)for(j=p.get(i),k=0;h>k;k++)l=g[k],o.getLayerByElement(l)===j&&this._visibleMap[l._id]&&(m=this._elementUIMap[l._id],null!=m&&Rb.intersects(a,m.getZoomViewRect())&&m.paint(f));for(h=this._topAttachmentList.size(),k=0;h>k;k++)n=this._topAttachmentList.get(k),n.getElementUI().paintAttachment(f,n);return f.restore(),c},getGroupChildrenRects:function(a){return this.zoomManager._getGroupChildrenRects(a)},convertPointFromView:function(a){return this.zoomManager._convertPointFromView(a)},getOffset:function(a,b){return this.zoomManager._getOffset(a,b)},panToCenter:function(){this.setViewRect((this.realWidth-this.viewRect.width)/2,(this.realHeight-this.viewRect.height)/2,this.viewRect.width,this.viewRect.height)},moveElementsToCenter:function(){if(this._limitViewInCanvas){var a=this.viewRect,b=this._unionBounds,c=a.x+a.width/2-b.x-b.width/2,d=a.y+a.height/2-b.y-b.height/2;Gb.Util.moveElements(this._box.toDatas(),c,d)}else{var c=this.viewRect.width/2-this._unionBounds.width/2,d=this.viewRect.height/2-this._unionBounds.height/2;this.setViewRect(this._unionBounds.x-c,this._unionBounds.y-d,this.viewRect.width,this.viewRect.height)}},getLinkPathFunction:function(){return this._linkPathFunction},setLinkPathFunction:function(a){var b=this._linkPathFunction;this._linkPathFunction=a,this.firePropertyChange("linkPathFunction",b,a),this.invalidateElementUIs()},invalidate:function(){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}))},validate:function(){this._invalidate&&(Kb||0!==this._view.offsetWidth||0!==this._view.offsetHeight)&&(this._invalidate=!1,this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),this._isValidating=!1)},onClickElement:function(a,b){},onClickBackground:function(a){},onDoubleClickElement:function(a,b){},onDoubleClickBackground:function(a){},onLongClickElement:function(a,b){},onLongClickBackground:function(a){},onMouseMove:function(a,b){},onMouseEnter:function(a,b){},onMouseLeave:function(a,b){},setMovingElement:function(a){if(a!=this._movingElement){var b=this._movingElement;this._movingElement=a,this.firePropertyChange("movingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},setEditingElement:function(a){if(a!=this._editingElement){var b=this._editingElement;this._editingElement=a,this.firePropertyChange("editingElement",b,a),this._box._undoManager._enabled&&(a?this._box._undoManager.startBatch():this._box._undoManager.endBatch())}},dispose:function(){Gb.imageUtil.removeEventListener(this.invalidateElementUIs,this),this.setInteractions(null),cancelAnimationFrame(this._loopId)},handle_mousemove:function(a){var b=this.getElementAt(a),c=this.__preElement,d=Cc(c),e=Cc(b);c!==b&&(c&&(d&&d.onMouseLeave&&d.onMouseLeave(c,this),this.onMouseLeave(c,a)),b&&(e&&e.onMouseEnter&&e.onMouseEnter(b,this),this.onMouseEnter(b,a))),b&&e&&e.onMouseMove&&e.onMouseMove(b,this),this.onMouseMove(b,a),this.__preElement=b}}),Gb.vector.Overview=function(a){Gb.vector.Overview.superClass.constructor.apply(this,a),this._view=Ub.createView(),this._rootDiv=Ub.createDiv(),this._imageCanvas=Ub.createCanvas(),this._imageDiv=Ub.createDiv(),this._maskCanvas=Ub.createCanvas(),this._selectDiv=Ub.createDiv(),this._isNetworkDirty=!1,this._isMaskDirty=!1,Ub.setVisible(this._selectDiv,!1),this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._imageDiv),this._rootDiv.appendChild(this._maskCanvas),this._rootDiv.appendChild(this._selectDiv),this._imageDiv.appendChild(this._imageCanvas),this._exportImageCanvas=Ub.createCanvas(),this._imageCtx=this._imageCanvas.getContext("2d"),this.setNetwork(a),Ob.isTouchable?Ob.isMSTouchable?new Gb.vector.OverviewMSTouchInteraction(this):(new Gb.vector.OverviewTouchInteraction(this),new Gb.vector.OverviewInteraction(this)):new Gb.vector.OverviewInteraction(this)},Hb.ext("twaver.vector.Overview",Gb.controls.ControlBase,{__accessor:["fillColor","outlineColor","outlineWidth","selectColor","selectWidth","padding","maxPackingWidth","maxPackingHeight"],__bool:["animate"],_fillColor:Dd.OVERVIEW_FILL_COLOR,_outlineColor:Dd.OVERVIEW_OUTLINE_COLOR,_outlineWidth:Dd.OVERVIEW_OUTLINE_WIDTH,_selectColor:Dd.OVERVIEW_SELECT_COLOR,_selectWidth:Dd.OVERVIEW_SELECT_WIDTH,_padding:Dd.OVERVIEW_PADDING,_animate:Dd.OVERVIEW_ANIMATE,_maxPackingWidth:Dd.OVERVIEW_MAX_PACKING_WIDTH,_maxPackingHeight:Dd.OVERVIEW_MAX_PACKING_HEIGHT,getNetwork:function(){return this._network},onPropertyChanged:function(a){this._invalidateMask()},setNetwork:function(a){a!==this._network&&(this._network&&(this._network.removePropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.removeViewListener(this._handleNetworkViewChange,this),Ub.removeEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this._network=a,this._network&&(this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this),this._network.addViewListener(this._handleNetworkViewChange,this),Ub.addEventListener("scroll","_handleScrollChange",this._network.getView(),this)),this.invalidate())},_handleNetworkPropertyChange:function(a){("zoom"===a.property||"currentSubNetwork"===a.property||"elementBox"===a.property||"dataBox"===a.property||"canvasSizeChange"===a.property)&&this.invalidate()},_handleNetworkViewChange:function(a){"validateEnd"===a.kind&&this.invalidate()},_handleScrollChange:function(){this._invalidateMask()},invalidate:function(a){this._isNetworkDirty&&this._isMaskDirty||(this._isNetworkDirty||(this._isNetworkDirty=!0),this._isMaskDirty||(this._isMaskDirty=!0),Hb.callLater(this.validate,this,null,a))},_invalidateMask:function(){this._isMaskDirty||(this._isMaskDirty=!0,Hb.callLater(this.validate,this,[],100))},validate:function(){if((this._isMaskDirty||this._isNetworkDirty)&&this._network&&(this._maxPackingWidth>0&&this._maxPackingHeight>0||this._view.clientWidth>0&&this._view.clientHeight>0)&&0!==this._network.getViewRect().width&&0!==this._network.getViewRect().height&&!this._network._invalidate){var a,b=this._maxPackingWidth>0&&this._maxPackingHeight>0;a=b?{x:0,y:0,width:this._maxPackingWidth,height:this._maxPackingHeight}:{x:0,y:0,width:this._view.clientWidth,height:this._view.clientHeight},Rb.grow(a,-this._padding,-this._padding),b&&(Ub.setDiv(this._view,{x:0,y:0,width:this._imageDiv._viewRect.width,height:this._imageDiv._viewRect.height},null,0,null),a.width=this._imageDiv._viewRect.width,a.height=this._imageDiv._viewRect.height);var c=this._network.getGraphicsZoom(),d=this._network._unionBounds;d=Rb.unionRect(d,{x:0,y:0,width:d.x,height:d.y}),d={x:d.x/c,y:d.y/c,width:d.width/c,height:d.height/c};var e={x:this._network.viewRect.x/c,y:this._network.viewRect.y/c,width:this._network.viewRect.width/c,height:this._network.viewRect.height/c},f=d,g=Math.min(a.width/f.width,a.height/f.height),h=f.width*g,i=f.height*g,j=f.width*g,k=f.height*g,l=a.x+(a.width-j)/2,m=a.y+(a.height-k)/2;if(this._isNetworkDirty){var n={x:l,y:m,width:j,height:k};this._network.toCanvas(h,i,this._exportImageCanvas,g,f.x*g,f.y*g),this._imageCanvas.setAttribute("width",j),this._imageCanvas.setAttribute("height",k),this._imageCtx.drawImage(this._exportImageCanvas,0,0,h,i),Ub.setDiv(this._imageDiv,n,null,0,null),this._network.getElementBox&&(this._imageDiv.style.backgroundColor=(this._network.getCurrentSubNetwork()||this._network.getElementBox()).getStyle("background.color")||""),this._isNetworkDirty=!1}if(this._isMaskDirty){var o={x:(e.x-f.x)*g,y:(e.y-f.y)*g,width:e.width*g,height:e.height*g},p=Ub.setCanvas(this._maskCanvas,l,m,j,k);p.lineWidth=0,p.fillStyle=this._fillColor,Vb.drawVector(p,"rectangle",null,l,m,j,k),p.closePath(),p.fill(),p.stroke(),p.clearRect(l+o.x,m+o.y,o.width,o.height),p.lineWidth=this._outlineWidth,p.strokeStyle=this._outlineColor;var q=o.width-2*this._outlineWidth,r=o.height-2*this._outlineWidth;q=Math.min(q,j-2-o.x-this._outlineWidth),r=Math.min(r,k-2-o.y-this._outlineWidth),Vb.drawVector(p,"rectangle",null,l+o.x+this._outlineWidth,m+o.y+this._outlineWidth,q,r),p.closePath(),p.stroke(),this._isMaskDirty=!1}}else this._isNetworkDirty=!1,this._isMaskDirty=!1},getLogicalPoint:function(a){return Ub.getLogicalPoint(this._view,a,1,this._rootDiv)},centerNetwork:function(a,b){var c=this._imageDiv._viewRect;if(Rb.containsPoint(c,a)){var d=this._network.getGraphicsZoom(),e=this._network._unionBounds;e=Rb.unionRect(e,{x:0,y:0,width:e.x,height:e.y}),e={x:e.x/d,y:e.y/d,width:e.width/d,height:e.height/d};var f={x:this._network.viewRect.x/d,y:this._network.viewRect.y/d,width:this._network.viewRect.width/d,height:this._network.viewRect.height/d},g=Rb.unionRect(e,f);this._network.centerByLogicalPoint((g.x+(a.x-c.x)/c.width*g.width)*d,(g.y+(a.y-c.y)/c.height*g.height)*d,b),this._invalidateMask()}}}),Gb.vector.OverviewTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("touchstart","handleTouchstart",this.view,this)},Hb.ext("twaver.vector.OverviewTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),this.clear(),this.endPoint=this.overview.getLogicalPoint(a),yc.isMultiTouch(a)&&(this.distance=yc.getDistance(a),this.zoom=this.network.getZoom()),Ub.addEventListener("touchmove","handleTouchmove",this.view,this),Ub.addEventListener("touchend","handleTouchend",this.view,this)},handleTouchmove:function(a){if(this.moved||(this.moved=!0),this.endPoint=this.overview.getLogicalPoint(a),yc.isSingleTouch(a))this.overview.centerNetwork(this.endPoint,!1);else if(this.distance){var b=yc.getDistance(a)/this.distance;this.network.setZoom(this.zoom*b,!1)}},handleTouchend:function(a){if(!this.moved){this.endPoint=this.overview.getLogicalPoint(a);var b=this.lastPoint&&this.lastTouchStartTime&&(new Date).getTime()-this.lastTouchStartTime.getTime()<=300&&Math.abs(this.endPoint.x-this.lastPoint.x)<=10&&Math.abs(this.endPoint.y-this.lastPoint.y)<=10;b?(this.lastPoint=null,this.lastTouchStartTime=null):(this.lastPoint=this.endPoint,this.lastTouchStartTime=new Date),b?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this.endPoint,this.overview._animate)}this.clear()},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("touchmove",this.view,this),Ub.removeEventListener("touchend",this.view,this)),this.moved=!1}}),Gb.vector.OverviewMSTouchInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,this._pointerMap={},this._pointerIdArray=[],Ub.addEventListener("MSPointerDown","handleTouchstart",this.view,this),Ub.addEventListener("MSPointerMove","handleTouchmove",this.view,this),Ub.addEventListener("MSPointerUp","handleTouchend",this.view,this),Ub.addEventListener("MSPointerCancel","handleTouchend",this.view,this)},Hb.ext("twaver.vector.OverviewMSTouchInteraction",Object,{handleTouchstart:function(a){Ub.preventDefault(a),a.isPrimary&&this._pointerIdArray.length>0&&(this._pointerMap={},this._pointerIdArray=[]),!this._pointerMap[a.pointerId]&&this.overview.getLogicalPoint(a)&&(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length?(this._startTouchPoint=this.overview.getLogicalPoint(a),this._startTouchTime=new Date):2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())},handleTouchmove:function(a){if(0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10))if(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}else if(1==this._pointerIdArray.length&&this._startTouchPoint){var c=this.overview.getLogicalPoint(a);if(null==c)return;this._startTouchPoint=c,this.overview.centerNetwork(this._startTouchPoint,!1)}},handleTouchend:function(a){var b=this.overview.getLogicalPoint(a);if(1==this._pointerIdArray.length&&b){var c=this._endTouchPoint&&this._endTouchTime&&(new Date).getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchPoint,b)<=10;c?(this._endTouchPoint=null,this._endTouchTime=null):(this._endTouchPoint=b,this._endTouchTime=new Date),c?Hb.callLater(this.network.zoomReset,this.network,[this.overview._animate]):this.overview.centerNetwork(this._endTouchPoint,this.overview._animate);

}this._pointerMap={},this._pointerIdArray=[]},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})}}),Gb.vector.OverviewInteraction=function(a){this.overview=a,this.network=a.getNetwork(),this.view=a._view,Ub.addEventListener("mousedown","handleMousedown",this.view,this)},Hb.ext("twaver.vector.OverviewInteraction",Object,{handleMousedown:function(a){this.clear(),this.endPoint=this.overview.getLogicalPoint(a),Hb.isCtrlDown(a)&&(this.startPoint=this.endPoint,Ub.setVisible(this.overview._selectDiv,!0)),Ub.addEventListener("mousemove","handleMousemove",this.view,this),Ub.addEventListener("mouseup","handleMouseup",Mb,this)},handleMouseup:function(a){if(this.endPoint=this.overview.getLogicalPoint(a),"detail"in a&&2===a.detail)Hb.callLater(this.network.zoomReset,this.network,[this.endPoint,this.overview._animate]);else if(Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var b=this.overview._imageDiv._viewRect,c=this.overview._selectDiv._viewRect.x,d=this.overview._selectDiv._viewRect.y,e=b.width/this.overview._selectDiv._viewRect.width,f=b.height/this.overview._selectDiv._viewRect.height,g=Math.min(e,f);this.network.setZoom(g*Math.min(this.network.getViewRect().width/this.network.getCanvasSize().width,this.network.getViewRect().height/this.network.getCanvasSize().height)*this.network.getZoom(),!1);var h=this.network.getCanvasSize().width*((c-b.x+this.overview._selectDiv._viewRect.width/2)/b.width),i=this.network.getCanvasSize().height*((d-b.y+this.overview._selectDiv._viewRect.height/2)/b.height);Hb.callLater(this.network.centerByLogicalPoint,this.network,[h,i,this.overview._animate]),Ub.setVisible(this.overview._selectDiv,!1),Ub.setDiv(this.overview._selectDiv,{x:0,y:0,width:0,height:0},null,0,null),this.startPoint=null}else this.overview.centerNetwork(this.endPoint,this.overview._animate);this.clear()},handleMousemove:function(a){var b=this.overview.getLogicalPoint(a);if(this.endPoint=b,Ub.isVisible(this.overview._selectDiv)&&this.startPoint){var c=b.x>this.startPoint.x?this.startPoint.x:b.x,d=b.x>this.startPoint.x?this.startPoint.y:b.y;b.x>this.startPoint.x&&b.y<this.startPoint.y&&(d=b.y),b.x<this.startPoint.x&&b.y>this.startPoint.y&&(d=this.startPoint.y);var e=this.overview._imageDiv._viewRect;c<e.x&&(c=e.x),c>e.x+e.width&&(c=e.x+e.width),d<e.y&&(d=e.y),d>e.y+e.height&&(d=e.y+e.height);var f=Math.abs(b.x-this.startPoint.x),g=Math.abs(b.y-this.startPoint.y);c+f>e.x+e.width&&(f=e.x+e.width-c),d+g>e.y+e.height&&(g=e.y+e.height-d),Ub.setDiv(this.overview._selectDiv,{x:c,y:d,width:f,height:g},null,this.overview._selectWidth,this.overview._selectColor)}else this.overview.centerNetwork(b,!1)},clear:function(){this.endPoint&&(this.endPoint=null,Ub.removeEventListener("mousemove",this.view,this),Ub.removeEventListener("mouseup",this.view,this))}}),Gb.vector.ElementUI=function(a,b){this._network=a,this._element=b,this._attachments=new Gb.List,this._bodyBounds=new Gb.List,this._hitTest=!1,this._hitTest=!1,this._intersectTest=!1,this.invalidate(!0)},Hb.ext("twaver.vector.ElementUI",Object,{getElement:function(){return this._element},getNetwork:function(){return this._network},handlePropertyChange:function(a){},handleSelectionChange:function(a){},invalidate:function(a){void 0===a&&(a=!0),a&&(this._invalidateAttachmentsFlag=!0),this._invalidateFlag||(this._hotSpot=null,this._bodyRect=null,this._invalidateFlag=!0,this.invalidateZoom(),this.setAttachmentVisible&&this.setAttachmentVisible(!1))},invalidateZoom:function(){this._zoomBodyRect=null,this._zoomViewRect=null,this._zoomHotSpot=null},updateStyle:function(){this._innerColor=this._network.getInnerColor(this._element),this._outerColor=this._network.getOuterColor(this._element),this._glowBlur=this._element.getStyle("glow.blur"),this._shadowColor=this._network.getShadowColor(this._element),this._shadowXOffset=this._element.getStyle("shadow.xoffset"),this._shadowYOffset=this._element.getStyle("shadow.yoffset"),this._shadowBlur=this._element.getStyle("shadow.blur"),this._wholeAlpha=this._element.getStyle("whole.alpha")},validate:function(){var a=this;if(0!=this._invalidateFlag){this._bodyBounds.clear(),this._invalidateAttachmentsFlag&&(this._invalidateAttachmentsFlag=!1,this.checkAttachments()),this._invalidateFlag=!1,this.updateStyle(),this.validateImpl(),this._attachments.forEach(function(a){a.validate()});var b;this._bodyBounds.forEach(function(a){b=Rb.unionRect(b,a)}),null==b&&(b=Hb.cloneRect(this._element.getLocation()),b.width=0,b.height=0),this._unionBodyBounds={x:b.x,y:b.y,width:b.width,height:b.height},this._attachments.forEach(function(c){b=c instanceof Gb.vector.EditAttachment?c.getElementUI()instanceof Gb.vector.LinkUI?Rb.unionRect(b,c._viewRect):Rb.unionRect(b,a._network.zoomManager._reverseElementZoomRect(a,c._viewRect)):c.getElementUI()instanceof Gb.vector.LinkUI?Rb.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(c,c._viewRect)):c.getElementUI()instanceof Gb.vector.GroupUI&&c.getElementUI()._shapeRect?c instanceof Gb.vector.IconsAttachment?Rb.unionRect(b,c._viewRect):Rb.unionRect(b,a._network.zoomManager._getAttachmentZoomOutLineRect(c,c._viewRect)):Rb.unionRect(b,c._viewRect)}),this._viewRect=b}},validateImpl:function(){},setGlow:function(a,b){"glow"===this._element.getStyle("outer.style")&&(b.shadowColor=this._outerColor,b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=this._glowBlur)},clearGlow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},setShadow:function(a,b){var c=this._network.zoomManager,d=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(b.shadowOffsetX===this._shadowXOffset&&b.shadowOffsetY===this._shadowYOffset&&b.shadowBlur===this._shadowBlur)return b;if(d||this._network._showShadowInEdit){var e=c.getGraphicsZoom(),f=c.getSizeZoom();e*=f,e>1&&(e=1),b.shadowOffsetX=this._shadowXOffset*e,b.shadowOffsetY=this._shadowYOffset*e,b.shadowBlur=this._shadowBlur*e,b.shadowColor=this._shadowColor}return b},clearShadow:function(a){(0!=a.shadowOffsetX||0!=a.shadowOffsetY||0!=a.shadowBlur)&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){var d=this._network.zoomManager,e=d.getGraphicsZoom(),f=d.getSizeZoom();e*=f,e>1&&(e=1),this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var g=this._shadowBlur;g=Math.ceil(g/e),Rb.grow(b,g+1,g+1)}return b},appendGlowBound:function(a,b){if("glow"===this._element.getStyle("outer.style")){var c=this._network.zoomManager,d=c.getGraphicsZoom(),e=c.getSizeZoom();d*=e,d>1&&(d=1);var f=this._glowBlur;f=Math.ceil(f/d),Rb.grow(b,f+1,f+1)}},isShadowable:function(){return this._shadowColor&&this._network.isSelected(this._element)&&"shadow"===this._element.getStyle("select.style")?!0:!1},addAttachment:function(a){this._attachments.add(a),this.invalidate(!1)},removeAttachment:function(a){this._attachments.remove(a),this.invalidate(!1)},getAttachments:function(){return this._attachments},checkAttachments:function(){this.checkLabelAttachment(),this.checkLabel2Attachment(),this.checkAlarmAttachment(),this.checkIconsAttachment(),this.checkEditAttachment()},checkLabelAttachment:function(){var a=this._network.getLabel(this._element);null!=a&&""!==a?this._labelAttachment||(this._labelAttachment=new Gb.vector.LabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._network.getLabel2(this._element);null!=a&&""!==a?this._label2Attachment||(this._label2Attachment=new Gb.vector.Label2Attachment(this,Dd.SHOW_LABEL2_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._network.getAlarmLabel(this._element);null!=a&&""!==a?this._alarmAttachment||(this._alarmAttachment=new Gb.vector.AlarmAttachment(this,Dd.SHOW_ALARM_IN_ATTACHMENT_DIV),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},checkIconsAttachment:function(){var a=this._network.getIconsNames(this._element);a&&a.length>0?this._iconsAttachment||(this._iconsAttachment=new Gb.vector.IconsAttachment(this,Dd.SHOW_ICON_IN_ATTACHMENT_DIV),this.addAttachment(this._iconsAttachment)):this._iconsAttachment&&(this.removeAttachment(this._iconsAttachment),this._iconsAttachment=null)},checkEditAttachment:function(){this._network.hasEditInteraction()&&this._network.isSelected(this._element)&&this._network.isEditable(this._element)&&this.isEditable()?this._editAttachment||(this._editAttachment=new Gb.vector.EditAttachment(this,Dd.SHOW_EDIT_IN_ATTACHMENT_DIV),this.addAttachment(this._editAttachment)):this._editAttachment&&(this.removeAttachment(this._editAttachment),this._editAttachment=null)},getLabelAttachment:function(){return this._labelAttachment},getAlarmAttachment:function(){return this._alarmAttachment},getIconsAttachment:function(){return this._iconsAttachment},getEditAttachment:function(){return this._editAttachment},isEditable:function(){return!0},getInnerColor:function(){return this._innerColor},getOuterColor:function(){return this._outerColor},getShadowColor:function(){return this._shadowColor},getDyeColor:function(a){return this._innerColor?this._innerColor:this.getStyle(a)},getStyle:function(a){return this._element.getStyle(a)},getFont:function(a){var b=this._element.getStyle(a);return b?b:Gb.Defaults.FONT},paint:function(a){a.save(),a.globalAlpha=this._wholeAlpha,a.beginPath(),this.paintBody(a),this.clearShadow(a),this.clearGlow(a),a.closePath(),a.beginPath(),this.paintAttachments(a),a.closePath(),a.restore(),this._network._debug&&Vb.strokeRect(a,this.getZoomBodyRect(),"orange")},paintBody:function(a){},getZoomBodyRect:function(a){return this._network.zoomManager._getElementZoomRect(this,this.getBodyRect())},getZoomHotSpot:function(){return this._zoomHotSpot||(this._zoomHotSpot=this._network.zoomManager._getZoomHotSpot(this,this._hotSpot)),Hb.clone(this._zoomHotSpot)},getZoomPointers:function(a,b){return this._network.zoomManager._getZoomPointers(a,this,b)},_getZoomViewRect:function(a,b,c){var d=this._network.zoomManager;if(b){var e=Hb.cloneRect(d._getAttachmentZoomRect(b,a));return e}var f=d.getLocationZoom(),g=d.getSizeZoom(this),h=this._bodyRect?this._bodyRect:this.getBodyRect();a=a||{x:h.x,y:h.y,width:0,height:0};var i=h.x+h.width/2,j=h.y+h.height/2;return{x:i*f+(a.x-i)*g,y:j*f+(a.y-j)*g,width:a.width*g,height:a.height*g}},getZoomViewRect:function(a){{var b=this._network.zoomManager,c=b.getLocationZoom();b.getGraphicsZoom()}if(1==c)return Hb.cloneRect(this._viewRect);if(!this._zoomViewRect||a){var d,e=this._getZoomViewRect(Hb.cloneRect(this._unionBodyBounds),!1);d=Rb.unionRect(d,e);this._attachments.forEach(function(a){d=a instanceof Gb.vector.EditAttachment?Rb.unionRect(d,a._viewRect):Rb.unionRect(d,a.getZoomViewRect())}),this._zoomViewRect=d}return Hb.cloneRect(this._zoomViewRect)},paintAttachments:function(a){a.beginPath();for(var b=this._attachments.size(),c=0;b>c;c++){var d=this._attachments.get(c);(this._network.isShowAttachOnChg()||this._network.isVisibleAttachment(d))&&(1==this._hitTest&&0==d.isShowOnTop()&&this.paintAttachment(a,d),1==this._intersectTest&&this.paintAttachment(a,d),0==this._hitTest&&0==this._intersectTest&&(d.isShowOnTop()?this._network._topAttachmentList.add(d):this.paintAttachment(a,d)))}},paintAttachment:function(a,b){var c=this._network.zoomManager;c.isAttachmentVisible(this._element)&&(b!=this._labelAttachment&&b!=this._label2Attachment||c.isLabelVisible(this._element))&&(b!=this._alarmAttachment||c.isAlarmBalloonVisible(this._element))&&(a.beginPath(),b.paint(a),this.clearShadow(a))},getViewRect:function(){return Hb.cloneRect(this._viewRect)},getUnionBodyBounds:function(){return Hb.cloneRect(this._unionBodyBounds)},addBodyBounds:function(a){a&&this._bodyBounds.add(a)},getBodyRect:function(a){return void 0==a&&(a=!0),this._bodyRect||(this._bodyRect=this.createBodyRect()),a?Hb.cloneRect(this._bodyRect):this._bodyRect},getHotSpot:function(){return this._hotSpot?Hb.clone(this._hotSpot):{x:0,y:0}},setHotSpot:function(a){this._hotSpot=a},hit:function(a,b){return!1},intersects:function(a){return Rb.contains(a,this.getZoomViewRect())?!0:!1},hitCanvasRectAtBody:function(a){a.width<1&&(a.width=1),a.height<1&&(a.height=1);var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);if(c.save(),c.translate(-a.x,-a.y),this._element.getImage){var d=Hb.getImageAsset(this._element.getImage());if(d&&d.getImage()instanceof Hd)return 1}this.paintBody(c);try{for(var e=c.getImageData(0,0,a.width,a.height),f=e.data,g=0;g<e.width;g++)for(var h=0;h<e.height;h++){var i=4*(h*e.width+g),j=f[i+3];if(0!==j)return c.restore(),1}}catch(k){if(Od.disposeHitCanvas(),Rb.contains(this.getUnionBodyBounds(),a))return 0}return c.restore(),-1},hitCanvasRectAtAttachments:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paintAttachments(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),1}}catch(j){Od.disposeHitCanvas()}return c.restore(),-1},hitCanvasRect:function(a){this._intersectTest=!0,1==this._hitTest&&(this._intersectTest=!1);var b=Rb.intersection(a,this.getZoomViewRect()),c=this.hitCanvasRectAtBody(b);if(1==c)return this._intersectTest=!1,!0;var d=this.hitCanvasRectAtAttachments(b);return 1==d?(this._intersectTest=!1,!0):(this._intersectTest=!1,0==c)},hitCanvasPoint:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this.getZoomViewRect(),c))return!1;this._hitTest=!0;var e=this.hitCanvasRect(c);return this._hitTest=!1,e},hitTest:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),!Rb.intersects(this.getZoomViewRect(),c))return null;for(var e=Rb.intersection(c,this.getZoomViewRect()),f=this._attachments.size(),g=0;f>g;g++){var h=this._attachments.get(g);if(h.hit(a,b))return h}var i=this.hitCanvasRectAtBody(e);return 1==i?this:0==i?this:null},dispose:function(){this._attachments.forEach(function(a){a.dispose()}),this._attachments.clear()}}),Gb.vector.NodeUI=function(a,b){Gb.vector.NodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.NodeUI",Gb.vector.ElementUI,{invalidate:function(a){this.curInterval&&clearInterval(this.curInterval),Gb.vector.NodeUI.superClass.invalidate.call(this,a)},createBodyRect:function(){return this._element.getRect()},validateImpl:function(){Gb.vector.NodeUI.superClass.validateImpl.call(this);var a=this.getStyle("vector.shape"),b=this.getBodyRect();this._hotSpot=Rb.getHotSpot(b.x,b.y,b.width,b.height,a),this.validateBodyBounds()},validate:function(){0!=this._invalidateFlag&&Gb.vector.NodeUI.superClass.validate.call(this)},validateBodyBounds:function(){var a=this.getStyle("body.type");"default"===a?this.addBodyBounds(this.getDefaultBodyRect()):"vector"===a?this.addBodyBounds(this.getVectorBody()):"default.vector"===a?(this.addBodyBounds(this.getVectorBody()),this.addBodyBounds(this.getDefaultBodyRect())):"vector.default"===a&&(this.addBodyBounds(this.getDefaultBodyRect()),this.addBodyBounds(this.getVectorBody())),this._outerColor&&"border"===this.getStyle("outer.style")&&this.addBodyBounds(this.getOuterBorderRect()),!this._editAttachment&&"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.addBodyBounds(this.getSelectBorderRect())},getDefaultBodyRect:function(){var a=this._element,b=this.getBodyRect();if(!a.getImage()||"string"==typeof a.getImage()&&!Hb.getImageAsset(a.getImage()))return b;Rb.addPadding(b,this._element,"image.padding",1);var c=Hb.cloneRect(b);return this.appendGlowBound(this,c),this.appendShadowBound(this,c),b=c},getVectorBody:function(){var a=this.getPathRect("vector");return a},getOuterBorderRect:function(){return this._getBorderRect("outer")},getSelectBorderRect:function(){return this._getBorderRect("select")},_getBorderRect:function(a){var b=this._element,c=b.getStyle(a+".width"),d=b.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();if(c>0){c="select"===a?c/d:c;var e=this.getBodyRect();Rb.addPadding(e,b,a+".padding","select"===a?1/d:1);var f=Hb.cloneRect(e);return Rb.grow(f,2*c,2*c),f}return null},getPathRect:function(a,b){{var c=this._element,d=this.getBodyRect();this._network.zoomManager.getSizeZoom()}b&&Rb.addPadding(d,c,a+".padding",1);var e=Hb.cloneRect(d),f=c.getStyle(a+".outline.width");if(f>0)if(this._getZoomPoints){for(var g=this._element._points,h=g.size(),i=0,j=0;h>j;j++){if(0==j)var k=g.get(j),l=g.get(h-1),m=g.get(j+1);else if(j==h-1)var k=g.get(j),l=g.get(j-1),m=g.get(0);else var k=g.get(j),l=g.get(j-1),m=g.get(j+1);var n=Rb.getCenterPoint(l,m),o=Rb.getAngle(n,k),p=Math.abs(5*(f+1)*Math.sin(o));i=p>i?p:i,p=Math.abs(5*(f+1)*Math.cos(o)),i=p>i?p:i}Rb.grow(e,i,i)}else Rb.grow(e,f/2,f/2);return this.appendGlowBound(this,e),this.appendShadowBound(this,e),e},getZoomPathRect:function(a,b){{var c=this._element,d=this.getZoomBodyRect();this._network.zoomManager.getSizeZoom()}b&&Rb.addPadding(d,c,a+".padding",1);var e=Hb.cloneRect(d),f=c.getStyle(a+".outline.width");if(f>0)if(this._getZoomPoints){for(var g=this._getZoomPoints(),h=g.size(),i=0,j=0;h>j;j++){if(0==j)var k=g.get(j),l=g.get(h-1),m=g.get(j+1);else if(j==h-1)var k=g.get(j),l=g.get(j-1),m=g.get(0);else var k=g.get(j),l=g.get(j-1),m=g.get(j+1);var n=Rb.getCenterPoint(l,m),o=Rb.getAngle(n,k),p=Math.abs(5*(f+1)*Math.sin(o));i=p>i?p:i,p=Math.abs(5*(f+1)*Math.cos(o)),i=p>i?p:i}Rb.grow(e,i,i)}else Rb.grow(e,f/2,f/2);return this.appendGlowBound(this,e),this.appendShadowBound(this,e),e},paintBody:function(a){this.curInterval&&clearInterval(this.curInterval);var b=this.getStyle("body.type");"default"===b?this.drawDefaultBody(a):"vector"===b?this.drawVectorBody(a):"default.vector"===b?(this.drawVectorBody(a),this.drawDefaultBody(a)):"vector.default"===b&&(this.drawDefaultBody(a),this.drawVectorBody(a)),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawOuterBorder(a),"border"===this.getStyle("select.style")&&this._network.isSelected(this._element)&&this.drawSelectBorder(a)},drawOuterBorder:function(a){var b=this._element,c=b.getStyle("outer.width");if(c>0){var d=this.getZoomBodyRect();Rb.addPadding(d,b,"outer.padding",1),a.lineWidth=c,a.lineCap=b.getStyle("outer.cap"),a.lineJoin=b.getStyle("outer.join"),a.strokeStyle=this._outerColor,Vb.drawVector(a,b.getStyle("outer.shape"),null,d),a.stroke()}},drawDefaultBody:function(a){var b,c=this._element;if(c.getImage()&&("string"!=typeof c.getImage()||(b=Hb.getImageAsset(c.getImage())))&&(!this._shapeRect||c.getStyle("group.expend.image")&&("string"!=typeof c.getStyle("group.expend.image")||(b=Hb.getImageAsset(c.getStyle("group.expend.image")))))){var d=this.getZoomBodyRect();Rb.addPadding(d,this._element,"image.padding",1),0!=c.getAngle()&&(a.save(),d=c.getOriginalRect(),d=this._network.zoomManager._getElementZoomRect(this,d),Gb.Util.rotateCanvas(a,d,c.getAngle())),this.setGlow(this,a),this.setShadow(this,a);if(b&&b.getImage()instanceof Hd){var e,f=b.getImage().frames,g=b.getImage().size,h=0;e=Jd(f,g,0),a.drawImage(e,d.x,d.y,d.width,d.height),this.curInterval=setInterval(function(){h=(h+f.length)%f.length,e=Jd(f,g,h),a.drawImage(e,d.x,d.y,d.width,d.height),h++},100)}else this._shapeRect?Mc(a,c.getStyle("group.expend.image"),this.getInnerColor(),d,c,this._network):Mc(a,c.getImage(),this.getInnerColor(),d,c,this._network);0!=c.getAngle()&&a.restore()}},drawSelectBorder:function(a){this.clearGlow(a);var b=this._element,c=b.getStyle("select.width");if(c>0){var d=this.getZoomBodyRect();d=Hb.cloneRect(d);var e=b.getStyle("select.physicalZoom")?1:this._network.getGraphicsZoom();Rb.addPadding(d,b,"select.padding",1/e),Rb.grow(d,c/2/e,c/2/e),a.lineWidth=c/e,a.lineCap=b.getStyle("select.cap"),a.lineJoin=b.getStyle("select.join"),a.strokeStyle=b.getStyle("select.color"),Vb.drawVector(a,b.getStyle("select.shape"),null,d),a.stroke()}},drawVectorBody:function(a){this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("vector.deep"),c=this.getStyle("vector.fill.color");if(0!==b&&c&&"rectangle"===this.getStyle("vector.shape")){var d=this.getZoomBodyRect(),e=this._element.getAngle();if(0!=e){a.save();var f=this._element.getOriginalRect();f=this._network.zoomManager._getElementZoomRect(this,f),Gb.Util.rotateCanvas(a,f,e)}Vb.draw3DRect(a,c,b,d),0!=e&&a.restore()}},drawPath:function(a,b,c,d,e,f,g){var h=this._network.zoomManager,i=this._element,j=null;j="group"==b?this._shapeRect:this.getZoomBodyRect(),c&&Rb.addPadding(j,i,b+".padding",1);var k=i.getStyle(b+".outline.width");this.setGlow(this,a),this.setShadow(this,a),0!=i.getAngle()&&(i instanceof Nd||(j=i.getOriginalRect(),j=h._getElementZoomRect(this,j)),a.save(),Gb.Util.rotateCanvas(a,j,i.getAngle()));var l,m=i.getStyle(b+".fill");if(m){l=this._innerColor&&!uc.hasDefault(this._element)?this._innerColor:i.getStyle(b+".fill.color");var n=i.getStyle(b+".gradient");n?Vb.fill(a,l,n,i.getStyle(b+".gradient.color"),j):a.fillStyle=l}var o=i.getStyle(b+".shape"),p=i.getStyle("group.shape.roundrect.radius");0>p&&(p=10),m&&(a.beginPath(),e?Vb.drawLinePoints(a,e,null,f,g):"roundrect"===o&&"group"===b?Vb.drawVector(a,o,null,j,p):Vb.drawVector(a,o,null,j),a.fill()),k>0&&(a.lineWidth=k,a.lineCap=i.getStyle(b+".cap"),a.lineJoin=i.getStyle(b+".join"),a.strokeStyle=i.getStyle(b+".outline.color"),a.beginPath(),e?Vb.drawLinePoints(a,e,d,f,g):"roundrect"===o&&"group"===b?Vb.drawVector(a,o,d,j,p):Vb.drawVector(a,o,d,j),a.stroke()),0!=i.getAngle()&&a.restore()},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();if(d&&d>0&&Rb.grow(c,d,d),this._network._transparentSelectionEnable){var e=this.getBodyRect();if(Hb.math.intersects(e,c))return!0}return Rb.intersects(this.getZoomViewRect(),c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(this._network._transparentSelectionEnable){var c=this.getBodyRect();if(Hb.math.intersects(c,a))return!0}return Rb.intersects(a,this.getZoomViewRect())?this.hitCanvasRect(a):!1}}),Gb.vector.LinkUI=function(a,b){Gb.vector.LinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.LinkUI",Gb.vector.ElementUI,{isEditable:function(){return!0},invalidate:function(a){this._linkPoints=null,this._fromPoint=null,this._toPoint=null,this._angle=null,Gb.vector.LinkUI.superClass.invalidate.call(this,a)},invalidateZoom:function(){this._fromPoint=null,this._toPoint=null,this._linkPoints=null,Gb.vector.LinkUI.superClass.invalidateZoom.call(this)},validateImpl:function(){this.validateBodyBounds(),Gb.vector.LinkUI.superClass.validateImpl.call(this)},validateBodyBounds:function(){var a=this.getLinkPoints();if(a&&!(a.size()<2)){var b=this._element,c=Rb.getLineRect(a),d=b.getStyle("link.width"),e=d;if(this._outerColor){var f=b.getStyle("outer.width");e+=2*f}var g=!this._editAttachment&&"border"===b.getStyle("select.style")&&this._network.isSelected(this._element);if(g){var h=b.getStyle("select.width");e+=2*h}Rb.grow(c,e/2,e/2),b.getStyle("arrow.from")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowFromRect=nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),0,0,this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowFromRect=nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"),this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!0,b.getStyle("arrow.from.shape"),b.getStyle("arrow.from.width"),b.getStyle("arrow.from.height"),b.getStyle("arrow.from.xoffset"),b.getStyle("arrow.from.yoffset"),this._network.zoomManager)))),b.getStyle("arrow.to")&&(this._network._edgeDetect?(this._network._debug&&(this._arrowToRect=nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),0,0,this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),0,0,this._network.zoomManager))):(this._network._debug&&(this._arrowToRect=nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"),this._network.zoomManager)),c=Rb.unionRect(c,nd.getArrowRect(this,a,!1,b.getStyle("arrow.to.shape"),b.getStyle("arrow.to.width"),b.getStyle("arrow.to.height"),b.getStyle("arrow.to.xoffset"),b.getStyle("arrow.to.yoffset"),this._network.zoomManager)))),this.appendShadowBound(this,c),this.addBodyBounds(c),this._growLinkJoinBounds(c,e)}},_growLinkJoinBounds:function(a,b){},createBodyRect:function(){var a=this.getHotSpot();return a?{x:a.x-1,y:a.y-1,width:2,height:2}:null},paintBody:function(a){var b=this.getLinkPoints();if(b&&!(b.size()<2)){var c=this._element,d=c.isBundleAgent()&&c.getStyle("link.agent"),e=c.getStyle(d?"link.agent.width":"link.width"),f=e;if(this._outerColor&&"border"===this.getStyle("outer.style")){var g=c.getStyle("outer.width");f+=2*g}var h=!this._editAttachment&&"border"===c.getStyle("select.style")&&this._network.isSelected(this._element);if(h){var i=c.getStyle("select.width");f+=2*i}this.setGlow(this,a),this.setShadow(this,a),a.lineCap=c.getStyle(d?"link.agent.cap":"link.cap"),a.lineJoin=c.getStyle(d?"link.agent.join":"link.join");var j=c.getStyle(d?"link.agent.pattern":"link.pattern");h&&this.drawLinePoints(a,b,f,c.getStyle("select.color"),j),this._outerColor&&"border"===this.getStyle("outer.style")&&this.drawLinePoints(a,b,e+2*g,this._outerColor,j),this.drawLinePoints(a,b,e,this._innerColor||c.getStyle(d?"link.agent.color":"link.color"),j),nd.drawLinkArrow(this,a,b,this._network.zoomManager),this._network._debug&&(Vb.strokeRect(a,this._arrowToRect,Gb.Util.randomColor()),Vb.strokeRect(a,this._arrowFromRect,Gb.Util.randomColor()))}},drawLinePoints:function(a,b,c,d,e){a.lineWidth=c,a.strokeStyle=d;var f=this._element.isBundleAgent()&&this._element.getStyle("link.agent");if(this._element.getStyle(f?"link.agent.flow":"link.flow")===!0&&e&&e.length>1){var g=new tc(a,e[0],e[1]),h=this._element.getStyle(f?"link.agent.flow.offset":"link.flow.offset"),i=Math.floor(h/(e[0]+e[1]));i>2&&(h-=(e[0]+e[1])*i),this._element.getStyle(f?"link.agent.flow.converse":"link.flow.converse")?h<e[0]?g.overflow=e[0]-h:h>=e[0]&&h<=e[0]+e[1]?(g.overflow=e[1]-(h-e[0]),g.overflow&&(g.isLine=!1)):(h-=e[0]+e[1],g.overflow=e[0]-h):h<=e[1]?(g.overflow=h,h&&(g.isLine=!1)):h>e[1]&&h<=e[0]+e[1]?g.overflow=h-e[1]:(h-=e[0]+e[1],h&&(g.isLine=!1),g.overflow=h),this._element._styleMap[f?"link.agent.flow.offset":"link.flow.offset"]=h,a.beginPath(),Vb._drawLine(b,a),a.stroke(),a.shadowColor="transparent",a.beginPath();var j=this._element.getStyle(f?"link.agent.flow.color":"link.flow.color");j=j?j:Dd.NETWORK_LINK_FLOW_COLOR,a.strokeStyle=j,Vb._drawLine(b,g),a.stroke(),a.shadowColor=this._shadowColor}else a.beginPath(),Vb.drawLinePoints(a,b,e),a.stroke()},getLinkPoints:function(){return this._linkPoints||(this._linkPoints=this.createLinkPoints(),this._lineLength=Rb.calculateLineLength(this._linkPoints)),this._linkPoints},getFromPosition:function(a,b){var c=this.getFromPoint();return c?{x:c.x+a,y:c.y+b}:null},getToPosition:function(a,b){var c=this.getToPoint();return c?{x:c.x+a,y:c.y+b}:null},getFromPoint:function(){return this._fromPoint||(this._fromPoint=wc.createFromPoint(this,this._network.zoomManager)),this._fromPoint},getToPoint:function(){return this._toPoint||(this._toPoint=wc.createToPoint(this,this._network.zoomManager)),this._toPoint},getZoomBodyRect:function(){return this.getBodyRect()},getZoomViewRect:function(){return this._viewRect},createLinkPoints:function(){var a=this._network.zoomManager,b=this.getStyle("link.type"),c=new Gb.List;if(wc.isOrthogonalOrFlexionalLink(this._element))c=wc.orthogonalAndFlexional(this,b,a);else if(this._element.isLooped()){var d=this._network.getElementUI(this._element.getFromAgent());null!=d&&(this._hotSpot=wc.fillLoopedPoints(this,d.getZoomBodyRect(),c))}else{if("arc"!==b&&"triangle"!==b&&"parallel"!==b)throw"Can not resolve link type '"+b+"'";var e=this.getFromPoint(),f=this.getToPoint();this._hotSpot=wc.fillBundlePoints(this,b,e,f,c,a)}if(this._network._linkPathFunction){var g=this._network._linkPathFunction(this,c);g&&(c=g)}return c},checkAttachments:function(){Gb.vector.LinkUI.superClass.checkAttachments.call(this),this.checkLinkHandlerAttachment()},checkLinkHandlerAttachment:function(){var a=this._network.getLinkHandlerLabel(this._element);null!=a&&""!==a?this._linkHandlerAttachment||(this._linkHandlerAttachment=new Gb.vector.LinkHandlerAttachment(this),this.addAttachment(this._linkHandlerAttachment)):this._linkHandlerAttachment&&(this.removeAttachment(this._linkHandlerAttachment),this._linkHandlerAttachment=null)},getLinkHandlerAttachment:function(){return this._linkHandlerAttachment},getControlPoint:function(){return wc.getControlPoint(this._element,this,this._network.zoomManager)},setControlPoint:function(a){if(a){var b=this.getStyle("link.type");if(wc.hasControlPoint(b)){var c=wc.getLinkSourceBounds(this,this._network.zoomManager),d=wc.getLinkTargetBounds(this,this._network.zoomManager);wc.setParamsByControlPoint(a,c,d,b,this._element)}}},getLineLength:function(){return this._lineLength},hit:function(a,b){var c={x:a,y:b,width:0,height:0},d=this._network.getSelectionTolerance();return d&&d>0&&Rb.grow(c,d,d),Rb.intersects(this._viewRect,c)?this.hitCanvasPoint(a,b):!1},intersects:function(a){var b=Gb.vector.NodeUI.superClass.intersects.apply(this,arguments);if(1==b)return!0;if(0==Rb.intersects(a,this._viewRect))return!1;var c=this.getLinkPoints(),d=c.size();if(2==d)for(var e=0;d>e;e+=2){var f=c.get(e);if(d>e+1){var g=c.get(e+1);if(Od.intersectsLine(f.x,f.y,g.x,g.y,a.x,a.y,a.width,a.height))return!0}}return this.hitCanvasRect(a)},getAngle:function(){return!this._angle&&this._fromPoint&&this._toPoint&&(this._angle=Rb.getAngle(this._fromPoint,this._toPoint)),this._angle||0},getAbsoluteAngle:function(){var a={x:10,y:0},b=this._fromPoint,c=this._toPoint,d={x:c.x-b.x,y:c.y-b.y},e=180*Math.acos((d.x*a.x+d.y*a.y)/(Math.sqrt(a.x*a.x+a.y*a.y)*Math.sqrt(d.x*d.x+d.y*d.y)))/Math.PI;return e=b.y<=c.y?e:360-e,e=e%360*Math.PI/180},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;Rb.grow(b,d+1,d+1)}return b}}),Gb.vector.GroupUI=function(a,b){Gb.vector.GroupUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.GroupUI",Gb.vector.NodeUI,{isEditable:function(){return!this._element.isExpanded()},paintBody:function(a){this._shapeRect?this._element.getStyle("group.expend.image")?(Gb.vector.GroupUI.superClass.paintBody.apply(this,arguments),
this._element.getStyle("group.expend.image.vector")&&this.drawExpandedGroup(a)):this.drawExpandedGroup(a):Gb.vector.GroupUI.superClass.paintBody.apply(this,arguments)},validateBodyBounds:function(){if(this.getBodyRect(),this._shapeRect){var a=this.getPathRect("group",!1),b=this.getStyle("group.deep");Rb.grow(a,b+1,b+1),this.addBodyBounds(a)}else Gb.vector.GroupUI.superClass.validateBodyBounds.call(this)},getZoomBodyRect:function(){return this._element.isExpanded()?this.getBodyRect():Gb.vector.GroupUI.superClass.getZoomBodyRect.call(this)},getZoomViewRect:function(){return this._element.isExpanded()?this.getViewRect():Gb.vector.GroupUI.superClass.getZoomViewRect.call(this)},drawExpandedGroup:function(a){this.drawPath(a,"group",!1,this._element.getStyle("vector.outline.pattern"));var b=this.getStyle("group.deep"),c=this.getStyle("group.fill.color");0!==b&&c&&"rectangle"===this.getStyle("group.shape")&&Vb.draw3DRect(a,c,b,this._shapeRect)},getChildrenRects:function(){return this._network.getGroupChildrenRects(this._element)},createBodyRect:function(){this._shapeRect=null;var a=this._element,b=this._network;if(a.isExpanded()){a.getChildren().forEach(function(a){var c=b.getElementUI(a);c&&c.validate()});var c=this.getChildrenRects();if(!c.isEmpty()){var d=a.getStyle("group.shape"),e=Sb[d];if(!e)throw"Can not resolve group shape '"+d+"'";this._shapeRect=e(c)}}return this._shapeRect?(Rb.addPadding(this._shapeRect,a,"group.padding",1),this._shapeRect):Gb.vector.GroupUI.superClass.createBodyRect.call(this)},appendShadowBound:function(a,b){var c=a.isShadowable()&&this._shadowColor&&!this._editAttachment;if(c){this._shadowXOffset>0?b.width+=this._shadowXOffset:(b.x+=this._shadowXOffset,b.width+=-this._shadowXOffset),this._shadowYOffset>0?b.height+=this._shadowYOffset:(b.y+=this._shadowYOffset,b.height+=-this._shadowYOffset);var d=this._shadowBlur;Rb.grow(b,d+1,d+1)}return b}}),Gb.vector.ShapeNodeUI=function(a,b){Gb.vector.ShapeNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.ShapeNodeUI",Gb.vector.NodeUI,{getDefaultBodyRect:function(){return this._element._points.size()<2?null:this._reverseZoomPathRect()},drawDefaultBody:function(a){this._element._points.size()<2||(this.drawPath(a,"vector",!0,this._element.getStyle("vector.outline.pattern"),this._getZoomPoints(),this._element._segments,this._element.getStyle("shapenode.closed")),nd.drawLinkArrow(this,a,Rb.getPointObject(this._element._points,this._element._segments)))},invalidateZoom:function(){this._zoomPoints=null,Gb.vector.LinkUI.superClass.invalidateZoom.call(this)},_getZoomPoints:function(){return this._zoomPoints=this._network.zoomManager._getShapeNodeZoomPoints(this,this._element._points),this._zoomPoints},_reverseZoomPathRect:function(){return this._network.zoomManager._reverseElementZoomRect(this,this.getZoomPathRect("vector",!0))}}),Gb.vector.ShapeLinkUI=function(a,b){Gb.vector.ShapeLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.ShapeLinkUI",Gb.vector.LinkUI,{isEditable:function(){return!0},createLinkPoints:function(){var a=this.getFromPoint(),b=this.getToPoint(),c=new Gb.List,d=this.getStyle("shapelink.type");c.add(a),null!=this._element._points&&c.addAll(this._network.zoomManager._getShapeLinkZoomPoints(this._element._points)),c.add(b);var e,f,g;if("lineto"===d);else if("quadto"===d){for(e=new Gb.List(c.get(0)),f=1,pointCount=c.size();f<pointCount;f++)e.add(f<pointCount-1?new Gb.List([c.get(f++),c.get(f)]):c.get(f));c=e}else if("cubicto"===d){for(e=new Gb.List(c.get(0)),f=1,pointCount=c.size();f<pointCount;f++)e.add(f<pointCount-2?new Gb.List([c.get(f++),c.get(f++),c.get(f)]):f<pointCount-1?new Gb.List([c.get(f++),c.get(f)]):c.get(f));c=e}else{if("orthogonalto"!==d)throw"Can not resolve shapelink type '"+d+"'";for(g=c.get(0),e=new Gb.List(g),f=1,pointCount=c.size();f<pointCount;f++)if(f<pointCount-1){var h=Hb.clone(c.get(f)),i=h.x,j=h.y,k=i-g.x,l=j-g.y;Math.abs(k)>Math.abs(l)?(h.x=i,h.y=g.y):(h.x=g.x,h.y=j),g=h,e.add(g)}else e.add(c.get(f));c=e}var m,n,o,h,p,k,l,q=Rb.calculateLineLength(c)/2,r=c.size(),s=0,t=0;for(m=0;r>m;m++)if(h=c.get(m),0!=m){if(o=h,o instanceof md&&(o=o._as),o instanceof Array?(p=Rb.calculateCurveLength(n,o,1),n=o[o.length-1]):(l=h.y-n.y,k=h.x-n.x,p=Math.sqrt(k*k+l*l),n=o),t+=p,q>=s&&t>=q){var u=q-s,v=c.get(m-1);v instanceof md&&(v=v._as,v instanceof Array&&(v=v[v.length-1]));var w=c.get(m),x=Rb.getPathInfo(w,v,u,0,-1).point;this._hotSpot=Hb.clone(x)}s=t}else n=h;return c},_growLinkJoinBounds:function(a,b){Rb.grow(a,3*b,3*b)}}),Gb.vector.GridUI=function(a,b){Gb.vector.GridUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.GridUI",Gb.vector.NodeUI,{drawDefaultBody:function(a){this._element.getImage()?Gb.vector.GridUI.superClass.drawDefaultBody.apply(this,arguments):this.drawGridBody(a)},validateBodyBounds:function(){if(this._element.getImage())Gb.vector.GridUI.superClass.validateBodyBounds.call(this);else{var a=this.getBodyRect(),b=Hb.clone(a),c=this._element.getStyle("outer.width");Rb.grow(b,c,c),this.appendShadowBound(this,b),this.addBodyBounds(b)}},_getZoomCellRect:function(a,b){var c=this._element.getCellRect(a,b),d=this._element.getRect(),e=d.x+d.width/2,f=d.y+d.height/2,g=this.getZoomBodyRect(),h=g.width/d.width,i=g.x+g.width/2,j=0==e?1:i/e;return{x:e*j+(c.x-e)*h,y:f*j+(c.y-f)*h,width:c.width*h,height:c.height*h}},drawGridBody:function(a){var b=this.getStyle("grid.fill"),c=this.getStyle("grid.deep"),d=this.getStyle("grid.cell.deep");if(b||0!==c||0!==d){a.beginPath();var e=this.getZoomBodyRect(),f=this.getDyeColor("grid.fill.color");if(this.setGlow(this,a),this.setShadow(this,a),b&&(a.fillStyle=f,a.rect(e.x,e.y,e.width,e.height),a.fill()),a.closePath(),this.clearShadow(a),a.beginPath(),0!=c&&Vb.draw3DRect(a,f,c,e.x,e.y,e.width,e.height),a.closePath(),0!=d)for(var g=this.getStyle("grid.row.count"),h=this.getStyle("grid.column.count"),i=0;g>i;i++)for(var j=0;h>j;j++){var k=this._getZoomCellRect(i,j);null!=k&&(a.beginPath(),Vb.draw3DRect(a,f,d,k.x,k.y,k.width,k.height),a.closePath())}}}}),Gb.vector.RotatableNodeUI=function(a,b){Gb.vector.RotatableNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.RotatableNodeUI",Gb.vector.NodeUI,{isEditable:function(){return!1},getDefaultBodyRect:function(){var a=this._element,b=Hb.getImageAsset(a.getImage()),c=this.getBodyRect();return b?(Rb.addPadding(c,this._element,"image.padding",1),c):c},drawDefaultBody:function(a){var b=this._element,c=Hb.getImageAsset(b.getImage());if(c){var d=this.getBodyRect();if(Rb.addPadding(d,this._element,"image.padding",1),c.getImage()){var e=this._element._getOrignalWidth(),f=this._element._getOrignalHeight(),g=this._element._getRotateRect();a.save(),a.translate(d.x-g.x+e/2,d.y-g.y+f/2),a.rotate(this._element._angle*Math.PI/180),a.drawImage(c.getImage(this._innerColor),-e/2,-f/2,e,f),a.restore()}else if(c.getSrc());else if(!c.getFunction())throw"ImageAsset '"+b.getImage()+" ' is empty"}}}),Gb.vector.HTMLNodeUI=function(a,b){Gb.vector.HTMLNodeUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.HTMLNodeUI",Gb.vector.NodeUI,{checkAttachments:function(){Gb.vector.NodeUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.vector.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._element.getStyle("attachment.label2.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkLabel2Attachment.call(this);var b=this._network.getLabel2(this._element);null!=b&&""!==b?this._label2Attachment||(this._label2Attachment=new Gb.vector.HTMLLabel2Attachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))},validateZIndex:function(a){this._labelAttachment&&this._labelAttachment.validateZIndex(a)}}),Gb.vector.HTMLLinkUI=function(a,b){Gb.vector.HTMLLinkUI.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.HTMLLinkUI",Gb.vector.LinkUI,{checkAttachments:function(){Gb.vector.LinkUI.prototype.checkAttachments.call(this)},checkLabelAttachment:function(){var a=this._element.getStyle("attachment.label.style");if(a&&"none"===a)return void Gb.vector.HTMLLinkUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel(this._element);null!=b&&""!==b?this._labelAttachment||(this._labelAttachment=new Gb.vector.HTMLLabelAttachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._labelAttachment)):this._labelAttachment&&(this.removeAttachment(this._labelAttachment),this._labelAttachment=null)},checkLabel2Attachment:function(){var a=this._element.getStyle("attachment.label2.style");if(a&&"none"===a)return void Gb.vector.HTMLNodeUI.superClass.checkLabelAttachment.call(this);var b=this._network.getLabel2(this._element);null!=b&&""!==b?this._label2Attachment||(this._label2Attachment=new Gb.vector.HTMLLabel2Attachment(this,Dd.SHOW_LABEL_IN_ATTACHMENT_DIV),this.addAttachment(this._label2Attachment)):this._label2Attachment&&(this.removeAttachment(this._label2Attachment),this._label2Attachment=null)},checkAlarmAttachment:function(){var a=this._element.getStyle("attachment.alarm.style");if(a&&"none"===a)return void Gb.vector.HTMLLinkUI.superClass.checkAlarmAttachment.call(this);var b=this._network.getAlarmLabel(this._element);null!=b&&""!==b?this._alarmAttachment||(this._alarmAttachment=new Gb.vector.HTMLAlarmAttachment(this,!1),this.addAttachment(this._alarmAttachment)):this._alarmAttachment&&(this.removeAttachment(this._alarmAttachment),this._alarmAttachment=null)},setAttachmentVisible:function(a){a?(this._labelAttachment&&this._labelAttachment.setVisibility("visible"),this._label2Attachment&&this._label2Attachment.setVisibility("visible"),this._alarmAttachment&&this._alarmAttachment.setVisibility("visible")):(this._labelAttachment&&this._labelAttachment.setVisibility("hidden"),this._label2Attachment&&this._label2Attachment.setVisibility("hidden"),this._alarmAttachment&&this._alarmAttachment.setVisibility("hidden"))}}),Gb.vector.Attachment=function(a,b){this._ui=a,this._element=this._ui.getElement(),this._network=a.getNetwork(),this._showOnTop=b,b&&this._network._hitTestTopAttachmentList.add(this)},Hb.ext("twaver.vector.Attachment",Object,{getElement:function(){return this._element},getElementUI:function(){return this._ui},getNetwork:function(){return this._network},isShowOnTop:function(){return this._showOnTop===!0},setShowOnTop:function(a){this._showOnTop=a},getStyle:function(a){return this._ui.getStyle(a)},getFont:function(a){return this._ui.getFont(a)},getViewRect:function(){return Hb.clone(this._viewRect)},getAlpha:function(){return 1},validate:function(){},paint:function(a){},getZoomViewRect:function(){var a=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._viewRect);return a},hit:function(a,b){return Rb.containsPoint(this.getZoomViewRect(),a,b)?this.hitCanvasRect({x:a-1,y:b-1,width:2,height:2}):!1},hitCanvasRect:function(a){var b=Od.getHitCanvas(a.width,a.height),c=Od.getCtx(b);c.save(),c.translate(-a.x,-a.y),this.paint(c);try{for(var d=c.getImageData(0,0,a.width,a.height),e=d.data,f=0;f<d.width;f++)for(var g=0;g<d.height;g++){var h=4*(g*d.width+f),i=e[h+3];if(0!==i)return c.restore(),!0}}catch(j){Od.disposeHitCanvas()}return c.restore(),!1},dispose:function(){this._network._hitTestTopAttachmentList.remove(this)},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e}}),Gb.vector.BasicAttachment=function(a,b){Gb.vector.BasicAttachment.superClass.constructor.call(this,a,b),this._roundRect={x:0,y:0,width:0,height:0},this._contentRect={x:0,y:0,width:0,height:0}},Hb.ext("twaver.vector.BasicAttachment",Gb.vector.Attachment,{paint:function(a){Gb.vector.BasicAttachment.superClass.paint.apply(this,arguments);var b=this.isFill(),c=this.getOutlineWidth(),d=this._network.zoomManager._getAttachmentZoomOutLineRect(this,this._roundRect);if(this.getElementUI().setGlow(this,a),this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._network._debug&&Vb.strokeRect(a,d,"#C71585"),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}},validate:function(){Gb.vector.BasicAttachment.superClass.validate.call(this),this.calculateMeasure();var a=this.getOutlineWidth();(null==a||0>=a)&&(a=1),this._viewRect=Rb.getRect(this._pointers),this._viewRect=Rb.unionRect(this._viewRect,this._roundRect),a>0&&Rb.grow(this._viewRect,2*a,2*a),this._viewRect=this._ui.appendShadowBound(this,this._viewRect);var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){var c=this._viewRect.x+this._viewRect.width/2,d=this._viewRect.y+this._viewRect.height/2,e=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:c-e,y:d-e,width:2*e,height:2*e}}},calculateMeasure:function(){var a=this.getContentWidth(),b=this.getContentHeight(),c=this.getCornerRadius(),d=this.getPointerLength(),e=this.getPointerWidth(),f=this.getPosition(),g=this.getXOffset(),h=this.getYOffset(),i=this._roundRect;i.width=a+c,i.height=b;var j;if(this._ui._element instanceof Gb.Link){var k,l=this._ui.getLinkPoints();k=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(g)>0&&Math.abs(g)<1?"from"===f?g*=k:"to"===f?g=k*(1-g):(g/=2,g+=.5,g*=k):"from"===f?g=g:"to"===f?g=k-g:g+=k/2;{var m,n=Rb.calculatePointInfoAlongLine(l,!0,g,h),o=n.point;n.angle}m="from"===f?this._ui.getFromPoint():"to"===f?this._ui.getToPoint():this._ui._hotSpot,g=o.x-m.x,h=o.y-m.y}if(d>0){var p=this.getDirection();j=this._network.getPosition(f,this._ui,null,g,h,!1);var q;if("aboveleft"===p)i.y=j.y-d-i.height,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("aboveright"===p)i.y=j.y-d-i.height,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y-d},{x:q,y:j.y-d}];else if("belowleft"===p)i.y=j.y+d,i.x=j.x-(i.width-c),q=Math.max(j.x-e,j.x-(i.width-c)+c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("belowright"===p)i.y=j.y+d,i.x=j.x-c,q=Math.min(j.x+e,j.x-c+i.width-c/2),this._pointers=[j,{x:j.x,y:j.y+d},{x:q,y:j.y+d}];else if("leftabove"===p)i.y=j.y+c-i.height,i.x=j.x-d-i.width,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("leftbelow"===p)i.y=j.y-c,i.x=j.x-d-i.width,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x-d,y:j.y},{x:j.x-d,y:q}];else if("rightabove"===p)i.y=j.y+c-i.height,i.x=j.x+d,q=Math.max(j.y-e,j.y+c-i.height+c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("rightbelow"===p)i.y=j.y-c,i.x=j.x+d,q=Math.min(j.y+e,j.y-c+i.height-c/2),this._pointers=[j,{x:j.x+d,y:j.y},{x:j.x+d,y:q}];else if("above"===p)i.y=j.y-d-i.height,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y-d},{x:j.x+q,y:j.y-d}];else if("below"===p)i.y=j.y+d,i.x=j.x-i.width/2,q=Math.min(a/2,e/2),this._pointers=[j,{x:j.x-q,y:j.y+d},{x:j.x+q,y:j.y+d}];else if("left"===p)i.y=j.y-i.height/2,i.x=j.x-d-i.width,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x-d,y:j.y+q},{x:j.x-d,y:j.y-q}];else{if("right"!==p)throw"Can not resolve '"+p+"' attachment direction";i.y=j.y-i.height/2,i.x=j.x+d,q=Math.min(b/2,e/2),this._pointers=[j,{x:j.x+d,y:j.y+q},{x:j.x+d,y:j.y-q}]}}else j=this._network.getPosition(f,this._ui,{width:i.width,height:i.height},g,h,!1),i.x=j.x,i.y=j.y,this._pointers=null;this._contentRect.x=i.x+(i.width-a)/2,this._contentRect.y=i.y+(i.height-b)/2,this._contentRect.width=a,this._contentRect.height=b;var r=this.getPadding();0!=r&&Rb.grow(i,r,r),r=this.getPaddingLeft(),0!=r&&(i.x-=r,i.width+=r),r=this.getPaddingRight(),0!=r&&(i.width+=r),r=this.getPaddingTop(),0!=r&&(i.y-=r,i.height+=r),r=this.getPaddingBottom(),0!=r&&(i.height+=r),i.width<0&&(i.width=i.width,i.x-=i.width),i.height<0&&(i.height=-i.height,i.y-=i.height)},getContentWidth:function(){return Gb.Defaults.ATTACHMENT_CONTENT_WIDTH},getContentHeight:function(){return Gb.Defaults.ATTACHMENT_CONTENT_HEIGHT},getCornerRadius:function(){return Gb.Defaults.ATTACHMENT_CORNER_RADIUS},getPointerLength:function(){return Gb.Defaults.ATTACHMENT_POINTER_LENGTH},getPointerWidth:function(){return Gb.Defaults.ATTACHMENT_POINTER_WIDTH},getPosition:function(){return Gb.Defaults.ATTACHMENT_POSITION},getXOffset:function(){return Gb.Defaults.ATTACHMENT_XOFFSET},getYOffset:function(){return Gb.Defaults.ATTACHMENT_YOFFSET},getPadding:function(){return Gb.Defaults.ATTACHMENT_PADDING},getPaddingLeft:function(){return Gb.Defaults.ATTACHMENT_PADDING_LEFT},getPaddingRight:function(){return Gb.Defaults.ATTACHMENT_PADDING_RIGHT},getPaddingTop:function(){return Gb.Defaults.ATTACHMENT_PADDING_TOP},getPaddingBottom:function(){return Gb.Defaults.ATTACHMENT_PADDING_BOTTOM},getDirection:function(){return Gb.Defaults.ATTACHMENT_DIRECTION},isFill:function(){return Gb.Defaults.ATTACHMENT_FILL},getFillColor:function(){return Gb.Defaults.ATTACHMENT_FILL_COLOR},getGradient:function(){return Gb.Defaults.ATTACHMENT_GRADIENT},getGradientColor:function(){return Gb.Defaults.ATTACHMENT_GRADIENT_COLOR},getOutlineWidth:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_WIDTH},getOutlineColor:function(){return Gb.Defaults.ATTACHMENT_OUTLINE_COLOR},getCap:function(){return Gb.Defaults.ATTACHMENT_CAP},getJoin:function(){return Gb.Defaults.ATTACHMENT_JOIN},isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},getRoundRect:function(){return Hb.clone(this._roundRect)},getContentRect:function(){return Hb.clone(this._contentRect)}}),Gb.vector.LabelAttachment=function(a,b){Gb.vector.LabelAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.LabelAttachment",Gb.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this.getZoomViewRect(),d=c.x+c.width/2,e=c.y+c.height/2;a.translate(d,e),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-d,-e)}Gb.vector.LabelAttachment.superClass.paint.apply(this,arguments);var f=this._network.zoomManager,g=f._getAttachmentZoomRect(this,this._contentRect),h=this._element.getStyle("label.align"),i=this._element&&this._element.getStyle("label.rotate.angle");if(0!==i&&(a.save(),Gb.Util.rotateCanvas(a,this._contentRect,i)),f._drawText(this,a,this.text,g,this.font,this.getStyle("label.color"),h),(b||0!==i)&&a.restore(),this._network._debug){var j=this._viewRect;Vb.strokeRect(a,j,"#AAABBB")}},validate:function(){this.font=this.getFont("label.font");var a=this.getLabel(),b=Hb.g.getTextSize(this.font,a),c=this.getMaxLength();0!==c&&b.width>c?(this.text=Hb.g.getCollapseTextInLength(this.font,a,c),this._textSize=Hb.g.getTextSize(this.font,this.text)):(this.text=a,this._textSize=b),Gb.vector.LabelAttachment.superClass.validate.call(this);var d=this._viewRect,e=this._element&&this._element.getStyle("label.rotate.angle");if(0!==e){var f=new Gb.List;f.add({x:d.x,y:d.y}),f.add({x:d.x+d.width,y:d.y}),f.add({x:d.x+d.width,y:d.y+d.height}),f.add({x:d.x,y:d.y+d.height}),f=this._rotatePointList(f,e,d);var g=Gb.Util.getRect(f);this._viewRect=g}},getLabel:function(){return this._network.getLabel(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label.corner.radius")},getPointerLength:function(){return this.getStyle("label.pointer.length")},getPointerWidth:function(){return this.getStyle("label.pointer.width")},getPosition:function(){return this.getStyle("label.position")},getXOffset:function(){return this.getStyle("label.xoffset")},getYOffset:function(){return this.getStyle("label.yoffset")},getPadding:function(){return this.getStyle("label.padding")},getPaddingLeft:function(){return this.getStyle("label.padding.left")},getPaddingRight:function(){return this.getStyle("label.padding.right")},getPaddingTop:function(){return this.getStyle("label.padding.top")},getPaddingBottom:function(){return this.getStyle("label.padding.bottom")},getDirection:function(){return this.getStyle("label.direction")},isFill:function(){return this.getStyle("label.fill")},getFillColor:function(){return this.getStyle("label.fill.color")},getGradient:function(){return this.getStyle("label.gradient")},getGradientColor:function(){return this.getStyle("label.gradient.color")},getOutlineWidth:function(){return this.getStyle("label.outline.width")},getOutlineColor:function(){return this.getStyle("label.outline.color")},getCap:function(){return this.getStyle("label.cap")},getJoin:function(){return this.getStyle("label.join")},getAlpha:function(){return this.getStyle("label.alpha")},getMaxLength:function(){return this.getStyle("label.maxlength")},isShadowable:function(){return this.getStyle("label.shadowable")}}),Gb.vector.Label2Attachment=function(a,b){Gb.vector.Label2Attachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.Label2Attachment",Gb.vector.BasicAttachment,{paint:function(a){var b=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(b){a.save();var c=this.getZoomViewRect(),d=c.x+c.width/2,e=c.y+c.height/2;a.translate(d,e),a.rotate(this._network.getElementUI(this._element).getAngle()),a.translate(-d,-e)}Gb.vector.Label2Attachment.superClass.paint.apply(this,arguments);var f=this._network.zoomManager,g=f._getAttachmentZoomRect(this,this._contentRect),h=this._element.getStyle("label.align"),i=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==i&&(a.save(),Gb.Util.rotateCanvas(a,this._contentRect,i)),f._drawText(this,a,this.text,g,this.font,this.getStyle("label2.color"),h),(b||0!==i)&&a.restore(),this._network._debug){var j=f.getAttachmentSizeZoom(this),k=g;k.width*=j,k.height*=j,Vb.strokeRect(a,k,"#AAABBB")}},validate:function(){this.font=this.getFont("label2.font");var a=this.getLabel(),b=Hb.g.getTextSize(this.font,a),c=this.getMaxLength();0!==c&&b.width>c?(this.text=Hb.g.getCollapseTextInLength(this.font,a,c),this._textSize=Hb.g.getTextSize(this.font,this.text)):(this.text=a,this._textSize=b),Gb.vector.LabelAttachment.superClass.validate.call(this);var d=this._viewRect,e=this._element&&this._element.getStyle("label2.rotate.angle");if(0!==e){var f=new Gb.List;f.add({x:d.x,y:d.y}),f.add({x:d.x+d.width,y:d.y}),f.add({x:d.x+d.width,y:d.y+d.height}),f.add({x:d.x,y:d.y+d.height}),f=this._rotatePointList(f,e,d);var g=Gb.Util.getRect(f);this._viewRect=g}},getLabel:function(){return this._network.getLabel2(this._element)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},getMaxLength:function(){return this.getStyle("label2.maxlength")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),Gb.vector.AlarmAttachment=function(a,b){Gb.vector.AlarmAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.AlarmAttachment",Gb.vector.BasicAttachment,{paint:function(a){Gb.vector.AlarmAttachment.superClass.paint.apply(this,arguments);var b=this._network.zoomManager,c=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.text,c,this.font,this.getStyle("alarm.color"))},validate:function(){this.font=this.getFont("alarm.font"),this.text=this._network.getAlarmLabel(this._element),this._textSize=Vb.getTextSize(this.font,this.text),this._fillColor=this._network.getAlarmFillColor(this._element),Gb.vector.AlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("alarm.corner.radius")},getPointerLength:function(){return this.getStyle("alarm.pointer.length")},getPointerWidth:function(){return this.getStyle("alarm.pointer.width")},getPosition:function(){return this.getStyle("alarm.position")},getXOffset:function(){return this.getStyle("alarm.xoffset")},getYOffset:function(){return this.getStyle("alarm.yoffset")},getPadding:function(){return this.getStyle("alarm.padding")},getPaddingLeft:function(){return this.getStyle("alarm.padding.left")},getPaddingRight:function(){return this.getStyle("alarm.padding.right")},getPaddingTop:function(){return this.getStyle("alarm.padding.top")},getPaddingBottom:function(){return this.getStyle("alarm.padding.bottom")},getDirection:function(){return this.getStyle("alarm.direction")},isFill:function(){return null!=this._fillColor},getFillColor:function(){return this._fillColor},getGradient:function(){return this.getStyle("alarm.gradient")},getGradientColor:function(){return this.getStyle("alarm.gradient.color")},getOutlineWidth:function(){return this.getStyle("alarm.outline.width")},getOutlineColor:function(){return this.getStyle("alarm.outline.color")},getCap:function(){return this.getStyle("alarm.cap")},getJoin:function(){return this.getStyle("alarm.join")},getAlpha:function(){return this.getStyle("alarm.alpha")},isShadowable:function(){return this.getStyle("alarm.shadowable")}}),Gb.vector.LinkHandlerAttachment=function(a,b){Gb.vector.LinkHandlerAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.LinkHandlerAttachment",Gb.vector.BasicAttachment,{paint:function(a){var b=this._network.zoomManager;Gb.vector.LinkHandlerAttachment.superClass.paint.apply(this,arguments);var c=b._getAttachmentZoomRect(this,this._contentRect);b._drawText(this,a,this.linkHandlerLabel,c,this.linkHandlerFont,this.getStyle("link.handler.color"))},validate:function(){this.linkHandlerFont=this.getFont("link.handler.font"),this.linkHandlerLabel=this._network.getLinkHandlerLabel(this._element),this._textSize=Vb.getTextSize(this.linkHandlerFont,this.linkHandlerLabel),Gb.vector.LinkHandlerAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._textSize?this._textSize.width:0},getContentHeight:function(){return this._textSize?this._textSize.height:0},getCornerRadius:function(){return this.getStyle("link.handler.corner.radius")},getPointerLength:function(){return this.getStyle("link.handler.pointer.length")},getPointerWidth:function(){return this.getStyle("link.handler.pointer.width")},getPosition:function(){return this.getStyle("link.handler.position")},getXOffset:function(){return this.getStyle("link.handler.xoffset")},getYOffset:function(){return this.getStyle("link.handler.yoffset")},getPadding:function(){return this.getStyle("link.handler.padding")},getPaddingLeft:function(){return this.getStyle("link.handler.padding.left")},getPaddingRight:function(){return this.getStyle("link.handler.padding.right")},getPaddingTop:function(){return this.getStyle("link.handler.padding.top")},getPaddingBottom:function(){return this.getStyle("link.handler.padding.bottom")},getDirection:function(){return this.getStyle("link.handler.direction")},isFill:function(){return this.getStyle("link.handler.fill")},getFillColor:function(){return this.getStyle("link.handler.fill.color")},getGradient:function(){return this.getStyle("link.handler.gradient")},getGradientColor:function(){return this.getStyle("link.handler.gradient.color")},getOutlineWidth:function(){return this.getStyle("link.handler.outline.width")},getOutlineColor:function(){return this.getStyle("link.handler.outline.color")},getCap:function(){return this.getStyle("link.handler.cap")},getJoin:function(){return this.getStyle("link.handler.join")},getAlpha:function(){return this.getStyle("link.handler.alpha")},isShadowable:function(){return this.getStyle("link.handler.shadowable")}}),Gb.vector.IconsAttachment=function(a,b){Gb.vector.IconsAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.IconsAttachment",Gb.vector.Attachment,{isShadowable:function(){return Gb.Defaults.ATTACHMENT_SHADOWABLE},validate:function(){if(Gb.vector.IconsAttachment.superClass.validate.call(this),this.iconsNames=this._network.getIconsNames(this._element),this.iconsNames&&0!=this.iconsNames.length){var a=this._makeGroup(this.iconsNames),b=this._makeGroup(this._network.getIconsColors(this._element)),c=this._network.zoomManager;len=a.length,this.iconsOrientation=this._makeArray(this._element.getStyle("icons.orientation"),len,"right"),this.iconsPosition=this._makeArray(this._element.getStyle("icons.position"),len,"topleft.bottomright"),this.iconsXoffset=this._makeArray(this._element.getStyle("icons.xoffset"),len,0),this.iconsYoffset=this._makeArray(this._element.getStyle("icons.yoffset"),len,0),this.iconsXgap=this._makeArray(this._element.getStyle("icons.xgap"),len,1),this.iconsYgap=this._makeArray(this._element.getStyle("icons.ygap"),len,1),this.locations=[],this.iconsSizes=[],
this.iconsOrientations=[];var d,e,f;for(i=0;i<len;i++){var g=a[i],f=this.iconsOrientation[i]||"right",h=this.iconsPosition[i]||"topleft.bottomright",j=this.iconsXgap[i]||1,k=this.iconsYgap[i]||1,l=this.iconsXoffset[i]||0,m=this.iconsYoffset[i]||0;if(this._ui._element instanceof Gb.Link){var n,o=this._ui.getLinkPoints();n=this._ui.getLineLength?this._ui.getLineLength():this._ui._element.getLineLength(),Math.abs(l)>0&&Math.abs(l)<1?"from"===h?l*=n:"to"===h?l=n*(1-l):(l/=2,l+=.5,l*=n):"from"===h?l=l:"to"===h?l=n-l:l+=n/2;{var p,q=Rb.calculatePointInfoAlongLine(o,!0,l,m),r=q.point;q.angle}p="from"===h?this._ui.getFromPoint():"to"===h?this._ui.getToPoint():this._ui._hotSpot,l=r.x-p.x,m=r.y-p.y}e=null,d=this._getIconsSize(g,f,j,k,c),d&&(e=this._network.getPosition(h,this._ui,d,l,m),this._iconLocation=e,"top"===f?e.y+=d.height:"left"===f&&(e.x+=d.width)),this.locations.push(e),this.iconsSizes.push(d),this.iconsOrientations.push(f)}var s=null;for(i=0;i<this.locations.length;i++)e=this.locations[i],d=this.iconsSizes[i],f=this.iconsOrientations[i],null!=e&&(s=null==s?"top"===f?{x:e.x,y:e.y-d.height,width:d.width,height:d.height}:"left"===f?{x:e.x-d.width,y:e.y,width:d.width,height:d.height}:{x:e.x,y:e.y,width:d.width,height:d.height}:"top"===f?Rb.unionRect(s,{x:e.x,y:e.y-d.height,width:d.width,height:d.height}):"left"===f?Rb.unionRect(s,{x:e.x-d.width,y:e.y,width:d.width,height:d.height}):Rb.unionRect(s,{x:e.x,y:e.y,width:d.width,height:d.height}));this._viewRect=c?s||this.getElementUI().getViewRect():s||{x:this._element.getLocation().x,y:this._element.getLocation().y,width:0,height:0},this.iconsGroups=a,this.colorGroups=b;var t=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");for(i=0;i<len;i++)if(t instanceof Array&&t[i]&&this._viewRect){var u=this._viewRect.x+this._viewRect.width/2,v=this._viewRect.y+this._viewRect.height/2,w=Math.sqrt(this._viewRect.height*this._viewRect.height+this._viewRect.width*this._viewRect.width);this._viewRect={x:u-w/2,y:v-w/2,width:w,height:w}}}},_makeGroup:function(a){if(!Array.isArray(a))return[[a]];var b,c,d,e=[],f=!1,g=a.length;for(b=0;g>b;b++)c=a[b],Array.isArray(c)?(f=!0,e.push(c)):(d=[c],e.push(d));return f||(e.length=0,e.push(a)),e},_makeArray:function(a,b,c){if(Array.isArray(a))return a;for(var d=[],e=0;b>e;e++)d.push(a||c);return d},paint:function(a){if(Gb.vector.IconsAttachment.superClass.paint.apply(this,arguments),this.iconsNames&&0!=this.iconsNames.length&&this.locations){var b,c,d,e,f,g,h,i,j,k,l=this._network.zoomManager;for(b=0;b<this.iconsGroups.length;b++)if(c=this.locations[b]){f=c.x,g=c.y,e=this.iconsGroups[b],h=this.colorGroups[b],i=this.iconsOrientation[b],j=this.iconsXgap[b]||1,k=this.iconsYgap[b]||1,d=0;for(var m in e){var n=null,o=null;h&&h.length>d&&(o=h[d++]);var p=Hb.getImageAsset(e[m]);if(null!=p){if(l&&this._ui instanceof Gb.vector.GroupUI&&this._ui._shapeRect){var q=l.getAttachmentSizeZoom(this),r=p.getWidth()*q,s=p.getHeight()*q;if("right"===i)n={x:f,y:g,width:r,height:s},f+=n.width+j;else if("left"===i)n={x:f-r,y:g,width:r,height:s},f-=n.width+j;else if("top"===i)n={x:f,y:g-s,width:r,height:s},g-=n.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";n={x:f,y:g,width:r,height:s},g+=n.height+k}}else{if("right"===i)n={x:f,y:g,width:p.getWidth(),height:p.getHeight()},f+=n.width+j;else if("left"===i)n={x:f-p.getWidth(),y:g,width:p.getWidth(),height:p.getHeight()},f-=n.width+j;else if("top"===i)n={x:f,y:g-p.getHeight(),width:p.getWidth(),height:p.getHeight()},g-=n.height+k;else{if("bottom"!==i)throw"Can not resolve '"+i+"' orientation";n={x:f,y:g,width:p.getWidth(),height:p.getHeight()},g+=n.height+k}n=l._getAttachmentZoomOutLineRect(this,n)}var t=this._element instanceof Gb.Link&&this._element.getStyle("link.icons.rotatable");if(t instanceof Array&&t[b]){a.save();var u=n,f=u.x+u.width/2,g=u.y+u.height/2;a.translate(f,g),a.rotate(this._network.getElementUI(this._element).getAbsoluteAngle()),a.translate(-f,-g),Mc(a,p.getImage(o,n.width,n.height),o,n,this._element,this._network),a.restore()}else Mc(a,p.getImage(o,n.width,n.height),o,n,this._element,this._network);if(this._network._debug){var n=this._viewRect;Vb.strokeRect(a,n,"#FCFC00",1),Vb.strokeRect(a,n,"#FCFC00",1)}}}}}},_getIconsSize:function(a,b,c,d,e){var f=0,g=0,h=null,i=null,j=null;for(var k in a)if(i=Hb.getImageAsset(a[k])){if("right"===b)h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},f+=h.width+c;else if("left"===b)h={x:f-i.getWidth(),y:g,width:i.getWidth(),height:i.getHeight()},f-=h.width+c;else if("top"===b)h={x:f,y:g-i.getHeight(),width:i.getWidth(),height:i.getHeight()},g-=h.height+d;else{if("bottom"!==b)throw"Can not resolve '"+b+"' orientation";h={x:f,y:g,width:i.getWidth(),height:i.getHeight()},g+=h.height+d}j=null==j?Hb.clone(h):Rb.unionRect(j,h)}return j?e&&this._ui instanceof Gb.vector.GroupUI&&this._ui._shapeRect?{width:Math.abs(j.width)*e.getAttachmentSizeZoom(this),height:Math.abs(j.height)*e.getAttachmentSizeZoom(this)}:{width:Math.abs(j.width),height:Math.abs(j.height)}:null}}),Gb.vector.EditAttachment=function(a,b){Gb.vector.EditAttachment.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.EditAttachment",Gb.vector.Attachment,{paint:function(a){Gb.vector.EditAttachment.superClass.paint.apply(this,arguments),this.paintResizingPoints(a),this.paintEditPoints(a),this.paintRotatePoints(a)},paintResizingPoints:function(a){var b=this.resizingPoints.size();if(!(0>=b)){var c=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),d=this.resizePointSize/c,e=2*d,f=2*d,g=this._network.getResizePointFillColor(),h=this._network.getResizePointOutlineWidth()/c,i=this._network.getResizePointOutlineColor(),j=this._element.getAngle(),k=this._network.zoomManager,l=k._getElementZoomRect(this.getElementUI(),this._element.getOriginalRect());a.lineWidth=h;for(var m=this.resizingPoints,n=0;b>n;n++){var o=m.get(n),p={x:o.x-d,y:o.y-d,width:2*d,height:2*d},q=this._getRotateRect(p,j,{x:l.x+l.width/2,y:l.y+l.height/2});a.save(),Gb.Util.rotateCanvas(a,q,j),Od.rect(a,q.x,q.y,e,f),a.restore()}if(a.fillStyle=g,a.strokeStyle=i,a.fill(),a.stroke(),this._network._debug){var r=this.getViewRect("resize");Vb.strokeRect(a,r,"#CCDDCC");var r=k._getElementZoomRect(this.getElementUI(),this.getElementUI()._viewRect);Vb.strokeRect(a,r,"#FD7766")}}},paintEditPoints:function(a){var b=this.editPoints.size();if(!(0>=b)){var c=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),d=this._network.getEditPointOutlineColor(),e=this._network.getEditPointFillColor(),f=this._network.getEditPointOutlineWidth()/c;a.beginPath(),a.lineWidth=f;for(var g=this.editPoints,h=0;b>h;h++){var i=g.get(h);a.beginPath(),Od.circle(a,i.x,i.y,this.editPointSize,e,d),a.closePath()}if(this._network._debug){var j=this.getViewRect("edit");Vb.strokeRect(a,j,"#AAABBC")}}},paintRotatePoints:function(a){var b=this.rotatePoints.size();if(!(0>=b)){var c=this._element.getStyle("edit.physicalZoom")?1:this._network.getGraphicsZoom(),d=this._network.getRotatePointOutlineColor(),e=this._network.getRotatePointFillColor(),f=this._network.getRotatePointOutlineWidth()/c;a.beginPath(),a.lineWidth=f;for(var g=this.rotatePoints,h=0;b>h;h++){var i=g.get(h);a.beginPath(),Od.circle(a,i.x,i.y,this.rotatePointSize/c,e,d),a.closePath(),a.beginPath()}if(this._network._debug){var j=this.getViewRect("rotate");Vb.strokeRect(a,j,"green")}}},getViewRect:function(a){if(a){if("resize"===a)return this._resizeRect;if("rotate"===a)return this._rotateRect;if("edit"===a)return this._editRect}return this._viewRect||{x:0,y:0,width:0,height:0}},validate:function(){Gb.vector.EditAttachment.superClass.validate.call(this);var a=this._network.getGraphicsZoom();this.editPointSize=this._network.getEditPointSize(),this.resizePointSize=this._network.getResizePointSize(),this.rotatePointSize=this._network.getRotatePointSize(),this.resizingPoints=new Gb.List,this.editPoints=new Gb.List,this.rotatePoints=new Gb.List,this._element instanceof Gb.Node&&this._addResizingPoint(this._element),!(this._network.isRotatable(this._element)&&this._element instanceof Ld)||this._element instanceof Gb.ShapeNode||this._element instanceof Gb.Grid||this._element instanceof Gb.Group||this._addRotatePoint(this._element),this._element instanceof Gb.ShapeNode&&(this._addResizingPoint(this._element),this._addShapeNodePoint(this._element)),this._ui instanceof Gb.vector.ShapeLinkUI&&this._addShapeLinkPoints(this._element),this._ui instanceof Gb.vector.LinkUI&&this._addLinkControlPoint(this._ui);var b=this._network.getResizePointOutlineWidth()/a,c=this.getElementUI().getZoomBodyRect(),d=2*Math.sqrt(2);if(this._resizeOffset=(this.resizePointSize+b+1)*d,Rb.grow(c,this._resizeOffset,this._resizeOffset),this._resizeRect=c,b=this._network.getEditPointOutlineWidth()/a,this.editPoints.size()>0){var e=Rb.getRect(this.editPoints);Rb.grow(e,2*this.editPointSize+2*b),c=Rb.unionRect(c,e)}this._editRect=e,b=this._network.getRotatePointOutlineWidth()/a;var f=this.rotatePointSize;if(this.rotatePoints.size()>0){var g=this.rotatePoints.get(0),h={x:g.x-f-b-1,y:g.y-f-b-1,width:2*f+2*b+2,height:2*f+2*b+2};c=Rb.unionRect(c,h),this._rotateRect=h}this._viewRect=c},_addResizingPoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(b){var c=this._network.getResizePointSize();if(!(0>=c)){var d=new md([{x:b.x,y:b.y},{x:b.x+b.width/2,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x,y:b.y+b.height/2},{x:b.x+b.width,y:b.y+b.height/2},{x:b.x,y:b.y+b.height},{x:b.x+b.width/2,y:b.y+b.height},{x:b.x+b.width,y:b.y+b.height}]),e=this._network.getResizePointOutlineWidth(),f=this._network.getResizePointOutlineColor(),g=this._network.getResizePointFillColor();this._addPoints(a.getRect(),d,e,f,g,!0)}}},_addRotatePoint:function(a){var b=this._network.zoomManager._getElementZoomRect(this.getElementUI(),a.getOriginalRect());if(b){var c=this._network.getRotatePointSize()/this._network.getGraphicsZoom();if(!(0>=c)){var d=2*c,e=new Gb.List([{x:b.x+b.width/2,y:b.y-this._network.getRotatePointOffset()/this._network.getGraphicsZoom()-c}]),f=a.getAngle();0!=f&&(e=this._rotatePointList(e,f,b));var g=e.get(0),h={x:g.x-d/2,y:g.y-d/2,width:d,height:d},i=this._network.getRotatePointOutlineWidth(),j=this.rotatePointSize+i;Rb.grow(b,j,j);{Rb.unionRect(a.getRect(),h)}this.rotatePoints=e}}},_addShapeNodePoint:function(a){var b=this._network.zoomManager._getShapeNodeZoomPoints(this.getElementUI(),a.getPoints());this._addEditPoints(b)},_addShapeLinkPoints:function(a){var b=this._network.zoomManager._getShapeLinkZoomPoints(a.getPoints());this._addEditPoints(b)},_addLinkControlPoint:function(a){var b,c=new Gb.List,d=a._element.getFromAgent();b=d?a._element.getFromAgent():a._element.getFromNode();var e=a._element.getStyle("link.from.xoffset"),f=a._element.getStyle("link.from.yoffset"),g=this._network.getElementUI(b),h=g.getZoomBodyRect(),i={x:h.x+h.width/2,y:h.y+h.height/2},j={x:i.x+e,y:i.y+f};c.add(j);var k,l=a._element.getToAgent();k=l?a._element.getToAgent():a._element.getToNode();var m=a._element.getStyle("link.to.xoffset"),n=a._element.getStyle("link.to.yoffset"),o=this._network.getElementUI(k),p=o.getZoomBodyRect(),q={x:p.x+p.width/2,y:p.y+p.height/2},r={x:q.x+m,y:q.y+n};if(c.add(r),wc.isOrthogonalLink(a._element)&&a.getControlPoint()){var s=a.getControlPoint();s&&c.add(s)}var t=this.editPoints.size();if(t>0)for(var u=0;t>u;u++)c.add(this.editPoints.get(u));this._addEditPoints(c)},_addEditPoints:function(a){var b=Rb.getRect(a);if(b){var c=this._network.getEditPointSize();if(!(0>=c)){var d=this._network.getEditPointOutlineWidth();this._addPoints(b,a,d,!1)}}},_addPoints:function(a,b,c,d,e,f){var g=f?this._network.getResizePointSize():this._network.getEditPointSize();if(!(0>g)){var h=g+c;Rb.grow(a,h,h),1==f?this.resizingPoints=b:this.editPoints=b}},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_rotatePointList:function(a,b,c){var d=this,e=new Gb.List;return a.forEach(function(a){e.add(d._rotatePoint(a,b,c))}),e},_getRotateRect:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x,c.y),e={x:a.x+a.width/2,y:a.y+a.height/2},f=d.transform(e),g=new Gb.List([{x:f.x-a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y-a.height/2},{x:f.x+a.width/2,y:f.y+a.height/2},{x:f.x-a.width/2,y:f.y+a.height/2}]);return Rb.getRect(g)}}),Gb.vector.HTMLLabelAttachment=function(a,b){Gb.vector.HTMLLabelAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv();this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.vector.HTMLLabelAttachment",Gb.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var a=this._element.getStyle("attachment.htmllabel.hyperlink");a?(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var b=(this.getFont("label.font"),this.getLabel());b!==this.text&&(this.text&&("object"==typeof this.text?window.jquery?window.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),b&&("object"==typeof b?window.jquery?window.jquery(this._contentDiv).append(b):this._contentDiv.appendChild(b):this._contentDiv.innerHTML=b),this.text=b),this._contentDiv.style.visibility="hidden",Gb.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(a){this._roundDiv.style.zIndex=1e5*a+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setGlow(this,a),this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("label.font"),this.getLabel(),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,Ob.isFirefox?(Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform-origin","0 0")):Ob.isOpera?(Gb.Util.setCSSStyle(this._contentDiv,"-o-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-o-transform-origin","0 0")):Ob.isChrome||Ob.isSafari?(Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform-origin","0 0")):Ob.isIE?(Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform-origin","0 0")):(Gb.Util.setCSSStyle(this._contentDiv,"transform","scale("+j+")"),Gb.Util.setCSSStyle(this._contentDiv,"transform-origin","0 0")),this._network._debug&&(Vb.strokeRect(a,this._contentRect,"blue"),Vb.strokeRect(a,this._roundRect,"red"),Vb.strokeRect(a,this._viewRect,"green"));var n=this._element instanceof Gb.Link&&this._element.getStyle("link.label.rotatable");if(n){{var o=this.getZoomViewRect(),p=(o.x+o.width/2,o.y+o.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*j,this._contentDiv.offsetHeight/2*j}Ob.isFirefox?Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isOpera?Gb.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isChrome||Ob.isSafari?Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+p+"deg) scale("+j+")"):Ob.isIE?Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Gb.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")")}},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.vector.HTMLLabel2Attachment=function(a,b){Gb.vector.HTMLLabel2Attachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv();this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.vector.HTMLLabel2Attachment",Gb.vector.LabelAttachment,{validate:function(){this.validateZIndex(0);var a=this._element.getStyle("attachment.htmllabel2.hyperlink");a?(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","auto"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","auto")):(Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none")),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap");var b=(this.getFont("label2.font"),this.getLabel());b!==this.text&&(this.text&&("object"==typeof this.text?window.jquery?window.jquery(this.text).remove():this._contentDiv.removeChild(this.text):this._contentDiv.innerHTML=""),b&&("object"==typeof b?window.jquery?window.jquery(this._contentDiv).append(b):this._contentDiv.appendChild(b):this._contentDiv.innerHTML=b),this.text=b),this._contentDiv.style.visibility="hidden",Gb.vector.HTMLLabelAttachment.superClass.validate.call(this)},validateZIndex:function(a){this._roundDiv.style.zIndex=1e5*a+this._network.getElementBox().getDatas().indexOf(this._element)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setGlow(this,a),this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("label2.font"),this.getLabel(),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&(Vb.strokeRect(a,this._contentRect,"blue"),Vb.strokeRect(a,this._roundRect,"red"),Vb.strokeRect(a,this._viewRect,"green"));var n=this._element instanceof Gb.Link&&this._element.getStyle("link.label2.rotatable");if(n){{var o=this.getZoomViewRect(),p=(o.x+o.width/2,o.y+o.height/2,180*this._network.getElementUI(this._element).getAbsoluteAngle()/Math.PI);this._contentDiv.offsetWidth/2*j,this._contentDiv.offsetHeight/2*j}Ob.isFirefox?Gb.Util.setCSSStyle(this._contentDiv,"-moz-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isOpera?Gb.Util.setCSSStyle(this._contentDiv,"-o-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Ob.isChrome||Ob.isSafari?Gb.Util.setCSSStyle(this._contentDiv,"-webkit-transform","translate(0px, 0px) rotate("+p+"deg) scale("+j+")"):Ob.isIE?Gb.Util.setCSSStyle(this._contentDiv,"-ms-transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")"):Gb.Util.setCSSStyle(this._contentDiv,"transform","translate(0px,0px) rotate("+p+"deg) scale("+j+")")}},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv},getLabel:function(){return this._network.getLabel2(this._element)},getCornerRadius:function(){return this.getStyle("label2.corner.radius")},getPointerLength:function(){return this.getStyle("label2.pointer.length")},getPointerWidth:function(){return this.getStyle("label2.pointer.width")},getPosition:function(){return this.getStyle("label2.position")},getXOffset:function(){return this.getStyle("label2.xoffset")},getYOffset:function(){return this.getStyle("label2.yoffset")},getPadding:function(){return this.getStyle("label2.padding")},getPaddingLeft:function(){return this.getStyle("label2.padding.left")},getPaddingRight:function(){return this.getStyle("label2.padding.right")},getPaddingTop:function(){return this.getStyle("label2.padding.top")},getPaddingBottom:function(){return this.getStyle("label2.padding.bottom")},getDirection:function(){return this.getStyle("label2.direction")},isFill:function(){return this.getStyle("label2.fill")},getFillColor:function(){return this.getStyle("label2.fill.color")},getGradient:function(){return this.getStyle("label2.gradient")},getGradientColor:function(){return this.getStyle("label2.gradient.color")},getOutlineWidth:function(){return this.getStyle("label2.outline.width")},getOutlineColor:function(){return this.getStyle("label2.outline.color")},getCap:function(){return this.getStyle("label2.cap")},getJoin:function(){return this.getStyle("label2.join")},getAlpha:function(){return this.getStyle("label2.alpha")},isShadowable:function(){return this.getStyle("label2.shadowable")}}),Gb.vector.HTMLAlarmAttachment=function(a,b){Gb.vector.HTMLAlarmAttachment.superClass.constructor.call(this,a,b),this._triangleDiv=Gb.Util.createDiv(),this._roundDiv=Gb.Util.createDiv(),this._contentDiv=Gb.Util.createDiv(),Gb.Util.setCSSStyle(this._triangleDiv,"border-style","solid"),Gb.Util.setCSSStyle(this._triangleDiv,"pointer-events","none"),Gb.Util.setCSSStyle(this._contentDiv,"white-space","nowrap"),Gb.Util.setCSSStyle(this._contentDiv,"pointer-events","none");this._network.getView().appendChild(this._roundDiv),this._roundDiv.appendChild(this._contentDiv)},Hb.ext("twaver.vector.HTMLAlarmAttachment",Gb.vector.AlarmAttachment,{validate:function(){var a=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element));this._contentDiv.innerHTML=a,this._contentDiv.style.visibility="hidden",Gb.vector.HTMLAlarmAttachment.superClass.validate.call(this)},getContentWidth:function(){return this._contentDiv.scrollWidth||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"width"))},getContentHeight:function(){return this._contentDiv.scrollHeight||parseInt(Gb.Util.getCSSStyle(this._contentDiv.firstChild,"height"))},paint:function(a){var b=this.isFill(),c=this.getOutlineWidth(),d=this._contentRect;if(this.getElementUI().setShadow(this,a),c>0||b){if(Vb.drawRoundRect(a,d.x,d.y,d.width,d.height,this.getCornerRadius()),this._pointers){var e=this._ui.getZoomPointers(this,this._pointers);a.moveTo(e[0].x,e[0].y),a.lineTo(e[1].x,e[1].y),a.lineTo(e[2].x,e[2].y)}if(a.closePath(),c>0&&(a.lineWidth=c,a.strokeStyle=this.getOutlineColor(),a.lineCap=this.getCap(),a.lineJoin=this.getJoin(),a.stroke()),b){var f=this.getFillColor(),g=this.getGradient();g?Vb.fill(a,f,g,this.getGradientColor(),this._viewRect):a.fillStyle=f,a.fill()}}var h=(this.getFont("alarm.font"),this._network.getAlarmLabel(this._element),this._network.getViewRect().x),i=this._network.getViewRect().y,j=this._network.getZoom(),k={x:this._contentRect.x+this._contentRect.width/2,y:this._contentRect.y+this._contentRect.height/2},l=k.x*j-h-this._contentDiv.offsetWidth/2*j+"px",m=k.y*j-i-this._contentDiv.offsetHeight/2*j+"px";this._contentDiv.style.left=l,this._contentDiv.style.top=m,this._contentDiv.style.setProperty("-webkit-transform","scale("+j+")",null),this._contentDiv.style.setProperty("-webkit-transform-origin","0 0",null),this._network._debug&&Vb.strokeRect(a,this._contentRect,"#DDDDDD"),Gb.vector.AlarmAttachment.superClass.paint.apply(this,arguments)},setVisibility:function(a){this._contentDiv.style.visibility=a},dispose:function(){this._network.getView().removeChild(this._roundDiv)},getView:function(){return this._roundDiv}}),Gb.vector.BaseZoomManager=function(a){this.network=a,this.visibilityThresholds=a.visibilityThresholds},Hb.ext("twaver.vector.BaseZoomManager",Object,{getZoom:function(){return this.network.getZoom()},getGraphicsZoom:function(){return 1},getSizeZoom:function(a){return 1},getAttachmentSizeZoom:function(a){var b=a.getElementUI();return this.getSizeZoom(b)},getLocationZoom:function(a){return 1},_getZoomVisibilityThresholds:function(){return this.network.getZoomVisibilityThresholds()},_convertPointFromView:function(a){var b=a.x*this.getGraphicsZoom()-this.network.getViewRect().x,c=a.y*this.getGraphicsZoom()-this.network.getViewRect().y;return{x:b,y:c}},_getElementViewRect:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d)return b;var e=this._getZoomPoint(a),f=e.x,g=e.y;return null==b&&console.log("View rect is null"),{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d,width:b.width*d,height:b.height*d}},_invalidateZoom:function(){this.network.invalidateElementUIs()},_getGroupChildrenRects:function(a){var b=new md;return a.getChildren().forEach(function(a){if(a instanceof Ld){var c=this.network.getElementUI(a);if(c){var d=c.getZoomViewRect(this);d&&b.add(d)}}},this),b},_zoomGraphicsBegin:function(a){var b=this.network,c=this.getGraphicsZoom();a.scale(c,c),a.translate(-b.viewRect.x/c,-b.viewRect.y/c)},_getEditZoomPoints:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d||a instanceof Gb.vector.LinkUI&&!(a instanceof Gb.vector.ShapeLinkUI))return b;var e;e=a instanceof Gb.vector.ShapeLinkUI?Rb.getCenterPoint(Rb.getRect(b)):this._getZoomPoint(a);var f=e.x,g=e.y;if(b.forEach){var h,i=new md;return b.forEach(function(a){a instanceof md?(h=new md,a.forEach(function(a){h.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),i.add(h)):i.add({x:f*c+(a.x-f)*d,y:g*c+(a.y-g)*d})}),i}return b.x?{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d}:void 0},_getShapeNodeZoomPoints:function(a,b,c){var d=this.getLocationZoom(a),e=this.getSizeZoom(a);if(1==d&&1==e)return b;c&&(d=1/d,e=1/e);var f,g=Rb.getRect(b),h=g.x+g.width/2,i=g.y+g.height/2,j=new md;return b.forEach(function(a){a instanceof md?(f=new md,a.forEach(function(a){f.add({x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e})}),j.add(f)):j.add({x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e})}),j},_getShapeLinkZoomPoints:function(a,b){var c=this.getLocationZoom(),d=c;if(1==c&&1==d)return a;b&&(c=1/c,d=1/d);var e,f=Rb.getRect(a),g=f.x+f.width/2,h=f.y+f.height/2,i=new md;return a.forEach(function(a){a instanceof md?(e=new md,a.forEach(function(a){e.add({x:g*c+(a.x-g)*d,y:h*c+(a.y-h)*d})}),i.add(e)):i.add({x:g*c+(a.x-g)*d,y:h*c+(a.y-h)*d})}),i},_getLogicalPoint:function(a,b){var c,d=b?this.getZoom():this.getGraphicsZoom(),e=this.network;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var f=e._view.getBoundingClientRect(),g=a.changedTouches[0],h=Ob.isAndroid?0:yc.scrollLeft(),i=Ob.isAndroid?0:yc.scrollTop();return c={x:(g.clientX+e.viewRect.x-f.left-h)/d,y:(g.clientY+e.viewRect.y-f.top-i)/d}}return c=Ob.isFirefox?{x:(a.layerX+e.viewRect.x)/d,y:(a.layerY+e.viewRect.y)/d}:{x:(a.offsetX+e.viewRect.x)/d,y:(a.offsetY+e.viewRect.y)/d}},_getVisibleRect:function(a){return a},_getElementZoomRect:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d)return Hb.cloneRect(b);var e=null!=a?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},f=e.x,g=e.y;return{x:f*c+(b.x-f)*d,y:g*c+(b.y-g)*d,width:b.width*d,height:b.height*d}},_reverseElementZoomRect:function(a,b){var c=this.getLocationZoom(a),d=this.getSizeZoom(a);if(1==c&&1==d)return Hb.cloneRect(b);var e=null!=a?this._getZoomPoint(a):{x:b.x+b.width/2,y:b.y+b.height/2},f=e.x,g=e.y;return{x:f+(b.x-f*c)/d,y:g+(b.y-g*c)/d,width:b.width/d,height:b.height/d}},_getZoomContentRect:function(a,b,c,d,e,f){var g=this.getSizeZoom(a.getElementUI()),h=this.getAttachmentSizeZoom(a),i=a.getElementUI();return void 0==f?i instanceof Gb.vector.GroupUI&&i._shapeRect?{x:d.x*e+1*(b.x-d.x)+(c.x-b.x)*h,y:d.y*e+1*(b.y-d.y)+(c.y-b.y)*h,width:c.width,height:c.height}:{x:d.x*e+(b.x-d.x)*g+(c.x-b.x)*h,y:d.y*e+(b.y-d.y)*g+(c.y-b.y)*h,width:c.width,height:c.height}:{x:d.x*e+(b.x-d.x)*g+(c.x-b.x)*h,y:d.y*e+(b.y-d.y)*g+(c.y-b.y)*h+f*(a.textHeight-4)*h,width:c.width,height:a.textHeight}},_getAttachmentZoomRect:function(a,b,c){var d=this.getLocationZoom(a.getElementUI()),e=a.getElementUI(),f=this.getSizeZoom(a.getElementUI()),g=this.getAttachmentSizeZoom(a),h=a._pointers;if(1==d&&1==g&&1==f)return void 0==c?b:{x:b.x,y:b.y+c*(a.textHeight-4),width:b.width,height:a.textHeight};var e=a.getElementUI(),i=this._getZoomPoint(e,a),j=(i.x,i.y,a.getPosition?a.getPosition():"center"),k=h?h[0]:Rd.get(j,b);return void 0==c?e instanceof Gb.vector.LinkUI||e instanceof Gb.vector.GroupUI&&e._shapeRect?this._getZoomContentRect(a,k,b,i,1):this._getZoomContentRect(a,k,b,i,d):this._getZoomContentRect(a,k,b,i,d,c)},_getZoomPoint:function(a,b){var c,d,e=a._element;if(e instanceof Gb.Follower&&e.getHost()&&e.getHost()instanceof Gb.Grid)return c=e.getHost(),d=c.getRect(),{x:d.x+d.width/2,y:d.y+d.height/2};if(d=a.getBodyRect(),a instanceof Gb.vector.LinkUI&&b&&b.getPosition){{b.getXOffset(),b.getYOffset()}if("from"===b.getPosition())return a._fromPoint;if("to"===b.getPosition())return a._toPoint}return{x:d.x+d.width/2,y:d.y+d.height/2}},_getZoomPointers:function(a,b,c){if(c){var d=this._getZoomPoint(b),e=this.getLocationZoom(b),f=this.getSizeZoom(b),g=this.getAttachmentSizeZoom(a),h=c[0];return b instanceof Gb.vector.LinkUI?[{x:d.x+(h.x-d.x)*f,y:d.y+(h.y-d.y)*f},{x:d.x+(h.x-d.x)*f+(c[1].x-h.x)*g,y:d.y+(h.y-d.y)*f+(c[1].y-h.y)*g},{x:d.x+(h.x-d.x)*f+(c[2].x-h.x)*g,y:d.y+(h.y-d.y)*f+(c[2].y-h.y)*g}]:b instanceof Gb.vector.GroupUI&&b._shapeRect?[{x:d.x+1*(h.x-d.x),y:d.y+1*(h.y-d.y)},{x:d.x+1*(h.x-d.x)+(c[1].x-h.x)*g,y:d.y+1*(h.y-d.y)+(c[1].y-h.y)*g},{x:d.x+1*(h.x-d.x)+(c[2].x-h.x)*g,y:d.y+1*(h.y-d.y)+(c[2].y-h.y)*g}]:[{x:d.x*e+(h.x-d.x)*f,y:d.y*e+(h.y-d.y)*f},{x:d.x*e+(h.x-d.x)*f+(c[1].x-h.x)*g,y:d.y*e+(h.y-d.y)*f+(c[1].y-h.y)*g},{x:d.x*e+(h.x-d.x)*f+(c[2].x-h.x)*g,y:d.y*e+(h.y-d.y)*f+(c[2].y-h.y)*g}]}},_getZoomHotSpot:function(a,b){if(b){var c=this._getZoomPoint(a),d=this.getLocationZoom(a),e=this.getSizeZoom(a);return{x:c.x*d+(b.x-c.x)*e,y:c.y*d+(b.y-c.y)*e}}return null},limitZoom:function(a){return a},_isVisible:function(a){var b,c=this._getZoomVisibilityThresholds(),d=c[a];if(null!=d){var e=c.zoomName;if(b="sizeZoom"==e?this.getSizeZoom():"locationZoom"==e?this.getLocationZoom():"graphicsZoom"==e?this.getGraphicsZoom():this.getZoom(),d>b)return!1}return!0},isElementVisible:function(a){var b=this.getZoom(),c=this._isVisible("element",b);

return c&&a instanceof Gb.Link?this.isLinkVisible(a):c},isLinkVisible:function(a){var b=this.getZoom();return this._isVisible("link",b)},isLabelVisible:function(a){var b=this.getZoom();return this._isVisible("label",b)},isAttachmentVisible:function(a){var b=this.getZoom();return this._isVisible("attachment",b)},isAlarmBalloonVisible:function(a){var b=this.getZoom();return this._isVisible("alarmBallon",b)},_getAttachmentOutLineWidth:function(a){return a.getOutlineWidth()},_getAttachmentZoomOutLineRect:function(a,b){var c=this.getLocationZoom(a.getElementUI()),d=this.getAttachmentSizeZoom(a);if(1==c&&1==d)return b;var e=this._getAttachmentZoomRect(a,b,null),f=a.getElement();return this.isAttachmentVisible(f)?(a instanceof Gb.vector.LabelAttachment||a instanceof Gb.vector.Label2Attachment)&&!this.isLabelVisible(f)?{x:e.x,y:e.x,width:0,height:0}:a instanceof Gb.vector.AlarmAttachment&&!this.isAlarmBalloonVisible(f)?{x:e.x,y:e.x,width:0,height:0}:{x:e.x,y:e.y,width:e.width*d,height:e.height*d}:{x:e.x,y:e.x,width:0,height:0}},_drawText:function(a,b,c,d,e,f,g){var h=this.getLocationZoom(a.getElementUI()),i=this.getAttachmentSizeZoom(a);1!=h&&1!=i?(b.translate(d.x,d.y),b.scale(i,i),Vb.drawText(b,c,{x:0,y:0,width:d.width,height:d.height},e,f,g),b.scale(1/i,1/i),b.translate(-d.x,-d.y)):Vb.drawText(b,c,d,e,f,g)},_getOffset:function(a,b){var c=this.getLocationZoom();return{x:(a.x-b.x)/c,y:(a.y-b.y)/c}}});var Rd={"topleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"top.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"topright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"topright.topright":function(a){return{x:a.x,y:a.y+a.height}},topleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},top:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},topright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"topleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topleft.bottomright":function(a){return{x:a.x,y:a.y}},"top.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"topright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"topright.bottomright":function(a){return{x:a.x,y:a.y}},"left.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},left:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"left.right":function(a){return{x:a.x,y:a.y+a.height/2}},center:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.left":function(a){return{x:a.x+a.width,y:a.y+a.height/2}},right:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"right.right":function(a){return{x:a.x,y:a.y+a.height/2}},"bottomleft.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomleft.topright":function(a){return{x:a.x,y:a.y+a.height}},"bottom.top":function(a){return{x:a.x+a.width/2,y:a.y+a.height}},"bottomright.topleft":function(a){return{x:a.x+a.width,y:a.y+a.height}},"bottomright.topright":function(a){return{x:a.x,y:a.y+a.height}},bottomleft:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottom:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},bottomright:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},"bottomleft.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomleft.bottomright":function(a){return{x:a.x,y:a.y}},"bottom.bottom":function(a){return{x:a.x+a.width/2,y:a.y}},"bottomright.bottomleft":function(a){return{x:a.x+a.width,y:a.y}},"bottomright.bottomright":function(a){return{x:a.x,y:a.y}},from:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},to:function(a){return{x:a.x+a.width/2,y:a.y+a.height/2}},get:function(a,b){if(!b)throw"rect can not be null";var c=Rd[a];if(c)return c(b);throw"Can not resolve '"+a+"' position"}};Gb.vector.PhysicalZoomManager=function(a){Gb.vector.PhysicalZoomManager.superClass.constructor.apply(this,arguments)},Hb.ext("twaver.vector.PhysicalZoomManager",Gb.vector.BaseZoomManager,{getGraphicsZoom:function(){return this.getZoom()},_invalidateZoom:function(){}}),Gb.vector.LogicalZoomManager=function(a,b){Gb.vector.LogicalZoomManager.superClass.constructor.apply(this,arguments),this.sizeChange=b},Hb.ext("twaver.vector.LogicalZoomManager",Gb.vector.BaseZoomManager,{getLocationZoom:function(a){return this.getZoom()},getSizeZoom:function(a){return this.sizeChange?this.getZoom():1}}),Gb.vector.MixedZoomManager=function(a,b){Gb.vector.MixedZoomManager.superClass.constructor.call(this,a,b)},Hb.ext("twaver.vector.MixedZoomManager",Gb.vector.LogicalZoomManager,{}),function(){function a(a){d[a]=function(){return this.getZoom()>1?b[a].apply(this,arguments):c[a].apply(this,arguments)}}var b=Gb.vector.LogicalZoomManager.prototype,c=Gb.vector.PhysicalZoomManager.prototype,d=Gb.vector.MixedZoomManager.prototype;for(var e in c)"function"==typeof c[e]&&"constructor"!=e&&(b.hasOwnProperty(e)||c.hasOwnProperty(e))&&a(e);d._invalidateZoom=function(){this.network.invalidateElementUIs()}}(),Gb.vector.interaction.BaseInteraction=function(a){this.network=a},Hb.ext("twaver.vector.interaction.BaseInteraction",Object,{setUp:function(){},tearDown:function(){},repaint:function(){this.network.repaintTopCanvas()},getOffset:function(a,b){return this.network.getOffset(a,b)},convertPointFromView:function(a){return this.network.convertPointFromView(a)},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=e.getSizeZoom(this.network.getElementUI(d));return{x:a.x*f*g-this.network.getViewRect().x+b*f*g,y:a.y*f*g-this.network.getViewRect().y+c*f*g,width:a.width*h*g,height:a.height*h*g}},getMarkerPoint:function(a){var b;if(Ob.isTouchable&&a.changedTouches&&a.changedTouches.length>0){var c=a.changedTouches[0];return b={x:c.clientX,y:c.clientY}}return b=Ob.isFirefox?{x:a.layerX,y:a.layerY}:{x:a.offsetX,y:a.offsetY}},paint:function(a){},addListener:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];Ub.addEventListener(b,"handle_"+b,this.network.getView(),this)}},removeListener:function(){for(var a=0;a<arguments.length;a++)Ub.removeEventListener(arguments[a],this.network.getView(),this)},_handle_mousedown:function(a){0===a.button&&(this._startLogical=this.network.getLogicalPoint2(a),this._startClient=Ub.getClientPoint(a),this._startLogical&&Ub.handle_mousedown(this,a))},_handle_mousemove:function(a){this._endLogical={x:this._startLogical.x+(a.clientX-this._startClient.x)/this.network.getGraphicsZoom(),y:this._startLogical.y+(a.clientY-this._startClient.y)/this.network.getGraphicsZoom()}},_handle_mouseup:function(a){delete this._startClient,delete this._startLogical,delete this._endLogical}}),Gb.vector.interaction.DefaultInteraction=function(a,b){Gb.vector.interaction.DefaultInteraction.superClass.constructor.call(this,a),this.lazyMode=b},Hb.ext("twaver.vector.interaction.DefaultInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseover","mouseout","keydown"),Ob.isFirefox?Ub.addEventListener("DOMMouseScroll","handleMouseWheel",this.network.getView(),this):Ub.addEventListener("mousewheel","handleMouseWheel",this.network.getView(),this),Ub.addEventListener("mouseup","handle_mouseup",window,this),Ub.addEventListener("dblclick","handleDoubleClicked",this.network.getView(),this),Ub.addEventListener("blur","handle_blur",this.network.getView(),this),this._oldCursor=this.network.getView().style.cursor,this.network.addPropertyChangeListener(this.handleViewRectChange,this),this.validateScrollBar(),this.network.addMarker(this),this.network.getView().oncontextmenu=function(a){a.preventDefault()},this._createZoomDiv()},tearDown:function(){this.removeListener("mousedown","mouseover","mouseout","keydown"),Ob.isFirefox?Ub.removeEventListener("DOMMouseScroll",this.network.getView(),this):Ub.removeEventListener("mousewheel",this.network.getView(),this),Ub.removeEventListener("mouseup",window,this),Ub.removeEventListener("dblclick",this.network.getView(),this),Ub.removeEventListener("blur",this.network.getView(),this),this.network.removePropertyChangeListener(this.handleViewRectChange,this),this.end(),this.network.removeMarker(this),this._zoomDiv=null},_createZoomDiv:function(){if(null==this._zoomDiv){this._zoomDiv=Mb.createElement("div"),this._zoomLabel=Mb.createElement("span"),this._zoomLabel.style.display="block",this._zoomLabel.style.textAlign="center";var a=Mb.createElement("button");a.innerHTML="Reset to default",this._zoomDiv.appendChild(this._zoomLabel),this._zoomDiv.appendChild(a);var b=Dd,c=this._zoomDiv.style;c.position="absolute",c.color=b.TOOLTIP_COLOR,c.background=b.TOOLTIP_BACKGROUND,c.fontSize=b.TOOLTIP_FONT_SIZE,c.padding=b.TOOLTIP_PADDING,c.border=b.TOOLTIP_BORDER,c.borderRadius=b.TOOLTIP_BORDER_RADIUS,c.boxShadow=b.TOOLTIP_BOX_SHADOW,c.zIndex=b.TOOLTIP_ZINDEX,c.setProperty&&c.setProperty("-webkit-box-shadow",b.TOOLTIP_BOX_SHADOW,null);var d=this;a.onclick=function(a){d.network.setZoom(1),d._setZoomDivVisible(!1)};var e=this._zoomDiv,f=function(){return e.style.opacity=parseFloat(e.style.opacity)-.05,parseFloat(e.style.opacity)<=.05?(d._setZoomDivVisible(!1),void(e._clearTimeout=null)):void(e._clearTimeout=setTimeout(e._clearFunc,100))};e._clearFunc=f,e.onmouseover=function(a){a||(a=window.event);for(var b=a.relatedTarget?a.relatedTarget:a.fromElement;b&&b!=e;)b=b.parentNode;b!=e&&(e._clearTimeout&&(clearTimeout(e._clearTimeout),e._clearTimeout=null),e.style.opacity=1)},e.onmouseout=function(a){a||(a=window.event);for(var b=a.relatedTarget?a.relatedTarget:a.toElement;b&&b!=e;)b=b.parentNode;b!=e&&(e._clearTimeout=setTimeout(e._clearFunc,10))}}},_isZoomDivVisible:function(){return null!=this._zoomDiv&&null!=this._zoomDiv.parentNode},_getZoomDiv:function(){return this._zoomDiv||this._createZoomDiv(),this._zoomDiv},_setZoomDivVisible:function(a,b,c){var d=this._getZoomDiv();if(a){this._zoomLabel.innerHTML=c,d.style.opacity=1,this._isZoomDivVisible()||this.network.getView().appendChild(d),d.style.left=Dd.TOOLTIP_XOFFSET+"px",d.style.top=Dd.TOOLTIP_YOFFSET+"px";d._clearTimeout&&(clearTimeout(d._clearTimeout),d._clearTimeout=null),d._clearTimeout=setTimeout(d._clearFunc,250)}else d.parentNode&&d.parentNode.removeChild(d)},handleViewRectChange:function(a){("viewRect"==a.property||"canvasSizeChange"==a.property)&&this.validateScrollBar()},getScrollBarWidth:function(){return this.network.getScrollBarWidth()},getScrollBarColor:function(){return"#cccccc"},validateScrollBar:function(){if(this.hThumbRect=null,this.vThumbRect=null,0==this.network.isScrollBarVisible())return void this.repaint();var a=this.network.getViewRect().height,b=this.network.getViewRect().width,c=this.network.getViewRect().x,d=this.network.getViewRect().y,e=this.network.getCanvasSize(),f=this.network._unionBounds,g=f.x,h=f.y,i=f.width,j=f.height,k=e.width,l=e.height,m=b,n=a,o=!1,p=!1;(c>g||k>b+c)&&(p=!0),(d>h||l>d+a)&&(o=!0);var q,r,s,t=0,u=0,v=0,w=0,x=m,y=n,z=this.getScrollBarWidth();p&&(o&&(x-=z),w=z,u=n-z,c>g&&c+b>k?(q=c-g,q=q*x/(q+m),t=q,v=x-q):g>c&&k>c+b?(q=k-(c+b),q=x*q/(q+m),t=0,v=x-q):(r=c-g,s=k-(c+b),r=x*r/i,s=x*s/i,t=r,v=m-r-s),this.hThumbRect={x:t,y:u,width:v,height:w}),t=0,u=0,v=0,w=0,x=m,y=n,o&&(p&&(y-=z),v=z,t=m-z,d>h&&d+a>l?(q=d-h,q=y*q/(q+n),u=q,w=y-q):h>d&&l>d+a?(q=l-(d+a),q=y*q/(q+n),u=0,w=y-q):(r=d-h,s=l-(d+a),r=y*r/j,s=y*s/j,u=r,w=y-r-s),this.vThumbRect={x:t,y:u,width:v,height:w}),this.network.setHScrollBarVisible(null!=this.hThumbRect),this.network.setVScrollBarVisible(null!=this.vThumbRect),this.repaint()},scrollXOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d+f,e,c,b)},scrollYOffset:function(a){var b=this.network.getViewRect().height,c=this.network.getViewRect().width,d=this.network.getViewRect().x,e=this.network.getViewRect().y,f=30;a&&(f=-30),this.network.setViewRect(d,e+f,c,b)},handle_mouseover:function(a){1!=this.scrollBarVisible&&(this.scrollBarVisible=!0,this.repaint())},handle_mouseout:function(a){0!=this.scrollBarVisible&&null==this.vBarDownPoint&&null==this.hBarDownPoint&&(this.scrollBarVisible=!1,this.repaint(),this.end(a))},handle_keydown:function(a){this.currentKeyEvent=a,this.addListener("keyup"),Bc.handleKeyDown(this.network,a)},handle_keyup:function(a){this.currentKeyEvent=null,this.removeListener("keyup")},start:function(a){this.end(a,!0),this.lastPoint=this.network.getLogicalPoint2(a),this.startPoint=this.network.getLogicalPoint2(a),this.lastPanPoint=this.getMarkerPoint(a),this.lazyMode&&(this.pressPoint=this.lastPoint),Ub.addEventListener("mousemove","handle_mousemove",window,this)},end:function(a,b){if(this.vBarDownPoint=null,this.hBarDownPoint=null,this.network.state.panning&&(this.network.state.panning=!1,this.network.invalidateElementUIs(!0)),b||(this.network.getView().style.cursor=this._oldCursor),this.isMoving){if(this.lazyMode){if(null!=this.dragPoint&&null!=this.pressPoint){var c=this,d=function(){c.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a}),c.network.setMovingElement(!1)},e=this.getOffset(this.dragPoint,this.pressPoint),f=e.x,g=e.y;this.network.moveSelectedElements(f,g,this.network.isLazyMoveAnimate(),d)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a}));if(this.isParenting()){null==this.parent&&(this.parent=this.network.getCurrentSubNetwork());var c=this;this.network.getMovableSelectedElements().forEach(function(a){a.setParent(c.parent)},this.network)}this.parentProcess(a,!0),this.isParenting()&&this.repaint(),this.network.invalidateCanvasSize(),this.lastPoint=null,this.dragPoint=null,this.pressPoint=null,this.repaint()}if(this.isSelecting&&this.startPoint){if(this.endPoint&&this.startPoint.x!==this.endPoint.x&&this.startPoint.y!==this.endPoint.y){var h=Rb.getRect([this.startPoint,this.endPoint]),i=this.network.getElementsAtRect(h,this.getIntersectMode(),this.network.getRectSelectFilter());if(i&&i.size()>0){var j=this.network.getSelectionModel(),k=j.toSelection();i.forEach(function(a){j.contains(a)?k.remove(a):k.add(a)},this),j.setSelection(k)}this.network.fireInteractionEvent({kind:"selectEnd",event:a})}this.network.setSelectingElement(!1),this.startPoint=null,this.endPoint=null,this.repaint()}this.isMouseDown=!1,Ub.removeEventListener("mousemove",window,this)},_isDragToSelect:function(a){return!this.network._dragToPan},handle_mousedown:function(a){if(!Ob.isTouchable&&0!==a.button&&this.network.isSelectingElement())return void this.end(a);var b=this.network;if(a.target==b.getView()||a.target==b._topCanvas||a.target==b._rootCanvas){if(this.isMoving=!1,this.isSelecting=!1,this.hBarDownPoint=null,this.vBarDownPoint=null,this._setZoomDivVisible(!1),!this.network.isValidEvent(a)){var c=this.getMarkerPoint(a);return this.start(a),null!=this.vThumbRect&&Rb.containsPoint(this.vThumbRect,c.x,c.y)&&(this.vBarDownPoint={x:a.screenX,y:a.screenY},this.vBarDownOffset=this.vBarDownPoint.y-this.vThumbRect.y),void(null!=this.hThumbRect&&Rb.containsPoint(this.hThumbRect,c.x,c.y)&&(this.hBarDownPoint={x:a.screenX,y:a.screenY},this.hBarDownOffset=this.hBarDownPoint.x-this.hThumbRect.x))}this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network.getView());var d=this.network.getElementAt(a),e=this.network.getElementsAt(a);if(e&&e instanceof md)for(var f=0;f<e.size();f++){var g=e.get(f),h=this.network.getElementBox().getSelectionModel().isSelectable(g);if(h){d=g;break}}if(this.network.isSelectingElement()||this.network.isEditingElement()||null==d||(this.network.isMovable(d)&&this.network.getElementBox().getSelectionModel().isSelectable(d)?this.isMoving=!0:this.network.getView().style.cursor="pointer",this.start(a)),!this.network.isSelectingElement()&&!this.network.isEditingElement()){var i=this.network.getSelectionModel();null==d||d&&!this.network.getElementBox().getSelectionModel().isSelectable(d)?(Hb.isCtrlDown(a)?this.isSelecting=!0:this._isDragToSelect(a)?(this.isSelecting=!0,i.clearSelection()):this.network.isRectSelectEnabled()&&(i.clearSelection(),this.network.getView().style.cursor="pointer"),this.start(a)):Hb.isCtrlDown(a)?i.contains(d)?i.removeSelection(d):i.appendSelection(d):i.contains(d)||i.setSelection(d)}this.handleClicked(a,d),this.isMouseDown=!0}},handle_mousemove:function(a){this._setZoomDivVisible(!1);var b=this.network.getLogicalPoint2(a);if(b){var c={x:a.screenX,y:a.screenY},d=this.network.getCanvasSize(),e=this.network.getViewRect().height,f=this.network.getViewRect().width,g=this.getScrollBarWidth();if(null!=this.hBarDownPoint){var h=c.x-this.hBarDownPoint.x;return this.hBarDownPoint=c,void this.network.setViewOffSet(h*d.width/(f-g),0)}if(null!=this.vBarDownPoint){var i=c.y-this.vBarDownPoint.y;return this.vBarDownPoint=c,void this.network.setViewOffSet(0,i*d.height/(e-g))}if(this.network.isSelectingElement()||this.network.isEditingElement()||!this.isMoving||!this.isMouseDown||Hb.isCtrlDown(a))if(this.isSelecting&&(Hb.isCtrlDown(a)||this._isDragToSelect()))this.network.setSelectingElement(!0),this.network.fireInteractionEvent(null==this.endPoint?{kind:"selectStart",event:a}:{kind:"selectBetween",event:a}),this.endPoint=b,this.repaint();else if(this.isMoving||this.isSelecting||!this.isMouseDown)this.end(a);else{if(!this.lastPanPoint||!this.network._dragToPan)return;var b=this.getMarkerPoint(a);if(!b)return;var j=b.x-this.lastPanPoint.x,k=b.y-this.lastPanPoint.y;this.network.panByOffset(-j,-k),this.network.fireInteractionEvent({kind:"panning",event:a}),this.network.state.panning=!0,this.lastPanPoint=b}else{var l=this.getOffset(b,this.lastPoint);if(this.xoffset=l.x,this.yoffset=l.y,Math.abs(this.xoffset)<1&&Math.abs(this.yoffset)<1)return;this.lazyMode?null==this.dragPoint?(this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a}),this.network.setMovingElement(!0)):this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a}):(this.lastPoint=b,this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a})),this.network.moveSelectedElements(this.xoffset,this.yoffset)),this.parentProcess(a,!1),this.lazyMode&&(this.dragPoint=b),(this.lazyMode||this.isParenting())&&this.repaint()}}},handleMouseWheel:function(a){if(Mb.activeElement===this.network.getView()){if(!this.network._wheelToZoom)return void this._handleMouseWheelScroll(a);Ub.preventDefault(a);var b={x:a.offsetX||a.layerX,y:a.offsetY||a.layerY},c=this.network.getZoom();a.wheelDelta&&a.wheelDelta>0||a.detail&&a.detail<0?this.network.setZoom(1.1*c,b):this.network.setZoom(c/1.1,b),this._setZoomDivVisible(this.network.isZoomDivVisible(),a,"Zoom : "+parseFloat(this.network.getZoom().toFixed(4)))}},_handleMouseWheelScroll:function(a){Ub.preventDefault(a);var b=!1,c=this._getVisibleScrollBar();null!=c&&(b=a.wheelDelta?a.wheelDelta>0:a.detail<0,"v"==c?this.scrollYOffset(b):this.scrollXOffset(b))},handle_mouseup:function(a){this.end(a)},isParenting:function(){return this.pressPoint&&null!=this.currentKeyEvent&&80===this.currentKeyEvent.keyCode},parentProcess:function(a,b){var c=null;this.parent=null;var d=this;if(!b&&this.isParenting()){var e={},f=this.network.getLogicalPoint2(a);e.x=f.x-1,e.y=f.y-1,e.width=2,e.height=2;var g=this.network.getElementsAtRect(e,!0);if(g&&g.size()>0)for(var h=g.size(),i=0;h>i;i++){var j=g.get(i);if(!d.network.getElementBox().getSelectionModel().contains(j)){d.parent=j;break}}}else this.parent=null;null!=this.parent&&(c=this.network.getElementUI(this.parent).getViewRect()),this.parentRect=null==c||b?null:c},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this.startPoint.x>this.endPoint.x&&this.startPoint.y>this.endPoint.y},_getVisibleScrollBar:function(){return 0==this.network.isScrollBarVisible()?null:null!=this.vThumbRect?"v":null!=this.hThumbRect?"h":null},paintScroll:function(a){if(0!=this.network.isScrollBarVisible()&&(0!=this.scrollBarVisible||null!=this.hBarDownPoint||null!=this.vBarDownPoint)){var b=this.getScrollBarWidth(),c=this.network.getViewRect().height,d=this.network.getViewRect().width;a.save();var e,f=this.getScrollBarColor();null!=this.hThumbRect&&(e=a.createLinearGradient(this.hThumbRect.x,this.hThumbRect.y,this.hThumbRect.x,this.hThumbRect.y+this.hThumbRect.height),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,0,c-b,d-b,b,b/2),this.paintRoundRect(a,e,.9,this.hThumbRect.x,this.hThumbRect.y+1,this.hThumbRect.width,this.hThumbRect.height-2,b/2)),null!=this.vThumbRect&&(e=a.createLinearGradient(this.vThumbRect.x,this.vThumbRect.y,this.vThumbRect.x+this.vThumbRect.width,this.vThumbRect.y),e.addColorStop(0,f),e.addColorStop(1,"#666666"),this.paintRoundRect(a,this.getScrollBarColor(),.5,d-b,0,b,c-b,b/2),this.paintRoundRect(a,e,.9,this.vThumbRect.x+1,this.vThumbRect.y,this.vThumbRect.width-2,this.vThumbRect.height,b/2)),a.restore()}},paintRoundRect:function(a,b,c,d,e,f,g,h){a.beginPath(),a.globalAlpha=c,a.fillStyle=b,Vb.drawRoundRect(a,d,e,f,g,h),a.fill()},paint:function(a){if(this.paintScroll(a),this.network.isSelectingElement()){if(null==this.startPoint||null==this.endPoint)return;var b=this.convertPointFromView(this.startPoint),c=this.convertPointFromView(this.endPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}else{if(this.lazyMode){if(null==this.pressPoint||null==this.dragPoint)return;a.beginPath();var k=this.getOffset(this.dragPoint,this.pressPoint),l=k.x,m=k.y,n=this.network.getMovableSelectedElements(),o=n.size(),p=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),q=this.network.getLazyMoveOutlineColor();a.strokeStyle=q,a.lineWidth=i,a.fillStyle=p;for(var r=0;o>r;r++){var s=n.get(r),t=this.network.getElementUI(s);if(t){var u=this.convertFromUIToMarkerRect(t.getViewRect(),l,m);Od.rect(a,u.x,u.y,u.width,u.height)}}a.fill(),a.stroke()}if(this.parentRect){a.beginPath();var p=this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,i=this.network.getLazyMoveOutlineWidth(),q=this.network.getLazyMoveOutlineColor();a.strokeStyle=q,a.lineWidth=i,a.fillStyle=p;var u=this.parentRect;Od.rect(a,u.x,u.y,u.width,u.height),a.fill(),a.stroke()}}},handleClicked:function(a,b){Bc.handleClicked(this.network,a,b)},handleDoubleClicked:function(a){var b=this.network.getElementAt(a);Bc.handleDoubleClicked(this.network,a,b)},handle_blur:function(a){this.end()}}),Gb.vector.interaction.CreateElementInteraction=function(a,b){b||(b=Gb.Node),this.elementFunction=Gb.Util.isTypeOf(b,Gb.Node)?function(a){var c=new b;return c instanceof Gb.Node&&c.setCenterLocation(a),c}:b,Gb.vector.interaction.CreateElementInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.CreateElementInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown")},tearDown:function(){this.removeListener("mousedown")},handle_mousedown:function(a){var b=this.network.getLogicalPoint2(a);if(b){var c=this.elementFunction(b);c&&this.network.addElementByInteraction(c)}}}),Gb.vector.interaction.EditInteraction=function(a,b){this.lazyMode=b,this.pointIndex=-1,this.linkPointsType=null,Gb.vector.interaction.EditInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.EditInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mouseup","mousemove"),this.oldCursor=this.network.getView().style.cursor,this.network.setHasEditInteraction(!0),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mouseup","mousemove"),this.network.getView().style.cursor=this.oldCursor,this.network.setHasEditInteraction(!1),this.clear(),this.network.removeMarker(this)},paint:function(a){if(1==this.lazyMode&&null!=this.resizingRect){a.lineWidth=this.network.getResizeLineWidth();var b=this.convertFromUIToMarkerRect(this.resizingRect,0,0,this.node);a.save(),Gb.Util.rotateCanvas(a,b,this.node.getAngle()),a.beginPath(),Od.rect(a,b.x,b.y,b.width,b.height,null,this.network.getResizeLineColor()),a.restore()}this.isStartRotate&&this.showRotateScale(a)},clear:function(){this.network.setEditingElement(!1),this.network.setRotatingElement(!1),this.isStart=!1,this.isStartRotate=!1,this.node=null,this.shapeNode=null,this.shapeLink=null,this.linkUI=null,this.resizingRect=null,this.resizeDirection=null,this.pointIndex=-1,this._removeCursor(),this.oldCursor=null,this.network.repaintTopCanvas()},_removeCursor:function(){this.cursorID&&(this.network.getView().style.cursor=this.oldCursor||"default",this.cursorID=null),this.resizeDirection=null,this.isCrossCursor=!1},_setCrossCursor:function(){this.isCrossCursor||(this._removeCursor(),this._setCursor("crosshair"),this.isCrossCursor=!0)},_setCursor:function(a){this.cursorID=a,this.network.getView().style.cursor!==this.cursorID&&(this.network.getView().style.cursor=this.cursorID)},isKeyDown:function(a){return Hb.isAltDown(a)},handle_mousedown:function(a){if(0===a.button)if(!this.isKeyDown(a)||this.network.isEditingElement())!this.network.isEditingElement()||this.isStart||this.isStartRotate||(this.node&&this.resizeDirection?(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:this.lazyMode?"lazyResizeStart":"liveResizeStart",event:a,element:this.node,resizeDirection:this.resizeDirection})):this.shapeNode&&this.pointIndex>=0?this.isKeyDown(a)?(this.shapeNode.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeNode})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):this.shapeLink?this.isKeyDown(a)?this.pointIndex>=0&&(this.shapeLink.removeAt(this.pointIndex),this.network.fireInteractionEvent({kind:"removePoint",event:a,element:this.shapeLink})):(this.isStart=!0,this._handle_mousedown(a),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):this.linkUI?(this.isStart=!0,this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:this.linkUI._element})):this.node&&(this.isStartRotate=!0,this._handle_mousedown(a)));else{var b=this.network.getElementAt(a),c=this.network.getLogicalPoint2(a);if(b instanceof Gb.ShapeNode){var d=this.getPointIndex(this.network.getShapeNodeZoomPoints(b),c,!0);d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeNode=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}if(b instanceof Gb.ShapeLink){var e=new Gb.List(b.getPoints()),f=this.network.getElementUI(b);e.add(f.getFromPoint(),0),e.add(f.getToPoint());var d=this.getPointIndex(e,c)-1;d>0&&(this._handle_mousedown(a),this.pointIndex=d,this.shapeLink=b,b.addPoint(c,d),this._setCrossCursor(),this.network.setEditingElement(!0),this.isStart=!0,this.network.fireInteractionEvent({kind:"addPoint",event:a,element:b,pointIndex:d}),this.network.fireInteractionEvent({kind:"liveMovePointStart",event:a,element:b,pointIndex:d}))}}},handle_mouseup:function(a){if(this.isStart){var b=this.network.getLogicalPoint2(a);if(this.resizingRect)if(this.lazyMode)if(this.network.isResizeAnimate()){var c=this,d=new Gb.animate.AnimateBounds(this.node,this.resizingRect,function(){c.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:c.node,resizeDirection:c.resizeDirection}),c.clear()});Gb.animate.AnimateManager.start(d)}else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"lazyResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeEnd",event:a,element:this.node,resizeDirection:this.resizeDirection});else this.shapeNode&&this.pointIndex>=0&&b?(this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeNode,pointIndex:this.pointIndex})):b&&(this.shapeLink||this.linkUI)&&("from"===this.linkPointsType?this._setFromPoint(b):"to"===this.linkPointsType?this._setToPoint(b):"shapeControl"===this.linkPointsType?(this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.shapeLink,pointIndex:this.pointIndex})):"control"===this.linkPointsType&&wc.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint()&&(this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointEnd",event:a,element:this.linkUI._element})))}this._handle_mouseup(a),this.clear()},handle_mousemove:function(a){var b=this.network.getEditPointSize();if(this.network.isValidEvent(a)){if(this.isStartRotate&&this.node)return this._handleRotateElement(a,this.node),void(this.network.isShowRotateScale()&&this.repaint());if(this.isStart){if(this.shapeNode&&this.pointIndex>=0)return void this._handleMovingShapeNodePoint(a);if(this.node&&this.resizeDirection)return void this._handleResizing(a);if((this.shapeLink||this.linkUI)&&this.linkPointsType){if("from"===this.linkPointsType)return void this._handleMovingFromPoint(a);if("to"===this.linkPointsType)return void this._handleMovingToPoint(a);if("shapeControl"===this.linkPointsType)return void this._handleMovingShapeLinkPoint(a);if("control"===this.linkPointsType&&wc.isOrthogonalLink(this.linkUI._element)&&this.linkUI.getControlPoint())return void this._handleMovingLinkControlPoint(a)}}if(this.network.isSelectingElement()||this.network.isMovingElement()||0===this.network.getSelectionModel().size())return void this.clear();var c=this.network.getElementAt(a),d=this.network.getElementUI(c);if(!d||!d.getEditAttachment())return void this.clear();var e=this.network.getLogicalPoint2(a);if(c instanceof Gb.Node){if(this.node=c,this._isEditingShapeNode(e)||this._isResizingNode(e))return void this.network.setEditingElement(!0);if(this._isRotatingElement(e))return this.network.setRotatingElement(!0),void this.network.setEditingElement(!0)}else if(c instanceof Gb.Link){c instanceof Gb.ShapeLink?this.shapeLink=c:d instanceof Gb.vector.LinkUI&&(this.linkUI=d);var f,g=c.getFromAgent();f=g?c.getFromAgent():c.getFromNode();var h,i=c.getStyle("link.from.xoffset"),j=c.getStyle("link.from.yoffset"),k=this.network.getElementUI(f),l=k.getZoomBodyRect(),m={x:l.x+l.width/2,y:l.y+l.height/2},n={x:m.x+i,y:m.y+j},o=c.getToAgent();h=o?c.getToAgent():c.getToNode();var p=c.getStyle("link.to.xoffset"),q=c.getStyle("link.to.yoffset"),r=this.network.getElementUI(h),s=r.getZoomBodyRect(),t={x:s.x+s.width/2,y:s.y+s.height/2},u={x:t.x+p,y:t.y+q};if(n&&this._contains(e,n,b))return this.linkPointsType="from",this._setCrossCursor(),void this.network.setEditingElement(!0);if(u&&this._contains(e,u,b))return this.linkPointsType="to",this._setCrossCursor(),void this.network.setEditingElement(!0);if(c instanceof Gb.ShapeLink){if(this._isEditingShapeLink(e))return this.linkPointsType="shapeControl",void this.network.setEditingElement(!0)}else if(d instanceof Gb.vector.LinkUI){if(wc.isOrthogonalLink(d._element)){var v=this.linkUI.getControlPoint();if(v&&this._contains(e,v,b))return this.linkPointsType="control",this._setCrossCursor(),void this.network.setEditingElement(!0)}return void(this.linkPointsType=null);

}this.linkPointsType=null}this.clear()}},_isRotatingElement:function(a){var b=this.network.getRotatePointSize();if(0>=b)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c.getSizeZoom(d),f=c._getElementZoomRect(d,this.node.getOriginalRect()),g=this.node.getAngle();return this._isRotating(a,"crosshair",f,g,e)},_isRotating:function(a,b,c,d,e){var f=this.network.getRotatePointSize()/this.network.getGraphicsZoom(),g={x:c.x+c.width/2,y:c.y-this.network.getRotatePointOffset()/this.network.getGraphicsZoom()-f},h=this._rotatePoint(g,d,c),i={x:h.x-f,y:h.y-f,width:2*f,height:2*f};return Rb.containsPoint(i,a)?(this._removeCursor(),this._setCursor(b),!0):!1},_handleRotateElement:function(a,b){this._handle_mousemove(a);var c=this._calculateAngle(this.network.getLogicalPoint2(a),b);b.setAngle(c)},_calculateAngle:function(a,b){var c=this.network.getZoomBodyRect(b),d=Rb.getCenterPoint(c);return Math.round(180*Math.atan2(d.x-a.x,a.y-d.y)/Math.PI+180)},_resetShapeNodePoints:function(a){var b=this.network.getShapeNodeZoomPoints(this.shapeNode);b.set(this.pointIndex,a);var c=this.network.getElementUI(this.shapeNode),d=this.network.zoomManager._getShapeNodeZoomPoints(c,b,!0);this.shapeNode.setPoints(d)},_handleMovingShapeNodePoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeNodePoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeNode,pointIndex:this.pointIndex})},_resetShapeLinkPoints:function(a){var b=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink._points);b.set(this.pointIndex,a);var c=this.network.zoomManager._getShapeLinkZoomPoints(b,!0);this.shapeLink.setPoints(c)},_handleMovingShapeLinkPoint:function(a){var b=this.network.getLogicalPoint2(a);this._resetShapeLinkPoints(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.shapeLink,pointIndex:this.pointIndex})},_setLinkControlPoint:function(a){var b=this.linkUI.getControlPoint(),c=this.linkUI.getControlPoint(),d=(this.network.zoomManager,{x:a.x-c.x,y:a.y-c.y});b.x+=d.x,b.y+=d.y,this.linkUI.setControlPoint(b)},_handleMovingLinkControlPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setLinkControlPoint(b),this.network.fireInteractionEvent({kind:"liveMovePointBetween",e:a,element:this.linkUI._element})},_setFromPoint:function(a){var b;if(this.linkUI)b=this.linkUI._element;else{if(!this.shapeLink)return;b=this.shapeLink}var c,d=b.getFromAgent();c=d?b.getFromAgent():b.getFromNode();var e=this.network.getElementUI(c),f=e.getZoomBodyRect(),g={x:f.x+f.width/2,y:f.y+f.height/2},h={x:a.x-g.x,y:a.y-g.y};b.setStyle("link.from.xoffset",h.x),b.setStyle("link.from.yoffset",h.y)},_handleMovingFromPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setFromPoint(b)},_setToPoint:function(a){var b;if(this.linkUI)b=this.linkUI._element;else{if(!this.shapeLink)return;b=this.shapeLink}var c,d=b.getToAgent();c=d?b.getToAgent():b.getToNode();var e=this.network.getElementUI(c),f=e.getZoomBodyRect(),g={x:f.x+f.width/2,y:f.y+f.height/2},h={x:a.x-g.x,y:a.y-g.y};b.setStyle("link.to.xoffset",h.x),b.setStyle("link.to.yoffset",h.y)},_handleMovingToPoint:function(a){var b=this.network.getLogicalPoint2(a);this._setToPoint(b)},convertFromUIToMarkerRect:function(a,b,c,d){var e=this.network.zoomManager,f=e.getLocationZoom(),g=e.getGraphicsZoom(),h=this.network.getElementUI(d),i=e.getSizeZoom(h),j=a.x+a.width/2,k=a.y+a.height/2,l=j-a.x,m=k-a.y;return{x:j*f*g-this.network.getViewRect().x+b*f*g-l*i*g,y:k*f*g-this.network.getViewRect().y+c*f*g-m*i*g,width:a.width*i*g,height:a.height*i*g}},_getReverseZoomPoint:function(a,b,c){var d=this.network.zoomManager,e=d.getLocationZoom(),f=d.getSizeZoom(this.network.getElementUI(a));return b.x*=e,b.y*=e,{x:b.x/e+(c.x-b.x)/f,y:b.y/e+(c.y-b.y)/f}},_getReverseZoomRect:function(a,b){var c=this.network.zoomManager,d=c.getLocationZoom(),e=c.getSizeZoom(f);if(d==e)return a;var f=this.network.getElementUI(b),g=f.getBodyRect(),h=g.x+g.width/2,i=g.y+g.height/2,j={x:h*d+(a.x-h)*e,y:i*d+(a.y-i)*e,width:a.width*e,height:a.height*e};return h=j.x+j.width/2,i=j.y+j.height/2,{x:h/d+(j.x-h)*e,y:i/d+(j.y-i)*e,width:a.width,height:a.height}},_handleResizing:function(a){this._handle_mousemove(a);var b=this.node.getAngle(),c=this.node.getLocation(),d=this.node.getWidth()/2,e=this.node.getHeight()/2,f={x:c.x+d,y:c.y+e},g={x:-d,y:-e},h={x:-d,y:e},i={x:d,y:e},j={x:d,y:-e},k={x:0,y:-e},l={x:d,y:0},m={x:0,y:e},n={x:-d,y:0},o=this._getReverseZoomPoint(this.node,Hb.clone(f),this._endLogical);if("northwest"===this.resizeDirection&&(this._transformPoint(i,f,b),g.x=o.x,g.y=o.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,1)),"north"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),k.y=p.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}if("northeast"===this.resizeDirection&&(this._transformPoint(h,f,b),j.x=o.x,j.y=o.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,2)),"west"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),n.x=p.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("east"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),l.x=p.x-f.x,this._transformPoint(l,f,b),this._transformPoint(n,f,b),f.x=(l.x+n.x)/2,f.y=(l.y+n.y)/2,this._reversPoint(l,f,b),this._reversPoint(n,f,b),this.resizingRect={x:f.x-(l.x-n.x)/2,y:f.y-this.node.getHeight()/2,width:l.x-n.x,height:this.node.getHeight()}}if("southwest"===this.resizeDirection&&(this._transformPoint(j,f,b),h.x=o.x,h.y=o.y,f.x=(h.x+j.x)/2,f.y=(h.y+j.y)/2,this._reversPoint(h,f,b),this._reversPoint(j,f,b),this.resizingRect={x:h.x,y:j.y,width:j.x-h.x,height:h.y-j.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,4)),"south"===this.resizeDirection){var p={x:o.x,y:o.y};this._reversPoint(p,f,b),m.y=p.y-f.y,this._transformPoint(k,f,b),this._transformPoint(m,f,b),f.x=(k.x+m.x)/2,f.y=(k.y+m.y)/2,this._reversPoint(k,f,b),this._reversPoint(m,f,b),this.resizingRect={x:f.x-this.node.getWidth()/2,y:f.y-(m.y-k.y)/2,width:this.node.getWidth(),height:m.y-k.y}}"southeast"===this.resizeDirection&&(this._transformPoint(g,f,b),i.x=o.x,i.y=o.y,f.x=(g.x+i.x)/2,f.y=(g.y+i.y)/2,this._reversPoint(g,f,b),this._reversPoint(i,f,b),this.resizingRect={x:g.x,y:g.y,width:i.x-g.x,height:i.y-g.y},Hb.isShiftDown(a)&&this._revertResizeRect(this.node,this.resizingRect,3)),this.resizingRect=this._getReverseZoomRect(this.resizingRect,this.node),this.lazyMode?(this.repaint(),this.network.fireInteractionEvent({kind:"lazyResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection})):(this.node.setLocation(this.resizingRect.x,this.resizingRect.y),this.node.setSize(this.resizingRect.width,this.resizingRect.height),this.network.fireInteractionEvent({kind:"liveResizeBetween",event:a,element:this.node,resizeDirection:this.resizeDirection}))},_revertResizeRect:function(a,b,c){var d=a.getOriginalRect(),e=Math.max(b.width/d.width,b.height/d.height),f=d.width*e,g=d.height*e,h=b.x,i=b.y;1==c?(h+=b.width-f,i+=b.height-g):2==c?i+=b.height-g:3==c||4==c&&(h+=b.width-f),b.x=h,b.y=i,b.width=f,b.height=g},_isEditingShapeNode:function(a){var b=this.network.getEditPointSize();if(this.node instanceof Gb.ShapeNode){this.shapeNode=this.node;for(var c=this.network.getShapeNodeZoomPoints(this.node),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}}return this.pointIndex=-1,!1},_isEditingShapeLink:function(a){for(var b=this.network.getEditPointSize(),c=this.network.zoomManager._getShapeLinkZoomPoints(this.shapeLink.getPoints()),d=0,e=c.size();e>d;d++){var f=c.get(d);if(this._contains(a,f,b))return this._setCrossCursor(),this.pointIndex=d,!0}return this.pointIndex=-1,!1},_isResizingNode:function(a){var b=this.network.getResizePointSize();if(0>=b)return!1;var c=this.network.zoomManager,d=this.network.getElementUI(this.node),e=c._getElementZoomRect(d,this.node.getOriginalRect()),f=this.node.getAngle(),g={x:e.x,y:e.y},h=this._rotatePoint(g,f,e);return this._isResizing(a,h.x,h.y,"northwest","nwse-resize")?!0:(g={x:e.x+e.width/2,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"north","ns-resize")?!0:(g={x:e.x+e.width,y:e.y},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"northeast","nesw-resize")?!0:(g={x:e.x,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"west","ew-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height/2},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"east","ew-resize")?!0:(g={x:e.x,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southwest","nesw-resize")?!0:(g={x:e.x+e.width/2,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"south","ns-resize")?!0:(g={x:e.x+e.width,y:e.y+e.height},h=this._rotatePoint(g,f,e),this._isResizing(a,h.x,h.y,"southeast","nwse-resize")?!0:!1)))))))},_rotatePoint:function(a,b,c){var d=Rb.createMatrix(b*Math.PI/180,c.x+c.width/2,c.y+c.height/2),e=d.transform(a);return e},_isResizing:function(a,b,c,d,e){var f=this.network.getGraphicsZoom(),g=this.network.getResizePointSize()/f;return this._contains(a,{x:b,y:c},g)?(this.resizeDirection!==d&&(this._removeCursor(),e=this._changeCursorWithAngle(d,this.node.getAngle()),this._setCursor(e),this.resizeDirection=d),!0):!1},_getRect:function(a,b,c,d){var e=c>a?a:c,f=d>b?b:d,g=Math.abs(a-c),h=Math.abs(b-d);return{x:e,y:f,width:g,height:h}},_contains:function(a,b,c){var d={x:b.x-c,y:b.y-c,width:2*c,height:2*c};return Rb.containsPoint(d,a)},getPointIndex:function(a,b,c){if(a.size()<2)return 0;for(var d,e=a.get(0),f=1;f<a.size();f++){if(d=a.get(f),this.isPointOnLine(b,e,d,6))return f;e=d}return e=a.get(0),c&&this.isPointOnLine(b,e,d,6)?a.size():0},showRotateScale:function(a){var b,c,d,e,f,g=(new Gb.List,this.network.getRotateScaleWidth()),h=this.network.getRotateScaleHeight(),i=this.network.getRotatePointSize(),j=this.node.getAngle(),k=this.network.zoomManager,l=this.network.getElementUI(this.node),m=k._getElementZoomRect(l,this.node.getOriginalRect()),n={x:m.x+m.width/2,y:m.y-this.network.getRotatePointOffset()-i},o=this._rotatePoint(n,j,m),p="13px Arial",q=j+"°",r=this.network.getViewRect();1===k.getLocationZoom()&&(a.translate(-r.x,-r.y),a.scale(this.network.getZoom(),this.network.getZoom())),this.node.getAngle()>=0&&this.node.getAngle()<=180?(c={x:o.x+i,y:o.y},d={x:c.x+g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y}):this.node.getAngle()>180&&this.node.getAngle()<=360&&(c={x:o.x-i,y:o.y},d={x:c.x-g,y:c.y},e={x:d.x,y:d.y-h},f={x:c.x,y:e.y});var s=new Gb.List([c,d,e,f]),b=Hb.math.getRect(s);1!==k.getLocationZoom()&&(b.x-=r.x,b.y-=r.y),a.fillStyle=this.network.getRotateScaleFillColor(),a.fillRect(b.x,b.y,b.width,b.height),a.fillStyle=this.network.getRotateScaleFontColor(),a.textBaseline="middle",a.textAlign="center",a.font=p,a.fillText(q,b.x+b.width/2,b.y+b.height/2),1===k.getLocationZoom()&&(a.scale(1/this.network.getZoom(),1/this.network.getZoom()),a.translate(r.x,r.y))},isPointOnLine:function(a,b,c,d){0>d&&(d=0);var e=this.getDistanceFromPointToLine(a,b,c);return d>=e&&a.x>=Math.min(b.x,c.x)-d&&a.x<=Math.max(b.x,c.x)+d&&a.y>=Math.min(b.y,c.y)-d&&a.y<=Math.max(b.y,c.y)+d},getDistanceFromPointToLine:function(a,b,c){if(b.x===c.x)return Math.abs(a.x-b.x);var d=(c.y-b.y)/(c.x-b.x),e=(c.x*b.y-b.x*c.y)/(c.x-b.x);return Math.abs(d*a.x-a.y+e)/Math.sqrt(d*d+1)},_transformPoint:function(a,b,c){var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x,g=a.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_reversPoint:function(a,b,c){c*=-1;var d=Math.cos(c*Math.PI/180),e=Math.sin(c*Math.PI/180),f=a.x-b.x,g=a.y-b.y,h=f*d-g*e,i=f*e+g*d;a.x=h+b.x,a.y=i+b.y},_changeCursorWithAngle:function(a,b){var c,d=["auto","nwse-resize","ns-resize","nesw-resize","ew-resize","nwse-resize","ns-resize","nesw-resize","ew-resize"];switch(a){case"northwest":c=1;break;case"north":c=2;break;case"northeast":c=3;break;case"east":c=4;break;case"southeast":c=5;break;case"south":c=6;break;case"southwest":c=7;break;case"west":c=8;break;default:c=0}return(b>=360||-360>=b)&&(b%=360),b>22.5&&67.5>=b&&(c+=1),-22.5>b&&b>=-67.5&&(c-=1),b>67.5&&112.5>=b&&(c+=2),-67.5>b&&b>=-112.5&&(c-=2),b>112.5&&157.5>=b&&(c+=3),-112.5>b&&b>=-157.5&&(c-=3),b>157.5&&202.5>=b&&(c+=4),-157.5>b&&b>=-202.5&&(c-=4),b>202.5&&247.5>=b&&(c+=5),-202.5>b&&b>=-247.5&&(c-=5),b>247.5&&292.5>=b&&(c+=6),-247.5>b&&b>=-292.5&&(c-=6),b>292.5&&337.5>=b&&(c+=7),-292.5>b&&b>=-337.5&&(c-=7),c>8&&(c-=8),0>=c&&(c+=8),d[c]}}),Gb.vector.interaction.MoveLinkInteraction=function(a,b){Gb.vector.interaction.MoveLinkInteraction.superClass.constructor.call(this,a),this.xoffset=0,this.yoffset=0},Hb.ext("twaver.vector.interaction.MoveLinkInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown"),this.oldCursor=this.network.getView().style.cursor},tearDown:function(){this.removeListener("mousedown"),this.network.getView().style.cursor=this.oldCursor,this.end()},handle_mousedown:function(a){if(0===a.button&&!this.network.isSelectingElement()&&!this.network.isEditingElement()){var b=this.network.getElementAt(a);b instanceof Gb.Link&&(this.element=b,this.end(a),this._handle_mousedown(a))}},handle_mouseup:function(a){this.end(a)},handle_mousemove:function(a){if(!this._startLogical||this.network.isSelectingElement()||this.network.isEditingElement())return void this.end(a);if(this._handle_mousemove(a),this.xoffset=this._endLogical.x-this._startLogical.x,this.yoffset=this._endLogical.y-this._startLogical.y,this.lazyMode){if(this.mark)this.network.fireInteractionEvent({kind:"lazyMoveBetween",event:a,element:this.element});else{this.mark=Ub.createCanvas();var b;this.network.getMovableSelectedElements().forEach(function(a){var c=this.getElementUI(a);c&&(b=Rb.unionRect(b,c.getViewRect()))},this.network),this.network.getTopDiv().appendChild(this.mark),this.network.setMovingElement(!0),Ub.setDiv(this.mark,b,this.network.isLazyMoveFill()?this.network.getLazyMoveFillColor():null,this.network.getLazyMoveOutlineWidth(),this.network.getLazyMoveOutlineColor()),this.network.fireInteractionEvent({kind:"lazyMoveStart",event:a,element:this.element})}this.mark.style.left=this.xoffset+this.mark._viewRect.x+"px",this.mark.style.top=this.yoffset+this.mark._viewRect.y+"px"}else{var c=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(c,this.xoffset,this.yoffset),this._startLogical=this._endLogical,this._startClient=Ub.getClientPoint(a),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a,element:this.element}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a,element:this.element}))}},end:function(a){if(this._startLogical){if(this.lazyMode){if(this.mark){var b=this,c=function(){b.network.fireInteractionEvent({kind:"lazyMoveEnd",event:a,element:this.element}),b.mark&&(b.network.getTopDiv().removeChild(b.mark),b.mark=null,b.network.setMovingElement(!1))},d=new Gb.List([this.element.getFromNode(),this.element.getToNode()]);Gb.Util.moveElements(d,this.xoffset,this.yoffset,this.network.isLazyMoveAnimate(),c)}}else this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a,element:this.element}));this._handle_mouseup(a),delete this.element}}}),Gb.vector.interaction.CreateLinkInteraction=function(a,b){b||(b=Gb.Link),this.linkFunction=Gb.Util.isTypeOf(b,Gb.Link)?function(a,c){var d=new b;return d instanceof Gb.Link&&(d.setFromNode(a),d.setToNode(c)),d}:b,Gb.vector.interaction.CreateLinkInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.CreateLinkInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this)},paint:function(a){a.beginPath();var b,c;a.lineWidth=this.network.getEditLineWidth();var d=this.network.getEditLineColor();this.currentNode&&this.currentNode!==this.fromNode&&(b=this.network.getElementUI(this.currentNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.fromNode&&(b=this.network.getElementUI(this.fromNode).getZoomViewRect(!0),c=this.convertFromUIToMarkerRect(b,0,0),Od.rect(a,c.x,c.y,c.width,c.height,null,d)),this.currentPoint&&this.paintLine(a),a.closePath()},convertFromUIToMarkerRect:function(a,b,c){var d=this.network.zoomManager,e=d.getGraphicsZoom();return{x:a.x*e-this.network.getViewRect().x+b*e,y:a.y*e-this.network.getViewRect().y+c*e,width:a.width*e,height:a.height*e}},getZoomNodeRectOrPoint:function(a,b){var c=this.network.getElementUI(a).getZoomBodyRect();return b?{x:c.x+c.width/2,y:c.y+c.height/2}:c},paintLine:function(a){var b=this.network.getEditLineColor(),c=this.network.getElementUI(this.fromNode).getZoomBodyRect(),d=this.convertPointFromView({x:c.x+c.width/2,y:c.y+c.height/2}),e=d.x,f=d.y,g=this.currentPoint.x,h=this.currentPoint.y;a.strokeStyle=b,a.beginPath(),a.moveTo(e,f),a.lineTo(g,h),a.stroke()},clear:function(){this.currentPoint=null,this.currentNode=null,this.fromNode=null,this.toNode=null},createLink:function(){return this.linkFunction(this.fromNode,this.toNode)},handle_mousedown:function(a){if(this.network.isValidEvent(a))if(this.fromNode){if(this.toNode=this.currentNode,this.toNode){var b=this.createLink();b&&this.network.addElementByInteraction(b)}this.clear()}else this.fromNode=this.currentNode,this.currentNode=null,this.currentPoint=null,this.repaint()},handle_mousemove:function(a){var b=this.getMarkerPoint(a);if(b){if(this.network.isMovingElement()||this.network.isEditingElement())return void this.clear();var c=null;this.fromNode?(this.currentNode=this.getToNode(a,this.fromNode),this.currentPoint=b,this.repaint()):(c=this.getFromNode(a),this.currentNode!==c&&(this.currentNode=c,this.repaint()))}},getFromNode:function(a){return this.getNode(a)},getToNode:function(a,b){return this.getNode(a,b)},getNode:function(a,b){var c=this.network.getElementAt(a);return c instanceof Ld&&this.network.isLinkable(c,b)&&this.network.getElementBox().getSelectionModel().isSelectable(c)?c:null}}),Gb.vector.interaction.CreateShapeLinkInteraction=function(a,b){Gb.vector.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this,a),b||(b=Gb.ShapeLink),this.linkFunction=Gb.Util.isTypeOf(b,Gb.ShapeLink)?function(a,c,d){var e=new b;if(e instanceof Gb.ShapeLink&&(e.setFromNode(a),e.setToNode(c),d)){var f=this.network.zoomManager;e.setPoints(f._getShapeLinkZoomPoints(d,!0))}return e}:b},Hb.ext("twaver.vector.interaction.CreateShapeLinkInteraction",Gb.vector.interaction.CreateLinkInteraction,{clear:function(){this.points=null,Gb.vector.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)},createLink:function(){return this.linkFunction(this.fromNode,this.toNode,this.points)},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint2(a);if(b){if(this.fromNode)if(this.toNode=this.currentNode,this.toNode){var c=this.createLink();c&&this.network.addElementByInteraction(c),this.clear()}else{if(this.points||(this.points=new Gb.List),this.points.size()>0){var d=this.points.get(this.points.size()-1);if(d.x===b.x&&d.y===b.y)return}this.points.add(b)}else this.fromNode=this.currentNode,this.points=null,this.currentNode=null,this.currentPoint=null;this.repaint()}}},paintLine:function(a){if(this.currentPoint){var b,c=new Gb.List;if(b=this.convertPointFromView(this.getZoomNodeRectOrPoint(this.fromNode,!0)),c.add(b,0),this.points&&this.points.size()>0)for(var d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.currentPoint,c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}}}),Gb.vector.interaction.CreateShapeNodeInteraction=function(a,b){b||(b=Gb.ShapeNode),this.shapeNodeFunction=Gb.Util.isTypeOf(b,Gb.ShapeNode)?function(a){var c=new b;if(c instanceof Gb.ShapeNode){var d=this.network.zoomManager,e=this.network.createElementUI(c);if(a){var f=d._getShapeNodeZoomPoints(e,a,!0);e.invalidateZoom(),c.setPoints(f)}}return c}:b,Gb.vector.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this,a),this.timeStamp=-1},Hb.ext("twaver.vector.interaction.CreateShapeNodeInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousedown","mousemove"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousedown","mousemove"),this.clear(),this.network.removeMarker(this),this.network.setEditingElement(!1)},clear:function(){this.points=null,this.currentPoint=null},paint:function(a){if(this.points&&this.points.size()>0&&this.currentPoint){for(var b,c=new Gb.List,d=this.points.size(),e=0;d>e;e++)b=this.convertPointFromView(this.points.get(e)),c.add(b);b=this.convertPointFromView(this.currentPoint),c.add(b),a.lineWidth=this.network.getEditLineWidth(),a.strokeStyle=this.network.getEditLineColor(),a.beginPath(),Vb.drawLinePoints(a,c),a.stroke()}},handle_mousedown:function(a){if(0===a.button){var b=this.network.getLogicalPoint2(a);if(b){if(2===a.detail||a.timeStamp-this.timeStamp<300){if(this.points){var c=this.shapeNodeFunction(this.points);this.network.addElementByInteraction(c),this.clear();var d=this;setTimeout(function(){d.network.setEditingElement(!1)},0)}}else{if(this.network.isEditingElement()||this.network.setEditingElement(!0),this.points||(this.points=new Gb.List),this.points.size()>0){var e=this.points.get(this.points.size()-1);if(e.x===b.x&&e.y===b.y)return}this.points.add(b)}this.timeStamp=a.timeStamp,this.repaint()}}},handle_mousemove:function(a){this.points&&(this.currentPoint=this.network.getLogicalPoint2(a),this.repaint())}}),Gb.vector.interaction.MagnifyInteraction=function(a,b,c,d,e){Gb.vector.interaction.MagnifyInteraction.superClass.constructor.call(this,a),this.scale=b||2,this.xRadius=c||100,this.yRadius=d||100,this.shape=e||"circle",this.borderColor="black",this.borderWidth=1,this.backgroundColor="white",this.markCanvas=Ub.createCanvas()},Hb.ext("twaver.vector.interaction.MagnifyInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){this.addListener("mousemove"),this.addListener("mousewheel"),this.network.addMarker(this)},tearDown:function(){this.removeListener("mousemove"),this.removeListener("mousewheel"),this.network.removeMarker(this)},paint:function(a){if(this.point){var b=this.network.zoomManager,c=b.getLocationZoom(),d=b.getGraphicsZoom(),e=(b.getSizeZoom(),this.network.getZoom(),this.xRadius/this.scale/d),f=this.yRadius/this.scale/d;if("mousewheel"===this.mouseFlag){var g={x:this.zoomPoint.x-e,y:this.zoomPoint.y-f,width:2*e,height:2*f};this.network.toCanvasByRegion(g,this.scale*d,this.markCanvas,"white");var h={x:this.zoomPoint.x-this.xRadius-this.network.viewRect.x,y:this.zoomPoint.y-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}else{var g={x:this.point.x*c-e,y:this.point.y*c-f,width:2*e,height:2*f};this.network.toCanvasByRegion(g,this.scale*d,this.markCanvas,"white");var h={x:this.point.x*c*d-this.xRadius-this.network.viewRect.x,y:this.point.y*c*d-this.yRadius-this.network.viewRect.y,width:this.markCanvas.width,height:this.markCanvas.height}}a.save(),a.beginPath(),Vb.drawVector(a,this.shape,null,h.x,h.y,2*g.width*d,2*g.height*d),a.clip(),a.fillStyle=this.backgroundColor,a.beginPath(),a.rect(h.x,h.y,h.width,h.height),a.fill(),a.drawImage(this.markCanvas,h.x,h.y),a.restore(),a.beginPath(),a.lineWidth=this.borderWidth,Vb.drawVector(a,this.shape,null,h.x+this.borderWidth/2,h.y+this.borderWidth/2,2*g.width*d-this.borderWidth,2*g.height*d-this.borderWidth),a.strokeStyle=this.borderColor,a.stroke(),this.mouseFlag=null}},handle_mousemove:function(a){this.point=this.network.getLogicalPoint(a),this.point&&(this.mouseFlag="mousemove",this.repaint())},handle_mousewheel:function(a){var b=this.network.zoomManager,c=b.getLocationZoom();1!==c&&(this.zoomPoint=this.network.getLogicalPoint2(a)),this.zoomPoint&&(this.mouseFlag="mousewheel",this.repaint())},getScale:function(){return this.scale},setScale:function(a){this.scale=a,this.network.repaintTopCanvas()},getShape:function(){return this.shape},setShape:function(a){this.shape=a,this.network.repaintTopCanvas()},getXRadius:function(){return this.xRadius},setXRadius:function(a){this.xRadius=a,this.network.repaintTopCanvas()},getYRadius:function(){return this.yRadius},setYRadius:function(a){this.yRadius=a,this.network.repaintTopCanvas()},getBorderColor:function(){return this.borderColor},setBorderColor:function(a){this.borderColor=a,this.network.repaintTopCanvas()},getBorderWidth:function(){return this.borderWidth},setBorderWidth:function(a){this.borderWidth=a,this.network.repaintTopCanvas()},getBackgroundColor:function(){return this.backgroundColor},setBackgroundColor:function(a){this.backgroundColor=a,this.network.repaintTopCanvas()}}),Gb.vector.interaction.TouchInteraction=function(a){Gb.vector.interaction.TouchInteraction.superClass.constructor.call(this,a)},Hb.ext("twaver.vector.interaction.TouchInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("touchstart","handleTouchstart",a,this),Ub.addEventListener("touchmove","handleTouchmove",a,this),Ub.addEventListener("touchend","handleTouchend",a,this),Ub.addEventListener("touchcancel","handleTouchend",a,this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("touchstart",a,this),Ub.removeEventListener("touchmove",a,this),Ub.removeEventListener("touchend",a,this),Ub.removeEventListener("touchcancel",a,this)},_isDragToSelect:function(a){return!this.network._dragToPan},handleTouchstart:function(a){if(Ub.preventDefault(a),this.isMoving=!1,this.isSelecting=!1,1==a.touches.length){var b=this.network.getLogicalPoint2(a),c=this._element=this.network.getElementAt(b);if(this._startTouchTime=new Date,this._currentTouchPoint=b,this._startTouchClient=this._currentTouchClient=this.getMarkerPoint(a),c)if(this.network.getSelectionModel().contains(c))this.isSelecting=!0;else{this.network.getSelectionModel().setSelection(c);var d=this.network.getSelectionModel();d.contains(c)&&(this.isSelecting=!0)}else this.isSelecting=!1,this.network.getSelectionModel().clearSelection();Bc.handleClicked(this.network,a,c),this._endTouchTime&&this._startTouchTime.getTime()-this._endTouchTime.getTime()<=500&&Rb.getDistance(this._endTouchClient,this._startTouchClient)<=20?(delete this._endTouchTime,delete this._endTouchClient,Bc.handleDoubleClicked(this.network,a,c)):(this._endTouchTime=this._startTouchTime,this._endTouchClient=this._startTouchClient)}else this._distance=yc.getDistance(a),this._zoom=this.network.getZoom()},handleTouchmove:function(a){if(Ub.preventDefault(a),a.touches.length>1){var b=yc.getDistance(a);if(Math.abs(b-this._distance)<20)return;var c=b/this._distance;this.network.setZoom(this._zoom*c,!1)}else if(null==this._zoom){var d=this.getMarkerPoint(a);if(Rb.getDistance(this._startTouchClient,d)<20)return;if(this._element)if(this.isSelecting||this._isDragToSelect(a)){var e=this.network.getLogicalPoint2(a),f=this.getOffset(e,this._currentTouchPoint),g=f.x,h=f.y;this._currentTouchPoint=e,this.network.moveSelectedElements(g,h),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}else{var g=this._currentTouchClient.x-d.x,h=this._currentTouchClient.y-d.y;this.network.panByOffset(g,h),this._currentTouchClient=d}else{var g=this._currentTouchClient.x-d.x,h=this._currentTouchClient.y-d.y;this.network.panByOffset(g,h),this._currentTouchClient=d}}},handleTouchend:function(a){Ub.preventDefault(a),this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),0===a.touches.length&&(this._distance=null,this._zoom=null,this._element=null,this._startTouchTime=null,this._currentTouchPoint=null,this._startTouchClient=this._currentTouchClient=null)}}),Gb.vector.interaction.MSTouchInteraction=function(a){Gb.vector.interaction.MSTouchInteraction.superClass.constructor.call(this,a),this._pointerMap={},this._pointerIdArray=[]},Hb.ext("twaver.vector.interaction.MSTouchInteraction",Gb.vector.interaction.BaseInteraction,{setUp:function(){var a=this.network.getView();Ub.addEventListener("MSPointerDown","handleTouchstart",a,this),Ub.addEventListener("MSPointerMove","handleTouchmove",a,this),Ub.addEventListener("MSPointerUp","handleTouchend",a,this),Ub.addEventListener("MSPointerCancel","handleTouchend",a,this),this.network.addMarker(this)},tearDown:function(){var a=this.network.getView();Ub.removeEventListener("MSPointerDown",a,this),Ub.removeEventListener("MSPointerMove",a,this),Ub.removeEventListener("MSPointerUp",a,this),Ub.removeEventListener("MSPointerCancel",a,this),this.network.removeMarker(this)},handleTouchstart:function(a){if(this.network.isFocusOnClick()&&Gb.Util.setFocus(this.network._view),!this.network.isSelectingElement()||a.pointerType!=a.MSPOINTER_TYPE_MOUSE){var b=this.network.getLogicalPoint2(a),c=new Date;if(a.isPrimary&&this._pointerIdArray.length>0&&this.handle_mouseup(a),this._pointerMap[a.pointerId]||(this._pointerIdArray.push(a.pointerId),this._pointerMap[a.pointerId]=a),1==this._pointerIdArray.length){var d=this.network.getElementAt(b);this._startTouchElement=d,this._startClientPoint={x:a.clientX,y:a.clientY};var e=this.network.getSelectionModel();d?Hb.isCtrlDown(a)?e.contains(d)?e.removeSelection(d):e.appendSelection(d):e.contains(d)||e.setSelection(d):Hb.isCtrlDown(a)||e.clearSelection(),Bc.handleClicked(this.network,a,d),this._startTouchTime&&this._startTouchPoint&&c.getTime()-this._startTouchTime.getTime()<=500&&Rb.getDistance(this._startTouchPoint,b)<=20?(Bc.handleDoubleClicked(this.network,a,d),this._doubleClick=!0):(Ub.handle_mousedown(this,a),this._startTouchPoint=b,this._startTouchTime=c)}else 2==this._pointerIdArray.length&&(this._distance=this._getDistance(),this._zoom=this.network.getZoom())}},handleTouchmove:function(a){if(null!=this._startTouchPoint&&0!=this._pointerIdArray.length&&this._pointerMap[a.pointerId]&&!(Rb.getDistance({x:this._pointerMap[a.pointerId].pageX,y:this._pointerMap[a.pointerId].pageY},{x:a.pageX,y:a.pageY})<=10)&&(this._pointerMap[a.pointerId]=a,2==this._pointerIdArray.length)){var b=this._getDistance()/this._distance;this.network.setZoom(this._zoom*b,!1)}},handleTouchend:function(a){if(this.network.isMovingElement()&&(this.network.setMovingElement(!1),this.network.fireInteractionEvent({kind:"liveMoveEnd",event:a})),this.network.isSelectingElement()){var b=Rb.getRect([this._startTouchPoint,this._moveTouchPoint]),c=this.network.getElementsAtRect(b,this.getIntersectMode(),this.network.getRectSelectFilter());if(c&&c.size()>0){var d=this.network.getSelectionModel(),e=d.toSelection();c.forEach(function(a){d.contains(a)?e.remove(a):e.add(a)},this),d.setSelection(e)}this.network.fireInteractionEvent({kind:"selectEnd",event:a}),this._moveTouchPoint=null,this.network.setSelectingElement(!1),this.repaint();

}this._doubleClick&&(delete this._doubleClick,delete this._startTouchPoint,delete this._startTouchTime);for(var f=-1,g=0;g<this._pointerIdArray.length;g++)if(this._pointerIdArray[g]==a.pointerId){f=g;break}f>=0&&this._pointerIdArray.splice(f,1),delete this._pointerMap[a.pointerId],this._moveTouchPoint=null},_getDistance:function(){return Rb.getDistance({x:this._pointerMap[this._pointerIdArray[0]].pageX,y:this._pointerMap[this._pointerIdArray[0]].pageY},{x:this._pointerMap[this._pointerIdArray[1]].pageX,y:this._pointerMap[this._pointerIdArray[1]].pageY})},getIntersectMode:function(){return"intersect"===this.network.getSelectMode()?!0:"contain"===this.network.getSelectMode()?!1:this._startTouchPoint.x>this._moveTouchPoint.x&&this._startTouchPoint.y>this._moveTouchPoint.y},handle_mousemove:function(a){var b={x:a.clientX,y:a.clientY};if(!(Rb.getDistance(this._startClientPoint,b)<3)&&this._startTouchPoint&&1==this._pointerIdArray.length)if(this._moveTouchPoint={x:this._startTouchPoint.x+(b.x-this._startClientPoint.x)/this.network.getZoom(),y:this._startTouchPoint.y+(b.y-this._startClientPoint.y)/this.network.getZoom()},null==this._startTouchElement&&this.network.isRectSelectEnabled()){var c=this.network.getLogicalPoint2(a);if(!c)return;this.network.setSelectingElement(!0),this.network.fireInteractionEvent(this._moveTouchPoint?{kind:"selectBetween",event:a}:{kind:"selectStart",event:a}),this.repaint()}else{var d=this.network.getElementAt(this._moveTouchPoint);if(null!=this._startTouchElement||this.network.isRectSelectEnabled()){if(this.network.isMovingElement()||null!=this._startTouchElement&&d==this._startTouchElement&&this.network.getMovableSelectedElements().contains(d)){var e=this._moveTouchPoint.x-this._startTouchPoint.x,f=this._moveTouchPoint.y-this._startTouchPoint.y;this.network.moveSelectedElements(e,f),this.network.isMovingElement()?this.network.fireInteractionEvent({kind:"liveMoveBetween",event:a}):(this.network.setMovingElement(!0),this.network.fireInteractionEvent({kind:"liveMoveStart",event:a}))}}else{var e=this._startClientPoint.x-b.x,f=this._startClientPoint.y-b.y;this.network.panByOffset(e,f)}this._startClientPoint=b}},handle_mouseup:function(a){this.handleTouchend(a),this._pointerIdArray=[],this._pointerMap={}},paint:function(a){if(this._startTouchPoint&&this._moveTouchPoint&&!this._startTouchElement&&this.network.isRectSelectEnabled()){var b=this.convertPointFromView(this._startTouchPoint),c=this.convertPointFromView(this._moveTouchPoint),d=b.x,e=b.y,f=c.x,g=c.y,h=Rb.getRect([{x:d,y:e},{x:f,y:g}]);if(null!=h){a.beginPath();var i=this.network.getSelectOutlineWidth(),j=this.getIntersectMode()?this.network.getSelectFillColor():null;a.strokeStyle=this.network.getSelectOutlineColor(),a.lineWidth=i,Od.rect(a,h.x,h.y,h.width,h.height,j,this.network.getSelectOutlineColor()),a.closePath()}}}}),Gb.XmlSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new Gb.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.xmlString=""},Hb.ext("twaver.XmlSerializer",Object,{serialize:function(){return this.xmlString="<twaver version='"+Gb.Util.getVersion()+"' platform='html5'>\n",this.serializeBody(),this.xmlString+="</twaver>\n",this.xmlString},serializeBody:function(){this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable&&(this.xmlString+="<dataBox class='"+this.dataBox.getClassName()+"'>\n",this.dataBox.serializeXml(this,this.dataBox.newInstance()),this.xmlString+="</dataBox>\n"),this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()];this.xmlString+="<data class='"+a.getClassName()+"' ref='"+c+"'",null!=this.settings.getPropertyType("id")&&(this.xmlString+=" id='"+a.getId()+"'"),this.xmlString+=">\n",a.serializeXml(this,b),this.xmlString+="</data>\n"}a.getChildren().forEach(this.serializeData,this)},serializePropertyXml:function(a,b,c){var d=this.settings.getPropertyType(b);if(d){var e=Hb.getValue(a,b,d),f=Hb.getValue(c,b,d);e!==f&&this.serializeValue("p",b,e,f,d)}},serializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(b);if(d){var e=a.getStyle(b),f=c.getStyle(b);e!=f&&this.serializeValue("s",b,e,f,d)}},serializeClientXml:function(a,b,c){var d=this.settings.getClientType(b);if(null!=d){var e=a.getClient(b),f=c.getClient(b);e!=f&&this.serializeValue("c",b,e,f,d)}},serializeValue:function(a,b,c,d,e){if(null==c)this.xmlString+="	<"+a+" n='"+b+"' none=''/>\n";else if("cdata"===e)this.xmlString+="	<"+a+" n='"+b+"'><![CDATA["+c+"]]></"+a+">\n";else if("data"===e){var f=this.refMap[c.getId()];null!=f&&(this.xmlString+="	<"+a+" n='"+b+"' ref='"+f+"'/>\n")}else"point"===e?d&&c.x===d.x&&c.y===d.y||(this.xmlString+="	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"'/>\n"):"list.point"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<p x='"+a.x+"' y='"+a.y+"'/>\n"},this),this.xmlString+="	</"+a+">\n"):"list.string"===e||"list.number"===e?(this.xmlString+="	<"+a+" n='"+b+"'>\n",c.forEach(function(a){this.xmlString+="		<s>"+a+"</s>\n"},this),this.xmlString+="	</"+a+">\n"):this.xmlString+="rectangle"===e?"	<"+a+" n='"+b+"' x='"+c.x+"' y='"+c.y+"' w='"+c.width+"' h='"+c.height+"'/>\n":"	<"+a+" n='"+b+"'>"+c+"</"+a+">\n"},deserialize:function(a,b){Hb.isDeserializing=!0,this.xmlString=a;var c=Hb.xml(a).documentElement;this.refMap={},this.idMap={};var d,e,f,g=new md,h=new md,i=c.getElementsByTagName("data"),j=i.length;for(f=0;j>f;f++){e=i[f];var k=e.getAttribute("class"),l=this.settings.getPropertyType("id");if(l&&e.hasAttribute("id")){var m=null;if("string"===l)m=e.getAttribute("id");else if("int"===l)m=parseInt(e.getAttribute("id"));else{if("number"!==l)throw"Unsupported id type '"+l+"'";m=parseFloat(e.getAttribute("id"))}if("remove"===e.getAttribute("action")){this.dataBox.removeById(m);continue}d=this.dataBox.getDataById(m),d||(d=Hb.newInstance(k,m))}else d=Hb.newInstance(k);if(e.hasAttribute("ref")){var n=e.getAttribute("ref");this.refMap[n]=d}g.add(d),h.add(e),this.idMap[d.getId()]=d}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),j=g.size(),f=0;j>f;f++)d=g.get(f),e=h.get(f),d.deserializeXml(this,e);for(f=0;j>f;f++)d=g.get(f),this.dataBox.containsById(d.getId())||(b&&!d.getParent()&&d.setParent(b),this.dataBox.add(d));this.settings.isDataBoxSerializable&&1===c.getElementsByTagName("dataBox").length&&this.dataBox.deserializeXml(this,c.getElementsByTagName("dataBox")[0]),Hb.isDeserializing=!1},deserializePropertyXml:function(a,b,c){var d=this.settings.getPropertyType(c);d&&Hb.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleXml:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientXml:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if(a.hasAttribute("@none"))return null;if("string"===b)return a.textContent;if("number"===b)return parseFloat(a.textContent);if("boolean"===b)return"true"===a.textContent;if("int"===b)return parseInt(a.textContent);if("point"===b)return{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y"))};if("data"===b){var c=a.getAttribute("ref"),d=this.refMap[c];return d?d:this.idMap[c]}var e,f,g,h;if("list.point"===b){var i=new md,j=a.getElementsByTagName("p");for(e=j.length,h=0;e>h;h++){var k=j[h];i.add({x:parseFloat(k.getAttribute("x")),y:parseFloat(k.getAttribute("y"))})}return i}if("list.string"===b){var l=new md;for(g=a.getElementsByTagName("s"),e=g.length,h=0;e>h;h++)l.add(g[h].textContent);return l}if("list.number"===b){for(f=new md,g=a.getElementsByTagName("s"),e=g.length,h=0;e>h;h++)f.add(parseFloat(g[h].textContent));return f}if("array.string"===b)return a.textContent.split(",");if("array.number"===b){for(f=a.textContent.split(","),e=f.length,h=0;e>h;h++)f[h]=parseFloat(f[h]);return f}return"rectangle"===b?{x:parseFloat(a.getAttribute("x")),y:parseFloat(a.getAttribute("y")),width:parseFloat(a.getAttribute("w")),height:parseFloat(a.getAttribute("h"))}:a.textContent}}),Hb.addMethod(Gb.Data,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b),this.serializePropertyXml(a,"parent",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),Hb.addMethod(Gb.Element,{serializeXml:function(a,b){if(a.settings.isStyleSerializable&&this._styleMap)for(var c in this._styleMap)this.serializeStyleXml(a,c,b);Gb.Element.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"layerId",b),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")&&(a.xmlString+="	<p n='alarmState'>\n",Gb.AlarmSeverity.forEach(function(b){var c=this.getNewAlarmCount(b);c>0&&(a.xmlString+="		<n n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),Gb.AlarmSeverity.forEach(function(b){var c=this.getAcknowledgedAlarmCount(b);c>0&&(a.xmlString+="		<a n='"+b.name+"' c='"+c+"'/>\n")},this._alarmState),a.xmlString+="	</p>\n")},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeXml:function(a,b){if(Gb.Element.superClass.deserializeXml.call(this,a,b),a.settings.isStyleSerializable){var c,d,e=b.getElementsByTagName("s"),f=e.length;for(c=0;f>c;c++)d=e[c],d.hasAttribute("n")&&this.deserializeStyleXml(a,d,d.getAttribute("n"))}},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializePropertyXml:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d,e,f,g=b.getElementsByTagName("n");for(e=0;e<g.length;e++)f=g[e],d=Gb.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setNewAlarmCount(d,parseInt(f.getAttribute("c")));for(g=b.getElementsByTagName("a"),e=0;e<g.length;e++)f=g[e],d=Gb.AlarmSeverity.getByName(f.getAttribute("n")),this._alarmState.setAcknowledgedAlarmCount(d,parseInt(f.getAttribute("c")))}}else Gb.Element.superClass.deserializePropertyXml.call(this,a,b,c)}}),Hb.addMethod(Ld,{serializeXml:function(a,b){Ld.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"image",b),this.serializePropertyXml(a,"location",b),Hb.num(this._width)&&this._width>=0&&this.serializePropertyXml(a,"width",b),Hb.num(this._height)&&this._height>=0&&this.serializePropertyXml(a,"height",b)}}),Hb.addMethod(Gb.Link,{serializeXml:function(a,b){Gb.Link.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"fromNode",b),this.serializePropertyXml(a,"toNode",b)}}),Hb.addMethod(Gb.Follower,{serializeXml:function(a,b){Gb.Follower.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"host",b)}}),Hb.addMethod(Nd,{serializeXml:function(a,b){Nd.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"expanded",b)}}),Hb.addMethod(Gb.ShapeNode,{serializeXml:function(a,b){Gb.ShapeNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b),this.serializePropertyXml(a,"segments",b)}}),Hb.addMethod(Gb.ShapeLink,{serializeXml:function(a,b){Gb.ShapeLink.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"points",b)}}),Hb.addMethod(Gb.RotatableNode,{serializeXml:function(a,b){Gb.RotatableNode.superClass.serializeXml.call(this,a,b),this.serializePropertyXml(a,"angle",b)}}),Hb.addMethod(Gb.DataBox,{serializeXml:function(a,b){if(a.settings.isClientSerializable&&this._clientMap)for(var c in this._clientMap)this.serializeClientXml(a,c,b);this.serializePropertyXml(a,"name",b),this.serializePropertyXml(a,"icon",b),this.serializePropertyXml(a,"toolTip",b)},serializePropertyXml:function(a,b,c){a.serializePropertyXml(this,b,c)},serializeClientXml:function(a,b,c){a.serializeClientXml(this,b,c)},deserializeXml:function(a,b){var c,d,e,f,g=b.getElementsByTagName("p"),h=g.length;for(c=0;h>c;c++)d=g[c],d.hasAttribute("n")&&this.deserializePropertyXml(a,d,d.getAttribute("n"));if(a.settings.isClientSerializable)for(e=b.getElementsByTagName("c"),h=e.length,c=0;h>c;c++)f=e[c],f.hasAttribute("n")&&this.deserializeClientXml(a,f,f.getAttribute("n"))},deserializePropertyXml:function(a,b,c){a.deserializePropertyXml(this,b,c)},deserializeClientXml:function(a,b,c){a.deserializeClientXml(this,b,c)}}),Hb.addMethod(Gb.ElementBox,{serializeXml:function(a,b){if(a.settings.isLayerBoxSerializable&&(a.xmlString+="	<layerBox>\n",this._layerBox.forEachByDepthFirst(function(b){a.xmlString+=this._layerBox.getDefaultLayer()===b?"		<layer ":"		<layer id='"+b.getId()+"' ",b.getName()&&(a.xmlString+="name='"+b.getName()+"' "),a.xmlString+="visible='"+b.isVisible()+"' editable='"+b.isEditable()+"' movable='"+b.isMovable()+"'/>\n"},null,this),a.xmlString+="	</layerBox>\n"),a.settings.isStyleSerializable&&this._styleMap)for(var c in this._styleMap)this.serializeStyleXml(a,c,b);Gb.ElementBox.superClass.serializeXml.call(this,a,b)},serializeStyleXml:function(a,b,c){a.serializeStyleXml(this,b,c)},deserializeStyleXml:function(a,b,c){a.deserializeStyleXml(this,b,c)},deserializeXml:function(a,b){if(Gb.ElementBox.superClass.deserializeXml.call(this,a,b),a.settings.isLayerBoxSerializable&&1==b.getElementsByTagName("layerBox").length)for(var c=b.getElementsByTagName("layerBox")[0].getElementsByTagName("layer"),d=0;d<c.length;d++){var e,f=c[d];if(f.hasAttribute("id")){var g=a.settings.getPropertyType("layerId");if("string"===g)e=new Gb.Layer(f.getAttribute("id"));else if("int"===g)e=new Gb.Layer(parseInt(f.getAttribute("id")));else{if("number"!==g)throw"Unsupported layer id type '"+g+"'";e=new Gb.Layer(parseFloat(f.getAttribute("id")))}this._layerBox.getDataById(e.getId())?e=this._layerBox.getDataById(e.getId()):this._layerBox.add(e)}else e=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(e);f.hasAttribute("name")&&e.setName(f.getAttribute("name")),f.hasAttribute("visible")&&e.setVisible("true"===f.getAttribute("visible")),f.hasAttribute("editable")&&e.setEditable("true"===f.getAttribute("editable")),f.hasAttribute("movable")&&e.setMovable("true"===f.getAttribute("movable"))}if(a.settings.isStyleSerializable)for(var h=b.getElementsByTagName("s"),i=h.length,d=0;i>d;d++){var j=h[d];j.hasAttribute("n")&&this.deserializeStyleXml(a,j,j.getAttribute("n"))}}}),Gb.JsonSerializer=function(a,b,c){this.dataBox=a,this.settings=b?b:new Gb.SerializationSettings,this.filterFunction=c,this.ref=0,this.refMap={},this.idMap={},this.jsonObject={}},Hb.ext("twaver.JsonSerializer",Object,{serialize:function(){return this.jsonObject={version:Gb.Util.getVersion(),platform:"html5"},this.settings.isImageSerializable&&(this.jsonObject.images={}),this.serializeBody(),JSON.stringify(this.jsonObject)},serializeBody:function(){if(this.ref=0,this.dataBox.getRoots().forEach(this.initRefs,this),this.settings.isDataBoxSerializable){var a={"class":this.dataBox.getClassName(),p:{},s:{},c:{}};this.jsonObject.dataBox=a,this.dataBox.serializeJson(this,this.dataBox.newInstance(),a),Hb.isEmptyObject(a.p)&&delete a.p,Hb.isEmptyObject(a.s)&&delete a.s,Hb.isEmptyObject(a.c)&&delete a.c}this.jsonObject.datas=[],this.dataBox.getRoots().forEach(this.serializeData,this)},initRefs:function(a){this.refMap[a.getId()]=this.ref++,a.getChildren().forEach(this.initRefs,this)},isSerializable:function(a){return this.dataBox.contains(a)?this.filterFunction&&!this.filterFunction(a)?!1:!0:!1},serializeData:function(a){if(this.isSerializable(a)){var b=a.newInstance(),c=this.refMap[a.getId()],d={"class":a.getClassName(),ref:c,p:{},s:{},c:{}};if(this.settings.getPropertyType("id")&&(this.jsonObject.id=a.getId()),this.jsonObject.datas.push(d),a.serializeJson(this,b,d),Hb.isEmptyObject(d.p)&&delete d.p,Hb.isEmptyObject(d.s)&&delete d.s,Hb.isEmptyObject(d.c)&&delete d.c,this.settings.isImageSerializable&&a.getImage){var e=a.getImage();if("string"==typeof e&&!Qd[e]&&!this.jsonObject.images[e]){var f=Hb.getImageAsset(e),g=f&&f.getImage();g&&!bd(g)&&(this.jsonObject.images[e]=g)}}}a.getChildren().forEach(this.serializeData,this)},serializePropertyJson:function(a,b,c,d){var e=this.settings.getPropertyType(b);if(e){var f=Hb.getValue(a,b,e),g=Hb.getValue(c,b,e);f!==g&&this.serializeValue(b,f,g,e,d.p)}},serializeStyleJson:function(a,b,c,d){var e=this.settings.getStyleType(b);if(e){var f=a.getStyle(b),g=c.getStyle(b);f!=g&&this.serializeValue(b,f,g,e,d.s)}},serializeClientJson:function(a,b,c,d){var e=this.settings.getClientType(b);if(null!=e){var f=a.getClient(b),g=c.getClient(b);f!=g&&this.serializeValue(b,f,g,e,d.c)}},serializeValue:function(a,b,c,d,e){if(null==b)e[a]=null;else if(b instanceof md)e[a]=b._as;else if("data"===d){var f=this.refMap[b.getId()];null!=f&&(e[a]=f)}else e[a]=b},deserialize:function(a,b){Hb.isDeserializing=!0,this.jsonObject=JSON.parse(a);var c=this.jsonObject.images;this.settings.isImageSerializable&&c&&Object.keys(c).forEach(function(a){Hb.registerImage(a,c[a])}),this.refMap={},this.idMap={};for(var d,e=new md,f=new md,g=this.jsonObject.datas.length,h=0;g>h;h++){var i=this.jsonObject.datas[h],j=i["class"],k=this.settings.getPropertyType("id");if(k&&null!=i.id){if("remove"===i.action){this.dataBox.removeById(i.id);continue}d=this.dataBox.getDataById(i.id),d||(d=Hb.newInstance(j,i.id))}else d=Hb.newInstance(j);null!=i.ref&&(this.refMap[i.ref]=d),e.add(d),f.add(i),this.idMap[d.getId()]=d}for(this.dataBox.forEach(function(a){this.idMap[a.getId()]=a},this),g=e.size(),h=0;g>h;h++)d=e.get(h),d.deserializeJson(this,f.get(h));for(h=0;g>h;h++)d=e.get(h),this.dataBox.containsById(d.getId())||(b&&!d.getParent()&&d.setParent(b),this.dataBox.add(d));this.settings.isDataBoxSerializable&&this.jsonObject.dataBox&&this.dataBox.deserializeJson(this,this.jsonObject.dataBox),Hb.isDeserializing=!1},deserializePropertyJson:function(a,b,c){var d=this.settings.getPropertyType(c);d&&Hb.setValue(a,c,this.deserializeValue(b,d))},deserializeStyleJson:function(a,b,c){var d=this.settings.getStyleType(c);d&&a.setStyle(c,this.deserializeValue(b,d))},deserializeClientJson:function(a,b,c){var d=this.settings.getClientType(c);d&&a.setClient(c,this.deserializeValue(b,d))},deserializeValue:function(a,b){if("data"===b){var c=this.refMap[a];return c?c:this.idMap[a]}return"array.number"===b?a:a instanceof Array?new md(a):a}}),Hb.addMethod(Gb.Data,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c),this.serializePropertyJson(a,"parent",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),Hb.addMethod(Gb.Element,{serializeJson:function(a,b,c){if(a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleJson(a,d,b,c);if(Gb.Element.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"layerId",b,c),this._alarmState.getHighestNativeAlarmSeverity()&&"alarmstate"===a.settings.getPropertyType("alarmState")){var e={n:{},a:{}};c.p.alarmState=e,Gb.AlarmSeverity.forEach(function(a){var b=this.getNewAlarmCount(a);b>0&&(e.n[a.name]=b)},this._alarmState),Gb.AlarmSeverity.forEach(function(a){var b=this.getAcknowledgedAlarmCount(a);b>0&&(e.a[a.name]=b)},this._alarmState),Hb.isEmptyObject(e.n)&&delete e.n,Hb.isEmptyObject(e.a)&&delete e.a,Hb.isEmptyObject(e)&&delete c.p.alarmState}},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeJson:function(a,b){if(Gb.Element.superClass.deserializeJson.call(this,a,b),a.settings.isStyleSerializable)for(var c in b.s)this.deserializeStyleJson(a,b.s[c],c)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializePropertyJson:function(a,b,c){if("alarmState"===c){if("alarmstate"===a.settings.getPropertyType("alarmState")){var d;for(d in b.n)this._alarmState.setNewAlarmCount(Gb.AlarmSeverity.getByName(d),b.n[d]);for(d in b.a)this._alarmState.setAcknowledgedAlarmCount(Gb.AlarmSeverity.getByName(d),b.a[d])}}else Gb.Element.superClass.deserializePropertyJson.call(this,a,b,c)}}),Hb.addMethod(Ld,{serializeJson:function(a,b,c){Ld.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"image",b,c),this.serializePropertyJson(a,"location",b,c),Hb.num(this._width)&&this._width>=0&&this.serializePropertyJson(a,"width",b,c),Hb.num(this._height)&&this._height>=0&&this.serializePropertyJson(a,"height",b,c)}}),Hb.addMethod(Gb.Link,{serializeJson:function(a,b,c){Gb.Link.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"fromNode",b,c),this.serializePropertyJson(a,"toNode",b,c)}}),Hb.addMethod(Gb.Follower,{serializeJson:function(a,b,c){Gb.Follower.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"host",b,c)}}),Hb.addMethod(Nd,{serializeJson:function(a,b,c){Nd.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"expanded",b,c)}}),Hb.addMethod(Gb.ShapeNode,{serializeJson:function(a,b,c){Gb.ShapeNode.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"points",b,c),this.serializePropertyJson(a,"segments",b,c)}}),Hb.addMethod(Gb.ShapeLink,{serializeJson:function(a,b,c){Gb.ShapeLink.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"points",b,c)}}),Hb.addMethod(Gb.RotatableNode,{serializeJson:function(a,b,c){Gb.RotatableNode.superClass.serializeJson.call(this,a,b,c),this.serializePropertyJson(a,"angle",b,c)}}),Hb.addMethod(Gb.DataBox,{serializeJson:function(a,b,c){if(a.settings.isClientSerializable&&this._clientMap)for(var d in this._clientMap)this.serializeClientJson(a,d,b,c);this.serializePropertyJson(a,"name",b,c),this.serializePropertyJson(a,"icon",b,c),this.serializePropertyJson(a,"toolTip",b,c)},serializePropertyJson:function(a,b,c,d){a.serializePropertyJson(this,b,c,d)},serializeClientJson:function(a,b,c,d){a.serializeClientJson(this,b,c,d)},deserializeJson:function(a,b){var c;for(c in b.p)this.deserializePropertyJson(a,b.p[c],c);if(a.settings.isClientSerializable)for(c in b.c)this.deserializeClientJson(a,b.c[c],c)},deserializePropertyJson:function(a,b,c){a.deserializePropertyJson(this,b,c)},deserializeClientJson:function(a,b,c){a.deserializeClientJson(this,b,c)}}),Hb.addMethod(Gb.ElementBox,{serializeJson:function(a,b,c){if(a.settings.isLayerBoxSerializable&&(c.layers=[],this._layerBox.forEachByDepthFirst(function(a){var b={};c.layers.push(b),this._layerBox.getDefaultLayer()!==a&&(b.id=a.getId()),a.getName()&&(b.name=a.getName()),b.visible=a.isVisible(),b.editable=a.isEditable(),b.movable=a.isMovable()},null,this)),a.settings.isStyleSerializable&&this._styleMap)for(var d in this._styleMap)this.serializeStyleJson(a,d,b,c);Gb.ElementBox.superClass.serializeJson.call(this,a,b,c)},serializeStyleJson:function(a,b,c,d){a.serializeStyleJson(this,b,c,d)},deserializeStyleJson:function(a,b,c){a.deserializeStyleJson(this,b,c)},deserializeJson:function(a,b){if(Gb.ElementBox.superClass.deserializeJson.call(this,a,b),a.settings.isLayerBoxSerializable&&b.layers&&b.layers)for(var c=b.layers.length,d=0;c>d;d++){var e,f=b.layers[d];null!=f.id?(e=new Gb.Layer(f.id),this._layerBox.getDataById(e.getId())?e=this._layerBox.getDataById(e.getId()):this._layerBox.add(e)):(e=this._layerBox.getDefaultLayer(),this._layerBox.moveToBottom(e)),f.name&&e.setName(f.name),null!=f.visible&&e.setVisible(f.visible),null!=f.editable&&e.setEditable(f.editable),null!=f.movable&&e.setMovable(f.movable)}if(a.settings.isStyleSerializable)for(var g in b.s)this.deserializeStyleJson(a,b.s[g],g)}}),Gb.layout.SpringLayouter=function(a){this._network=a,this._damper=1,this._maxMotion=0,this._motionRatio=0,this._isAdjusting=!1,this._timer=null,this._snodeMap={},this._snodes=new md,this._slinks=new md,this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this),this._network.addPropertyChangeListener(this._handleNetworkPropertyChange,this)},Hb.ext("twaver.layout.SpringLayouter",Object,{_nodeRepulsionFactor:.6,_linkRepulsionFactor:.6,_limitBounds:null,_interval:50,_stepCount:10,_motionLimit:.01,start:function(){if(!this._timer){var a=this,b=function(){a.relax.call(a)};this._timer=window.setInterval(b,this._interval),this._damper=1}},stop:function(){this._timer&&(window.clearInterval(this._timer),this._timer=null)},relax:function(){if(!(this._damper<.1&&this._maxMotion<this._motionLimit)){this._rebuild();for(var a=this._snodes.size(),b=0;b<this._stepCount;b++){this._slinks.forEach(this._relaxLink,this);for(var c=0;a>c;c++)for(var d=0;a>d;d++){var e=this._snodes.get(c),f=this._snodes.get(d);e!=f&&this._relaxNodePair(e,f)}this._moveNodes()}this._isAdjusting=!0;for(var b=0;a>b;b++){var g=this._snodes.get(b);g.fix||g.element.setLocation(g.x,g.y)}this._isAdjusting=!1}},isRunning:function(){return!!this._timer},getNetwork:function(){return this._network},isVisible:function(a){return this._network.isVisible(a)},isMovable:function(a){return this._network.isMovable(a)?this._network.getSelectionModel().contains(a)?!1:a instanceof Nd?!1:!0:!1},getNodeRepulsionFactor:function(){return this._nodeRepulsionFactor},setNodeRepulsionFactor:function(a){.02>a&&(a=.02),this._nodeRepulsionFactor=a,this._damper=1},getLinkRepulsionFactor:function(){return this._linkRepulsionFactor},setLinkRepulsionFactor:function(a){.02>a&&(a=.02),this._linkRepulsionFactor=a,this._damper=1},getStepCount:function(){return this._stepCount},setStepCount:function(a){this._stepCount=a,this._damper=1},getInterval:function(){return this._interval},setInterval:function(a){if(this._interval!==a&&(this._interval=a,this._timer)){window.clearInterval(this._timer);var b=this,c=function(){b.relax.call(b)};this._timer=window.setInterval(c,this._interval)}},getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},_handleDataPropertyChange:function(a){this._isAdjusting||(this._damper=1)},_handleDataBoxChange:function(a){this._damper=0===this._network.getElementBox().size()?0:1},_handleNetworkPropertyChange:function(a){if("elementBox"===a.property){var b=a.oldValue;null!=b&&(b.removeDataBoxChangeListener(this._handleDataBoxChange,this),b.removeDataPropertyChangeListener(this._handleDataPropertyChange,this)),this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange,this),this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange,this)}},_relaxLink:function(a){var b=a.toNode.x-a.fromNode.x,c=a.toNode.y-a.fromNode.y,d=Math.sqrt(b*b+c*c),e=.25*b,f=.25*c;e/=100*a.length;var g=a.length,h=100*g,i=f;f/=h,i/=100*a.length,a.toNode.dx=a.toNode.dx-e*d,a.toNode.dy=a.toNode.dy-f*d,a.fromNode.dx=a.fromNode.dx+e*d,a.fromNode.dy=a.fromNode.dy+f*d},_relaxNodePair:function(a,b){var c=0,d=0,e=a.x-b.x,f=a.y-b.y,g=e*e+f*f;0===g?(c=Gb.Util.random(),d=Gb.Util.random()):36e4>g&&(c=e/g,d=f/g);var h=a.repulsion*b.repulsion/100,i=.25*h;a.dx+=c*i,a.dy+=d*i,b.dx-=c*i,b.dy-=d*i},_moveNodes:function(){for(var a=this._maxMotion,b=0,c=0,d=this._snodes.size();d>c;c++){var e=this._snodes.get(c),f=e.dx,g=e.dy;f*=this._damper,g*=this._damper,e.dx=f/2,e.dy=g/2;var h=Math.sqrt(f*f+g*g);if(!e.fix)if(e.x=e.x+Math.max(-30,Math.min(30,f)),e.y=e.y+Math.max(-30,Math.min(30,g)),this._limitBounds){e.x<this._limitBounds.x&&(e.x=this._limitBounds.x,this._adjustLocation(1,0)),e.y<this._limitBounds.y&&(e.y=this._limitBounds.y,this._adjustLocation(0,1));var i,j=this._network.getElementUI(e.element);i=j?j._viewRect:e.element.getRect(),i&&(e.x+i.width>this._limitBounds.x+this._limitBounds.width&&(e.x=this._limitBounds.x+this._limitBounds.width-i.width,this._adjustLocation(-1,0)),e.y+i.height>this._limitBounds.y+this._limitBounds.height&&(e.y=this._limitBounds.y+this._limitBounds.height-i.height,this._adjustLocation(0,-1)))}else e.x<1&&this._adjustLocation(1,0),e.y<1&&this._adjustLocation(0,1);b=Math.max(h,b)}this._maxMotion=b,this._motionRatio=this._maxMotion>0?a/this._maxMotion-1:0,this._damp()},_damp:function(){this._motionRatio<=.001&&((this._maxMotion<.2||this._maxMotion>1&&this._damper<.9)&&this._damper>.01?this._damper-=.01:this._maxMotion<.4&&this._damper>.003?this._damper-=.003:this._damper>1e-4&&(this._damper-=1e-4)),this._maxMotion<this._motionLimit&&(this._damper=0)},_rebuild:function(){this._snodeMap={},this._snodes.clear(),this._slinks.clear(),this._network.getElementBox().forEach(function(a){this.isVisible(a)&&(a instanceof Gb.Link?this._addLink(a):a instanceof Ld&&this._addNode(a))},this)},_addNode:function(a){var b=this._snodeMap[a.getId()];return b?b:(b={},b.element=a,b.repulsion=this._getRepulsion(a),b.x=a.getX(),b.y=a.getY(),b.dx=0,b.dy=0,b.fix=!this.isMovable(a),this._snodeMap[a.getId()]=b,this._snodes.add(b),b)},_addLink:function(a){var b={};b.fromNode=this._addNode(a.getFromNode()),b.toNode=this._addNode(a.getToNode()),b.element=a;var c,d,e=this._network.getElementUI(a.getToNode()),f=this._network.getElementUI(a.getFromNode());e&&e._viewRect&&f&&f._viewRect?(c=e._viewRect.width+f._viewRect.width,d=e._viewRect.height+f._viewRect.height):(c=a.getToNode().getWidth()+a.getFromNode().getWidth(),d=a.getToNode().getHeight()+a.getFromNode().getHeight()),b.length=Math.floor(Math.sqrt(c*c+d*d)*this._linkRepulsionFactor),b.length<=0&&(b.length=100),this._slinks.add(b)},_getRepulsion:function(a){var b,c=this._network.getElementUI(a);if(c&&c._viewRect){var d=c._viewRect;b=Math.floor(Math.sqrt(d.width*d.width+d.height*d.height)*this._nodeRepulsionFactor)}else b=100;return 0>=b&&(b=100),b},_adjustLocation:function(a,b){for(var c=0,d=this._snodes.size();d>c;c++){var e,f=this._snodes.get(c),g=this._network.getElementUI(f.element);if(e=g?g._viewRect:f.element.getRect(),!e)return;a>0?(!this._limitBounds||f.x+e.width+a<this._limitBounds.x+this._limitBounds.width)&&(f.x+=a):(!this._limitBounds||f.x+a>this._limitBounds.x)&&(f.x+=a),b>0?(!this._limitBounds||f.y+e.height+b<this._limitBounds.y+this._limitBounds.height)&&(f.y+=b):(!this._limitBounds||f.y+b>this._limitBounds.y)&&(f.y+=b)}}}),Gb.layout.CloudLayouter=function(a){Gb.layout.CloudLayouter.superClass.constructor.apply(this,arguments),this._network=a,this._centerX=0,this._centerY=0,this._radius=1,this._rect=null,this._localPoint=null,this._lastWidth=-1e3,this._lastHeight=-1e3,this._nodes=new md,this._sa=0,this._ca=0,this._sb=0,this._cb=0,this._sc=0,this._cc=0,this._lasta=0,this._lastb=0,this._active=!1,this._horizontalElliptical=1,this._verticalElliptical=1,this._timer=null,this._centering=!1,this._centeringNode=null,this._freeze=!1,this._network.setInteractions("twaver.network.Network"===this._network.getClassName()?[new Gb.network.interaction.SelectInteraction(this._network)]:[new Gb.canvas.interaction.SelectInteraction(this._network)]);

},Hb.ext("twaver.layout.CloudLayouter",Gb.PropertyChangeDispatcher,{__accessor:["updateNodeFunction","mouseMoveFunction","mouseOverFunction","percentPadding","ceaseRate","ceaseLimit"],__bool:["elliptical","active","updateLayoutRectOnResized","reloadOnDataBoxChanged"],_moveSpeed:2,_ceaseRate:.9,_ceaseLimit:.01,_percentPadding:.2,_elliptical:!0,_interval:50,_reloadOnDataBoxChanged:!0,_updateLayoutRectOnResized:!0,getNetwork:function(){return this._network},isLayoutable:function(a){return this._network.isVisible(a)&&this._network.isMovable(a)},start:function(a){if(0===arguments.length&&(a=!0),!this._timer){this._installListeners(),a&&this.updateLayoutRect(!0);var b=this,c=function(){b._update.call(b)};this._timer=window.setInterval(c,this._interval),this._update()}},stop:function(){this._timer&&(window.clearInterval(this._timer),this._timer=null)},isRunning:function(){return!!this._timer},getInterval:function(){return this._interval},setInterval:function(a){if(this._interval!==a){var b=this._interval;if(this._interval=a,this._timer){window.clearInterval(this._timer);var c=this,d=function(){c._update.call(c)};this._timer=window.setInterval(d,this._interval)}this.firePropertyChange("interval",b,a)}},getMoveSpeed:function(){return this._moveSpeed},setMoveSpeed:function(a){var b=this._moveSpeed;this._moveSpeed=a,this.firePropertyChange("moveSpeed",b,a)},getLayoutRect:function(){var a=this._network.getView().offsetWidth/this._network.getZoom(),b=this._network.getView().offsetHeight/this._network.getZoom(),c=a*this._percentPadding,d=b*this._percentPadding;return{x:c,y:d,width:a-2*c,height:b-2*d}},getCount:function(){return this._nodes.size()},updateLayoutRect:function(a){var b=this._radius;if(this._rect=this.getLayoutRect(),this._rect.width<=2&&(this._rect.width=2),this._rect.height<=2&&(this._rect.height=2),this._radius=Math.min(this._rect.width/2,this._rect.height/2),this.isElliptical()?(this._horizontalElliptical=this._rect.width/2/this._radius,this._verticalElliptical=this._rect.height/2/this._radius):(this._horizontalElliptical=1,this._verticalElliptical=1),this._centerX=this._rect.x+this._rect.width/2,this._centerY=this._rect.y+this._rect.height/2,a)this.reload();else{this._lasta=1,this._lastb=1;for(var c=this._nodes.size(),d=0;c>d;d++){var e=this._nodes.get(d);e.cx*=this._radius/b,e.cy*=this._radius/b,e.cz*=this._radius/b}this._freeze?this._updateNodes(0,0,0):this._update()}this._lastWidth=this._network.getView().offsetWidth,this._lastHeight=this._network.getView().offsetHeight},reload:function(){this._freeze=!1,this._centeringNode=null,this._localPoint=null,this._centering=!1,this._nodes=new md,this._box.forEach(function(a){if(a&&this.isLayoutable(a)){var b={};b.node=a,this._nodes.add(b)}},this),this._sineCosine(0,0,0),this._active=!1,this._lasta=1,this._lastb=1;for(var a=0,b=0,c=this._nodes.size(),d=0;c>d;d++){a=Math.acos(-1+(2*(d+1)-1)/c),b=Math.sqrt(c*Math.PI)*a;var e=this._nodes.get(d);e.cx=this._radius*Math.cos(b)*Math.sin(a),e.cy=this._radius*Math.sin(b)*Math.sin(a),e.cz=this._radius*Math.cos(a)}},_sineCosine:function(a,b,c){var d=Math.PI/180;this._sa=Math.sin(a*d),this._ca=Math.cos(a*d),this._sb=Math.sin(b*d),this._cb=Math.cos(b*d),this._sc=Math.sin(c*d),this._cc=Math.cos(c*d)},handleSelectionChange:function(a){this.centerNode(this._network.getSelectionModel().getLastData())},handleDataBoxChange:function(a){(this._reloadOnDataBoxChanged||"clear"===a.kind)&&this.reload()},handleMouseMove:function(a){this._centering||this._updateLogicalPoint(a),this._active=this._mouseMoveFunction?this._mouseMoveFunction(a):!0},handleMouseOver:function(a){this._centering||this._updateLogicalPoint(a),this._active=this._mouseOverFunction?this._mouseOverFunction(a):!0},_updateLogicalPoint:function(a){this._localPoint=this._network.getLogicalPoint(a)},handleRollOut:function(a){this._active=!1},handleResize:function(a){if("validateEnd"===a.kind){if(!this._updateLayoutRectOnResized)return;if(Math.abs(this._network.getView().offsetWidth-this._lastWidth)<=2&&Math.abs(this._network.getView().offsetHeight-this._lastHeight)<=2)return;this.updateLayoutRect()}},handleNetworkPropertyChange:function(a){"elementBox"===a.property&&(this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this.reload()),"zoom"===a.property&&(this._localPoint=null,this.updateLayoutRect())},_adjustIndex:function(){this._nodes.sort(this._sortFunction);for(var a=this._nodes.size(),b=0;a>b;b++){var c=this._nodes.get(b).node,d=this._box.getDatas().indexOf(c);this._box.getDatas().removeAt(d),this._box.getDatas().add(c,b),this._box.fireIndexChange(c,d,b),this.updateNode(c,b,a,this._nodes.get(b).alpha)}},_sortFunction:function(a,b){return b.cz>a.cz?1:b.cz<a.cz?-1:0},updateNode:function(a,b,c,d){this._updateNodeFunction&&this._updateNodeFunction(a,b,c,d)},_update:function(){if(!this._freeze){var a,b;if(this._centering&&this._centeringNode){var c=this.isAtCenter(this._centeringNode.node,this._centeringNode.perspective,this._centeringNode.cx,this._centeringNode.cy,this._centeringNode.cz);if(c)return this._freeze=!0,this._centering=!1,void(this._centeringNode=null)}if(!this._freeze&&(this._active||this._centering)&&this._localPoint?this.isElliptical()?(a=(this._centerY-this._localPoint.y)/(this._rect.height/2)*this._moveSpeed,b=(this._localPoint.x-this._centerX)/(this._rect.width/2)*this._moveSpeed):(a=(this._centerY-this._localPoint.y)/this._radius*this._moveSpeed,b=(this._localPoint.x-this._centerX)/this._radius*this._moveSpeed):(a=this._lasta*this._ceaseRate,b=this._lastb*this._ceaseRate),this._lasta=a,this._lastb=b,Math.abs(a)>this._ceaseLimit||Math.abs(b)>this._ceaseLimit){var d=0;this._sineCosine(a,b,d);for(var e=0,f=this._nodes.size();f>e;e++){var g=this._nodes.get(e),h=g.cx,i=g.cy*this._ca+g.cz*-this._sa,j=g.cy*this._sa+g.cz*this._ca,k=h*this._cb+j*this._sb,l=i,m=h*-this._sb+j*this._cb,n=k*this._cc+l*-this._sc,o=k*this._sc+l*this._cc,p=m;g.cx=n,g.cy=o,g.cz=p;var q=2*this._radius;q/=q+p,g.perspective=q,g.alpha=(this._radius-p)/(2*this._radius);var r=this._horizontalElliptical*n*q-2*this._horizontalElliptical+this._centerX,s=o*q*this._verticalElliptical+this._centerY;g.node.setCenterLocation(r,s)}this._adjustIndex()}}},centerNode:function(a){if(a&&this.isLayoutable(a)){if(this._centeringNode&&a===this._centeringNode.node&&this._freeze)return;for(var b=0,c=this._nodes.size();c>b;b++){var d=this._nodes.get(b);if(d&&a===d.node){this._centering=!0,this._freeze=!1,this._active=!0,this._centeringNode=d,this._localPoint=this.createControlPoint(this._centeringNode.node);break}}}else this._centering=!1,this._freeze=!1,this._active=!1,this._localPoint=null},createControlPoint:function(a){var b=a.getCenterLocation(),c=this.getLayoutRect(),d=c.x+c.width/2,e=c.y+c.height/2,f=Math.atan2(b.y-e,b.x-d),g=c.width+c.height;return{x:d+g*Math.cos(f),y:e+g*Math.sin(f)}},isAtCenter:function(a,b,c,d,e){if(this._moveSpeed<=0)return!0;var f=16/this._moveSpeed;return f>20?f=20:2>f&&(f=2),-e/Math.sqrt(c*c+d*d)>f},_updateNodes:function(a,b,c){this._sineCosine(a,b,c);for(var d=0,e=this._nodes.size();e>d;d++){var f=this._nodes.get(d),g=f.cx,h=f.cy*this._ca+f.cz*-this._sa,i=f.cy*this._sa+f.cz*this._ca,j=g*this._cb+i*this._sb,k=h,l=g*-this._sb+i*this._cb,m=j*this._cc+k*-this._sc,n=j*this._sc+k*this._cc,o=l;f.cx=m,f.cy=n,f.cz=o;var p=2*this._radius;p/=p+o,f.perspective=p;var q=this._horizontalElliptical*m*p-2*this._horizontalElliptical+this._centerX,r=n*p*this._verticalElliptical+this._centerY;f.node.setCenterLocation(q,r)}this._adjustIndex()},_installListeners:function(){this._box=this._network.getElementBox(),this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._network.addViewListener(this.handleResize,this),Ub.addEventListener("mouseout","handleRollOut",this._network.getView(),this),Ub.addEventListener("mousemove","handleMouseMove",this._network.getView(),this),Ub.addEventListener("mouseover","handleMouseOver",this._network.getView(),this),this._network.addPropertyChangeListener(this.handleNetworkPropertyChange,this)},_uninstallListeners:function(){this._box.removeDataBoxChangeListener(this.handleDataBoxChange,this),this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._network.removeViewListener(this.handleResize,this),Ub.removeEventListener("mouseout",this._network.getView(),this),Ub.removeEventListener("mousemove",this._network.getView(),this),Ub.removeEventListener("mouseover",this._network.getView(),this),this._network.removePropertyChangeListener(this.handleNetworkPropertyChange,this)}}),Gb.layout.AutoLayouter=function(a,b){this._box=a,this._network=b},Hb.ext("twaver.layout.AutoLayouter",Object,{_expandGroup:!1,_repulsion:1,_type:null,_animate:!0,_explicitXOffset:Number.NaN,_explicitYOffset:Number.NaN,_xOffset:0,_yOffset:0,isExpandGroup:function(){return this._expandGroup},setExpandGroup:function(a){this._expandGroup=a},getRepulsion:function(){return this._repulsion},setRepulsion:function(a){this._repulsion=a},getType:function(){return this._type},isAnimate:function(){return this._animate},setAnimate:function(a){this._animate=a},getElementBox:function(){return this._box},getExplicitXOffset:function(){return this._explicitXOffset},setExplicitXOffset:function(a){this._explicitXOffset=a},getExplicitYOffset:function(){return this._explicitYOffset},setExplicitYOffset:function(a){this._explicitYOffset=a},getNodeRect:function(a){var b=this;if(a instanceof Gb.Group&&a.isExpanded()&&a.getChildrenSize()>0){for(var c=null,d=0,e=a.getChildrenSize();e>d;d++){var f=a.getChildAt(d);f instanceof Gb.Node&&(c=Gb.Util.unionRect(c,b.getNodeRect(f)))}var g=a.s("group.padding"),h=a.s("group.padding.top"),i=a.s("group.padding.bottom"),j=a.s("group.padding.left"),k=a.s("group.padding.right");return g&&Gb.Util.grow(c,g,g),h&&(c.y-=h,c.height+=h),i&&(c.height+=h),j&&(c.x-=j,c.width+=j),k&&(c.width+=k),c}if(this._network){var l=this._network.getElementUI(a);return l.invalidate(),l.validate(),l.getViewRect()}return null},getDimension:function(a){var b=this.getNodeRect(a);return b?{width:b.width,height:b.height}:{width:a.getWidth(),height:a.getHeight()}},isVisible:function(a){return!0},isMovable:function(a){return!0},getGroupLayoutType:function(a){return this._type},getElements:function(){var a,b=this._box,c=b.getSelectionModel().size()>1;c?a=b.getSelectionModel().getSelection():(a=new md,b.forEachByBreadthFirst(a.add,null,a)),this._xOffset=-1,this._yOffset=-1;for(var d=new md,e=0,f=a.size();f>e;e++){var g=a.get(e);this.isVisible(g)&&(g instanceof Gb.Link?d.add(g):this.isMovable(g)&&g instanceof Ld&&(d.add(g),c&&((this._xOffset<0||g.getX()<this._xOffset)&&(this._xOffset=g.getX()),(this._yOffset<0||g.getY()<this._yOffset)&&(this._yOffset=g.getY()))))}return c||(this._xOffset=isNaN(this._explicitXOffset)?50/this._repulsion:this._explicitXOffset,this._yOffset=isNaN(this._explicitYOffset)?50/this._repulsion:this._explicitYOffset),d},getLayoutResult:function(a){var b={};return this.doLayoutImpl(a,null,b),b},doLayout:function(a,b){return this.doLayoutImpl(a,b)},doLayoutImpl:function(a,b,c){var d=this,e=b;b=function(a){d._box._layoutMovingElements=!1,e&&e(a)},this._type=a;var f=null;if("round"===a?f=new df:"symmetry"===a?f=new sf:"hierarchic"===a?f=new Cf:("topbottom"===a||"bottomtop"===a||"rightleft"===a||"leftright"===a)&&(f=new Re),null==f)return!1;d._box._layoutMovingElements=!0;var g={},h=this.getElements(),i=new tf(this,h,!0,null);h=i.process();var j=new nf(this,h,a,!0,null);try{f.i2(j)}catch(k){return i.resetGroup(),null!=b&&b(!1),!1}var l,m;for(l in j._a){m=j._a[l];var n=j.g4(m);g[l]={x:n.x+this._xOffset,y:n.y+this._yOffset}}var o;if("rightleft"===a||"leftright"===a||"bottomtop"===a){var p=tf.createMatrix(a),q=Number.MAX_VALUE,r=Number.MAX_VALUE;for(l in g){m=j._a[l],o=g[l];var s=p.transform(o);o.x=s.x,o.y=s.y;var t;"rightleft"===a||"leftright"===a?(t=s.x-j.g9(m)/2/this._repulsion,q>t&&(q=t),t=s.y-j.gj(m)/2/this._repulsion,r>t&&(r=t)):(t=s.x-j.gj(m)/2/this._repulsion,q>t&&(q=t),t=s.y-j.g9(m)/2/this._repulsion,r>t&&(r=t))}for(l in g)m=j._a[l],o=g[l],o.x=o.x-q+this._xOffset,o.y=o.y-r+this._yOffset}if(null==c&&this._animate){var u=new md,v=new md;for(l in g)u.add(j._a[l].node),v.add(g[l]);Gb.animate.AnimateManager.endAnimate(),d._box._dataBoxChangeDispatcher.fire({kind:"layouting"}),Gb.animate.AnimateManager.start(new Gb.animate.AnimateCenterLocation(u,v,function(){i.resetGroup(),d._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),null!=b&&Hb.callLater(b,null,[!0])}))}else{d._box._dataBoxChangeDispatcher.fire({kind:"layouting"});for(l in g)m=j._a[l],o=g[l],null==c?m.node.setCenterLocation(o.x,o.y):c[m.node.getId()]=o;i.resetGroup(),d._box._dataBoxChangeDispatcher.fire({kind:"layoutEnd"}),null!=b&&Hb.callLater(b,null,[!0])}return!0}});var Sd=function(a,b){this.x=a,this.y=b};Hb.ext(Sd,Object,{equals:function(a){return this===a?!0:a instanceof Sd?a.x==this.x&&a.y==this.y:!1}});var Td=function(a,b){this.width=a,this.height=b};Hb.ext(Td,Object,{});var Ud=function(a,b){this.x=a,this.y=b};Hb.ext(Ud,Object,{});var Vd=function(){2===arguments.length?(Vd.superClass.constructor.call(this,arguments[1].width,arguments[1].height),this.x=arguments[0].x,this.y=arguments[0].y):(Vd.superClass.constructor.call(this,arguments[2],arguments[3]),this.x=arguments[0],this.y=arguments[1])};Hb.ext(Vd,Td,{});var Wd=function(a,b){if(Wd.a2(a.x,b.x))this._a=1,this._b=0,this._c=-a.x;else{this._b=-1;var c=(b.y-a.y)/(b.x-a.x),d=a.y-a.x*c;this._a=c,this._c=d}};Hb.ext(Wd,Object,{a3:function(){return this._a},a4:function(){return this._b},a5:function(){return this._c}}),Wd.a6=function(a,b){if(Wd.a1(a.a3())&&Wd.a1(b.a3()))return null;if(Wd.a1(a.a4())&&Wd.a1(b.a4()))return null;if(Wd.a1(b.a4())){var c=a;a=b,b=c}var d,e,f=a.a3(),g=a.a4(),h=-a.a5();Wd.a1(a.a3())?(d=b.a4(),e=-b.a5()):(d=b.a4()-b.a3()/a.a3()*a.a4(),e=-b.a5()-b.a3()/a.a3()*-a.a5());var i=e/d,j=(h-i*g)/f;return new Sd(j,i)},Wd.a1=function(a){return Wd.a2(a,0)},Wd.a2=function(a,b){return Math.abs(a-b)<1e-5};var Xd=function(a){if(this._a=new qe,a)for(var b=0;b<a.size();b++)this._a.aa(a.get(b))};Hb.ext(Xd,Object,{c:function(){return this._a.ah()},d:function(){return this._a.ah()},a:function(){for(var a=new md,b=this.c();b.i1();b.i2())a.add(b.i6(),0);return new Xd(a)},b:function(){return this._a.ay()}});var Yd=function(a,b){this.x=a,this.y=b};Hb.ext(Yd,Object,{a:function(a,b){this.x=a,this.y=b}});var Zd=function(a,b){this.x=a||0,this.y=b||0};Hb.ext(Zd,Object,{b:function(){return new Zd(this.x,this.y)},a:function(a){this.z=a},c:function(){return this.x},d:function(){return this.y},f:function(a,b){this.x=a,this.y=b}});var $d=function(a){this._c=new qe,a?(this.ac(a.a8().b()),this.ad(a.a9().b())):(this.ac(new Zd),this.ad(new Zd))};Hb.ext($d,Object,{a6:function(){return this.a5(this)},ac:function(a){a.a(this),this._a=a},ad:function(a){a.a(this),this._b=a},a8:function(){return this._a},a9:function(){return this._b},a1:function(a,b){return this.a4(a,b,this.aa())},a2:function(){return this._c.ay()},a7:function(a){return this._c.ak(a)},aa:function(){return 0===this._c.ay()?null:this._c.as()},a3:function(){this._c.af()},i2:function(a){var b=this.a7(a);return null!=b?new Sd(b.x,b.y):null},i1:function(){return this.a2()},i6:function(){var a=this.a8();return new Sd(a.c(),a.d())},i7:function(){var a=this.a9();return new Sd(a.c(),a.d())},i8:function(a){this.a8().f(a.x,a.y)},i9:function(a){this.a9().f(a.x,a.y)},i3:function(a,b,c){var d=this.a7(a);null!=d&&d.a(b,c)},i4:function(a,b){this.a1(a,b)},i5:function(){this.a3()}});var _d=function(a){_d.superClass.constructor.call(this,a)};Hb.ext(_d,$d,{a5:function(a){return new _d(a)},a4:function(a,b,c){var d=new Yd(a,b);return this.ab(d,c),d},ab:function(a,b){this._c.an(a,this._c.al(b))}});var ae=function(){if(2===arguments.length){var a=arguments[0],b=arguments[1];this._s=!1,this._w=30,this._h=30,this._x=a-this._w/2,this._y=b-this._h/2}else{var c=arguments[0];this._s=c._s,this._w=c._w,this._h=c._h,this._x=c._x,this._y=c._y}};Hb.ext(ae,Object,{m3:function(){return this.m2(this)},m4:function(){return this._x+this._w/2},m5:function(){return this._y+this._h/2},m6:function(a,b){this._x=a-this._w/2,this._y=b-this._h/2},i1:function(){return this._x},i2:function(){return this._y},i5:function(a,b){this._x=a,this._y=b},i3:function(){return this._w},i4:function(){return this._h},i6:function(a,b){var c=(this._w-a)/2,d=(this._h-b)/2;this._x+=c,this._y+=d,this._w=a,this._h=b},m1:function(a){var b,c,d,e;a.width<=0?(b=this._x,c=this._x+this._w,d=this._y,e=this._y+this._h):(b=Math.min(this._x,a.x),c=Math.max(this._x+this._w,a.x+a.width),d=Math.min(this._y,a.y),e=Math.max(this._y+this._h,a.y+a.height)),a.x=b,a.y=d,a.width=c-b,a.height=e-d}});var be=function(a){a?be.superClass.constructor.call(this,a):be.superClass.constructor.call(this,0,0)};Hb.ext(be,ae,{m2:function(a){return new be(a)}});var ce={};ce.a2=function(a){var b=Ne.a2(Hf.a(a.xa()));return ce.a4(a,b,ce.a3(a,b))},ce.a3=function(a,b){for(var c=a.x9();c.i1();c.i2())b.i7(c.i9(),-1);for(var d=0,e=new we(a.xa()),f=a.x9();f.i1();f.i2()){var g=f.i9();-1===b.i2(g)&&ce.a(g,e,b,d++)}return d},ce.a6=function(a){for(var b=new re,c=ce.a2(a),d=0;d<c.length-1;d++){var e=a.xo(c[d].x2(),c[d+1].x3());b.aa(e)}return b},ce.a4=function(a,b,c){for(var d=[],e=0;c>e;e++)d[e]=new Je;for(var f=a.x9();f.i1();f.i2())d[b.i2(f.i9())].ae(f.i9());return d},ce.a=function(a,b,c,d){for(b.c(a),c.i7(a,d);!b.a();){a=b.b();for(var e=a.ag();null!=e;e=e.a8()){var f=e.a3();-1===c.i2(f)&&(c.i7(f,d),b.c(f))}for(var g=a.ae();null!=g;g=g.a7()){var h=g.a2();-1===c.i2(h)&&(c.i7(h,d),b.c(h))}}},ce.a1=function(a,b,c){var d=new le(b,c);return d.a8(a),d._i},ce.a5=function(a,b,c){for(var d=[],e=0;c>e;e++)d[e]=new re;for(var f=a.xf();f.i1();f.i2())d[b.i2(f.i8())].aa(f.i8());return d},ce.a7=function(a){var b=new re,c=Ne.a3(Hf.b(a.xa())),d=Ne.a4(Hf.a(a.xh())),e=ce.a1(a,d,c),f=ce.a5(a,d,e);if(f.length>1){for(var g=new Je,h=0;h<f.length;h++){var i=f[h],j=null;if(1===i.ay()){var k=i.c2();1===k.a2().ad()?j=k.a2():1===k.a3().ad()&&(j=k.a3())}else{for(var l=i.c1();l.i1();l.i2()){var m=l.i8();if(c.i4(m.a2()))if(null==j)j=m.a2();else if(j!==m.a2()){j=null;break}if(c.i4(m.a3()))if(null!=j){if(j!==m.a3()){j=null;break}}else j=m.a3()}if(null!=j){var n=i.c2();j=n.a2()!==j?n.a2():n.a3()}}null!=j&&g.aa(j)}for(var o,p=g.x4();!g.ar();p=o)o=g.x4(),b.ac(a.xo(p,o))}return b};var de=function(){this._c=0,this._d=0,this._e=0,this._b=!0,this._f=!1};Hb.ext(de,Object,{a6:function(a){this._f=a},a7:function(a){this._b=a},a8:function(a){0!==a.x0()&&this.a9(a,a.x9().i9())},a9:function(a,b){if(this._xx=a.xk(),this._c=a.xl(),this._d=0,this._e=0,this.a0(b),this._b)for(var c=a.x9();c.i1();c.i2()){var d=c.i9();null==this._xx.i1(d)&&(this.a1(d),this.a0(d))}a.xi(this._xx),a.xj(this._c)},a0:function(a){var b=++this._d;this._xx.z1(a,de._B),this.a5(a,b);for(var c=this._f?a.ap():a.af();c.i1();c.i2()){var d=c.i8();if(!this._c.i4(d)){this._c.i7(d,!0);var e=d.a1(a);null==this._xx.i1(e)?(this.a3(d,e,!0),this.a0(e),this.a2(d,e)):this.a3(d,e,!1)}}this.a4(a,b,++this._e),this._xx.z1(a,de._C)},a5:function(a,b){},a4:function(a,b,c){},a3:function(a,b,c){},a2:function(a,b){},a1:function(a){}}),de._B={},de._C={};var ee=function(a){this._a=a};Hb.ext(ee,de,{a5:function(a,b){var c=this._a._ah.i2(a);this._a._ad[c].ae(a)}});var fe=function(a){this._a=a};Hb.ext(fe,de,{a2:function(a,b){var c=a.a1(b),d=this._a[c.al()],e=this._a[b.al()];e._a+1>d._a?(d._c=d._a,d._b=d._d,d._a=e._a+1,d._d=a):e._a+1>d._c&&(d._c=e._a+1,d._b=a)}});var ge=function(a){this._a=a};Hb.ext(ge,de,{a3:function(a,b,c){c&&a.a2()===b&&this._a.ac(a)}});var he=function(){this._a=0,this._c=0};Hb.ext(he,Object,{});var ie=function(){this._a=0};Hb.ext(ie,Object,{a1:function(a,b){this._a=0;for(var c=b.length-1;c>=0;c--)b[c]=-1;for(var d=a.x9();d.i1();d.i2()){var e=d.i9();if(0===e.ak()){this.a2(e,e.al(),b);break}}for(var f=a.x9();f.i1();f.i2()){var g=f.i9(),h=g.al();-1===b[h]&&this.a2(g,h,b)}},a2:function(a,b,c){c[b]=-2;for(var d=a.ag();null!=d;){var e=d.a3(),f=e.al();switch(c[f]){case-1:this.a2(e,f,c);case-2:default:d=d.a8()}}c[b]=this._a++}});var je={};je.a1=function(a){var b=new ke;return b.a8(a),b._n},je.a2=function(a){var b=a.x9(),c=null,d=0;for(b.i4();b.i1();b.i2())0===b.i9().ak()&&(c=b.i9(),d++);if(1===d)return c;for(d=0,b.i4();b.i1();b.i2())0===b.i9().ao()&&(c=b.i9(),d++);return 1===d?c:je.a8(a)},je.a8=function(a){var b=Hf.a(a.x0()),c=Ne.a2(b);return je.a6(a,c)},je.a6=function(a,b){var c=a.xd(),d=Hf.d(1),e=Hf.a(a.x0(),-1),f=je.a4(a,c);je.a7(c,b,d,e,-1);for(var g=f.c1();g.i1();g.i2())a.x3(g.i8());return d[0]},je.a7=function(a,b,c,d,e){for(var f=0,g=a.ag();null!=g;g=g.a8()){var h=g.a3(),i=je.a7(h,b,c,d,e);i>e&&(e=i),f+=d[h.al()]}for(var j=f*(a._g.xa()-1-f),k=a.ag();null!=k;k=k.a8())for(var l=k.a3(),m=k.a8();null!=m;m=m.a8()){var n=m.a3();j+=d[l.al()]*d[n.al()]}return b.i7(a,j),d[a.al()]=f+1,j>e&&(e=j,c[0]=a),e},je.a4=function(a,b){var c=new re,d=new ge(c);d.a6(!1),d.a9(a,b);for(var e=c.c1();e.i1();e.i2())a.x3(e.i8());return c},je.a3=function(a){return je.a4(a,je.a2(a))};var ke=function(){this._n=!0,this.a6(!1)};Hb.ext(ke,de,{a3:function(a,b,c){c||(this._n=!1)},a1:function(a){this._n=!1}});var le=function(a,b){this._i=0,this._m=b,this._j=a,this._l=!1};Hb.ext(le,de,{a8:function(a){this._h=Hf.a(a.x0()),this._k=Hf.a(a.x0()),this._g=new we(a.xh()),le.superClass.a8.call(this,a)},a5:function(a,b){this._k[a.al()]=this._h[a.al()]=b},a3:function(a,b,c){if(this._g.c(a),!c){var d=a.a1(b);this._h[d.al()]=Math.min(this._h[d.al()],this._k[b.al()])}},a1:function(a){this._l=!1},a2:function(a,b){var c=a.a1(b);if(this._h[b.al()]>=this._k[c.al()]){for(;this._g.d()!==a;this._j.i5(this._g.b(),this._i));this._j.i5(this._g.b(),this._i),this._i++,this._g.a()?this._l?this._m.i5(c,!0):this._l=!0:this._m.i5(c,!0)}this._h[c.al()]=Math.min(this._h[c.al()],this._h[b.al()])}});var me=function(a,b){this._h=!1,this._i=a,this._g=b};Hb.ext(me,Object,{z1:function(a,b){a._c[this._i]=b},i1:function(a){return a._c[this._i]},i5:function(a,b){a._c[this._i]=b},i4:function(a){return a._c[this._i]},i7:function(a,b){a._c[this._i]=b},i2:function(a){var b=a._c[this._i];return null==b?0:b},i6:function(a,b){a._c[this._i]=b},i3:function(a){var b=a._c[this._i];return null==b?0:b},c:function(){return this._h},d:function(){this._h=!0}});var ne=function(a,b){this._c=!1,this._d=a,this._b=b};Hb.ext(ne,Object,{i8:function(a,b){a._c[this._d]=b},i1:function(a){return a._c[this._d]},i7:function(a,b){a._c[this._d]=b},i4:function(a){var b=a._c[this._d];return null==b?!1:b},i5:function(a,b){a._c[this._d]=b},i2:function(a){var b=a._c[this._d];return null==b?0:b},i6:function(a,b){a._c[this._d]=b},i3:function(a){var b=a._c[this._d];return null==b?0:b},a:function(){return this._c},b:function(){this._c=!0}});var oe=function(a){this._bb=a,this.i4()};Hb.ext(oe,Object,{i1:function(){return null!=this._aa},i2:function(){this._aa=this._aa._a},i3:function(){this._aa=this._aa._b},i4:function(){this._aa=this._bb._b},i5:function(){this._aa=this._bb._c},i7:function(){return this._bb.ay()},i6:function(){return this._aa._c}});var pe=function(a){pe.superClass.constructor.call(this,a)};Hb.ext(pe,oe,{i8:function(){return this.i6()}});var qe=function(a){if(this._id=Hb.id(),this._a=0,a)for(a.i4();a.i1();a.i2())this.ae(a.i6())};Hb.ext(qe,Object,{ac:function(a){var b=this.ag(a);return null==this._b?this._b=this._c=b:(this._b._b=b,b._a=this._b,this._b=b),this._a++,b},ae:function(a){var b=this.ag(a);return null==this._c?this._b=this._c=b:(this._c._a=b,b._b=this._c,this._c=b),this._a++,b},z1:function(a){a._b=null,a._a=null,null==this._c?this._b=this._c=a:(this._c._a=a,a._b=this._c,this._c=a),this._a++},ad:function(a){a._b=null,a._a=null,null==this._b?this._b=this._c=a:(this._b._b=a,a._a=this._b,this._b=a),this._a++},aa:function(a){return this.ae(a),!0},ab:function(a){for(;a.i1();a.i2())this.ae(a.i6())},ao:function(a,b){if(b===this._b)return this.ac(a);if(null==b)return this.ae(a);var c=this.ag(a);return this.aq(c,b),c},aq:function(a,b){if(null==b)this.ad(a);else if(b===this._b)this.ad(a);else{if(null==this._c)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._b;b._b=a,a._a=b,c._a=a,a._b=c}this._a++}},ap:function(a,b){if(null==b)this.z1(a);else if(b===this._c)this.z1(a);else{if(null==this._b)a._b=null,a._a=null,this._b=this._c=a;else{var c=b._a;b._a=a,a._a=c,c._b=a,a._b=b}this._a++}},an:function(a,b){if(b===this._c)return this.ae(a);if(null==b)return this.ac(a);var c=this.ag(a);return this.ap(c,b),c},ay:function(){return this._a},ar:function(){return 0===this._a},af:function(){this._b=this._c=null,this._a=0},am:function(){return this._b._c},at:function(){var a=this.am();return this.aw(this._b),a},as:function(){return this._c._c},au:function(){return this.aw(this._c)},ak:function(a){for(var b=0,c=this._b;null!=c;){if(a===b)return c._c;c=c._a,b++}return null},aj:function(a){return null==a._a?this._b:a._a},ai:function(a){return null==a._b?this._c:a._b},aw:function(a){return a!==this._b?a._b._a=a._a:this._b=a._a,a!==this._c?a._a._b=a._b:this._c=a._b,this._a--,a._c},av:function(a){return this.aw(a._aa)},ah:function(){return new oe(this)},al:function(a){for(var b=this._b;null!=b;){if(null==b._c&&null==a)return b;if(b._c===a)return b;b=b._a}return null},a0:function(){for(var a=Hf.d(this._a),b=0,c=this._b;null!=c;)a[b]=c._c,c=c._a,b++;return a},ax:function(){for(var a=this._b;null!=a;a=a._b){var b=a._a;a._a=a._b,a._b=b}var c=this._b;this._b=this._c,this._c=c},a1:function(a){var b=this.a0();b.sort(a);for(var c=0,d=this._b;null!=d;)d._c=b[c],d=d._a,c++},a2:function(){var a=this.a0();a.sort(Hf.c);for(var b=0,c=this._b;null!=c;)c._c=a[b],c=c._a,b++},az:function(a){null==this._b?(this._b=a._b,this._c=a._c):null!=a._b&&(this._c._a=a._b,a._b._b=this._c,this._c=a._c),this._a+=a._a,a._b=a._c=null,a._a=0},ag:function(a){return new ue(a)}});var re=function(a){re.superClass.constructor.call(this,a)};Hb.ext(re,qe,{c1:function(){return new pe(this)},c2:function(){return this.am()},c3:function(){return this.at()}});var se=function(){this._c=0};Hb.ext(se,Object,{a:function(a){this._c++,a._b=this._b,a._a=null,null!=this._b?(this._b._a=a,this._b=a):this._b=this._a=a},b:function(a,b){if(null==b)return void this.a(a);var c=b._b;null!=c?c._a=a:this._a=a,a._b=c,a._a=b,b._b=a,this._c++},c:function(a){var b=a._a,c=a._b;this._c--,null!=b?b._b=c:this._b=c,null!=c?c._a=b:this._a=b}});var te=function(a,b){this._p=a,this._j=b,this._o=a._o[b]};Hb.ext(te,Object,{i1:function(){return null!=this._o},i2:function(){this._o=this._o._k[this._j]},i3:function(){this._o=this._o._f[this._j]},i4:function(){this._o=this._p._o[this._j]},i5:function(){this._o=this._p._q[this._j]},i7:function(){return this._p._n[this._j]},i6:function(){return this._o},i8:function(){return this._o}});var ue=function(a){this._c=a};Hb.ext(ue,Object,{a:function(){return this._a},b:function(){return this._b},c:function(a){this._c=a},d:function(){return this._c}});var ve=function(a,b,c,d){this._r=a,this._s=b,this._q=c,this._p=d};Hb.ext(ve,Object,{i1:function(a){return this._p[a.a5()]},i3:function(a){return this._r[a.a5()]},i2:function(a){return this._s[a.a5()]},i4:function(a){return this._q[a.a5()]},i8:function(a,b){this._p[a.a5()]=b},i6:function(a,b){this._r[a.a5()]=b},i5:function(a,b){this._s[a.a5()]=b},i7:function(a,b){this._q[a.a5()]=b}});var we=function(a){this._a=Hf.d(a),this._b=-1};Hb.ext(we,Object,{d:function(){return this._a[this._b]},b:function(){return this._a[this._b--]},c:function(a){this._a[++this._b]=a},a:function(){return this._b<0}});var xe=function(){};Hb.ext(xe,Object,{a0:function(a){this._c=Hf.d(a)}});var ye=function(a,b,c,d,e,f,g){this._g=0,a.xt(this,b,c,d,e,f,g)};Hb.ext(ye,xe,{a5:function(){return this._h._u&&this._h.b1(),this._g},a2:function(){return this._d},a3:function(){return this._e},a1:function(a){return this._d!==a?this._d:this._e},a4:function(){for(var a=0;1>=a;a++)this._k[a]=null,this._f[a]=null},a8:function(){return this._k[0]},a7:function(){return this._k[1]},a6:function(a,b,c,d){this.a0(d),this._h=a,this._k=Hf.d(2),this._f=Hf.d(2),this._d=b,this._e=c}});var ze=function(a){this._j=0,this._h=a,this.i4()};Hb.ext(ze,Object,{i2:function(){this._k=this._k._k[this._j],null==this._k&&0===this._j&&(this._k=this._h._o[1],this._j=1)},i3:function(){this._k=this._k._f[this._j],null==this._k&&1===this._j&&(this._k=this._h._q[0],this._j=0)},i4:function(){this._k=this._h._o[0],null==this._k?(this._k=this._h._o[1],this._j=1):this._j=0},i5:function(){this._k=this._h._q[1],null==this._k?(this._k=this._h._q[0],this._j=0):this._j=1},i1:function(){return null!=this._k},i6:function(){return this._k},i8:function(){return this._k},i7:function(){return this._h.ad()}});var Ae=function(){this._a=ff._A,this._b=ff._A,this._c=new md};Hb.ext(Ae,Object,{i1:function(){return this._c.size()},i2:function(a){return this._c.get(a)},i3:function(a,b,c){this._c.set(a,new Sd(b,c))},i4:function(a,b){this._c.add(new Sd(a,b))},i5:function(){this._c.clear()},i6:function(){return this._a},i7:function(){return this._b},i8:function(a){this._a=a},i9:function(a){this._b=a}});var Be=function(){this._x=0,this._y=0,this._w=0,this._h=0};Hb.ext(Be,Object,{i5:function(a,b){this._x=a,this._y=b},i6:function(a,b){this._w=a,this._h=b},i4:function(){return this._h},i3:function(){return this._w},i1:function(){return this._x},i2:function(){return this._y}});var Ce=function(a,b,c,d){this._m=a,this._n=b,this._l=c,this._k=d};Hb.ext(Ce,Object,{i1:function(a){return this._k[a.al()]},i3:function(a){return this._m[a.al()]},i2:function(a){return this._n[a.al()]},i4:function(a){return this._l[a.al()]},z1:function(a,b){this._k[a.al()]=b},i6:function(a,b){this._m[a.al()]=b},i7:function(a,b){this._n[a.al()]=b},i5:function(a,b){this._l[a.al()]=b}});var De=function(a,b){this._b=a,this._r=b,this._a=[];for(var c=this._b-1;c>=0;c--)this._a.push(c);this._c=new md};Hb.ext(De,Object,{a1:function(a){var b;if(0===this._a.length){this.a2(a,this._b,this._b+this._r);for(var c=this._b+this._r-1;c>this._b;c--)this._a.push(c);b=this._b,this._b+=this._r}else b=this._a.pop();return b},b:function(a){var b=this.a1(a),c=new me(b,this);return this._c.add(c),this.a4(a,b),c},c:function(a){var b=this.a1(a),c=new ne(b,this);return this._c.add(c),this.a4(a,b),c},a2:function(a,b,c){for(var d=a._a;null!=d;d=d._a){var e=Hf.d(c);Hf.f(d._c,e,b),d._c=e}},a3:function(a,b,c){var d=Hf.d(c);Hf.f(a._c,d,b),a._c=d},a4:function(a,b){for(var c=a._a;null!=c;c=c._a)c._c[b]=null},a5:function(a,b){if(a instanceof me){var c=a;if(c.c())throw"Error";c.d();var d=a._i;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}},a6:function(a,b){if(a instanceof ne){var c=a;if(c.a())throw"Error";c.b();var d=c._d;this._a.indexOf(d)<0&&(this.a4(b,d),this._a.push(d),this._c.remove(a))}}});var Ee=function(a){this._id=Hb.id(),this._p=0,a.xs(this)};Hb.ext(Ee,xe,{ad:function(){return this._n[0]+this._n[1]},ak:function(){return this._n[1]},ao:function(){return this._n[0]},al:function(){return this._g._y&&this._g.c(),this._p},ag:function(){return this._o[0]},ae:function(){return this._o[1]},af:function(){return new ze(this)},am:function(){return new te(this,1)},ap:function(){return new te(this,0)},an:function(){return new Ge(this)},aq:function(){return new Fe(this,1)},aw:function(){return new Fe(this,0)},ah:function(a){for(var b=this._o[0];null!=b;b=b._k[0])if(b.a3()===a)return b;return null},ai:function(a){for(var b=this._o[1];null!=b;b=b._k[1])if(b.a2()===a)return b;return null},aj:function(a){var b=this.ah(a);return null==b&&(b=this.ai(a)),b},au:function(a){this.at(a,1,Hf.d(this.ak()))},av:function(a){this.at(a,0,Hf.d(this.ao()))},as:function(a,b){this.a0(b),this._g=a,this._o=Hf.d(2),this._q=Hf.d(2),this._n=Hf.a(2)},ab:function(a,b,c,d,e){if(null==b)return void this.aa(a,c,d);var f;if(f=b._d===b._e?d:this!==b._d?1:0,0===e){var g=b._k[f];a._f[d]=b,a._k[d]=g,b._k[f]=a,null==g?this._q[c]=a:g._d===g._e?g._f[d]=a:g._f[this!==g._d?1:0]=a;

}else{var h=b._f[f];a._k[d]=b,a._f[d]=h,b._f[f]=a,null==h?this._o[c]=a:h._d===h._e?h._k[d]=a:h._k[this!==h._d?1:0]=a}this._n[c]++},aa:function(a,b,c){var d=this._q[b];a._k[c]=null,null==d?(this._o[b]=a,a._f[c]=null):(a._f[c]=d,d._d===d._e?d._k[c]=a:d._k[this!==d._d?1:0]=a),this._q[b]=a,this._n[b]++},ar:function(a,b,c){var d,e;d=a._k[c],e=a._f[c],null==d?this._q[b]=e:d._f[d._d!==this?1:0]=e,null==e?this._o[b]=d:e._k[e._d!==this?1:0]=d,this._n[b]--},ac:function(){for(var a=0;1>=a;a++)this._o[a]=null,this._q[a]=null,this._n[a]=0},at:function(a,b,c){if(!(this._n[b]<2)){var d,e=this._n[b],f=0;for(d=this._o[b];null!=d;d=d._k[b])c[f]=d,f++;Hf.s(c,e,a);var g=this._o[b]=c[0];g._f[b]=null;for(var h=1;e>h;)d=c[h],d._f[b]=g,g._k[b]=d,h++,g=d;this._q[b]=d,d._k[b]=null}}});var Fe=function(a,b){Fe.superClass.constructor.call(this,a,b),this._h=1!==b?1:0};Hb.ext(Fe,te,{i6:function(){return this.i9()},i9:function(){return 0!==this._h?this._o._e:this._o._d}});var Ge=function(a){Ge.superClass.constructor.call(this,a)};Hb.ext(Ge,ze,{i6:function(){return this._k.a1(this._h)},i9:function(){return this._k.a1(this._h)}});var He=function(a){He.superClass.constructor.call(this,a)};Hb.ext(He,oe,{i9:function(){return this.i6()}});var Ie=function(a){this._o=a,this._c=a._a};Hb.ext(Ie,Object,{i1:function(){return null!=this._c},i2:function(){this._c=this._c._a},i3:function(){this._c=this._c._b},i5:function(){this._c=this._o._b},i4:function(){this._c=this._o._a},i7:function(){return this._o._c},i6:function(){return this._c},i9:function(){return this._c},i8:function(){return this._c}});var Je=function(a){if(a&&a.length){Je.superClass.constructor.call(this);for(var b=0;b<a.length;b++)this.ae(a[b])}else Je.superClass.constructor.call(this,a)};Hb.ext(Je,qe,{x1:function(){return new He(this)},x2:function(){return this.am()},x3:function(){return this.as()},x4:function(){return this.at()}});var Ke=function(a){this._d=a,Ke.superClass.constructor.call(this)};Hb.ext(Ke,Je,{});var Le=function(a){this._a=a,this._b=new re,this._c=new Je};Hb.ext(Le,Object,{a:function(){for(var a=this._a.x9();a.i1();a.i2())this.e(a.i9())},b:function(){this.c(),this.d()},c:function(){for(;!this._c.ar();){var a=this._c.x4();this._a.xq(a)||this.g(a)}},d:function(){for(;!this._b.ar();){var a=this._b.c3();this._a.xp(a)||this.f(a)}},e:function(a){for(var b=a.af();b.i1();b.i2())this._b.ac(b.i8()),this._a.h1(b.i8());this._c.ac(a),this._a.h2(a)},f:function(a){this._a.u1(a)},g:function(a){this._a.h3(a)}}),Le.h=function(a,b){for(b.i4();b.i1();b.i2()){var c=b.i8();a.xq(c.a2())||a.h3(c.a2()),a.xq(c.a3())||a.h3(c.a3()),a.xp(c)||a.u1(c)}},Le.i=function(a,b){for(b.i4();b.i1();b.i2()){var c=b.i8();a.xp(c)&&a.h1(c),0===c.a2().ad()&&a.h2(c.a2()),0===c.a3().ad()&&a.h2(c.a3())}};var Me=function(){this._g=arguments[0],this._f=this._g.xk(),this._h=this._g.xk(),this._d=new qe,this._e=0,1!==arguments.length&&this.a(arguments[1],arguments[2],arguments[3],arguments[4])};Hb.ext(Me,Object,{a:function(a,b,c,d){for(var e=Hf.d(c-b+1),f=b;c>=f;f++)e[f]=new Ke(f);for(var g=this._g.x9();g.i1();g.i2()){var h=g.i9();(null==d||d.i4(h))&&(this._f.z1(h,e[a.i2(h)-b].ac(h)),this._e++)}for(var i=0;i<e.length;i++)for(var j=e[i],k=this._d.ae(j),l=j.x1();l.i1();l.i2())this._h.z1(l.i9(),k)},c:function(){this._g.xi(this._h),this._g.xi(this._f)},e:function(){return 0===this._e},g:function(){for(;this._d.am().ar();this._d.at());this._e--;var a=this._d.am().x4();return this._h.z1(a,null),this._f.z1(a,null),a},f:function(){for(;this._d.as().ar();this._d.au());this._e--;var a=this._d.as().x4();return this._h.z1(a,null),this._f.z1(a,null),a},d:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.a();null!=f?(e=f.d(),this._h.z1(a,f)):(e=new Ke(d._d+1),this._h.z1(a,this._d.ae(e))),d.aw(b),this._f.z1(a,e.ac(a))},b:function(a){var b=this._f.i1(a),c=this._h.i1(a),d=c.d(),e=null,f=c.b();null!=f?(e=f.d(),this._h.z1(a,f)):(e=new Ke(d._d-1),this._h.z1(a,this._d.ac(e))),d.aw(b),this._f.z1(a,e.ac(a))}});var Ne={};Ne.a1=function(a){return new Ce(a,null,null,null)},Ne.a2=function(a){return new Ce(null,a,null,null)},Ne.a3=function(a){return new Ce(null,null,a,null)},Ne.a4=function(a){return new ve(null,a,null,null)},Ne.a5=function(a){return new ve(null,null,a,null)},Ne.a6=function(a){return new ve(null,null,null,a)};var Oe=function(){if(2===arguments.length){this._a=new qe,this._b=new qe,this._c=0;var a=arguments[0],b=arguments[1],c=new Pe(a._j2.gj(b)/2,0);this._a.ac(c),c=new Pe(a._j2.gj(b)/2,0),this._b.ac(c)}else this._a=arguments[1],this._b=arguments[2],this._c=arguments[3]};Hb.ext(Oe,Object,{});var Pe=function(a,b){this._b=a,this._a=b};Hb.ext(Pe,Object,{});var Qe=function(){this._cx=!0,this._cs=new af,this._ct=new $e,this._cw=new _e};Hb.ext(Qe,Object,{i5:function(a){this._cx=a},k:function(){var a=new bf(this);return this._cx&&(this._cs.w1(a),a=this._cs),this._cw.w1(a),a=this._cw,this._ct.w1(a),a=this._ct},i2:function(a){this.k().i2(a)},i1:function(a){return this.k().i1(a)}});var Re=function(){Re.superClass.constructor.call(this),this._jv=20,this._jw=40,this._jx=function(a,b){var c=a.a3(),d=b.a3(),e=c._g;return Math.floor(100*(e.g5(c)-e.g5(d)))}};Hb.ext(Re,Qe,{i4:function(a){return je.a1(a)},i3:function(a){if(!this.i4(a))throw"Error";var b=je.a3(a);if(this._j2=a,this._j3=new Se(a),of.c(a),this._jy=a.xk(),!a.xb()){this.bu();var c=this._j3.c1();this.f(c),this.b(this._j3),this.c(this._j3)}for(var d;!b.ar();a.x3(d))d=b.c3(),of.b(a.g2(d))},bu:function(){if(null!=this._jx)for(var a=this._j2.x9();a.i1();a.i2())a.i9().av(this._jx)},c:function(a){for(var b=this.a2(a),c=Hf.a(b.length),d=0;d<b.length;d++){for(var e=b[d],f=0,g=e.ah();g.i1();g.i2()){var h=g.i6();f=Math.max(f,this._j2.g9(h))}c[d]=f}for(var i=-this._jw,j=0;j<b.length;j++){i+=this._jw+c[j];for(var k=b[j],l=k.ah();l.i1();l.i2()){var m=l.i6();this._j2.s2(m,this._j2.g5(m),i-c[j]/2)}}},a2:function(a){for(var b=Hf.d(a.b()),c=0,d=a.b();d>c;c++)b[c]=new qe;return a.c1(),this.a1(a.c1(),0,b),b},a1:function(a,b,c){c[b].ae(a);for(var d=a.aw();d.i1();d.i2())this.a1(d.i9(),b+1,c)},b:function(a){var b=a.c1();this._j2.s2(b,0,this._j2.g6(b)),this.g(b)},g:function(a){for(var b=a.aw();b.i1();b.i2()){var c=b.i9(),d=this._jy.i1(c);this._j2.s2(c,this._j2.g5(a)+d._c,this._j2.g6(c)),this.g(c)}},f:function(a){if(this._j3.c2(a))return void this._jy.z1(a,new Oe(this,a));var b=a.aw(),c=b.i9();b.i2(),this.f(c);var d=this._jy.i1(c),e=new Oe(this,d._a,d._b,0);if(!b.i1())return e._a.ac(new Pe(this._j2.gj(a)/2,0)),e._b.ac(new Pe(this._j2.gj(a)/2,0)),void this._jy.z1(a,e);for(;b.i1();){c=b.i9(),b.i2(),this.f(c),d=this._jy.i1(c);for(var f=e._b.ah(),g=d._a.ah(),h=2147483647,i=0,j=0;f.i1()&&g.i1();){var k=f.i6();f.i2();var l=g.i6();g.i2(),j+=k._a,i+=l._a,h=Math.min(h,i-j-k._b-l._b)}d._c=this._jv-h,i+=d._c;var m=d._b.am();if(m._a=d._c,f.i1()&&!g.i1())for(var n=j-this.a3(d._b);f.i1();n=0){var o=f.i6();f.i2(),d._b.ae(new Pe(o._b,o._a+n))}else if(!f.i1()&&g.i1()){var p=this.a3(e._a);for(p=i-p;g.i1();p=0){var q=g.i6();g.i2(),e._a.ae(new Pe(q._b,q._a+p))}}e._b=d._b}this._jy.z1(a,e);for(var r=-d._c/2,s=a.aw();s.i1();){var t=s.i9();s.i2();var u=this._jy.i1(t);u._c+=r;var v=u._b.am();v._a+=r,v=u._a.am(),v._a+=r}e._a.ac(new Pe(this._j2.gj(a)/2,0)),e._b.ac(new Pe(this._j2.gj(a)/2,0))},a3:function(a){for(var b=0,c=a.ah();c.i1();c.i2()){var d=c.i6();b+=d._a}return b}});var Se=function(a){this._b=a,this.a()};Hb.ext(Se,Object,{c1:function(){return null==this._a&&this.a(),this._a},b:function(){return null==this._a?-1:this.d(this._a)},d:function(a){for(var b=0,c=a.aw();c.i1();c.i2())b=Math.max(b,this.d(c.i9()));return b+1},c2:function(a){return 0===a.ao()},a:function(){for(var a=this._b.x9();a.i1();a.i2())if(0===a.i9().ak())return void(this._a=a.i9())}});var Te=function(a){this._d=0,this._e=0,this._f=0,this._a=0,this._b=0,this._g=a,this._c=new qe};Hb.ext(Te,Object,{a:function(){return this._d+this._e+this._f}});var Ue=function(){Ue.superClass.constructor.call(this),this._kl=340,this._km=360,this._kk=40,this._ko=.5};Hb.ext(Ue,Qe,{ic:function(){return this._km},ia:function(){return this._kl},i9:function(){return this._ko},i3:function(a){if(!je.a1(a))throw"Error";this._a=a;var b=this.i8(),c=je.a4(a,b);of.c(a),this._kn=Hf.d(a.x0());for(var d=a.x9();d.i1();d.i2()){var e=d.i9();e!==b?this.aa(e,new Te(this._kk+this.q(e.aq().i9()))):this.aa(e,new Te(this._kk))}this.s(b),a.s2(b,0,0),this.t(b);for(var f;!c.ar();a.x3(f))f=c.c3()},i4:function(a){return je.a1(a)},i0:function(a){return this._kn[a.al()]},i8:function(){return je.a2(this._a)},i7:function(a){for(var b,c=this.ib(a);;){if(b=this.i6(a),c>=b)break;for(var d=a.aw();d.i1();d.i2()){var e=d.i9();this.i0(e)._g*=1+this._ko}}var f=(c-b)/(2*a.ao());b=0;for(var g=a.aw();g.i1();g.i2()){var h=this.i0(g.i9());h._d+=f,h._e+=f,b+=h._d+h._e}this.id(a)},id:function(a){for(var b=Hf.d(a.ao()),c=0,d=a.ap();d.i1();)b[c]=d.i8(),d.i2(),c++;var e=this;b.sort(function(a,b){var c=a.a3(),d=b.a3(),f=e.i0(c).a()-e.i0(d).a();return f>0?1:f>=0?0:-1});for(var f=0;f<b.length;f++)this._a.h1(b[f]);for(var g=0;g<b.length;g+=2)this._a.u1(b[g]);for(c=b.length-1,c%2===0&&c--;c>0;c-=2)this._a.u1(b[c])},ib:function(a){return 0===a.ak()?this._km:2===a.ao()?Math.min(180,this._kl):this._kl},i6:function(a){for(var b=0,c=a.ap();c.i1();c.i2()){for(var d,e=c.i8(),f=e.a3(),g=this.i0(f),h=-g._g,i=g._b,j=g._c,k=0,l=k+1,m=j._b,n=m.d();l>k;l=(d.y-i)/(d.x-h))d=n,m=j.ai(m),n=m.d(),k=(n.y-d.y)/(n.x-d.x);for(g._d=180*-Math.atan(l)/Math.PI,k=0,l=k-1,m=j._b,n=m.d();m.a().d().x===n.x;n=m.d())m=m.a();for(var o;k>l;l=(o.y-i)/(o.x-h))o=n,m=j.aj(m),n=m.d(),k=(n.y-o.y)/(n.x-o.x);g._e=180*Math.atan(l)/Math.PI,b+=g._d+g._e}return b},aa:function(a,b){this._kn[a.al()]=b},p:function(a){var b=this.i0(a),c=new qe,d=2*this.q(a);c.aa(new Sd(0,0)),c.aa(new Sd(0,d)),c.aa(new Sd(d,d)),c.aa(new Sd(d,0)),b._c=c,b._a=d/2,b._b=d/2},r:function(a){if(0===a.ao())this.p(a);else{var b=this.i0(a),c=this.q(a),d=new qe;d.aa(new Sd(-c,-c)),d.aa(new Sd(-c,c)),d.aa(new Sd(c,-c)),d.aa(new Sd(c,c));for(var e=a.aw();e.i1();e.i2()){var f=this.i0(e.i9());d.az(f._c)}for(var g=ff.h(d),h=Number.MAX_VALUE,i=Number.MAX_VALUE,j=Number.MIN_VALUE,k=Number.MIN_VALUE,l=g.ah();l.i1();l.i2()){var m=l.i6();m.x<h&&(h=m.x),m.x>j&&(j=m.x),m.y<i&&(i=m.y),m.y>k&&(k=m.y)}for(var n=new qe,o=g.ah();o.i1();o.i2()){var p=o.i6();n.aa(new Sd(p.x-h,p.y-i))}b._c=n,b._a=-h,b._b=-i}},s:function(a){if(0===a.ao())this.r(a);else{for(var b=a.aw();b.i1();b.i2())this.s(b.i9());this.i7(a);for(var c=0,d=a.aw();d.i1();d.i2()){var e=d.i9(),f=this.i0(e),g=180-(360-this.ib(a))/2-c-(f._e+f._f);c+=f.a(),g=g/180*Math.PI;for(var h=Math.sin(g),i=Math.cos(g),j=f._c._b;null!=j;j=j.a()){var k=j.d(),l=k.x+f._g,m=k.y-f._b,n=new Sd(l*i-h*m,l*h+i*m);j.c(n)}var o=f._a+f._g;f._a=o*i,f._b=o*h}this.r(a)}},t:function(a){var b=this._a.g4(a),c=0;if(a.ak()>0){var d=a.aq().i9(),e=this._a.g4(d);c=Math.PI+Math.atan2(e.y-b.y,e.x-b.x)}for(var f=a.aw();f.i1();f.i2()){var g=f.i9(),h=this.i0(g);if(0!==c){var i=Math.cos(c),j=Math.sin(c),k=h._a*i-j*h._b,l=h._a*j+i*h._b;h._a=k,h._b=l}this._a.s2(g,b.x+h._a,b.y+h._b),this.t(g)}},q:function(a){return 1.41*(Math.max(this._a.gj(a),this._a.g9(a))/2)}});var Ve=function(){};Hb.ext(Ve,Object,{i2:function(a){return a.ad()},i1:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var We=function(a){this._a=a};Hb.ext(We,Object,{i2:function(a){for(var b=0,c=a.an();c.i1();c.i2())null!=this._a.i1(c.i9())&&b++;return b},i4:function(a){return null==this._a.i1(a)},i1:function(a){throw"Error"},i3:function(a){throw"Error"}});var Xe=function(){Xe.superClass.constructor.call(this),this._kq=!1,this._kp=90};Hb.ext(Xe,Ue,{a:function(a,b){this._kr=b,this._ks=a,this._kq=!0},i7:function(a){if(!this.u(a))return void Xe.superClass.i7.call(this,a);for(var b=this.i9(),c=this.ib(a),d=(360-c)/2+c,e=new re(a.ap());;){var f=this.i6(a);f=(360-c)/2;for(var g=null,h=null,i=e._b;null!=i;i=i.a()){var j=i.d(),k=j.a3(),l=this.i0(k),m=this._ks.i3(j),n=m-(f+l._e);if(n>=0&&m+l._d>=d&&(n=f+l.a()<=d?d-f-l.a():2*(d-(m+l._d))),l._f=0,n>=0)l._f=n,g=i,h=l;else{for(-n>l._d+l._e?n=(l._d+l._e)/2:n/=-2,f-=n,d>=f&&f+l.a()>d&&(f+=n,n=f+l.a()-d,f-=n);null!=g&&n>h._f;h=this.i0(g.d().a3()))if(n-=h._f,h._f=0,g=g.b(),null==g){h=null;break}null!=g?h._f-=n:f+=n}f+=l.a()}if(d>=f){for(var o=0,p=(360-c)/2,q=a.ap();q.i1();q.i2()){var r=q.i8(),s=r.a3(),t=this._ks.i3(r),u=this.i0(s),v=p+u._f+u._e;o<Math.abs(v-t)&&(o=Math.abs(v-t)),p+=u.a()}if(o<=this._kp)break}for(var w=a.aw();w.i1();w.i2()){var x=w.i9();this.i0(x)._g*=1+b}}},ib:function(a){return this.u(a)?0===a.ak()?this.ic():this.ia():Xe.superClass.ib.call(this,a)},u:function(a){return this._kq&&0!==a.ao()?null!=this._ks.i1(a.ag()):!1}});var Ye=function(a){this._a=a};Hb.ext(Ye,Object,{i1:function(a){return this._a.i1(a)},i2:function(a){throw"Error"},i3:function(a){throw"Error"},i4:function(a){throw"Error"}});var Ze=function(){};Hb.ext(Ze,Object,{w1:function(a){this._bb=a},w2:function(){return this._bb},w4:function(a){null!=this._bb&&this._bb.i2(a)},w3:function(a){return null!=this._bb?this._bb.i1(a):!0}});var $e=function(){this._cg=45,this._ce=400,this._ch=400,this._cf=0};Hb.ext($e,Ze,{i1:function(a){if(null!=this.w2()){for(var b=!0,c=a.xk(),d=ce.a3(a,c),e=Hf.d(d),f=Hf.d(d),g=0;d>g;g++)e[g]=new Je,f[g]=new re;for(var h=a.xf();h.i1();h.i2()){var i=h.i8();f[c.i2(i.a2())].aa(i),a.h1(i)}for(var j=a.x9();j.i1();j.i2()){var k=j.i9();e[c.i2(k)].aa(k),a.h2(j.i9())}for(var l=0;d>l;l++){for(var m=e[l].x1();m.i1();m.i2())a.h3(m.i9());for(var n=f[l].c1();n.i1();n.i2())a.u1(n.i8());b=this.w3(a);for(var o=f[l].c1();o.i1();o.i2())a.h1(o.i8());for(var p=e[l].x1();p.i1();p.i2())a.h2(p.i9());if(!b)break}for(var q=0;d>q;q++)for(var r=e[q].x1();r.i1();r.i2())a.h3(r.i9());for(var s=0;d>s;s++)for(var t=f[s].c1();t.i1();t.i2())a.u1(t.i8());return a.xi(c),b}return!0},i2:function(a){if(!a.xb()){for(var b=a.xk(),c=ce.a3(a,b),d=Hf.d(c),e=Hf.d(c),f=Hf.d(c),g=Hf.d(c),h=0;c>h;h++)d[h]=new Je,e[h]=new re;for(var i=a.xf();i.i1();i.i2()){var j=i.i8();e[b.i2(j.a2())].aa(j),a.h1(j)}for(var k=a.x9();k.i1();k.i2()){var l=k.i9();d[b.i2(l)].aa(l),a.h2(k.i9())}for(var m=0;c>m;m++){for(var n=d[m].x1();n.i1();n.i2())a.h3(n.i9());for(var o=e[m].c1();o.i1();o.i2())a.u1(o.i8());this.w4(a);var p=a.g3();f[m]=new Vd(p.x,p.y,p.width,p.height);var q={};if(g[m]=q,this._cf>0){var r=this._cg+Math.ceil((p.width+1)/this._cf)*this._cf,s=this._cg+Math.ceil((p.height+1)/this._cf)*this._cf;q.x=p.x,q.y=p.y,q.width=r,q.height=s}else q.x=p.x,q.y=p.y,q.width=p.width+this._cg,q.height=p.height+this._cg;for(var t=e[m].c1();t.i1();t.i2())a.h1(t.i8());for(var u=d[m].x1();u.i1();u.i2())a.h2(u.i9())}for(var v=0;c>v;v++)for(var w=d[v].x1();w.i1();w.i2())a.h3(w.i9());for(var x=0;c>x;x++)for(var y=e[x].c1();y.i1();y.i2())a.u1(y.i8());if(of.a(g,null,this._ce/this._ch),this._cf<=0)for(var z=0;z<g.length;z++)this.w5(a,d[z],e[z],new Sd(g[z].x,g[z].y),f[z]);else for(var A=0;A<g.length;A++){var B=Math.floor((g[A].x-f[A].x)/this._cf)*this._cf,C=Math.floor((g[A].y-f[A].y)/this._cf)*this._cf,D=f[A].x+B,E=f[A].y+C;this.w5(a,d[A],e[A],new Sd(D,E),f[A])}a.xi(b)}},w5:function(a,b,c,d,e){for(var f=-e.x+d.x,g=-e.y+d.y,h=b.x1();h.i1();h.i2()){var i=a.ga(h.i9());a.s4(h.i9(),new Sd(i.x+f,i.y+g))}for(var j=c.c1();j.i1();j.i2()){for(var k=j.i8(),l=new md,m=a.gp(k).c();m.i1();m.i2()){var n=m.i6();l.add(new Sd(n.x+f,n.y+g))}a.s5(k,new Xd(l))}}});var _e=function(){};Hb.ext(_e,Ze,{i1:function(a){return this.w3(a)},i2:function(a){this.w7(a),null!=this.w2()&&this.w4(a),this.w6(a)},w7:function(a){this.e(a),this.k(a),this.i(a)},e:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},w6:function(a){this.l(a),this.j(a),this.f(a)},l:function(a){for(var b=a.x9();b.i1();b.i2()){var c=a.g4(b.i9());a.s1(b.i9(),c)}},j:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},k:function(a){for(var b=a.xf();b.i1();b.i2()){var c=a.g7(b.i8()),d=c.i6();c.i8(d),d=c.i7(),c.i9(d);for(var e=0;e<c.i1();e++){var f=c.i2(e);c.i3(e,f.x,f.y)}}},f:function(a){null!=this._ca&&(a.x1("A",this._ca),this._ca=null,this._b6=null),null!=this._b8&&(a.x1("B",this._b8),this._b8=null,this._b9=null)},i:function(a){this._ca=a.xc("A"),null!=this._ca&&(this._b6=new Ye(this._ca),a.x1("A",this._b6)),this._b8=a.xc("B"),null!=this._b8&&(this._b9=new Ye(this._b8),a.x1("B",this._b9))}});var af=function(){this._a=new re,this._c=10};Hb.ext(af,Ze,{i2:function(a){this._b=a.xl(),this.w9(a),this.w4(a),this.c(a),this.w8(a,this._b),a.xj(this._b)},i1:function(a){if(null==this.w2())return!0;this._b=a.xl(),this.w9(a);var b=this.w3(a);return this.c(a),a.xj(this._b),b},w8:function(a,b){for(var c=a.xf();c.i1();c.i2()){var d=c.i8();if(null!=b.i1(d)){var e=b.i1(d);of.g(a,d,e,this._c)}}},w9:function(a){for(var b=a.xk(),c=a.x9();c.i1();c.i2()){for(var d=c.i9(),e=d.af();e.i1();e.i2()){var f=e.i8(),g=f.a1(d),h=b.i1(g);if(h!==f)if(null==h)b.z1(g,f);else{null==this._b.i1(h)&&this._b.i8(h,new re);var i=this._b.i1(h);i.aa(f),this._a.ac(f),a.h1(f)}}for(var j=d.af();j.i1();j.i2()){var k=j.i8(),l=k.a1(d);b.z1(l,null)}}a.xi(b)},c:function(a){for(;!this._a.ar();a.u1(this._a.c3()));}});var bf=function(a){this._a=a};Hb.ext(bf,Object,{i2:function(a){this._a.i3(a)},i1:function(a){return this._a.i4(a)}});var cf=function(){cf.superClass.constructor.call(this),this._jo=30,this._jp=new gf,this._jt=5};Hb.ext(cf,Qe,{i4:function(a){return!0},i3:function(a){this._ju=a,of.c(a);for(var b=this._jp.i1(a),c=0,d=a.x9();d.i1();d.i2())c=Math.max(c,this.e(d.i9()));c<this._jt&&(c=this._jt),this.a(b,c)},a:function(a,b){var c=a.i7(),d=2*Math.PI/c,e=0,f=Hf.a(c);a.i4();for(var g=0;c>g;)f[g]=this.e(a.i9())+this._jo,e+=f[g],g++,a.i2();var h=e/c,i=e/(2*Math.PI);b>i&&(i=b),a.i4();for(var j=0,k=0;c>k;){var l=d/h*f[k];j+=l/2;var m=Math.cos(j)*i,n=Math.sin(j)*i;j+=l/2,this._ju.s2(a.i9(),m,n),k++,a.i2()}return i},e:function(a){var b=this._ju.gj(a),c=this._ju.g9(a);return c>=b?c:b}});var df=function(){df.superClass.constructor.call(this),this._jm=new cf,this._jk=new Xe};Hb.ext(df,Qe,{i4:function(a){return!0},i3:function(a){if(!(a.x0()<2)){this._jn=a,of.c(this._jn),of.e(this._jn);var b=new mf(this._jn);b.a1(),b.h();var c=new Le(this._jn);c.a();for(var d=b.x9();d.i1();d.i2()){var e=d.i9(),f=b.c2(e);if(f.ay()>1){var g=b.d1(e);Le.h(this._jn,g.c1()),this._jm.i3(this._jn);var h=this._jn.g3();b.s7(e,h.width,h.height)}else if(1===f.ay()){var i=f.x2();b.s8(e,this._jn.gm(i)),this._jn.s2(i,0,0)}else b.s7(e,1,1);Le.i(this._jn,this._jn.xf())}c.b();var j=this.a7(b);je.a4(b,j);var k=b.xk(),l=b.xl();this.a2(b,l,k),this.a1(b,l),this.a3(b,j,l),this._jk.a(l,k),this._jk.i3(b),this.a5(b,j,k);for(var m=b.x9();m.i1();m.i2())for(var n=m.i9(),o=b.g4(n),p=b.c2(n).x1();p.i1();p.i2()){var q=p.i9();this._jn.s2(q,o.x+this._jn.g5(q),o.y+this._jn.g6(q))}}},a7:function(a){for(var b=-1,c=null,d=a.x9();d.i1();d.i2()){var e=d.i9();a.c2(e).ay()>b&&(c=e,b=a.c2(e).ay())}return c},a1:function(a,b){for(var c=function(a,c){var d=b.i3(a)-b.i3(c);return d>0?1:d>=0?0:-1},d=a.x9();d.i1();d.i2())d.i9().av(c)},a2:function(a,b,c){for(var d=Hf.a(this._jn.x0()),e=a.x9();e.i1();e.i2())for(var f=e.i9(),g=a.c2(f),h=g.x1();h.i1();h.i2()){var i=h.i9();d[i.al()]=f.al()}var j=je.a2(a);this.a4(a,j,d,b,c)},a3:function(a,b,c){if(a.c2(b).ay()>1){for(var d=0,e=0,f=0,g=b.ap();g.i1();g.i2()){var h=g.i8(),i=c.i3(h);i-d>e&&(e=i-d,f=(d+i)/2),d=i}360-d>e&&(f=(360+d)/2),this.a6(a,b,f);for(var j=b.ap();j.i1();j.i2()){var k=j.i8(),l=c.i3(k);for(l-=f;0>l;l+=360);c.i6(k,l)}b.av(function(a,b){var d=c.i3(a)-c.i3(b);return d>0?1:d>=0?0:-1})}},a4:function(a,b,c,d,e){for(var f=b.al(),g=e.i3(b),h=b.ap();h.i1();h.i2()){for(var i=h.i8(),j=a.b(i),k=0,l=0,m=0,n=0,o=j.c1();o.i1();o.i2()){var p=o.i8(),q=null,r=null;c[p.a2().al()]===f?(q=p.a2(),r=p.a3()):(q=p.a3(),r=p.a2()),m-=this._jn.g5(q),n+=this._jn.g6(q),k-=this._jn.g5(r),l+=this._jn.g6(r)}if(0!==m||0!==n){var s;for(s=180*Math.atan2(n,m)/Math.PI-g;0>s;s+=360);d.i6(i,s)}if(0!==k&&0!==l){var t=180*Math.atan2(l,k)/Math.PI;0>t&&(t+=360),e.i6(i.a3(),t)}this.a4(a,i.a3(),c,d,e)}},a5:function(a,b,c){for(var d=a.g4(b),e=b.ap();e.i1();e.i2()){var f=e.i8(),g=f.a3(),h=a.g4(g),i=h.x-d.x,j=h.y-d.y,k=180*Math.atan2(j,i)/Math.PI;if(null!=c.i1(g)){var l=c.i3(g);k+=l}this.a6(a,g,k),this.a5(a,g,c)}},a6:function(a,b,c){c=c/180*Math.PI;var d=a.c2(b);if(!(d.ay()<=1))for(var e=d.x1();e.i1();e.i2()){var f=e.i9(),g=this._jn.g5(f),h=this._jn.g6(f),i=Math.cos(c),j=Math.sin(c),k=g*i-j*h,l=g*j+i*h;this._jn.s2(f,k,l)}}});var ef=function(){this._a=(new Date).getTime()};Hb.ext(ef,Object,{b:function(){return(new Date).getTime()-this._a}});var ff={};ff._A=new Sd(0,0),ff.b=function(a,b,c){return ff.c(a.x,a.y,b.x,b.y,c.x,c.y)},ff.c=function(a,b,c,d,e,f){c-=a,d-=b,e-=a,f-=b;var g=e*d-f*c;return Math.abs(g)<1e-5?0:g>=0?0>=g?0:-1:1},ff.d=function(a,b,c){return ff.b(a,b,c)>0},ff.f=function(a,b,c){return ff.b(a,b,c)<0},ff.g=function(a,b,c){return 0===ff.b(a,b,c)},ff.h=function(a){return ff.i(a)},ff.i=function(a){var b=new qe(a.ah()),c=new qe;if(b.a2(),b.ar())return c;var d=b.at();for(c.ae(d);!b.ar()&&d.equals(b.am());b.at());if(b.ar())return c;d=b.at();for(var e=c.ae(d),f=b.ah();f.i1();f.i2()){var g=f.i6();if(!g.equals(d))if(d=g,2===c.ay()&&ff.g(c.am(),c.as(),g))e.c(g);else{var h;for(h=e;!ff.f(c.ai(h).d(),h.d(),g);h=c.ai(h));var i;for(i=e;!ff.d(c.aj(i).d(),i.d(),g);i=c.aj(i));for(;i!==c.aj(h);c.aw(c.aj(h)));e=c.an(g,h)}}return c},ff.j=function(){return ff.k(Number.MAX_VALUE)},ff.k=function(a){return Math.floor(Gb.Util.random()*a)},ff.l=function(a,b){return Gb.Util.random()*(b-a)+a};var gf=function(){};Hb.ext(gf,Object,{i1:function(a){this._b=a;var b=new re;b=ce.a6(a),b.az(ce.a7(a));for(var c=this.a1();!b.ar();a.x5(b.c3()));return c.x1()},a1:function(){if(this._b.x0()<3)return new Je(this._b.x9());for(var a=this._b.xk(),b=this._b.xk(),c=this._b.xl(),d=new Me(this._b,new Ve,0,this.a3(this._b)),e=this._b.x0(),f=new re,g=new re,h=new Le(this._b);e>3;e--){for(var i=d.g(),j=i.an();j.i1();j.i2())a.z1(j.i9(),e),b.i5(j.i9(),!1);for(var k=i.an();k.i1();k.i2())for(var l=k.i9(),m=l.ap();m.i1();m.i2()){var n=m.i8();a.i2(n.a3())===e&&(g.aa(n),b.i5(n.a2(),!0),b.i5(n.a3(),!0))}if(g.ay()<i.ad()-1){for(var o=null,p=i.an();p.i1();p.i2()){var q=p.i9();if(a.i2(q)===e&&!b.i4(q))if(null==o)o=q;else{var r=this._b.xo(o,q);c.i7(r,!0),g.aa(r),o=null}}if(null!=o)for(var s=i.an();s.i1();s.i2()){var t=s.i9();if(t!==o&&null==t.aj(o)){var u=this._b.xo(o,t);c.i7(u,!0),g.aa(u);break}}if(g.ay()<i.ad()-1){for(var v=2147483647,w=null,x=i.an();x.i1();x.i2()){var y=x.i9();y.ad()<v&&(w=y,v=y.ad())}for(var z=i.an();z.i1();z.i2()){var A=z.i9();if(null==w.aj(A)&&w!==A){var B=this._b.xo(w,A);if(c.i7(B,!0),g.aa(B),g.ay()>=i.ad()-1)break}}}}for(var C=i.an();C.i1();C.i2())d.b(C.i9());for(var D=g.c1();D.i1();D.i2()){var E=D.i8();c.i4(E)&&(d.d(E.a2()),d.d(E.a3()))}f.az(g),h.e(i)}h.b(),d.c();for(var F=f.c1();F.i1();F.i2()){var G=F.i8();null!=G._h&&(c.i4(G)?this._b.x5(G):this._b.h1(G))}var H=this.a4(this._b),I=new Je,J=H.ak(0),K=H.ak(1),L=null;L=J.a2()===K.a2()||J.a2()===K.a3()?J.a3():J.a2(),I.aa(L);for(var M=H.c1();M.i1();M.i2()){var N=M.i8();L=N.a1(L),I.aa(L)}for(var O=f.c1();O.i1();O.i2()){var P=O.i8();c.i4(P)||null!=P._h||this._b.u1(P)}return this._b.xi(b),this._b.xj(c),this._b.xi(a),this.a2(I),I},a2:function(a){if(a.ay()<this._b.x0()){for(var b=this._b.xk(),c=a._b;null!=c;c=c.a()){var d=c.d();b.z1(d,c)}var e;for(e=new Me(this._b,new We(b),0,a.ay(),new We(b));!e.e();){for(var f=e.f(),g=f.an();g.i1();g.i2()){var h=g.i9();if(null!=b.i1(h)){var i=b.i1(h),j=a.ai(i).d(),k=null;k=null!=f.aj(j)?a.ao(f,i):a.an(f,i),b.z1(f,k);break}}for(var l=f.an();l.i1();l.i2()){var m=l.i9();null==b.i1(m)&&e.d(m)}}this._b.xi(b),e.c()}},a3:function(a){for(var b=0,c=a.x9();c.i1();c.i2())b=Math.max(b,c.i9().ad());return b},a4:function(a){for(var b=[],c=0,d=a.x0();d>c;c++)b[c]=new he;var e=new fe(b);e.a6(!1),e.a8(a);for(var f=-1,g=null,h=a.x9();h.i1();h.i2()){var i=h.i9(),j=b[i.al()];j._a+j._c>f&&(f=j._a+j._c,g=i)}for(var k=new re,l=g,m=b[l.al()]._d;null!=m;m=b[l.al()]._d)k.ac(m),l=m.a1(l);l=g;for(var n=b[l.al()]._b;null!=n;n=b[l.al()]._d)k.ae(n),l=n.a1(l);return k}});var hf=function(){this._v=new se,this._x=new se,this._z=new De(3,5),this._w=new De(3,5),this._y=!1,this._u=!1,this._t={}};Hb.ext(hf,Object,{xm:function(){var a=new Ee(this);return a},xo:function(a,b){return this.xn(a,null,b,null,0,0)},xn:function(a,b,c,d,e,f){return new ye(this,a,b,c,d,e,f)},x4:function(a){this.b3(a)},b3:function(a){for(var b;null!=(b=a._o[0]);)this.x5(b);for(;null!=(b=a._o[1]);)this.x5(b);this._v.c(a),a._g=null,this._y=!0},x5:function(a){this.a11(a)},a11:function(a){if(a._h!==this)throw"Error";var b=a.a2(),c=a.a3();this.a12(a,b,c),this._x.c(a),a._h=null,this._u=!0},x7:function(a){a._p=this._v._c,a._g=this,a.ac(),a._c.length<this._z._b&&this._z.a3(a,a._c.length,this._z._b),this._v.a(a),this._y=!0},x8:function(a){if(null!=a._h)throw"Error";a._c.length<this._w._b&&this._w.a3(a,a._c.length,this._w._b),null==a._a||a._a._h!==this?this._x.a(a):this._x.b(a,a._a),a._h=this,a.a4(),this.b2(a,a.a2(),null,a.a3(),null,0,0),this._u=!0},xr:function(a,b,c){var d=a.a2(),e=a.a3();null==a._h?(a._d=b,a._e=c):(d!==b&&(d.ar(a,0,0),a._d=b,b.ab(a,null,0,0,0)),e!==c&&(e.ar(a,1,1),a._e=c,c.ab(a,null,1,1,0)))},x3:function(a){this.xr(a,a.a3(),a.a2())},h1:function(a){this.a11(a)},u1:function(a){this.x8(a)},h2:function(a){this.x4(a)},h3:function(a){this.x7(a)},xa:function(){return this._v._c},x0:function(){return this._v._c},xh:function(){return this._x._c},xg:function(){return this._x._c},xb:function(){return 0===this._v._c},xq:function(a){return a._g===this},xp:function(a){return a._h===this},xd:function(){return this._v._a},x9:function(){return new Ie(this._v)},xf:function(){return new Ie(this._x)},x2:function(a,b){var c=Hf.d(this.xh());if(null!=a&&null!=b)for(var d=this.x9();d.i1();d.i2())d.i9().at(a,1,c),d.i9().at(b,0,c);else if(null==b&&null!=a)for(var e=this.x9();e.i1();e.i2())e.i9().at(a,1,c);else if(null!=b&&null==a)for(var f=this.x9();f.i1();f.i2())f.i9().at(b,0,c)},xk:function(){return this._z.b(this._v)},xl:function(){return this._w.c(this._x)},xi:function(a){this._z.a5(a,this._v)},xj:function(a){this._w.a6(a,this._x)},xc:function(a){return this._t[a]},x1:function(a,b){this._t[a]=b},x6:function(a){delete this._t[a]},b2:function(a,b,c,d,e,f,g){b.ab(a,c,0,0,f),d.ab(a,e,1,1,g)},a12:function(a,b,c){b.ar(a,0,0),c.ar(a,1,1)},c:function(){for(var a=0,b=this.x9();b.i1();b.i2())b.i9()._p=a++;this._y=!1},b1:function(){for(var a=0,b=this.xf();b.i1();b.i2())b.i8()._g=a++;this._u=!1},xs:function(a){a.as(this,this._z._b),a._p=this._v._c,this._v.a(a)},xt:function(a,b,c,d,e,f,g){a.a6(this,b,d,this._w._b),a._g=this._x._c,this._x.a(a),this.b2(a,a.a2(),c,a.a3(),e,f,g)}});var jf=function(){jf.superClass.constructor.call(this)};Hb.ext(jf,hf,{gb:function(a){return this.g1(a)},g7:function(a){return this.g2(a)},g5:function(a){var b=this.g1(a);return b.i1()+b.i3()/2},g6:function(a){var b=this.g1(a);return b.i2()+b.i4()/2},g4:function(a){return new Sd(this.g5(a),this.g6(a))},gi:function(a){return this.g1(a).i1()},gh:function(a){return this.g1(a).i2()},ga:function(a){var b=this.g1(a);return new Sd(b.i1(),b.i2())},gj:function(a){return this.g1(a).i3()},g9:function(a){return this.g1(a).i4()},gm:function(a){return new Td(this.gj(a),this.g9(a))},s1:function(a,b){this.s2(a,b.x,b.y)},s2:function(a,b,c){var d=this.g1(a);d.i5(b-d.i3()/2,c-d.i4()/2)},s7:function(a,b,c){this.g1(a).i6(b,c)},s8:function(a,b){this.s7(a,b.width,b.height)},s3:function(a,b,c){this.g1(a).i5(b,c)},s4:function(a,b){this.s3(a,b.x,b.y)},gp:function(a){for(var b=this.g2(a),c=new md,d=0;d<b.i1();d++)c.add(b.i2(d));return new Xd(c)},gf:function(a){for(var b=this.g2(a),c=new qe,d=0;d<b.i1();d++)c.aa(b.i2(d));return c},gc:function(a){var b=new md;b.add(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.add(c.i6());return b.add(this.gl(a)),new Xd(b)},gd:function(a){var b=new qe;b.aa(this.gs(a));for(var c=this.gp(a).d();c.i1();c.i2())b.aa(c.i6());return b.aa(this.gl(a)),b},m1:function(a,b){var c=this.g2(a);c.i5();var d=b.ah(),e=d.i6();this.gx(a,e);var f=b.as();for(d.i2();d.i6()!==f;d.i2()){var g=d.i6();c.i4(g.x,g.y)}this.gy(a,f)},s5:function(a,b){var c=this.g2(a);c.i5();for(var d=b.d();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},s6:function(a,b){var c=this.g2(a);c.i5();for(var d=b.ah();d.i1();d.i2()){var e=d.i6();c.i4(e.x,e.y)}},m2:function(a,b,c){this.gx(a,b),this.gy(a,c)},gn:function(a){return this.g2(a).i6()},gk:function(a){return this.g2(a).i7()},gt:function(a,b){this.g2(a).i8(b)},gz:function(a,b){this.g2(a).i9(b)},gs:function(a){var b=this.g2(a).i6();if(null==b)return this.g4(a.a2());var c=new Sd(this.g5(a.a2())+b.x,this.g6(a.a2())+b.y);return c},gl:function(a){var b=this.g2(a).i7();if(null==b)return this.g4(a.a3());var c=new Sd(this.g5(a.a3())+b.x,this.g6(a.a3())+b.y);return c},gx:function(a,b){var c=new Sd(b.x-this.g5(a.a2()),b.y-this.g6(a.a2()));this.g2(a).i8(c)},gy:function(a,b){var c=new Sd(b.x-this.g5(a.a3()),b.y-this.g6(a.a3()));this.g2(a).i9(c)},g8:function(){for(var a=new re,b=this.xf();b.i1();b.i2())a.aa(b.i8());return a},g3:function(){for(var a,b,c=a=Number.MAX_VALUE,d=b=Number.MIN_VALUE,e=this.x9();e.i1();e.i2()){var f=this.ga(e.i9()),g=this.gm(e.i9());c=Math.min(f.x,c),a=Math.min(f.y,a),d=Math.max(f.x+g.width,d),b=Math.max(f.y+g.height,b)}for(var h=this.xf();h.i1();h.i2())for(var i=this.gp(h.i8()).c();i.i1();i.i2()){var j=i.i6();c=Math.min(j.x,c),a=Math.min(j.y,a),d=Math.max(j.x,d),b=Math.max(j.y,b)}return{x:Math.floor(c),y:Math.floor(a),width:Math.floor(d-c),height:Math.floor(b-a)}}});var kf=function(){kf.superClass.constructor.call(this),this.a(new be,new _d)};Hb.ext(kf,jf,{a:function(a,b){this._a3=a,this._a4=b},xo:function(a,b){return this.l2(a,b,this._a4.a6())},l2:function(a,b,c){return this.l1(a,null,b,null,0,0,c)},xn:function(a,b,c,d,e,f){return this.l1(a,b,c,d,e,f,this._a4.a6())},l1:function(a,b,c,d,e,f,g){var h=new ye(this,a,b,c,d,e,f);return h._l=g,h},xm:function(){var a=new Ee(this);return a._r=this._a3.m3(),a},g3:function(){for(var a={x:0,y:0,width:-1,height:-1},b=this.x9();b.i1();b.i2())b.i9()._r.m1(a);return a},g1:function(a){return a._r},g2:function(a){return a._l},g5:function(a){return a._r.m4()},g6:function(a){return a._r.m5()},gi:function(a){return a._r.i1()},gh:function(a){return a._r.i2()},gj:function(a){return a._r.i3()},g9:function(a){return a._r.i4()},s2:function(a,b,c){a._r.m6(b,c)},s7:function(a,b,c){a._r.i6(b,c)},s3:function(a,b,c){a._r.i5(b,c)}});var lf=function(){lf.superClass.constructor.call(this),this._ap=this.xk(),this._as=this.xl()};Hb.ext(lf,jf,{g1:function(a){var b=this._ap.i1(a);return null==b&&(b=new Be,this._ap.z1(a,b)),b},g2:function(a){var b=this._as.i1(a);return null==b&&(b=new Ae,this._as.i8(a,b)),b}});var mf=function(a){mf.superClass.constructor.call(this),this._ay=a,this._a0=this.xk(),this._au=this.xl()};Hb.ext(mf,lf,{c2:function(a){var b=this._a0.i1(a);return b},a2:function(a,b){this._a0.z1(a,b)},h:function(){null==this._az&&(this._az=this.xk());for(var a=Hf.a(this._ay.x0()+1),b=1,c=this.x9();c.i1();){for(var d=this.c2(c.i9()),e=d.x1();e.i1();e.i2()){var f=e.i9();a[f.al()]=b}for(var g=new re,h=d.x1();h.i1();h.i2())for(var i=h.i9(),j=a[i.al()],k=i.ap();k.i1();k.i2()){var l=k.i8(),m=l.a3(),n=a[m.al()];n===j&&g.ac(l)}this._az.z1(c.i9(),g),c.i2(),b++}},d1:function(a){return this._az.i1(a)},b:function(a){return this._au.i1(a)},a3:function(a,b){this._au.i8(a,b)},a1:function(){var a=this._ay.xk(),b=Ne.a4(Hf.a(this._ay.xh())),c=ce.a1(this._ay,b,a),d=ce.a5(this._ay,b,c);this.d2(a,d),this._ay.xi(a)},c1:function(a){for(var b=null,c=-1,d=0,e=a.length;e>d;d++){var f=a[d];f.ay()>c&&(b=f,c=f.ay())}return b},d2:function(a,b){for(var c=this._ay.xl(),d=this._ay.xk(),e=b.length,f=0;e>f;f++)for(var g=b[f],h=g.c1();h.i1();h.i2())c.i8(h.i8(),g);var i=this.c1(b);this.a4(i,a,c,new md,d);var j={};e=b.length;for(var k=0;e>k;k++){var l=b[k];if(l.ay()>1){var m=this.xm();j[l._id]=m}}for(var n=this._ay.x9();n.i1();n.i2()){var o=n.i9();if(a.i4(o)&&null==d.i1(o)){var p=this.xm();j[o._id]=p;var q=new Je;q.aa(o),this.a2(p,q)}}var r=Hf.d(2);e=b.length;for(var s=0;e>s;s++){
var t=b[s];if(1===t.ay()){var u=t.c2();r[0]=u.a2(),r[1]=u.a3();for(var v=0;2>v;v++){var w=r[v];if(1===w.ad()){var x=this.xm();j[w._id]=x;var y=new Je;y.aa(w),this.a2(x,y)}}}}for(var z=this._ay.x9();z.i1();z.i2()){var A=z.i9();if(null!=d.i1(A))for(var B=d.i1(A),C=j[B._id],D=A.af();D.i1();D.i2()){var E=D.i8();if(c.i1(E)!==B){var F=j[c.i1(E)._id];if(null==F){var G=E.a1(A),H=d.i1(G);F=null!=H?j[H._id]:j[G._id]}var I=C.aj(F),J=null;null==I?(I=this.xo(C,F),J=new re):J=this.b(I),J.aa(E),this.a3(I,J)}}else if(a.i4(A))for(var K=j[A._id],L=A.af();L.i1();L.i2()){var M=L.i8(),N=M.a1(A),O=j[N._id];if(null!=O){var P=K.aj(O);if(null==P){var Q=this.xo(K,O),R=new re;R.aa(M),this.a3(Q,R)}}}}if(2===this._ay.x0()&&1===this._ay.xg()){var S=this._ay.xf().i8(),T=j[S.a2()._id],U=j[S.a3()._id];if(null!=U&&null!=T&&null==U.aj(T)){var V=this.xo(T,U),W=new re;W.aa(S),this.a3(V,W)}}var X=Hf.a(this._ay.x0()),Y=1;e=b.length;for(var Z=0;e>Z;Z++){var $=b[Z],_=j[$._id];if(null!=_){var aa=this.c2(_);null==aa&&(aa=new Je,this.a2(_,aa));for(var ba=$.c1();ba.i1();ba.i2()){var ca=ba.i8(),da=ca.a2();X[da.al()]===Y||a.i4(da)&&d.i1(da)!==$||(X[da.al()]=Y,aa.aa(da)),da=ca.a3(),X[da.al()]===Y||a.i4(da)&&d.i1(da)!==$||(X[da.al()]=Y,aa.aa(da))}}}this._ay.xj(c),this._ay.xi(d)},a4:function(a,b,c,d,e){if(!d.contains(a)){d.add(a);for(var f=[],g=a.c1();g.i1();g.i2()){var h=g.i8();f[0]=h.a2(),f[1]=h.a3();for(var i=0;2>i;i++){var j=f[i];if(b.i4(j)&&null==e.i1(j)){a.ay()>1&&e.z1(j,a);for(var k=j.af();k.i1();k.i2()){var l=c.i1(k.i8());this.a4(l,b,c,d,e)}}}}}}});var nf=function(a,b,c,d,e){this._a={},nf.superClass.constructor.call(this);var f,g,h=new md;for(f=0,g=b.size();g>f;f++){var i=b.get(f);if(i instanceof Gb.Link)h.add(i);else{var j=d&&null==e&&i instanceof Nd;j&&i.setExpanded(!0);var k=a.getDimension(i);if(j&&i.setExpanded(!1),null==k)continue;var l=this.xm(),m=a._repulsion;"rightleft"===c||"leftright"===c?this.s7(l,k.height*m,k.width*m):this.s7(l,k.width*m,k.height*m),l.node=i,this._a[i.getId()]=l}}for(f=0,g=h.size();g>f;f++){var n=h.get(f),o=n.getFromAgent(),p=n.getToAgent(),q=this._a[o.getId()],r=this._a[p.getId()];null!=q&&null!=r&&q!==r&&this.xo(q,r)}};Hb.ext(nf,kf,{});var of={};of._D=new Xd,of._E=new Sd(0,0),of.b=function(a){if(a.i1()>0){for(var b=new md,c=a.i1()-1;c>=0;c--)b.add(a.i2(c));a.i5();for(var d=0,e=b.size();e>d;d++){var f=b.get(d);a.i4(f.x,f.y)}}var g=a.i6();a.i8(a.i7()),a.i9(g)},of.c=function(a){of.d(a,!0)},of.d=function(a,b){if(b)for(var c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,of._E),a.gz(d,of._E),a.s5(d,of._D)}else for(var e=a.xf();e.i1();e.i2())a.s5(e.i8(),of._D)},of.e=function(a){for(var b=new Sd(0,0),c=a.xf();c.i1();c.i2()){var d=c.i8();a.gt(d,b),a.gz(d,b)}},of.f=function(a,b,c,d){for(var e=a.gc(b).b(),f=Hf.d(e),g=0,h=a.gc(b).c();h.i1();h.i2()){var i=h.i6();(0>=g||!i.equals(f[g-1]))&&(f[g]=new Sd(i.x,i.y),g++)}if(e=g,!(2>e)){var j=new md,k=new Ud(f[1].x-f[0].x,f[1].y-f[0].y),l=of.i(k);l.x*=d,l.y*=d;for(var m=of.h(f[0],l),n=of.h(f[1],l),o=new Wd(m,n),p=1;e-1>p;p++){var q=o,r=of.i(new Ud(f[p+1].x-f[p].x,f[p+1].y-f[p].y));r.x*=d,r.y*=d;var s=of.h(f[p],r),t=of.h(f[p+1],r);o=new Wd(s,t);var u=Wd.a6(q,o);null!=u&&j.add(new Sd(u.x,u.y))}var v=new Ud(f[e-1].x-f[e-2].x,f[e-1].y-f[e-2].y);v=of.i(v),v.x*=d,v.y*=d;var w=of.h(f[e-1],v),x=new Xd(j);b.a2()===c.a2()?(a.s5(c,x),a.m2(c,m,w)):(a.s5(c,x.a()),a.m2(c,w,m))}},of.g=function(a,b,c,d){for(var e=d,f=c.c1();f.i1();f.i2()){var g=f.i8();of.f(a,b,g,e),0>e&&(e-=d),e=-e}},of.a=function(a,b,c){return of.j(a,b,c,1)},of.l=function(a,b,c){if(null==a||a.length<1)return null!=b&&(b.x=0,b.y=0,b.width=0,b.height=0),{width:0,height:0};for(var d=0,e=0,f=0;f<a.length;f++){var g=a[f];d=Math.max(d,g.width),e=Math.max(e,g.height)}var h,i,j=d*e*a.length,k=Math.sqrt(j/c),l=j/k,m=Math.floor(l/d),n=Math.ceil(l/d),o=Math.ceil(a.length/m),p=Math.ceil(a.length/n);n*p>m*o?(h=m,i=o):(h=n,i=p);var q,r=0,s=0,t=0,u=0;if(d>e)for(var v=0;v<a.length;v++)q=a[v],q.x=s*d,q.y=r*e,t=Math.max(t,q.x+q.width),u=Math.max(u,q.y+q.height),++s>=h&&(r++,s=0);else for(var w=0;w<a.length;w++)q=a[w],q.x=s*d,q.y=r*e,t=Math.max(t,q.x+q.width),u=Math.max(u,q.y+q.height),++r>=i&&(s++,r=0);return null!=b&&(b.x=0,b.y=0,b.width=t,b.height=u),{width:i,height:h}},of.j=function(a,b,c,d){if(null==a||a.length<1)return null!=b&&(b.x=0,b.y=0,b.width=0,b.height=0),0;for(var e,f,g=e=a[0].width,h=f=a[0].height,i=a.length,j=1;i>j;j++){var k=a[j].width;g=Math.min(g,k),e=Math.max(e,k);var l=a[j].height;h=Math.min(h,l),f=Math.max(f,l)}if(h/f>.95&&g/e>.95)return of.l(a,b,c).width;for(var m=new qe,n=0,o=0;i>o;o++){var p=a[o];m.aa(a[o]),n=Math.floor(n+p.width*p.height)}m.a1(function(a,b){var c=Math.floor(b.height)-Math.floor(a.height);return 0===c?Math.floor(b.width)-Math.floor(a.width):c});var q=0,r=0,s=Math.floor(c*Math.sqrt(n/c)),t=s,u=0,v=new qe;do{var w=new qe;v.aa(w);for(var x,y,z=x=y=0,A=m.ah();A.i1();A.i2()){var B=A.i6();z+B.width>t&&w.ay()>0?(y=Math.max(y,z),w=new qe,w.aa(B),v.aa(w),z=Math.floor(B.width)):(w.aa(B),z=Math.floor(z+B.width)),1===w.ay()&&(x=Math.floor(x+w.am().height))}y=Math.max(y,z),c*x>y&&u!==y&&(v.af(),t=Math.floor(1.1*t),u=y)}while(v.ar());for(var C=0,D=v.ah();D.i1();D.i2()){for(var E=0,F=D.i6(),G=F.ah();G.i1();G.i2()){var H=G.i6();H.x=E,H.y=C,E+=H.width}q=Math.max(q,E),C+=of.k(F),r=Math.max(r,C)}return null!=b&&(b.x=0,b.y=0,b.width=q,b.height=r),v.ay()},of.k=function(a){for(var b=0,c=a.ah();c.i1();c.i2())b=Math.max(c.i6().height,b);return b},of.h=function(a,b){return new Sd(a.x+b.x,a.y+b.y)},of.i=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);return new Ud(-a.y/b,a.x/b)};var pf=function(a){this._a=a,this._b=!1};Hb.ext(pf,Object,{a:function(){return this._b},b:function(){return this._a},c:function(){return 1===this._a},d:function(){return 2===this._a},e:function(){return 4===this._a},f:function(){return 8===this._a},g:function(){return 0===this._a}}),pf.h=function(a,b){var c=a.xc("A");return null==c?null:c.i1(b)},pf.i=function(a,b){var c=a.xc("B");return null==c?null:c.i1(b)},pf.j=function(a){switch(a){case 1:return pf.k;case 2:return pf.l}return null},pf.k=new pf(1),pf.l=new pf(2);var qf=function(a,b,c,d,e){this._o=0,this._l=0,this._i=0,this._d=0,this._f=0,this._b=a,this._a=1e-4,this._r=b,this._p=1,this._e=(e.gj(a)+e.g9(a))/4;var f=.45*c*Math.sqrt(d);this._k=ff.l(-f,f),this._h=ff.l(-f,f),this._g=ff.l(-f,f)};Hb.ext(qf,Object,{});var rf=function(){this._a=0,this._c=0,this._b=0};Hb.ext(rf,Object,{});var sf=function(){sf.superClass.constructor.call(this),this._dj=0,this._dh=0,this._dq=0,this._dp=0,this._dt=0,this._de=0,this._d3=0,this._dr=0,this._ed=0,this._dw=.65,this._ea=1,this._dl=80,this._dx=3,this._d8=!0,this._eb=3e5,this._ee=2,this._di=2,this._df=1e3};Hb.ext(sf,Qe,{i4:function(a){return!0},i3:function(a){if(null!=a&&(this._d5=a,this.s(a))){var b=new rf,c=0,d=Math.floor(this._dx*this._dz.length*this._dz.length+20*this._dz.length);d=Math.max(d,1e4);var e=this._ea*this._ea*this._dz.length,f=this._df;try{for(;this._dj>e&&d>c;c++){var g=this.b(2147483647&c);0===f--&&(this._dy.b()>this._eb&&(c=d),f=this._df),this.h(g,b),this.d(g,b),this.i(g,b),this._d8?(this.g(g,b),this.j(g,b)):(this.f(g,b),this.c(g,b));var h=Math.sqrt(b._a*b._a+b._c*b._c+b._b*b._b);this.ac(g,b,h),this.aa(g,b,h)}}catch(i){}finally{this.r()}}},s:function(a){if(null==a||a.xa()<1)return!1;this._d5=a,this._dp=1,this._dy=new ef,this._dt=a.x0(),this._d2=Hf.d(this._dt),this._df=1+1e5/this._dt,this._ed=1/(2*this._di),this._de=this._ed*this._ee/(.05*this._dl),this._d3=Math.pow(this._dl,-1)*this._ed,this._dr=Math.pow(this._dl,3)*this._ed,this._dj=0,this._du=new rf,this._dq=Math.max(20*this._dl,10);var b=Math.max(.1,Math.min(this._dw*this._dl,this._dq)),c=this._dt;of.c(a),this._dz=Hf.d(c);for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=new qf(e,b,this._dl,this._dt,a);this._dz[--c]=f,this._dj+=f._r,this._dh+=f._r*f._r,this._du._a+=f._k,this._du._c+=f._h,this._du._b+=f._g,this._d2[e.al()]=f}return this._d8=!1,this._dz.length>0},b:function(a){var b=this._dz.length,c=b-a%b-1,d=ff.k(c+1),e=this._dz[d];return this._dz[d]=this._dz[c],this._dz[c]=e,e},f:function(a,b){for(var c,d,e=c=d=0,f=a._b.ae();null!=f;f=f.a7()){var g,h=this._d2[f.a2().al()],i=h._k-a._k,j=h._h-a._h,k=h._g-a._g,l=i*i+j*j+k*k,m=Math.sqrt(l),n=m-(h._e+a._e);0>=n||(g=n*n*this._d3/m,e+=i*g,c+=j*g,d+=k*g)}for(var o=a._b.ag();null!=o;o=o.a8()){var p,q=this._d2[o.a3().al()],r=q._k-a._k,s=q._h-a._h,t=q._g-a._g,u=r*r+s*s+t*t,v=Math.sqrt(u),w=v-(q._e+a._e);0>=w||(p=w*w*this._d3/v,e+=r*p,c+=s*p,d+=t*p)}b._a+=e,b._c+=c,b._b+=d},g:function(a,b){var c,d,e=c=d=0;this._dp++,a._f=this._dp;for(var f=a._b.ae();null!=f;f=f.a7()){var g=this._d2[f.a2().al()];g._f=this._dp;var h=g._k-a._k,i=g._h-a._h,j=g._g-a._g,k=h*h+i*i+j*j,l=Math.sqrt(k);if(0!==l){var m=Math.max(1e-6,l-(a._e+g._e)),n=-this._ef[f.a5()]/(m*m);n+=m*m*this._d1[f.a5()],n/=l,e+=h*n,c+=i*n,d+=j*n}}for(var o=a._b.ag();null!=o;o=o.a8()){var p=this._d2[o.a3().al()];p._f=this._dp;var q=p._k-a._k,r=p._h-a._h,s=p._g-a._g,t=q*q+r*r+s*s,u=Math.sqrt(t);if(0!==u){var v=Math.max(1e-6,u-(a._e+p._e)),w=-this._ef[o.a5()]/(v*v);w+=v*v*this._d1[o.a5()],w/=u,e+=q*w,c+=r*w,d+=s*w}}b._a+=e,b._c+=c,b._b+=d},j:function(a,b){for(var c,d,e=c=d=0,f=this._dt-1;f>=0;f--){var g=this._d2[f];if(g._f!==a._f){var h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(0!==k){var l=Math.sqrt(k),m=Math.max(1e-6,l-(a._e+g._e)),n=this._dr/(m*m*l);e+=h*n,c+=i*n,d+=j*n}}}b._a+=e,b._c+=c,b._b+=d},c:function(a,b){for(var c,d,e=c=d=0,f=this._dt-1;f>=0;f--){var g=this._d2[f],h=a._k-g._k,i=a._h-g._h,j=a._g-g._g,k=h*h+i*i+j*j;if(0!==k){var l,m=Math.sqrt(k),n=m-(a._e+g._e);l=0>=n?this._dr/(1e-8*m):this._dr/(n*n*m),e+=h*l,c+=i*l,d+=j*l}}b._a+=e,b._c+=c,b._b+=d},i:function(a,b){var c=this._du._b/this._dt-a._g;b._b+=c*this._dl*this._dt/this._dh},d:function(a,b){if(0!==this._de){var c=this._du._a/this._dt-a._k,d=this._du._c/this._dt-a._h,e=this._du._b/this._dt-a._g;b._a+=c*this._de,b._c+=d*this._de,b._b+=e*this._de}},h:function(a,b){var c=.05*(a._r+2);c>0&&(b._a=ff.l(-c,c),b._c=ff.l(-c,c),b._b=ff.l(-c,c))},ac:function(a,b,c){if(0!==c&&0!==a._a){var d=b._a*a._o+b._c*a._l+b._b*a._i,e=d/(c*a._a);this._dh-=a._r*a._r,this._dj-=a._r,a._r+=a._p*e>0?.45*e:.15*e,a._r>this._dq?a._r=this._dq:a._r<.1&&(a._r=.1),this._dj+=a._r,this._dh+=a._r*a._r,a._p=e}},aa:function(a,b,c){if(c>0){var d=a._r/c,e=b._a*d,f=b._c*d,g=b._b*d;a._k+=e,a._h+=f,a._g+=g,this._du._a+=e,this._du._c+=f,this._du._b+=g,a._a=c,a._o=b._a,a._l=b._c,a._i=b._b}},r:function(){for(var a=this._d2.length-1;a>=0;a--){var b=this._d2[a];this._d5.s2(b._b,b._k,b._h)}}});var tf=function(a,b,c,d){this._e=a,this._f=b,this._a=c,this._b=d,this._c={}};Hb.ext(tf,Object,{resetGroup:function(){if(this._a&&null==this._b)for(var a in this._c){var b=this._c[a];b.group.setExpanded(this._e.isExpandGroup()?!0:b.b)}},process:function(){for(var a=new md,b=0,c=this._f.size();c>b;b++){var d=this._f.get(b);if(d instanceof Gb.Link)d.isLooped()||a.add(d);else{if(null==this._b&&d.getParent()instanceof Nd)continue;(null==this._b||null!=this._b&&this._b!==d)&&a.add(d),null==this._b&&d instanceof Nd&&this.layoutGroup(d)}}return a},layoutGroup:function(a){if(this._a&&null==this._c[a.getId()]&&null==this._b){this._c[a.getId()]={group:a,b:a.isExpanded()};var b=this._e.getGroupLayoutType(a);if(b){a.setExpanded(!0);for(var c,d=new md,e=a.getChildren(),f=0,g=e.size();g>f;f++)if(c=e.get(f),c instanceof Nd&&(this.layoutGroup(c),c.setExpanded(!1)),c instanceof Gb.Link||d.contains(c)||d.add(c),c instanceof Ld){var h=c.getLinks();if(null!=h)for(var i=0,j=h.size();j>i;i++){var k=h.get(i);d.contains(k)||d.add(k)}}var l=new nf(this._e,d,b,this._a,this._b);try{var m=null;if("round"===b?m=new df:"symmetry"===b?m=new sf:"hierarchic"===b?m=new Cf:("topbottom"===b||"bottomtop"===b||"rightleft"===b||"leftright"===b)&&(m=new Re),null!=m){m.i2(l);var n=tf.createMatrix(b),o={},p={};for(var q in l._a){var r=l._a[q],s=r.node,t=l.g4(r);if(o[q]=s.getCenterLocation(),null!=n){var u=n.transform(t);s.setCenterLocation(u.x,u.y)}else s.setCenterLocation(t.x,t.y);p[q]=s.getCenterLocation()}}}catch(v){}for(e=a.getChildren(),f=0,g=e.size();g>f;f++)c=e.get(f),c instanceof Nd&&c.setExpanded(!0)}}}}),tf.createMatrix=function(a){return"rightleft"===a?Rb.createMatrix(Math.PI/2,0,0):"leftright"===a?Rb.createMatrix(-Math.PI/2,0,0):"bottomtop"===a?Rb.createMatrix(Math.PI,0,0):null};var uf=function(){};Hb.ext(uf,Object,{i1:function(a,b,c){var d=this.a1(a,b);return this.a2(a,b,c),d},a1:function(a,b){var c=uf.i4(a);c.ax();for(var d=0,e=c.x1();e.i1();e.i2())b.i7(e.i9(),-1);for(var f=c.x1();f.i1();f.i2()){for(var g=f.i9(),h=-1,i=g.aq();i.i1();i.i2())h=Math.max(h,b.i2(i.i9()));b.i7(g,h+1),d=Math.max(d,h+1)}return d+1},a2:function(a,b,c){c.az(uf.i3(a,b))}}),uf.i3=function(a,b){for(var c=new re,d=a.xf();d.i1();d.i2()){var e=d.i8();b.i2(e.a2())>b.i2(e.a3())&&(a.x3(e),c.ac(e))}return c},uf.i4=function(a){var b=Hf.a(a.xa());return(new ie).a1(a,b),uf.i2(a,b)},uf.i2=function(a,b){for(var c=Hf.d(a.x0()),d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[b[f]]=e}return new Je(c)};var vf=function(){vf.superClass.constructor.call(this),this.c0()};Hb.ext(vf,re,{c0:function(){this._bc=1,this._bd=0}});var wf=function(){this._m1=20,this._m2=60,this._m3=5,this._m4=0};Hb.ext(wf,Object,{i4:function(a){this._m3=a},i5:function(a){this._m4=a},i3:function(a){this._m1=a},i6:function(a){this._m2=a},i2:function(a){this._m5=a},t1:function(){return this._m2},a1:function(a,b){for(var c=Hf.d(b.length),d=0;d<b.length;d++)c[d]=b[d].x1();this.a2(a,c)},a2:function(a,b){for(var c=Hf.a(b.length),d=0,e=0;e<b.length;e++){var f=0,g=b[e];for(g.i4();g.i1();g.i2())f=Math.max(f,a.g9(g.i9()));for(c[e]=f,g.i4();g.i1();g.i2()){var h=(c[e]-a.g9(g.i9()))/2;a.s4(g.i9(),new Sd(a.gi(g.i9()),d+h))}var i=this.t1();d+=c[e]+i,g.i4()}},i1:function(a,b,c){this._m6=a,this.t2(b,c)}});var xf=function(a,b){xf.superClass.constructor.call(this)};Hb.ext(xf,wf,{t2:function(a,b){var c=this._m6;this._a=c.xc("D"),this._h=c.xc("C"),this.a1(c,a),this.tg(c,a),this.tf(a,Ne.a5(this._e),this._m5,this._l),this.tb(c,this._f[0]),this.ta(a),this.th(c,this._f[0],a),this.b(a),this.tb(c,this._f[1]),this.ta(a),this.th(c,this._f[1],a),this.b(a),this.a11(this._f[1]),this.a12(a),this.tb(c,this._f[2]),this.ta(a),this.th(c,this._f[2],a),this.b(a),this.tb(c,this._f[3]),this.ta(a),this.th(c,this._f[3],a),this.b(a),this.a11(this._f[3]),this.a12(a),this.tc(c),this.tj()},a11:function(a){for(var b=0;b<a.length;b++)a[b]=-a[b]},b:function(a){for(var b=0;b<a.length;b++){var c=a[b];c.ax()}for(var d=0;d<a.length;d++)for(var e=0,f=null,g=a[d].x1();g.i1();g.i2()){var h=g.i9(),i=h.al();this._l[i]=e++,this._b[i]=f,this._k[i]=null,null!=f&&(this._k[f.al()]=h),f=h}var j=this._a;this._a=this._h,this._h=j;for(var k=this._m6.xf();k.i1();k.i2()){var l=k.i8(),m=this._m6.gn(l);this._m6.gt(l,new Sd(-m.x,m.y));var n=this._m6.gk(l);this._m6.gz(l,new Sd(-n.x,n.y))}var o=this._l,p=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:o[a.a2().al()]-o[b.a2().al()]},q=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:o[a.a3().al()]-o[b.a3().al()]};this._m6.x2(p,q)},a12:function(a){for(var b=this._m6.xf();b.i1();b.i2()){var c=b.i8();this._m6.x3(c);var d=this._m6.gn(c),e=this._m6.gk(c);this._m6.gz(c,d),this._m6.gt(c,e)}for(var f=new qe,g=0;g<a.length;g++)f.ae(a[g]);for(var h=0;h<a.length;h++)a[h]=f.au();var i=this._l,j=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:i[a.a2().al()]-i[b.a2().al()]},k=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:i[a.a3().al()]-i[b.a3().al()]};this._m6.x2(j,k)},tg:function(a,b){var c=a.x0(),d=a.xg();this._l=Hf.a(c),this._b=Hf.d(c),this._k=Hf.d(c),this._m=Hf.d(c),this._i=Hf.d(c),this._o=Hf.d(c),this._f=Hf.e(4,c),this._c=Hf.a(c),this._g=Hf.a(c),this._j=Hf.a(c),this._d=Hf.b(c),this._e=Hf.b(d);for(var e=0;e<b.length;e++)for(var f=0,g=null,h=b[e].x1();h.i1();h.i2()){var i=h.i9(),j=i.al();this._l[j]=f++,this._b[j]=g,this._k[j]=null,null!=g&&(this._k[g.al()]=i),g=i}var k=this._l,l=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:k[a.a2().al()]-k[b.a2().al()]},m=function(a,b){return null==a&&null!=b?1:null!=a&&null==b?-1:null==a&&null==b?0:k[a.a3().al()]-k[b.a3().al()]};a.x2(l,m)},tb:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=d.al();this._m[e]=d,this._i[e]=d,b[e]=Number.MAX_VALUE,this._o[e]=d,this._c[e]=Number.MAX_VALUE,this._d[e]=!1,this._j[e]=this._g[e]=0}},ta:function(a){for(var b=1;b<a.length;b++)for(var c=-1,d=a[b]._b;null!=d;d=d.a()){var e=d.d(),f=e.al(),g=e.ak();if(0!==g){var h,i=Math.floor((g+1)/2),j=Math.ceil((g+1)/2),k=1;for(h=e.ae();i>k;h=h.a7())k++;for(var l=!1;j>=k&&!l;k++){var m=this._m6.g2(h),n=h.a2(),o=n.al();this._i[f]===e&&!this._e[h.a5()]&&c<this._l[o]&&(c=this._l[o],this._i[o]=e,this._m[f]=this._m[o],this._i[f]=this._m[f],l=!0,this._j[o]=m.i6().x,this._g[f]=m.i7().x),h=h.a7()}}}},th:function(a,b,c){for(var d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();this._m[f]===e&&this.td(a,e,b)}for(var g=0;g<c.length;g++){var h=c[g].x1();if(h.i1()){var i=c[g].x1().i9(),j=i.al();this._o[this._m[j].al()]===i&&this.tk(a,i,b)}}for(var k=a.x9();k.i1();k.i2()){var l=k.i9(),m=l.al(),n=this._c[this._o[this._m[m].al()].al()];n<Number.MAX_VALUE&&(b[m]+=n)}},td:function(a,b,c){var d=b.al();if(c[d]===Number.MAX_VALUE){c[d]=0;var e=b,f=0;do{var g=e.al();if(g!==d&&(f-=this._g[g]),this._l[g]>0){var h=this._b[g],i=this._m[this._b[g].al()],j=i.al();this.td(a,i,c),this._o[d]===b&&(this._o[d]=this._o[j]),this._o[d]===this._o[j]&&(c[d]=Math.max(c[d],c[h.al()]+this.ti(a,h,e)-f))}f+=this._j[g],e=this._i[g]}while(e!==b);f=0,e=b;do{var k=e.al();k!==d&&(f-=this._g[k]),c[k]=c[d]+f,f+=this._j[k],e=this._i[k]}while(e!==b)}},tk:function(a,b,c){var d=b.al();if(!this._d[d]){this._d[d]=!0;var e=b;do{var f=e.al(),g=this._k[f];if(null!=g){var h=g.al(),i=this._o[this._m[h].al()];if(i!==this._o[d]){var j=c[h]-c[d]-this.ti(a,e,g);this._c[i.al()]!==Number.MAX_VALUE&&(j+=this._c[i.al()]),this._c[this._o[d].al()]=Math.min(this._c[this._o[d].al()],j)}else this.tk(a,this._m[h],c)}e=this._i[f]}while(e!==b)}},tc:function(a){for(var b=Hf.a(4),c=Hf.a(4),d=a.x9();d.i1();d.i2()){var e=d.i9(),f=e.al();c[0]+=this._f[0][f],c[1]+=this._f[1][f],c[2]+=this._f[2][f],c[3]+=this._f[3][f]}c[0]/=a.xa(),c[1]/=a.xa(),c[2]/=a.xa(),c[3]/=a.xa();for(var g=a.x9();g.i1();g.i2()){var h=g.i9(),i=h.al(),j=a.g4(h);b[0]=this._f[0][i]-c[0],b[1]=this._f[1][i]-c[1],b[2]=this._f[2][i]-c[2],b[3]=this._f[3][i]-c[3],b.sort(Hf.n);var k=(b[1]+b[2])/2;a.s1(h,new Sd(k,j.y))}},ti:function(a,b,c){var d,e=a.gj(b),f=a.gj(c);return d=e>1&&f>1?this._m1+(e+f)/2:this._m3+(e+f)/2,this._l[b.al()]<this._l[c.al()]?(null!=this._a&&(d+=this._a.i3(c)),null!=this._h&&(d+=this._h.i3(b))):(null!=this._a&&(d+=this._a.i3(b)),null!=this._h&&(d+=this._h.i3(c))),d},tj:function(){this._l=null,this._b=null,this._k=null,this._e=null,this._m=null,this._i=null,this._f=null,this._c=null,this._o=null,this._d=null,this._j=null,this._g=null},tf:function(a,b,c,d){for(var e=a.length,f=2;e-1>f;f++)for(var g=-1,h=0,i=0,j=a[f].x1(),k=a[f].x1();k.i1();k.i2()){var l=k.i9(),m=null,n=!1;if(1===l.ak()&&(m=l.ae().a2(),null!=c.i1(m)&&null!=c.i1(l)&&(n=!0)),i===a[f].ay()-1||n){for(var o=n?d[m.al()]:a[f-1].ay();i>=h;h++){for(var p=j.i9(),q=p.am();q.i1();q.i2()){var r=q.i8(),s=d[r.a2().al()];(g>s||s>o)&&b.i7(q.i8(),!0)}j.i2()}g=o}i++}}});var yf=function(a,b){this._b=20,this._a=b,this._d=a,this._f={}};Hb.ext(yf,Object,{a3:function(a){this._b=a},a4:function(a,b,c,d,e){if(this.a2(a)){var f=this.b2(a);f._o=b,f._m=e,f._n=d,f._f=c}},b2:function(a){var b=this._f[a._id];return null==b&&(b=new zf,this._f[a._id]=b),b},a2:function(a){return null!=this._f[a._id]},c:function(){for(var a=Ne.a1(Hf.a(this._d.xa())),b=Ne.a1(Hf.a(this._d.xa())),c=this._d.x9();c.i1();c.i2()){var d=c.i9();if(this.a2(d)){var e=this.b2(d);a.i6(d,this._b*(e.c()-1)),b.i6(d,this._b*(e.b()-1))}}this._d.x1("D",a),this._d.x1("C",b)},g:function(){this._d.x6("D"),this._d.x6("C")},f:function(){for(var a=this._d.x9();a.i1();a.i2()){var b=a.i9();if(this.a2(b)){var c=this._d.gi(b),d=this._d.gh(b),e=this._d.gj(b),f=this._d.g9(b),g=this.b2(b),h=g._q.ay()+g._b.ay()+g._f,i=g._d.ay()+g._g.ay()+g._o,j=g._i.ay()+g._l.ay()+g._n,k=g._h.ay()+g._k.ay()+g._m,l=this._a.a7(e,h),m=this._a.a7(e,i),n=this._a.a7(f,k),o=this._a.a7(f,j);g.a2(this._a.a8(e,h,l),this._a.a8(e,i,m),this._a.a8(f,k,n),this._a.a8(f,j,o));for(var p=g._j.c1();p.i1();p.i2()){var q=p.i8(),r=this.a1(q),s=this.b1(q),t=new qe;r.b()===s.b()?(r.c()?(t.aa(new Sd(c+g._g._bd*m+g._c,d)),t.aa(new Sd(c+g._g._bd*m+g._c,d-this._b)),g._g._bd++,t.aa(new Sd(c+g._g._bd*m+g._c,d-this._b)),t.aa(new Sd(c+g._g._bd*m+g._c,d)),g._g._bd++,g._g._bc=Math.max(g._g._bc,2)):r.d()?(t.aa(new Sd(c+g._b._bd*l+g._p,d+f)),t.aa(new Sd(c+g._b._bd*l+g._p,d+f+this._b)),g._b._bd++,t.aa(new Sd(c+g._b._bd*l+g._p,d+f+this._b)),t.aa(new Sd(c+g._b._bd*l+g._p,d+f)),g._b._bd++,g._b._bc=Math.max(g._b._bc,2)):r.f()?(t.aa(new Sd(c,d+g._i._bd*o+g._a)),t.aa(new Sd(c-this._b,d+g._i._bd*o+g._a)),g._i._bd++,t.aa(new Sd(c-this._b,d+g._i._bd*o+g._a)),t.aa(new Sd(c,d+g._i._bd*o+g._a)),g._i._bd++,g._i._bc=Math.max(g._i._bc,2)):r.e()&&(t.aa(new Sd(c+e,d+g._h._bd*n+g._e)),t.aa(new Sd(c+e+this._b,d+g._h._bd*n+g._e)),g._h._bd++,t.aa(new Sd(c+e+this._b,d+g._h._bd*n+g._e)),t.aa(new Sd(c+e,d+g._h._bd*n+g._e)),g._h._bd++,g._h._bc=Math.max(g._h._bc,2)),this._d.m1(q,t)):r.c()||s.c()?r.e()||s.e()?(t.aa(new Sd(c+e-g._d._bd*m-g._c,d)),t.aa(new Sd(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g._h._bc,d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g._h._bc,d+g._h._bd*n+g._e)),t.aa(new Sd(c+e,d+g._h._bd*n+g._e)),g._d._bd++,g._d._bc++,g._h._bd++,g._h._bc++,s.c()&&t.ax(),this._d.m1(q,t)):r.f()||s.f()?(t.aa(new Sd(c+g._g._bd*m+g._c,d)),t.aa(new Sd(c+g._g._bd*m+g._c,d-this._b*g._g._bc)),t.aa(new Sd(c-this._b*g._i._bc,d-this._b*g._g._bc)),t.aa(new Sd(c-this._b*g._i._bc,d+g._i._bd*o+g._a)),t.aa(new Sd(c,d+g._i._bd*o+g._a)),g._g._bd++,g._g._bc++,g._i._bd++,g._i._bc++,s.c()&&t.ax(),this._d.m1(q,t)):(r.d()||s.d())&&(t.aa(new Sd(c+e-g._d._bd*m-g._c,d)),t.aa(new Sd(c+e-g._d._bd*m-g._c,d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g.b(),d-this._b*g._d._bc)),t.aa(new Sd(c+e+this._b*g.b(),d+f+this._b*g._q._bc)),t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f)),g._d._bd++,g._d._bc++,g._k._bc++,g._h._bc++,g._q._bc++,g._q._bd++,s.c()&&t.ax(),this._d.m1(q,t)):r.d()||s.d()?r.e()||s.e()?(t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f)),t.aa(new Sd(c+e-g._q._bd*l-g._p,d+f+this._b*g._q._bc)),t.aa(new Sd(c+e+this._b*g._k._bc,d+f+this._b*g._q._bc)),t.aa(new Sd(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new Sd(c+e,d+f-g._k._bd*n-g._e)),g._q._bd++,g._q._bc++,g._k._bd++,g._k._bc++,s.d()&&t.ax(),this._d.m1(q,t)):(r.f()||s.f())&&(t.aa(new Sd(c+g._b._bd*l+g._p,d+f)),t.aa(new Sd(c+g._b._bd*l+g._p,d+f+this._b*g._b._bc)),t.aa(new Sd(c-this._b*g._l._bc,d+f+this._b*g._b._bc)),t.aa(new Sd(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new Sd(c,d+f-g._l._bd*o-g._a)),g._b._bd++,g._b._bc++,g._l._bd++,g._l._bc++,s.d()&&t.ax(),this._d.m1(q,t)):(t.aa(new Sd(c,d+f-g._l._bd*o-g._a)),t.aa(new Sd(c-this._b*g._l._bc,d+f-g._l._bd*o-g._a)),t.aa(new Sd(c-this._b*g._l._bc,d+f+this._b*g.a1())),t.aa(new Sd(c+e+this._b*g._k._bc,d+f+this._b*g.a1())),t.aa(new Sd(c+e+this._b*g._k._bc,d+f-g._k._bd*n-g._e)),t.aa(new Sd(c+e,d+f-g._k._bd*n-g._e)),g._l._bd++,g._l._bc++,g._b._bc++,g._q._bc++,g._k._bc++,g._k._bd++,s.f()&&t.ax(),this._d.m1(q,t))}}}},a5:function(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=b[c],f=d.x1();f.i1();f.i2()){var g=f.i9();if(this.a2(g)){var h=this.b2(g);e._g=Math.max(e._g,this._b*(h.d()-1)),e._j=Math.max(e._j,this._b*(h.a1()-1))}}},a1:function(a){var b=this._d.xc("A"),c=null;if(null!=b&&(c=b.i1(a)),null==c||c.g()){var d=this._d.xc("B");if(null==d)return pf.j(1);var e=d.i1(a);if(null==e||e.g())return pf.j(1);if(e.c())return pf.j(8);if(e.f())return pf.j(1);if(e.d())return pf.j(4);if(e.e())return pf.j(2)}return c},b1:function(a){var b=this._d.xc("B"),c=null;if(null!=b&&(c=b.i1(a)),null==c||c.g()){var d=this._d.xc("A");if(null==d)return pf.j(8);var e=d.i1(a);if(null==e||e.g())return pf.j(8);if(e.c())return pf.j(8);if(e.f())return pf.j(1);if(e.d())return pf.j(4);if(e.e())return pf.j(2)}return c}});var zf=function(){this._o=0,this._f=0,this._n=0,this._m=0,this._c=0,this._p=0,this._e=0,this._a=0,this._j=new re,this._g=new vf,this._d=new vf,this._b=new vf,this._q=new vf,this._h=new vf,this._k=new vf,this._i=new vf,this._l=new vf};Hb.ext(zf,Object,{a1:function(){return Math.max(this._q._bc,this._b._bc)},d:function(){return Math.max(this._d._bc,this._g._bc)},b:function(){return Math.max(this._k._bc,this._h._bc)},c:function(){return Math.max(this._l._bc,this._i._bc)},a2:function(a,b,c,d){this._c=b,this._a=d,this._p=a,this._e=c,this._g.c0(),this._d.c0(),this._b.c0(),this._q.c0(),this._k.c0(),this._h.c0(),this._l.c0(),this._i.c0()}});var Af=function(a,b,c,d){this._k=20,this._r=.5,this._d=a,this._c=b,this._j=c,this._m=d,this._i=null!=a.xc("A")||null!=a.xc("B"),this._t=new Df(a,b,c,d),this._b=new yf(a,this)};Hb.ext(Af,Object,{a6:function(a){this._k=a,this._t.a1(a),this._b.a3(a)},g1:function(){return this._k},a9:function(a){return this.c1(),a},a5:function(a){return this.a1(),a},b3:function(a){return this.c1(),a=this.c4(a),this._b.c(),a},g2:function(a){return this._b.g(),a},e2:function(a){a=this.f(a),this._b.f()},e1:function(){this._t.d(),null!=this._n&&this._d.xi(this._n),this.a1(),this._d=null},a1:function(){this._i&&(null!=this._q&&(this._d.x1("A",this._q),this._q=null),null!=this._p&&(this._d.x1("B",this._p),this._p=null),null!=this._h&&(this._d.xj(this._h),this._h=null),null!=this._l&&(this._d.xj(this._l),this._l=null))},c1:function(){if(this._i){null==this._h&&(this._h=this._d.xl()),null==this._l&&(this._l=this._d.xl());for(var a=this._d.xf();a.i1();a.i2()){var b=a.i8(),c=null!=this._j.i1(b.a2()),d=null!=this._j.i1(b.a3());if(c&&!d){var e=this._j.i1(b.a2());this._m.i4(e)?this._l.i8(b,pf.h(this._d,e)):this._l.i8(b,pf.i(this._d,e))}else if(!c&&d){var f=this._j.i1(b.a3());this._m.i4(f)?this._h.i8(b,pf.i(this._d,f)):this._h.i8(b,pf.h(this._d,f))}else c||d||(this._m.i4(b)?(this._h.i8(b,pf.i(this._d,b)),this._l.i8(b,pf.h(this._d,b))):(this._h.i8(b,pf.h(this._d,b)),this._l.i8(b,pf.i(this._d,b))))}this._q=this._d.xc("A"),this._p=this._d.xc("B"),this._d.x1("A",this._h),this._d.x1("B",this._l)}},c4:function(a){this._n=this._d.xk(),this._a=this._d.xl(),this._g=this._d.xl();for(var b=new re,c=new re,d=new re,e=new re,f=new re,g=new re,h=new re,i=new re,j=new re,k=this._d.xk(),l=0;l<a.length;l++)for(var m=0,n=a[l].x1();n.i1();)k.i6(n.i9(),m),n.i2(),m++;for(var o=function(a,b){var c=k.i3(a.a3())-k.i3(b.a3());return 0>=c?c>=0?0:-1:1},p=function(a,b){var c=k.i3(a.a2())-k.i3(b.a2());return 0>=c?c>=0?0:-1:1},q=0;q<a.length;q++)for(var r=a[q],s=r._b;null!=s;s=s.a()){var t=s.d();t.av(o),t.au(p);var u=0;b.af(),c.af(),d.af(),e.af(),f.af(),g.af(),h.af(),i.af(),j.af();for(var v=t.ap();v.i1();){var w=v.i8(),x=this.b1(w);null==x||x.d()||x.g()?d.aa(w):x.e()?b.aa(w):x.f()?(c.aa(w),j.aa(w)):x.c()&&(i.aa(w),j.aa(w)),v.i2(),u++}u=0;for(var y=t.am();y.i1();){var z=y.i8(),A=this.a2(z);null==A||A.c()||A.g()?e.aa(z):A.e()?b.aa(z):A.f()?(c.aa(z),j.aa(z)):A.d()&&(g.aa(z),j.aa(z)),y.i2(),u++}var B=k.i3(t);if(!j.ar())for(var C=.1/j.ay(),D=B-.4;!j.ar();D+=C){var E=j.c3();if(E.a2()===t){var F=this._d.xm();this._n.z1(F,E.a2()),this._d.s7(F,1,1),this._c.z1(F,this._c.i1(t)),k.i6(F,D),this._a.i8(E,this._d.gn(E)),this._d.gt(E,ff._A),this._d.xr(E,F,E.a3()),r.ao(F,s)}else{var G=this._d.xm();this._n.z1(G,E.a3()),this._d.s7(G,1,1),this._c.z1(G,this._c.i1(t)),k.i6(G,D),this._g.i8(E,this._d.gk(E)),this._d.gz(E,ff._A),this._d.xr(E,E.a2(),G),r.ao(G,s)}}if(!b.ar())for(var H=.1/b.ay(),I=B+.1;!b.ar();I+=H){var J=b.c3();if(J.a2()===t){var K=this._d.xm();this._n.z1(K,J.a2()),this._d.s7(K,1,1),this._c.z1(K,this._c.i1(t)),k.i6(K,I),this._a.i8(J,this._d.gn(J)),this._d.gt(J,ff._A),this._d.xr(J,K,J.a3()),s=r.an(K,s)}else{var L=this._d.xm();this._n.z1(L,J.a3()),this._d.s7(L,1,1),this._c.z1(L,this._c.i1(t)),k.i6(L,I),this._g.i8(J,this._d.gk(J)),this._d.gz(J,ff._A),this._d.xr(J,J.a2(),L),s=r.an(L,s)}}var M=Af._z;this._b.a2(t)&&(M=this._b.b2(t));var N=M._b.ay()+g.ay()+t.ao()+f.ay()+M._q.ay();if(N>0)for(var O=this._d.g9(t)/2,P=this._d.gj(t),Q=this.a7(P,N),R=-.5*P+this.a8(this._d.gj(t),N,Q)+Q*(M._b.ay()+g.ay()),S=t.ap();S.i1();S.i2()){var T=S.i8();this.c2(T)||null!=this._j.i1(T.a2())||(this._d.g2(T).i8(new Sd(R,O)),R+=Q)}var U=this._t.a3(t),V=0,W=0,X=0,Y=0;if(null!=U&&(V=U._e.ay(),W=U._c.ay(),X=U._b.ay(),Y=U._d.ay()),N=M._g.ay()+V+i.ay()+t.ak()+h.ay()+W+M._d.ay(),N>0){for(var Z=this._d.gj(t),$=this.a7(Z,N),_=this.a8(Z,N,$),aa=-.5*Z+_+$*(M._g.ay()+V+i.ay()),ba=-this._d.g9(t)/2,ca=t.am();ca.i1();ca.i2()){var da=ca.i8();this.d1(da)||null!=this._j.i1(da.a3())||(this._d.g2(da).i9(new Sd(aa,ba)),aa+=$)}if(null!=U){for(var ea=-.5*Z+_+$*(M._g.ay()+i.ay()+U._e.ay()-1),fa=U._e.c1();fa.i1();fa.i2()){var ga=fa.i8();this._d.u1(ga),ga.a2()!==t||this.c2(ga)?this.d1(ga)||(this._d.g2(fa.i8()).i9(new Sd(ea,ba)),ea-=$):(this._d.g2(fa.i8()).i8(new Sd(ea,ba)),ea-=$),this._d.h1(ga)}ea=.5*Z-_-$*(M._d.ay()+h.ay());for(var ha=U._c.c1();ha.i1();ha.i2()){var ia=ha.i8();this._d.u1(ia),ia.a2()!==t||this.c2(ia)?this.d1(ia)||(this._d.g2(ha.i8()).i9(new Sd(ea,ba)),ea-=$):(this._d.g2(ha.i8()).i8(new Sd(ea,ba)),ea-=$),this._d.h1(ia)}}}this._b.a2(t)&&this._b.a4(t,V+i.ay()+t.ak()+h.ay()+W,g.ay()+t.ao()+f.ay(),X+c.ay(),Y+b.ay())}return this._d.xi(k),a},a7:function(a,b){return 1>=b?0:a/(b-1+2*this._r)},a8:function(a,b,c){return 1>=b?.5*a:.5*(a-c*(b-1))},f:function(a){var b=this.g1();this._f=this._d.xk();for(var c=0;c<a.length;c++)for(var d=a[c],e=d._b;null!=e;){var f=e.d(),g=this._n.i1(f);if(null!=g||this._t.b2(f))e=e.a();else{var h=new Je,i=new Je,j=new Je,k=new Je,l=new Je,m=new Je,n=new re,o=new re,p=new Gf(h,i,j,k,l,m,n,o);this._f.z1(f,p),n.ab(f.am()),o.ab(f.ap());for(var q=e.b();null!=q&&this._n.i1(q.d())===f;q=q.b()){var r=q.d(),s=this.c3(r);s.f()?i.ac(r):s.c()?k.ac(r):s.d()&&m.ac(r)}var t;for(t=e.a();null!=t&&this._n.i1(t.d())===f;t=t.a()){var u=t.d(),v=this.c3(u);v.e()?h.aa(u):v.c()?j.aa(u):v.d()&&l.aa(u)}e=t}}for(var w=this.d2(a),x=0,y=0;y<a.length;y++){var z=w[y];y>0&&(x+=w[y-1]._j+w[y-1]._h+w[y-1]._b),x+=z._g+z._f+z._a+z._d;for(var A=a[y].x1();A.i1();A.i2()){var B=A.i9();this._d.s3(B,this._d.gi(B),this._d.gh(B)+x)}z._c+=x,z._i+=x}for(var C=0;C<a.length;C++)for(var D=a[C],E=D.x1();E.i1();E.i2()){var F=E.i9();null!=this._n.i1(F)&&D.av(E)}for(var G=this,H=function(a,b){return G.a3(a)?G.a3(b)&&G._d.gi(a)>=G._d.gi(b)?-1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?1:-1},I=function(a,b){return G.a3(a)?G.a3(b)?G._d.gi(a)>=G._d.gi(b)?1:-1:1:G.a3(b)?-1:G._d.gi(a)>=G._d.gi(b)?-1:1},J=0;J<a.length;J++)for(var K=w[J],L=a[J].x1();L.i1();L.i2()){var M=L.i9();if(!this._t.b2(M)){var N=this._f.i1(M),O=N._d,P=N._a,Q=N._b,R=N._h,S=N._f,T=N._c,U=N._g,V=N._e,W=0,X=0,Y=0,Z=0,$=M.ao(),_=M.ak(),aa=this._d.gi(M),ba=this._d.gh(M),ca=this._d.gj(M),da=this._d.g9(M),ea=this._t.a3(M),fa=Af._z;if(this._b.a2(M)&&(fa=this._b.b2(M)),null!=ea){if(W=ea._d.ay(),X=ea._b.ay(),Y=ea._e.ay(),Z=ea._c.ay(),W>0)for(var ga=fa._h.ay()+O.ay()+W+fa._k.ay(),ha=this.a7(da,ga),ia=this.a8(da,ga,ha),ja=ba+ia+ha*(fa._h.ay()+this.a4(O)),ka=ea._d.c1();ka.i1();ka.i2()){var la=ka.i8();this._d.u1(la),la.a2()===M?this.c2(la)||this._d.gx(la,new Sd(aa+ca,ja)):(this.d1(la),this._d.gy(la,new Sd(aa+ca,ja))),ja+=ha,this._d.h1(la)}if(X>0)for(var ma=fa._i.ay()+P.ay()+X+fa._l.ay(),na=this.a7(da,ma),oa=this.a8(da,ma,na),pa=ba+oa+na*(fa._i.ay()+this.a4(P)),qa=ea._b.c1();qa.i1();qa.i2()){var ra=qa.i8();this._d.u1(ra),ra.a2()===M?this.c2(ra)||this._d.gx(ra,new Sd(aa,pa)):this.d1(ra)||this._d.gy(ra,new Sd(aa,pa)),pa+=na,this._d.h1(ra)}}if(O.ay()>0){O.a1(H);for(var sa=fa._h.ay()+O.ay()+W+fa._k.ay(),ta=this.a7(da,sa),ua=this.a8(da,sa,ta),va=ba+ua+ta*fa._h.ay(),wa=!0;!O.ar();){var xa=O.x4();if(this.a3(xa)){wa&&(wa=!1,va+=ta*W);var ya=xa.ag(),za=this._d.gd(ya),Aa=za.at();if(za.ac(new Sd(Aa.x,K.b())),this.c2(ya)){var Ba=this._a.i1(ya);za.ac(new Sd(Aa.x,Ba.y+this._d.g6(M))),
za.ac(new Sd(Ba.x+this._d.g5(M),Ba.y+this._d.g6(M)))}else za.ac(new Sd(Aa.x,va)),za.ac(new Sd(aa+ca,va));this._d.xr(ya,M,ya.a3()),this._d.m1(ya,za)}else{var Ca=xa.ae(),Da=this._d.gd(Ca),Ea=Da.au();if(Da.ae(new Sd(Ea.x,K.a())),this.d1(Ca)){var Fa=this._g.i1(Ca);Da.ae(new Sd(Ea.x,Fa.y+this._d.g6(M))),Da.ae(new Sd(Fa.x+this._d.g5(M),Fa.y+this._d.g6(M)))}else Da.ae(new Sd(Ea.x,va)),Da.ae(new Sd(aa+ca,va));this._d.xr(Ca,Ca.a2(),M),this._d.m1(Ca,Da)}this._d.x4(xa),va+=ta}}if(P.ay()>0){P.a1(I);for(var Ga=fa._i.ay()+P.ay()+X+fa._l.ay(),Ha=this.a7(da,Ga),Ia=this.a8(da,Ga,Ha),Ja=ba+Ia+Ha*fa._i.ay(),Ka=!0;!P.ar();){var La=P.x4();if(this.a3(La)){Ka&&(Ka=!1,Ja+=Ha*X);var Ma=La.ag(),Na=this._d.gd(Ma),Oa=Na.at();if(Na.ac(new Sd(Oa.x,K.b())),this.c2(Ma)){var Pa=this._a.i1(Ma);Na.ac(new Sd(Oa.x,Pa.y+this._d.g6(M))),Na.ac(new Sd(Pa.x+this._d.g5(M),Pa.y+this._d.g6(M)))}else Na.ac(new Sd(Oa.x,Ja)),Na.ac(new Sd(aa,Ja));this._d.xr(Ma,M,Ma.a3()),this._d.m1(Ma,Na)}else{var Qa=La.ae(),Ra=this._d.gd(Qa),Sa=Ra.au();if(Ra.ae(new Sd(Sa.x,K.a())),this.d1(Qa)){var Ta=this._g.i1(Qa);Ra.ae(new Sd(Sa.x,Ta.y+this._d.g6(M))),Ra.ae(new Sd(Ta.x+this._d.g5(M),Ta.y+this._d.g6(M)))}else Ra.ae(new Sd(Sa.x,Ja)),Ra.ae(new Sd(aa,Ja));this._d.xr(Qa,Qa.a2(),M),this._d.m1(Qa,Ra)}this._d.x4(La),Ja+=Ha}}var Ua=fa._g.ay()+fa._d.ay()+_+R.ay()+Q.ay()+Y+Z;ca=this._d.gj(M);var Va=this.a7(ca,Ua),Wa=this.a8(ca,Ua,Va);Ua=fa._b.ay()+fa._q.ay()+$+T.ay()+S.ay();var Xa=this.a7(ca,Ua),Ya=this.a8(ca,Ua,Xa);if(R.ay()>0)for(var Za,$a=Va,_a=b,ab=this._d.gi(M)+Wa+$a*(fa._g.ay()+R.ay()-1),bb=this._d.gh(M),cb=K._c-K._g-R.ay()*_a;!R.ar();this._d.x4(Za)){Za=R.x4();var db=Za.ag(),eb=this._d.gd(db),fb=eb.at();if(eb.ac(new Sd(fb.x,K.b())),eb.ac(new Sd(fb.x,cb)),this.c2(db)){var gb=this._a.i1(db);eb.ac(new Sd(gb.x+this._d.g5(M),cb)),eb.ac(new Sd(gb.x+this._d.g5(M),gb.y+this._d.g6(M)))}else eb.ac(new Sd(ab,cb)),eb.ac(new Sd(ab,bb)),ab-=$a;cb+=_a,this._d.xr(db,M,db.a3()),this._d.m1(db,eb)}if(Q.ay()>0)for(var hb,ib=Va,jb=b,kb=this._d.gi(M)+this._d.gj(M)-Wa-ib*fa._d.ay(),lb=this._d.gh(M),mb=K._c-K._g-jb;!Q.ar();this._d.x4(hb)){hb=Q.x4();var nb=hb.ag(),ob=this._d.gd(nb),pb=ob.at();if(ob.ac(new Sd(pb.x,K.b())),ob.ac(new Sd(pb.x,mb)),this.c2(nb)){var qb=this._a.i1(nb);ob.ac(new Sd(qb.x+this._d.g5(M),mb)),ob.ac(new Sd(qb.x+this._d.g5(M),qb.y+this._d.g6(M)))}else ob.ac(new Sd(kb,mb)),ob.ac(new Sd(kb,lb)),kb-=ib;mb-=jb,this._d.xr(nb,M,nb.a3()),this._d.m1(nb,ob)}if(T.ay()>0)for(var rb,sb=Xa,tb=b,ub=this._d.gi(M)+Ya+sb*(fa._b.ay()+T.ay()-1),vb=this._d.gh(M)+this._d.g9(M),wb=vb+T.ay()*tb;!T.ar();this._d.x4(rb)){rb=T.x4();var xb=rb.ae(),yb=this._d.gd(xb),zb=yb.au();if(yb.ae(new Sd(zb.x,K.a())),yb.ae(new Sd(zb.x,wb)),this.d1(xb)){var Ab=this._g.i1(xb);yb.ae(new Sd(Ab.x+this._d.g5(M),wb)),yb.ae(new Sd(Ab.x+this._d.g5(M),Ab.y+this._d.g6(M)))}else yb.ae(new Sd(ub,wb)),yb.ae(new Sd(ub,vb)),ub-=sb;wb-=tb,this._d.xr(xb,xb.a2(),M),this._d.m1(xb,yb)}if(S.ay()>0)for(var Bb,Cb=Xa,Db=b,Eb=this._d.gi(M)+this._d.gj(M)-Ya-Xa*fa._q.ay(),Fb=this._d.gh(M)+this._d.g9(M),Gb=Fb+Db;!S.ar();this._d.x4(Bb)){Bb=S.x4();var Hb=Bb.ae(),Ib=this._d.gd(Hb),Jb=Ib.au();if(Ib.ae(new Sd(Jb.x,K.a())),Ib.ae(new Sd(Jb.x,Gb)),this.d1(Hb)){var Kb=this._g.i1(Hb);Ib.ae(new Sd(Kb.x+this._d.g5(M),Gb)),Ib.ae(new Sd(Kb.x+this._d.g5(M),Kb.y+this._d.g6(M)))}else Ib.ae(new Sd(Eb,Gb)),Ib.ae(new Sd(Eb,Fb)),Eb-=Cb;Gb+=Db,this._d.xr(Hb,Hb.a2(),M),this._d.m1(Hb,Ib)}for(;!V.ar();){var Lb=V.c3(),Mb=this._d.gl(Lb);K.a()+12<Mb.y&&this._d.g7(Lb).i4(Mb.x,K.a())}for(;!U.ar();){var Nb=U.c3(),Ob=this._d.gs(Nb);if(K.b()-12>Ob.y){var Pb=this._d.gf(Nb);Pb.ac(new Sd(Ob.x,K.b())),this._d.s6(Nb,Pb)}}}}for(var Qb=0;Qb<a.length;Qb++)for(var Rb=a[Qb],Sb=Rb._b;null!=Sb;Sb=Sb.a()){var Tb=Sb.d(),Ub=this._t.a3(Tb);null!=Ub&&null!=Ub._a&&(this._d.x4(Ub._a),Rb.aw(Sb.b()))}return this._d.xi(this._f),this._d.xj(this._a),this._d.xj(this._g),a},c3:function(a){return this.a3(a)?this.b1(a.ag()):this.a2(a.ae())},b1:function(a){return null==this._h?Af.s:this._h.i1(a)},a2:function(a){return null==this._l?Af.u:this._l.i1(a)},c2:function(a){if(null==a)return!1;var b=this.b1(a);return null!=b&&b.a()},d1:function(a){if(null==a)return!1;var b=this.a2(a);return null!=b&&b.a()},a3:function(a){return 1===a.ao()},b2:function(a){return 1===a.ak()},a4:function(a){for(var b=0,c=a._b;null!=c;c=c.a())this.b2(c.d())&&b++;return b},d2:function(a){for(var b=this._k,c=Hf.d(a.length+1),d=0;d<a.length;d++){var e=a[d],f=new Ef;c[d]=f,f._c=Number.MAX_VALUE,f._i=Number.MIN_VALUE;for(var g=e.x1();g.i1();g.i2()){var h=g.i9(),i=this._d.gb(h);f._c=Math.min(f._c,i.i2()),f._i=Math.max(f._i,i.i2()+i.i4())}}this._b.a5(a,c);for(var j=0;j<a.length;j++)for(var k=c[j],l=a[j].x1();l.i1();l.i2()){var m=l.i9(),n=this._f.i1(m);null!=n&&(k._h=Math.max(k._h,Math.max(n._f.ay()*b,n._c.ay()*b)),k._f=Math.max(k._f,Math.max(n._b.ay()*b,n._h.ay()*b)))}return c}}),Af.s=pf.j(2),Af.u=pf.j(1),Af._z=new zf;var Bf=function(){this._af=0,this._b=0};Hb.ext(Bf,Object,{ib:function(a){this._af=a},ia:function(a,b,c){this.a6(a,b,c),this.b2(!1);var d=this.g();if(this.o()&&d>0){for(var e=this.r(),f=0;20>f&&d>0&&this.o();f++){this.b2(!0);var g=this.g();d>g&&(this.a7(e),d=g)}this.b3(e),this.b1()}return this.c()},a6:function(a,b,c){this._b=(new Date).getTime(),this._ac=a,this._ah=b;var d=this;this._p=function(a,b){var c=d._n[a.al()]-d._n[b.al()];return c>0?1:c>=0?0:-1},this._ad=Hf.d(c);for(var e=0;e<this._ad.length;e++)this._ad[e]=new Je;this._ab=Hf.a(this._ac.x0()),this._f=Hf.d(this._ac.x0()),this._n=Hf.a(this._ac.x0()+1);var f=this._ab;this._o=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,g=c.a2(),h=d.a2(),i=f[g.al()]-f[h.al()];if(0===i){var j=Bf.b(pf.h(e,c),e.gn(c)),k=Bf.b(pf.h(e,d),e.gn(d)),l=j-k;if(0===l){var m=f[c.a3().al()]-f[d.a3().al()];if(0===m){var n=Bf.a(pf.i(e,c),e.gk(c)),o=Bf.a(pf.i(e,d),e.gk(d));return n-o}return m}return l}return i},this._l=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,g=c.a3(),h=d.a3(),i=f[g.al()]-f[h.al()];if(0===i){var j=Bf.a(pf.i(e,c),e.gk(c)),k=Bf.a(pf.i(e,d),e.gk(d)),l=j-k;if(0===l){var m=f[c.a2().al()]-f[d.a2().al()];if(0===m){var n=Bf.b(pf.h(e,c),e.gn(c)),o=Bf.b(pf.h(e,d),e.gn(d));return n-o}return m}return l}return i},this._z=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,f=Bf.b(pf.h(e,c),e.gn(c)),g=Bf.b(pf.h(e,d),e.gn(d));return f-g},this._e=function(a,b){if(null==a&&null!=b)return 1;if(null!=a&&null==b)return-1;if(null==a&&null==b)return 0;var c=a,d=b,e=c._h,f=Bf.a(pf.i(e,c),e.gk(c)),g=Bf.a(pf.i(e,d),e.gk(d));return f-g},this._ac.x2(this._e,this._z)},c:function(){this._ah=null,this._aa=null,this._f=null,this._n=null,this._p=null,this._o=null,this._l=null,this._ac=null;var a=this._ad;return this._ad=null,a},o:function(){var a=(new Date).getTime()-this._b;return a<=this._af},m:function(){for(var a=this,b=function(b,c){return Math.ceil(a._n[b.a3().al()])-Math.ceil(a._n[c.a3().al()])},c=this._ac.x9();c.i1();c.i2()){for(var d=c.i9().aw();d.i1();d.i2())this._n[d.i9().al()]=ff.j();c.i9().av(b)}},b2:function(a){for(var b=0;b<this._ad.length;b++)this._ad[b].af();if(a){this.m();for(var c=0,d=this._ab.length;d>c;c++)this._ab[c]=0;this._ac.x2(null,this._z)}var e=this._ac.xm();this._ah.i7(e,0);for(var f=this._ac.x9();f.i1();f.i2())0===f.i9().ak()&&f.i9()!==e&&this._ac.xo(e,f.i9());var g=new ee(this);g.a6(!0),g.a9(this._ac,e),this._ad[0].at(),this._ac.x4(e),this.d()},a1:function(){this._ac.x2(this._o,this._l);for(var a=0,b=1;b<this._ad.length;b++){var c=this.a2(this._ad[b-1],this._ad[b]);a+=c}var d=0;return a+=d},a2:function(a,b){var c=a.ah(),d=b.ah(),e=new qe,f=new qe;this._aa=Hf.d(this._ac.x0());for(var g=0;c.i1()&&d.i1();d.i2())g+=this.a8(c.i6(),e,f,!0),g+=this.a8(d.i6(),f,e,!1),c.i2();for(;c.i1();c.i2())g+=this.a8(c.i6(),e,f,!0);for(;d.i1();d.i2())g+=this.a8(d.i6(),f,e,!1);return g},a8:function(a,b,c,d){var e=0,f=0,g=0;if(null!=this._aa[a.al()])for(var h=this._aa[a.al()].a(),i=b._b;i!==h;i=i.a()){var j=i._c;j===a?(e++,g+=f,b.aw(i)):f++}var k=e*c.ay()+g;if(d)for(var l=a.ag();null!=l;l=l.a8()){var m=l.a3();this._ab[m.al()]>=this._ab[a.al()]&&(this._aa[m.al()]=c.ae(m))}else for(var n=a.ae();null!=n;n=n.a7()){var o=n.a2();this._ab[o.al()]>this._ab[a.al()]&&(this._aa[o.al()]=c.ae(o))}return k},g:function(){for(var a=this.r(),b=this.a1(),c=!0,d=0;3>d&&this.o()&&b>0;){var e=this.k();b>e?(this.a7(a),b=e):d++,c=!c}if(this.b3(a),this.b1(),b>0){for(var f=1,g=0;1===f&&b>0;g++){this.e(),this.i();var h=this.a1();b>h?(f=1,this.a7(a)):f=-1,b=h}this.b3(a),this.b1()}return b},e:function(){for(var a=this.l(),b=this.r(),c=Hf.d(this._ac.x0()),d=this._ad.length-1;d>=0;d--)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(1===f.ak()&&1===f.ao()){var g=a.i1(f.ag());if(null!=g&&null==c[g.al()])for(var h=this.a4(f,g),i=g.al(),j=c[i]=Hf.d(h+1),k=j.length-1;k>=0;k--)j[k]=new qe}}for(var l=0;l<this._ad.length;l++)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(1===n.ak()&&1===n.ao()){var o=a.i1(n.ag());if(null!=o){var p=o.al(),q=this.a4(n,o)-1;c[p][q].ae(n.ae())}}else for(var r=n.ae();null!=r;r=r.a7()){var s=a.i1(r);if(null!=s){var t=s.al(),u=this.a4(n,s)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(null!=c[w.al()])for(var x=w.ag();null!=x;x=x.a8()){var y=a.i1(x);if(null!=y)for(var z=c[y.al()];z[0].ay()>0;){for(var A,B=0;;){A=z[B].am();var C=A.a3();if(1!==C.ak()||1!==C.ao())break;B++}var D=z[B].at().a3();B--,D=A.a2(),A=z[B].at();for(var E=A.a3();B>=0;)if(b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ae().a2(),--B>=0){var F=z[B].at();E=F.a3()}}}}this.b1(),this._ac.xj(a)},i:function(){for(var a=this.f(),b=this.r(),c=Hf.d(this._ac.x0()),d=0;d<this._ad.length;d++)for(var e=this._ad[d].ah();e.i1();e.i2()){var f=e.i6();if(1===f.ak()&&1===f.ao()){var g=a.i1(f.ae());if(null!=g&&null==c[g.al()])for(var h=this.a4(g,f),i=g.al(),j=c[i]=Hf.d(h+1),k=j.length-1;k>=0;k--)j[k]=new qe}}for(var l=this._ad.length-1;l>=0;l--)for(var m=this._ad[l].ah();m.i1();m.i2()){var n=m.i6();if(1===n.ak()&&1===n.ao()){var o=a.i1(n.ae());if(null!=o){var p=o.al(),q=this.a4(o,n)-1;c[p][q].ae(n.ag())}}else for(var r=n.ag();null!=r;r=r.a8()){var s=a.i1(r);if(null!=s){var t=s.al(),u=this.a4(s,n)-1;c[t][u].ae(r)}}}for(var v=this._ac.x9();v.i1();v.i2()){var w=v.i9();if(null!=c[w.al()])for(var x=w.ae();null!=x;x=x.a7()){var y=a.i1(x);if(null!=y)for(var z=c[y.al()];z[0].ay()>0;){for(var A,B=0;;){A=z[B].am();var C=A.a2();if(1!==C.ak()||1!==C.ao())break;B++}var D=z[B].at().a2();B--,D=A.a3(),A=z[B].at();for(var E=A.a2();B>=0;)if(b[D.al()]!==b[E.al()]&&(this._ab[D.al()]=b[E.al()]),D=D.ag().a3(),--B>=0){var F=z[B].at();E=F.a2()}}}}this.b1(),this._ac.xj(a)},a4:function(a,b){return this._ah.i2(a)-this._ah.i2(b)},l:function(){for(var a=Ne.a6(Hf.d(this._ac.xg())),b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ao()>1){for(var d=0,e=c.ag();null!=e;e=e.a8()){var f=e.a3();1===f.ak()&&1===f.ao()&&d++}if(d>1)for(var g=c.ag();null!=g;g=g.a8()){var h=g,i=h.a3();if(1===i.ak()&&1===i.ao()){for(;1===i.ak()&&1===i.ao();i=h.a3())a.i8(h,c),h=i.ag();a.i8(h,c)}}}}return a},f:function(){for(var a=Ne.a6(Hf.d(this._ac.xg())),b=this._ac.x9();b.i1();b.i2()){var c=b.i9();if(c.ak()>1){for(var d=0,e=c.ae();null!=e;e=e.a7()){var f=e.a2();1===f.ak()&&1===f.ao()&&d++}if(d>1)for(var g=c.ae();null!=g;g=g.a7()){var h=g,i=h.a2();if(1===i.ak()&&1===i.ao()){for(;1===i.ak()&&1===i.ao();i=h.a2())a.i8(h,c),h=i.ae();a.i8(h,c)}}}}return a},k:function(){for(var a=1;a<this._ad.length;a++){for(var b=this._ad[a],c=b.ah();c.i1();c.i2()){var d=c.i6();this._n[d.al()]=this.a5(d,b.ay(),d.am(),this._ad[a-1].ay()),this._n[d.al()]+=this._ab[d.al()]/(3*this._ad[a-1].ay())}this.a3(b,this._p)}return this.a1()},a5:function(a,b,c,d){var e=0;if(0===c.i7())e=d*this._ab[a.al()]/b;else{for(;c.i1();c.i2()){var f=c.i8();e+=f.a2()===a?this._ab[f.a3().al()]:this._ab[f.a2().al()]}e/=c.i7()}return e},a7:function(a){Hf.f(this._ab,a,a.length)},b3:function(a){Hf.f(a,this._ab,a.length)},r:function(){var a=Hf.a(this._ab.length);return this.a7(a),a},d:function(){for(var a=0;a<this._ad.length;a++)for(var b=0,c=this._ad[a].ah();c.i1();)this._ab[c.i6().al()]=b,c.i2(),b++},b1:function(){for(var a=0;a<this._ad.length;a++){for(var b=this._ad[a],c=b._b;null!=c;c=c.a()){var d=c.d();this._f[this._ab[d.al()]]=d}for(var e=0,f=b._b;null!=f;)f.c(this._f[e]),f=f.a(),e++}},a3:function(a,b){for(var c=a.ah(),d=0;d<a.ay();c.i2())this._f[d]=c.i6(),d++;Hf.s(this._f,a.ay(),b);for(var e=0,f=a._b;null!=f;)f.c(this._f[e]),this._ab[this._f[e].al()]=e,f=f.a(),e++}}),Bf.b=function(a,b){if(null==a)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4-d:a.f()?-1e4+d:a.c()?-2e4-c:c},Bf.a=function(a,b){if(null==a)return 0;var c=a.a()?Math.floor(b.x):0,d=a.a()?Math.floor(b.y):0;return a.e()?1e4+d:a.f()?-1e4-d:a.d()?-2e4-c:c};var Cf=function(){Cf.superClass.constructor.call(this),this._i6=0,this._i3=2147483647,this._i0=60,this._iz=20,this._i2=20,this._i4=20,this.i5(!1),this._i7=new uf,this._i1=new Bf,this._i8=new xf};Hb.ext(Cf,Qe,{j2:function(){return this._i2},i4:function(a){return!0},i3:function(a){this._i6=(new Date).getTime(),of.d(a,!1);var b=a.xk(),c=a.xk(),d=a.xl(),e=new re,f=new Af(a,b,c,d);f.a6(this.j2()),this._i8.i3(this._iz),this._i8.i6(this._i0),this._i8.i4(this._i2),this._i8.i5(this._i4),this._i8.i2(c);for(var g=this._i7.i1(a,b,e),h=e.c1();h.i1();h.i2()){var i=h.i8();d.i7(i,!0);var j=a.gn(i);a.gt(i,a.gk(i)),a.gz(i,j)}this.a2(a,b,c),g=f.a9(g);var k=this.j1(a,b,g);k=f.a5(k),k=f.b3(k),this._i8.i1(a,k,b),k=f.g2(k),f.e2(k),this.b(a,c),this.w(a),this.a1(a,e),f.e1(),a.xj(d),a.xi(c),a.xi(b)},j1:function(a,b,c){if(this._i1 instanceof Bf){var d=this._i1,e=(new Date).getTime()-this._i6;d.ib(this._i3-e)}var f=this._i1.ia(a,b,c);return f},a1:function(a,b){for(var c=b.c1();c.i1();c.i2()){var d=c.i8(),e=a.gs(d),f=a.gl(d);a.x3(d);var g=a.gp(d);a.s5(d,g.a()),a.gy(d,e),a.gx(d,f)}},b:function(a,b){for(var c=a.x9();c.i1();c.i2()){var d=c.i9(),e=b.i1(d);if(null!=e&&!a.xp(e)){for(var f=d.am().i8().a2();null!=b.i1(f);f=d.am().i8().a2())d=f;a.u1(e);for(var g=d.ae(),h=new qe;null!=b.i1(g.a3());g=g.a3().ag()){var i=a.gs(g);h.aa(i),h.az(a.gf(g));var j=a.gl(g);j.equals(i)||h.aa(j)}var k=a.gs(g);h.aa(k),h.az(a.gf(g));var l=a.gl(g);l.equals(k)||h.aa(l),a.m1(e,h)}}for(var m=a.x9();m.i1();m.i2())null!=b.i1(m.i9())&&a.x4(m.i9())},w:function(a){for(var b=a.xf();b.i1();b.i2()){var c=b.i8(),d=a.g2(c);if(d.i1()>0){var e=new md,f=a.gc(c),g=f.c(),h=g.i6();g.i2();var i=h.x,j=h.y;if(g.i1()){var k=g.i6(),l=k.x,m=k.y;for(g.i2();g.i1();g.i2()){var n=g.i6(),o=n.x,p=n.y,q=(i-o)*(m-p)/(j-p)+o;Math.abs(q-l)>=1&&(e.add(k),i=l,j=m),k=n,l=o,m=p}}e.size()<d.i1()&&a.s5(c,new Xd(e))}}},a2:function(a,b,c){var d=a.g8().c1();for(d.i5();d.i1();d.i3()){var e=d.i8().a2(),f=d.i8().a3(),g=b.i2(f)-b.i2(e);if(g>1){for(var h=null,i=null,j=e;g>1;g--)h=a.xm(),a.s7(h,1,1),a.s4(h,ff._A),i=a.xo(j,h),j===e&&a.gt(i,a.gn(d.i8())),b.i7(h,b.i2(j)+1),c.z1(h,d.i8()),j=h;i=a.xo(h,f),a.gz(i,a.gk(d.i8())),a.h1(d.i8())}}}});var Df=function(a,b,c,d){this._i=20,this._j=a,this._g=b,this._a=c,this._h=d};Hb.ext(Df,Object,{a1:function(a){this._i=a},b2:function(a){return null==this._e?!1:this._e.i4(a)},a3:function(a){return null==this._f?null:this._f.i1(a)},d:function(){this._j.xi(this._f),this._j.xi(this._e)}});var Ef=function(){this._c=0,this._i=0,this._g=0,this._j=0,this._f=0,this._h=0,this._d=0,this._e=0,this._a=0,this._b=0};Hb.ext(Ef,Object,{a:function(){return this._c-this._g-this._f-this._a},b:function(){return this._i+this._j+this._h+this._b}});var Ff=function(){this._d=new re,this._b=new re,this._c=new re,this._e=new re};Hb.ext(Ff,Object,{});var Gf=function(a,b,c,d,e,f,g,h){this._d=a,this._a=b,this._b=c,this._h=d,this._f=e,this._c=f,this._e=g,this._g=h};Hb.ext(Gf,Object,{});var Hf={};if(Hf.a=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=b||0;return c},Hf.b=function(a){for(var b=[],c=0;a>c;c++)b[c]=!1;return b},Hf.c=function(a,b){if(a instanceof Sd)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y<=b.y?0:1;if(a instanceof Td)return b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;if(a instanceof Vd)return a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:a.y>b.y?1:b.width>a.width?-1:b.width<a.width?1:b.height>a.height?-1:b.height>=a.height?0:1;throw"Unkown Type: "+a},Hf.d=function(a){for(var b=[],c=0;a>c;c++)b[c]=null;return b},Hf.e=function(a,b){for(var c=[],d=0;a>d;d++)c[d]=Hf.a(b);return c},Hf.f=function(a,b,c){for(var d=0;c>d;d++)b[d]=a[d]},Hf.s=function(a,b,c){var d=[];Hf.f(a,d,b),d.sort(c),Hf.f(d,a,b)},Hf.n=function(a,b){return a-b},window.make)var If=window.make;else{var If=window.make={},Jf={},Kf={},Lf=[],Mf={};If.Default={path:"./",resPath:"",getImagePath:function(a){return this.path+this.resPath+"res/images/"+(a||"")},register:function(a,b,c){c=c||{},c.name=c.name||a,c.modelDefaultParameters=c.modelDefaultParameters||{},c.description=c.description||c.name,Jf[a]&&console.log(a," already exist"),Jf[a]=b;var d=c.category||"",e=Kf[d]||{};e[a]=b,Kf[d]=e,Mf[a]=c,-1==Lf.indexOf(d)&&Lf.push(d),this.checkModelDefaultParameters(c.modelDefaultParameters)},checkModelDefaultParameters:function(a){if(a)for(var b in a){var c=a[b];c instanceof Object||(c={value:c},a[b]=c),c.propertyName=b,c.hidden=!!c.hidden,c.propertyType=c.propertyType||If.Default.PARAMETER_PROPERTY_TYPE_FIELD,c.type=c.type||If.Default.PARAMETER_TYPE_STRING,c.category=c.category||If.Default.PARAMETER_CATEGORY_DETAIL,c.editable=void 0===c.editable?!0:!!c.editable,c.index=void 0===c.index?100:parseInt(c.index)}},remove:function(a){if(Jf[a]){Jf[a]=void 0,delete Jf[a];var b=If.Default.getCategory(a),c=Kf[b];delete c[a];var d=0;for(var e in c)e&&d++;if(0==d)for(var e=0;e<Lf.length;e++){var f=Lf.indexOf(b);f>=0&&Lf.splice(f,1)}delete Mf[a]}else console.log(a," not exist")},getCategories:function(){return Lf},getCreatorsForCategory:function(a){return Kf[a]},getCreator:function(a){return Jf[a]},getIds:function(a){var b=[];for(var c in Jf)(!a||a&&a(this.getParameters(c)))&&b.push(c);return b},getModelDefaultParameters:function(a){var b=this.getParameters(a);return b.modelDefaultParameters},getDescription:function(a){var b=this.getParameters(a);return b.description},getName:function(a){var b=this.getParameters(a);return b.name},getIcon:function(a){var b=this.getParameters(a);return this.path+b.icon},isAsync:function(a){var b=this.getParameters(a);return b.async},isCombo:function(a){var b=this.getParameters(a);return b.combo},getCategory:function(a){var b=this.getParameters(a);return b.category},getOrder:function(a){var b=this.getParameters(a);return b.order||0},getType:function(a){var b=this.getParameters(a);return b.type},getOtherParameter:function(a,b){var c=this.getParameters(a);return c[b]},registerIcon:function(a,b){var c=this.getParameters(a);if(c)return c.icon=b,c.icon},registerDescription:function(a,b){var c=this.getParameters(a);return c.description=b,c.description},registerName:function(a,b){var c=this.getParameters(a);return c.name=b,c.name},registerOther:function(a,b,c){var d=e[b],e=this.getParameters(a);return e[b]=c,"modelDefaultParameters"===b&&(console.warn("rewrite modelDefaultParameters: id={0}, oldValue={}, newValue={}",a,d,c),this.checkModelDefaultParameters(c)),d},appendModelDefaultParameter:function(a,b,c,d,e,f,g){},getParameters:function(a){return Mf[a]||{}},load:function(a,b,c){var d,c=c||{},e=c.isRelation;if(b){var f=b;b=function(b){e&&a instanceof Array&&a.length>1&&b instanceof Array&&b.length>1&&this._relation(a,b),f(b)}}if(a instanceof Array){var g={};if(b){var h=function(c,d){var e=a.length;return function(a){c.datas=c.datas||[],c.datas.push(a),c._total===e&&b(c.datas)}(d)};g._total=0;for(var i=0;i<a.length;i++){var j=a[i];this.load(j,function(a){g._total++,h(g,a)})}return null}d=[];for(var i=0;i<a.length;i++){var j=a[i],k=this.load(j);k&&d.push(k)}}else{var l={};"string"==typeof a?l.id=a:l=a,l=this.filterJson(l),b?this._load(l,b):d=this._load(l)}return e&&d instanceof Array&&d.length>1&&this._relation(a,d),d},_relation:function(a,b){var c={};b.forEach(function(a){a.getId&&(c[a.getId()]=a)}),a.forEach(function(a){a.objectId&&a.parentId&&c[a.objectId]&&c[a.parentId]&&c[a.objectId].setParent&&c[a.objectId].setParent(c[a.parentId])})},_load:function(a,b){var c=a.id,d=this.getCreator(c);if(!d)return console.log("unknown id: ",c),null;if(!b){var e=d(a);return If.Default._setObjectClientId(e,c),e}d(a,function(a){If.Default._setObjectClientId(a,c),b&&b(a)})},_setObjectClientId:function(a,b){a&&a.setClient&&a.setClient("id",b)},copyArray:function(a,b,c){if(b=[],a)for(var d,e=0,f=a.length;f>e;e++)d={},this.copyProperties(a[e],d),b.push(d);return b},copyProperties:function(a,b,c){if(a&&b)for(var d in a)c&&c.indexOf(d)>=0||0==d.indexOf("_")||(void 0===b[d]&&(b[d]=a[d]instanceof Array?[]:a[d]instanceof Function?a[d]:a[d]instanceof Object?{}:a[d]),!(a[d]instanceof Function)&&a[d]instanceof Object&&b[d]instanceof Object&&If.Default.copyProperties(a[d],b[d]))},getModelDefaultParametersValues:function(a,b){var c=this.getModelDefaultParameters(a),d={};for(var e in c){var f=c[e];b&&b(f)||(f.propertyType==If.Default.PARAMETER_PROPERTY_TYPE_CLIENT?(d.client=d.client||{},d.client[e]=f.value):f.propertyType==If.Default.PARAMETER_PROPERTY_TYPE_STYLE?(d.style=d.style||{},d.style[e]=f.value):d[e]=f.value)}return d},getModelDefaultParameterProperties:function(a,b){var c=this,d=[],e=this.getModelDefaultParameters(a);if(!e)return d;b&&!e.id&&(e.id={propertyName:"id",name:"模型ID",category:If.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:If.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:If.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-2}),b&&!e.objectId&&(e.objectId={propertyName:"objectId",name:"实例ID",category:If.Default.PARAMETER_CATEGORY_BASIC,editable:!1,propertyType:If.Default.PARAMETER_PROPERTY_TYPE_FIELD,type:If.Default.PARAMETER_TYPE_STRING,exportable:!1,index:-1});for(var f in e)d.push(e[f]);return d.sort(function(a,b){return a.index-b.index}),d=d.map(function(a){return c.modelParameterToProperty(a)})},_getNameFromPropertyName:function(a){for(var b=a.split("."),c="",d=0;d<b.length;d++)b[d].length>0&&(c+=b[d].substring(0,1).toUpperCase()+b[d].substring(1,b[d].length)),d<b.length-1&&(c+=" ");return c},modelParameterToProperty:function(a){var b=new Gb.Property;return b.setCategoryName(a.category),a.name||(a.name=this._getNameFromPropertyName(a.propertyName)),b.setName(a.name),b.setEditable(a.editable),b.setPropertyType(a.propertyType),b.setPropertyName(a.propertyName),b.setValueType(a.type),b.setEnumInfo(a.enumInfo),b.isVisible=function(){return!a.hidden},b},filterJson:function(a){var b=this.getModelDefaultParameters(a.id);for(var c in b){var d=b[c].propertyType||"client",e=b[c].value;d==If.Default.PARAMETER_PROPERTY_TYPE_STYLE?a.style&&void 0!==a.style[c]||(a.style=a.style||{},a.style[c]=e):d==If.Default.PARAMETER_PROPERTY_TYPE_CLIENT?a.client&&void 0!==a.client[c]||(a.client=a.client||{},a.client[c]=e):void 0===a[c]&&(a[c]=e)}return a},UNIT_HEIGHT:4.445,EQUIPMENT_WIDTH:45.5,RACK_OFFSET_X:7.25,RACK_OFFSET_Y:6.655,RACK_WIDTH:60,getUnitHeight:function(){return this.UNIT_HEIGHT},getEquipmentWidth:function(){return this.EQUIPMENT_WIDTH},getEquipmentHeight:function(a){return parseInt(a)>0||console.error("method getEquipmentHeight's first argument scale value is zero"),this.UNIT_HEIGHT*a},getRackWidth:function(){return this.RACK_WIDTH},getRackHeight:function(a){return parseInt(a)>0||console.error("method getRackHeight's first argument scale value is zero"),this.RACK_OFFSET_Y+this.UNIT_HEIGHT*parseInt(a)+this.RACK_OFFSET_Y}},If.Default.toJson=function(a,b){if(a&&a.getClient){var c=a.getClient("id"),d=If.Default.getModelDefaultParameters(c),e={},f=null,g=null;for(var h in d)if(d[h].exportable!==!1){var i=d[h].propertyType,g=d[h].value;i==If.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR?(f=a[Hb.getter(h)](),If.Default.equals(f,g)||(e[h]=f)):i==If.Default.PARAMETER_PROPERTY_TYPE_FIELD?(f=a[h],If.Default.equals(f,g)||(e[h]=f)):i==If.Default.PARAMETER_PROPERTY_TYPE_STYLE?(f=a.getStyle(h),If.Default.equals(f,g)||(e.style=e.style||{},e.style[h]=f)):i==If.Default.PARAMETER_PROPERTY_TYPE_CLIENT&&(f=a.getClient(h),If.Default.equals(f,g)||(e.client=e.client||{},e.client[h]=f))}return e.id=c,If.Default.EXPORT_OBJECT_ID&&(e.objectId=a.getId()),b&&(e=b(e)),e}return b&&(a=b(a)),a},If.Default.copy=function(a,b,c,d,e){var f=function(a,b,c,d,e){e=e||{};var f={},g={},h=If.Default.getParameters(b);if(h=If.Default.clone(h),If.Default.copyProperties(h,g),d instanceof Function?f=d(g)||{}:If.Default.copyProperties(d,f),e.copyDefaultParamCoverage&&delete g.modelDefaultParameters,e.copyParamCoverage||If.Default.copyProperties(g,f),e.defaultValue&&f.modelDefaultParameters)for(var i in e.defaultValue)void 0!==f.modelDefaultParameters[i]&&(f.modelDefaultParameters[i]instanceof Object?f.modelDefaultParameters[i].value=e.defaultValue[i]:f.modelDefaultParameters[i]=e.defaultValue[i]);If.Default.register(a,function(a,d){var e={id:b};c instanceof Function?c(a):If.Default.copyProperties(c,e),If.Default.copyProperties(a,e);var f=If.Default.load(e,d);return f},f)};f(a,b,c,d,e)},If.Default.PARAMETER_CATEGORY_BASIC="BASIC",If.Default.PARAMETER_CATEGORY_DETAIL="Detail",If.Default.PARAMETER_TYPE_STRING="string",If.Default.PARAMETER_TYPE_BOOLEAN="boolean",If.Default.PARAMETER_TYPE_COLOR="color",If.Default.PARAMETER_TYPE_INT="int",If.Default.PARAMETER_TYPE_NUMBER="number",If.Default.PARAMETER_TYPE_IMAGE="image",If.Default.PARAMETER_TYPE_ARRAY_STRING="array.string",If.Default.PARAMETER_TYPE_ARRAY_NUMBER="array.number",If.Default.PARAMETER_TYPE_ARRAY_INT="array.int",If.Default.PARAMETER_PROPERTY_TYPE_FIELD="field",If.Default.PARAMETER_PROPERTY_TYPE_ACCESSOR="accessor",If.Default.PARAMETER_PROPERTY_TYPE_STYLE="style",If.Default.PARAMETER_PROPERTY_TYPE_CLIENT="client",String.prototype.replaceAll=function(a,b,c){return RegExp.prototype.isPrototypeOf(a)?this.replace(a,b):this.replace(new RegExp(a,c?"gi":"g"),b)},String.prototype.format=function(a){var b=this;if(arguments.length>1){for(var c=[],d=0;d<arguments.length;d++)c.push(arguments[d]);a=c}if(a){if(a instanceof Array)a.forEach(function(a,c){a instanceof Object&&(a=JSON.stringify(a)),b=b.replaceAll("{"+c+"}",a)});else{if(!(a instanceof Object))return b.replaceAll("{}",a);for(var e in a){var f=a[e];f instanceof Object&&(f=JSON.stringify(f)),b=b.replaceAll("{"+e+"}",f)}}}return b},If.Default.getId=function(a){return a.getClient("id")},If.Default.objectWrapper=function(a,b,c,d){Object.defineProperty(a,b,{get:function(){var d=a["___"+b];return c&&(d=c.call(a,d,a,b)),d},set:function(c){var e=a[b];d&&(c=d.call(a,c,a,b)),e!==c&&(a["___"+b]=c,this.firePropertyChange&&this.firePropertyChange(b,e,c))}})},If.Default.equals=function(a,b){return a instanceof Object&&b instanceof Object?JSON.stringify(a)==JSON.stringify(b):a==b},If.Default.clone=function(a){try{return JSON.parse(JSON.stringify(a))}catch(b){throw console.error(b,a),b}},If.Default.EXPORT_OBJECT_ID=!0}If.Utils2D={create2dShapeNode:function(a){var b=a.position||[0,0,0],c=a.data,d=a.image,e=(a.objType,a.objectId),f=a.closed,g=new If.Default.WallShapeNode(e);"innerWall"==a.objType?g=new If.Default.InnerWallShapeNode(e):"floor"==a.objType?g=new If.Default.FloorShapeNode(e):"cable"==a.objType&&(g=new If.Default.LineWidthShapeNode(e));var h=If.Default.create2dShapePath(c,b);return If.Default.objectWrapper(g,"id",function(){return this.getClient("id")}),If.Default.objectWrapper(g,"objectId",function(){return this.getId()}),g.setSegments(h.segments),g.setPoints(h.points),f&&g.setClient("closed",!0),d&&g.setClient("imageSrc",d),If.Default.setObject2dCSProps(g,a),g},create2dShapePath:function(a,b){var c=new Gb.List,d=new Gb.List;if(a.length>0)if(c.add("moveto"),a[0]instanceof Array){d.add({x:parseFloat(a[0][0])+parseFloat(b[0]),y:parseFloat(a[0][1])+parseFloat(b[2])});for(var e=1;e<a.length;e++){var f=a[e];"c"==f[0]?(c.add("quadto"),d.add({x:parseFloat(f[1])+parseFloat(b[0]),y:parseFloat(f[2])+parseFloat(b[2])}),d.add({x:parseFloat(f[3])+parseFloat(b[0]),y:parseFloat(f[4])+parseFloat(b[2])})):(c.add("lineto"),d.add({x:parseFloat(f[0])+parseFloat(b[0]),y:parseFloat(f[1])+parseFloat(b[2])}))}}else{d.add({x:parseFloat(a[0])+parseFloat(b[0]),y:parseFloat(a[1])+parseFloat(b[2])});for(var e=2;e<a.length;e+=2)c.add("lineto"),d.add({x:parseFloat(a[e])+parseFloat(b[0]),y:parseFloat(a[e+1])+parseFloat(b[2])})}return{segments:c,points:d}},setObject2dCSProps:function(a,b){var c=b.style,d=b.client;if(c)for(var e in c)a.setStyle(e,c[e]);if(d)for(var e in d)a.setClient(e,d[e])},createBlockObject:function(a,b){var c=a.objectId,d=new If.Default.Block(c);"door"==b?d=new If.Default.Door(c):"window"==b&&(d=new If.Default.Window(c)),a.width&&d.setClient("length",a.width);var e=a.client||{};return d.setClient("edgeIndex",e.edgeIndex||1),d.setClient("offset",e.offset||0),If.Default.setObject2dCSProps(d,a),d},createNode:function(a){var b=a.position||[0,0,0],c=a.rotation||[0,0,0],d=a.width||50,e=a.depth||50,f=a.image,g=a.objectId,h=new Gb.Follower(g),i=a.color||"#CCCCFF";return If.Default.objectWrapper(h,"id",function(){return this.getClient("id")}),If.Default.objectWrapper(h,"objectId",function(){return this.getId()}),h.setSize(parseFloat(d),parseFloat(e)),h.setCenterLocation({x:parseFloat(b[0]),y:parseFloat(b[2])}),h.setAngle(c[1]),h.setClient("positionY",b[1]),"string"==typeof f?h.setImageUrl(f):"object"==typeof f?h.setImage(f):(h.setStyle("body.type","vector"),h.setStyle("vector.shape","rectangle"),h.setStyle("vector.fill.color",i)),h.setStyle("select.style","border"),h.setStyle("select.color","#F07819"),h.setStyle("select.width",.7),h.setStyle("vector.outline.width",1),h.setStyle("vector.outline.color","#BEC9BE"),h.getWidth()>20&&h.setStyle("label.maxlength",Math.min(h.getWidth(),h.getHeight())),h.setStyle("label.position","center"),If.Default.setObject2dCSProps(h,a),h},createFollower:function(a){var b=a,a={};If.Default.copyProperties(b,a),a.id=a.objectId||Hb.id(),a.scale=a.scale||1,a.depth=a.depth||5,a.position=a.position||[0,0,0],a.rotation=a.rotation||[0,0,0];var c=new Gb.Follower(a);return If.Default.objectWrapper(c,"id",function(){return c.getClient("id")}),If.Default.objectWrapper(c,"objectId",function(){return c.getId()}),If.Default.objectWrapper(c,"depth"),If.Default.objectWrapper(c,"position",null,function(a){return this.setLocation({x:a[0],y:a[1]}),a}),If.Default.objectWrapper(c,"rotation",null,function(a){return this.setAngle(a[2]),a}),If.Default.objectWrapper(c,"scale",null,function(a){var b=this.getSize();b.width=b.width*a,b.height=b.height*a,this.setSize(b);var d=this.getLocation();return d.x=d.x*a,d.y=d.y*a,c.setLocation(d),a}),c.depth=a.depth,c.position=a.position,c.rotation=a.rotation,c.scale=a.scale,c.addPropertyChangeListener(function(a){var b=a.property,c=a.source;"location"==b?(c.position[0]=a.newValue.x,c.position[1]=a.newValue.y):"angle"==b&&(c.rotation[2]=a.newValue)},c),a.x&&c.setX(a.x),a.y&&c.setY(a.y),c.z=a.z,a.location&&c.setLocation(a.location instanceof Array?{x:a.location[0],y:a.location[1]}:a.location),a.centerLocation&&c.setCenterLocation(a.centerLocation instanceof Array?{x:a.centerLocation[0],y:a.centerLocation[1]}:a.centerLocation),a.size&&c.setSize(a.size),a.angle&&c.setAngle(a.angle),c.setStyle("select.style","border"),c.setStyle("select.color","#F07819"),c.setStyle("select.width",.7),c.setStyle("vector.outline.color","#BEC9BE"),If.Default.setObject2dCSProps(c,a),c},align:function(a,b){if(b&&a&&!(a.size()<2)){var c=this["_align_"+b];c&&c.call(this,a)}},_align_up:function(a){for(var b=a.get(0).getLocation().y,c=1;c<a.size();c++)b=Math.min(b,a.get(c).getLocation().y);a.forEach(function(a){a.setY(b)})},_align_down:function(a){for(var b=a.get(0).getLocation().y+a.get(0).getSize().height,c=1;c<a.size();c++)b=Math.max(b,a.get(c).getLocation().y+a.get(c).getSize().height);a.forEach(function(a){a.setY(b-a.getSize().height)})},_align_left:function(a){for(var b=a.get(0).getLocation().x,c=1;c<a.size();c++)b=Math.min(b,a.get(c).getLocation().x);

a.forEach(function(a){a.setX(b)})},_align_right:function(a){for(var b=a.get(0).getLocation().x+a.get(0).getSize().width,c=1;c<a.size();c++)b=Math.max(b,a.get(c).getLocation().x+a.get(c).getSize().width);a.forEach(function(a){a.setX(b-a.getSize().width)})},_align_center:function(a){for(var b=0,c=0;c<a.size();c++)b+=a.get(c).getCenterLocation().y;var d=b/a.size();a.forEach(function(a){a.setY(d-a.getSize().height/2)})},_align_middle:function(a){for(var b=0,c=0;c<a.size();c++)b+=a.get(c).getCenterLocation().x;var d=b/a.size();a.forEach(function(a){a.setX(d-a.getSize().width/2)})},flow:function(a,b,c){if(b&&a&&!(a.size()<2)){var d=this["_flow_"+b];d&&d.call(this,a,c)}},_flow_hor:function(a,b){this.sort(a,function(a,b){return a.getLocation().y-b.getLocation().y}),this.sort(a,function(a,b){return a.getLocation().x-b.getLocation().x});for(var c=a.get(0),d=1;d<a.size();d++){var e=a.get(d),f=c.getLocation().x;e.setX(f+b),c=e}},_flow_ver:function(a,b){this.sort(a,function(a,b){return a.getLocation().x-b.getLocation().x}),this.sort(a,function(a,b){return a.getLocation().y-b.getLocation().y});for(var c=a.get(0),d=1;d<a.size();d++){var e=a.get(d),f=c.getLocation().y;e.setY(f+b),c=e}},sort:function(a,b){for(var c,d,e,f,g=a.size(),h=0;g>h;h++){c=a.get(h);for(var i=h+1;g>i;i++)d=a.get(i),e=b?b(c,d):0,e>0&&(f=d,d=c,c=f,a.set(h,c),a.set(i,d))}},wrapper:function(a,b){If.Default.objectWrapper(a,"id",function(){return this.getClient("id")}),If.Default.objectWrapper(a,"objectId",function(){return this.getId()}),If.Default.objectWrapper(a,"width"),If.Default.objectWrapper(a,"height"),If.Default.objectWrapper(a,"depth"),If.Default.objectWrapper(a,"px"),If.Default.objectWrapper(a,"py"),If.Default.objectWrapper(a,"pz"),If.Default.objectWrapper(a,"rx"),If.Default.objectWrapper(a,"ry"),If.Default.objectWrapper(a,"rz"),If.Default.objectWrapper(a,"position"),If.Default.objectWrapper(a,"rotation"),b&&b.forEach(function(b){If.Default.objectWrapper(a,b)})}},If.Default.register("twaver.cube.top",function(a,b){var c=If.Utils2D.createNode(a);return b&&b(c),c});for(var pc in If.Utils2D)If.Default[pc]=If.Utils2D[pc]}();